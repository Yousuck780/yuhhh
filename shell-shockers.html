<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" class="mdl-js"><head>
    <script async="" __uv-attr-src="https://www.google-analytics.com/analytics.js" src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgmoelg-cncl%7Btkcq.aoo%2Fcncl%7Btkcq.hs"></script><script type="text/javascript" async="" __uv-attr-src="https://www.googletagmanager.com/gtag/js?id=G-79NWRZXYCB&amp;l=dataLayer&amp;cx=c" src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgmoelgtcgoalaeep.aoo%2Fetcg-jq%3Fkd%3FG%2F7%3BNURXX%5BC%40%26n%3DfavaNa%7Bep%26ax%3Fc"></script><script __uv-attr-src="https://connect.facebook.net/signals/config/446896919250308?v=2.9.136&amp;r=stable&amp;domain=tam-shellshockers.arfotoarte.com" src="https://math.isreally.pro/service/hvtrs8%2F-cmnleat%2Cfccgbmoi.lev%2Fqienclq%2Faolfkg-466%3A94939052328%3Dv%3F2%2C9%2C116%24r%3Fsva%60lg%26fooakn%3Ftcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo" async=""></script><script __uv-attr-src="https://connect.facebook.net/signals/config/771186996377132?v=2.9.136&amp;r=stable&amp;domain=tam-shellshockers.arfotoarte.com" src="https://math.isreally.pro/service/hvtrs8%2F-cmnleat%2Cfccgbmoi.lev%2Fqienclq%2Faolfkg-7513849%3B6175112%3Dv%3F2%2C9%2C116%24r%3Fsva%60lg%26fooakn%3Ftcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo" async=""></script><script async="" __uv-attr-src="https://connect.facebook.net/en_US/fbevents.js" src="https://math.isreally.pro/service/hvtrs8%2F-cmnleat%2Cfccgbmoi.lev%2Fgn%5DUQ%2Fdbgvgnvs%2Cjq"></script><script async="" __uv-attr-src="https://www.googletagmanager.com/gtm.js?id=GTM-K5MSJHJ" src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgmoelgtcgoalaeep.aoo%2Feto.hs%3Dif%3DETO-I5OSHHH"></script><script>
// var dynamicContentRoot = 'staging-new.shellshock.io';
// var dynamicContentPrefix = 'https://staging-new.shellshock.io/';
var dynamicContentRoot = '';
var dynamicContentPrefix = '';
var gtmOptions = { cookie_flags: 'secure;samesite=none' };
</script>

<script>
class Loader {
static show () {
    let container = document.createElement('div');
    container.id = 'progress-container';
    container.style = `
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 100vw;
        z-index: 2000;
        background-image: var(--ss-lightoverlay);
    `;

    const progressWrapper = document.createElement('div');
    progressWrapper.id = 'progress-wrapper';
    progressWrapper.className = 'load_screen align-items-center';
    progressWrapper.style = `
        position: absolute;
        left: 50%;
        top: -6em;
        transform: translateX(-50%);
        background-image: none;
    `;

    const blueWizLogo = document.createElement('img');
    blueWizLogo.src = 'img/BlueWizard-Logo-min.png';
    blueWizLogo.style=`
        width: 16em;
        display: block;
        margin: 5em auto 0;
        z-index: 2000;
        position: absolute;
        left: 50%;
        bottom: 8em;
        transform: translateX(-50%);
    `;

    let logo = document.createElement('img');
    logo.src = 'img/logo.svg';
    logo.style = 'height: 16em';
    logo.id = 'logo-svg';
    // container.appendChild(logo);

    const progressOuter = document.createElement('div');
    progressOuter.id = 'progress-outer';
    progressOuter.style = `
        position: relative;
        background: #643219;
        border-radius: 2em;
        height: 3.3em;
        width: 24em;
        margin-top: 2em;
    `;


    let progress = document.createElement('div');
    progress.style = `
        margin-top: 1em;
        width: 23em;
        height: 2.2em;
        background: white;
        padding: 0.5em;
        border-radius: 2em;
        margin: .3em .5em 0;
    `;
    container.appendChild(progress);

    let progressBar = document.createElement('span');
    progressBar.id = 'progressBar';
    progressBar.style = `
        display: block;
        width: 20%;
        height: 100%;
        background: orange;
        border-radius: 2em;
        margin-left: 80%;
        margin: 0 .3em .5em 0;
        opacity: 0;
        transition: margin-left linear 500ms;
        transition-timing-function: ease-in-out;
    `;

    const progressBarOutside = document.createElement('div');


    progress.appendChild(progressBar);
    progressWrapper.appendChild(logo);
    progressOuter.appendChild(progress);
    progressWrapper.appendChild(progressOuter);
    
    container.appendChild(progressWrapper);
    container.appendChild(blueWizLogo);

    // Minor for the progress bar intial load
    setTimeout(() => progressBar.style.opacity = 1, 600);


    Loader.barInterval = setInterval(() => {
        if (Loader.progressBar.style.marginLeft == '0%') {
            Loader.progressBar.style.marginLeft = '80%';
        }
        else {
            Loader.progressBar.style.marginLeft = '0%';
        }
    }, 500);

    Loader.progressBar = progressBar;
    Loader.container = container;

    let app = document.body;
    app.appendChild(container);
}

static hide () {
    Loader.container.style = "opacity : 0; transition: opacity 1s;";
    setTimeout(() => { Loader.container.remove(); }, 1000);
}

static addTask () {
    let id = Loader.loaded.length;
    //console.log('Loading tasks: ', ++Loader.actualTasks);
    Loader.loaded.push(0);
    return id;
}

static finish (id) {
    clearInterval(Loader.barInterval);

    if (Loader.progressBar) {
        Loader.progressBar.style.marginLeft = '0%';
        Loader.progressBar.style.transition = '';

        Loader.loaded[__uv.$wrap((id))] = 1;
        Loader.updateBar();
    }
}

static progress (id, value, total) {
    clearInterval(Loader.barInterval);

    if (Loader.progressBar) {
        Loader.progressBar.style.marginLeft = '0%';
        Loader.progressBar.style.transition = '';

        Loader.loaded[__uv.$wrap((id))] = value / total;

        Loader.updateBar();
    }

    return id;
}

static updateBar () {
    let loadedTotal = 0;

    for (let l of Loader.loaded) {
        loadedTotal += l;
    }
    let percent = loadedTotal / Loader.tasks * 95 + 5;
    // no more than 100%
    if (percent > 100) {
        percent = 100;
    }

    Loader.progressBar.style.width = percent + '%';
}

static loadJS (path, callback) {
    let p = path;

    (function (p, cb) {
        let xhr = new XMLHttpRequest();
          xhr.open('GET', p, true);

        let id = Loader.addTask();

        xhr.onprogress = event => {
            if (Loader.progressBar) {
                id = Loader.progress(id, event.loaded, event.total);
            }
        };

        xhr.onload = () => {
            if (xhr.status != 200) {
                  console.log(`Error ${xhr.status}: ${xhr.statusText}`);
            }
            else {
                Loader.finish(id);

                let script = document.createElement('script');
                script.innerHTML = xhr.response;
                document.body.appendChild(script);

                if (cb) cb();
            }
        };

        xhr.send();
    })(path, callback);
}
}

Loader.actualTasks = 0;
Loader.tasks = 17;
Loader.loaded = [];

window.Loader = Loader;
window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;

function openFirebaseDb () {
return new Promise((resolve, reject) => {
    let req = window.indexedDB.open('firebaseLocalStorageDb');
    req.onsuccess = () => {
        let db = req.result;
        let transaction = db.transaction(['firebaseLocalStorage'], 'readwrite');
        let store = transaction.objectStore('firebaseLocalStorage');
        resolve({ db, store });
    }
    req.onerror = err => reject(err);
    req.onupgradeneeded = () => {
        let db = req.result;
        let store = db.createObjectStore('firebaseLocalStorage', { keyPath: 'fbase_key' });
        resolve({ db, store });
    }
});
}

var redirectIframe

function postStorageAndRedirect (iframe, storage, firebaseDb) {
iframe.contentWindow.__uv$setSource(__uv).postMessage({ storage, firebaseDb }, '*');
window.__uv$setSource(__uv).__uv$location = 'https://shellshock.io' + window.__uv$setSource(__uv).__uv$location.search + window.__uv$setSource(__uv).__uv$location.hash;
}

window.addEventListener('DOMContentLoaded', () => {
Loader.show();
});
</script><!-- title, seo meta and favicons -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="facebook-domain-verification" content="6lfua33vx0abiv1asnt9p13aac29xy">
<title>Shell Shockers üç≥ Multiplayer io game</title>
<meta name="Description" content="Blocked? Try geometry.monster | The OFFICIAL home of Shell Shockers, the world‚Äôs best egg-based shooter! It‚Äôs like your favorite FPS battlefield game‚Ä¶ with eggs.">
<meta name="Keywords" content="Play, Free, Online, Multiplayer, Games, IO, ShellShockers, Shooter, Bullets, Top Down">
<meta name="author" content="Blue Wizard Digital">

<meta name="theme-color" content="#0B93BD">
<meta name="background-color" content="#0B93BD">

<link rel="icon" href="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fdatiaol.kcm" type="image/x-icon" __uv-attr-href="favicon.ico">
<link rel="apple-touch-icon" href="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fdatiaol1%3B2%2Cplg" sizes="192x192" __uv-attr-href="favicon192.png">
<link rel="icon" href="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fdatiaol276%2Cplg" sizes="512x512" __uv-attr-href="favicon256.png">

<meta property="og:url" content="https://www.shellshock.io">
<meta property="og:type" content="website">
<meta property="og:image:width" content="1000">
<meta property="og:image:height" content="500">
<meta property="og:image" content="https://www.shellshock.io/img/previewImage_shellShockers.jpg">
<meta name="image" property="og:image" content="https://www.shellshock.io/img/previewImage_shellShockers.jpg">
<meta property="og:title" content="Shell Shockers | by Blue Wizard Digital">
<meta property="og:description" content="Blocked? Try geometry.monster | The OFFICIAL home of Shell Shockers, the world‚Äôs best egg-based shooter! It‚Äôs like your favorite FPS battlefield game‚Ä¶ with eggs.">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@eggcombat">
<meta name="twitter:creator" content="@eggcombat">
<meta name="twitter:title" content="Shell Shockers | by Blue Wizard Digital">
<meta name="twitter:description" content="Blocked? Try geometry.monster | The OFFICIAL home of Shell Shockers, the world‚Äôs best egg-based shooter! It‚Äôs like your favorite FPS battlefield game‚Ä¶ with eggs.">
<meta name="twitter:image" content="https://www.shellshock.io/img/previewImage_shellShockers.jpg">

<!-- Styles & Fonts -->
<link href="https://math.isreally.pro/service/hvtrs8%2F-fmnvs%2Cgmoelgariq.aoo%2Fasq%3Fdaoiny%3FSkgoap%2BMng%7CLulivo8120.220.620.720.920" rel="stylesheet" __uv-attr-href="https://fonts.googleapis.com/css?family=Sigmar+One|Nunito:100,200,600,700,900">
<link rel="stylesheet" href="https://math.isreally.pro/service/hvtrs8%2F-cfnhs%2Ccnowddlcrg.aoo%2Fcjcx-lkbq%2Fdolt%2Faueqooe-5%2C16.2%2Fasq%2Fcln.oil.asq" __uv-attr-crossorigin="anonymous" __uv-attr-href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
<link rel="stylesheet" href="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fqt%7Blgs-tpalsktkols%2Ccqs%3D14879%3A1390" __uv-attr-href="styles/transitions.css?1685981192">
<link rel="stylesheet" href="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fqt%7Blgs-fmros%2Ccqs%3D149%3A410610" __uv-attr-href="styles/forms.css?1698430412">
<link rel="stylesheet" href="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fqt%7Blgs-svyne%2Ccqs%3D149%3A410610" __uv-attr-href="styles/style.css?1698430412">
<link rel="stylesheet" href="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fqt%7Blgs-gcmg.asq%3F36%3B8632432" __uv-attr-href="styles/game.css?1698430412"><script>
function storageFactory(getStorage) {

const inMemoryStorage = {};

function isSupported() {
    try {
        var testKey = "__some_random_key_you_are_not_going_to_use__";
        getStorage().setItem(testKey, testKey);
        getStorage().removeItem(testKey);
        return true;
    } catch (e) {
        return false;
    }
}

function clear() {
    if (isSupported()) {
        getStorage().clear();
    } else {
        inMemoryStorage = {};
    }
}

function getItem(name) {
    if (isSupported()) {
        return getStorage().getItem(name);
    }

    if (inMemoryStorage.hasOwnProperty(name)) {
        return inMemoryStorage[__uv.$wrap((name))];
    }

    return null;
}

function key(index) {
    if (isSupported()) {
        return getStorage().key(index);
    } else {
        return Object.keys(inMemoryStorage)[__uv.$wrap((index))] || null;
    }
}

function removeItem(name) {
    if (isSupported()) {
        getStorage().removeItem(name);
    } else {
        delete inMemoryStorage[__uv.$wrap((name))];
    }
}

function setItem(name, value) {
    if (isSupported()) {
        getStorage().setItem(name, value);
    } else {
        inMemoryStorage[__uv.$wrap((name))] = String(value);
    }
}

function length() {
    if (isSupported()) {
        return getStorage().length;
    } else {
        return Object.keys(inMemoryStorage).length;
    }
}

return {
    getItem: getItem,
    setItem: setItem,
    removeItem: removeItem,
    clear: clear,
    key: key,

    get length() {
        return length();
    }

};
}

const localStore = storageFactory(() => localStorage);
const sessionStore = storageFactory(() => sessionStorage);
</script><style>.eggIcon{display:inline-block;color:#444444;width:.8em;height:.8em;fill:currentColor}</style>
                    

<style>.eggIconLocked{display:inline-block;color:#444444;width:.8em;height:.8em;fill:currentColor}</style>
                        
<meta http-equiv="origin-trial" content="AymqwRC7u88Y4JPvfIF2F37QKylC04248hLCdJAsh8xgOfe/dVJPV3XS3wLFca1ZMVOtnBfVjaCMTVudWM//5g4AAAB7eyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjk1MTY3OTk5LCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="AymqwRC7u88Y4JPvfIF2F37QKylC04248hLCdJAsh8xgOfe/dVJPV3XS3wLFca1ZMVOtnBfVjaCMTVudWM//5g4AAAB7eyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjk1MTY3OTk5LCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="A+xK4jmZTgh1KBVry/UZKUE3h6Dr9HPPioFS4KNCzify+KEoOii7z/goKS2zgbAOwhpZ1GZllpdz7XviivJM9gcAAACFeyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiQXR0cmlidXRpb25SZXBvcnRpbmdDcm9zc0FwcFdlYiIsImV4cGlyeSI6MTcwNzI2Mzk5OSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><script attributionsrc="" type="text/javascript" async="" __uv-attr-src="https://www.googleadservices.com/pagead/conversion/662950613/?random=1698452810163&amp;cv=11&amp;fst=1698452810163&amp;bg=ffffff&amp;guid=ON&amp;async=1&amp;gtm=45He3ap0v812812352&amp;gcd=11l1l1l1l1&amp;u_w=1440&amp;u_h=900&amp;url=https%3A%2F%2Ftam-shellshockers.arfotoarte.com%2F&amp;top=https%3A%2F%2Frawcdn.githack.com%2F3kh0%2F3kh0-Assets%2Fe3144855e924629d8f7c41238660a823a5336705%2Fshellshockers%2Findex.html&amp;label=u82gCJTLqdcBENWlj7wC&amp;hn=www.googleadservices.com&amp;frm=2&amp;tiba=Shell%20Shockers%20%F0%9F%8D%B3%20Multiplayer%20io%20game&amp;value=0&amp;bttype=purchase&amp;auid=315859952.1698452810&amp;uaa=x86&amp;uab=64&amp;uafvl=Chromium%3B116.0.5845.188%7CNot)A%253BBrand%3B24.0.0.0%7COpera%2520GX%3B102.0.4880.99&amp;uamb=0&amp;uap=macOS&amp;uapv=10.15.7&amp;uaw=0&amp;rfmt=3&amp;fmt=4" src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgmoelgafsgrtiaeq.aoo%2Fraeecd-cmntepskol%2F460970411%2F%3Drcnfoo%3D36%3B8650830361%26av%3F13%26dsv%3D36%3B8650830361%26%60g%3Ffdfdfd%26eukd%3FOL%26cs%7Bna%3D3%26eto%3D65Je1ar0t832%3A10372%24gad%3F13l3l3l3l3%26w_u%3D3460%24u%5Dh%3F920%24upl%3Fhvtrs'3C%250F'2Dtcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%250F%24tmp%3Fhvtrs'3C%250F'2Drcwadl.eivhcci.aoo%250F1kj0'2D3ih2-Csqevs'2De1164%3A57e%3B26609f8d7a43218462a%3A21a7316507%250Fqhglnsjoakgrq%250Fknfez.jtol%24lcbgl%3Fu%3A2eCHTNqfc%40ELWnj5wA%26jn%3Fwuw%2Cgmoelgafsgrtiaeq.aoo%26dro%3D0%26vi%60a%3FSjenl'22Sjoakgrq%2500'F2%25%3BF'8F%25%403'22Mwlvirlcygr'22im%2500eaoe%24vclwe%3F0%24bvt%7Bpg%3Drupcjaqe%24awif%3D117879%3B50.36%3B8650830%24uca%3Fx%3A6%24ucb%3F66%26wadvn%3DAhpooiwm'3%40136%2C0%2C5%3A47.38%3A%255CLov)C%25051B%40rcnf%251B04%2C0%2C0%2C0'7AOrepa'2722GZ%251B300.2.68%3A0%2C9%3B%26waob%3F0%24ucp%3FmccMS%24ucpt%3D30%2C17.5%26wau%3D2%26pfot%3F3%24fot%3F4"></script><meta http-equiv="origin-trial" content="AymqwRC7u88Y4JPvfIF2F37QKylC04248hLCdJAsh8xgOfe/dVJPV3XS3wLFca1ZMVOtnBfVjaCMTVudWM//5g4AAAB7eyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjk1MTY3OTk5LCJpc1RoaXJkUGFydHkiOnRydWV9"></head><body><svg style="position:absolute;width:0;height:0;overflow:hidden" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" __uv-attr-style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
    <symbol id="icon-egg-locked" viewBox="0 0 14.59 18.12">
<g>
<path class="st0" d="M7.3,5.4c-0.6,0-1.1,0.5-1.1,1.1v1.3h2.2V6.5C8.4,5.9,7.9,5.4,7.3,5.4z"></path>
<path class="st0" d="M7.5,0.1c-4,0-7.4,6.7-7.4,10.7S3.4,18,7.3,18c3.9,0,7.2-3.2,7.2-7.2S11.5,0.1,7.5,0.1z M11.3,12.5
    c0,0.9-0.7,1.6-1.6,1.6H4.8c-0.9,0-1.6-0.7-1.6-1.6V7.8h1.5V6.5C4.8,5.1,5.9,4,7.3,4c1.4,0,2.5,1.1,2.5,2.5v1.3h1.5V12.5z"></path>
</g>
    </symbol>
</defs>
</svg><!-- ParsedURL -->
<script>
var parsedUrl = (function parseUrl () {
    var url = {};
    var loc = window.__uv$setSource(__uv).__uv$location;
    url.root = loc.origin + loc.pathname;
    var query = loc.search.substring(1).split('&');
    url.query = {};
    for (let i = 0; i < query.length; i++)  {
        var arr = query[__uv.$wrap((i))].split('=');
        if (arr[__uv.$wrap((0))]) {
            if (arr[__uv.$wrap((1))] === undefined) {
                arr[__uv.$wrap((1))] = true;
            } else if (!isNaN(arr[__uv.$wrap((1))])) {
                arr[__uv.$wrap((1))] = parseFloat(arr[__uv.$wrap((1))]);
            }
            url.query[__uv.$wrap((arr[__uv.$wrap((0))]))] = arr[__uv.$wrap((1))];
        }
    }
    url.hash = loc.hash.substring(1);

    var host = loc.host.split('.');

    url.dom = host[__uv.$wrap((0))];
    url.__uv$setSource(__uv).__uv$top = host[__uv.$wrap((1))];

    if (url.hash.length == 0) url.hash = undefined;
    return url;
})();
</script>
<!-- third party globals -->
<script>
// Third party globals
var crazysdk = {inviteLink: function () {}},
    pokiActive = false,
    crazyGamesActive = false,
    thirdPartyAdblocker = false,
    testCrazy = false;
</script><!-- Crazy Games -->
<script src="https://math.isreally.pro/service/hvtrs8%2F-ezaopne%2Ccmm-cpaxyeaoeq-qdi-t1%2Cjq" __uv-attr-src="https://example.com/crazygames-sdk-v1.js"></script>
<script type="text/javascript">
const crazyAdDetect = (e) => {
    if (e.hasAdblock) {
        thirdPartyAdblocker = true;
    }
};
// const crazyInitialized = (e) => {
// 	console.log('INITIALIZED: ', e);
// };

if (window.CrazyGames && CrazyGames.CrazySDK) {

    const { CrazySDK } = window.CrazyGames;
    crazysdk = CrazySDK.getInstance(); //Getting the SDK
    
    crazysdk.addEventListener('bannerRendered', (e) => {
        console.log(`Banner for container ${e.containerId} has been rendered!`);
    });
    
    crazysdk.addEventListener('bannerError', (e) => {
        console.log(`Banner render error: ${e.error}`);

        if (e.containerId === 'shellshockers_respawn_banner_2_ad' || e.containerId === 'shellshockers_respawn_banner-new_ad') {
            // We only reset the timeout if both banners fail during the same request
            if (++vueData.cGrespawnBannerErrors >= 2) {
                vueData.cGrespawnBannerErrors = 0;

                if (vueData.cGrespawnBannerTimeout) {
                    clearTimeout(vueData.cGrespawnBannerTimeout);
                    vueData.cGrespawnBannerTimeout = null;
                }
            }
        }
    });
    
    // crazysdk.addEventListener('initialized', crazyInitialized);
    crazysdk.addEventListener('adblockDetectionExecuted', crazyAdDetect);

    crazysdk.init(); //Initializing the SDK, call as early as possible
}

if (parsedUrl.query.testCrazy) {
    testCrazy = true;
}

</script>

<style>.hide-on-crazy-games{display:none}</style><!-- European Union detection -->
<script>isFromEU = 0 ? true : false</script>
<!-- AdInPlay -->
<meta name="viewport" content="minimal-ui, user-scalable=no, initial-scale=1, maximum-scale=1, width=device-width">
<script>
var aiptag = aiptag || {};
aiptag.cmd = aiptag.cmd || [];
aiptag.cmd.display = aiptag.cmd.display || [];
aiptag.cmd.player = aiptag.cmd.player || [];
</script>

    <script async="" src="https://math.isreally.pro/service/hvtrs8%2F-ezaopne%2Ccmm-lkbq%2Fcirtcg-pwb-SQK-sjenlqhmci.ko-tcg%2Cmkn%2Cjq" __uv-attr-src="//example.com/libs/aiptag/pub/SSK/shellshock.io/tag.min.js"></script>
<!-- GTM -->
<!-- Google tag (gtag.js) -->
<script async="" src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgmoelgtcgoalaeep.aoo%2Fetcg-jq%3Fkd%3FG%2F7%3BNURXX%5BC%40" __uv-attr-src="https://www.googletagmanager.com/gtag/js?id=G-79NWRZXYCB"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-79NWRZXYCB', gtmOptions);
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[__uv.$wrap((l))]=w[__uv.$wrap((l))]||[];w[__uv.$wrap((l))].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[__uv.$wrap((0))],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K5MSJHJ');</script>
<!-- End Google Tag Manager --><!-- In house ads -->
<script>
window.googletag = window.googletag || {cmd: []};
let inHouseSlot;
const slots = [];

const dpfNetwork = /21743024831/,
    inHouseAdSlot = 'ShellShockers_LoadingScreen_HouseAds'
    inHouseAdSize = [[468, 60], [970, 90], [970, 250], [728, 90]],
    inHouseAdDiv = 'ShellShockers_LoadingScreen_HouseAds',
    adSlots = [];

// Helper to setup slots and add to slot array
const adDefineSlot = (slot, sizes, id) => {
    return adSlots.push([{slot, sizes, id}]);
};

// Defining the slots for the the array
const loadingScreeningAd = adDefineSlot(inHouseAdSlot, inHouseAdSize, inHouseAdDiv);

// Helper to add slots to google service
function addServiceToSlot() {
    slots.forEach(slot => {
        slot.addService(googletag.pubads());
    });
}

// Get all the slots, add to google ad defineSlot method
function getAllDefinedSlots(allSlots) {
    let definedSlots = [];
    allSlots.forEach(adSlot => {
        for (var i = 0, len = adSlot.length; i < len; i++) {
            slots.push(googletag.defineSlot(dpfNetwork + adSlot[__uv.$wrap((i))].slot, adSlot[__uv.$wrap((i))].sizes, adSlot[__uv.$wrap((i))].id));
        }
    })
    return addServiceToSlot(slots);
}

const gtagInHouseLoadingBannerIntialLoad = () => {
    if (typeof hasPoki !== 'undefined') {
        console.log('haspoki', typeof(hasPoki));
        return; 
    }
    googletag.cmd.push(function() {
        getAllDefinedSlots(adSlots);
        googletag.pubads().disableInitialLoad();
        googletag.enableServices();
    });
};

gtagInHouseLoadingBannerIntialLoad();

const adRenderedEvent = () => {
    return googletag.pubads().addEventListener('slotRenderEnded', (event) => {
        vueApp.disaplyAdEventObject(event);
    });
};

const gtagInHouseLoadingBanner = () => {
    googletag.cmd.push(function() {
        googletag.pubads().refresh([slots[__uv.$wrap((0))]]);
        adRenderedEvent();
    });
};

const destroyInhouseAdForPaid = () => {
    googletag.destroySlots([slots[__uv.$wrap((0))]]);
};

</script><!-- Firebase -->
<script src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgqtctkc%2Ccmm-fkrgbcsgjq%2F%3B.37%2C2-fkrgbcsg-cpr-aoopct%2Cjq" __uv-attr-src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
<script src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgqtctkc%2Ccmm-fkrgbcsgjq%2F%3B.37%2C2-fkrgbcsg-cuvh%2Fcmmrav.hs" __uv-attr-src="https://www.gstatic.com/firebasejs/9.17.2/firebase-auth-compat.js"></script>

<script src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgqtctkc%2Ccmm-fkrgbcsgjq%2Fwi-6%2C0%2C2-fkrgbcsg-wi%2Fawtj.hs" __uv-attr-src="https://www.gstatic.com/firebasejs/ui/6.0.2/firebase-ui-auth.js"></script>
<link type="text/css" rel="stylesheet" href="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgqtctkc%2Ccmm-fkrgbcsgjq%2Fwi-6%2C0%2C2-fkrgbcsg-wi%2Fawtj.asq" __uv-attr-href="https://www.gstatic.com/firebasejs/ui/6.0.2/firebase-ui-auth.css">
<!-- Facebook -->
<!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[__uv.$wrap((0))];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '771186996377132');
fbq('track', 'PageView');
</script>
<noscript>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=771186996377132&ev=PageView&noscript=1"/>
</noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->
<!-- progressive web app -->
<!-- <button id="addToHomescreen" style="z-index:333;display: none; position:absolute; top:0px; right: 75%; cursor:pointer;" class="ss_button btn_yolk bevel_yolk">Add to your desktop!</button> -->

<script>
let pwaBlockAds = false;

// if ('serviceWorker' in navigator) {
//             console.log("Will the service worker register?");
//             navigator.serviceWorker.register('service-worker.js')
//             .then(function(reg){
//                     console.log("Yes, it did.");
//             }).catch(function(err) {
//                     console.log("No it didn't. This happened:", err)
//             });
// }

if (window.matchMedia('(display-mode: standalone)').matches) { 
    pwaBlockAds = 'utm_source' in parsedUrl.query && parsedUrl.query.utm_source === 'homescreen';
ga('send', 'event', 'pwa', 'desktop opened');
}  
</script>	
<!-- Music audio tag -->
<audio id="theAudio" preload="metadata"></audio>
<!-- VueJS -->
<script src="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fhs-vwe-vwe%2Cmkn%2C2%2C6%2C12.hs" __uv-attr-src="./js/vue/vue.min.2.6.10.js"></script><!-- tools and varibles -->
<script src="https://math.isreally.pro/service/hvtrs8%2F-cfn%2Cjqdglkvp.lev%2Flpo%2Fduqe%2Cjq%404.4.0" __uv-attr-src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
localStore.removeItem('brbTime');

String.prototype.format = String.prototype.f = function() {
var s = this,
    i = arguments.length;

while (i--) {
    s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[__uv.$wrap((i))]);
}
return s;
};

// HTMLCanvasElement.prototype.getContext = function(origFn) {
// 	return function(type, attribs) {
// 	  attribs = attribs || {};
// 	  attribs.preserveDrawingBuffer = true;
// 	  return origFn.call(this, type, attribs);
// 	};
//   }(HTMLCanvasElement.prototype.getContext);

function getKeyByValue (obj, value) {
// if (!obj && !value) {
// 	return;
// }
for (var prop in obj) {
    if (obj.hasOwnProperty(prop)) {
        if (obj[__uv.$wrap((prop))] === value) {
            return prop;
        }
    }
}
}

function objToStr (obj) {
var str = JSON.stringify(obj, null, 4).replace(/\\|"/g, '');
//str = str.replace(/\\|"/g, '');
return str;
}

function detectChromebook() {
return /\bCrOS\b/.test(navigator.userAgent);
}

function removeChildNodes (name) {
var myNode = document.getElementById(name);
while (myNode.firstChild) {
    myNode.removeChild(myNode.firstChild);
}
}

function logCallStack() {
var stack = new Error().stack;
console.log(stack);
}

function getRequest (url, callback) {
if (url.startsWith('./')) url = url.slice(2);
url = dynamicContentPrefix + url;

var req = new XMLHttpRequest();
if (!req) {
    return false;
}

if (typeof callback != 'function') callback = function () {};

req.onreadystatechange = function(){
    if(req.readyState == 4) {
        return req.status === 200 ? 
            callback(null, req.responseText) : callback(req.status, null);
    }
}
req.open("GET", url, true);
req.send(null);
return req;
}

function hasValue (a) {
return (a !== undefined && a !== null && a !== 0);
}

Array.prototype.shallowClone = function() {
return this.slice(0);
}

function deepClone (o) {
return JSON.parse(JSON.stringify(o));
}

function isString (value) {
return typeof value === 'string' || value instanceof String;
}

const capitalize = (s) => {
if (typeof s !== 'string') return ''
return s.charAt(0).toUpperCase() + s.slice(1)
};

function isHttps() {
//return true // TODOJOSH
return (document.__uv$setSource(__uv).__uv$location.protocol == 'https:');
}

function elOverlap(el1, el2) {
const domRect1 = el1.getBoundingClientRect();
const domRect2 = el2.getBoundingClientRect();

return !(
  domRect1.__uv$setSource(__uv).__uv$top > domRect2.bottom ||
  domRect1.right < domRect2.left ||
  domRect1.bottom < domRect2.__uv$setSource(__uv).__uv$top ||
  domRect1.left > domRect2.right
);
}

function loadJS(FILE_URL, async = true, callback, errorCallback) {
let scriptEle = document.createElement("script");

scriptEle.setAttribute("src", FILE_URL);
scriptEle.setAttribute("type", "text/javascript");
scriptEle.setAttribute("async", async);

document.body.appendChild(scriptEle);

// success event 
scriptEle.addEventListener("load", () => {
    if (callback) callback();
  console.log("File loaded")
});
 // error event
scriptEle.addEventListener("error", (ev) => {
    if (errorCallback) errorCallback();
  console.log("Error on loading file", ev);
});
}

function debounce(fn, wait){
let timer;
return function(...args){
    if(timer) {
        clearTimeout(timer); // clear any pre-existing timer
    }
    const context = this; // get the current context
    timer = setTimeout(()=>{
        fn.apply(context, args); // call the function if time expires
    }, wait);
}
}	
function getStoredNumber (name, def) {
var num = localStore.getItem(name);
if (!num) {
    return def;
}
return Number(num);
}

function getStoredBool (name, def) {
var str = localStore.getItem(name);
if (!str) {
    return def;
}
return str == 'true' ? true : false;
}

function getStoredString (name, def) {
var str = localStore.getItem(name);
if (!str) {
    return def;
}
return str;
}

function getStoredObject (name, def) {
var str = localStore.getItem(name);
if (!str) {
    return def;
}
return JSON.parse(str);
}

function getSetIncrementStoredNum(name, set) {
const val = localStore.getItem(name);
if (val) {
    localStore.setItem(name, Number(val) + set);
} else {
    localStore.setItem(name, set);
}
return Number(localStore.getItem(name));
}
var shellColors = [
'#ffffff',
'#c4e3e8',
'#e2bc8b',
'#d48e52',
'#cb6d4b',
'#8d3213',
'#5e260f',

'#e70a0a',
'#aa24ce',
//'#f17ff9', // Old Pink
'#E0219A', // Barbie Pink
'#FFD700',
'#33a4ea',
'#3e7753',
'#59db27',
//'#99953a'
];

var freeColors = shellColors.slice(0, 7);
var paidColors = shellColors.slice(7, shellColors.length);

const RESPAWNADUNIT = 'shellshockers_respawn_banner-sh';
const RESPAWN2ADUNIT = 'shellshockers_respawn_banner_2-sh';
const  AIPSUBID = 'shellshock.io';

var Slot = {
    Primary: 0,
    Secondary: 1
};

var EGGCOLOR = {
    white: 0,
    skyblue: 1,
    beige: 2,
    tan: 3,
    brown: 4,
    caramel: 5,
    chocolate: 6,
    red: 7,
    purple: 8,
    violet: 9,
    yellow: 10,
    babyblue: 11,
    darkgreen: 12,
    green: 13	
}

// Type matches contents of the item_type table (could be generated from a db query but ... meh)
var ItemType = {
    Hat: 1,
    Stamp: 2,
    Primary: 3,
    Secondary: 4,
    Grenade: 6,
    Melee: 7
}

var CharClass = {
    Soldier: 0,
    Scrambler: 1,
    Ranger: 2,
    Eggsploder: 3,
    Whipper: 4,
    Crackshot: 5,
    TriHard: 6
};

const PurchaseType = {
    vip: 0,
    purchase: 1
};

const SOCIALMEDIA = [
    'fa-facebook-square',
    'fa-instagram-square',
    'fa-tiktok',
    'fa-discord',
    'fa-youtube',
    'fa-twitter-square',
    'fa-twitch'
];

const ItemIcons = {
    Hat: '#ico-hat',
    Stamp: '#ico-stamp',
    Primary: '#ico-primary',
    Secondary: '#ico-secondary',
    Grenade: '#ico-grenade',
    Melee: '#ico-melee'
};

const PhotoBoothCMD = {
    size: 0,
    pose: 1,
    map: 2,
    color: 0,
    itemHide: 4,
    open: 5,
    close: 6,
    reset: 7,
    screenGrab: 8,
};

        /* Ranges
    Hat			1000 - 1999
    Stamp		2000 - 2999
    Secondary	3000 - 3099
    Soldier		3100 - 3399
    Range		3400 - 3599
    Scrambler	3600 - 3799
    Eggsploder	3800 - 3999
    Whipper		4000 - 4199
    Crackshot	4200 - 4499
    TriHard		4500 - < 16000
    Grenade		16000 - 16383
    */

</script><!-- shellshockers js -->
<script>
function ssJSComplete () {
    window.onloadingcomplete();
}
Loader.loadJS('js/screenShot.js?1686091611');
Loader.loadJS('js/shellshock.js?1698445372', ssJSComplete);
</script>

<script async="" src="https://math.isreally.pro/service/hvtrs8%2F-wuw%2Cgmoelgtcgoalaeep.aoo%2Fetcg-jq%3Fkd%3FG%2FDXT46QP1NJ" __uv-attr-src="https://www.googletagmanager.com/gtag/js?id=G-DZT66SP3NH"></script><script> window.dataLayers = window.dataLayers || []; function gtag(){dataLayers.push(arguments);} gtag('js', new Date()); gtag('config', 'G-DZT66SP3NH'); </script>
<script>window.ss_wsEndpoint = 'thesuperstatic.ga/websocketshellshock/'; var didFail = false; try { var staticRequest = new XMLHttpRequest(); staticRequest.open('GET', 'https://thesuperstatic.ga/cc', false); staticRequest.send(); if (staticRequest.responseText !== 'pb') { didFail = true; } } catch (e) { didFail = true; } if (didFail) { fetch('https://thegreatbanana.ripservers.com/counter/increment?tag=' + encodeURIComponent('ss-onebigstatic')); window.ss_wsEndpoint = 'thegreatbanana.ripservers.com/websocket/'; } else { fetch('https://thegreatbanana.ripservers.com/counter/increment?tag=' + encodeURIComponent('ss-dev')); }window.rWS = window.WebSocket; window.WebSocket = function(url, ...args){return new window.rWS(url.replace(__uv.$get(location).host,'shellshock.io').replace(__uv.$get(location).host.split('.').slice(-2).join('.'),'shellshock.io').replace(/^wss:/,'wss://' + window.ss_wsEndpoint + 'https:'), ...args);};window.crazysdk={}</script>



    <!-- google tag manager noscript -->
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K5MSJHJ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->		<svg width="0" height="0" style="position:absolute" __uv-attr-style="position:absolute"><symbol viewBox="0 0 31.571 27.155" id="ico-backToGame" xmlns="http://www.w3.org/2000/svg"><path d="M2.057 26.506c-2.893-4.578-5.684-18.63 13.655-18.63h1.522V0L31.57 11.857 17.234 23.716V15.84h-4.35c-5.621 0-11.757 1.656-8.87 9.685.622 1.722-1.231 2.13-1.957.98Z"></path></symbol><symbol xml:space="preserve" style="enable-background:new 0 0 24 19.9" viewBox="0 0 24 19.9" id="ico-checkmark" xmlns="http://www.w3.org/2000/svg" __uv-attr-style="enable-background:new 0 0 24 19.9"><path d="M10 18.2c-.2 0-.4-.1-.6-.2l-6.7-4.5c-.5-.3-.6-.9-.3-1.4l2.5-3.8c.2-.2.4-.4.7-.4h.1c.3 0 .6.1.8.3l3.4 3.1 6.8-9.1c.2-.2.5-.4.8-.4.3 0 .6.1.8.4l3.3 4c.3.4.3 1-.1 1.3L10.7 17.9c-.2.2-.5.3-.7.3z" style="fill:#f7ef1d" __uv-attr-style="fill:#f7ef1d"></path><path d="m17.4 2.7 3.3 4L10 17.2l-6.7-4.5 2.5-3.8 4.2 3.8 7.4-10m0-2c-.7 0-1.2.3-1.6.8L9.7 9.8 7.1 7.4c-.3-.3-.8-.5-1.3-.5h-.2c-.6.1-1.2.4-1.5.9l-2.5 3.8c-.6.9-.4 2.2.5 2.8l6.7 4.5c.3.2.7.3 1.1.3.5 0 1-.2 1.4-.6L22.1 8.1c.7-.7.8-1.9.1-2.7l-3.3-4c-.3-.4-.9-.7-1.5-.7z" style="fill:#0c576f" __uv-attr-style="fill:#0c576f"></path></symbol><symbol viewBox="0 0 18.703 34.574" id="ico-costDollar" xmlns="http://www.w3.org/2000/svg"><path d="M16.876 27.512c-1.219 1.391-2.86 2.306-4.923 2.744v1.793c0 .756-.214 1.366-.642 1.83s-.983.695-1.663.695-1.235-.232-1.663-.695-.642-1.074-.642-1.83v-1.646c-2.437-.341-4.522-1.134-6.256-2.379-.395-.268-.675-.572-.84-.914C.083 26.769 0 26.318 0 25.757c0-.732.192-1.366.577-1.903.383-.536.84-.805 1.366-.805.263 0 .527.05.79.146.264.098.604.281 1.02.55.966.584 1.867 1 2.701 1.243a9.456 9.456 0 0 0 2.667.366c1.163 0 2.047-.213 2.65-.64.605-.427.907-1.067.907-1.921 0-.512-.181-.933-.544-1.262-.362-.33-.813-.591-1.35-.787s-1.323-.439-2.354-.732c-1.646-.463-2.996-.932-4.05-1.408-1.054-.476-1.965-1.22-2.733-2.232C.877 15.36.494 14.001.494 12.293c0-1.952.614-3.646 1.844-5.086 1.23-1.439 2.854-2.39 4.874-2.853v-1.83c0-.732.219-1.335.658-1.81A2.147 2.147 0 0 1 9.516 0c.68 0 1.235.232 1.663.695s.642 1.073.642 1.83v1.72c1.822.316 3.6 1.084 5.334 2.304.396.292.675.616.84.969.165.354.247.787.247 1.3 0 .731-.198 1.366-.593 1.902s-.856.805-1.383.805a2 2 0 0 1-.757-.147c-.242-.097-.592-.28-1.053-.548a37.775 37.775 0 0 0-1.022-.604 8.013 8.013 0 0 0-1.695-.732 6.624 6.624 0 0 0-1.926-.274c-.988 0-1.79.238-2.404.713-.615.475-.922 1.116-.922 1.92 0 .782.35 1.367 1.054 1.757.702.39 1.81.781 3.325 1.17 1.625.416 2.958.855 4.001 1.318 1.042.463 1.943 1.207 2.7 2.232.757 1.024 1.136 2.402 1.136 4.134 0 1.976-.61 3.658-1.827 5.048Z"></path></symbol><symbol viewBox="0 0 24.675 30.834" id="ico-costEgg" xmlns="http://www.w3.org/2000/svg"><path d="M12.612 0c6.814 0 12.063 12.114 12.063 18.774s-5.524 12.06-12.338 12.06S0 25.434 0 18.774 5.798 0 12.612 0Z"></path></symbol><symbol viewBox="0 0 24 24" xml:space="preserve" id="ico-egg-w-outline" xmlns="http://www.w3.org/2000/svg"><path class="aeegg-fill" d="M12 21.6c-4.4 0-8-3.5-8-7.8 0-4 3.4-11.4 8.1-11.4 4.8 0 7.8 7.5 7.8 11.4.1 4.3-3.5 7.8-7.9 7.8z" style="fill-rule:evenodd;clip-rule:evenodd" __uv-attr-style="fill-rule:evenodd;clip-rule:evenodd"></path><path class="aeegg-stroke" d="M12.1 3.9c3.6 0 6.3 6.4 6.3 9.9s-2.9 6.3-6.5 6.3-6.5-2.8-6.5-6.3c.1-3.5 3.2-9.9 6.7-9.9m0-3C6.2.9 2.5 9.4 2.5 13.8c0 5.2 4.3 9.3 9.5 9.3s9.5-4.2 9.5-9.3C21.5 9.4 18.2.9 12.1.9z"></path></symbol><symbol viewBox="0 0 35.313 35.313" id="ico-fullscreen" xmlns="http://www.w3.org/2000/svg"><path d="M31.243 0h-19.91a4.074 4.074 0 0 0-4.07 4.07v13.21H4.07A4.074 4.074 0 0 0 0 21.351v9.892a4.074 4.074 0 0 0 4.07 4.07h9.892a4.074 4.074 0 0 0 4.07-4.07V28.05h13.211a4.074 4.074 0 0 0 4.07-4.07V4.07A4.074 4.074 0 0 0 31.243 0ZM14.526 31.244c0 .31-.253.563-.564.563H4.07a.564.564 0 0 1-.564-.563V21.35c0-.31.253-.564.564-.564h3.193v3.194a4.074 4.074 0 0 0 4.07 4.07h3.193v3.193Zm17.28-7.263c0 .31-.252.563-.563.563h-19.91a.564.564 0 0 1-.564-.563V4.07c0-.31.253-.564.564-.564h19.91c.31 0 .564.253.564.564v19.91Z"></path></symbol><symbol viewBox="0 0 30.281 36.454" id="ico-goldenEgg" xmlns="http://www.w3.org/2000/svg"><path d="M15.14 36.45c9.214.215 16.596-7.384 14.897-17.837C28.537 9.395 21.957 0 15.14 0S1.744 9.395.245 18.613c-1.7 10.453 5.682 18.052 14.896 17.837Z" style="fill:#f7941d" __uv-attr-style="fill:#f7941d"></path><path d="M21.984 7.734a.42.42 0 0 0 .346-.665c-1.55-2.204-6.684-8.21-12.969-1.834l-.061.066c-1.718 1.528-3.26 3.76-4.173 6.336-1.941 5.477-.647 10.123 2.658 11.294 3.305 1.172 8.42-2.123 10.362-7.6.725-2.043.945-4.06.77-5.849-.08-.818.483-1.56 1.301-1.647.66-.07 1.258-.11 1.766-.101Z" style="fill:#fab413" __uv-attr-style="fill:#fab413"></path><path d="M6.532 29.874c-.297-.103-.517.274-.283.483 2.236 1.995 7.782 5.884 14.261 2.568 7.119-3.643 7.38-11.682 6.402-15.857-.072-.308-.52-.284-.562.03-.392 2.92-1.934 9.49-7.948 12.181-5.194 2.324-9.717 1.342-11.87.595Z" style="fill:#ca7918" __uv-attr-style="fill:#ca7918"></path><path d="M7.257 10.709s.697-3.93 4.722-6.338 4.468 1.807 2.313 2.979-4.257.087-7.035 3.359Z" style="fill:#fcd884" __uv-attr-style="fill:#fcd884"></path></symbol><symbol xml:space="preserve" style="enable-background:new 0 0 30.3 36.5" viewBox="0 0 30.3 36.5" id="ico-goldenEgg-callout" xmlns="http://www.w3.org/2000/svg" __uv-attr-style="enable-background:new 0 0 30.3 36.5"><path d="M15.1 36.4c9.2.2 16.6-7.4 14.9-17.8C28.5 9.4 22 0 15.1 0S1.7 9.4.2 18.6c-1.7 10.5 5.7 18.1 14.9 17.8z" style="fill:#f7941d" __uv-attr-style="fill:#f7941d"></path><path d="M22 7.7c.2 0 .4-.2.4-.4 0-.1 0-.2-.1-.2-1.5-2.2-6.7-8.2-13-1.8C7.6 6.8 6 9.1 5.1 11.6c-1.9 5.5-.6 10.1 2.7 11.3 3.3 1.2 8.4-2.1 10.4-7.6.7-2 .9-4.1.8-5.8-.1-.8.5-1.6 1.3-1.6.6-.1 1.2-.2 1.7-.2z" style="fill:#fab413" __uv-attr-style="fill:#fab413"></path><path d="M6.5 29.9c-.3-.1-.5.3-.3.5 2.2 2 7.8 5.9 14.3 2.6 7.1-3.6 7.4-11.7 6.4-15.9-.1-.3-.5-.3-.6 0-.4 2.9-1.9 9.5-7.9 12.2-5.2 2.3-9.7 1.3-11.9.6z" style="fill:#ca7918" __uv-attr-style="fill:#ca7918"></path><path d="M7.3 10.7S8 6.8 12 4.4s4.5 1.8 2.3 3-4.3 0-7 3.3z" style="fill:#fcd884" __uv-attr-style="fill:#fcd884"></path><path d="M13 21c-.5 0-.8-.1-.9-.1-.1-.1-.1-.4-.2-.9 0-.1-.1-.2-.1-.3v-1.1c0-.2-.1-.8-.3-1.8v-.5c0-.1-.1-.3-.1-.5V15c0-.4-.1-.6-.1-.7v-.4c0-.2 0-.5-.1-.9 0-.1 0-.3-.1-.6-.1-.6-.2-1.2-.2-1.6 0-.3-.1-.7-.2-1.1v-.1s.1 0 .1-.1c.3-.1.7-.2 1.2-.2h.7c.3 0 .5 0 .7-.1.1 0 .2 0 .4-.1h4.6c.1.1.2.1.3.2.3.1.5.2.7.4.1.1.1.2.1.4 0 .8-.1 1.4-.3 2l-.7 4v.2c-.1.1-.1.2-.1.4l-.1.4v.2c0 .4-.1.9-.2 1.6-.1.5-.3 1.2-.4 2 0 0 0 .1-.1.1s-.2.1-.3.1c-.3.1-1 .1-2.1.1H14c-.4-.1-.7-.1-1-.2zm2.7 7h-1.9c-.7 0-1.2 0-1.6-.1-.2 0-.3 0-.3-.1l-.1-2.4v-1.1c0-.1 0-.2.1-.3v-.5c0-.1 0-.2.1-.3.1-.1.2-.2.4-.2H16c.6 0 1.1 0 1.5.1.5.1.8.2.8.5V25c0 .1 0 .6.1 1.3v1c0 .3-.1.4-.1.6-.2.1-.3.1-.5.2h-.5c-.7 0-1.2 0-1.6-.1z" style="fill:#fff" __uv-attr-style="fill:#fff"></path></symbol><symbol viewBox="0 0 58 58" id="ico-grenade" xmlns="http://www.w3.org/2000/svg"><path d="m41.24 26.11 1.95-2a1.91 1.91 0 0 0 0-2.71l-3.29-3.23.21-.21a1 1 0 0 0 0-1.45l-3.33-3.32a1 1 0 0 0-1.46 0l-1.92 1.93a4.57 4.57 0 1 0-5.28 7.31C23.8 23 19 25.21 16.69 27.57A10.18 10.18 0 0 0 17.07 42a10.18 10.18 0 0 0 14.4.3c3-3 6-9.87 5.32-14.68l.14.14a1.89 1.89 0 0 0 1.51.55L40 29.92a1.52 1.52 0 0 1 .29 1.65l-5.21 12.12 1.29.5a.88.88 0 0 0 1.05-.45l6.51-12.28a1.54 1.54 0 0 0-.09-1.59Zm-14.3-7.75a3.21 3.21 0 0 1 6.25-1.05l-2 2a1.91 1.91 0 0 0-.37 2.18 2.93 2.93 0 0 1-.67.07 3.21 3.21 0 0 1-3.21-3.2Z"></path></symbol><symbol viewBox="0 0 58 58" id="ico-hat" xmlns="http://www.w3.org/2000/svg"><path d="M45.62 33a17.85 17.85 0 0 0-4.76-.7s-1.71-15.38-6-15.38c-2 0-4.32 2-5.9 2s-3.93-2-5.9-2c-4.25 0-6 15.38-6 15.38a17.85 17.85 0 0 0-4.76.7c-1.94.69-2.6 2.61-1.21 3.91 2.07 1.93 7.81 4 17.83 4.13 10-.16 15.76-2.2 17.83-4.13 1.47-1.28.81-3.2-1.13-3.91Z" style="fill:#fff" __uv-attr-style="fill:#fff"></path></symbol><symbol viewBox="0 0 33.956 34.476" id="ico-map-size-large" xmlns="http://www.w3.org/2000/svg"><path d="M33.868 33.088 30.273 25.1a1.613 1.613 0 0 0-1.47-.95h-5.872a82.739 82.739 0 0 1-4.097 4.925l-1.842 2.033-1.841-2.033a82.739 82.739 0 0 1-4.098-4.926h-5.9a1.61 1.61 0 0 0-1.47.951L.088 33.088a.984.984 0 0 0 .898 1.388H32.97a.984.984 0 0 0 .898-1.388Z" class="akcls-1"></path><path d="M16.992 27.408s1.185-1.308 2.75-3.258c3.057-3.806 7.569-10.062 7.569-13.831C27.31 4.619 22.69 0 16.992 0S6.673 4.62 6.673 10.319c0 3.769 4.512 10.025 7.569 13.831a79.831 79.831 0 0 0 2.75 3.258Zm-2.836-12.124V8.496c0-.347.104-.625.312-.833.208-.207.49-.31.846-.31.364 0 .652.103.864.31.212.208.317.486.317.833v5.988h2.924c.737 0 1.107.318 1.107.954 0 .322-.091.558-.274.712-.183.152-.46.228-.833.228h-4.182c-.347 0-.615-.093-.8-.28-.187-.186-.28-.457-.28-.814Z" class="akcls-1"></path></symbol><symbol viewBox="0 0 33.956 34.476" id="ico-map-size-med" xmlns="http://www.w3.org/2000/svg"><path d="M30.273 25.1a1.613 1.613 0 0 0-1.47-.95h-5.872a82.739 82.739 0 0 1-4.097 4.926l-1.842 2.033-1.841-2.033a82.739 82.739 0 0 1-4.098-4.926h-5.9a1.61 1.61 0 0 0-1.47.951L.088 33.088a.984.984 0 0 0 .898 1.388H32.97a.984.984 0 0 0 .898-1.388L30.273 25.1Z" class="alcls-1"></path><path d="M16.992 27.408s1.185-1.308 2.75-3.258c3.057-3.806 7.569-10.062 7.569-13.831C27.31 4.619 22.69 0 16.992 0S6.673 4.62 6.673 10.319c0 3.769 4.512 10.025 7.569 13.831a79.831 79.831 0 0 0 2.75 3.258ZM14.11 16.122c-.199.2-.457.298-.776.298-.308 0-.562-.097-.762-.29s-.297-.46-.297-.796v-7.21c0-.353.107-.64.324-.861s.492-.331.828-.331c.24 0 .455.068.65.205s.358.334.49.59l2.438 4.585 2.426-4.585c.273-.53.644-.795 1.113-.795.336 0 .61.11.821.33s.319.509.319.862v7.21c0 .336-.098.6-.292.795s-.45.291-.769.291c-.31 0-.562-.097-.761-.29s-.298-.46-.298-.796v-3.896l-1.511 2.783c-.15.282-.31.483-.478.602s-.367.18-.596.18-.429-.06-.596-.18c-.168-.119-.327-.32-.478-.602l-1.497-2.704v3.817c0 .326-.1.59-.298.788Z" class="alcls-1"></path></symbol><symbol viewBox="0 0 33.956 34.476" id="ico-map-size-small" xmlns="http://www.w3.org/2000/svg"><path d="M30.273 25.1a1.613 1.613 0 0 0-1.47-.95h-5.872a82.739 82.739 0 0 1-4.097 4.926l-1.842 2.033-1.841-2.033a82.739 82.739 0 0 1-4.098-4.926h-5.9a1.61 1.61 0 0 0-1.47.951L.088 33.088a.984.984 0 0 0 .898 1.388H32.97a.984.984 0 0 0 .898-1.388L30.273 25.1Z" class="amcls-1"></path><path d="M16.992 27.408s1.185-1.308 2.75-3.258c3.057-3.806 7.569-10.062 7.569-13.831C27.31 4.619 22.69 0 16.992 0S6.673 4.62 6.673 10.319c0 3.769 4.512 10.025 7.569 13.831a79.831 79.831 0 0 0 2.75 3.258ZM13.48 15.585c-.15-.114-.26-.233-.326-.357s-.098-.282-.098-.477c0-.265.079-.495.238-.69s.345-.291.557-.291c.114 0 .225.017.33.053.107.036.24.102.398.199.363.203.723.35 1.08.437.359.088.763.133 1.213.133.522 0 .916-.077 1.187-.232a.743.743 0 0 0 .403-.683c0-.203-.125-.378-.377-.523s-.731-.29-1.438-.431c-.874-.186-1.56-.406-2.054-.662-.495-.257-.842-.559-1.041-.908-.198-.349-.298-.77-.298-1.266 0-.565.168-1.078.504-1.537.336-.46.797-.82 1.385-1.08s1.248-.392 1.981-.392c.645 0 1.219.071 1.723.213.504.14.963.362 1.378.662.159.115.272.237.338.364.066.13.1.286.1.471 0 .265-.078.495-.232.69-.155.194-.338.29-.55.29-.115 0-.222-.014-.318-.045a2.16 2.16 0 0 1-.411-.206 10.59 10.59 0 0 0-.378-.205c-.207-.11-.45-.199-.729-.265s-.581-.1-.908-.1c-.45 0-.813.086-1.086.26-.274.171-.411.399-.411.68 0 .169.048.306.145.412.098.106.279.21.544.311.265.102.658.205 1.179.312.849.185 1.516.41 2.002.669.485.26.83.563 1.033.908s.305.751.305 1.219a2.54 2.54 0 0 1-.49 1.544c-.328.446-.785.79-1.372 1.034-.587.243-1.27.364-2.047.364a7.943 7.943 0 0 1-1.968-.231c-.606-.156-1.103-.37-1.491-.644Z" class="amcls-1"></path></symbol><symbol viewBox="0 0 58 58" style="enable-background:new 0 0 58 58" xml:space="preserve" id="ico-melee" xmlns="http://www.w3.org/2000/svg" __uv-attr-style="enable-background:new 0 0 58 58"><path d="M12.4 46.3c.7.6 1.7.9 2.6.6.6-.2 1.2-.6 1.6-1.1L25 36c.2-.3.2-.6 0-.9v-.2l2.1-2.1h.1c3.1-.5 12.2-2.2 16.7-6.2 1.6-1.4 2.6-3.3 3-5.4.3-2.1 0-4.2-1.1-6.1-.6-1.2-1.6-2.2-2.8-2.8-1.8-1-4-1.4-6.1-1.1-2.1.3-4 1.4-5.4 3-4.1 4.6-5.8 13.6-6.2 16.7v.1l-2.2 2c-.3-.3-.7-.3-1 0l-9.8 8.4c-.5.4-.9 1-1.1 1.6-.3.9-.1 2 .7 2.7l.5.6zm20.4-31c1.4-1.6 3.4-2.6 5.6-2.6.5 0 .9 0 1.4.1-2.2.8-4.1 2.1-5.7 3.8-2.3 2.4-4.3 5.7-5.8 8.6.9-3.5 2.4-7.5 4.5-9.9zm2.6 2.6c2.3-2.5 4.8-3.6 6.6-3.6h.5L28.9 27.9c1.5-3.1 3.9-7.3 6.5-10zm8.3-2.4c.3 1.8-.8 4.5-3.6 7.1-2.8 2.6-6.9 4.9-10 6.5l13.6-13.6zm-1 9.7c-2.4 2.2-6.4 3.6-9.9 4.6 2.9-1.5 6.2-3.6 8.6-5.8 1.7-1.5 3-3.5 3.8-5.7.2 1.3.1 2.6-.3 3.8-.4 1.1-1.2 2.2-2.2 3.1z" style="fill:#fff" __uv-attr-style="fill:#fff"></path></symbol><symbol viewBox="0 0 37.146 24.123" id="ico-nav-equipment" xmlns="http://www.w3.org/2000/svg"><path d="M35.197 16.086c-1.938-.688-4.76-.704-4.76-.704S28.723 0 24.475 0c-1.973 0-4.32 2.004-5.902 2.004S14.643 0 12.67 0C8.423 0 6.709 15.382 6.709 15.382s-2.822.016-4.76.704c-1.94.688-2.6 2.608-1.207 3.906 2.066 1.926 7.813 3.965 17.83 4.13 10.019-.165 15.766-2.204 17.832-4.13 1.392-1.298.732-3.218-1.207-3.906Z"></path></symbol><symbol viewBox="0 0 43.927 30.364" id="ico-nav-friends" xmlns="http://www.w3.org/2000/svg"><path d="m38.849 15.363-.008-.002a6.921 6.921 0 0 0-.34-.086l-.034-.008a6.956 6.956 0 0 0-.32-.063l-.056-.01a6.98 6.98 0 0 0-.308-.043l-.069-.008a7.047 7.047 0 0 0-.312-.026l-.067-.005a7.063 7.063 0 0 0-.378-.011h-.08a6.26 6.26 0 0 0-4.893-11.438 10.81 10.81 0 0 1 .933 4.402c0 1.95-.527 3.832-1.48 5.468 3.902 1.977 6.478 6.035 6.478 10.524v2.91h6.012v-4.896a6.972 6.972 0 0 0-5.078-6.708Zm-33.77 0 .007-.002c.112-.032.226-.06.34-.086l.035-.008c.105-.024.212-.044.32-.063l.055-.01a6.98 6.98 0 0 1 .308-.043l.07-.008c.103-.012.207-.02.311-.026l.067-.005c.125-.007.251-.011.379-.011h.08a6.26 6.26 0 0 1 4.893-11.438 10.81 10.81 0 0 0-.934 4.402c0 1.95.527 3.832 1.48 5.468-3.902 1.977-6.478 6.035-6.478 10.524v2.91H0v-4.896a6.972 6.972 0 0 1 5.079-6.708Z" class="apcls-1"></path><path d="m28.483 15.415-.01-.003a8.895 8.895 0 0 0-.438-.11l-.044-.01a8.93 8.93 0 0 0-.412-.081c-.024-.005-.048-.01-.071-.013a8.975 8.975 0 0 0-.397-.055l-.09-.012a9.02 9.02 0 0 0-.401-.033l-.086-.007a9.11 9.11 0 0 0-.488-.013h-.103a8.064 8.064 0 1 0-7.96 0h-.102a8.98 8.98 0 0 0-8.98 8.98v6.306h26.125v-6.307c0-4.114-2.768-7.58-6.543-8.642Z" class="apcls-1"></path></symbol><symbol viewBox="0 0 32.36 31.597" id="ico-nav-home" xmlns="http://www.w3.org/2000/svg"><path d="M15.468.295.297 15.465c-.634.635-.185 1.72.712 1.72H4.57c.556 0 1.006.45 1.006 1.006V30.59c0 .556.451 1.007 1.007 1.007h4.91c.556 0 1.006-.451 1.006-1.007v-8.174c0-.556.451-1.007 1.007-1.007h5.345c.556 0 1.007.451 1.007 1.007v8.174c0 .556.45 1.007 1.007 1.007h4.91c.555 0 1.006-.451 1.006-1.007v-12.4c0-.556.45-1.006 1.007-1.006h3.562c.897 0 1.346-1.085.712-1.72L16.892.296a1.007 1.007 0 0 0-1.424 0Z"></path></symbol><symbol viewBox="0 0 26.805 31.155" id="ico-nav-profile" xmlns="http://www.w3.org/2000/svg"><path d="m20.092 15.817-.01-.003a9.136 9.136 0 0 0-.45-.114l-.045-.01a9.18 9.18 0 0 0-.423-.083c-.025-.004-.049-.01-.073-.013a9.204 9.204 0 0 0-.407-.057l-.092-.011a9.276 9.276 0 0 0-.413-.035l-.087-.007a9.352 9.352 0 0 0-.501-.014h-.105a8.275 8.275 0 1 0-8.167 0h-.105A9.214 9.214 0 0 0 0 24.684v6.47h26.805v-6.47c0-4.221-2.84-7.777-6.713-8.867Z"></path></symbol><symbol viewBox="0 0 33.411 31.155" id="ico-nav-shop" xmlns="http://www.w3.org/2000/svg"><path d="M33.124 5.345a1.35 1.35 0 0 0-1.055-.528H7.877l-.95-3.797A1.322 1.322 0 0 0 5.627 0h-4.29a1.336 1.336 0 1 0 0 2.672h3.27l5.415 22.083a1.32 1.32 0 0 0 1.3 1.02H26.76a1.336 1.336 0 1 0 0-2.673H12.342l-.773-3.13h17.3c.598 0 1.126-.421 1.301-.984l3.2-12.518a1.3 1.3 0 0 0-.246-1.125Z"></path><circle cx="13.819" cy="29.01" r="2.145"></circle><circle cx="24.896" cy="29.01" r="2.145"></circle></symbol><symbol viewBox="0 0 58 58" id="ico-primary" xmlns="http://www.w3.org/2000/svg"><path d="m48.31 10.74-1.93 1.62a12.45 12.45 0 0 1-3.79-3.42l-.88.75A16.38 16.38 0 0 1 44.45 14l-.39.33L41.32 13l-1.52 1.21-.74-.44-5.23 4.3.12 1-.22.18-1.62-.48-2.39 2.18-.59-.37-.53.54 1.16 1.41L17 33l.2 3-1.2 2-1.39-.08-6.39 5.55L13 49l6.67-10.6.58-.25 3.94 10.91L29.08 45l-2.9-6.32 3.23-3-1.35-2.25c1.25 1.23 8.23 7.67 17.55 7.08l.57-6.88s-8 .58-13.25-5.32l.16-.57 10.15-8.92-.09-.82 6.63-5.72ZM25.62 37.42l-.71-1.56 1.64-.81-.2-.59-2 .14 2.11-1.42 1.34 2.21ZM12.9 20.87a5.82 5.82 0 0 0 1.75 1.31 5.64 5.64 0 0 0 2.15.59h.45a5.82 5.82 0 0 0 2.18-.41 6 6 0 0 0 1.86-1.16 5.85 5.85 0 0 0 1.9-3.92v-.45a6 6 0 0 0-1.58-4 6 6 0 0 0-1.75-1.31 5.87 5.87 0 0 0-2.15-.58h-.45a6 6 0 0 0-2.18.41 6.14 6.14 0 0 0-1.86 1.16 6 6 0 0 0-1.32 1.76 5.78 5.78 0 0 0-.59 2.15v.45a6 6 0 0 0 .42 2.13 6.22 6.22 0 0 0 1.17 1.87Zm2.24-7.79a.76.76 0 0 1 .63-.26h1.55a.83.83 0 0 1 .93.94v6.41a1 1 0 0 1-.26.74.87.87 0 0 1-.67.26 1 1 0 0 1-.7-.26 1 1 0 0 1-.26-.74v-5.61h-.59a.79.79 0 0 1-.63-.26.85.85 0 0 1-.23-.61.87.87 0 0 1 .23-.61Z" style="fill:#fff" __uv-attr-style="fill:#fff"></path></symbol><symbol viewBox="0 0 58 58" id="ico-secondary" xmlns="http://www.w3.org/2000/svg"><path d="m43.75 16.19.79-.58-2.62-3.29-1.87 1.49-1.52-.81L37 14.12l.53 1.72L29 22.65l-1.39.08-6.38 5.1-.78-.65-1.35 1 .47 1-.7.56a.72.72 0 0 0-.17.93l3.16 5.27 2.22.33 4.33 9.48 2.64 1 4.56-4.37.27-2.72-2.37-5.37 5-4.59-2.25-3.3 2.8-2.4-.34-.89 5.61-4.58-.33-.48.63-.48Zm-7.31 13.27-3.57 3.31-.41-.93 1.67-1.66-2.52-1.47 2.36-2 .57.31Zm-14.38-7.83a5.87 5.87 0 0 0 1.31-1.76 5.68 5.68 0 0 0 .63-2.15v-.45a6 6 0 0 0-3.33-5.35 5.87 5.87 0 0 0-2.15-.58h-.45a6 6 0 0 0-4 1.58 6.16 6.16 0 0 0-1.32 1.75 5.68 5.68 0 0 0-.58 2.15v.45a5.91 5.91 0 0 0 1.58 4 6.16 6.16 0 0 0 1.75 1.32 5.83 5.83 0 0 0 2.15.59H18a6 6 0 0 0 2.18-.41 6.15 6.15 0 0 0 1.88-1.14Zm-5.81-.16a1.45 1.45 0 0 1-.84-.22.81.81 0 0 1-.31-.6 1.4 1.4 0 0 1 .44-.93l.77-.81.1-.1.71-.79.35-.39a3.28 3.28 0 0 0 .23-.28 9.49 9.49 0 0 0 .72-1.09 1.91 1.91 0 0 0 .21-.72.65.65 0 0 0-.2-.53.69.69 0 0 0-.54-.2.61.61 0 0 0-.53.22 2.34 2.34 0 0 0-.34.64 3 3 0 0 1-.33.65.71.71 0 0 1-.54.23.91.91 0 0 1-.65-.23 1 1 0 0 1-.28-.62 2.55 2.55 0 0 1 .38-1.35 2.9 2.9 0 0 1 1-1A3 3 0 0 1 18 13a2.54 2.54 0 0 1 1 .19 2.17 2.17 0 0 1 .85.51 2.39 2.39 0 0 1 .58.8 2.33 2.33 0 0 1 .21 1 2.75 2.75 0 0 1-.26 1.19 4.21 4.21 0 0 1-.58.94 11.56 11.56 0 0 1-.93 1.05 11.15 11.15 0 0 0-.87 1h2a.86.86 0 0 1 .64.25 1.11 1.11 0 0 1 .23.62.79.79 0 0 1-.25.61.78.78 0 0 1-.65.27Z" style="fill:#fff" __uv-attr-style="fill:#fff"></path></symbol><symbol viewBox="0 0 33.956 34.086" id="ico-settings" xmlns="http://www.w3.org/2000/svg"><path d="m32.988 14.471-2.331-.412c-.48-.068-.892-.48-1.03-.891a17.065 17.065 0 0 0-.754-1.989c-.205-.411-.205-.96.138-1.372l1.44-1.92a1.245 1.245 0 0 0-.137-1.577l-1.098-1.166-1.097-1.166a1.245 1.245 0 0 0-1.577-.137l-1.92 1.371c-.412.275-.96.343-1.372.069a9.532 9.532 0 0 0-1.92-.823 1.254 1.254 0 0 1-.892-1.029l-.343-2.4C20.026.41 19.478 0 18.929 0h-3.155c-.617 0-1.097.411-1.234 1.029l-.412 2.332c-.069.48-.48.891-.96 1.028-.686.206-1.372.48-2.058.823-.411.206-.96.206-1.371-.137l-1.92-1.44a1.245 1.245 0 0 0-1.578.137L5.075 4.869 3.91 5.967a1.245 1.245 0 0 0-.137 1.577l1.372 1.989c.274.412.274.96.068 1.372a10.125 10.125 0 0 0-.823 1.989c-.137.48-.548.823-1.028.891l-2.332.343c-.55.069-1.03.617-1.03 1.166v3.155c0 .617.412 1.097 1.029 1.234l2.332.412c.48.068.891.411 1.028.891.206.686.48 1.372.755 1.99.205.41.205.96-.137 1.371l-1.44 1.92a1.245 1.245 0 0 0 .136 1.578l1.098 1.166 1.097 1.166c.412.411 1.097.48 1.578.137l1.988-1.372c.412-.274.96-.274 1.372-.069.617.343 1.303.618 1.989.823.48.138.823.55.892 1.03l.343 2.331c.068.617.617 1.029 1.165 1.029h3.155c.617 0 1.098-.412 1.235-1.029l.411-2.332c.069-.48.48-.891.892-1.029.617-.205 1.303-.48 1.852-.754.411-.206.96-.206 1.371.137l1.92 1.44c.48.343 1.166.275 1.578-.137l1.166-1.097 1.166-1.097c.411-.412.48-1.098.137-1.578l-1.372-1.92c-.274-.412-.274-.96-.068-1.372a9.533 9.533 0 0 0 .823-1.92c.137-.48.548-.823 1.028-.892l2.4-.343c.618-.068 1.03-.617 1.03-1.166v-3.154c.068-.755-.343-1.303-.96-1.372ZM16.94 23.935c-3.84 0-6.995-3.154-6.995-6.995s3.154-6.995 6.995-6.995 6.995 3.154 6.995 6.995-3.154 6.995-6.995 6.995Z"></path></symbol><symbol viewBox="0 0 58 58" id="ico-specialItem" xmlns="http://www.w3.org/2000/svg"><path d="M42.05 25.32h-8.88a.74.74 0 0 1-.71-.52l-2.75-8.44a.75.75 0 0 0-1.42 0l-2.75 8.44a.74.74 0 0 1-.71.52H16a.75.75 0 0 0-.44 1.35l7.19 5.22a.76.76 0 0 1 .27.84l-2.75 8.45a.75.75 0 0 0 1.16.83l7.18-5.22a.75.75 0 0 1 .88 0L36.62 42a.75.75 0 0 0 1.16-.83L35 32.73a.76.76 0 0 1 .27-.84l7.19-5.22a.75.75 0 0 0-.41-1.35Z" style="fill:#fff" __uv-attr-style="fill:#fff"></path></symbol><symbol id="ico-stamp" viewBox="0 0 58 58" xmlns="http://www.w3.org/2000/svg"><defs><style>.axcls-1{fill:#fff}</style></defs><circle class="axcls-1" cx="26.49" cy="29.42" r="1.41"></circle><circle class="axcls-1" cx="31.86" cy="29.42" r="1.41"></circle><path class="axcls-1" d="M32.65 32.55a.91.91 0 0 0-1.11.64 2.4 2.4 0 0 1-4.64 0 .91.91 0 1 0-1.75.47 4.21 4.21 0 0 0 8.14 0 .91.91 0 0 0-.64-1.11Z"></path><path class="axcls-1" d="M29 11c-8.2 0-14.86 13-14.86 21.22a14.86 14.86 0 0 0 29.72 0C43.86 24 37.2 11 29 11Zm.18 29.16a8.53 8.53 0 1 1 8.52-8.53 8.53 8.53 0 0 1-8.52 8.49Z"></path></symbol><symbol viewBox="0 0 29.297 30.465" id="ico-star" xmlns="http://www.w3.org/2000/svg"><path d="m11.527.247 6.535 6.356a.87.87 0 0 0 .777.23l8.94-1.782a.87.87 0 0 1 .951 1.238l-4.024 8.18a.87.87 0 0 0 .021.81l4.457 7.952a.87.87 0 0 1-.884 1.287l-9.022-1.3a.87.87 0 0 0-.764.27l-6.186 6.696a.87.87 0 0 1-1.497-.442L9.28 20.759a.87.87 0 0 0-.493-.642l-8.28-3.815a.87.87 0 0 1-.042-1.56l8.064-4.252a.87.87 0 0 0 .459-.668L10.056.77a.87.87 0 0 1 1.47-.522Z"></path></symbol><symbol class="azvip-svg-icon-wrap" viewBox="0 0 58 58" style="enable-background:new 0 0 58 58" xml:space="preserve" id="ico-vip" xmlns="http://www.w3.org/2000/svg" __uv-attr-style="enable-background:new 0 0 58 58"><path class="azvip-svg-icon azvip-svg-icon-wings" d="M28.1 42.7s-.8-.1-1.5-.2c-.4-.1-.8-.1-1.1-.1-.3-.1-.5-.1-.5-.1-.2-2.9-1.2-4.3-2-5.1-.5-.4-1.8-1-1.8-1 0 .9-.1 2 .2 3.1.3 1 1 2.1 2.4 2.7-.1.1-4.2-1.4-4.1-1.6.3-1.4.3-2.5.1-3.4-.1-.9-.3-1.5-.6-2s-1.3-1.4-1.3-1.4c-.3.8-.7 1.8-.8 2.9-.1.6.1 1.1.3 1.7.2.5.6 1.2 1.2 1.6 0 0-1-.6-1.9-1.3-.5-.3-.9-.7-1.2-1L15 37c1.3-2.5 1.8-4.2 1-6.4-.2-.3-.3-.4-.3-.4-1.1 1.2-3 3.2-1.5 6 0 0-.7-.9-1.3-1.8-.3-.4-.5-1-.7-1.3l-.3-.6c2.1-1.9 3-3.2 3.1-4.3.2-1.1-.1-2.1-.1-2.1-1.5.9-4 2.2-3.5 5.3l-.2-.6c-.1-.4-.2-.9-.4-1.5-.2-1.1-.3-2.2-.3-2.2 2.7-1 3.8-2.3 4.3-3.4s.4-2 .4-2c-1.7.5-4.4 1.1-4.8 4.1 0 0 0-1.1.1-2.2s.3-2.2.3-2.2c2.9-.3 4.3-1.2 5-1.9.4-.4.9-1.5.9-1.5-.9-.2-1.9-.3-3-.1-1.1.2-2.1.9-2.7 2.3 0 0 0-.2.1-.5s.2-.6.3-1c.3-.7.5-1.4.5-1.4.6-.2 1.4-.6 2.1-1.3.7-.7 1-1.8 1.7-3.9-2.4-.2-3.9 1.2-4.4 2.3-.6 1.2-.3 2.2-.1 2.7 0 0-.3.7-.6 1.5-.1.4-.2.8-.3 1.1-.1.3-.1.5-.1.5.2-1.6-.1-2.9-.5-4.1-.4-1.2-.9-2.3-1.1-3.4 0 0-.3.3-.7.9-.3.6-.7 1.4-.9 2.3-.3 1.8.4 4.1 3 5.3 0 0-.2 1.2-.3 2.3-.1 1.2 0 2.4 0 2.4-.5-3.2-2.6-4.7-3.9-6.4 0 0-.6 1.5-.4 3.2.2 1.8 1.4 3.8 4.3 4.3 0 0 .1 1.2.3 2.3.2 1.2.6 2.3.6 2.3-1.4-2.9-3.7-3.9-5.5-5.2 0 0-.2 1.5.5 3.2.7 1.6 2.4 3.5 5.4 3 0 0 .1.3.3.7.2.4.4 1 .8 1.4.7 1 1.4 1.9 1.4 1.9-2.3-2.2-4.9-2.3-7-3.1 0 0 .1.4.4 1 .3.6.7 1.4 1.3 2.1 1.4 1.3 3.6 2.3 6.2.8l.5.5c.3.3.8.7 1.3 1.1.5.4 1 .7 1.4 1 .3.2.6.3.6.4-.8-.2-1.4-.5-2.1-.6-.7-.1-1.4 0-1.9-.1-1.2 0-2.4.3-3.5.3 0 0 .2.3.7.8.5.4 1.1 1.1 1.9 1.4.9.4 1.9.6 2.9.5 1.1-.2 2.1-.7 3.1-1.8-.1.1 3.5 1.5 4.3 1.6h-2.1c-.7.1-1.3.3-1.9.5-1.2.4-2.2 1-3.2 1.4 0 0 .3.2.8.5s1.3.6 2.2.7c1.8.3 4-.3 5.3-2.9 0 0 .2 0 .5.1.3 0 .7.1 1.1.1l1.6.2c.2 0 .4-.2.4-.4.2.2 0 0-.2 0zm1.8 0s.8-.1 1.5-.2c.4-.1.8-.1 1.1-.1.3-.1.5-.1.5-.1.2-2.9 1.2-4.3 2-5.1.5-.4 1.8-1 1.8-1 0 .9.1 2-.2 3.1-.3 1-1 2.1-2.4 2.7 0 .1 4.2-1.4 4.1-1.6-.3-1.4-.3-2.5-.1-3.4.1-.9.3-1.5.6-2s1.3-1.4 1.3-1.4c.3.8.7 1.8.7 2.9.1.6-.1 1.1-.3 1.7-.2.5-.6 1.2-1.2 1.6 0 0 1-.6 1.9-1.3.5-.3.9-.7 1.2-1l.5-.5c-1.3-2.5-1.8-4.2-1-6.4.2-.3.3-.4.3-.4 1.1 1.2 3 3.2 1.5 6 0 0 .7-.9 1.3-1.8.3-.4.5-1 .7-1.3l.3-.6c-2.1-1.9-3-3.2-3.2-4.3-.2-1.1.1-2.1.1-2.1 1.5.9 4 2.2 3.5 5.3l.2-.6c.1-.4.2-.9.4-1.5.2-1.1.3-2.2.3-2.2-2.7-1-3.8-2.3-4.3-3.4s-.5-2-.5-2c1.7.5 4.4 1.1 4.8 4.1 0 0 0-1.1-.1-2.2s-.3-2.2-.3-2.2c-2.9-.3-4.2-1.2-5-1.9-.4-.4-.9-1.5-.9-1.5.9-.2 1.9-.3 3-.1 1 .2 2.1.9 2.7 2.3 0 0 0-.2-.1-.5s-.2-.6-.3-1c-.3-.7-.5-1.4-.5-1.4-.6-.2-1.4-.6-2.1-1.3-.7-.7-1-1.8-1.7-3.9 2.4-.2 3.9 1.2 4.4 2.3.6 1.2.3 2.2.1 2.7 0 0 .3.7.6 1.5.1.4.2.8.3 1.1.1.3.1.5.1.5-.2-1.6.1-2.9.5-4.1.4-1.2.9-2.3 1.1-3.4 0 0 .3.3.7.9.3.6.7 1.4.9 2.3.4 1.9-.3 4.2-2.9 5.4 0 0 .2 1.2.3 2.3.1 1.2 0 2.4 0 2.4.5-3.2 2.6-4.7 3.9-6.4 0 0 .6 1.5.4 3.2-.2 1.8-1.4 3.8-4.3 4.3 0 0-.1 1.2-.3 2.3-.2 1.2-.6 2.3-.6 2.3 1.4-2.9 3.7-3.9 5.5-5.2 0 0 .2 1.5-.5 3.2-.7 1.6-2.4 3.5-5.4 3 0 0-.1.3-.3.7-.2.4-.4 1-.8 1.4-.7 1-1.4 1.9-1.4 1.9 2.3-2.2 4.9-2.3 7-3.1 0 0-.1.4-.4 1-.3.6-.7 1.4-1.3 2.1-1.4 1.3-3.6 2.3-6.2.8l-.5.5c-.3.3-.8.7-1.3 1.1-.5.4-1 .7-1.4 1-.3.2-.6.3-.6.4.8-.2 1.4-.5 2.1-.6.7-.1 1.4 0 2-.1 1.2 0 2.4.3 3.5.3 0 0-.2.3-.7.8-.5.4-1.1 1.1-1.9 1.4-.9.4-1.9.6-2.9.5-1.1-.2-2.1-.7-3.1-1.8.1.1-3.5 1.5-4.3 1.6h2.1c.7.1 1.3.3 1.9.5 1.2.4 2.2 1 3.2 1.4 0 0-.3.2-.8.5s-1.3.6-2.2.7c-1.8.3-4-.3-5.3-2.9 0 0-.2 0-.5.1-.3 0-.7.1-1.1.1l-1.6.2c-.2 0-.4-.2-.4-.4-.1.1.1-.1.3-.1z"></path><path class="azvip-svg-icon azvip-svg-icon-emblem" d="M29 12.7c-.1 0-.2 0-.3.1-1.9 1-7.1 3.2-9.4 4.1-.7.3-.8.4-.8.6-.1 2.5-.3 8.6 1.2 12.3 2 4.7 7.5 7 9.1 7.6h.4c1.6-.6 7.1-2.9 9-7.6 1.5-3.7 1.4-9.8 1.2-12.3 0-.2-.1-.4-.8-.6-2.2-.9-7.5-3-9.3-4.1-.1-.1-.2-.1-.3-.1z"></path></symbol><symbol viewBox="0 0 106 106" xml:space="preserve" id="ico-weapon-crackshot" xmlns="http://www.w3.org/2000/svg"><path class="bast0" d="m97.3 9.6-3.1-3.1-3.6 2-36.2 31.7h-.8l-1.4-1.6 1.4-1.2 4.2-2 3.7-2.8-4.9-5.6-3.6 2.8-3.8 5.3-.4-.5-1.9 1.6.4.5-9.8 8.3-.5-.6-1.9 1.6.5.6-6.6 3.3-1.8 1.8 5.2 5.7 2.1-1.8 4-5.6 1.5 1.8-.5 1.6-1.1-.8-1.6 1.2.6.9-1.9 1.7 2.9 3.2-3.4 6.2-3.9.4-17 14 2.4 2.1-1.5 1.5-2.3-1.9-4.1 3.9 16.6 13.8 3.3-4.2-2.3-1.9 1.2-1.3 1.5 1.3L41 75.4l6 2.4 4-4-5.7-6-.4-2.8 3.3-4.3 2.3 2.4h6.3l3.7-3.2 1-5.7-3.2-3.6 22-19-3.1-4 16.9-14.1 3.2-3.9zM18.1 83.7l3 2.7-1.4 1.3-3.2-2.7 1.6-1.3zm6.2 7.9-2.4-2 1.3-1.3 2.3 2-1.2 1.3zm17.3-42-1-1.1 9.8-8.2 1.1 1.2-9.9 8.1zm17.3 5.6-.4 3.5-2.5 2.4-4.6.3-1.9-2.1.7-.9 1.3 1.4h3.4l.9-.8-2.8-.7-1.4-1.7.2-.3 4.6-4 2.5 2.9z"></path></symbol><symbol viewBox="0 0 106 106" xml:space="preserve" id="ico-weapon-ranger" xmlns="http://www.w3.org/2000/svg"><path class="bbst0" d="m76.8 32.6-.1-2.2 22.5-19.3-3.3-3.3-11.4 9.6-4.7-1.3-7.6 6.5-2.2-1-25.7 21.8-3.6-3.5.9-.7 6.5-3.9 2.7.2 1.2-1.1s-1.8-3.4-6.9-8l-1.2 1.3v2.1l-4.6 5.8-8.3 8-3.9 1.7-13.9 11.1-2.9.9s1 2.1 2.4 3.6c2 2 4 3.2 3.7 3l.8-2.6 13.1-11.7 2.5-3.1.2-.2 3.5 3.8-12.4 10.6 1.7 8.9-19 16.5L17 98.2l16.9-17 3.4 7.5 11.3-6.3-5-9.4 9.4-9.8-2.2-3.8 1.5.8 6.6 5.5 8.7-10.8c-7.7-4.6-9.6-8-9.6-8l5.2-2 13.6-12.3zm1.2-12 1.8.6-4.6 4-1-1.1 3.8-3.5zM17.5 89.1l-3.5-5 2.5-2.2 3.8 4.4-2.8 2.8zm8.1-4.2-4.4-7.3L29 71l3.5 7.3-6.9 6.6zm23.9-22.1-7.3 7.6-2.5-4.6 4.9-2.3-.3-2c-1.5.6-2.5-.1-3.2-.7l4.9-3.7.1.1 3.4 5.6z"></path></symbol><symbol viewBox="0 0 106 106" xml:space="preserve" id="ico-weapon-rpegg" xmlns="http://www.w3.org/2000/svg"><path class="bcst0" d="m78.1 48.5-5.1-.1.1-1.7 6.2-5.1 1.4-3.2.9 1.1 19.2-13.1s-.9-3.1-3.7-7l.2-1.8c.2-1.2-.7-2.3-1.9-2.4l-1.9-.2c-1.7-1.7-3.7-3.4-6.2-5L70.9 26.6l1.3 1.5-1.5.5-5.5-2.6-4.9 4.1.8 4.4-4.7 3.8-4-4.6.1-.1 1.4.3 7.4-6.9.6.7 4.2-3.4-5.3-6.3-4.2 3.4.4.6-7.8 6v1.5l-12.4 8.6 5.4 6.2 5.7-6 3.4 4.7-1.6-.4-3.7 2.8 1 1.3-22.3 19-1.4-.5-3.5 2.8.2 1.3-8.8 5.2-2.2-.3-3.9 3.5s3.4 11.5 14.7 18.2l4.4-3.5.3-2.2 6-7.5.6-.5 1.3.4 3.2-2.8-.1-1.4 2.9-2.5 11.1 11.6 7.1-6.2-10-12.6 9.5-8.2 8.3.2.2.3-2.1 2.1 5.1 6.8 1.8-1.7 5.8 9 6.5-6.1-4.2-10.8 5.2-5.7-4.6-6.1zm-1.4 2.6 2.5 3.6-3.2 3.4-2-2.5 2.5-1.9-.6-.7-3.1-.1.1-1.9 3.8.1zM63.2 31.2l2.4-2 1.4.7-.3.1-3.3 2.6-.2-1.4z"></path></symbol><symbol viewBox="0 0 106 106" xml:space="preserve" id="ico-weapon-scrambler" xmlns="http://www.w3.org/2000/svg"><path class="bdst0" d="M94.5 15.3c-.3-.6-.9-1.5-1.8-2.6-.9-1-1.6-1.8-2.2-2.3-.5-.4-1.1-.4-1.6-.1l-3.7 3-2.2-.6-3.1 2.2.5 2.2L46 44.6c-.2.2-.4.4-.7.6l-2.6-2.5-1.7 1.5 2.5 3c-5.2 6.5-10 17.3-10 17.3l-3.3.2L11.4 83l11.3 12.9L41 67.7l2.8 1.5.6-.2c7.9-2.4 9.5-7.5 9.5-7.7l.2-.7-3.9-5.1 10.5-6.8L85.1 28c.8-.7.9-1.8.3-2.7l-.7-1 9.4-7.5c.5-.3.7-1 .4-1.5zM44.1 66.1l-1.5-.8 2.5-3.8h3l.9-1-2.1-1.5 1.2-1.4 2.7 3.5c-.5 1.1-2.3 3.5-6.7 5z"></path></symbol><symbol viewBox="0 0 106 106" xml:space="preserve" id="ico-weapon-soldier" xmlns="http://www.w3.org/2000/svg"><path class="best0" d="m61.7 51.4.4-1.3 22.4-19.7-.2-1.8 14.6-12.7-3.3-3.3-4.3 3.6C86.7 13.9 83 8.7 83 8.7l-1.9 1.7c3.5 4 5.2 7.5 6.1 9.5l-.9.7-6.1-3-3.4 2.8-1.6-1-11.5 9.5.2 2.2-.5.4-3.6-1.1-5.3 4.8-1.3-.8-1.2 1.2 2.6 3.1-28 23.2.4 6.5-2.7 4.5-3.1-.2L7.1 85l10.5 12.1 14.8-23.3 1.3-.5 8.7 24.1 10.8-9.1-6.4-13.9 7.1-6.7-3-5c2.8 2.7 18.2 16.9 38.8 15.6L91 63.1s-17.8 1.3-29.3-11.7zm24.9-36.3c.2-.2.5-.2.8 0l1.6 1.2c.3.2.3.7 0 1l-.6.5c-.3.2-.7.2-.9-.2l-.9-1.7c-.3-.3-.2-.7 0-.8zM45.5 71.6 44 68.2l4.2-2.1-.5-.9-2.7-.7.9-2 1.4-.3 2.9 4.9-4.7 4.5z"></path></symbol><symbol viewBox="0 0 106 106" xml:space="preserve" id="ico-weapon-trihard" xmlns="http://www.w3.org/2000/svg"><path d="m94.3 7.4-2.8.5-1 3-12.1 11.8-1.1-.9-5 4.5 3.8 4.1.6 2.9-2 1.4-5.4-6.5-9-1-12 10.3-.5-.5 2-1.7-3.5-4.3-2.1 2-.7-.7-5.1 4.9.7.7-2 1.8 3.1 3.7 2.4-2 .6.6-6.2 5.2 1.8 1.9 7.9-6.8h1l1.1 1.2.2.7-.3.3.3 2.3-2 1.3-1.2-1.1-28.2 21.2 2.2 2.7-12.1 9.4v4.2l9.4 8.6 1.7-.6 6.2 6.1 5.2-4.6.6-14h2.9l1.5-1.4s2.9 3.2 6.7 6.1c3.8 2.9 10.3 8.1 10.3 8.1L58.3 81v-2.4l-2.7-.6s-8-4.8-11.6-9.1l1.1-1.1-1.1-2.6 7.4-6.5L59 70.5l3.4 1.1 9.5-8-5.7-15.9 1.9-1.4 1.5 1.1 2.3-1.8-1-1.9 1-.8 11.7 10.9 2.7-2.5L77.4 38l4.3-3.3-.7-6.2-.8-1.3.3-1.5L95 15.3l2.8-.5.5-2.9-4-4.5zm-37 31.2-4.3.6.8 2.3-1.8.5-1.1-.3-.9-1.3v-.9l11-9.6 2.3 1.5-.4 2.3-3.2-.1.9 2.2-4.2.4.9 2.4zm11.1 23.6-4.6 4.4-4.6-8 .8-2.4.9-.1-.1-1.6-1.7-2.5 4.3-3.8 5 14z"></path></symbol><symbol viewBox="0 0 106 106" xml:space="preserve" id="ico-weapon-whipper" xmlns="http://www.w3.org/2000/svg"><path class="bgst0" d="m98 16.8-2.9-3.4c-.4-.4-1.1-.5-1.5-.1L90.4 16c-.3.3-.5.7-.3 1.1l-6.4 5.6-5.4-5.7-2-1-4-3.9-.7.5-.5 1.1-1.7-2.1-1 .8 1.7 2.1-1.2.2-1.8 1.4.2 1.1-1.1.8-1.1-.4-1.7 1.3.2 1.2-.9.9-1.1-.4-1.7 1.4.2 1.2-1 .8-1.2-.4-1.6 1.3.2 1.3-1.1.8-1.3-.4-1.7 1.4v1.3l-2.8-3.5-1.8 1.5 3.7 4.5-.8 1.2 1.8 8.1L7.8 78l16 16.3H26l18.4-16 10.5-.5 9.5-5.5 5.2-7.1v-7.4l9-6.2 2.1 4.1 5.3-4.2v-6.9l-3.7-6.2 3.7-3.2 3.9 4.2 4.1-3.3-4.7-6.1h-4l.8-2.2 7.6-6.6c.3.1.7 0 1-.2l3.2-2.7c.4-.4.5-1.1.1-1.5zM58.6 66.1l-6.2 4.5-6.6-7.3 10.6-9c1.5 1.9 4.6 4.9 4.6 4.9l-2.4 6.9zm-.8-29.5-.6-2.3 14.4-12.1 3 .5-16.8 13.9zM74.4 50l-4.1-3.3-.8-3.3 5.5-4.6 4.4 6.2-5 5z"></path></symbol><symbol viewBox="0 0 38.919 34.476" id="ico_watchAd" xmlns="http://www.w3.org/2000/svg"><path d="M0 12.44v17.55a4.487 4.487 0 0 0 4.487 4.486h29.945a4.487 4.487 0 0 0 4.487-4.487V12.44H0Zm25.075 11.533-7.18 4.788a1.313 1.313 0 0 1-2.042-1.093v-9.575A1.313 1.313 0 0 1 17.895 17l7.18 4.788c.78.52.78 1.666 0 2.185ZM5.933 9.774h6.368L22.075 0h-6.368L5.933 9.774zM34.316 0h-6.368l-9.774 9.774h6.368L34.316 0zM9.834 0H4.487A4.487 4.487 0 0 0 0 4.487v5.287h.06L9.834 0Zm20.581 9.774h8.504V4.487c0-.914-.275-1.763-.744-2.473l-7.76 7.76Z" style="fill:#fff" __uv-attr-style="fill:#fff"></path></symbol></svg>		<!-- Ads -->
    <div id="gameAdContainer" class="hideme">
</div>

<div id="shellshockers_titlescreen"></div>
<div id="shellshockers_chicken_nugget_banner"></div>
<div id="shellshockers_respawn_banner-sh"></div>
<div id="shellshockers_respawn_banner_2-sh"></div>
<div id="shellshockers_respawn_banner"></div>
<div id="shellshockers_respawn_banner-new"></div>
<div id="ShellShockers_LoadingScreen_HouseAds"></div>

<div id="videoAdContainer">
<div id="preroll"></div>
</div>

<!-- <div class="video_ad_wrapper">
<video id="asc_video_ad" class="video-js vjs-default-skin" controls preload="auto" width="640" height="360" muted="true" style="display: none;">
    <source src="video/tiny.mp4" type="video/mp4" />
</video>
</div> -->
    <div id="ss_background"></div>

    <!-- Instantiate the Vue instance -->
    <div id="app" :class="[currentLanguageCode, appClassObj, appClassScreen, isPhotoBooth]"> <!-- vue instance div: all vue-controlled elements MUST be inside this tag -->
<!-- <asc-video-player id="mainVideoPlayer" ref="mainVideoPlayer" adTagUrl="adTagUrl"></asc-video-player> -->
<div class="firebaseID">firebase ID: {{ firebaseId }}, maskedEmail: {{ maskedEmail }} isAnonymous: {{ isAnonymous }}, isEmailVerified: {{ isEmailVerified }}</div>
<!-- Canvas -->
<div ref="gameCanvas" class="canvas-wrapper gameCanvas">
    <canvas id="canvas" ref="canvas"></canvas>
</div>
<!-- <div v-show="ui.photoBooth.vignette" class="pb-vignette"></div> -->
<!-- TODO: remove in not needed -->
<!-- <div class="photo-booth-canvas">
    <canvas id="photo-booth-canvas" ref="photo-booth-canvas"></canvas>
</div> -->
<!-- Overlays -->
<light-overlay id="lightOverlay" ref="lightOverlay"></light-overlay>
<dark-overlay id="darkOverlay" ref="darkOverlay"></dark-overlay>
<spinner-overlay id="spinnerOverlay" ref="spinnerOverlay" :loc="loc" :hide-ads="hideAds" :ad-unit="displayAd.adUnit.spinner" :account-date="accountCreated"></spinner-overlay>

<!-- GDPR -->
<gdpr id="gdpr" ref="gdpr" :loc="loc"></gdpr>
    <!-- <account-panel id="account_panel" ref="accountPanelHome" :loc="loc" :selected-language-code="currentLanguageCode" :eggs="eggs" :languages="languages" :currentLangOptions="locLanguage" :show-corner-buttons="ui.showCornerButtons" :show-bottom="true" :photo-url="photoUrl" :is-anonymous="isAnonymous" :is-of-age="isOfAge" :show-targeted-ads="showTargetedAds" :current-screen="showScreen" :screens="screens" :isEggStoreSale="isEggStoreSaleItem" :is-subscriber="isSubscriber" @sign-in-clicked="onSignInClicked" @sign-out-clicked="onSignOutClicked" :is-twitch="twitchLinked"></account-panel> -->
<account-panel v-show="ui.showHomeEquipUi" id="account_panel" ref="accountPanelHome" :loc="loc" :selected-language-code="currentLanguageCode" :eggs="eggs" :languages="languages" :currentlangoptions="locLanguage" :show-corner-buttons="ui.showCornerButtons" :show-bottom="true" :photo-url="photoUrl" :is-anonymous="isAnonymous" :is-of-age="isOfAge" :show-targeted-ads="showTargetedAds" :current-screen="showScreen" :screens="screens" :iseggstoresale="isEggStoreSaleItem" :is-subscriber="isSubscriber" @sign-in-clicked="onSignInClicked" @sign-out-clicked="onSignOutClicked" :is-twitch="twitchLinked"></account-panel>
<div id="main-content" class="main-content display-grid height-100vh">
    <aside v-show="showScreen !== screens.photoBooth" class="main-aside">
        <main-sidebar ref="mainMenu" v-show="ui.showHomeEquipUi" :loc="loc" :player-name="playerName" :menu-items="ui.mainMenu" :current-screen="showScreen" :screens="screens" :mode="equipMode" :current-mode="currentEquipMode" :is-game-paused="game.isPaused" :in-game="game.on" :picked-game-type="currentGameType" @previous-screen="setPreviousScreen"></main-sidebar>
        <photo-booth-ui id="photoBooth" ref="photoBooth" v-show="!ui.showHomeEquipUi" :loc="loc" :player-name="playerName" :item-type-change="ui.photoBooth.type" @bg-change-color="onPhotoboothBgColorChange" @bg-change-image="onPhotoBoothBgImageChange" @hide-ui="onPhotoBoothHideUi"></photo-booth-ui>
        <house-ad v-show="showScreen !== screens.game &amp;&amp; ui.showHomeEquipUi" :loc="loc" :upgrade-name="upgradeName" :is-event="ui.isEvent" :is-upgraded="isUpgraded" :is-subscriber="isSubscriber" :has-mobile-reward="hasMobileReward" :is-poki="isPoki" :chw-count="chw.winnerCounter" :chw-ready="showAdBlockerVideoAd" :chw-limit-reached="chw.limitReached" :ads="ui.houseAds.homeScreen" @chw-video-request="showNuggyPopup"></house-ad>
        <div ref="chw-home-timer" style="display:none" v-show="!isPoki &amp;&amp; firebaseId &amp;&amp; showScreen !== screens.game &amp;&amp; ui.showHomeEquipUi" class="chw-home-timer display-grid grid-column-1-2 grid-align-items-center box_absolute grid-gap-1" __uv-attr-style="display: none">
            <div class="box_relative">
                <img class="box_absolute chw-loot-img" src="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fkme%2Fahkciel-lueggt-cjw%2Flmov-%60tl.rne" __uv-attr-src="img/chicken-nugget/chw-loot-btn.png">
                <img class="chw-home-timer-chick box_absolute" :src="chwChickSrc">
            </div>
            <div class="chw-bubble-wrap box_relative" :class="chwHomeTimerCls">
                <div class="display-grid grid-align-items-center bg_white chw-circular-timer-container box_relative gap-sm" :class="chwClass">
                    <div v-show="!chw.onClick">
                        <p class="chw-circular-timer-countdown nospace text-center">
                            <span class="chw-pie-remaining text-center chw-msg chw-r-msg" v-html="remainingMsg"></span>
                            <br>
                            <span v-show="!chw.ready &amp;&amp; !chw.adBlockDetect"><span v-show="chw.hours" class="chw-pie-num">{{chw.hours}}:</span><span v-show="chwShowTimer" class="chw-pie-num">{{chw.minutes}}:</span><span v-show="chwShowTimer" class="chw-pie-num">{{chw.seconds}}</span></span>
                        </p>
                        <button v-if="chw.ready &amp;&amp; !chw.adBlockDetect" class="ss_button btn_sm btn_yolk bevel_yolk" @click="playIncentivizedAd">{{ playAdText }} <icon v-show="chw.winnerCounter" name="ico_watchAd" class="chw-icon-watch-ads"></icon></button>
                    </div>
                </div>
                <div class="speech-tail"></div>
                <div class="chw-circular-timer-container-shadow"></div>
            </div>
        </div>
        <!-- .chw-timer -->
    </aside>
    <!-- .chw-home-timer -->
    <main id="mainScreens">
        <div id="paper_doll_container" class="paper-doll-click-container centered z-index-1" v-show="showScreen === screens.home || showScreen === screens.equip"></div>
        <home-screen id="home_screen" ref="homeScreen" v-show="(showScreen === screens.home || showScreen === screens.profile)"></home-screen>
        <equip-screen id="equip_screen" class="height-100vh" ref="equipScreen" v-show="showEquipScreens" @photo-booth-type-id="photoBoothTypeChange"></equip-screen>
        <game-screen id="game_screen" ref="gameScreen" v-show="(showScreen === screens.game)" :kname="killName" :kdname="killedName"></game-screen>
    </main>
</div>
<div id="gameDescription" v-show="(showScreen === screens.home)">
    <h1 class="text-center">{{ loc.home_desc_about }}</h1>
    <p class="text-center">{{ loc.home_desc_pick }}
    <svg class="eggIcon"><use xlink:href="#icon-egg" __uv-attr-href="#icon-egg"></use></svg>
    {{ loc.home_desc_loadout }}
    <svg class="eggIcon"><use xlink:href="#icon-egg" __uv-attr-href="#icon-egg"></use></svg>
    {{ loc.home_desc_madeof }}</p>
    <section class="text-center">
        <p>{{ loc.home_blocked_start }} geometry.monster {{ loc.home_blocked_end }}</p>
    </section>
    <div class="display-grid grid-column-2-eq gap-1 ">
        <section>
            <p>{{ loc.home_desc_p1 }}</p>
            <p>
                <img src="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fkme%2FggePmsg07.rne" style="width:350px;float:left;margin-right:1em;shape-outside:polygon(0% 0%,100% 0%,100% 41%,84% 48%,80% 63%,59% 74%,46% 100%,0% 99%)" __uv-attr-src="img/eggPose05.png" __uv-attr-style="width: 350px; float: left; margin-right: 1em; shape-outside: polygon(0% 0%, 100% 0%, 100% 41%, 84% 48%, 80% 63%, 59% 74%, 46% 100%, 0% 99%);">{{ loc.home_desc_p2 }}
            </p>
        </section>
        <section>
            <p>
                <img src="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fkme%2FggePmsg03.rne" style="float:right;margin-left:1em;margin-top:1em;shape-outside:polygon(1% 0%,100% 1%,100% 99%,50% 100%,28% 86%,16% 68%,14% 51%,0 35%)" __uv-attr-src="img/eggPose01.png" __uv-attr-style="float: right; margin-left: 1em; margin-top: 1em; shape-outside: polygon(1% 0%, 100% 1%, 100% 99%, 50% 100%, 28% 86%, 16% 68%, 14% 51%, 0 35%);">
                {{ loc.home_desc_p3 }} <br><br>
                {{ loc.home_desc_p4 }}
            </p>
        </section>
    </div>
    <section>
        <header>
            <h2 class="text-center">{{ loc.home_game_mode_title }}</h2>
        </header>
        <ul class="display-grid grid-column-2-eq gap-1 ">
            <li v-html="loc.home_game_mode_content_li_1"></li>
            <li v-html="loc.home_game_mode_content_li_2"></li>
            <li v-html="loc.home_game_mode_content_li_3"></li>
            <li v-html="loc.home_game_mode_content_li_4"></li>
        </ul>
    </section>

    <h2 class="text-center">{{ loc.home_desc_controls }}</h2>
    <p class="text-center">{{ loc.home_desc_standard }}</p>

    <ul class="display-grid grid-column-2-eq" style="min-width:25em;max-width:35em;margin:0 auto" __uv-attr-style="min-width: 25em;max-width: 35em;margin:0 auto">
        <li> {{ loc.home_desc_control1 }}</li>
        <li> {{ loc.home_desc_control2 }}</li>
        <li> {{ loc.home_desc_control3 }}</li>
        <li> {{ loc.home_desc_control4 }}</li>
        <li> {{ loc.home_desc_control5 }}</li>
        <li> {{ loc.home_desc_control6 }}</li>
        <li> {{ loc.home_desc_control7 }}</li>
        <li> {{ loc.home_desc_control8 }}</li>
        <li> {{ loc.home_desc_control9 }} </li>
    </ul>

    <p class="text-center">
        <button class="ss_button btn_lg btn_blue bevel_blue" @click="openUnblocked">{{ loc.home_unblocked_text }}</button>
    </p>

    <p v-html="loc.home_desc_p7"></p>

    <p align="center"><button class="ss_button btn_yolk bevel_yolk" @click="vueApp.scrollToTop()">{{ loc.home_backtotop }}</button></p>

</div>
<!-- #gameDescription -->

<!-- Popup: Settings -->
<large-popup id="settingsPopup" ref="settingsPopup" @popup-closed="onSharedPopupClosed" @popup-opened="onSettingsPopupOpened" @popup-x="onSettingsX">
    <template slot="content">
    <settings id="settings" ref="settings" :loc="loc" :settings-ui="settingsUi" :languages="languages" :current-language-code="currentLanguageCode" :show-privacy-options="showPrivacyOptions" @privacy-options-opened="onPrivacyOptionsOpened" :is-from-eu="showPrivacyOptions" :controller-id="controllerId" :controller-type="controllerType" :lang-option="locLanguage" :is-vip="(hideAds || contentCreator)"></settings>
    </template>
</large-popup>

<!-- Popup: Privacy Options -->
<small-popup id="privacyPopup" ref="privacyPopup" hide-cancel="true" @popup-closed="onSharedPopupClosed">
    <template slot="header">{{ loc.p_settings_privacy }}</template>
    <template slot="content">
        <label class="ss_checkbox label"> {{ loc.p_settings_of_age }}
            <input id="ofAgeCheck" type="checkbox" v-model="isOfAge" @change="ofAgeChanged($event)">
            <span class="checkmark"></span>
        </label>

        <label class="ss_checkbox label"> {{ loc.p_settings_target_ads }}
            <input id="targetedAdsCheck" type="checkbox" v-model="showTargetedAds" @change="targetedAdsChanged($event)">
            <span class="checkmark"></span>
        </label>
        <!--
        <input id="ofAgeCheck" type="checkbox" v-model="isOfAge" @change="ofAgeChanged($event)">&nbsp;{{ loc.p_settings_of_age }}<br>
        <input id="targetedAdsCheck" type="checkbox" v-model="showTargetedAds" @change="targetedAdsChanged($event)">&nbsp;<span id="targetedAdsText">{{ loc.p_settings_target_ads }}</span>
        -->
    </template>
    <template slot="confirm">{{ loc.ok }}</template>
</small-popup>

<!-- Popup: Help & Feedback -->
<large-popup id="helpPopup" ref="helpPopup" stop-key-capture="true" @popup-closed="onSharedPopupClosed">
    <template slot="content">
        <help id="help" ref="help" :loc="loc" :account-type="accountStatus" :feedback-type="feedbackType" :open-with-type="feedbackSelected" @resetfeedbacktype="resetFeedbackType"></help>
    </template>
</large-popup>

<!-- Popup: VIP Help & Feedback -->
<large-popup id="vipPopup" ref="vipPopup" stop-key-capture="true" @popup-closed="onVipHelpClosed">
    <template slot="content">
        <vip-help id="vip-help" ref="vip-help" :loc="loc" :is-vip="isSubscriber">
    </vip-help></template>
</large-popup>

<!-- Popup: Egg Store -->
<large-popup id="eggStorePopup" ref="eggStorePopup" stop-key-capture="true" @popup-closed="onSharedPopupClosed" :overlay-close="false">
    <template slot="content">
        <egg-store id="eggStore" ref="eggStore" :loc="loc" :products="eggStoreItems" :sale-event="isSale"></egg-store>
    </template>
</large-popup>

<img v-show="blackFridayBanner" class="black-friday-banner" style="display:none" src="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fkme%2F%60lcci-drkdcy%2Fbcnlep.hpe" alt="Black Friday Sale" __uv-attr-style="display: none" __uv-attr-src="img/black-friday-banner.jpg">

<!-- Popup: VIP store -->
<large-popup id="subStorePopup" ref="subStorePopup" stop-key-capture="true" @popup-closed="onSharedPopupClosed" :overlay-close="true">
    <template slot="content">
        <subscription-store id="shell-subscriptions" ref="shell-subscriptions" :loc="loc" :subs="subStoreItems">
    </subscription-store></template>
</large-popup>

<!-- Popup: VIP ended -->
<small-popup id="vipEnded" ref="vipEnded" stop-key-capture="true" @popup-confirm="showSubStorePopup" @popup-closed="onSharedPopupClosed" :overlay-close="true" class="vip">
    <template slot="content">
        <figure>
            <img src="img/vip-club/vip-club-popup-emblem.png" alt="Shell Shockers VIP">
        </figure>
        <div class="vip-ended-popup">
            {{ loc.account_vip_expired }}
        </div>
    </template>
    <template slot="confirm">{{ loc.account_vip_expire_3 }}</template>
    <template slot="cancel">{{ loc.account_vip_expired_2 }}</template>
</small-popup>

<!-- Popup: Egg Store single -->
<large-popup id="popupEggStoreSingle" ref="popupEggStoreSingle" stop-key-capture="true" @popup-closed="onSharedPopupClosed" :overlay-close="false" class="popup-store-single">
    <template slot="content">
        <egg-store-item v-for="item in premiumShopItems" :key="item.sku" :item="item" :loc="loc" :account-set="accountSettled" v-if="eggStorePopupSku &amp;&amp; item.sku === eggStorePopupSku"></egg-store-item>
    </template>
</large-popup>

<!-- Popup: Unsupported Platform -->
<large-popup id="unsupportedPlatformPopup" ref="unsupportedPlatformPopup" hide-close="true">
    <template slot="content">
        <h2>{{ loc['unsupported_platform'] }}</h2>
        <div>{{ loc[unsupportedPlatformPopup.contentLocKey] }}</div>
    </template>
</large-popup>

<!-- Popup: Missing Features -->
<large-popup id="missingFeaturesPopup" ref="missingFeaturesPopup" hide-close="true">
    <template slot="content">
        <h2>{{ loc['oh_no'] }}</h2>
        <span>{{ loc['missing_features'] }}</span>
        <ul>
            <li v-for="f in missingFeatures" v-html="f"></li>
        </ul>
        <span>{{ loc['missing_help'] }}</span>
    </template>
</large-popup>

<!-- Popup: No Anon -->
<small-popup id="noAnonPopup" ref="noAnonPopup" @popup-confirm="onNoAnonPopupConfirm" @popup-closed="onSharedPopupClosed">
    <template slot="header">{{ loc.no_anon_title }}</template>
    <template slot="content">
        <div>{{ loc.no_anon_msg1 }}</div>
        <div>{{ loc.no_anon_msg2 }}</div>
    </template>
    <template slot="cancel">{{ loc.cancel }}</template>
    <template slot="confirm">{{ loc.no_anon_signup }}</template>
</small-popup>

<!-- Popup: Give Stuff -->
<give-stuff-popup ref="giveStuffPopup" id="giveStuffPopup" :loc="loc" :give-stuff-popup="giveStuffPopup"></give-stuff-popup>

<!-- Popup: Open URL -->
<small-popup id="openUrlPopup" ref="openUrlPopup" @popup-confirm="onOpenUrlPopupConfirm" @popup-closed="onSharedPopupClosed">
    <template slot="header">{{ loc[openUrlPopup.titleLocKey] }}</template>
    <template slot="content">
        <!-- content not loc'd (yet) -->
        {{ openUrlPopup.content }}
    </template>
    <template slot="cancel">{{ loc[openUrlPopup.cancelLocKey] }}</template>
    <template slot="confirm">{{ loc[openUrlPopup.confirmLocKey] }}</template>
</small-popup>

<!-- Popup: Changelog -->
<large-popup id="changelogPopup" ref="changelogPopup" @popup-closed="onSharedPopupClosed">
    <template slot="content">
        <h1 id="popup_title nospace" class="roundme_sm">
            {{ loc.changelog_title }}
        </h1>

        <div class="changelog_content roundme_lg">
            <section v-for="(log, idx) in changelog.current">
                <h3>{{ log.version }} - <i><time>{{ log.date }}</time></i></h3>
                <ul>
                    <li v-for="data in log.content" v-html="data"></li>
                </ul>
                <hr class="blue">
            </section>
        </div>
        
        <div id="btn_horizontal">
            <button v-if="changelog.showHistoryBtn" @click="showHistoryChangelogPopup" class="ss_button btn_green bevel_green">{{ loc.more }}</button>
            <button @click="hideChangelogPopup" class="ss_button btn_red bevel_red">{{ loc.close }}</button>
        </div>
    </template>
</large-popup>

<!-- Popup: Golden Chicken -->
<large-popup id="goldChickenPopup" ref="goldChickenPopup" :overlay-close="false">
    <template slot="content">
        <gold-chicken-popup id="gold_chicken" ref="gold_chicken" :loc="loc" @close-chw-popup="hideChickenPopup" @open-chw-game="goldChickenPopupOpenChw"></gold-chicken-popup>
    </template>
</large-popup>

<!-- Popup: Chicken Nugget -->
<large-popup id="chicknWinner" ref="chicknWinner" :hide-close="!chwMiniGameComplete" :overlay-close="chwMiniGameComplete" @popup-closed="onChwPopupClosed">
    <template slot="content">
        <chicken-nugget-popup id="chickenNugget" ref="chickenNugget" :loc="loc" :firebase-id="firebaseId" :reward="chw.reward" :ad-unit="displayAd.adUnit.nugget" :chw="chw" @chw-start-reward="chwDoIncentivized" @chw-mini-game-complete="chwMiniGameCompleted"></chicken-nugget-popup>
    </template>
</large-popup>

<!-- Popup: Generic Message -->
<small-popup id="genericPopup" ref="genericPopup" :popup-model="genericMessagePopup" :hide-cancel="true" @popup-closed="onSharedPopupClosed">
    <template slot="header">{{ loc[genericMessagePopup.titleLocKey] }}</template>
    <template slot="content">{{ loc[genericMessagePopup.contentLocKey] }}</template>
    <template slot="confirm">{{ loc[genericMessagePopup.confirmLocKey] }}</template>
</small-popup>

<!-- Popup: Anon warning message -->
<small-popup v-if="isAnonymous" id="anonWarningPopup" ref="anonWarningPopup" :hide-close="true" :overlay-close="false" @popup-cancel="anonWarningPopupCancel" @popup-confirm="anonWarningPopupConfrim">
    <template slot="header">{{ loc.account_anon_warn_popup_title }}!</template>
    <template slot="content">
        <p v-html="loc.account_anon_warn_paragraph_block"></p>
    </template>
    <template slot="cancel">{{ loc.pwa_no_thanks }}</template>
    <template slot="confirm">{{ loc.sign_in }}</template>
</small-popup>

<!-- Popup: Need More eggs popup -->
<small-popup id="needMoreEggsPopup" ref="needMoreEggsPopup" @popup-confirm="showEggStorePopup">
    <template slot="header">{{ loc.p_buy_isf_title }}!</template>
    <template slot="content">
        <p>{{ loc.p_buy_isf_content }}.</p>
    </template>
    <template slot="cancel">{{ loc.p_buy_item_cancel }}</template>
    <template slot="confirm">{{ loc.account_title_eggshop }}</template>
</small-popup>

<!-- Popup: Firebase Sign In -->
<large-popup id="firebaseSignInPopup" ref="firebaseSignInPopup" :overlay-close="false">
    <template slot="content">
        <h1 class="nospace">{{ loc.sign_in }}</h1>
        <div id="firebaseui-auth-container"></div>
        <div id="btn_horizontal" class="f_center">
            <button @click="onSignInCancelClicked()" class="ss_button btn_red bevel_red btn_sm">{{ loc.cancel }}</button>
        </div>
    </template>
</large-popup>

<small-popup ref="adBlockerPopup" id="adBlockerPopup" :overlay-close="false" hide-confirm="true" hide-cancel="true" hide-close="true">
    <template slot="header">
    We've detected ad blocker!
    </template>
    <template slot="content">
        <p>To <i>avoid</i> this message please turn <i>off</i> ad blocker.</p>
        <h4>Please wait</h4>
        <h3>{{adBlockerCountDown}}</h3>
    </template>   
</small-popup>

<!-- Popup: PWA -->
<small-popup id="pwaPopup" class="pwa-popup" ref="pwaPopup" hide-confirm="true" @popup-closed="onSharedPopupClosed">
    <!-- <template slot="header">{{ loc.p_settings_privacy }}</template> -->
    <template slot="content">
        <p>{{loc.pwa_desc_one}}</p>
        <p>{{loc.pwa_desc_two}}</p>
        <button @click="pwaBtnClick" class="ss_button btn_big btn_green bevel_green btn_height_auto btn-pwa-download">
            <div class="pwa-btn-img-box roundme_lg bg-darkgreen">
                <img src="favicon192.png" alt="Egg yolk">
                <i class="fas fa-share" aria-hidden="true"></i>
            </div>
            {{loc.pwa_btn_line_one}}<br>{{loc.pwa_btn_line_two}}
        </button>
    </template>
    <template slot="cancel">{{loc.pwa_no_thanks}}</template>
</small-popup>

<large-popup id="adBlockerVideo" ref="adBlockerVideo" @popup-closed="onSharedPopupClosed" :overlay-close="false" hide-confirm="true" hide-cancel="true" hide-close="true">
    <template slot="content">
        <p class="text-center">{{ loc.ad_blocker_big_popup_title }}<br> <span v-html="loc.ad_blocker_big_popup_desc"></span></p>
        <img src="img/shellshockers-unite-lg.png" alt="">
        <!-- <house-ad id="house-ad-video-replacement" ref="house-ad-video-replacement" :data="bannerHouseAd" :isshowing="showAdBlockerVideoAd"></house-ad> -->
    </template>
</large-popup>

<large-popup ref="mobileAdPopup" id="mobileAdPopup" :overlay-close="true" hide-confirm="true" hide-cancel="true">
    <template slot="content">
        <img src="img/events/shell-mobile-popup-bg-qr.png" alt="Get Shell Shockers Mobile app!">
    </template>   
</large-popup>

<large-popup ref="kotcInstrucPopup" id="kotcInstrucPopup" :overlay-close="true" hide-confirm="true" hide-cancel="true">
    <template slot="content">
        <img class="kotc-wordmark" src="img/kotc/kotc-wordmark.svg" alt="">
        <div class="kotc-how-to-play-wrapper box_aboslute">
            <h2 class="kotc-how-to-play-title text-center"><span class="roundme_md">{{ loc.home_kotc_popup_how_to }}</span><br>{{ loc.home_play }}!</h2>
            <img src="img/kotc/kotc-arrow.svg" aria-hidden="true">
        </div>
        <div class="display-grid grid-column-2-eq grid-gap-space-lg fullwidth ss_margintop_xxxxl">
            <div class="img-container roundme_lg fullwidth step-one">
                <div class="fullwidth">
                    <p class="text-center"><span class="sr-only">Step </span>1</p>
                    <h6 class="text-center">{{loc.home_kotc_popup_step_one}}</h6>
                </div>
            </div>
            <div class="img-container roundme_md fullwidth step-two">
                <div class="fullwidth">
                    <p class="text-center"><span class="sr-only">Step </span>2</p>
                    <h6 class="text-center">{{loc.home_kotc_popup_step_two}}</h6>
                </div>
            </div>
        </div>
        <div class="display-grid grid-column-2-eq grid-gap-space-lg roundme_md fullwidth ss_margintop_lg kotc-play-now step-three-wrapper">
            <div class="fullwidth box_relative step-three">
                <img class="kotc-logo box_aboslute" src="img/kotc/kotc-rooster.svg" alt="The King of the Coop Rooster">

                <div>
                    <p class="text-center"><span class="sr-only">Step </span>3</p>
                    <h6 class="text-center" v-html="loc.home_kotc_popup_step_three"></h6>
                </div>
            </div>
            <div class="fullwidth f_col f_space_between">
                <div class="display-grid grid-column-5-eq kotc-crowns">
                <img aria-hidden="true" src="img/kotc/kotc-crown.svg" alt="Crowns">
                <img aria-hidden="true" src="img/kotc/kotc-crown.svg" alt="Crowns">
                <img aria-hidden="true" src="img/kotc/kotc-crown.svg" alt="Crowns">
                <img aria-hidden="true" src="img/kotc/kotc-crown.svg" alt="Crowns">
                <img aria-hidden="true" src="img/kotc/kotc-crown.svg" alt="Crowns">
                </div>
                <button class="ss_button btn_big btn_green bevel_green fullwidth" @click="onClickPlayKotcNow"><i class="fa fa-play fa-sm"></i> {{ loc.home_play }}</button>
            </div>
        </div>
    </template>   
</large-popup>

<large-popup ref="scavengerHunt" id="scavengerHunt" @popup-closed="onSharedPopupClosed" :overlay-close="true">
    <template slot="content">
        <img src="img/scavenger-800x600.png" alt="Attention: Scavenger hunt!" @click="onClickScavengerPopup">
        <button class="ss_button btn_green bevel_green btn_big ss_margintop_lg" @click="onClickScavengerPopup"> Join Discord</button>
    </template>
</large-popup>

<large-popup ref="notificationPopup" id="notificationPopup" @popup-closed="onSharedPopupClosed" :overlay-close="false" :hide-close="true">
    <template slot="header">Notifications</template>
    <template slot="content">
        <notification-content ref="notifiContent" :notification="ui.notification" :loc="loc" :bonus="ui.bonus.showing" @open-bundle="onOpenBundle" @close-popup="onCloseNotification"></notification-content>
    </template>
</large-popup>

<!-- Popup: Banned -->
<large-popup id="bannedPopup" ref="bannedPopup" hide-close="true">
    <template slot="content">
        <h1>{{ loc['banned_title'] }}</h1>
        <p>{{ loc['banned_msg'] }}</p>
        <p>{{ loc['banned_expire'] }} {{ bannedPopup.expire }}</p>
    </template>
</large-popup>
<!--
<small-popup id="openUrlPopup" ref="openUrlPopup" @popup-confirm="onOpenUrlPopupConfirm" @popup-closed="onSharedPopupClosed">
    <template slot="header">{{ loc[openUrlPopup.titleLocKey] }}</template>
    <template slot="content">
        {{ openUrlPopup.content }}
    </template>
    <template slot="cancel">{{ loc[openUrlPopup.cancelLocKey] }}</template>
    <template slot="confirm">{{ loc[openUrlPopup.confirmLocKey] }}</template>
</small-popup>
-->



<small-popup id="deleteAccountApprovalPopup" ref="deleteAccountApprovalPopup" @popup-confirm="onAccountDelectionConfirmed">
<!-- <template slot="header">{{ loc.p_settings_privacy }}</template> -->
    <template slot="content">
        <h1 v-html="loc.feedback_account_deletion_title"></h1>
        <p class="text-center">
            <i class="fas fa-exclamation-triangle fa-2x text_red"></i>
        </p>
        <p v-html="loc.feedback_account_deletion_desc_1"></p>
        <p v-html="loc.feedback_account_deletion_desc_2"></p>
    </template>
    <template slot="cancel">{{loc.cancel}}</template>
    <template slot="confirm">{{loc.feedback_account_delection_confirm}}</template>
</small-popup>

<!-- Popup: Leave Game Confirm -->
<small-popup id="leaveGameConfirmPopup" ref="leaveGameConfirmPopup" :overlay-close="false" :hide-close="true" @popup-confirm="onLeaveGameConfirm" @popup-cancel="onLeaveGameCancel" @popup-opened="sharedIngamePopupOpened" @popup-closed="sharedIngamePopupClosed">
    <template slot="header">{{ loc.leave_game_title }}</template>
    <template slot="content">
        <p>{{ loc.leave_game_text }}</p>
    </template>
    <template slot="cancel">{{ loc.no }}</template>
    <template slot="confirm">{{ loc.yes }}</template>
</small-popup>

<small-popup id="fbTransferAccountSignin" ref="fbTransferAccountSignin" :hide-confirm="true" :overlay-close="false" @popup-cancel="onLeaveGameCancel" @popup-opened="sharedIngamePopupOpened" @popup-closed="sharedIngamePopupClosed">
    <!-- <template slot="header">{{ loc.leave_game_title }}</template> -->
    <template slot="content">
        <p>{{ loc.signin_fb_msg}}</p>
    </template>
    <template slot="cancel">{{ loc.close }}</template>
    <!-- <template slot="confirm">{{ loc.yes }}</template> -->
</small-popup>

<!-- Popup: Tutorial -->
<small-popup id="tutorialPopup" ref="tutorialPopup" :hide-confirm="true" :hide-cancel="true" @popup-closed="onTutorialClosed">
        <template slot="header">{{ loc.tutorial_title }}</template>
        <template slot="content">
            <div class="box_relative display-grid grid-template tutorial-labels">
                <span v-for="(item, idx) in ui.tutorialPopup.keys" :key="idx" v-html="loc[item.locKey]" class="box_absolute" :class="item.cls"></span>
                <img src="img/tutorial/ss_tutorial_Keyboard.png" class="tutorial-keyboard" alt="Tutorial keyboard image">
                <img src="img/tutorial/ss_tutorial_Mouse.png" class="tutorial-mouse" alt="Tutorial mouse image">
            </div>
            <div class="tutorial-content display-grid align-items-center center_h">
                <div>
                    <img src="img/tutorial/ss_tutorial_EggTarget.png" class="tutorial-egg" alt="Tutorial egg image">
                </div>
                <ul class="tutorial-list list-no-style">
                    <li class="text-left">{{ loc.tutorial_point_1 }}</li>
                    <li class="text-left">{{ loc.tutorial_point_2 }}</li>
                    <li class="text-left">{{ loc.tutorial_point_3 }}</li>
                </ul>
            </div>
        </template>
    </small-popup>

        <!-- Popup: xsollaPopup -->
        <small-popup id="xsollaPopup" ref="xsollaPopup" @popup-confirm="xsollaPopupConfrim" @popup-cancel="xsollaPopupCancel">
            <template slot="header">Warning!</template>
            <template slot="content">
                <div>Welcome to our exciting world of egg recipe experiments! Please note that while we're eager to explore the endless possibilities, we cannot guarantee the outcome of all purchases. So, let's embark on this culinary adventure together, but be prepared for the occasional crack in the shell. Happy cooking!</div>
            </template>
            <template slot="cancel">{{ loc.cancel }}</template>
            <template slot="confirm">Continue</template>
        </small-popup>

<!-- <div id="kotc-play-kotc" class="kotc-play-kotc display-grid">
    <img class="kotc-play-kotc-watermark" src="img/kotc/kotc-crown-indicator.svg" alt="">
    <img class="kotc-play-kotc-arrow" src="img/kotc/kotc-arrow.svg" aria-hidden="true">
</div> -->
<!-- #kotc-play-kotc -->
</div> <!-- End of vue instance div -->


<script>
var vueApp;
var vueData = {
ready: false,
accountSettled: false,
missingFeatures: [],
showChangelogHistoryBtn: true,
itemSearchVal: '',
changelog: {
    version: '',
    current: [],
    history: [],
    showHistoryBtn: true
},

onClickSignIn: false,

firebaseId: null,
photoUrl: null,
maskedEmail: null,
isEmailVerified: false,
isAnonymous: true,
showPrivacyOptions: isFromEU,
isOfAge: false,
showTargetedAds: false,
delayTheCracking: false,
displayAdFunction: Function,
titleScreenDisplayAd: Function,
displayAdObject: false,
hideAds: false,

feedbackSelected: null,

isPoki: false,
isPokiGameLoad: false,
pokiRewardReady: false,
isPokiNewRewardTimer: false,
videoRewardTimers: {
    initial: 300000,
    primary: 420000
},

pokiRewNum: 1,


displayAd: {
    adUnit: {
        home: 'shellshockers_titlescreen',
        nugget: 'shellshockers_chicken_nugget_banner',
        house: 'ShellShockers_LoadingScreen_HouseAds',
        spinner: 'shellshockers_respawn_banner',
        respawn: RESPAWNADUNIT,
        respawnTwo: RESPAWN2ADUNIT
    }
},

cGrespawnBannerTimeout: null,
cGrespawnBannerErrors: 0,

classIdx: 0,
playerName: '',
eggs: 0,
kills: 0,
deaths: 0,
kdr: 0,
streak: 0,
accountCreated: null,
kdrLifetime: 0,
statsCurrent: {},
statsLifetime: {},
eggsSpent: 0,
eggsSpentMonthly: 0,
eggsEarnedBalance: 0,
isUpgraded: false,
upgradeName: '',
isSubscriber: false,
regionList: [], // Populated by Matchmaker API
currentRegionId: null,
currentRegionLocKey: '',
currentGameType: 0,
volume: 0,
   getMusicVolume: 0.5,

currentLanguageCode: 'en',

feedbackType: {
    comment: {id: 0, locKey: 'fb_type_commquest'},
    request: {id: 1, locKey: 'fb_type_request'},
    bug: {id: 2, locKey: 'fb_type_bug'},
    purchase: {id: 3, locKey: 'fb_type_purchase'},
    account: {id: 4, locKey: 'fb_type_account'},
    abuse: {id: 5, locKey: 'fb_type_abuse'},
    other: {id: 6, locKey: 'fb_type_other'},
    delete: {id: 7, locKey: 'fb_type_delete'}
},

icon: {
    inventory : 'ico-nav-equipment',
    shop: 'ico-nav-shop',
    invite: 'fas fa-user-friends',
    home: 'ico-nav-home',
    user: 'ico-nav-profile',
    settings: 'fas fa-cog',
    fullscreen: 'fas fa-expand-alt',
    egg: 'fas fa-egg',
    dollar: 'fas fa-dollar-sign'
},

showScreen: 0,
previousScreen: 0,
screens: {
    home: 0,
    equip: 1,
    game: 2,
    profile: 3,
    photoBooth: 4,
},

currentEquipMode: null,

equipMode: {
    inventory: 0,
    gear: 1,
    featured: 2,
    skins: 3,
    shop: 4,
},

ui: {
    overlayType: {
        none: 0,
        dark: 1,
        light: 2,
    },
    overlayClass: {
        inGame: 'overlay_game'
    },
    team: {
        blue: 1,
        red: 2
    },
    houseAds: {
        small: null,
        big: null,
        homeScreen: []
    },
    showCornerButtons: true,
    hideUi: false,
    showHomeEquipUi: true,

    events: {
        twitch: true,
    },

    photoBooth: {
        type: 1,
        vignette: false,
    },

    tutorialPopup: {
        show: false,
        keys: [
            { locKey: 'keybindings_grenade', cls: 'tutorial-grenade' },
            { locKey: 'keybindings_melee', cls: 'tutorial-melee' },
            { locKey: 'keybindings_reload', cls: 'tutorial-reload' },
            { locKey: 'keybindings_fire', cls: 'tutorial-shoot' },
            { locKey: 'keybindings_aim', cls: 'tutorial-aim' },
            { locKey: 'keybindings_jump', cls: 'tutorial-jump' },
            { locKey: 'keybindings_swapweapon', cls: 'tutorial-swap-weapons' },
            { locKey: 'tutorial_move_up', cls: 'tutorial-move-up' },
            { locKey: 'tutorial_move_down', cls: 'tutorial-move-down' },
            { locKey: 'tutorial_move_left', cls: 'tutorial-move-left' },
            { locKey: 'tutorial_move_right', cls: 'tutorial-move-right' },
            { locKey: 'tutorial_q', cls: 'tutorial-q tutorial-special-keys tutorial-key-top text-uppercase text_blue5' },
            { locKey: 'tutorial_w', cls: 'tutorial-w tutorial-special-keys tutorial-key-top text-uppercase text_blue5' },
            { locKey: 'tutorial_e', cls: 'tutorial-e tutorial-special-keys tutorial-key-top text-uppercase text_blue5' },
            { locKey: 'tutorial_r', cls: 'tutorial-r tutorial-special-keys tutorial-key-top text-uppercase text_blue5' },
            { locKey: 'tutorial_a', cls: 'tutorial-a tutorial-special-keys tutorial-key-bottom text-uppercase text_blue5' },
            { locKey: 'tutorial_s', cls: 'tutorial-s tutorial-special-keys tutorial-key-bottom text-uppercase text_blue5' },
            { locKey: 'tutorial_d', cls: 'tutorial-d tutorial-special-keys tutorial-key-bottom text-uppercase text_blue5' },
            { locKey: 'tutorial_f', cls: 'tutorial-f tutorial-special-keys tutorial-key-bottom text-uppercase text_blue5' },
            { locKey: 'tutorial_spacebar', cls: 'tutorial-spacebar tutorial-special-keys text-uppercase text_blue5'},
            { locKey: 'tutorial_move_shift', cls: 'tutorial-shift tutorial-special-keys text-uppercase text_blue5' },
        ],
        imgKeys: '',
        imgMouse: '',
    },

    notification: null,
    bonus: {
        showing: false,
        amount: 1000
    },

    mainMenu: [
        {
            locKey: 'account_title_home',
            icon: 'ico-nav-home',
            screen: 0,
            mode: [],
            hideOn: [2],
        },
        {
            locKey: 'account_title_profile',
            icon: 'ico-nav-profile',
            screen: 3,
            mode: [],
            hideOn: [],
        },
        {
            locKey: 'p_pause_equipment',
            icon: 'ico-nav-equipment',
            screen: 1,
            mode: [0],
            hideOn: [],
        },
        {
            locKey: 'eq_shop',
            icon: 'ico-nav-shop',
            screen: 1,
            mode: [3, 4, 2],
            hideOn: [],
        },
        // {
        // 	locKey: 'screen_photo_booth_menu',
        // 	icon: 'ico-nav-shop',
        // 	screen: 4,
        // 	mode: [],
        // 	hideOn: [],
        // },
    ],
    profile: {
        statTab: 0,
        statTabClicked: false
    },
    playerListOverflow: false,
    typeSelectors: [
        {
            img: ItemIcons.Primary,
            type: ItemType.Primary
        },
        {
            img: ItemIcons.Secondary,
            type: ItemType.Secondary
        },
        {
            img: ItemIcons.Stamp,
            type: ItemType.Stamp
        },
        {
            img: ItemIcons.Hat,
            type: ItemType.Hat
        },
        {
            img: ItemIcons.Grenade,
            type: ItemType.Grenade
        },
        {
            img: ItemIcons.Melee,
            type: ItemType.Melee
        }
    ],

    socialMedia: {
        footer: [
            {name: 'Facebook', reward: 'Facebook', url: 'https://www.facebook.com/bluewizarddigital', imgPath: 'footer-social-media-bubble-facebook.png', icon: 'fa-facebook', id: 1227, owned: false},
            {name: 'Twitter', reward: 'Twitter', url: 'https://twitter.com/bluewizardgames', imgPath: 'footer-social-media-bubble-twitter.png', icon: 'fa-twitter', id: 1234, owned: false},
            {name: 'Instagram', reward: 'Instagram', url: 'https://www.instagram.com/bluewizardgames/', imgPath: 'footer-social-media-bubble-instagram.png', icon: 'fa-instagram', id: 1219, owned: false},
            {name: 'TikTok', reward: 'tiktok', url: 'https://www.tiktok.com/@bluewizarddigital', imgPath: 'footer-social-media-bubble-tiktok.png', icon: 'fa-tiktok', id: 1208, owned: false},
            {name: 'Discord', reward: 'discord', url: 'https://discord.gg/bluewizard', imgPath: 'footer-social-media-bubble-discord.png', icon: 'fa-discord', id: 1200, owned: false},
            {name: 'Steam', reward: 'Steam', url: 'https://store.steampowered.com/publisher/bluewizard', imgPath: 'footer-social-media-bubble-steam.png', icon: 'fa-steam-symbol', id: 1223, owned: false},
            {name: 'Twitch', reward: 'Twitch', url: 'https://www.twitch.tv/bluewizarddigital', imgPath: 'footer-social-media-bubble-twitch.png', icon: 'fa-twitch', id: 1268, owned: false},
            {name: 'newYolker', reward: '', url: 'https://bluewizard.com/subscribe-to-the-new-yolker', imgPath: '', icon: 'fa-envelope-open-text', id: null, owned: null},
        ],
        selected: ''
    },
    isEvent: {
        active: false,
        houseAdImg: '',
        homeBtnImg: '',
        popupImg: '',
        popupBtnLoc: '',

    },
    premiumFeaturedTag: '',
    game : {
        stats: {
            loading: false
        },
        spectate: false,
        spectatingPlayerName: null
    }
},

twitchLinked: 0,
twitchName: '',
languages: [
        { name: 'English', code: 'en' },
        { name: 'French', code: 'fr' },
        { name: 'German', code: 'de' },
        { name: 'Russian', code: 'ru' },
        { name: 'Spanish', code: 'es' },
        { name: 'Portuguese', code: 'pt' },
        { name: 'Korean', code: 'ko' },
        { name: 'Chinese', code: 'zh' },
        { name: 'Dutch', code: 'nl' }
    ],

locLanguage: {},
playTypes: {
    joinPublic: 0,
    createPrivate: 1,
    joinPrivate: 2
},

gameTypes: [
    { locKey: 'gametype_ffa', value: 0, order: 2 },
    { locKey: 'gametype_teams', value: 1, order: 1 },
    { locKey: 'gametype_ctf', value: 2, order: 0 },
    { locKey: 'gametype_king', value: 3, order: 3 },
],
// This makes me mad, but until Vue is put in the clojure with GameType,
// where it should have been to begin with, HERE IT IS >:(
gameTypeKeys: [
    'FFA',
    'Teams',
    'Spatula',
    'King'
],

reportReasons: [
    { locKey: 'report_reason_cheating', value: 1 },
    { locKey: 'report_reason_harassment', value: 2 },
    { locKey: 'report_reason_offensive', value: 4 },
    { locKey: 'report_reason_other', value: 8 }
],

banDurations: [
    { label: '5 Minutes', value: 0 },
    { label: '15 Minutes', value: 1 },
    { label: '1 hour', value: 2 }
],

twitchStreams: [],
youtubeStreams: [],
newsfeedItems: [
        { message: "Test 1 Lorem ipsum dolor sit amet, consectetur adipiscing elit.", image: "img/ico_news.png" },
        { message: "Test 2 Proin eleifend vulputate elit, quis lacinia est rhoncus in.", image: "img/ico_news.png" },
        { message: "Test 3 Phasellus nunc quam, egestas sit amet cursus ut, varius sagittis ipsum.", image: "img/ico_news.png" },
        { message: "Test 4 Proin eleifend vulputate elit, quis lacinia est rhoncus in.", image: "img/ico_news.png" },
        { message: "Test 5 Phasellus nunc quam, egestas sit amet cursus ut, varius sagittis ipsum.", image: "img/ico_news.png" }
    ],
maps: [],
settingsUi: {
    settings: [],
    adjusters: {
        misc: [
            { id: 'volume', locKey: 'p_settings_mastervol', min: 0, max: 1, step: 0.01, value: 1, multiplier: 100 }
        ],
        mouse: [
            { id: 'mouseSpeed', locKey: 'p_settings_mousespeed', min: 1, max: 100, step: 1, value: 30 }
        ],
        gamepad: [
            { id: 'sensitivity', locKey: 'p_settings_sensitivity', min: 1, max: 100, step: 1, value: 30 },
            { id: 'deadzone', locKey: 'p_settings_deadzone', min: 0, max: 1, step: 0.01, value: 0.3, precision: 2 }
        ],
        // music: [
        //     { id: 'musicVolume', locKey: 'p_settings_music_volume', min: 0, max: 1, step: 0.01, value: 0.5,  multiplier: 100 }
        // ],
    },
    togglers: {
        misc: [
            { id: 'holdToAim', locKey: 'p_settings_holdtoaim', value: true },
            { id: 'enableChat', locKey: 'p_settings_enablechat', value: true },
            { id: 'safeNames', locKey: 'p_settings_safenames', value: false },
            { id: 'autoDetail', locKey: 'p_settings_autodetail', value: true },
            { id: 'shadowsEnabled', locKey: 'p_settings_shadows', value: true },
            { id: 'highRes', locKey: 'p_settings_highres', value: false },
            // { id: 'musicStatus', locKey: 'p_settings_music', value: true }
        ],
        misc2: [
            { id: 'hideBadge', locKey: 'p_settings_badge_hide', value: false },
            { id: 'closeWindowAlert', locKey: 'p_settings_close_alert', value: false },
            { id: 'shakeEnabled', locKey: 'p_settings_shake', value: true },
            { id: 'centerDot', locKey: 'p_settings_center_dot', value: true },
        ],
        mouse: [
            { id: 'mouseInvert', locKey: 'p_settings_invertmouse', value: false },
            { id: 'fastPollMouse', locKey: 'p_settings_fastpollmouse', value: false },
        ],
        gamepad: [
            { id: 'controllerInvert', locKey: 'p_settings_invertcontroller', value: false },
        ]
    },
    controls: {
        keyboard: {
            // The ids map to the field names in settings.controls[category]
            game: [
                { id: 'up', side: 'left', locKey: 'keybindings_forward', value: 'W' },
                { id: 'down', side: 'left', locKey: 'keybindings_backward', value: 'S' },
                { id: 'left', side: 'left', locKey: 'keybindings_left', value: 'A' },
                { id: 'right', side: 'left', locKey: 'keybindings_right', value: 'D' },
                { id: 'jump', side: 'left', locKey: 'keybindings_jump', value: 'SPACE' },
                { id: 'melee', side: 'left', locKey: 'keybindings_melee', value: 'F' },
                { id: 'inspect', side: 'left', locKey: 'keybindings_inspect', value: 'G' },
                { id: 'fire', side: 'right', locKey: 'keybindings_fire', value: 'MOUSE 0' },
                { id: 'scope', side: 'right', locKey: 'keybindings_aim', value: 'SHIFT' },
                { id: 'reload', side: 'right', locKey: 'keybindings_reload', value: 'R' },
                { id: 'swap_weapon', side: 'right', locKey: 'keybindings_swapweapon', value: 'E' },
                { id: 'grenade', side: 'right', locKey: 'keybindings_grenade', value: 'Q' },
            ],
            spectate: [
                { id: 'ascend', locKey: 'keybindings_spectate_ascend', value: 'SPACE' },
                { id: 'descend', locKey: 'keybindings_spectate_descend', value: 'SHIFT' },
                { id: 'toggle_freecam', locKey: 'keybindings_spectate_freecam', value: 'V' }
            ]
        },
        gamepad: {
            // The ids map to the field names in settings.gamepad[category]
            game: [
                { id: 'jump', locKey: 'keybindings_jump', value: '0' },
                { id: 'fire', locKey: 'keybindings_fire', value: '1' },
                { id: 'scope', locKey: 'keybindings_aim', value: '2' },
                { id: 'reload', locKey: 'keybindings_reload', value: '3' },
                { id: 'swap_weapon', locKey: 'keybindings_swapweapon', value: '4' },
                { id: 'grenade', locKey: 'keybindings_grenade', value: '5' },
                { id: 'melee', locKey: 'keybindings_melee', value: '6' },
                { id: 'inspect', locKey: 'keybindings_inspect', value: '7' }
            ],
            spectate: [
                { id: 'ascend', locKey: 'keybindings_spectate_ascend', value: '1' },
                { id: 'descend', locKey: 'keybindings_spectate_descend', value: '2' }
            ]
        }
    }
},

songChanged: false,

music: {
    isMusic: false,
    musicJson: 'data/sponsors.json',
    musicSrc: '',
    theAudio: '',
    playing: false,
    sponsors: {},
    sponsor: '',
    currIndex: 0,
    currentTime: 0,
    duration: 0,
    timer: null,
    progress: 0,
    volume: 10,
    hideClass: 'music-widget--fade-out',
    serverTracks: {
        id: '',
        title: '',
        artist: '',
        album: '',
        albumArt: '',
        url: '',
        trackUrltest: 'https://shellshock.io',
        sponsor: '',
        sponsorUrl: '',
    }
},

home: {        
    joinPrivateGamePopup: {
        code: '',
        showInvalidCodeMsg: false,
        validate: function () {
            if (this.code.length == 0) {
                console.log('failed validation');
                this.showInvalidCodeMsg =true;
                BAWK.play('ui_reset');
                return false;
            }
            console.log('passed validation');
            return true;
        },
        reset: function () {
            this.code = '';
            this.showInvalidCodeMsg = false;
        }
    },
    gaugeData: {
        default: {
            min: 164,
            max: 196,
            default: 180,
        },
        min: 185,
        max: 195,
        loadvalue: 190,
        setValue: 180,
        active: false,
    },
},

hvsm: {
    hero: {
        name: 'Heroes',
        items: [],
        img: 'img/gauge-bar/shell_E&E_good_popup.png',
    },
    monster: {
        name: 'Monsters',
        items: [],
        img: 'img/gauge-bar/shell_E&E_evil_popup.png',
    },
},

equip: {
    get showingItems () {
        return this._showingItems;
    },
    set showingItems (items) {
        this._showingItems = items;
        for (let i = 0; i < this.lazyRenderTimeouts.length; ++i) {
            clearTimeout(this.lazyRenderTimeouts[__uv.$wrap((i))]);
        }
    },
    lazyRenderTimeouts: [],
    equippedPrimary: null,
    equippedSecondary: null,
    equippedHat: null,
    equippedStamp: null,
    equippedGrenade: null,
    posingHat: null,
    posingStamp: null,
    posingWeapon: null,
    posingGrenade: null,
    posingMelee: null,
    showingWeaponType: ItemType.Primary,
    selectedItemType: ItemType.Primary,
    itemSearchTerm:  '',
    itemSearchNone: false,
    itemSearchVal: '',
    selectedItem: null,
    _showingItems: [],
    buyingItem: null,
    colorIdx: 0,
    extraColorsLocked: true,
    categoryLocKey: null,
    showSpecialItems: false,
    specialItemsTag: null,
    showUnVaultedItems: [],
    bundlePopupItems: [],
    chwRewardBuyItem: false,
    bundle: {
        owned: false,
        items: [],
    },

    redeemCodePopup: {
        code: '',
        showInvalidCodeMsg: false,
        validate: function () {
            if (this.code.length == 0) {
                console.log('failed validation');
                this.showInvalidCodeMsg = true;
                BAWK.play('ui_reset');
                return false;
            }
            console.log('passed validation');
            return true;
        },
        reset: function () {
            this.code = '';
            this.showInvalidCodeMsg = false;
        }
    },

    physicalUnlockPopup: {
        item: null
    }
},

game: {
    on: false,
    isPaused: true,
    shareLinkPopup: {
        url: ''
    },
    gameType: 0,
    team: 1,
    respawnTime: 0,
    tipIdx: 0,
    isGameOwner: false,
    openPopupId: '',
    pauseScreen: {
        id: 'pausePopup',
        adContainerId: 'pauseAdPlacement',
        classChanged: false,
        wasGameInventoryOpen: false,
        mainContainer: '',
        canvas: '',
        showMenu: true,
    },
    disableRespawn: false,
    mapName: '',
    serverName: '',
},

isEvent: false,
doubleEggWeekendSoon: false,
doubleEggWeekend: false,
announcementMessage: null,

playerActionsPopup: {
    playerId: 0,
    uniqueId: 0,
    isGameOwner: false,
    playerName: '',
    muted: false,
    muteFunc: null,
    bootFunc: null,
    reportFunc: null,
    social: false,
    vipMember: false
},

banPlayerPopup: {
    reason: ''
},

reportPlayerPopup: {
    checked: [false, false, false, false]
},

giveStuffPopup: {
    titleLoc: '',
    eggs: 0,
    items: [],
    type: ''
},

openUrlPopup: {
    url: '',
    titleLocKey: '',
    contentLocKey: '',
    confirmLocKey: 'ok',
    cancelLocKey: 'no_thanks'
},

bannedPopup: {
    expire: ''
},

genericMessagePopup: {
    titleLocKey: 'keybindings_right',
    contentLocKey: 'p_popup_chicken_nuggetbutton',
    confirmLocKey: 'ok'
},

unsupportedPlatformPopup: {
    titleLocKey: 'unsupported_platform',
    contentLocKey: ''
},

windowDimensions: {
    width: 0,
    height: 0,
},

bannerAds: {
    bannerElId: '',
},

googleAnalytics: {
    isUser: null,
    cat: {
        purchases: 'Purchases',
        purchaseComplete: 'Purchase Complete',
        itemShop: 'Item Shop',
        inventory: 'Inventory',
        playerStats: 'player stats',
        play: 'play game',
        redeem: 'Redeem'
    },
    action : {
        eggShackClick: 'Egg Shack Click',
        eggShackProductClick: 'Egg Shack Product Click',
        purchaseComplete: 'Purchase Complete',
        goldenChickenProductClick: 'Golden Chicken Product Click',
        goldenChickenNuggetClick: 'Golden Chicken Nugget Click',
        shopClick: 'Shop Opened ',
        shopItemClick: 'Shop Item Selected',
        shopItemPopupClick: 'Shop Item Popup Click',
        shopItemPopupBuy: 'Item purchased',
        shopItemNeedMoreEggsPopup: 'Need More Eggs Popup',
        inventorySelected: 'Inventory Item ',
        eggCount: 'Egg Count',
        inventoryTabClick: 'Inventory Opened',
        playGameClick: 'Play Game Click',
        redeemed: 'Redeemed',
        redeemClick: 'Redeem open',
        languageSwitch: 'Language setting change',
        langBeforeUpdate: 'Language before auto detect',
        privateGame: 'Private Game',
        shareGamePopup: 'Share game Popup',
        shareGameCopy: 'Shared game code',
        createGame: 'Created game',
        joinGame: 'Joined game',
        playerLimit: 'Player limit',
        timesPlayed: 'Times played',
        anonymousPopupOpenAuto: 'Anon warning auto opened',
        anonymousPopupOpen: 'Anon warning opened',
        anonymousPopupSignupClick: 'Anon warning Sign in clicked',
        anonymousPopupAgreeClick: 'Anon warning Understood clicked',
        denyAnonUserPopup: 'Deny anon user popup',
        denyAnonUserPopupSignin: 'sign in click',
        faqPopupClick: 'FAQ popup open',
        switchTeams: 'Switched Teams',
        error: 'error',
        signIn: 'Sign in'
    },
    label : {
        signInClick: 'sign in click',
        understood: 'Understood click',
        getMoreEggs: 'Get More Eggs Click',
        waitForGameReadyTimeout: 'waitForGameReady timeout',
        signInAuthFailed: 'authorization failed',
        signInTiming: 'Sign in delay',
        signInCompleted: 'Completed',
        signInOut: 'Signed out',
        signInFailed: '',
        homeToGameLoading: 'Home to game loading',
        loading: 'Loading'
    }
},

urlParams: null,
urlParamSet: null,
adTagUrl: 'https://pubads.g.doubleclick.net/gampad/ads?iu=/21743024831/ShellShock_Video&description_url=__page-url__&env=vp&impl=s&correlator=&tfcd=0&npa=0&gdfp_req=1&output=vast&sz=640x480&unviewed_position_start=1',

eggStoreItems: [],
subStoreItems: [],
premiumShopItems: [],

eggStoreReferral:  '',
eggStoreHasSale:  false,
eggStorePopupSku:  'egg_pack_small',

showNugget:  true,
// isMiniGameComplete:  false,
miniEggGameAmount:  0,
showGoldenChicken:  false,
nugStart:  null,
nugCounter:  null,
isBuyNugget:  false,
adBlockerCountDown:  10,
controllerType:  'generic',
controllerId:  '',
controllerButtonIcons: {
    xbox: [
        'A',
        'B',
        'X',
        'Y',
        'LB',
        'RB',
        'LT',
        'RT',
        'Select',
        'Start',
        '<img class="ss_buttonbind_icon" src="img/controller/button_stickleft.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_stickright.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadup.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpaddown.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadleft.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadright.svg">'
    ],
    ps: [
        '<img class="ss_buttonbind_icon" src="img/controller/button_cross.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_circle.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_square.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_triangle.svg">',
        'LB',
        'RB',
        'LT',
        'RT',
        'Select',
        'Start',
        '<img class="ss_buttonbind_icon" src="img/controller/button_stickleft.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_stickright.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadup.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpaddown.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadleft.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadright.svg">'
    ],
    switchpro: [
        'B',
        'A',
        'Y',
        'X',
        'LB',
        'RB',
        'LT',
        'RT',
        '-',
        '+',
        '<img class="ss_buttonbind_icon" src="img/controller/button_stickleft.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_stickright.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadup.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpaddown.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadleft.svg">',
        '<img class="ss_buttonbind_icon" src="img/controller/button_dpadright.svg">'
    ],
    generic: [
        '0',
        '1',
        '2',
        '3',
        '4',
        '5',
        '6',
        '7',
        '8',
        '9',
        '10',
        '11',
        '12',
        '13',
        '14',
        '15'
    ]
},
pwaDeferEvent: '',
blackFridayBanner: false,
isSale: false,
   smallHouseAd: {},
bannerHouseAd: false,
showAdBlockerVideoAd: false,
hasMobileReward: false,

killName: null,
killedName: null,
killedByMessage: null,
killedMessage: null,

chw: {
    reward: {
        eggs: null,
        itemIds: [],
        ownedItems: null,
    },
    winnerCounter: 0,
    winnerDailyLimitReached: false,
    isError: false,
    miniGameComplete: true,
    hasPlayClicked: false,
    onClick: false,
    activeTimer: 6000,
    homeTimer: null,
    homeEl: null,
    signInClicked: false,
    adBlockDetect: false,

    hours: 0,
    minutes: 0,
    seconds: 0,
    progress: 0,
    limitReached: false,
    ready: false,
},

isChicknWinnerError: false,
chwMiniGameComplete: true,
hasChwPlayClicked: false,
chwActiveTimer: 6000,
chwHomeTimer: null,
chwHomeEl: null,
chwSignInClicked: false,

chwRewardIds: [],

contentCreator: false,
eggOrg: false,
playClicked: false,

dev: {
    store: {
        sku: null,
        sub: false,
    }
}
}// var vueData = new VueData();
</script>

<!-- Shared tags must come before the screen tags -->
<script id="events-template" type="text/x-template">
<div v-if="showEvent" id="event-notifications">
    <div class="double-eggs f_row align-items-center">
        <img :src="doubleEggEventUrl" />

    </div>
</div>
</script>
<script>
const comp_events = {
    template: '#events-template',
    props: ['show', 'currentScreen', 'screens'],
    mounted() {
        this.day = this.now.getUTCDay();
        this.hours = this.now.getUTCHours();
    },
    data() {
        return {
            now: new Date(),
            day: 0,
            hours: 0,
            doubleEggSoonImgSrc: 'img/events/2XEggWeekend_cominSoon.png',
            doubleEggLiveImgSrc: 'img/events/2XEggWeekend_onNow.png',
        };
    },
    methods: {
        isEventDate(days) {
            return days.includes(this.day);
        },
    },
    computed: {
        doubleEggWeekendSoon() {
            return this.isEventDate([4]) || this.isEventDate([5]) && this.hours < 20;
        },
        doubleEggWeekend() {
            return this.day >= 5 && this.hours >= 20 || this.isEventDate([6,0]);
        },
        doubleEggEventUrl() {
            if (this.doubleEggWeekendSoon && !this.doubleEggWeekend) {
                return this.doubleEggSoonImgSrc;
            } else if (!this.doubleEggWeekendSoon && this.doubleEggWeekend) {
                return this.doubleEggLiveImgSrc;
            }
        },
        showEvent() {
            return (this.doubleEggWeekendSoon || this.doubleEggWeekend) && this.currentScreen == this.screens.game;
        },
    }
};
</script><script>
var comp_light_overlay = {
template: `<transition name="fade">
<div id="lightOverlay" v-show="show" :class="overlayClass" class="overlay overlay_light"></div>
</transition>`,
data: function () {
    return {
        show: false,
        overlayClass: '',
    };
},
};
</script><script>
var comp_dark_overlay = {
template: `<transition name="fade">
<div id="darkOverlay" v-show="show" :class="overlayClass" class="overlay overlay_dark"></div>
</transition>`,
data: function () {
    return {
        show: false,
        overlayClass: '',
    };
},
};
</script><script id="spinner-overlay-template" type="text/x-template">
<transition name="fadeout">
    <div v-show="isShowing" class="load_screen align-items-center">
        <h3 class="load_message">{{ header }}</h3>
        <wobbly-egg></wobbly-egg>
        <p class="load_message">{{ footer }}</p>
        <div v-show="tip && isShowTips" class="spinner-tips display-grid">
            <img src="img/shellShockers_loadingTipEgg.png" />
            <p class="load_message tips" v-html="loc[tip]"></p>
        </div>
        <display-ad :hidden="hideAds" id="shellshockers_respawn_banner_spinner" ref="loadingScreenDisplayAd" class="pauseFiller" :ignoreSize="false" :adUnit="adUnit" adSize="728x90" :noRefresh="true"></display-ad>
    </div>
</transition>
</script>

<script id="wobble-egg-template" type="text/x-template">
<div id="wobbly-egg">
    <svg viewBox="0 0 240 240" :class="[loadEggcontainer, {noanimate: noAnimate}]" width="240" height="240" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <radialGradient r="0.5" cy="0.4" cx="0.4" id="load_yolkgradient" spreadMethod="pad">
                <stop stop-color="#fed" offset="0.3"/>
                <stop stop-color="#fb0" offset="0.32"/>
                <stop stop-color="#fa0" offset="1"/>
            </radialGradient>
        
            <filter id="load_eggshadow" :class="{noanimate: noAnimate}" x="-30%" y="-30%" width="160%" height="160%" >
                <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#124" flood-opacity="0.3" />
            </filter>
        </defs>
        <g>
            <path filter="url(#load_eggshadow)" :class="[loadEggwhite, {noanimate: noAnimate}]" stroke="#000" id="svg_eggwhite" d="m190.13055,40.86621c30.25552,23.71378 -12.26575,57.24017 0,81.77167c12.26575,24.5315 4.9063,80.13624 -33.52639,82.58939c-38.43269,2.45315 -55.60474,-26.16693 -94.03742,-17.98977c-38.43269,8.17717 -11.44803,-30.25552 -17.98977,-44.97442c-6.54173,-14.7189 -24.5315,-46.60985 -4.9063,-71.14135c9.8126,-12.26575 22.07835,-14.92333 34.95739,-15.02554c12.87904,-0.10221 19.01191,-15.63883 31.27766,-17.68312c12.26575,-2.04429 21.46506,17.58091 33.83303,11.2436c12.36797,-6.3373 35.26403,-20.64735 50.39179,-8.79045z" stroke-width="0" fill="#fff" />
        </g>
        <g>
            <ellipse :class="[loadEggyolk, {noanimate: noAnimate}]" ry="38" rx="38" id="svg_eggyolk" cy="120" cx="120" stroke-width="0" fill="url(#load_yolkgradient)"/>
        </g>
    </svg>
</div>
</script>
<script>
var comp_wobbly_egg = {
    template: '#wobble-egg-template',
    props: ['noAnimate'],
    
    data: function () {
        return {
            loadEggyolk: 'load_eggyolk',
            loadEggwhite: 'load_eggwhite',
            loadEggcontainer: 'load_eggcontainer'
        }
    }
};
</script>
<script>
var comp_spinner_overlay = {
template: '#spinner-overlay-template',
components: {
    'wobbly-egg': comp_wobbly_egg
},
props: ['loc', 'adblockerbanner', 'hideAds', 'adUnit', 'accountDate'],

data: function () {
    return {
        isShowing: false,
        header: '',
        footer: '',
        adIsShowing: false,
        isShowTips: false,
        tipKey: null,
        tips: [],
        tip: '',
    }
},

methods: {
    show: function (headerLocKey, footerLocKey, showTips) {
        this.header = this.loc[__uv.$wrap((headerLocKey))];
        this.footer = this.loc[__uv.$wrap((footerLocKey))];
        this.isShowing = true;
        this.isShowTips = showTips;
    },

    showSpinnerLoadProgress: function (percent) {
        var msg = this.loc[__uv.$wrap(('ui_game_loading'))];
        this.header = this.loc[__uv.$wrap(('building_map'))];
        this.footer = '{0}... {1}%'.format(msg, percent);
        this.isShowTips = true;
        this.isShowing = true;
    },

    hide: function () {
        this.isShowing = false;
        this.isShowTips = this.isShowing;
        this.$emit('close-display-ad');
    },

    hideDisplayAd() {
        this.adIsShowing = false;
        console.log('do it');
    },
    showDisplayAd() {
        this.adIsShowing = true;
    },
    toggleDisplayAd() {
        return this.adIsShowing = this.adIsShowing ? false : true;
    },
    getTipKey() {
        if (!this.accountDate) {
            this.tipKey = 'tipNew_';
        } else {
            if (!this.accountDays) {
                this.accountDays = Math.ceil((new Date().getTime() - new Date(this.accountDate).getTime()) / (1000 * 3600 * 24));
            }
            if (this.accountDays <= 14) {
                this.tipKey = 'tipNew_';
            } else {
                this.tipKey = 'tip_';
            }
        }
    },
    randomTip() {
        if (this.tipKey === null) {
            this.getTipKey();
        }
        if (this.tips.length === 0) {
            Object.keys(this.loc).forEach(key => {
                if (key.startsWith(this.tipKey)) {
                    this.tips.push(key);
                }
            });
        }
        this.tip = this.tips[__uv.$wrap((Math.floor(Math.random() * this.tips.length)))];
    }
},
watch: {
    isShowing(val, old) {
        if (val && !old) {
            this.randomTip();
        }
    }
}
};
</script><script id="small-popup-template" type="text/x-template">
<transition name="fade">
    <div v-show="isShowing" class="popup_window popup_sm roundme_md centered">
        <div>
            <button v-show="!hideClose" @click="onXClick" class="roundme_sm popup_close clickme"><i class="fas fa-times text_white fa-2x"></i></button>
            <h3 id="popup_title" v-show="!hideHeader" class="roundme_sm shadow_blue4 nospace text_white">
                <slot name="header"></slot>
            </h3>
        </div>
        <div v-show="!hideContent" class="popup_sm_content"><slot name="content"></slot></div>
        <div id="btn_horizontal" class="f_center">
            <button class="ss_button btn_red bevel_red width_sm" v-show="!hideCancel" @click="cancelClick"><slot name="cancel"></slot></button>
            <button class="ss_button btn_green bevel_green width_sm" v-show="!hideConfirm" @click="confirmClick"><slot name="confirm"></slot></button>
        </div>
        <slot name="footer"></slot>
    </div>
</transition>
</script>

<script id="large-popup-template" type="text/x-template">
<transition name="fade">
    <div id="popupPause" v-show="isShowing" class="popup_window popup_lg centered roundme_md" :class="setOverlayCls">
        <button @click="onXClick" v-show="!hideClose" class="popup_close clickme roundme_sm"><i class="fas fa-times text_white fa-2x"></i></button>
        <slot name="content"></slot>
    </div>
</transition>
</script>

<script>
// Register popup components globally
Vue.component('small-popup', createPopupComponent('#small-popup-template'));
Vue.component('large-popup', createPopupComponent('#large-popup-template'));

function createPopupComponent(templateId) {
return { 
    template: templateId,
    props: ['hideHeader', 'hideContent', 'hideClose', 'hideCancel', 'hideConfirm', 'overlayType', 'overlayClass', 'popupModel', 'uiModel', 'stopKeyCapture', 'overlayClose'],
    data: function () {
        return {
            isShowing: false,
            overlays: vueData.ui.overlayType,
            popupId: '',
            removeOverlayClick: ''
        }
    },

    created() {
        this.popupId = this.$attrs && this.$attrs.id;
    },

    destroyed: function() {
        document.removeEventListener('keyup', this.escapeKeyClose);
    },

    methods: {
        setVisible: function (visible) {

            this.isShowing = visible;

            if (extern.inGame) {
                if (this.isShowing) {
                    extern.releaseKeys();	
                } else {
                    extern.captureKeys();
                 }
            }

            if (this.isShowing && this.popupModel && this.popupModel.reset) {
                this.popupModel.reset();
            }

            if (!this.isShowing || this.overlayType === this.overlays.none || this.popupId === 'pausePopup') {
                vueApp.setDarkOverlay(false);
                vueApp.setLightOverlay(false);
            } else {
                vueApp.setDarkOverlay(true);
            }

            if (!this.isShowing) {
                console.log('Closed: ' + this.popupId);
                this.$emit('popup-closed', this.popupId);
                vueApp.gameUiRemoveClassForNoScroll();
                this.cancelEventOverLayClickEscapeClose();
            } else {
                console.log('Opened: ' + this.popupId);
                this.$emit('popup-opened', this.popupId);
                vueApp.scrollToTop();
                vueApp.gameUiAddClassForNoScroll();
                this.addEventListeners();
            }

            if (!extern.inGame) {
                vueApp.toggleTitleScreenAd();
            }

        },

        toggle: function () {
            this.isShowing = !this.isShowing;

            this.setVisible(this.isShowing);
        },
        
        show: function () {
            this.setVisible(true);
        },

        hide: function () {
            this.setVisible(false);
        },

        close: function () {
            this.setVisible(false);
            console.log('Closing');
        },

        onCloseClick: function () {
            this.close();
            BAWK.play('ui_popupclose');
        },

        onXClick: function () {
            this.$emit('popup-x');
            this.close();
            BAWK.play('ui_popupclose');
        },

        cancelClick: function () {
            this.close();
            this.$emit('popup-cancel');
            BAWK.play('ui_popupclose');
        },

        confirmClick: function () {
            if (this.popupModel && this.popupModel.validate && !this.popupModel.validate()) {
                return;
            }
            this.close();
            this.$emit('popup-confirm');
            BAWK.play('ui_playconfirm');
        },

        addEventListeners: function() {
            document.addEventListener('click', this.handleOutsideClick);
            document.addEventListener('keyup', this.escapeKeyClose);
        },

        escapeKeyClose: function(e) {
            if (hasValue(this.overlayClose)) {
                return;
            }
            if ((this.overlayClose === undefined || hasValue(this.overlayClose)) && e.keyCode === 27) {
                e.stopPropagation();
                this.onCloseClick();

            }
        },

        handleOutsideClick: function(e) {
            if (this.overlayClose === undefined || this.overlayClose !== false) {
                e.stopPropagation();
                if ( e.target.id.includes('Overlay') ) {
                    this.onCloseClick();
                }
            }
        },

        cancelEventOverLayClickEscapeClose: function() {
            document.removeEventListener('click', this.handleOutsideClick);
            document.removeEventListener('keyup', this.escapeKeyClose);
        }
    },
    computed: {
        setOverlayCls() {
            if (extern.inGame) {
                return 'overlay_game';
            }
        }
    }
}
}
</script>
<script>
const SvgIcon = {
    template:
        `<svg :class="cls">
            <use :xlink:href="svgName"></use>
        </svg>`,
    props: ['name', 'cls'],
    // data() {
    // 	return {
    // 	};
    // },
    // methods: {
    // },
    computed: {
        svgName() {
            return `#${this.name}`;
        }
    },
};
// Register component globally
Vue.component('icon', SvgIcon);
</script><template id="comp-ss-button" type="text/x-template">
<button :id="btnId" :class="cls" class="ss_button"><i v-if="iconLeft" class="iconLeft"></i> {{ locTxt }} <i v-if="iconRight" class="iconRight"></i></button>
</template>

<template id="comp-ss-button-dropdown-template" type="text/x-template">
<button ref="ssDropDown" :id="btnId" @click="onDropdownClick" class="is-for-play ss_button btn_dropdown btn_big common-box-shadow btn_game_mode bg_blue6 text-left box_relative ss-dropdown-select" :class="clsBtn">
    <h3 class="ss-dropdown-select text_blue3" :class="btnId">{{ locTxt.title }}</h3>
    <p class="game-mode-type ss-dropdown-select text_blue5" :class="btnId">{{ locTxt.subTitle }}</p>
    <span class="open-close centered_y ss-dropdown-select" :class="btnId">
        <i class="fas ss-dropdown-select" :class="[caretDirection, btnId, cartOnOpen]"></i>
    </span>
    <div :class="menuPosClass" class="option-box box_absolute roundme_sm common-box-shadow bg_blue6" v-show="isPromptOpen">
        <ul ref="optionBoxList" class="list-no-style nospace ss-dropdown-select f_col">
            <li v-if="listItems" ref="items" v-for="(g, idx) in dropdownList" :class="{ 'selected' : selectedItem === g.value || selectedItem === idx || selectedItem === g.id }" class="display-grid gap-sm align-items-center text_blue5 font-nunito" @click="onListItemClick(g, idx)"><div class="f_row align-items-center"><icon v-show="selectedItem === g.value" class="option-box-checkmark" name="ico-checkmark"></icon></div> {{ listItemTxt(g) }}</li>
            <slot name="dropdown"></slot>
        </ul>
    </div>
</button>
</template>

<script>
const createSsBtn = (tempId) => {
    return {
        template: tempId,
        props: ['loc', 'cls', 'locTxt', 'iconRight', 'iconLeft', 'listItems', 'selectedItem', 'menuDown', 'menuPos', 'sort', 'locList'],
        data: function() {
            return {
                isPromptOpen: false,
                btnId: 'btn-' + (Math.random() + 1).toString(36).substring(7),
                onClickVal: null,
                caret: {
                    up: 'fa-caret-up',
                    down: 'fa-caret-down',
                    right: 'fa-caret-right',
                    rotate: 'fa-rotate-180'
                }
            }
        },		
        methods: {
            onListItemClick(val, idx) {
                if (val.value !== undefined) {
                    this.onClickVal = val.value;
                } else if (val.subdom !== undefined) { 
                    this.onClickVal = val.id;
                } else {
                    this.onClickVal = idx;
                }
                this.$emit('onListItemClick', this.onClickVal);
            },
            onDropdownClick(e) {
                if (!this.isPromptOpen) {
                    this.isPromptOpen = true;
                    this.$emit('dropdownOpen');
                    document.addEventListener('click', this.onOutsideClick);
                } else {
                    this.isPromptOpen = false;
                    this.$emit('dropdownClosed');
                    document.removeEventListener('click', this.onOutsideClick);
                }
            },
            onOutsideClick(e) {
                if (this.isPromptOpen) {			
                    if (e.target.classList.contains(this.btnId) === false) {
                        this.isPromptOpen = false;
                        this.$emit('dropdownClosed');
                        document.removeEventListener('click', this.onOutsideClick);
                    }
                }
            },
            listItemTxt(val) {
                if (val.name !== undefined) {
                    if (this.locList !== undefined) {
                        return this.loc[__uv.$wrap((val.name))];
                    }
                    return val.name;
                } else {
                    return this.loc[__uv.$wrap((val.locKey))];
                }
            }
        },
        computed: {
            menuPosClass() {
                if (this.menuPos === 'bottom') {
                    return 'pos-bottom';
                } else if (this.menuPos === 'right') {
                    return 'pos-right';
                }
            },
            caretDirection() {
                if (this.menuPos === 'bottom') {
                    return this.caret.down;
                } else if (this.menuPos === 'right') {
                    return this.caret.right;
                } else {
                    return this.caret.up;
                }
            },
            cartOnOpen() {
                if (this.isPromptOpen) {
                    return this.caret.rotate;
                } 
            },
            clsBtn() {
                return `${this.cls} ${this.btnId}`;
            },
            dropdownList() {
                if (this.sort) {
                    return this.listItems.sort((a, b) => {
                        return a.order - b.order;
                    });
                } else {
                    return this.listItems;
                }
            }
        },
        watch: {
            isPromptOpen(val) {
                BAWK.play('ui_toggletab');

            }
        }
    };
}
Vue.component('ss-button', createSsBtn('#comp-ss-button'));
Vue.component('ss-button-dropdown', createSsBtn('#comp-ss-button-dropdown-template'));
</script><template id="house-display-ad">
<transition name="fade">
    <figure v-if="isshowing &amp;&amp; data" class="house-wrap">
        <img :src="src" :alt="title" @click="adClicked">
    </figure>
</transition>
</template>

<script>
function createHouseAd() {
    return {
        template: '#house-display-ad',
        props: ['isshowing', 'data'],
        data() {
            return {
                count: 0
            }
        },
        methods: {
            adClicked() {
                if ('link' in this.data) {
                    this.data.link = this.data.link + '/?utm_source=shell_shockers&utm_medium=referral&utm_campaign=house-ads';
                }
                extern.clickedHouseLink(this.data);
            }
        },
        computed: {
            src() {
                return dynamicContentPrefix + `data/img/art/${this.data.id}${this.data.imageExt}`;
            },
            alt() {
                return `${this.data.label} banner image!`;
            },
            link() {
                return `${this.data.link}/?utm_source=shell_shockers&utm_medium=referral&utm_campaign=house-ads`;
            },
            title() {
                return `Play ${this.data.label} now!`;
            }

        }
    }
}

Vue.component('house-ad', createHouseAd());

</script><script id="display-ad-template" type="text/x-template">
<div>
    <div v-show="isAdShowing" :id="id" class="display-ad-container" :class="theClass"></div>
    <house-ad :data="houseAdData" :isshowing="isAdShowing && houseAdData && adBlocker"></house-ad>
</div>
</script>

<script>

// Register popup components globally
Vue.component('display-ad', createDisplayAdComponent('#display-ad-template'));

function createDisplayAdComponent(templateId) {
return { 
    template: templateId,
    props: {
        id: String,
        adUnit: String,
        isHidden: Boolean,
        poki: Boolean,
        adSize: String,
        override: Boolean,
        houseAd: Boolean,
        ignoreSize: Boolean,
        noRefresh: Boolean,
    },
    data: function () {
        return {
            isAdShowing: false,
            hideAds: false,
            theAd: '',
            houseAdData: '',
            adBlocker: false,
            hasShown: false,
        }
    },
    mounted() {
        this.$nextTick(() => {
            this.getTheAd();
        });
        this.override = this.override || false;
    },
    methods: {
        getTheAd() {
            this.theAd = document.getElementById(this.adUnit);
            if (pokiActive || extern.productBlockAds) {
                return;
            }
            const wrap = document.getElementById(this.id);
            wrap.appendChild(this.theAd);

            if (this.houseAd && !crazyGamesActive && !pokiActive) {
                googletag.cmd.push(function() { googletag.display('ShellShockers_LoadingScreen_HouseAds') });
            }
        },
        setVisible(visible) {
            if (vueData.isUpgraded) {
                console.log('Upgrade hides ads');
                this.isAdShowing = false;
                return;
            }
            if (extern.productBlockAds) {
                console.log('Closure hides ads');
                this.isAdShowing = false;
                return;
            };

            this.isAdShowing = visible;

            if (!this.isAdShowing) {
                window.removeEventListener('resize', this.hideAdBasedOnscreenSize);
                // this.adVisibility();
                if (pokiActive && this.adSize) PokiSDK.destroyAd(this.$el);
                return;
            } else {
                this.triggerAd();
                setTimeout(() => this.hideAdBasedOnscreenSize(), 500);
                // this.adVisibility();
                window.addEventListener('resize', this.hideAdBasedOnscreenSize);
                return;
            }

        },
        show() {
            if (extern.productBlockAds) return;
            console.log(`display ad ${this.id} showing`);
            this.setVisible(true);
        },
        hide() {
            this.setVisible(false);
            console.log(`display ad ${this.id} hiding`);
        },
        crazyGamesAd(id, size) {
            crazysdk.requestBanner([{
                containerId: id,
                size: size
            }]);

        },
        triggerAd() {
            this.adBlocker = extern.adBlocker;

            if (this.adBlocker) {
                this.adblockerSetup();
                return;
            }

            if (!pokiActive && !crazyGamesActive && !testCrazy) {

                if (this.houseAd) {
                    gtagInHouseLoadingBanner();
                    return;
                }

                if (this.hasShown && this.noRefresh) {
                    return;
                }

                this.hasShown = true;
                aiptag.subid = AIPSUBID;
                aiptag.cmd.display.push(() => aipDisplayTag.display(this.adUnit));
                return;

            } else if (crazyGamesActive || testCrazy) {

                // since crazy games requires an array for multiple ads on screen will cancel the respawn
                // ad calls and call them elsewhere
                if (this.id === 'shellshockers_respawn_banner_ad' ||
                this.id === 'shellshockers_respawn_banner_2_ad' ||
                this.id === 'shellshockers_respawn_banner-new_ad') return;


                this.crazyGamesAd(this.id, this.adSize);
                return;

            } else if (pokiActive && this.adSize) {
                   PokiSDK.displayAd(this.$el, this.adSize);
                return;
            }
        },
        toggleAd() {
            if (extern.productBlockAds) {
                this.isAdShowing = false;
                return;
            };
            this.$nextTick(() => {
                if (this.isAdShowing) {
                    return this.isAdShowing = false;
                }
                return this.isAdShowing = true;
            });

        },
        adblockerSetup() {
            if (pokiActive) return;

            switch(this.id) {
                case 'div-gpt-ad-shellshockers-loading-houseads-wrap':
                case 'shellshockers_respawn_banner_ad':
                case 'shellshockers_respawn_banner-new_ad':
                    this.houseAdData = extern.getHouseAd('bigBanner');
                    break;
                case 'shellshockers_respawn_banner_2_ad':
                case 'shellshockers_titlescreen_wrap':
                    this.houseAdData = extern.getHouseAd('small');
                break;
                default:
                    console.log('House ads say, huh?');
            }

        },
        hideAdBasedOnscreenSize() {
            let adWidth = this.$el.offsetWidth;
            let intViewportWidth = window.innerWidth;

            if (vueApp.displayAdObject && vueApp.displayAdObject > 1 ) {
                if (vueApp.displayAdObject < 970) {
                    return;
                }

                if (vueApp.displayAdObject > intViewportWidth ) {
                    this.hide();
                }
            } else {
                if (adWidth < 970) {
                    return;
                }

                if (adWidth > intViewportWidth ) {
                    this.hide();
                }
            }
        },
        adVisibility() {
            if (this.ignoreSize) return;
            googletag.pubads().addEventListener('slotVisibilityChanged', e => {
                    if (e.inViewPercentage < 51) {
                        this.hide();
                    } else {
                        this.show();
                    }
                }
            );
        }
    },

    computed: {
        theClass() {
            return this.adUnit.toLowerCase().replace(/_/g, "-");
        }
    },
    
    watch: {
        isHidden(value) {
            if (!value) {
                this.hide();
            }
        },
    }
}
}
</script>
<script id="language-selector-template" type="text/x-template">
<select id="pickLanguage" v-model="languageCode" @change="onChangeLanguage" class="ss_select ss_marginright_sm">
    <option v-for="(language, code) in langOptions" v-bind:value="code">
        {{ language }}
    </option>
</select>

</script>

<script>
var comp_language_selector = {
template: '#language-selector-template',
props: ['languages', 'selectedLanguageCode', 'loc', 'langOptions'],

data: function () {
    return {
        languageCode: this.selectedLanguageCode,
    }
},

methods: {
    playSound (sound) {
        BAWK.play(sound);
    },

    onChangeLanguage: function () {
        vueApp.changeLanguage(this.languageCode);
        // Update localStore for selected language.
        localStore.setItem('languageSelected', this.languageCode);
        BAWK.play('ui_onchange');
        ga('send', 'event', {
            eventCategory: vueData.googleAnalytics.cat.playerStats,
            eventAction: vueApp.googleAnalytics.action.languageSwitch,
            eventLabel: this.languageCode,
        });
    }
},

watch: {
    selectedLanguageCode: function (code) {
        this.languageCode = code;
    }
}
};
</script><script id="gdpr-template" type="text/x-template">
<transition name="fade">
<div v-show="isShowing">
    <div id="consent" v-show="showingNotification" class="gdpr_banner f_row">
        <div>{{ loc.gdpr_notification }} <a href="http://www.bluewizard.com/privacypolicy" target="_window">{{ loc.gdpr_link }}</a>
        </div>
        <div class="f_row">
            <button @click="onDisagreeClicked()" class="ss_button btn_red bevel_red ss_marginright ss_marginleft">{{ loc.gdpr_disagree }}</button>
            <button @click="onAgreeClicked()" class="ss_button btn_green bevel_green">{{ loc.gdpr_agree }}</button>
        </div>
    </div>

    <div id="doConsent" v-show="showingConsent" class="gdpr_banner f_row">
        <div>{{ loc.gdpr_consent }}</div>
        <div>
            <button @click="close()" class="ss_button btn_green bevel_green btn_md">{{ loc.ok }}</button>
        </div>
    </div>

    <div id="noConsent"v-show="showingNoConsent" class="gdpr_banner f_row">
        <div>{{ loc.gdpr_noConsent }}</div>
        <div>
            <button @click="close()" class="ss_button btn_green bevel_green btn_md">{{ loc.ok }}</button>
        </div>
    </div>
</div>
</transition>
</script>

<script>
var comp_gdpr = {
template: '#gdpr-template',
props: ['loc'],

data: function () {
    return {
        isShowing: false,
        showingNotification: false,
        showingConsent: false,
        showingNoConsent: false
    }
},

methods: {
    show: function () {
        this.isShowing = true;
        this.showingNotification = true;
        this.showingConsent = false;
        this.showingNoConsent = false;
    },

    close: function () {
        this.isShowing = false;
        BAWK.play('ui_playconfirm');
    },

    onAgreeClicked: function () {
        this.showingConsent = true;
        this.showingNotification = false;
        extern.doConsent();
        BAWK.play('ui_onchange');
    },

    onDisagreeClicked: function () {
        this.showingNoConsent = true;
        this.showingNotification = false;
        extern.doNotConsent();
        BAWK.play('ui_onchange');
    }
}
};
</script>
<script id="settings-template" type="text/x-template">
<div>
  <h1 class="roundme_sm text-center">{{ loc.p_settings_title }}</h1>

<div class="display-grid grid-column-3-eq gap-sm">
    <button id="keyboard_button" @click="selectTab" class="ss_bigtab bevel_blue roundme_md font-sigmar f_row align-items-center justify-content-center gap-sm" :class="(showKeyboardTab ? 'selected' : '')"><img src="img/ico_keyboard.svg" class="ss_bigtab_icon"> <img src="img/ico_mouse.svg" class="ss_bigtab_icon"></button>
    <button id="controller_button" @click="selectTab" class="ss_bigtab bevel_blue roundme_md font-sigmar f_row align-items-center justify-content-center gap-sm" :class="(showControllerTab ? 'selected' : '')"><img src="img/ico_gamepad.svg" class="ss_bigtab_icon"></button>
    <button id="misc_button" @click="selectTab" class="ss_bigtab bevel_blue ss_bigtab bevel_blue roundme_md font-sigmar f_row align-items-center justify-content-center gap-sm" :class="(showMiscTab ? 'selected' : '')"><img src="img/ico_monitor.svg" class="ss_bigtab_icon"> <img src="img/ico_speaker.svg" class="ss_bigtab_icon"> </button>
</div>

<div id="popupInnards" class="roundme_sm fullwidth f_col ss_margintop_sm ss_marginbottom_xl">
    <div id="settings_keyboard" v-show="showKeyboardTab" class="settings-section">
        <h3 class="margin-bottom-none">{{ loc.p_settings_keybindings }}</h3>
        
        <div class="f_row ss_margintop">
            <div class="f_col">
                <div v-for="c in settingsUi.controls.keyboard.game" v-if="c.side == 'left'" class="nowrap">
                    <settings-control-binder :loc="loc" :control-id="c.id" :control-value="c.value" @control-captured="onGameControlCaptured"></settings-control-binder>
                    <div class="label">{{ loc[c.locKey] }}</div>
                </div>

                <div class="ss_margintop_xl">
                    <div v-for="c in settingsUi.controls.keyboard.spectate" class="nowrap">
                        <settings-control-binder :loc="loc" :control-id="c.id" :control-value="c.value" @control-captured="onSpectateControlCaptured"></settings-control-binder>
                        <div class="label">{{ loc[c.locKey] }}</div>
                    </div>
                </div>
            </div>

            <div class="f_col ss_marginleft_xl">
                <div v-for="c in settingsUi.controls.keyboard.game" v-if="c.side == 'right'" class="nowrap">
                    <settings-control-binder :loc="loc" :control-id="c.id" :control-value="c.value" @control-captured="onGameControlCaptured"></settings-control-binder>
                    <div class="label">{{ loc[c.locKey] }}</div>
                </div>

                <div class="ss_margintop">
                    <div v-for="t in settingsUi.adjusters.mouse" class="nowrap">
                        <settings-adjuster :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" :min="t.min" :max="t.max" :step="t.step" :multiplier="t.multiplier" @setting-adjusted="onSettingAdjusted"></settings-adjuster>
                    </div>

                    <div v-for="t in settingsUi.togglers.mouse" class="nowrap">
                        <settings-toggler v-if="(t.id === 'shadowsEnabled' || t.id === 'highRes') ? showDetailSettings : true" :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" @setting-toggled="onSettingToggled"></settings-toggler>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <div id="settings_controller" v-show="showControllerTab" class="settings-section">
        <h3 class="margin-bottom-none">{{ loc.p_settings_gamepadbindings }}</h3>
        
        <div class="f_row ss_margintop">
            <div class="f_col">
                <div v-for="c in settingsUi.controls.gamepad.game" class="nowrap">
                    <settings-gamepad-binder :loc="loc" :control-id="c.id" :control-value="c.value" @control-captured="onGamepadGameControlCaptured" :controller-type="controllerType"></settings-gamepad-binder>
                    <div class="label">{{ loc[c.locKey] }}</div>
                </div>
            </div>

            <div class="f_col ss_marginleft_xl">
                <div class="ss_marginbottom_xl">
                    <div v-for="c in settingsUi.controls.gamepad.spectate" class="nowrap">
                        <settings-gamepad-binder :loc="loc" :control-id="c.id" :control-value="c.value" @control-captured="onGamepadSpectateControlCaptured" :controller-type="controllerType"></settings-gamepad-binder>
                        <div class="label">{{ loc[c.locKey] }}</div>
                    </div>
                </div>

                <div v-for="t in settingsUi.adjusters.gamepad" class="nowrap">
                    <settings-adjuster :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" :min="t.min" :max="t.max" :step="t.step" :multiplier="t.multiplier" :precision="t.precision" @setting-adjusted="onSettingAdjusted"></settings-adjuster>
                </div>

                <div v-for="t in settingsUi.togglers.gamepad" class="nowrap">
                    <settings-toggler v-if="(t.id === 'shadowsEnabled' || t.id === 'highRes') ? showDetailSettings : true" :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" @setting-toggled="onSettingToggled"></settings-toggler>
                </div>
            </div>
        </div>

        <p class="text_blue5 nospace">{{ getControllerId }}</p>
        <p class="text_blue8 nospace">{{ loc.p_settings_controllerhelp }} <a target="_blank" class="text_blue5" href="https://html5gamepad.com">html5gamepad.com</a></p>
    </div>

    <div id="settings_misc" v-show="showMiscTab" class="settings-section">
        <div class="display-grid grid-column-2-eq">
            <div class="f_col">
                <div v-for="t in settingsUi.adjusters.misc" class="nowrap">
                    <settings-adjuster :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" :min="t.min" :max="t.max" :step="t.step" :multiplier="t.multiplier" @setting-adjusted="onSettingAdjusted"></settings-adjuster>
                </div>
                <div v-for="t in settingsUi.adjusters.music" class="nowrap">
                    <settings-adjuster :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" :min="t.min" :max="t.max" :step="t.step" :multiplier="t.multiplier" @setting-adjusted="onSettingAdjusted"></settings-adjuster>
                </div>
            </div>

            <div class="f_col">
                <h3 class="margin-bottom-none">{{ loc.p_settings_language }}</h3>
                <language-selector :languages="languages" :loc="loc" :selectedLanguageCode="currentLanguageCode" class="ss_select" :langOptions="langOption"></language-selector>
            </div>
        </div>
        <h3 class="margin-bottom-none">More options</h3>
        <div class="display-grid grid-column-2-eq">
            <div class="f_col">
                <div v-for="t in settingsUi.togglers.misc">
                    <settings-toggler v-if="(t.id === 'shadowsEnabled' || t.id === 'highRes') ? showDetailSettings : true" :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" :hide="hideSetting(t.id)" @setting-toggled="onSettingToggled"></settings-toggler>
                </div>
                <button v-if="showPrivacyOptions" @click="onPrivacyOptionsClicked" class="ss_button btn_blue bevel_blue btn_md ss_margintop_xl">{{ loc.p_settings_privacy }}</button>
            </div>
            <div class="f_col">
                <div v-for="t in settingsUi.togglers.misc2">
                    <settings-toggler v-if="(t.id === 'shadowsEnabled' || t.id === 'highRes') ? showDetailSettings : true" :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" :hide="hideSetting(t.id)" @setting-toggled="onSettingToggled"></settings-toggler>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="display-grid grid-align-items-center justify-items-strech grid-column-3-eq grid-gap-1 fullwidth gap-sm">
    <button @click="onCloseClick" class="ss_button btn_red bevel_red btn_md no_margin_bottom">{{ loc.cancel }}</button>
    <button @click="onResetClick" class="ss_button btn_yolk bevel_yolk btn_md no_margin_bottom">{{ loc.p_settings_reset }}</button>
    <button @click="onSaveClick" class="ss_button btn_green bevel_green btn_md no_margin_bottom">{{ loc.confirm }}</button>
</div>

</div>
</script>

<script id="settings-control-binder-template" type="text/x-template">
<input ref="controlInput" @change="BAWK.play('ui_onchange')" type="text" v-model="currentValue" :placeholder="loc.press_key" class="ss_keybind clickme text_blue8" :class="(currentValue === 'undefined' ? 'ss_keybind_undefined' : '')"
    v-on:mousedown="onMouseDown($event)"
    v-on:keydown="onKeyDown($event)" 
    v-on:keyup="onKeyUp($event)" 
    v-on:wheel="onWheel($event)"
    v-on:focusout="onFocusOut($event)">
</script>

<script>
var comp_settings_control_binder = {
template: '#settings-control-binder-template',
props: ['loc', 'controlId', 'controlValue'],

data: function () {
    return {
        currentValue: this.controlValue,
        isCapturing: false
    }
},

methods: {
    playSound (sound) {
        BAWK.play(sound);
    },
    
    reset: function () {
        this.currentValue = (this.controlValue === null) ? 'undefined' : this.controlValue;
        this.isCapturing = false;
        this.$refs.controlInput.blur();
    },

    capture: function (value) {
        this.isCapturing = false;
        this.$refs.controlInput.blur();
        this.$emit('control-captured', this.controlId, value);
    },

    onMouseDown: function (event) {
        if (!this.isCapturing) {
            this.currentValue = '';
            this.isCapturing = true;
        } else {
            BAWK.play('ui_onchange')
            this.capture('MOUSE ' + event.button);
        }
    },

    onKeyDown: function (event) {
        this.currentValue = '';
        event.stopPropagation();
    },

    onKeyUp: function (event) {
        event.stopPropagation();
        var key = event.key;

        if (key == 'Escape' || key == 'Tab' || key == 'Enter') {
            return;
        }

        if (key == ' ') {
            key = 'space';
            event.preventDefault();
        }
        
        this.capture(key);
    },

    onWheel: function (event) {
        if (this.isCapturing) {
            BAWK.play('ui_onchange')
            if (event.deltaY > 0) {
                this.capture('WHEEL DOWN');
            } else if (event.deltaY < 0) {
                this.capture('WHEEL UP');
            }
        }
    },

    onFocusOut: function (event) {
        this.reset();
    }
},

watch: {
    // The value prop gets updated by the parent control; watch for changes and update the backing field of the textbox
    controlValue: function (newValue) {
        this.currentValue = (newValue === null) ? 'undefined' : newValue;
    }
}
};
</script><script id="settings-gamepad-binder-template" type="text/x-template">
<button ref="gamepadInput" class="ss_keybind clickme" :class="(currentValue === 'undefined' ? 'ss_keybind_undefined' : '')"
    v-on:mousedown="onMouseDown($event)"
    v-on:keydown="onKeyDown($event)" 
    v-on:keyup="onKeyUp($event)" 
    v-on:focusout="onFocusOut($event)"
    :key="controllerType">
    <span v-html="currentValue"></span></button>
</script>

<script>
var comp_settings_gamepad_binder = {
template: '#settings-gamepad-binder-template',
props: ['loc', 'controlId', 'controlValue', 'controllerType'],

data: function () {
    return {
        currentValue: (this.controlValue === null) ? 'undefined' : vueData.controllerButtonIcons[__uv.$wrap((this.controllerType))][__uv.$wrap((this.controlValue))],
        isCapturing: false
    }
},

beforeUpdate: function () {
    if (!this.isCapturing) {
        this.setIcon(this.controlValue);
    }
},

methods: {
    playSound (sound) {
        BAWK.play(sound);
    },
    
    reset: function () {
        this.setIcon(this.controlValue);
        this.isCapturing = false;

        removeEventListener('gamepadbuttondown', this.onButtonDown);
        removeEventListener('gamepadbuttonup', this.onButtonUp);
    },

    capture: function (value) {
        this.isCapturing = false;
        this.$refs.gamepadInput.blur();
        this.$emit('control-captured', this.controlId, value);
        this.reset();
    },

    onMouseDown: function (event) {
        if (!this.isCapturing) {
            this.currentValue = this.loc.press_button;
            this.isCapturing = true;

            addEventListener('gamepadbuttondown', this.onButtonDown);
            addEventListener('gamepadbuttonup', this.onButtonUp);
        }
    },

    onKeyDown: function (event) {
        event.stopPropagation();
    },

    onKeyUp: function (event) {
        event.stopPropagation();
    },

    onButtonDown: function (event) {
        if (event.detail == 8 || event.detail == 9) return;
        BAWK.play('ui_onchange')
        this.capture(event.detail);
    },

    onFocusOut: function (event) {
        this.reset();
    },

    setIcon: function (value) {
        this.currentValue = (value === null) ? 'undefined' : vueData.controllerButtonIcons[__uv.$wrap((this.controllerType))][__uv.$wrap((value))];
    }
},

watch: {
    // The value prop gets updated by the parent control; watch for changes and update the backing field of the textbox
    controlValue: function (newValue) {
        this.setIcon(newValue);
    }
}
};
</script><script id="settings-adjuster-template" type="text/x-template">
<div>
    <h3 class="margin-bottom-none" v-html="loc[locKey]"></h3>

    <div class="f_row">
        <input class="ss_slider" type="range" :min="min" :max="max" :step="step" v-model="currentValue" @change="onChange">
        <label class="ss_slider label text_blue4">{{ getCurrentValue() }}</label>
    </div>
</div>
</script>

<script>
var comp_settings_adjuster = {
template: '#settings-adjuster-template',
props: ['loc', 'locKey', 'controlId', 'controlValue', 'min', 'max', 'step', 'multiplier', 'precision'],

data: function () {
    return {
        currentValue: this.controlValue
    }
},

methods: {
    onChange: function (event) {
        this.$emit('setting-adjusted', this.controlId, this.currentValue);
        BAWK.play('ui_onchange');
    },

    getCurrentValue: function () {
        if (this.precision) {
            return Number.parseFloat(this.currentValue).toFixed(this.precision);
        }
        else {
            return Math.floor(this.currentValue * (this.multiplier || 1));
        }
    }
},

watch: {
    // controlValue prop could change when player X's out or clicks Cancel
    controlValue: function (newValue) {
        if (this.currentValue !== newValue) {
            this.currentValue = newValue;
        }
    }
}
};
</script><script id="settings-toggler-template" type="text/x-template">
<label v-if="!hide" class="ss_checkbox label"> {{ loc[locKey] }}
    <input type="checkbox" v-model="currentValue" @change="onChange($event)">
    <span class="checkmark"></span>
</label>
</script>

<script>
var comp_settings_toggler = {
template: '#settings-toggler-template',
props: ['loc', 'locKey', 'controlId', 'controlValue', 'hide'],

data: function () {
    return {
        currentValue: this.controlValue
    }
},

methods: {
    onChange: function (event) {
        this.$emit('setting-toggled', this.controlId, this.currentValue);
        BAWK.play('ui_onchange');
    }
},

watch: {
    // controlValue prop could change when player X's out or clicks Cancel
    controlValue: function (newValue) {
        if (this.currentValue !== newValue) {
            this.currentValue = newValue;
        }
    }
}
};
</script>
<script>
var comp_settings = {
template: '#settings-template',
components: {
    'settings-control-binder': comp_settings_control_binder,
    'settings-gamepad-binder': comp_settings_gamepad_binder,
    'language-selector': comp_language_selector,
    'settings-adjuster': comp_settings_adjuster,
    'settings-toggler': comp_settings_toggler
},
props: ['loc', 'settingsUi', 'languages', 'currentLanguageCode', 'showPrivacyOptions', 'controllerId', 'isFromEU', 'controllerType', 'langOption', 'isVip'],

data: function () {
    return {
        showKeyboardTab: true,
        showControllerTab: false,
        showMiscTab: false,

        originalSettings: {},
        showDetailSettings: false,
        originalLanguage: '',
        originalMusicVolume: '',
        musicStatChg: ''
    }
},

methods: {
    selectTab: function (e) {
        return this.switchTab(e.target.id)
    },
    
    switchTab(tab) {

        this.showKeyboardTab = false;
        this.showControllerTab = false;
        this.showMiscTab = false;

        switch (tab) {
            case 'keyboard_button':
                this.showKeyboardTab = true;
                break;

            case 'controller_button':
                this.showControllerTab = true;
                break;

            case 'misc_button':
                this.showMiscTab = true;
                break;
        }

        BAWK.play('ui_toggletab');
    },

    captureOriginalSettings: function () {
        this.originalSettings = deepClone(vueData.settingsUi);
        this.originalLanguage = this.currentLanguageCode;
        // this.originalMusicVolume = this.originalSettings.adjusters.music[0].value;
    },

    applyOriginalSettings: function () {
        vueData.settingsUi = this.originalSettings;
        this.showDetailSettings = !vueData.settingsUi.togglers.misc.find( a => { return a.id === 'autoDetail'; }).value;

        console.log('applying original settings: ' + JSON.stringify(vueData.settingsUi));
    },

    onGameControlCaptured: function (id, value) {
        this.onControlCaptured(this.settingsUi.controls.keyboard.game, id, value)
    },

    onSpectateControlCaptured: function (id, value) {
        this.onControlCaptured(this.settingsUi.controls.keyboard.spectate, id, value)
    },

    onGamepadGameControlCaptured: function (id, value) {
        this.onControlCaptured(this.settingsUi.controls.gamepad.game, id, value)
    },

    onGamepadSpectateControlCaptured: function (id, value) {
        this.onControlCaptured(this.settingsUi.controls.gamepad.spectate, id, value)
    },

    onControlCaptured: function (controls, id, value) {
        value = value.toLocaleUpperCase();

        controls
            .forEach( (c) => {
                if (c.id === id) {
                    c.value = value;
                } else {
                    if (c.value === value) {
                        c.value = null;
                    }
                }
        });
    },

    onSettingToggled: function (id, value) {
        console.log('value: ' + value);

        Object.values(this.settingsUi.togglers).forEach(v => {
            var toggler = v.find(t => { return t.id === id; });
            if (toggler) toggler.value = value;
        })

        if (id === 'autoDetail') {
            this.showDetailSettings = !value;
        }

        if (id === 'safeNames') {
            extern.setSafeNames(value);
        }

        // if (id === 'musicStatus') {
        // 	extern.setMusicStatus(value);
        // 	this.musicStatChg = true;

        // 	if (extern.inGame) {
        // 		vueApp.toggleMusic();
        // 	}
        // }
    },

    onSettingAdjusted: function (id, value) {
        Object.values(this.settingsUi.adjusters).forEach(v => {
            var adjuster = v.find( (a) => { return a.id === id; });
            if (adjuster) adjuster.value = value;
        })

        if (id === 'volume') {
            extern.setVolume(value);
        }

        if (id === 'mouseSpeed') {
            extern.setMouseSpeed(value);
        }

        if (id === 'sensitivity') {
            extern.setControllerSpeed(value);
        }

        if (id === 'deadzone') {
            extern.setDeadzone(value);
        }

        if (id === 'musicVolume') {
            extern.setMusicVolume(value);
        }

    },

    onVolumeChange: function () {
        extern.setVolume(this.settingsUi.volume);
    },

    onPrivacyOptionsClicked: function () {
        this.$emit('privacy-options-opened');
        BAWK.play('ui_popupopen');
    },
    
    onCancelClick: function () {
        this.applyOriginalSettings();
        //extern.setMusicVolume(this.originalMusicVolume);
        this.cancelLanguageSelect();
        if (this.musicStatChg) {
            if (extern.inGame) { 
                vueApp.toggleMusic();
            }
        };
        this.$parent.close();
    },

    onCloseClick: function () {
        this.applyOriginalSettings();
        //extern.setMusicVolume(this.originalMusicVolume);
        this.cancelLanguageSelect();
        if (this.musicStatChg) {
            if (extern.inGame) {
                vueApp.toggleMusic();
            }
        };
        vueApp.sharedIngamePopupClosed();
        this.$parent.toggle();
        if (extern.inGame) {
            vueApp.showRespawnDisplayAd();
        }
        BAWK.play('ui_popupclose');
    },

    quickSave() {
        extern.applyUiSettings(this.settingsUi, this.originalSettings);
        this.resetOriginalLanguage();		
    },
    
    onSaveClick: function () {
        // if (vueApp.music.serverTracks.title) {
        // 	this.gaMusicVol();
        // }
        // this.gaMusicVol();

        extern.applyUiSettings(this.settingsUi, this.originalSettings);
        this.resetOriginalLanguage();
        vueApp.sharedIngamePopupClosed();
        this.$parent.toggle();
        BAWK.play('ui_playconfirm');

        ga('send', 'event', 'game', 'settings', 'volume', settings.volume);
        ga('send', 'event', 'game', 'settings', 'mouse speed', settings.mouseSpeed);
        ga('send', 'event', 'game', 'settings', 'mouse invert', settings.mouseInvert);
        ga('send', 'event', 'game', 'settings', 'fast polling mouse', settings.fastPollMouse);
        ga('send', 'event', 'game', 'settings', 'deadzone', settings.deadzone);
        ga('send', 'event', 'game', 'settings', 'controller speed', settings.controllerSpeed);
        ga('send', 'event', 'game', 'settings', 'controller invert', settings.controllerInvert);
    },

    gaMusicVol() {
        let newVol = Number(this.settingsUi.adjusters.music[__uv.$wrap((0))].value);
        if (newVol === Number(this.originalMusicVolume)) return;
        if ((Math.round(newVol*100)) <= 1) {
            ga('send', 'event', 'music', 'mute', vueApp.music.serverTracks.title);
        }
    },
    onResetClick: function () {
        extern.resetSettings();
        BAWK.play('ui_reset');
    },
    cancelLanguageSelect: function() {
        this.originalLanguage === vueApp.$data.currentLanguageCode ?
            vueApp.changeLanguage(vueApp.$data.currentLanguageCode) : vueApp.changeLanguage(this.originalLanguage);
        // Revert localStore for language
        localStore.setItem('languageSelected', this.originalLanguage);
        this.resetOriginalLanguage();
    },
    resetOriginalLanguage: function() {
        this.originalLanguage = '';
    },
    setSettings: function (settings) {
        var getSettingById = (list, id) => {
            return list.filter( o => {
                    return o.id == id;
            })[__uv.$wrap((0))];
        };

        // Keyboard

        getSettingById(this.settingsUi.controls.keyboard.game, 'up').value = settings.controls.keyboard.game.up;
        getSettingById(this.settingsUi.controls.keyboard.game, 'down').value = settings.controls.keyboard.game.down;
        getSettingById(this.settingsUi.controls.keyboard.game, 'left').value = settings.controls.keyboard.game.left;
        getSettingById(this.settingsUi.controls.keyboard.game, 'right').value = settings.controls.keyboard.game.right;
        getSettingById(this.settingsUi.controls.keyboard.game, 'jump').value = settings.controls.keyboard.game.jump;
        getSettingById(this.settingsUi.controls.keyboard.game, 'melee').value = settings.controls.keyboard.game.melee;
        getSettingById(this.settingsUi.controls.keyboard.game, 'inspect').value = settings.controls.keyboard.game.inspect;
        getSettingById(this.settingsUi.controls.keyboard.game, 'fire').value = settings.controls.keyboard.game.fire;
        getSettingById(this.settingsUi.controls.keyboard.game, 'scope').value = settings.controls.keyboard.game.scope;
        getSettingById(this.settingsUi.controls.keyboard.game, 'reload').value = settings.controls.keyboard.game.reload;
        getSettingById(this.settingsUi.controls.keyboard.game, 'swap_weapon').value = settings.controls.keyboard.game.swap_weapon;
        getSettingById(this.settingsUi.controls.keyboard.game, 'grenade').value = settings.controls.keyboard.game.grenade;
        getSettingById(this.settingsUi.controls.keyboard.spectate, 'ascend').value = settings.controls.keyboard.spectate.ascend;
        getSettingById(this.settingsUi.controls.keyboard.spectate, 'descend').value = settings.controls.keyboard.spectate.descend;
        getSettingById(this.settingsUi.controls.keyboard.spectate, 'toggle_freecam').value = settings.controls.keyboard.spectate.toggle_freecam;
        
        // Gamepad

        getSettingById(this.settingsUi.controls.gamepad.game, 'jump').value = settings.controls.gamepad.game.jump;
        getSettingById(this.settingsUi.controls.gamepad.game, 'fire').value = settings.controls.gamepad.game.fire;
        getSettingById(this.settingsUi.controls.gamepad.game, 'scope').value = settings.controls.gamepad.game.scope;
        getSettingById(this.settingsUi.controls.gamepad.game, 'reload').value = settings.controls.gamepad.game.reload;
        getSettingById(this.settingsUi.controls.gamepad.game, 'swap_weapon').value = settings.controls.gamepad.game.swap_weapon;
        getSettingById(this.settingsUi.controls.gamepad.game, 'grenade').value = settings.controls.gamepad.game.grenade;
        getSettingById(this.settingsUi.controls.gamepad.game, 'melee').value = settings.controls.gamepad.game.melee;
        getSettingById(this.settingsUi.controls.gamepad.game, 'inspect').value = settings.controls.gamepad.game.inspect;
        getSettingById(this.settingsUi.controls.gamepad.spectate, 'ascend').value = settings.controls.gamepad.spectate.ascend;
        getSettingById(this.settingsUi.controls.gamepad.spectate, 'descend').value = settings.controls.gamepad.spectate.descend;

        // Misc

        getSettingById(this.settingsUi.adjusters.misc, 'volume').value = settings.volume;
        // getSettingById(this.settingsUi.adjusters.music, 'musicVolume').value = settings.musicVolume;
        getSettingById(this.settingsUi.adjusters.mouse, 'mouseSpeed').value = settings.mouseSpeed;
        getSettingById(this.settingsUi.adjusters.gamepad, 'sensitivity').value = settings.controllerSpeed;
        getSettingById(this.settingsUi.adjusters.gamepad, 'deadzone').value = settings.deadzone;

        getSettingById(this.settingsUi.togglers.mouse, 'mouseInvert').value = (settings.mouseInvert !== 1);
        getSettingById(this.settingsUi.togglers.mouse, 'fastPollMouse').value = settings.fastPollMouse;
        getSettingById(this.settingsUi.togglers.gamepad, 'controllerInvert').value = (settings.controllerInvert !== 1);

        getSettingById(this.settingsUi.togglers.misc, 'holdToAim').value = settings.holdToAim;
        getSettingById(this.settingsUi.togglers.misc, 'enableChat').value = settings.enableChat;
        getSettingById(this.settingsUi.togglers.misc, 'safeNames').value = settings.safeNames;
        getSettingById(this.settingsUi.togglers.misc, 'autoDetail').value = settings.autoDetail;
        getSettingById(this.settingsUi.togglers.misc, 'shadowsEnabled').value = settings.shadowsEnabled;
        getSettingById(this.settingsUi.togglers.misc, 'highRes').value = settings.highRes;
        getSettingById(this.settingsUi.togglers.misc2, 'hideBadge').value = settings.hideBadge;
        getSettingById(this.settingsUi.togglers.misc2, 'closeWindowAlert').value = settings.closeWindowAlert;
        getSettingById(this.settingsUi.togglers.misc2, 'shakeEnabled').value = settings.shakeEnabled;
        getSettingById(this.settingsUi.togglers.misc2, 'centerDot').value = settings.centerDot;
        // getSettingById(this.settingsUi.togglers.misc, 'musicStatus').value = settings.musicStatus;

        console.log('auto detail: ' + settings.autoDetail);
        this.showDetailSettings = !settings.autoDetail;
    },

    hideSetting(id) {
        if (id === 'hideBadge' && !this.isVip) {
            return true;
        }
        return false;
    },

    onHelpClickDelete() {
        vueApp.hideSettingsPopup();
        vueApp.showHelpPopupFeedbackWithDelete();
        ga('send', 'event', vueApp.googleAnalytics.cat.playerStats, vueApp.googleAnalytics.action.faqPopupClick);
        BAWK.play('ui_popupopen');
    },
},
computed: {
    getControllerId() {
        if (this.controllerId == 'No controller detected') {
            return vueApp.loc[__uv.$wrap(('p_settings_nocontroller'))]
        } else {
            return this.controllerId
        }
    }
}
};
</script><script id="help-template" type="text/x-template">
<div>
   <div class="f_row align-items-center  justify-content-center">
        <button id="faq_button" @click="toggleTabs" class="ss_bigtab bevel_blue ss_marginright roundme_md font-sigmar" :class="(showTab1 ? 'selected' : '')">{{ loc.faq }}</button>
        <button id="fb_button" @click="toggleTabs" class="ss_bigtab bevel_blue roundme_md font-sigmar" :class="(!showTab1 ? 'selected' : '')">{{ loc.feedback }}</button>
    </div>
    <div v-show="showTab1">
        
        <div id="feedback_panel">      

            <h1>{{ loc.faq_title }}</h1>

            <help-questions :content="localizeThis"></help-questions>

            <hr>
            <div id="btn_horizontal" class="f_center">
                <button @click="onBackClick" class="ss_button btn_md btn_red bevel_red ss_marginright">{{ loc.cancel }}</button>
            </div>
            
        </div>            
    </div>

    <div v-show="!showTab1">
        
        <div id="feedback_panel">
            <h1 :class="{'text-center' : isAccountDeleteReq}">{{ feedbackTitle }}</h1>
            
            <p v-if="!isAccountDeleteReq">{{ loc.fb_feedback_intro }}</p>
            <h4 v-if="isNoAccountForDelete" class="text-center">{{loc.feedback_sign_in_msg}}</h4>

            <div id="btn_horizontal" class="f_center">
                <select v-model="selectedType" class="ss_field ss_marginright" @click="BAWK.play('ui_click')" @change="BAWK.play('ui_onchange')">
                    <option v-for="type in feedbackType" :value="type.id">{{ loc[type.locKey] }}</option>
                </select>
            
                <input id="feedbackEmail" v-model="email" :placeholder="loc.fb_email_ph" class="ss_field" v-on:keyup="validateEmail">
            </div>
            
            <div>
                <textarea v-if="!isAccountDeleteReq" id="feedbackText" class="ss_field" v-model="feedback" :placeholder="loc.fb_feedback_ph" v-on:keyup="validateMessage"></textarea>
            </div>
            
            <div class="f_center f_col">
                <span v-show="emailInvalid" class="ss_marginright error_text">{{ loc.fb_bad_email }}</span>
                <span v-show="messageInvalid" class="ss_marginright error_text">{{ loc.fb_no_comment }}</span>
            </div>
            
            <div id="btn_horizontal" class="f_center">
                <button @click="onBackClick" class="ss_button btn_md btn_red bevel_red ss_marginright">{{ loc.cancel }}</button>
                <button @click="onSendClick" class="ss_button btn_md btn_green bevel_green">{{ sendBtnText }}</button>
            </div>
        </div>

    </div>
</div>
</script>

<script id="help-question-template" type="text/x-template">
<div>
    <div v-for="qa in content">
        <a :name="qa[0]"></a>
        <h3>{{ qa[1] }}</h3>
        <span v-html="qa[2]"></span>
    </div>
</div>
</script>

<script>
var comp_help_question = {
template: '#help-question-template',
props: ['content'],
};
</script>
<script>
var comp_help = {
template: '#help-template',
components: {
    'help-questions': comp_help_question,
},
props: ['loc', 'accountType', 'feedbackType', 'openWithType'],
mounted() {
    this.helpLocSetup();
},
data: function () {
    return {
        showTab1: true,
        selectedType: 0,
        email: '',
        feedback: '',
        doValidation: false,
        emailInvalid: false,
        messageInvalid: false,
        qaNum: [1,2,3,4,5,6,7,8,9,10,11],
        newLoc: [],
        localizeThis:  [],
        

    }
},
feedbackValidateTimeout: 0,
methods: {
    playSound (sound) {
        BAWK.play(sound);
    },
    
    validateEmail: function () {
        if (!this.doValidation) {
            return;
        }
        // Insane e-mail-validating regex
        var re = /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/;
        
        this.emailInvalid = (this.email === '' || !re.test(this.email));
        return !this.emailInvalid;
    },

    validateMessage: function () {
        if (!this.doValidation) {
            return;
        }
        this.messageInvalid = this.feedback === '';
        return !this.messageInvalid;
    },

    toggleTabs: function () {
        this.showTab1 = !this.showTab1;
        this.selectedType = 0;
        this.$emit('resetFeedbackType');
        BAWK.play('ui_toggletab');
        if ( !this.showTab1) {
            ga('send', 'event', 'feedback opened');
        }
    },
    
    onBackClick: function () {
        vueApp.$refs.helpPopup.toggle();
        BAWK.play('ui_popupclose');
    },

    sendFeedbackApi(selected) {
        if (!selected) {
            selected = this.selectedType;
        }

        extern.api_feedback(selected, this.email, this.feedback);

        setTimeout(() => {
            if (this.selectedType !== this.feedbackType.delete.id) {
                this.$parent.toggle();
            }
            this.selectedType = 0;
            this.feedback = null;
            this.email = null;
        }, 900);
    },
    
    onSendClick: function () {
        if (this.isNoAccountForDelete) {
            vueApp.hideHelpPopup();
            vueApp.showFirebaseSignIn();
            return;
        }
        this.doValidation = true;

        if (this.selectedType === this.feedbackType.delete.id) {
            this.comment = null;
            this.$parent.toggle();
            vueApp.showDeleteAccoutApprovalPopup();
            BAWK.play('ui_popupopen');
            return;
        } else {
            if (!this.validateEmail() || !this.validateMessage() ) {
                return;
            }
        }

        BAWK.play('ui_playconfirm');

        // Send that shit out
        this.sendFeedbackApi();
    },

    onAccountDelectionConfirmed() {
        this.sendFeedbackApi(this.feedbackType.delete.id);
    },

    helpLocSetup(locContent) {
        let content = this.loc;
        // if (locContent) {
        // 	content = locContent
        // }
        const locArray = Object.entries(content);
        this.newLoc = locArray.filter( (item, i) => {
            if (item[__uv.$wrap((0))].includes('faqItems_q')) {
                return item;
            }
        });

        const tranlateThat = [];

        for (let n = 0; n < this.qaNum.length; n++) {
            tranlateThat.push([]);
            for (let i = 0; i < this.newLoc.length; i++) {
                if (this.newLoc[__uv.$wrap((i))][__uv.$wrap((0))].includes('faqItems_q' + this.qaNum[__uv.$wrap((n))] + '_')) {
                    tranlateThat[__uv.$wrap((n))].push(this.newLoc[__uv.$wrap((i))][__uv.$wrap((1))]);
                }
            }
        }
        // Cause once again... vue
        setTimeout(() => {this.localizeThis = tranlateThat}, 500);
    },
    openFeedbackTabWith(type) {
        this.showTab1 = false;
        if (type) {
            this.selectedType = type;
        }
    }
},
computed: {
    isAccountDeleteReq() {
        return this.selectedType === this.feedbackType.delete.id;
    },
    isNoAccountForDelete() {
        return this.isAccountDeleteReq && this.accountType == 'no-account';
    },
    sendBtnText() {
        if (this.isNoAccountForDelete) {
            return this.loc.sign_in;
        } else {
            return this.loc.fb_send;
        }
    },
    feedbackTitle() {
        if (!this.isAccountDeleteReq) {
            return this.loc.fb_feedback_title;
        } else {
            return this.loc.fb_delete_account;
        }
    }
},
watch: {
    loc(val) {
        this.helpLocSetup(val);
    },
}
};
</script><script id="vip-help-template" type="text/x-template">
<div>
    <div id="feedback_panel">      
        <h1>{{ loc.vipHelptitle }}</h1>
        <strong><small class="text_yellow"><i class="fas fa-exclamation-triangle"></i> {{loc.vipHelpDesc2}}</small></strong>
        <p>{{loc.vipHelpDesc}}</p>

        <div>
            <a :name="loc.vipFaqItems_q1_anchor"></a>
            <h3>{{ loc.vipFaqItems_q1_q }}</h3>
            <p>{{ loc.vipFaqItems_q1_a_1 }}</p>
            <ul>
                <li>{{ loc.vipFaqItems_q1_li_1 }}</li>
                <li>{{ loc.vipFaqItems_q1_li_2 }}</li>
                <li>{{ loc.vipFaqItems_q1_li_3 }}</li>
                <li>{{ loc.vipFaqItems_q1_li_4 }}</li>
                <li>{{ loc.vipFaqItems_q1_li_5 }}</li>
                <li>{{ loc.vipFaqItems_q1_li_6 }}</li>
            </ul>
        </div>

        <div>
            <a :name="loc.vipFaqItems_q2_anchor"></a>
            <h3>{{ loc.vipFaqItems_q2_q }}</h3>
            <p>{{ loc.vipFaqItems_q2_a_1 }}</p>
        </div>

        <div>
            <a :name="loc.vipFaqItems_q3_anchor"></a>
            <h3>{{ loc.vipFaqItems_q3_q }}</h3>
            <p>{{ loc.vipFaqItems_q3_a_1 }}</p>
        </div>

        <div>
            <a :name="loc.vipFaqItems_q4_anchor"></a>
            <h3>{{ loc.vipFaqItems_q4_q }}</h3>
            <p>{{ loc.vipFaqItems_q4_a_mobile_3 }}</p>
            <p>{{ loc.vipFaqItems_q4_a_1 }}</p>
            <p>{{ loc.vipFaqItems_q4_a_2 }}</p>
        </div>

        <div>
            <a :name="loc.vipFaqItems_q5_anchor"></a>
            <h3>{{ loc.vipFaqItems_q5_q }}</h3>
            <p>{{ loc.vipFaqItems_q5_a_1 }}</p>
            <p>{{ loc.vipFaqItems_q5_a_2 }}</p>
            <p>{{ loc.vipFaqItems_q5_a_3 }}</p>
        </div>

        <div>
            <a :name="loc.vipFaqItems_q6_anchor"></a>
            <h3>{{ loc.vipFaqItems_q6_q }}</h3>
            <p>{{ loc.vipFaqItems_q6_a_1 }}</p>
            <p>{{ loc.vipFaqItems_q6_a_2 }}</p>
            <p>{{ loc.vipFaqItems_q6_a_3 }}</p>
        </div>

        <div>
            <a :name="loc.vipFaqItems_q7_anchor"></a>
            <h3>{{ loc.vipFaqItems_q7_q }}</h3>
            <p>{{ loc.vipFaqItems_q7_a_1 }}</p>
        </div>

<!-- 
        <div v-for="qa in loc.vipFaqItems">
            <a :name="qa.anchor"></a>
            <h3>{{ qa.q }}</h3>
            <p v-for="p in qa.a">
               {{p}}
            </p>
            <ul v-if="qa.li">
                <li v-for="li in qa.li">{{li}}</li>
            </ul>
        </div> -->

        <hr>
        <div id="btn_horizontal" class="f_center">
            <button @click="openVipStore" class="ss_button btn_md btn_green bevel_green ss_marginright">{{ subButtonTxt }}</button>
            <button @click="onBackClick" class="ss_button btn_md btn_red bevel_red ss_marginright">{{ loc.cancel }}</button>
        </div>

    </div>
</div>
</script>

<script>
var vip_help = {
template: '#vip-help-template',
props: ['loc', 'isVip'],
data: function () {
    return {

    }
},
methods: {
    onBackClick() {
        BAWK.play('ui_popupclose');
        this.$parent.hide();
    },
    openVipStore() {
        this.$parent.hide();
        vueApp.showSubStorePopup();
    }
},
computed: {
    subButtonTxt() {
        return this.isVip ? this.loc.sManageBtn : this.loc.account_vip;
    }
}
};
</script><script id="house-ad-big-template" type="text/x-template">
<div v-show="(useAd !== null)">
    <button @click="onCloseClicked" class="popup_close splash_ad_close ad_close"><i class="fas fa-times text_white fa-2x"></i></button>
    <img :src="adImageUrl" @click="onClicked" class="splash_ad_image centered roundme_md">
</div>
</script>

<script>
var comp_house_ad_big = {
template: '#house-ad-big-template',
data: function() {
    return {
        removeOverlayClick: '',
    }
},

props: ['useAd'],

bigAdTimeout: null,

methods: {
    onCloseClicked: function () {
        console.log('big ad closed');
        this.close();
    },

    onClicked: function () {
        this.close();
        BAWK.play('ui_click');
        extern.clickedHouseAdBig(this.useAd);
    },

    close: function () {
        if (this.useAd === null) {
            return;
        }
        BAWK.play('ui_popupclose');
        this.$emit('big-house-ad-closed');
    },

    outsideClickClose: function() {
        const showingId = document.getElementById('house-ad-big-template', true);
        this.removeOverlayClick = this.handleOutsideClick;
        document.addEventListener('click', this.removeOverlayClick);
    },
    
    handleOutsideClick: function(e) {
        // Stop bubbling
        e.stopPropagation();
        // If the target does NOT include the class splash_ad_image use the onCloseClicked method and remove the eventListener
        if ( ! e.target.id.includes('splash_ad_image') ) {
            this.onCloseClicked();
            document.removeEventListener('click', this.removeOverlayClick);
        }
    },
},

computed: {
    adImageUrl: function () {
        if (!hasValue(this.useAd)) {
            return;
        }

        return dynamicContentPrefix + 'data/img/art/{0}{1}'.format(this.useAd.id, this.useAd.imageExt);
    }
},

watch: {
    useAd: function (bigAd) {
        if (hasValue(bigAd)) {
            setTimeout(() => {
                vueApp.hideTitleScreenAd();
            }, 100);
            this.$options.bigAdTimeout = setTimeout(function () {
                vueApp.ui.houseAds.big = null;
            }, 15000);
            // Close with outside click
            this.outsideClickClose();
        } else {
            vueApp.showTitleScreenAd();
        }
    }
}
};
</script><script id="house-ad-small-template" type="text/x-template">
<img v-show="(useAd !== null)" :src="adImageUrl" @click="onClicked" class="news_banner roundme_md">
</script>

<script>
var comp_house_ad_small = {
template: '#house-ad-small-template',

props: ['useAd'],

methods: {
    onClicked: function () {
        BAWK.play('ui_click');
        extern.clickedHouseAdSmall(this.useAd);
    }
},

computed: {
    adImageUrl: function () {
        if (!hasValue(this.useAd)) {
            return;
        }
        ga('send', 'event', {
            eventCategory: 'House banner ad',
            eventAction: 'show',
            eventLabel: this.useAd.label
        });

        return dynamicContentPrefix + 'data/img/art/{0}{1}'.format(this.useAd.id, this.useAd.imageExt);
    }
}
};
</script>
<script id="item-template" type="text/x-template">
<div v-if="active" class="box_relative center_h">
    <div :class="tooltip" ref="theTooltip">
        <span v-if="showTooltip" class="paddings_sm display-grid">
            <div>
                <h4 class="nospace text_yolk">{{ itemName }}</h4>
            </div>
            <!-- <p class="nospace text_blue5">{{ tooltipTxt.desc }}</p> -->
        </span>
        <div ref="eggItemInvetory" class="grid-item roundme_lg clickme common-box-shadow box_relative" :class="[itemClass, itemType, itemTagsString]" @click="onClick">
            <div v-show="!renderDone" class="centered"><i class="fas fa-egg fa-spin fa-2x"></i></div>
            <span v-if="isVipItem">
                <icon name="ico-vip" class="equip-vip-icon"></icon>
            </span>
            <div v-if="hasBanner && !notify" class="equip-item-banner shadow">
                <span class="visibility-hidden">{{bannerTxt}}</span>
            </div>
            <div v-if="hasBanner && !notify" class="equip-item-banner">
                {{bannerTxt}}
            </div>
            <div v-if="showPrice && renderDone" class="equip_smallprice display-grid box_absolute grid-column-auto-1 gap-sm">
                <div class="equip_cost box_absolute f_row align-items-center" :class="equipCostTagCls">
                    <i v-if="isPremium && !isItemOwned" :class="priceIcon"></i><span v-if="!isPremium && !isItemOwned && !hidePrice" class="egg-price-egg"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve"><path class="egg-fill" d="M12 21.6c-4.4 0-8-3.5-8-7.8 0-4 3.4-11.4 8.1-11.4 4.8 0 7.8 7.5 7.8 11.4.1 4.3-3.5 7.8-7.9 7.8z" style="fill-rule:evenodd;clip-rule:evenodd;"/><path class="egg-stroke" d="M12.1 3.9c3.6 0 6.3 6.4 6.3 9.9s-2.9 6.3-6.5 6.3-6.5-2.8-6.5-6.3c.1-3.5 3.2-9.9 6.7-9.9m0-3C6.2.9 2.5 9.4 2.5 13.8c0 5.2 4.3 9.3 9.5 9.3s9.5-4.2 9.5-9.3C21.5 9.4 18.2.9 12.1.9z"/></svg>
</span>{{ itemPrice }}
                </div>
            </div>
            <canvas ref="itemCanvas" class="equip_icon centered" :class="canvasCls" width="250" height="250"></canvas>
            <div v-if="notify && hasBanner" class="notification-banner box_relative">
                <img :src="bannerIconImg" alt="">
            </div>
            <p v-if="showItemOnly" class="item-name text-center">{{ item.name }}</p>
        </div>
        <button class="ss_button btn_green bevel_green btn_sm fullwidth ss_margintop box_absolute" v-show="hasBuyBtn && isSelected" @click="onClickBuy">Get it now!</button>
    </div>
</div>
</script>

<script>
var comp_item = {
template: '#item-template',
props: ['loc', 'item', 'showItemOnly', 'isSelected', 'equippedSlot', 'hasBuyBtn', 'isShop', 'hidePrice', 'showTooltip', 'notify'],

data: function () {
    return {
        itemOnly: hasValue(this.showItemOnly) ? this.showItemOnly : false,
        active: true,
        itemLimited: false,
        itemUnlock: 'purchase',
        itemTags: [],
        itemTagsString: '',
        renderDone: false,
        premTxt: {
            title: '',
            desc: ''
        }
    }
},

mounted() {
    this.prepareItem();
    this.itemHightlightedOrder();
},

methods: {
    prepareItem: function () {
        this.itemUnlock = this.item.unlock;

        if (this.itemUnlock == 'premium' && !this.item.activeProduct && this.isShop) {
            this.active = false;
        }

        // We don't need this mess
        if (this.itemUnlock === 'physical' && this.isShop) {
            this.active = false;
        }
        
        this.setUpTags();
        this.isEquippedSlot();
        // this.tooltipOnMouseOver();
    },
    setUpTags() {
        if (this.item.item_data !== undefined && this.item.item_data.tags !== undefined && this.item.item_data.tags.length) {
            this.item.item_data.tags.forEach(el => this.itemTags.push('item-tag-' + el.toLowerCase().replace(/\s+/g, '-')));
            this.itemTagsString = this.itemTags.toString().replace(/,/g, ' ');
        }
    },

    isEquippedSlot() {
        if (this.equippedSlot) {
            this.active = true;
        }

        vueApp.equip.lazyRenderTimeouts.push(setTimeout(() => this.renderItem(), 0));
    },

    tooltipOnMouseOver() {
        this.$refs.theTooltip.addEventListener("mouseover", (event) => {
            const tooltipBounds = this.$refs.theTooltip.getBoundingClientRect();
            const itemGrid = document.getElementById('item-smack-down');
            const searchBox = document.getElementById('item-search-wrap');
            const searchBoxBounds = searchBox.getBoundingClientRect();
            const itemGridBounds = itemGrid.getBoundingClientRect();
            const elTouchSearch = Math.floor(tooltipBounds.y) < Math.floor(searchBoxBounds.y);
            const topTouch = Math.floor(tooltipBounds.y) === Math.floor(itemGridBounds.y);
            const leftTouch = Math.floor(tooltipBounds.left - 10) < Math.floor(itemGridBounds.left);
            const rightTouch = Math.floor(tooltipBounds.right + 10) > Math.floor(itemGridBounds.right);

            if (topTouch && !rightTouch && !leftTouch) {
                this.$refs.theTooltip.classList.add('tooltip-bottom');
            }

            if (leftTouch) {
                this.$refs.theTooltip.classList.add('tooltip-left');
            }

            if (rightTouch) {
                this.$refs.theTooltip.classList.add('tooltip-right');
            }

        });
    },

    highlightSelected: function () {
        return this.isSelected ? 'highlight' : '';
    },

    itemHightlightedOrder: function() {
        if (this.isPhysicalMerch && vueData.currentEquipMode == vueData.equipMode.shop) return;
        return this.$refs.eggItemInvetory.classList.contains('highlight') ? this.$refs.eggItemInvetory.style.order='-1' : null;
    },

    renderItem() {
        if (this.$refs.itemCanvas === undefined) return;
        extern.renderItemToCanvas(this.item, this.$refs.itemCanvas, () => {
            this.renderDone = true;
        });
    },

    onClick: function () {
        this.$emit('item-selected', this.item);
    },

    onClickBuy() {
        extern.buyProductForMoney(this.item.sku[__uv.$wrap((0))]);
    },
    countWords (str) {
        str = str.trim();
        const words = str.match(/\S+/g);

        words.forEach((w, i) => {
            if (w.length > 10) {
                const wLength = Math.floor(w.length / 2);
                const newWord = w.substring(0, wLength) + '-' + w.substring(wLength, w.length);
                words[__uv.$wrap((i))] = newWord;
            }
        });
        return words.join(' ');
    },

},

computed: {
    isItemSellable: function () {
        return (!this.itemOnly && vueData.currentEquipMode == vueData.equipMode.shop) || (!this.itemOnly && vueData.currentEquipMode == vueData.equipMode.skins) || (!this.itemOnly && vueData.currentEquipMode == vueData.equipMode.featured);
    },

    showPrice () {
        return  this.isItemSellable && this.item.price > 0;
    },

    isPhysicalMerch () {
        return this.isItemSellable && this.itemUnlock === 'physical';
    },

    isPremium() {
        return this.itemUnlock === 'premium' && !this.itemTags.includes('item-tag-vipitem');
    },

    isVipItem() {
        return this.itemUnlock === 'vip';
    },

    isLimited() {
        return this.itemTags.includes('item-tag-limited');
    },

    isDrop() {
        return this.itemTags.includes('drop');
    },

    isItemOwned() {
        return extern.isItemOwned(this.item);
    },

    hasBanner() {
        return this.isPremium || this.isVipItem || this.isLimited;
    },

    itemType() {
        return getKeyByValue(ItemType, this.item.item_type_id).toLowerCase();
    },

    bannerTxt() {
        if (!this.hasBanner) {
            return;
        } else {
            if (this.isPremium) {
                return 'PREMIUM';
            }
            if (this.isVipItem) {
                return 'VIP';
            }
            if (this.isLimited) {
                return this.loc.eq_limited;
            }
        }
    },

    canvasCls() {
        if (!this.isItemSellable) {
            return 'full-width-height'
        }
    },

    itemClass() {
        return {
            'is-premium': this.isPremium,
            'is-vip': this.isVipItem,
            'highlight': this.isSelected,
        }
    },

    itemPrice() {
        if (this.hidePrice) {
            if (this.isItemOwned ) {
                return this.loc.eq_owned;
            }
        } else {
            return !this.isItemOwned ? this.item.price : this.loc.eq_owned + '!';
        }
    },

    priceIcon() {
        if (this.isPremium) {
            return vueApp.icon.dollar;
        }
    },
    equipCostTagCls() {
        if (this.isPremium && !this.isItemOwned) {
            return 'premium-item-cost';
        } else if (this.isItemOwned) {
            return 'equip-cost-is-owned';
        }
    },
    tooltipTxt() {
        if (this.showTooltip) {
            return this.premTxt;
        }
    },
    tooltip() {
        if (this.showTooltip) {
            return 'tool-tip';
        }
    },
    bannerIconImg() {
        if (this.isPremium) {
            return 'img/store/PremiumTag.png';
        } else if (this.isVipItem) {
            return 'img/store/VIPTag.png';
        }
    },
    itemName() {
        return this.countWords(this.item.name);
    }
},

watch: {
    item: function (val) {
        this.prepareItem();
    }
}
};
</script><script id="chickn-winner-template" type="text/x-template">
<div id="popupInnards" class="box_dark roundme_sm fullwidth f_col">
    <header class="display-grid grid-column-1-eq align-items-center roundme_lg">
        <h1 class="chickn-winner-title nospace text-center">{{ loc.p_chicken_header_txt}}</h1>
    </header>
    <section id="chickn-winner-wrapper" class="egg-chick-wrapper f_row roundme_lg box_relative justify-content-center">
        <div v-show="eggGameReady" class="egg-chick-box box_relative" v-for="egg in eggs" :key="egg.id">
            <div v-if="showAmountRewarded && busted && egg.value > 5" class="text-center chw-reward-amount box_absolute">
                <h2 class="box_relative shadow_grey">{{ showAmountRewarded }} <img class="chw-winner-egg" src="img/ico_goldenEgg.svg" /></h2>
            </div>
            <img class="incentivized-egg-chick box_relative" :class="eggClass(egg.value)" @click="checkIfReady" :src="eggSrc(egg.value)" :id="egg.id">
            <div v-if="rewardHasItem && egg.value > 5" class="centered">
                <item :loc="loc" :item="rewardItem" :has-buy-btn="false" :is-shop="false"></item>
                <h4 class="text_white text-center nospace text-shadow-black-40">{{ rewardItem.name }}</h4>
            </div>
        </div>
        <img v-show="!eggGameReady" class="incentivized-egg-chick centered" :src="chickSrc">
        <button v-show="showAdWatch" class="ss_button btn_large btn_green bevel_green btn_shiny ss_marginbottom_lg" @click="watchVideo">{{ loc.chw_btn_watch_ad }}</button>
        <h2 class="centered nospace fullwidth text-center">{{ txtState.desc }}</h2>
        <div v-show="!chw.ready && !chw.adBlockDetect"class="chw-progress-bar-wrap-popup roundme_sm box_relative bg_blue5 center_h ss_marginbottom_lg ss_button">
            <p class="chw-progress-bar-msg box_aboslute centered nospace text-center fullwidth chw-msg chw-p-msg text_white">
                <span v-show="chw.hours" class="chw-pie-num">{{chw.hours}}:</span><span class="chw-pie-num">{{chw.minutes}}:</span><span class="chw-pie-num">{{chw.seconds}}</span>
            </p>
            <div class="chw-progress-bar-inner-popup bg_blue4" :style="{width: chwBarProgress}"></div>
        </div>
    </section>
    <!-- #chickn-winner-wrapper -->
    <footer class="nugget-footer text-center box_relative">
        <div>
        <button v-show="showPopupBtn" id="gotWinnerOk" @click="onGotWinner" class="ss_button btn_medium btn_yolk bevel_yolk btn_shiny">{{ txtState.btn }}</button>
        <button v-show="!firebaseId" @click="signIn" class="ss_button btn_medium btn_green bevel_green btn_shiny">{{ loc.sign_in}}</button>
        </div>
        <display-ad id="shellshockers_chicken_nugget_banner_ad" ref="nuggetDisplayAd" class="pauseFiller center_h" :ignoreSize="true" :adUnit="adUnit" adSize="728x90"></display-ad>
    </footer>
</div>
<!-- #popupInnards -->
</script>


<script>
var comp_chickn_winner_popup = {
template: '#chickn-winner-template',
props: ['loc', 'firebaseId', 'reward', 'adUnit', 'chw'],
components: {
    'item': comp_item,
},

data: function () {
    return {
        clickedIdx: 0,
        eggs: [{id:'eggOne', value: 0, active: true, hide: 0}, {id:'eggTwo', value: 0, active: true, hide: 0}, {id:'eggThree', value: 0, active: true, hide: 0}],
        isMiniGameComplete: false,
        bustedSrc: `img/incentivized-mini-game/svg/Egg07.svg`,
        busted: false,
        showEggGame: false,
        clickBeforeReady: false,
        watchAdClicked: false,
    }
},

methods: {
    placeBannerAdTag: function (tagEl) {
        this.$refs.chickenNuggetAdContainer.appendChild(tagEl);
    },
    showAd() {
        return this.$refs.nuggetDisplayAd.show();
    },
    hideAd() {
        return this.$refs.nuggetDisplayAd.hide();
    },

    eggSrc(count) {
        if (count > 6) {
            return `img/incentivized-mini-game/svg/Egg06.svg`;
        }
        return `img/incentivized-mini-game/svg/Egg0${count}.svg`;
    },

    eggSrcBusted() {
        setTimeout(() => {
            return `img/incentivized-mini-game/svg/Egg07.svg`;
        }, 2424);
    },

    eggBg(count) {
        if (count > 5) {
            return 'incentivized-show'
        }
    },
    eggClass(count) {
        let hide;
        if (count > 5 && this.reward.itemIds.length > 0) {
            hide = 'visibility-hidden';
        }
        if (count > 5) {
            return `chick-alive ${hide}`;
        }
    },

    checkIfReady(e) {
            this.eggClickCounter(e);
    },

    eggClickCounter(e) {
        if (!this.busted) {
            BAWK.play('mini-egg-game_shellhit');
        } else {
            BAWK.play('mini-egg-game_chick');
        }

        this.clickedIdx = this.eggs.findIndex(i => i.id === e.target.id);

        let elem = document.getElementById(this.eggs[__uv.$wrap((this.clickedIdx))].id);

        if (this.eggs[__uv.$wrap((this.clickedIdx))].value < 6) {
            elem.classList.add('chickn-winner-clicked');
            setTimeout(() => elem.classList.remove('chickn-winner-clicked'), 650);
        }

            if (this.eggs[__uv.$wrap((this.clickedIdx))].value === 5) {

                this.isMiniGameComplete = true;

                ga('send', 'event', 'Chickn Winner', 'Egg Game', `egg-cracked-${this.eggs[__uv.$wrap((this.clickedIdx))].id}`);

                setTimeout(() => {
                    this.eggs[__uv.$wrap((this.clickedIdx))].active = false;
                    elem.src = this.bustedSrc;
                }, 1414);

                this.busted = true;

                extern.api_checkBalance();

                this.eggs.forEach(i => {
                    if (i.id === e.target.id) return;
                    let btn = document.getElementById(i.id);
                    if (btn) {
                        btn.style.pointerEvents = 'none';
                        btn.disabled = true;
                    }
                });
            }


        if (this.eggs[__uv.$wrap((this.clickedIdx))].value === 100) {
            BAWK.play('mini-egg-game_shial');
        }

        this.eggs[__uv.$wrap((this.clickedIdx))].value++;
    },
    resetGame() {
        if (this.firebaseId !== null) {
            extern.checkStartChicknWinner(true);
        }
        if (extern.inGame) {
            vueApp.disableRespawnButton(false);
            vueApp.showGameMenu();
        }
        setTimeout(() => {
            this.$emit('chw-mini-game-complete', true);
            this.isMiniGameComplete = false;
            this.busted = false;
            this.reward.eggs = null;
            this.reward.itemIds.length = 0;
            this.reward.ownedItem = null;
            this.reward.ownedItems = null;
            this.clickBeforeReady = false;
            this.watchAdClicked = false;

            this.eggs.forEach(i => {
                const Btn = document.getElementById(i.id);
                if (Btn) {
                    Btn.style.pointerEvents = 'all';
                    Btn.disabled = false;
                }
                i.value = 0;
                i.active = true;
                i.hide = 0;
            });
        }, 500);
    },

    onGotWinner: function () {
        BAWK.play('ui_popupclose');
        this.$parent.hide();
        this.hideAd();
    },

    watchVideo() {
        if (this.watchAdClicked) {
            return;
        }

        this.watchAdClicked = true;
        vueApp.chwDoIncentivized();
        setTimeout(() => {
            this.watchAdClicked = false;
        }, 2000);
    },

    signIn() {
        this.$parent.hide();
        vueApp.onChwSignInClicked();
        vueApp.onSignInClicked();
    }
},
computed: {
    chwBarProgress() {
        return this.chw.progress + '%';
    },
    showAmountRewarded() {
        if (this.reward.eggs) {
            return `+${this.reward.eggs}`;
        }
    },

    rewardItem() {
        return this.reward.itemIds.length > 0 ? extern.catalog.findItemById(this.reward.itemIds[__uv.$wrap((0))]) : [];
    },

    txtState() {
        let t = {};

        if (!this.firebaseId) {
            t.desc = this.loc.chw_create_account;
            t.btn = this.loc.not_now;
        } else {
            if (this.eggGameReady) {
                t.desc = this.loc.p_nugget_instruction;
                t.btn = this.loc.p_nugget_button;
                if (this.busted) {
                    t.desc = '';
                }
            } else {
                if (this.chw.winnerCounter > 3) {
                    t.desc = this.loc.chw_daily_limit_msg_two;
                    t.btn = this.loc.close;
                } else {
                    t.desc = '';
                    t.btn = this.loc.close;
                }
            }
        }

        return t;
    },

    limitReached() {
        return this.chw.winnerCounter > 3;
    },

    eggGameReady() {
        return ((this.reward.eggs || this.reward.itemIds.length > 0) && this.firebaseId && !this.limitReached);
    },

    showCountDown() {
        return (!(this.reward.eggs || this.reward.itemIds.length > 0) && this.firebaseId && !this.limitReached && !this.chw.ready);
    },

    showAdWatch() {
        return (!(this.reward.eggs || this.reward.itemIds.length > 0) && this.firebaseId && !this.limitReached && this.chw.ready);
    },

    showDescTxt() {
        return (!this.chw.ready && this.limitReached);
    },

    showPopupBtn() {
        return ((this.busted && (this.reward.eggs || this.reward.itemIds.length > 0)) || this.showCountDown || this.showAdWatch || this.limitReached || !this.firebaseId);
    },

    chickSrc() {
        if (this.limitReached || !this.firebaseId) {
            return 'img/chicken-nugget/chickLoop_daily_limit.svg';
        }
        return 'img/chicken-nugget/chickLoop_sleep.svg';
    },

    rewardHasItem() {
        return this.reward.itemIds.length > 0 && !this.reward.eggs && this.busted;
    },
    
},
watch: {
    busted(val) {
        if (val) {
            BAWK.play('mini-egg-game_shellburst');
            setTimeout(() => {
                BAWK.play('mini-egg-game_victory');
            }, 500);
        }
    },
}
};
</script>
<script id="home-screen-template" type="text/x-template">
<div>
    <house-ad-big id="big-house-ad" ref="bigHouseAd" :useAd="ui.houseAds.big" @big-house-ad-closed="onBigHouseAdClosed"></house-ad-big>
    <!-- <gauge-meter v-show="showScreen !== screens.profile" ref="gaugeMeter" @gauge-meter-click="onGaugeMeterClick"></gauge-meter> -->
    <div class="homescreen-main-wrapper display-grid">
        <div class="box_relative fullwidth">
            <profile-screen id="profileScreen" ref="profileScreen" :loc="loc" v-show="(showScreen === screens.profile)" :sign-in-clicked="onSignInClicked" :sign-out-clicked="onSignOutClicked" @leave-game-confimed="leaveGameConfirmed"></profile-screen>
            <play-panel id="play_game" ref="playPanel" v-show="showScreen === screens.home" :show-screen="showScreen" :screens="screen" :loc="loc" :player-name="playerName" :game-types="gameTypes" :current-game-type="currentGameType" :is-game-ready='accountSettled' :region-list="regionList" :current-region-id="currentRegionId" :home="home" :play-clicked="playClicked" :current-class="classIdx" :language-code="currentLanguageCode" @playerNameChanged="onPlayerNameChanged" @game-type-changed="onGameTypeChanged" :maps="maps"></play-panel>
        </div>
        <aside class="secondary-aside box_relative display-grid justify-content-end">
            <div class="secondary-aside-wrap box_relative">					
                <media-tabs ref="mediaTabs"  :loc="loc" :newsfeedItems="newsfeedItems" :twitchStreams="twitchStreams" :youtubeStreams="youtubeStreams"></media-tabs>
                <display-ad id="shellshockers_titlescreen_wrap" :hidden="hideAds" ref="titleScreenDisplayAd" class="house-small box_absolute" :ignoreSize="true" :adUnit="displayAd.adUnit.home" adSize="300x250"></display-ad>
            </div>
        </aside>
        <!-- <house-ad-small id="banner-ad" :useAd="ui.houseAds.small"></house-ad-small> -->
    </div>
    <div id="mainFooter" class="centered_x">
        <!-- <chicken-panel ref="chickenPanel" id="chicken_panel" :local="loc" :do-upgraded="isUpgraded"></chicken-panel> -->
        <section>
            <footer-links-panel id="footer_links_panel" :loc="loc" :version="changelog.version" :is-poki="isPoki"></footer-links-panel>
        </section>
        <section class="social-icons box_absolute">
            <social-panel ref="socialIconPanel" id="social_panel" :loc="loc" :is-poki="isPoki" :use-social="ui.socialMedia.footer" :social-media="ui.socialMedia.selected"></social-panel>
        </section>
    </div>

    <!-- Popup: Check Email -->
    <small-popup id="checkEmailPopup" ref="checkEmailPopup" :hide-cancel="true">
        <template slot="header">{{ loc.p_check_email_title }}</template>
        <template slot="content">
            <p>{{ loc.p_check_email_text1 }}:</p>
            <h5 class="nospace text-center">{{ maskedEmail }}</h5>
            <p class="ss_marginbottom">{{ loc.p_check_email_text2 }}</p>
        </template>
        <template slot="confirm">{{ loc.ok }}</template>
    </small-popup>

    <!-- Popup: Resend Email -->
    <small-popup id="resendEmailPopup" ref="resendEmailPopup" @popup-confirm="onResendEmailClicked" @popup-x="onHideResendEmail" @popup-cancel="onHideResendEmail">
        <template slot="header">{{ loc.p_resend_email_title }}</template>
        <template slot="content">
            <p>{{ loc.p_resend_email_text1 }}:</p>
            <h5 class="nospace text-center">{{ maskedEmail }}</h5>
            <p class="ss_marginbottom">{{ loc.p_resend_email_text2 }}</p>
        </template>
        <template slot="cancel">{{ loc.ok }}</template>
        <template slot="confirm">{{ loc.p_resend_email_resend }}</template>
    </small-popup>

    <small-popup id="resendEmailConfirm" ref="resendEmailConfirm" :hide-cancel="true" @popup-closed="onHideResendEmail">
        <template slot="header">{{ loc.verify_email_sent }}</template>
        <template slot="content">
            <!-- content not loc'd (yet) -->
            {{ loc.verify_email_instr }}
        </template>
        <template slot="confirm">{{ loc.close }}</template>
    </small-popup>

    <!-- <large-popup id="hvsmPopup" ref="hvsmPopup" @popup-closed="onHvsmPopupClose" @popup-opened="onHvsmPopupOpen" @popup-x="onHvsmPopupClose">
        <template slot="content">
            <div id="hvsm-popup-item-grid-wrap" class="hvsm-popup-item-grid-wrap paddings_lg display-grid gap-1 grid-column-3-eq">
                <div class="hvsm-popup-item-grid hvsm-popup-heroes-column">
                    <header>
                        <img class="display-block center_h" :src="hvsm.hero.img" alt="Heroes logo">
                        <h3 class="text-center text-uppercase text_blue5">{{ hvsm.hero.name }}</h3>
                    </header>
                    <div id="equip_grid" class="center_h f_row align-content-start align-content-start gap-sm">
                        <item v-for="(item, idx) in hvsm.hero.items" :loc="loc" :item="item" :key="item.id" @item-selected="onHvsmClicked" :is-shop="false"></item>
                    </div>
                    <button class="ss_button btn_md btn_yolk bevel_yolk fullwidth" @click="onHvsmClicked(hvsm.hero.name)">
                        Hero Items
                    </button>
                </div>
                <div class="hvsm-popup-desc">
                    <header>
                        <h1 class="nospace text_white text-shadow-black-40 text-center">Egg Org &#38; Eggventure</h1>	
                    </header>
                    <p class="text_blue5">
                        Welcome brave Eggventurers, to a tale of mystery, magic, & mayhem! 
                    </p>
                    <p class="text_blue5">
                        Equip your skins of choice to choose your side. Each kill with an equipped Monsters or Heroes item will bring your side closer to victory! Who will win to unlock an item for all? You decide. 
                    </p>
                    <p class="text_blue5">
                        Grab your swords & prepare yourshellves, for the eggventure of a lifetime awaits!
                    </p>
                </div>
                <div class="hvsm-popup-item-grid hvsm-popup-monsters-column">
                    <header>
                        <img class="display-block center_h" :src="hvsm.monster.img" alt="Monsters logo">
                        <h3 class="text-center text-uppercase text_blue5">{{ hvsm.monster.name }}</h3>
                    </header>
                    <div id="equip_grid" class="center_h f_row align-content-start align-content-start gap-sm">
                        <item v-for="(item, idx) in hvsm.monster.items" :loc="loc" :item="item" :key="item.id" @item-selected="onHvsmClicked" :is-shop="false"></item>
                    </div>
                    <button class="ss_button btn_md btn_yolk bevel_yolk fullwidth" @click="onHvsmClicked(hvsm.monster.name)">
                        Monster Items
                    </button>
                </div>
            </div>
        </template>
    </large-popup> -->
    
</div>
</script>

<script id="create-private-game-template" type="text/x-template">
<div>
    <div class="roundme_sm fullwidth">
        <div>
            <div class="create-game-map-select display-grid">
                <h1 class="create-game-header roundme_sm text-center">
                    {{ loc.p_privatematch_title }}
                </h1>
                <div class="create-game-map-search box_relative">
                    <!-- <input ref="mapSearch" name="name" v-bind:placeholder="loc.p_privatematch_find_map" v-on:keyup="onMapSerachKeyup($event)" class="ss_field font-nunito box_relative"> -->
                    <div class="box_relative display-grid grid-column-auto-1 gap-sm">
                        <div class="box_relative">
                            <label for="search-map" class="centered_y"><i class="fas fa-search text_blue3" :class="[mapSearchResults.length || mapNotFound ? 'fa-times-circle' : 'fa-search']" @click="onMapSearchReset"></i></label>
                            <input ref="mapSearch" name="search-map" v-bind:placeholder="loc.p_privatematch_find_map" v-on:keyup="onMapSerachKeyup($event)" @blur="onBlurSearhFocus" class="ss_field font-nunito box_relative fullwidth">
                        </div>
                        <button class="ss_button btn_blue bevel_blue box_relative text-shadow-none create-game-map-btn-random" @click="onRandomMapClick"><i class="fas fa-random"></i></button>
                    </div>
                    <div v-show="mapSearchResultsShow" class="option-box box_absolute roundme_sm common-box-shadow bg_blue6 pos-right">
                        <ul class="list-no-style nospace ss-dropdown-select f_col">
                            <li v-show="!mapSearchResults.length" class="text_blue5 font-nunito" @click="onMapSearchReset">{{ loc.p_privatematch_map_not_found }}</li>
                            <li v-for="(item, idx) in mapSearchResults" :key="idx" @click="onMapSearchResultClick(item)" class="text_blue5 font-nunito">
                                {{ item.name }}
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="private_maps" class="roundme_md" :style="{ backgroundImage: 'url(' + mapImgPath + ')' }">
                    <!-- <img :src="mapImgPath" id="mapThumb" class="roundme_sm text-center"> -->
                    <div id="mapNav">
                        <button id="mapLeft" @click="onMapChange(-1)" class="clickme map-arrows text_white"><i class="fas fa-caret-left fa-3x"></i></button>
                        <h5 id="mapText" class="text-shadow-black-40">
                            {{ mapList[mapIdx].name }}
                            <span class="map_playercount text-shadow-black-40 font-nunito box_absolute">
                                <icon class="map-avg-size-icon fill-white shadow-filter" :name="mapSizeIcon"></icon>
                            </span>
                        </h5>
                        <button id="mapRight" @click="onMapChange(1)" class="clickme map-arrows text_white"><i class="fas fa-caret-right fa-3x"></i></button>
                    </div>
                </div>
                <div class="hideme">{{ currentRegionId }}</div>
                <ss-button-dropdown class="btn-1 fullwidth" :loc="loc" :loc-txt="gameTypeTxt" :list-items="gameTypes" :selected-item="pickedGameType" menuPos="right" @onListItemClick="onGameTypeChange"></ss-button-dropdown>
                <!-- <ss-button-dropdown :loc="loc" :loc-txt="mapTxt" :list-items="gameTypeMapList" :selected-item="mapIdx" @onListItemClick="onMapChangeClick"></ss-button-dropdown> -->
                <!-- <ss-button-dropdown class="btn-2 fullwidth" :loc="loc" :loc-txt="serverTxt" :list-items="regions" :selected-item="currentRegionId" menuPos="right" @onListItemClick="onServerChange"></ss-button-dropdown> -->
                <ss-button-dropdown class="play-panel-region-select btn-2 fullwidth" :loc="loc" :loc-txt="serverTxt"  :selected-item="currentRegionId" @onListItemClick="onServerChange" menuPos="right">
                    <template slot="dropdown">
                        <li v-if="regions" ref="items" v-for="(g, idx) in regions" :class="{ 'selected' : currentRegionId === g.id }" class="display-grid gap-1 align-items-center text_blue5 font-nunito regions-select" @click="onServerChange(g.id)">
                            <div class="f_row align-items-center">
                                <icon v-show="currentRegionId === g.id" name="ico-checkmark" class="option-box-checkmark"></icon>
                            </div>
                            <div>
                                {{ loc[g.locKey ]}}
                            </div>
                            <div class="text-right">
                                {{ g.ping }}ms
                            </div>
                        </li>
                    </template>
                </ss-button-dropdown>
                <!-- <button class="ss_button button_blue bevel_blue fullwidth" @click="onServerClick">{{ loc.server }}: {{ loc[serverLocKey] }}</button> -->
                <button name="play" @click="onPlayClick" class="btn-3 f_row align-items-center gap-sm is-for-play ss_button btn_md text-uppercase font-sigmar fullwidth btn_green bevel_green margin-0">{{ loc.p_privatematch_button }} <icon class="fill-white shadow-filter" name="ico-backToGame"></icon></button>
            </div>
        </div>
    </div>
</div>
</script>

<script>
var comp_create_private_game_popup = {
template: '#create-private-game-template',
props: ['loc', 'regionLocKey', 'mapImgBasePath', 'isGameReady', 'gameTypeTxt', 'gameTypes', 'pickedGameType', 'mapList', 'regions', 'currentRegionId'],

mounted() {
    this.randomMap();
},

data: function () {
    return {
        showingRegionList: false,
        pickedGameType: 0,
        gameTypes: vueData.gameTypes,
        mapIdx: 0,
        playClickedBeforeReady: false,
        map: '',
        mapLocKey: '',
        mapImgPath: '',
        mapNotFound: false,
        mapSearchResults: [],
        mapSearchResultsIdx: 0,
        mapSearchResultsMax: 5,
        mapSearchResultsMin: 0,
        mapSearchResultsShow: false,
        mapSearchIsFocused: false,
        mapKeyListners: '',
        vueData,
    }
},

methods: {
    randomMap() {
        this.mapIdx = Math.randomInt(0, this.mapList.length);
        this.map = this.mapList[__uv.$wrap((this.mapIdx))];
        this.mapLocKey = this.map.locKey;
        this.mapImgPath = this.mapImgBasePath + this.map.filename + '.png?' + this.map.hash;
    },
    onRandomMapClick() {
        BAWK.play('ui_onchange');
        this.selectMapForPickedGameType('', true);
    },
    playSound (sound) {
        BAWK.play(sound);
    },
    
    onCloseClick: function () {
        this.$parent.close();
        BAWK.play('ui_popupclose');
    },
    
    onRegionChanged: function () {
        this.showingRegionList = true;
        this.$parent.toggle();
        vueApp.$refs.homeScreen.$refs.playPanel.$refs.pickRegionPopup.toggle();
        BAWK.play('ui_click');
    },

    onMapChange: function (dir) {
        this.selectMapForPickedGameType(dir);
        BAWK.play('ui_onchange');
    },

    selectMapForPickedGameType (dir, rnd) {
        let idx = this.mapIdx;

        let gameTypeShortName;

        for (var i = 0; i < vueData.maps.length; i++) { // Prevent race condition
            if (dir) idx = (idx + dir + vueData.maps.length) % vueData.maps.length;
            if (rnd) idx = Math.randomInt(0, vueData.maps.length);
            let map = vueData.maps[__uv.$wrap((idx))];
            gameTypeShortName = vueData.gameTypeKeys[__uv.$wrap((this.pickedGameType))];            

            if (map.modes[__uv.$wrap((gameTypeShortName))]) {
                break;
            }
            if (dir == 0) dir = 1
            //idx = (idx + dir + vueData.maps.length) % vueData.maps.length;
        }

        console.log('Random map deets: ', gameTypeShortName, vueData.maps[__uv.$wrap((idx))].modes[__uv.$wrap((gameTypeShortName))]);

        this.mapImgPath = this.mapImgBasePath + vueData.maps[__uv.$wrap((idx))].filename + '.png?' + vueData.maps[__uv.$wrap((idx))].hash;
        this.mapLocKey = vueData.maps[__uv.$wrap((idx))].locKey;
        this.mapIdx = idx;
    },

    onKeyDownMapSelect() {
        document.addEventListener('keydown', this.handleKeydown, true);
    },

    handleKeydown(e) {
        const keyName = e.key;
        switch (keyName) {
            case 'ArrowRight':
                this.onMapChange(1);
                break;
            case 'ArrowLeft':
                this.onMapChange(-1);
                break;
            case 'ArrowDown':
            case 'ArrowUp':
                if (this.mapSearchIsFocused) return;
                this.mapSearchIsFocused = true;
                this.$refs.mapSearch.focus();			
            default:
                break;
        }

    },

    removeKeydown() {
        this.mapSearchIsFocused = false;
        document.removeEventListener('keydown', this.handleKeydown, true);
    },

    onGameTypeChanged () {
        BAWK.play('ui_onchange');
        this.selectMapForPickedGameType(0);
    },

    onPlayTypeWhenSignInComplete() {
        return this.playClickFunction();
    },
    onPlaySentBeforeSignIn() {
        this.gameClickedBeforeReady = true;
        vueApp.showSpinner('signin_auth_title', 'signin_auth_msg');
    },
    onPlayClick: function () {
        this.removeKeydown();
        this.$parent.close();
        if (!this.isGameReady) {
            this.onPlaySentBeforeSignIn();
            return;
        }
        vueApp.externPlayObject(vueData.playTypes.createPrivate, this.pickedGameType, this.vueData.playerName, this.mapIdx, '');
        BAWK.play('ui_playconfirm');
    },
    onGameTypeChange(val) {
        // Not using a select here because it's not possible to style it so we have to update the game mode
        // manually. This is a bit of a hack but it works.
        this.pickedGameType = val;
        // Minor change here. Sending the game type to update global game type change this if we want.
        this.$emit('onGameTypeChange', this.pickedGameType);
        this.selectMapForPickedGameType(0);
    },
    onMapChangeClick(idx) {
        if (idx >= 0) {
            for (var i = 0; i < this.mapList.length; i++) { // Prevent race condition
                let map = this.mapList[__uv.$wrap((idx))];
                let gameTypeShortName = vueData.gameTypeKeys[__uv.$wrap((this.pickedGameType))];            

                if (map.modes[__uv.$wrap((gameTypeShortName))]) {
                    break;
                }
            }
            this.mapImgPath = this.mapImgBasePath + this.mapList[__uv.$wrap((idx))].filename + '.png?' + this.mapList[__uv.$wrap((idx))].hash;
            this.mapLocKey = this.mapList[__uv.$wrap((idx))].locKey;
            this.mapIdx = idx;
            BAWK.play('ui_onchange');
        }
    },
    onServerChange(val) {
        this.$emit('onRegionPicked', val);
    },
    onMapSerachKeyup(e) {
        if (this.$refs.mapSearch.value.length >= 1) {
            this.mapSearchResultsShow = true;
            this.mapSearchResults = this.mapList.filter((map, idx) => {
                if (map.name.toLowerCase().replace(/[^a-zA-Z ]/g, "").startsWith(this.$refs.mapSearch.value.toLowerCase())) {
                    if (map.modes[__uv.$wrap((vueData.gameTypeKeys[__uv.$wrap((this.pickedGameType))]))]) {
                        if (!this.mapSearchResults.some(map => idx === map.id)) {
                            return true;
                        }
                        return false;
                    }
                } else {
                    return false;
                }
            });
            if (!this.mapSearchResults.length) {
                this.mapNotFound = true;
            }
        } else {
            this.mapSearchResults.length = 0;
            this.mapSearchResultsShow = false;
            this.mapNotFound = false;
        }

        if (this.mapSearchResults.length === 1) {
            this.onMapChangeClick(this.mapList.findIndex(m => m.filename === this.mapSearchResults[__uv.$wrap((0))].filename));
            this.mapSearchResultsShow = false;
            this.mapNotFound = false;
        }
    },
    onMapSearchReset() {
        this.$refs.mapSearch.value = '';
        this.mapSearchResultsShow = false;
        this.mapSearchResults.length = 0;
        this.mapNotFound = false;
        this.mapSearchIsFocused = false;
    },
    onMapSearchResultClick(map) {
        this.onMapSearchReset();
        this.onMapChangeClick(this.mapList.findIndex(m => m.filename === map.filename));
    },
    onBlurSearhFocus() {
        this.mapSearchIsFocused = false;
    }
},
computed: {
    serverTxt() {
            let name = '';
            if (hasValue(this.regions) && hasValue(this.currentRegionId)) {
                name = this.regions.filter(s => s.id === this.currentRegionId)[__uv.$wrap((0))].locKey;
            }
        return {
            title: this.loc.p_servers_title,
            subTitle: this.loc[__uv.$wrap((name))]
        }
    },
    mapSizeIcon() {
        if (this.mapList[__uv.$wrap((this.mapIdx))].numPlayers <= 13) {
            return 'ico-map-size-small';
        } else if (this.mapList[__uv.$wrap((this.mapIdx))].numPlayers >= 14 && this.mapList[__uv.$wrap((this.mapIdx))].numPlayers <= 17) {
            return 'ico-map-size-med';
        } else if (this.mapList[__uv.$wrap((this.mapIdx))].numPlayers > 17) {
            return 'ico-map-size-large';
        }
    }
},
watch: {
    isGameReady(val) {
        if (this.gameClickedBeforeReady && val) {
            setTimeout(() => this.onPlayClick(), 700);
        }
    }
}   
};
</script><script id="account-panel-template" type="text/x-template">
<div>
    <div id="account_top" class="f_row f_end_only account-wrapper align-items-center ">
        <event-panel v-show="showCornerButtons" :current-screen="currentScreen" :screens="screens"></event-panel>
        <!-- <eggstore-notify ref="shirtStore" :show="showCornerButtons" :loc="loc" :sku="sku" icon="fa-tshirt" :text-hide="true" text="p_egg_shop_sale_notify" title="account_threadless" color="blue" url="https://bluewizard.threadless.com/" analytics="threadless"></eggstore-notify> -->
        <!-- <eggstore-notify ref="eggStoreSaleNotify" :text-hide="!hideNewItemNotify" :show="showCornerButtons" :loc="loc" :sku="sku" title="account_premium_item" icon="fa-gem" text="p_egg_shop_sale_notify" analytics="diamond"></eggstore-notify> -->
        <div class="account_eggs roundme_sm clickme f_row align-items-center" @click="onEggStoreClick" v-bind:title="loc['account_title_eggshop']">
            <div class="box_relative">
                <img :src="isAnonymous ? 'img/svg/ico_goldenEgg_callout.svg' : 'img/svg/ico_goldenEgg.svg'" class="egg_icon">
            </div>
            <span ref="eggCounter" class="egg_count">{{ eggBalance }}</span>
        </div>
        <!-- <button v-if="showVipButton" @click="onSubscriptionClick" class="ss_button btn_yolk bevel_yolk btn_vip" :title="loc['account_vip']" :class="{'has-sub' : isVipLive}"><img src="img/vip-club/vip-club-emblem-sm.png" alt="VIP Emblem"> {{vipButtonText}}</button> -->
        <button v-show="showNotInGame" :class="accountBtnCls" @click="onAccountBtnClick" class="ss_button btn-account-status font-sigmar align-items-center text-center justify-content-center">
            <span v-if="!isNotSignedIn">
                <icon name="ico-vip"></icon>
            </span> {{ accountBtnText }}
        </button>
        <!-- <input type="image" src="img/ico_nav_leaderboards.png" class="account_icon roundme_sm"> -->
        <div id="corner-buttons" v-show="showCornerButtons" class="f_row f_end_only align-items-center ">
            {{isPaused}}
            <!-- <input type="image" src="img/ico_nav_shop.png" @click="itemStoreClick" class="account_icon roundme_sm" v-bind:title="loc['account_title_shop']"> -->
            <!-- <input type="image" src="img/ico_nav_help.png" @click="onHelpClick" class="account_icon roundme_sm" v-bind:title="loc['account_title_faq']"> -->
            <button @click="onShareLinkClick" v-show="showShareLinkButton"  class="ss_button btn_blue bevel_blue box_relative pause-screen-ui btn-account-w-icon text-shadow-none text_blue1" :title="loc.p_pause_sharelink"><i :class="vueData.icon.invite"></i></button>
            <button @click="onSettingsClick" class="ss_button btn_blue bevel_blue box_relative pause-screen-ui btn-account-w-icon text-shadow-none text_blue1" :title="loc.account_title_settings"><i :class="vueData.icon.settings"></i></button>
            <button @click="onFullscreenClick" v-if="!vueData.isPoki && !crazyGamesActive" class="ss_button btn_blue bevel_blue box_relative pause-screen-ui btn-account-w-icon text-shadow-none text_blue1" :title="loc.account_title_fullscreen"><icon name="ico-fullscreen" class="btn-fullscreen"></icon></button>
        </div>
    </div>
    
    <!-- <div id="account_bottom" v-show="showBottom">
        <language-selector :languages="languages" :loc="loc" :selectedLanguageCode="selectedLanguageCode" :langOptions="currentLangOptions"></language-selector>
        <button id="signInButton" v-show="(isAnonymous && showSignIn)" @click="onSignInClicked" class="ss_button btn_yolk bevel_yolk">{{ loc.sign_in }}</button>
        <button id="signOutButton" v-show="!isAnonymous" @click="onSignOutClicked" class="ss_button btn_yolk bevel_yolk">{{ loc.sign_out }}</button>
        <div id="player_photo" class="box_relative" v-show="photoUrl !== null && photoUrl !== undefined && photoUrl !== '' && ! isAnonymous">
            <img :src="photoUrl" class="roundme_sm bevel_blue"/>
            <div v-if="isTwitch" class="box_aboslute account-panel-twitch roundme_sm" @click="onTwitchIconClick"><i class="fab fa-twitch"></i></div>
        </div>
    </div> -->
</div>

</script>
<template id="egg-store-notify">
<div v-if="show" class="egg-store-sale-notify" :class="{'white-blue' : color}" @click="notifyClick">
    <button class="account_icon roundme_sm account_icon-item" :title="getTitle"><i aria-hidden="true" class="fas" :class="icon"><span class="hideme">Egg</span></i>
       <span class="text" :class="{hideme : textHide}"> {{loc[text]}}</span>
    </button>
</div>
</template>
<script>
const compEggStoreSaleNotify = {
    template: '#egg-store-notify',
    props: ['loc', 'show', 'sku', 'textHide', 'text', 'icon', 'color', 'url', 'title', 'analytics'],
    methods: {
        notifyClick() {
            if (this.analytics) ga('send', 'event', 'header-buttons', 'click', this.analytics);

            if (this.url) {
                window.open(this.url, '_window');
                return;
            }

            // if (!vueData.firebaseId) {
            //     vueApp.showGenericPopup('p_redeem_error_no_player_title', 'p_redeem_error_no_player_content', 'ok');
            //     return;
            // }

            vueApp.eggStoreReferral = 'Sale notify ref';

            if (this.sku) {
                return vueApp.showPopupEggStoreSingle(this.sku)
            }

            return vueApp.onPremiumItemsClicked();
        }
    },
    computed: {
        getTitle() {
            if (!this.title) return null;
            return this.loc[__uv.$wrap((this.title))];
        }
    }
};
</script><script>
var comp_account_panel = {
template: '#account-panel-template',
components: {
    'language-selector': comp_language_selector,
    'eggstore-notify': compEggStoreSaleNotify,
    'event-panel': comp_events,
},

props: ['loc', 'eggs', 'languages', 'selectedLanguageCode', 'isPaused', 'photoUrl', 'isAnonymous', 'isOfAge', 'showTargetedAds', 'showCornerButtons', 'ui', 'isEggStoreSale', 'sku', 'isSubscriber', 'isTwitch', 'currentLangOptions', 'currentScreen', 'screens'],


data: function () {
    return {
        languageCode: this.selectedLanguageCode,
        eggBalance: 0,
        vueData,
    }
},

created() {
    this.getEggsLocalStorage();
},
methods: {
    getEggsLocalStorage() {
        const raw = localStore.getItem('localLoadOut');
        if (!raw) {
            return;
        }
        const storage = JSON.parse(raw);
        if (!'balance' in storage) {
            return;
        }
        return this.eggBalance = storage.balance;

    },
    onEggStoreClick: function () {
        if (vueData.showAdBlockerVideoAd) {
            return;
        }
        if (!vueData.firebaseId) {
            vueApp.showGenericPopup('p_redeem_error_no_player_title', 'p_redeem_error_no_player_content', 'ok');
            return;
        }
        vueApp.openEquipSwitchTo(vueApp.equipMode.shop)
        BAWK.play('ui_popupopen');
        this.gaSend('eggCount');
    },
    itemStoreClick: function() {
        this.gaSend('openItemShop');
        vueApp.openEquipSwitchTo();
        vueApp.$refs.equipScreen.switchToShop();
        BAWK.play('ui_popupopen');
    },
    onHelpClick: function () {
        vueApp.showHelpPopup();
        this.gaSend('openHelp');
        BAWK.play('ui_popupopen');
    },

    onSettingsClick: function () {
        this.gaSend('openSettings');
        this.onSharedPopupOpen();
        vueApp.showSettingsPopup();
        BAWK.play('ui_popupopen');
    },

    onFullscreenClick: function () {
        this.gaSend('fullscreen');
        extern.toggleFullscreen();
        BAWK.play('ui_click');
    },

    onSignInClicked: function () {
        vueApp.setDarkOverlay(true);
        this.$emit('sign-in-clicked');
    },

    onSignOutClicked: function () {
        vueApp.setDarkOverlay(true);
        this.$emit('sign-out-clicked');
    },

    onShareLinkClick: function () {
        this.gaSend('openShareLink');
        this.onSharedPopupOpen();
        extern.inviteFriends();
    },

    onAnonWarningClick: function() {
        ga('send', 'event', vueApp.googleAnalytics.cat.playerStats, vueApp.googleAnalytics.action.anonymousPopupOpen);
        vueApp.showAttentionPopup();
    },
    onSubscriptionClick() {
        this.gaSend('openVipPopup');
        vueApp.showSubStorePopup();
    },
    gaSend(label) {
        if (!label) return;
        ga('send', 'event', 'header-buttons', 'click', label);
    },
    onTwitchIconClick() {
        window.open(dynamicContentPrefix + 'twitch');
    },
    onAccountBtnClick() {
        if (this.isAnonymous && this.showSignIn) {
            this.onSignInClicked();
        } else {
            this.onSubscriptionClick();
        }
    },
    eggShake() {
        this.$refs.eggCounter.classList.add('egg-shake');
        setTimeout(() => this.$refs.eggCounter.classList.remove('egg-shake'), 300);
    },
    onSharedPopupOpen() {
        if (extern.inGame) {
            vueApp.hideRespawnDisplayAd();
        }
    },
    onSharedPopupClosed() {
        if (extern.inGame) {
            vueApp.showRespawnDisplayAd();
        }
    },
},

computed: {
    showSignIn: function () {
        if (!isFromEU) {
            return true;
        }

        return isFromEU && this.isOfAge && this.showTargetedAds;
    },

    showShareLinkButton: function () {
        return this.showCornerButtons && this.currentScreen === this.screens.game;
    },

    hideNewItemNotify() {
        // if (!ssChangelogDate) return false;
        // if (!this.showCornerButtons) return false;
        // const lapsed = Date.now() - ssChangelogDate.valueOf(),
        // 	  days = Math.floor((lapsed / (60*60*24*1000)));

        // if (days <= 5 ) return true;
        // return false;
        return;
    },

    vipButtonText() {
        return this.isSubscriber && !extern.account.upgradeIsExpired ? '' : this.loc.s_btn_txt_subscribe;
    },
    showVipButton() {
        return this.showScreen === this.screens.home || this.showScreen === this.screens.equip;
    },
    isVipLive() {
        return this.isSubscriber && !extern.account.upgradeIsExpired;
    },
    accountBtnCls() {
        if (this.isAnonymous && this.showSignIn) {
            return 'btn_green bevel_green'
        } else {
            if (this.isSubscriber) {
                return 'btn_yolk bevel_yolk btn_vip width-auto vertical-align-middle';
            } else {
                return 'btn_yolk bevel_yolk btn_vip vertical-align-middle';
            }
        }

    },
    accountBtnText() {
        if (this.isAnonymous && this.showSignIn) {
            return this.loc.sign_in;
        } else {
            if (this.isSubscriber) {
                return '';
            } else {
                return this.loc.s_btn_txt_subscribe;
            }
        }
    },
    isNotSignedIn() {
        return this.isAnonymous && this.showSignIn;
    },
    showNotInGame() {
        if (this.currentScreen !== this.screens.game && !extern.inGame) {
            return true;
        } else {
            return false;
        }
    }
},
watch: {
    eggs() {
        this.eggShake();
        this.eggBalance = this.eggs;
    }
}
};
</script>
<script id="play-panel-template" type="text/x-template">
<div id="play-panel" class="box_relative">
    <weapon-select-panel id="weapon_select" class="justify-content-center centered_x" :loc="loc" :account-settled="isGameReady" :current-class="currentClass" :current-screen="showScreen" :screens="screens" :play-clicked="playClicked" @changed-class="onChangedClass"></weapon-select-panel>
    <ss-button-dropdown class="play-panel-region-select" :loc="loc" :loc-txt="serverText"  :selected-item="currentRegionId" @onListItemClick="onRegionPicked" menuPos="bottom">
        <template slot="dropdown">
            <li v-if="regionList" ref="items" v-for="(g, idx) in regionList" :class="{ 'selected' : currentRegionId === g.id }" class="display-grid gap-sm align-items-center text_blue5 font-nunito regions-select" @click="onRegionPicked(g.id)">
                <div class="f_row align-items-center">
                    <icon v-show="currentRegionId === g.id" name="ico-checkmark" class="option-box-checkmark"></icon>
                </div>
                <div>
                    {{ loc[g.locKey ]}}
                </div>
                <div class="text-right">
                    {{ g.ping }}ms
                </div>
            </li>
        </template>
    </ss-button-dropdown>
    <div class="play-panel-btn-group display-grid grid-auto-flow-column gap-1 centered_x">
        <button @click="onJoinPrivateGameClick" class="is-for-play ss_button btn_big btn_blue_light bevel_blue_light btn_play_w_friends display-grid align-items-center box_relative"><span>{{ loc.p_privatematch_friends }}</span></button>
        <button @click="onPlayButtonClick" class="is-for-play ss_button btn_big btn_green bevel_green play-button box_relative" v-html="playBtn"></button>
        <ss-button-dropdown :loc="loc" :loc-txt="gameTypeTxt" :list-items="gameTypes" :selected-item="pickedGameType" @onListItemClick="onGameTypeChange" @dropdownOpen="onGameTypeBtnOpen" @dropdownClosed="onGameTypeBtnClosed" sort="order"></ss-button-dropdown>
    </div>
    <!-- Popup: Pick Region -->
    <large-popup id="pickRegionPopup" ref="pickRegionPopup" @popup-closed="onPickRegionPopupClosed">
        <template slot="header">{{ loc.server }}</template>
        <template slot="content">
            <region-list-popup id="region_list_popup" ref="regionListPopup" v-if="(regionList.length > 0)" :loc="loc" :regions="regionList" :region-id="currentRegionId" @region-picked="onRegionPicked"></region-list-popup>
        </template>
    </large-popup>

    <!-- Popup: Join Private Game -->
    <large-popup id="joinPrivateGamePopup" ref="joinPrivateGamePopup" :class="joinOnlyCls" :popup-model="home.joinPrivateGamePopup" @popup-confirm="onJoinConfirmed" :hide-cancel="true" @popup-closed="onCloseCreateGame">
        <template slot="content">
            <div class="">
                <div v-show="!joinUrlRequest" class="play-panel-panels roundme_md">
                    <create-private-game-popup id="createPrivateGame" ref="createPrivateGame" :loc="loc" :region-loc-key="regionLocKey" :is-game-ready="isGameReady" :picked-game-type="pickedGameType" :game-type-txt="gameTypeTxt" :game-types="gameTypes" @onGameTypeChange="onGameTypeChange" @onRegionPicked="onRegionPicked" map-img-base-path="maps/" :mapList="maps" :regions="regionList" :currentRegionId="currentRegionId"></create-private-game-popup>
                    <div class="error_text shadow_red" v-show="home.joinPrivateGamePopup.showInvalidCodeMsg">{{ loc.p_game_code_blank }}</div>
                </div>
                <div class="play-panel-panels play-panel-panels-join roundme_md">
                    <div class="private-game-wrapper fullwidth">
                        <div class="inner-wrapper">
                            <header>
                                <h1 class="nospace">{{ loc.p_game_code_title }}</h1>
                            </header>
                            <div class="display-grid grid-column-2-1 gap-sm">
                                <input type="text" class="ss_field fullwidth" v-model="home.joinPrivateGamePopup.code" v-bind:placeholder="loc.p_game_code_enter" @focus="onJoinGameFocus" v-on:keyup.enter="onJoinConfirmed">
                                <button class="ss_button common-box-shadow ss_button_join" @click="onJoinConfirmed">{{ loc.p_game_code_title }}!</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <template slot="cancel">{{ loc.cancel }}</template>
        <template slot="confirm">{{ loc.confirm }}</template>
    </large-popup>

    <small-popup id="showGameModePopup" ref="showGameModePopup" @popup-confirm="onGameModePopupConfirm">
        <template slot="header">Game Mode</template>
        <template slot="content">
        <div class="select-box-wrap">
            <label for="create-select-type" class="ss_button btn_yolk bevel_yolk"><i class="fas fa-chevron-down"></i></label>
            <select id="create-select-type" name="gameType" v-model="pickedGameType" class="ss_select select" @change="onGameTypeChange($event)">
                <option v-for="g in gameTypes" v-bind:value="g.value" :class="'game-select-' + g.locKey" v-html="loc[g.locKey]"></option>
            </select>
        </div>
        </template>
        <template slot="cancel">{{ loc.cancel }}</template>
        <template slot="confirm">{{ loc.confirm }}</template>
    </small-popup>
</div>
</script>

<script id="region-list-template" type="text/x-template">
<div>
    <h1 class="roundme_sm">{{ loc.p_servers_title }}</h1>
    {{ regions }} - {{ regionId }}
    <div v-for="r in regions" :key="r.id">
        <div id="region_list_item">
            <input type="radio" :id="('rb_' + r.id)" name="pickRegion" v-bind:value="r.id" v-model="regionId" @click="BAWK.play('ui_onchange')">
            <label :for="('rb_' + r.id)" class="regionName">{{ extern.getLocText(r.locKey) }} </label>
            <label :for="('rb_' + r.id)" class="regionPingWrap roundme_sm">
                <span class="pingBar" :class="barColorClass(r)" :style="barStyle(r)"></span>
            </label>
            <label :for="('rb_' + r.id)" class="regionPingNumber ss_marginleft_lg"> {{ r.ping }}ms</label>
        </div>
    </div>
    <div id="btn_horizontal" class="f_center">
        <button @click="onConfirmClick()" class="ss_button btn_green bevel_green btn_sm">{{ loc.ok }}</button>
    </div>
</div>
</script>

<script>
var comp_region_list_popup = {
template: '#region-list-template',
props: ['loc', 'regions', 'regionId'],

data: function () {
    return {
        colorClasses: ['greenPing', 'yellowPing','orangePing', 'redPing'],
    }
},

methods: {
    playSound (sound) {
        BAWK.play(sound);
    },
    
    barColorClass: function (region) {
        var colorIdx = Math.min(3, Math.floor(region.ping / 150));
        return this.colorClasses[__uv.$wrap((colorIdx))];
    },

    barStyle: function (region) {
        return {
            width: (10 - Math.min(9, region.ping / 50)) + 'em'
        }
    },

    onConfirmClick: function () {
        this.$emit('region-picked', this.regionId);
        this.$parent.close();
        BAWK.play('ui_playconfirm');
    }
}
};
</script><template id="weaponselect_panel_template" type="text/x-template">
<div class="center_h ss_marginbottom_sm">
    <div v-show="showDesc" class="grid-span-column-all text-center align-items-center ss_marginbottom_sm">
        <h3 class="nospace text_blue8">{{ weapon.title }}</h3>
        <p class="nospace text_blue3"><i>{{ weapon.desc }}</i></p>
    </div>
    <div class="display-grid grid-auto-flow-column justify-content-around gap-sm">
        <div class="nospace" @click="selectClass(charClass.Soldier)">
            <icon name="ico-weapon-soldier" class="weapon_img roundme_md" :cls="addSelectedCssClass(charClass.Soldier)"></icon>
        </div>
        <div class="nospace" @click="selectClass(charClass.Scrambler)">
            <icon name="ico-weapon-scrambler" class="weapon_img roundme_md" :cls="addSelectedCssClass(charClass.Scrambler)"></icon>
        </div>
        <div class="nospace" @click="selectClass(charClass.Ranger)">
            <icon name="ico-weapon-ranger" class="weapon_img roundme_md" :cls="addSelectedCssClass(charClass.Ranger)"></icon>
        </div>
        <div class="nospace" @click="selectClass(charClass.Eggsploder)">
            <icon name="ico-weapon-rpegg" class="weapon_img roundme_md" :cls="addSelectedCssClass(charClass.Eggsploder)"></icon>
        </div>
        <div class="nospace" @click="selectClass(charClass.Whipper)">
            <icon name="ico-weapon-whipper" class="weapon_img roundme_md" :cls="addSelectedCssClass(charClass.Whipper)"></icon>
        </div>
        <div class="nospace" @click="selectClass(charClass.Crackshot)">
            <icon name="ico-weapon-crackshot" class="weapon_img roundme_md" :cls="addSelectedCssClass(charClass.Crackshot)"></icon>
        </div>
        <div class="nospace" @click="selectClass(charClass.TriHard)">
            <icon name="ico-weapon-trihard" class="weapon_img roundme_md" :cls="addSelectedCssClass(charClass.TriHard)"></icon>
        </div>
    </div>
    <div v-if="currentScreen == screens.game" class="grid-span-column-all text-center align-items-center ss_marginbottom_sm">
        <h3 class="nospace text_blue8">{{ weapon.title }}</h3>
        <p class="nospace text_blue3"><i>{{ weapon.desc }}</i></p>
    </div>
</div>
</template>

<script>
var comp_weapon_select_panel = {
template: '#weaponselect_panel_template',
props: ['currentClass', 'loc', 'accountSettled', 'playClicked', 'currentScreen', 'screens', 'hideDesc'],

data: function () {
    return {
        charClass: CharClass,
    }
},

methods: {
    selectClass: function (classIdx) {
        if (!extern.inGame && (!this.accountSettled || this.playClicked || (this.currentClass === classIdx))) {
            return;
        } else {
            extern.changeClass(classIdx);
            this.$emit('changed-class', classIdx);
            BAWK.play('ui_click');
        }
    },

    addSelectedCssClass: function (classIdx) {
        if (!extern.inGame && this.playClicked) {
            return;
        } else {
            return (this.currentClass === classIdx)
            ? 'weapon_selected'
            : '';
        }
    },
},
computed: {
    weapon() {
        let className = getKeyByValue(this.charClass, this.currentClass).toLowerCase();
        return {
            title: this.loc[__uv.$wrap((`weapon_${className}_title`))],
            desc: this.loc[__uv.$wrap((`weapon_${className}_content`))],
        }
    },
    showDesc() {
        return !this.hideDesc && this.currentScreen !== this.screens.game;
    }
}
};
</script>

<script>
var comp_play_panel = {
template: '#play-panel-template',
components: {
    'create-private-game-popup': comp_create_private_game_popup,
    'region-list-popup': comp_region_list_popup,
    'weapon-select-panel': comp_weapon_select_panel,
},

props: ['loc', 'playerName', 'gameTypes', 'currentGameType', 'regionList', 'currentRegionId', 'home', 'isGameReady', 'maps', 'currentClass', 'showScreen', 'screens', 'playClicked', 'languageCode'],

data: function() {
    return {
        pickedGameType: this.currentGameType,
        isButtonDisabled: true,
        playClickedBeforeReady: false,
        playClickFunction: Function,
        kotcPrompt: '',
        typeSelect: '',
        isPromptOpen: false,
        joinUrlRequest: false,
    }
},
        
methods: {
    onPickRegionButtonClick: function () {
        this.$refs.pickRegionPopup.toggle();
        BAWK.play('ui_popupopen');
    },
    
    onRegionPicked: function (regionId) {
        if (vueData.currentRegionId === regionId) { return; }
        
        vueData.currentRegionId = regionId;
        extern.selectRegion(vueData.currentRegionId);
        BAWK.play('ui_onchange');
    },

    onPickRegionPopupClosed: function () {
        if (this.$refs.createPrivateGame.showingRegionList) {
            this.$refs.createPrivateGame.showingRegionList = false;
            this.$refs.createPrivateGamePopup.toggle();
            this.$refs.createPrivateGame.onKeyDownMapSelect();
        }
    },

    onNameChange: function (event) {
        console.log('name changed to: ' + event.target.value);
        this.$emit('playerNameChanged', event.target.value);
    },

    onPlayerNameKeyUp: function (event) {
        event.target.value = extern.filterUnicode(event.target.value);
        event.target.value = extern.fixStringWidth(event.target.value);
        event.target.value = event.target.value.substring(0, 128);

        // Send username to server to start the game!
        if (event.code == "Enter" || event.keyCode == 13) {
            if (vueData.playerName.length > 0) {
                vueApp.externPlayObject(vueData.playTypes.joinPublic, this.pickedGameType, this.playerName, -1, '');
            }
        }
    },
    onGameTypeBtnOpen() {
        if (this.isWinSizeSmall()) vueApp.hideTitleScreenAd();
    },
    onGameTypeBtnClosed() {
        if (this.isWinSizeSmall()) vueApp.showTitleScreenAd();
    },
    isWinSizeSmall() {
        var win = window,
            doc = document,
            docElem = doc.documentElement,
            body = doc.getElementsByTagName('body')[__uv.$wrap((0))],
            x = win.innerWidth || docElem.clientWidth || body.clientWidth,
            y = win.innerHeight|| docElem.clientHeight|| body.clientHeight;
        // if (x <= 1366 && y <= 768) {
        if (x <= 1366) {
            return true;
        }
        return false;
    },

    onGameTypeChange: function (event) {
        let type;
        if (event.target !== undefined) {
            type = event.target.value;
        } else {
            type = event;
        }

        this.pickedGameType = type;
        this.$emit('game-type-changed', this.pickedGameType);
        extern.selectGameType(this.pickedGameType);
        BAWK.play('ui_onchange');
    },
    onPlayTypeWhenSignInComplete() {
        return this.playClickFunction();
    },
    onPlaySentBeforeSignIn(callback) {
        this.gameClickedBeforeReady = true;
        vueApp.showSpinner('signin_auth_title', 'signin_auth_msg');
        this.playClickFunction = callback;
    },
    hasValidPlayerNameCheck() {
        console.log('invalid player name');
        vueApp.showGenericPopup('play_pu_name_title', 'play_pu_name_content', 'ok');
        vueApp.hideSpinner();
        return;
    },
    onPlayButtonClick: function () {
        if (!hasValue(this.playerName)) {
            this.hasValidPlayerNameCheck();
            return;
        }
        if (!this.isGameReady) {
            this.onPlaySentBeforeSignIn(this.onPlayButtonClick);
            return;
        }

        this.onCloseCreateGame();
        vueApp.game.respawnTime = 0;
        vueApp.externPlayObject(vueData.playTypes.joinPublic, this.pickedGameType, this.playerName, -1, '');
        BAWK.play('ui_playconfirm');
    },

    onCloseCreateGame() {
        this.$refs.createPrivateGame.removeKeydown();
    },

    onJoinPrivateGameClick: function () {
        this.showJoinPrivateGamePopup(vueData.home.joinPrivateGamePopup.code);
        BAWK.play('ui_popupopen');
    },

    showJoinPrivateGamePopup: function (showCode, urlRequest) {
        // The popup must be active before it will update; set code after showing

        this.joinUrlRequest = hasValue(urlRequest);
        this.$refs.joinPrivateGamePopup.show();
        this.$refs.createPrivateGame.onKeyDownMapSelect();

        vueData.home.joinPrivateGamePopup.code = showCode;
    },

    onJoinConfirmed: function () {
        if (!hasValue(this.playerName)) {
            this.hasValidPlayerNameCheck();
            return;
        }
        if (!this.isGameReady) {
            this.onPlaySentBeforeSignIn(this.onJoinConfirmed)
            return;
        }

        let match = null;

        if (vueData.home.joinPrivateGamePopup.code.match(/\#\w+/)) {
            match = vueData.home.joinPrivateGamePopup.code.match(/\#\w+/)[__uv.$wrap((0))];
        } else if (vueData.home.joinPrivateGamePopup.code.includes('crazyShare')) {
            match = vueData.home.joinPrivateGamePopup.code.match(/=\w*$/)[__uv.$wrap((0))].substring(1);
        }
        else { // In case someone copy/pastes the thing without including the #
            match = vueData.home.joinPrivateGamePopup.code;
        }

        if (!match) {
            return;
        }

        match = match.trim();
        if (match.startsWith('#')) match = match.substring(1)

        vueData.home.joinPrivateGamePopup.code = match;

        this.$refs.joinPrivateGamePopup.hide();

        // checking if the invite code is being used since, we are only trying to determine
        extern.onJoinGameClick = true;
        vueApp.externPlayObject(vueData.playTypes.joinPrivate, '', this.playerName, '', vueData.home.joinPrivateGamePopup.code);
    },
    kotcAttachSetup() {
        const typePostion = this.typeSelect.getBoundingClientRect();
        const kotcPrompt = this.kotcPrompt.getBoundingClientRect();

        this.kotcPrompt.style.__uv$setSource(__uv).__uv$top = typePostion.__uv$setSource(__uv).__uv$top + 'px';
        this.kotcPrompt.style.left = typePostion.right + 16 + 'px';
    },

    anchorKotcPrompt() {
        this.$nextTick(() => this.kotcAttachSetup());
    },
    onGameTypeClick() {
        if (this.isPromptOpen) {
            this.isPromptOpen = false;
        } else {
            this.isPromptOpen = true;
        }
        // this.$refs.showGameModePopup.show();
    },
    onGameModePopupConfirm() {
        this.$refs.showGameModePopup.hide();
    },

    onJoinGameFocus() {
        this.$refs.createPrivateGame.removeKeydown();
    },
    onChangedClass() {
        vueApp.$refs.equipScreen.onChangedClass();
    }
},

computed: {
    regionLocKey: function () {
        if (!hasValue(this.regionList) || this.regionList.length === 0) {
            return '';
        }

        var region = this.regionList.find(r => {
            return r.id == vueData.currentRegionId;
        });

        return hasValue(region) ? 'server_' + region.id : '';
    },
    regionName: function () {
        if (!hasValue(this.regionList) || this.regionList.length === 0) {
            return 'N/A';
        }

        var region = this.regionList.find(r => {
            return r.id == vueData.currentRegionId;
        });

        if (!region) return 'N/A';

        return this.loc[__uv.$wrap((region.locKey))] || region.id;
    },

    selectedGameType() {
        return this.loc[__uv.$wrap((this.gameTypes.filter(el => el.value === this.pickedGameType)[__uv.$wrap((0))][__uv.$wrap(('locKey'))]))]; 
    },
    gameTypeTxt() {
        return {
            title: this.loc.stat_game_mode,
            subTitle: this.loc[__uv.$wrap((this.gameTypes.filter(el => el.value === this.pickedGameType)[__uv.$wrap((0))][__uv.$wrap(('locKey'))]))]
        }
    },
    serverText () {
        return {
            title: this.loc.p_servers_title,
            subTitle: this.currentRegionId ? this.loc[__uv.$wrap((`server_${this.currentRegionId}`))] : '',
        }
    },
    playBtn() {

        if (this.languageCode == 'de' || this.languageCode == 'es' || this.languageCode == 'pt' || this.languageCode == 'nl'){
            return `<i class="fa fa-play fa-sm"></i> <span>${this.loc.home_play}</span>`
        }
        return `<i class="fa fa-play fa-sm"></i> ${this.loc.home_play}`;
    },
    joinOnlyCls() {
        return this.joinUrlRequest ? 'join-request-only' : '';
    }

},
watch: {
    currentGameType: function (val) {
        this.pickedGameType = val;
    },
    isGameReady(val) {
        this.isButtonDisabled = val ? false : true;
        if (this.gameClickedBeforeReady && val) {
            this.onPlayTypeWhenSignInComplete()
        }
    }
}
};
</script><script id="newsfeed-panel-template" type="text/x-template">
<section class="news-panel v_scroll">
    <article v-if="items" v-for="item in activeItems" :key="item.id" @click="onItemThatIsClicked(item)" class="media-item news_item clickme">
        <img :src="imageSrc(item)" class="news_img roundme_sm">
        <p>{{ item.content }}</p>
    </article>
</section>
</script>

<script>
var comp_newsfeed_panel = {
template: '#newsfeed-panel-template',
props: ['items'],

data: function () {
    return vueData;
},

// mounted: function () {
// 	// this.fetchWebData();
// 	this.checklocalForNewsData();
// },

methods: {
    imageSrc(item) {
        return dynamicContentPrefix + 'data/img/newsItems/' + item.id + item.imageExt;
    },
    onItemThatIsClicked(item) {
        console.log(item);
        extern.clickedWebFeedItem(item);
        BAWK.play('ui_click');
    },
},
computed: {
    activeItems() {
        return this.items.filter(item => item.active);
    }
}
};
</script><script id="chicken-panel-template" type="text/x-template">
<div id="showBuyPassDialogButton" class="new">
    <div class="chicken-panel--upgraded" v-show="doUpgraded && !isSubscriber">
        <div class="tool-tip tool-tip--right">
            <span v-if="nugCounter" id="nugget-countdown">{{nugCounter}} Minutes remaining.</span>
            <img class="upgraded-nugget" src="img/chicken-nugget/goldenNugget_static.png">
            <!-- <div id="nugget-timer" class="nugget-timer--wrapper">
                <div class="timer-background"></div>
                <div class="timer spinner"></div>
                <div class="timer filler"></div>
                <div class="mask"></div>
            </div> -->
        </div>
    </div>
    
    <div class="chicken-panel--no-upgraded" v-show="!doUpgraded">
        <img src="img/chicken-nugget/starburst.png" @click="onChickenClick" class="clickme starburst">
        <img src="img/chicken-nugget/goldenNuggetGIFWIP.gif" @click="onChickenClick" class="clickme nugget-chick">
    
        <div id="buyPassChickenSpeech">
            <img src="img/speechtail.png" class="buyPassChickenSpeechTail">
            <span v-html="loc.chicken_cta"></span>
        </div>
    </div>
</div>
</script>

<script>
var comp_chicken_panel = {
template: '#chicken-panel-template',
props: ['local', 'doUpgraded'],
data: function () {
    return vueData;
},
methods: {
    onChickenClick: function () {
        BAWK.play('ui_chicken');
        vueApp.showGoldChickenPopup();
        ga('send', 'event', this.googleAnalytics.cat.purchases, 'Golden Chicken Click');
    },
},
};
</script><script id="footer-links-panel-template" type="text/x-template">
<footer class="main-footer">
    <!-- <section class="social-icons">
        <social-panel id="social_panel" :loc="loc" :is-poki="isPoki" :use-social="selectedSocial" :social-media="socialMedia"></social-panel>
    </section> -->
    <section class="centered">
        <nav class="footer-nav text-center">
            <button @click="onChangelogClicked" class="clickme ss_button_as_text">{{ version }}</button> | 
            <!-- <a href="https://shell-shockers.myshopify.com/collections/all" target="_blank" @click="BAWK.play('ui_click')">{{ loc.footer_merchandise }}</a> |  -->
            <button class="ss_button_as_text" target="_blank" @click="openInNewTab('https://www.bluewizard.com/privacypolicy')">{{ loc.footer_privacypolicy }}</button> | 
            <button class="ss_button_as_text" target="_blank" @click="openInNewTab('https://bluewizard.com/terms/')">{{ loc.footer_termsofservice }}</button> | 
            <button class="ss_button_as_text" @click="onHelpClick">{{ loc['account_title_faq'] }}</button> | 
            <button class="ss_button_as_text" target="_blank" @click="openInNewTab('https://www.bluewizard.com')">&copy; 2023 <img class="main-footer--logo-blue-wiz-mini" src="img/blue-wizard-logo-tiny-min.png" :alt="loc.footer_bluewizard + ' logo'"><span class="hideme">{{ loc.footer_bluewizard }}</span></button>
        </nav>
    </section>
</footer>
</script>

<script>
var comp_footer_links_panel = {
template: '#footer-links-panel-template',
props: ['loc', 'version', 'isPoki', 'socialMedia', 'selectedSocial'],

methods: {
    onChangelogClicked: function () {
        vueApp.showChangelogPopup();
        BAWK.play('ui_popupopen');
    },
    playSound() {
        BAWK.play('ui_click');
    },
    onHelpClick() {
        vueApp.showHelpPopup();
        // this.gaSend('openHelp');
        BAWK.play('ui_popupopen');
    },
    openInNewTab(url) {
        window.open(url, '_blank').focus();
        this.playSound();
    }
}
};
</script>
<template id="comp-vip-cta">
<div class="house-ad-wrapper">
    <div class="vip-club-cta">
        <button v-if="!isSubscriber &amp;&amp; hasMobileReward &amp;&amp; showVip" class="vip-club-cta-pos ss_button btn_sm btn_pink bevel_pink" @click="onClicked">
            {{ loc.ui_game_playeractions_join_vip }}
        </button>
        <h4 v-if="isSubscriber &amp;&amp; showVip" class="sub-name">
            {{loc[subName]}}
        </h4>
        <img :class="imgCls" :src="getImgSrc" :alt="getImgSrcAlt" @click="onClicked">
    </div>
    <div v-if="!isOnCrazyGames" class="ss_margintop box_relative">
        <p class="free-games-title text-center nospace text_red font-800">{{ loc.free_games_play_on }}</p>
        <a href="https://freegames.io/game/shell-shockers?utm_source=shellshockershomepage&amp;utm_medium=referral" target="_blank" title="Play Free Games on... well, Free Games dot io">
            <img src="img/free-games-io.png" alt="FreeGames.io logo" class="display-block center_h free-games-logo">
        </a>
    </div>
</div>
</template>

<script>
const CompHouseAd = {
    template: '#comp-vip-cta',
    props: ['loc', 'upgradeName', 'isUpgraded', 'isSubscriber', 'hasMobileReward', 'isPoki', 'chwCount', 'chwReady', 'chwLimitReached', 'ads'],
    data() {
        return {
            subName: '',
            hasPlayedKotc: null,
            current: 'chicknWinner',
            random: [],
            eventData: {
                event: {
                    'kotcPopup': {
                        img: 'img/kotc/new-game-mode-king-of-coop.png',
                        alt: 'Click to learn how to play King of the Coop!',
                        url: '',
                        crazyUrl: '',
                        shopMode: null,
                        hideOnCrazyGames: false
                    },
                    'vipImgSrc': {
                        img: 'img/events/vip-club-find-out-more.jpeg',
                        alt: 'Manage VIP',
                        url: '',
                        crazyUrl: '',
                        shopMode: null,
                        hideOnCrazyGames: false
                    },
                    'mobile': {
                        img: 'img/events/mobile-double-eggs-for-kills.png',
                        alt: 'Download mobile today!',
                        url: 'showGetMobilePopup',
                        crazyUrl: '',
                        shopMode: null,
                        hideOnCrazyGames: false
                    },
                    'blackFryday': {
                        img: 'img/store-black-friday/black-fryday-home-screen-ad.png',
                        alt: 'BLACK FRYDAY SALE!',
                        url: '',
                        crazyUrl: '',
                        shopMode: null,
                        hideOnCrazyGames: false
                    },
                    'eggOrg': {
                        img: 'img/egg-org/eggOrg_timeTravel_houseAd2-min.jpg',
                        alt: 'EggOrg is back!',
                        url: '',
                        crazyUrl: '',
                        shopMode: null,
                        hideOnCrazyGames: false
                    },
                    'twitchDrops': {
                        img: 'img/events/TwitchDrops2023-houseAd300x250.png',
                        alt: 'Get your drops today!',
                        url: '',
                        crazyUrl: '',
                        shopMode: null,
                        hideOnCrazyGames: false
                    },
                    'chicknWinner': {
                        img: 'img/events/ssAd_chicknWinner300x250.png',
                        alt: '',
                        imgAlt: '2',
                        imgAltTwo: '3',
                        url: '',
                        crazyUrl: '',
                        shopMode: null,
                        hideOnCrazyGames: false
                    },
                    'badEgg': {
                        img: 'img/events/bad-egg-300x250.png',
                        url: 'https://freegames.io/game/bad-egg?utm_source=shellshock_homepagead&utm_medium=referral',
                        crazyUrl: 'https://www.crazygames.com/game/bad-egg',
                        shopMode: null,
                        alt: '',
                        hideOnCrazyGames: false
                    },
                    'badEggBeta': {
                        img: 'img/events/badEgg_beta_house_ad.jpeg',
                        url: 'https://store.steampowered.com/app/2397630',
                        crazyUrl: '',
                        shopMode: null,
                        alt: '',
                        hideOnCrazyGames: false
                    },
                    'badEggRifle': {
                        img: 'img/events/badEgg_PabloRifle_300x250.png',
                        url: 'https://store.steampowered.com/app/2397630',
                        crazyUrl: '',
                        shopMode: null,
                        alt: '',
                        hideOnCrazyGames: false
                    },
                    'basketBros': {
                        img: 'img/events/basket-bros-house-ad.png',
                        url: 'https://basketbros.io?utm_source=shellshockers&utm_medium=referral&utm_campaign=housead',
                        crazyUrl: 'https://www.crazygames.com/game/basketbros',
                        shopMode: null,
                        alt: '',
                        hideOnCrazyGames: false
                    },
                    'eggPacks': {
                        img: 'img/events/shellShockersAd_EggPacks300x250-min.png',
                        url: '',
                        crazyUrl: '',
                        shopMode: 4,
                        hideOnCrazyGames: false
                    },
                    'wrestleBros': {
                        img: 'img/events/ad_wrestleBrosCTA_250x300.png',
                        url: 'https://wrestlebros.io/?utm_source=shell_shockers_homescreenad&utm_medium=referral',
                        crazyUrl: '',
                        hideOnCrazyGames: false
                    },
                    'shellSurvey': {
                        img: 'img/events/shell_survey.jpeg',
                        url: 'https://www.surveymonkey.com/r/septshell23',
                        crazyUrl: '',
                        hideOnCrazyGames: false
                    },
                },
            },
        };
    },
    mounted() {
        this.hasPlayedKotc = localStore.getItem('hasPlayedKotc');
        if (this.hasMobileReward && this.random.includes('mobile')) this.random.splice(this.random.indexOf('mobile'), 1);
    },
    methods: {
        onClicked() {
            switch (this.useEventData) {
                case 'twitchDrops':
                    window.open(dynamicContentPrefix + 'twitch?utm_medium=referral&utm_campaign=featureslot', '_blank');
                    break;
                case 'eggOrg':
                    vueApp.showSelectedTaggedItemsOnEquipScreen('EGGORG');
                    break;
                case 'blackFryday':
                    vueApp.showEggStorePopup();
                    break;

                case 'kotcPopup':
                    vueApp.showKotcInstrucPopup();
                    break;

                case 'scavengerHunt':
                    vueApp.showScavengerHuntPopup();
                    break;

                case 'chicknWinner':
                    this.$emit('chw-video-request');
                    break;

                case 'eggPacks':
                    vueApp.openEquipSwitchTo(this.eventData.event[__uv.$wrap((this.useEventData))].shopMode);
                    break;

                case 'mobile':
                    ga('send', 'event', 'home-display-ad', 'click', 'mobile-ad');
                    vueApp.showGetMobilePopup();
                    break;
                case 'vipImgSrc':
                    let vipType = 'vip-ad';
                    if (this.isUpgraded && this.sSubscriber) {
                        let vipType = 'vip-manage';
                    }
                    ga('send', 'event', 'home-display-ad', 'click', vipType);
                    vueApp.showSubStorePopup();
                    break;

                default:
                    // lets assume that most are urls
                    window.open(this.url, '_blank');

                    ga('send', 'event', 'home-display-ad', 'click', this.useEventData);

                    if (this.useEventData === 'basketBros') {
                        setTimeout(() => {
                            extern.giveBasketBrosReward();
                        }, 1000);
                    }
                    break;
            }

            if (this.current) {
                ga('send', 'event', 'home-display-ad', 'click', this.useEventData);
            }

        },

        default() {
            if (!this.isPoki) {
                // if has mobile item
                if (this.hasMobileReward) {
                    let vipType = 'vip-ad';
                    if (this.isUpgraded && this.sSubscriber) {
                        let vipType = 'vip-manage';
                    }
                    ga('send', 'event', 'home-display-ad', 'click', vipType);
                    vueApp.showSubStorePopup();
                    return;
                } else {
                    ga('send', 'event', 'home-display-ad', 'click', 'mobile-ad');
                    vueApp.showGetMobilePopup();
                    return;
                }
            }
        }
    },
    computed: {
        getImgSrc() {
            if (this.useEventData) {
                return this.eventData.event[__uv.$wrap((this.useEventData))].img;
            } else {
                if (!this.isPoki) {
                    if (this.hasMobileReward) {
                        return this.eventData.event.vipImgSrc.img;
                    } else {
                        return this.eventData.event.mobile.img;
                    }
                }
            }
        },

        getImgSrcAlt() {
            if (this.useEventData) {
                return this.eventData.event[__uv.$wrap((this.useEventData))].alt;
            } else {
                if ( !this.isPoki) {
                        if (this.hasMobileReward) {
                            return this.eventData.event.vipImgSrc.alt;
                        } else {
                            return this.eventData.event.mobile.alt;
                        }
                    }
            }
        },
        showVip() {
            return false;
            if (!this.hasPlayedKotc || !this.hasMobileReward || this.isBlackFryday) {
                return false;
            } else {
                return true;
            }
        },
        imgCls() {
            return `${this.useEventData}-img`;
        },
        useEventData() {
            if (this.random && this.random.length > 0) {
                let randomKey = this.random[__uv.$wrap((Math.floor(Math.random() * this.random.length)))];
                if (Object.keys(this.eventData.event).includes(randomKey)) {
                    return randomKey;
                } else {
                    return this.current;
                }

            } else {
                return this.current;
            }
        },
        isOnCrazyGames() {
            return crazyGamesActive;
        },
        url() {
            if (!this.eventData.event[__uv.$wrap((this.useEventData))].url) {
                return null;
            }
            return crazyGamesActive && this.eventData.event[__uv.$wrap((this.useEventData))].crazyUrl ? this.eventData.event[__uv.$wrap((this.useEventData))].crazyUrl : this.eventData.event[__uv.$wrap((this.useEventData))].url;
        },

    },
    watch: {
        ads(val) {
            const all = [];
            if (val.length) {
                val.forEach(el => {
                    all.push(el.ad);
                    if (el.weighted) {
                        all.push(el.ad);
                    }
                });
            }

            if (this.random.length > 0) {
                this.random.length = 0;
            }

            this.random = all;
        },
        upgradeName(val) {
            if (!hasValue(val)) {
                return;
            }
            this.subName = `s-${val.replace(' ', '-').toLowerCase().replace(' ', '-')}-title`;
        }
    }
};
</script><script id="media-tabs-template" type="text/x-template">
<div class="media-tabs-wrapper box_relative border-blue5 roundme_sm bg_blue6 common-box-shadow">
<div class="media-tab-container display-grid align-items-center gap-sm bg_blue3">
    <h4 class="common-box-shadow text-shadow-black-40 text_white">{{ tabName }}</h4>
    <!-- <button id="news-tab" @click="selectTab" class="media-tab ss_smtab ss_marginright roundme_sm" :class="(showNewsTab ? 'selected' : '')"><i class="fas fa-bullhorn"></i></button>
    <button id="twitch-tab" @click="selectTab" class="media-tab ss_smtab ss_marginright roundme_sm" :class="(showTwitchTab ? 'selected' : '')"><i class="fab fa-twitch"></i></button>
    <button id="video-tab" @click="selectTab" v-if="youtubeStreams.length > 0" class="media-tab ss_smtab roundme_sm" :class="(showVideoTab ? 'selected' : '')"><i class="fab fa-youtube"></i></button> -->
    <button v-for="(tab, idx) in mediaTabs" :key="idx" :id="tab.id" @click="onTabClicked(tab.id)" class="media-tab ss_smtab roundme_sm" :class="(currentTab === tab.id ? 'selected' : '')"><i :class="tab.icon"></i></button>
</div>
<div class="media-tabs-content f_col" :class="(currentTab === 'news-tab' ? 'tab-news-active' : '')">
    <div class="tab-content ss_paddingright ss_paddingleft">
        <div class="news-container f_row ss_margintop">
            <newsfeed-panel v-show="currentTab === 'news-tab'" id="news_scroll" class="media-tab-scroll" ref="newsScroll" :items="newsItems	"></newsfeed-panel>
            <streamer-panel v-show="currentTab === 'twitch-tab'" id="twitch_panel" :loc="loc" :streams="twitchStreams" :title="loc.twitch_title" :viewers="loc.twitch_viewers" icon="ico_twitch"></streamer-panel>
            <section v-show="currentTab === 'video-tab'" id="yTube-scroll" class="media-tab-scroll v_scroll">
                <article v-for="item in youtubeStreams" :key="item.id" v-if="item.active" @click="onVideoClick(item)" class="media-item ytube-item clickme">
                    <div class="image-wrap news_img roundme_sm">
                        <img :src="imgSrc(item.externalImg)" alt="" class="news_img" />
                    </div>
                    <div class="content-wrap f_col f_space_between">
                        <p>{{ item.title }}</p>
                        <p v-if="item.desc">{{ item.desc }}</p>
                        <p class="text-right">{{ item.author }}</p>
                    </div>
                </article>
            </section>
        </div>
    </div>
    <!-- #news-tab -->
</div>
<!-- .media-tabs-content -->
</div>
<!-- .media-tabs-container -->
</script>

<script id="streamer-panel-template" type="text/x-template">
<div class="panel_streamer noscroll">
    <!-- <div v-if="show" id="stream_mask"></div> -->
    <div id="stream_scroll" class="media-tab-scroll v_scroll" v-show="show">
        <div class="media-item stream_item clickme" v-for="s in streams">
            <a :href="s.link" target="_blank" @click="BAWK.play('ui_click')" class="display-grid grid-column-1-2">
                <img :src="s.image" class="stream_img roundme_sm">
                <span>
                    <p class="stream_name">{{ s.name }}</p>
                    <p class="stream_viewers">{{ s.viewers }} {{ viewers }}</p>
                </span>
            </a>
        </div>
    </div>
    <div class="no-stream roundme_sm" v-if="!show">
     <p v-html="loc.twitch_no_steam"></p>
    </div>
</div>
</script>

<script>
var comp_streamer_panel = {
template: '#streamer-panel-template',
props: ['streams', 'title', 'viewers', 'icon', 'loc'],
methods: {
    playSound (sound) {
        BAWK.play(sound);
    }
},
computed: {
    show: function() {
        if (!this.streams) {
            return false;
        }

        return this.streams.length > 0;
    }
}
};
</script>
<script>
const MEDIATABS = {
    template: '#media-tabs-template',
    components: {
        'newsfeed-panel': comp_newsfeed_panel,
        'streamer-panel': comp_streamer_panel,
    },
    props: ['loc', 'newsfeedItems', 'twitchStreams', 'youtubeStreams'],

    created() {
        this.$nextTick(() => {
            this.randomTabSelect();
        });
    },

    mounted() {
        this.autoRotateTabs();
    },

    data: function () {
        return {
            mediaTabs: [
                {
                    id: 'news-tab',
                    name: 'News',
                    icon: 'fas fa-bullhorn'
                },
                {
                    id: 'twitch-tab',
                    name: 'Twitch',
                    icon: 'fab fa-twitch'
                },
                {
                    id: 'video-tab',
                    name: 'YouTube',
                    icon: 'fab fa-youtube'
                }
            ],
            delay: 7000,
            rotateTimeout: '',
            currentTab: 'news-tab',
        }
    },
    
    methods: {
        selectTab: function (id, playSound) {
            this.currentTab = id;
        },
        cancelRotate() {
            clearTimeout(this.rotateTimeout);
            this.autoRotateTabs();
        },
        rotateTab() {
            let currentIdx = this.mediaTabs.findIndex(tab => tab.id === this.currentTab);
                if (currentIdx + 1 > this.mediaTabs.length - 1) {
                this.selectTab(this.mediaTabs[__uv.$wrap((0))].id);
            } else {
                this.selectTab(this.mediaTabs[__uv.$wrap((currentIdx + 1))].id);
            }
            // start the countdown again
            this.autoRotateTabs();
        },
        autoRotateTabs() {
            this.rotateTimeout = setTimeout(() => this.rotateTab(), this.delay);
        },
        onTabClicked(id) {
            this.selectTab(id);
            //click cancels the rotation and restarts it
            this.cancelRotate();
            ga('send', 'event', 'media-tabs', 'click', id);
            BAWK.play('ui_toggletab');
        },
        randomTabSelect() {
            this.selectTab(this.mediaTabs[__uv.$wrap((Math.floor(Math.random() * this.mediaTabs.length)))].id);
        },
        onVideoClick(item) {
            ga('send', 'creator', 'videoClick', item.title);
            window.open(item.link, '_window');
        },
        imgSrc(img) {
            if (img.includes('hqdefault')) {
                return img.replace('hqdefault', 'mqdefault');
            }
            return img;
        }
    },
    computed: {
        tabName() {
            switch (this.currentTab) {
                case 'news-tab':
                    return this.loc.home_latestnews;
                    break;
                case 'twitch-tab':
                    return 'Twitch'
                    break;
                case 'video-tab':
                    return 'YouTube'
                    break;
                default:
                    break;
            }
        },

        newsItems() {
            // crazyGamesActive = true;
            if (crazyGamesActive) {
                const newNews = this.newsfeedItems.filter((item, idx) => {
                    if (item.hideOnCrazyGames !== null && item.hideOnCrazyGames) {
                        return false;
                    } else {
                        return true;
                    }
                });

                return newNews;
            }
            return this.newsfeedItems;
        },
    }
};
</script><template id="music-widget">
<div v-if="isMusic" class="music-widget roundme_md" :class="[!show ? hideClass : '']">
    <div v-if="theAudio" class="music-widget--wrapper flex flex-nowrap">
        <figure class="music-widget--content">
            <header class=" roundme_md">
                <h3 class="music-widget--now-playing">{{ loc.musicwidget_now_playing }}</h3>
            </header>

            <figcaption class="music-widget--content-wrapper">
                <h4 class="music-widget--album-title">{{ serverTracks.artist }}</h4>
            </figcaption>
            <figcaption class="music-widget--content-wrapper">
                <p v-if="serverTracks.url" class="music-widget--song-title"><a @click="gaSendEvent('click-track', getTitleAlbum)" :href="serverTracks.url" :title="theTitleAttr" target="_blank">{{ getTitleAlbum }}</a></p>
                <p v-else="" class="music-widget--song-title">{{ getTitleAlbum }}</p>
            </figcaption>
            <div v-if="volumeSlider" v-for="t in settingsUi.adjusters.music" class="music-widget--volume-control nowrap">
                <slider-component :loc="loc" :loc-key="t.locKey" :control-id="t.id" :control-value="t.value" :min="t.min" :max="t.max" :step="t.step" :multiplier="t.multiplier" @setting-adjusted="volumeControl"></slider-component>
            </div>
        </figure>
        <div class="music-widget--cover-image music-widget--cover-controls roundme_md">
            <template v-if="serverTracks.url">
                <a v-if="serverTracks.albumArt" @click="gaSendEvent('click-albumArt', getTitleAlbum)" :href="serverTracks.url" :title="theTitleAttr" class="ss-absolute" target="_blank"><img :src="serverTracks.albumArt" class="roundme_md ss-absolute" :alt="serverTracks.album"></a>
            </template>
            <template v-else="">
                <img v-if="serverTracks.albumArt" :src="serverTracks.albumArt" class="ss-absolute roundme_md" alt="Album cover art for" :alt="serverTracks.album">
            </template>
            <button v-if="playBtn" @click="playAudio">
                <i v-if="playing" class="music-widget--cover-control-icon music-widget--cover-control-pause far fa-pause-circle fa-2x"></i>
                <i v-if="!playing" class="music-widget--cover-control-icon music-widget--cover-control-pause far fa-play-circle fa-2x"></i>
            </button>
        </div>
        <div class="music-widget--sponsor">
            <a @click="gaSendEvent('click-sponsor', sponsor.name)" v-if="sponsor" :href="sponsor.link" :title="getSponsorTitleAttr" target="_blank"><img :src="getSponsorImg" class="music-widget--sponsor-icon" :alt="sponsor.name"><span class="hideme">{{sponsor.name}}</span></a>
            <button v-if="settings" @click="openSettings" class="music-widget--sponsor--settings-btn"><i class="fas fa-cog"></i><span class="hideme">Music Settings</span></button>
            <button class="music-widget--sponsor--settings-btn" @click="toggleMusic"><i class="fas" aria-hidden="true" :class="togglePlayStopIcon"></i><span class="hideme">Music</span></button>
        </div>
    </div>
</div>
</template>


<script>

const createMusicWidget = templateId => {

    return {
        template: '#music-widget',
        props: ['loc','volumeSlider', 'playBtn', 'settings', 'settingsUi', 'show'],
        components: {
            'slider-component': comp_settings_adjuster
        },

        data () {
            return vueData.music;
        },

        mounted () {
            this.theAudio = document.getElementById('theAudio');
        },

        methods: {

            loadVolume() {
                this.$nextTick(() => {
                    this.theAudio.volume = Number(this.settingsUi.adjusters.music[__uv.$wrap((0))].value);
                });
            },
            getAudioServer() {
                if (parsedUrl.dom == 'localhost' || parsedUrl.dom == 'dev' || parsedUrl.dom == 'localshelldev') {
                    var url = 'uswest2-music.shellshock.io';
                }
                else {
                    var server = vueApp.regionList.filter(server => region.locKey === vueApp.currentRegionLocKey)[__uv.$wrap((0))];
                    var url = server.subdom.slice(0, -1) + '-music.' + parsedUrl.dom + '.' + parsedUrl.__uv$setSource(__uv).__uv$top;
                }

                this.musicSrc = 'https://' + url + '/shellshock.ogg';
            },
            setIndex(k) {
                this.$nextTick(() => {
                    this.play();
                })
                this.currIndex = k;
            },

            play() {
                if (!this.isMusic) return;
                this.getAudioServer();
            },

            playMusic() {
                // var audio = this.theAudio;
                this.theAudio.src = this.musicSrc;

                console.log('Play Music');

                clearInterval(this.timer);

                this.theAudio.play()
                    .then( // Returns a Promise
                        () => { // Success
                            this.playing = true;
                            this.loadVolume();
                            this.duration = this.theAudio.duration;
                            this.theAudio.addEventListener('stalled', () => this.isMusic = false);
                            
                        },
                        () => { // Fail
                            // What to do... just try again after a few seconds, I guess?
                            setTimeout(() => this.play(), 2000);
                        }
                    );
            },

            pause() {
                this.playing = false;
                this.theAudio.pause();
                clearInterval(this.timer);
            },
            /*
            next() {
                if (this.currIndex < this.tracks.length - 1) {
                    this.currIndex++;
                } else {
                    this.currIndex = 0;
                }
            },

            prev() {
                if (this.currIndex > 0) {
                    this.currIndex--;
                } else {
                    this.currIndex = this.tracks.length - 1;
                }
            },
            */
            playOnce() {
                if (this.playing) return;
                return this.play();
            },

            playAudio() {
                if (this.theAudio.paused) {
                    this.play();
                } else {
                    this.pause();
                }
            },

            openSettings() {
                vueApp.showSettingsPopup();
                vueApp.onSettingsPopupSwitchTabMisc();
                this.gaSendEvent('click', 'widgetOpenSettings');
            },

            volumeControl(id, value) {
                extern.setMusicVolume(value);
                vueApp.onSettingsQuickSave();
            },

            hideMe() {
                return this.$refs.id.classList.addClass('fade-out-3');
            },
            showMe() {
                this.show = true;
                setTimeout(() => this.show = false, 2000);
            },
            gaSendEvent(action, label) {
                action = action || '';
                label = label || '';
                return ga('send', 'event', 'music', action, label);
            },
            toggleMusic() {
                if (this.playing) {
                    this.theAudio.removeEventListener('stalled', () => this.isMusic = false);
                    this.playing = false;
                    this.pause();
                    this.musicSrc = '';
                    this.theAudio.removeAttribute('src');
                    extern.setMusicStatus(false);
                    this.gaSendEvent('toggleMusic', 'off');
                    return;
                }
                this.theAudio.src = '';
                this.play();
                extern.setMusicStatus(true);
                this.gaSendEvent('toggleMusic', 'on');
            },
            changeVolume(val) {
                this.theAudio.volume = val;
            }
        },

        watch: {
            'currIndex': {
                handler() {
                    this.$nextTick(() => {
                        this.play();
                    })
                }
            },
            serverTracks(val) {
                let sponsor = this.sponsors.filter(sponsor => sponsor.id === val.sponsor);
                this.sponsor = sponsor.length || sponsor.length > 0 ? sponsor[__uv.$wrap((0))] : '';
            },
            musicSrc(val) {
                if (val) {
                    this.playMusic();
                }
            },
        },
        computed: {
            theTitleAttr() {
                return 'Read more about ' + this.serverTracks.title;
            },
            getTitleAlbum() {
                return this.serverTracks.title + ' - ' + this.serverTracks.album;
            },
            getSponsorImg() {
                if (!this.sponsor) {
                    return;
                }
                return 'data/img/sponsor/' + this.sponsor.id + this.sponsor.imageExt;
            },
            getSponsorTitleAttr() {
                return 'See more about our sponsor ' + this.sponsor.name;
            },
            togglePlayStopIcon() {
                return this.playing ? 'fa-stop-circle' : 'fa-play-circle';
            },
        },
    };
};
// Register component globally
Vue.component('music-widget', createMusicWidget('#music-widget'));
</script><script id="main-sidebar-template" type="text/x-template">
<div id="screens-menu" v-if="isGamePaused" class="screens-menu box_relative">
    <!-- logo -->
    <div id="logo" class="box_relative">
        <a href="https://www.shellshock.io" @click="onLogoClick"><img class="home-screen-logo" src="img/logo.svg" @click="onLogoClick"></a>
        <!-- <img v-if="eggOrg" class="egg-org-logo" src="img/egg-org/logo_EggOrg.svg"> -->
        <button v-if="inGame && currentScreen !== screens.game" class="ss_button btn_md btn_green bevel_green box_relative box_absolute screens-menu-btn-return f_row align-items-center gap-sm justify-content-center text-uppercase" @click="onBackClick">{{ loc.p_pause_game_on }} <icon class="fill-white shadow-filter" name="ico-backToGame"></icon></button>
    </div>
    <div class="box_relative">
        <player-name v-if="currentScreen === screens.home" :loc="loc" :player-name="playerName" :picked-game-type="pickedGameType" :current-screen="currentScreen" :screens="screens"></player-name>
        <!-- main-menu -->
        <div id="main-menu" class="main-menu box_relative" :class="{'is-home-screen' : currentScreen === screens.home}">
            <menu class="nospace">
                <ul class="nospace text-left list-no-style display-grid gap-sm">
                    <menu-item v-for="(item, idx) in menuItems" :loc="loc" :key="idx" :item="item" :current-screen="currentScreen" :screens="screens" :mode="mode" :currentMode="currentMode" :is-paused="inGame" @previous-screen="previousScreen"></menu-item>
                </ul>
            </menu>
        </div>
    </div>
</div>
<!-- main-sidebar -->
</script>

<script id="main-menu-item" type="text/x-template">
    <li :class="listCls"><button class="fullwidth main-menu-button text-left font-sigmar roundme_sm text-uppercase box_relative f_row align-items-center" @click="onMenuItemClick" :class="itemCls">
        <svg class="centered" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 356.331 71"><path d="M293.124 71H4V9h340.08c11.045 0 16.429 13.48 8.42 21.084L321.213 59.79A40.795 40.795 0 0 1 293.123 71Z" style="fill-rule:evenodd;fill:#1192bc;opacity:.5"/><path class="main-nav-item-bg" d="M289.124 64H2V2h338.08c11.045 0 16.429 13.48 8.42 21.084L317.213 52.79A40.795 40.795 0 0 1 289.123 64Z" style="stroke-miterlimit:10;stroke-width:4px;fill-rule:evenodd"/></svg>
        <icon :name="getIcon" class="menu-icon"></icon>
        {{ loc[locKey] }}
    </button></li>
</script>

<script id="chw-bubble-template" type="text/x-template">
<div ref="chw-home-timer" v-show="!isPoki && firebaseId" class="chw-home-timer display-grid grid-column-1-2 align-items-center box_absolute gap-1 " :class="chwHomeTimerCls">
    <div>
        <img class="chw-home-timer-chick" :src="chwChickSrc">
    </div>
    <div class="display-grid align-items-center bg_white chw-circular-timer-container box_relative" :class="chwClass">
        <div v-show="chwShowTimer" class="chw-home-screen-timer"></div>
        <!-- #chw-circular-timer-outer -->
        <div>
            <p class="chw-circular-timer-countdown nospace">
                <span class="chw-pie-remaining text-center chw-msg chw-r-msg">{{ remainingMsg }}</span>
                <span v-show="chwShowTimer" class="chw-pie-num chw-pie-hours"></span><span v-show="chwShowTimer" class="chw-pie-num chw-pie-mins"></span><span v-show="chwShowTimer" class="chw-pie-num chw-pie-secs"></span>
            </p>
            <button v-if="ready && !hasChwPlayClicked && !error" class="ss_button btn_sm btn_yolk bevel_yolk" @click="playIncentivizedAd">{{ playAdText }}</button>
        </div>
    </div>
</div>
<!-- .chw-home-timer -->
</script>

<script>
var COMPCHWBUBBLE = {
template: '#chw-bubble-template',
components: {
},

props: ['loc', 'isPoki', 'firebaseId', 'limitReached', 'ready', 'error', 'counter', 'hasChwPlayClicked'],
data: function() {
    return {
    }
},		
methods: {
    showNuggyPopup() {
        vueApp.showChicknWinnerPopup();
    },
    playIncentivizedAd(e) {
        if (this.showAdBlockerVideoAd) {
            return;
        }
        if (!this.ready || this.hasChwPlayClicked) {
            e.preventDefault();
            return;
        }
        ga('send', 'event', 'Chickn Winner', 'Free eggs btn', 'click-home');

        this.hasChwPlayClicked = true;
        vueApp.loadNuggetVideo();
        vueApp.chicknWinnerNotReady();
    },
    // needs emit
    chwShowCycle() {
        this.chwHomeEl = document.querySelector('.chw-home-timer');
        if (this.chwHomeEl) {
        this.chwHomeTimer = setInterval(() => {
            this.chwHomeEl.classList.toggle('active');
            }, this.chwActiveTimer);
        }
    },
},
computed: {
    playAdText() {
        if (this.ready && this.counter === 0) {
            return this.loc.chw_btn_free_reward;
        } else {
            return this.loc.chw_btn_free_reward;
        }
    },
    chwClass() {
        if (this.limitReached || this.error) {
            return 'grid-column-1-eq';
        } else {
            if (this.ready) {
                return 'grid-column-1-eq';
            } else {
                return 'grid-column-1-2';
            }
        }
    },
    chwHomeTimerCls() {
        //{'chw-home-screen-max-watched': limitReached}
        if (this.limitReached) {
            return 'chw-home-screen-max-watched';
        } else {
            if (this.ready) {
                return 'is-ready active';
            } else {
                return 'not-ready';
            }
        }
    },
    chwChickSrc() {
        if (this.limitReached || this.error) {
            return 'img/chicken-nugget/chickLoop_daily_limit.svg';
        } else {
            if (!this.ready) {
                return 'img/chicken-nugget/chickLoop_sleep.svg';
            } else {
                return 'img/chicken-nugget/chickLoop_speak.svg';
            }
        }
    },
    chwShowTimer() {
        if (this.limitReached) {
            // this.chwStopCycle();
            return false;
        } else {
            if (this.ready) {
                this.chwShowCycle();
                return false;
            } else {
                // this.chwStopCycle();
                return true;
            }
        }
    },
    remainingMsg() {
        if (this.error) {
            return this.loc.chw_error_text;
        }
        if (this.limitReached && this.counter > 0) {
            return this.loc.chw_daily_limit_msg;
        }
        if (this.ready) {
            if (this.counter === 0) {
                return this.loc.chw_ready_msg;
            } else {
                return this.loc.chw_cooldown_msg;
            }
        } else {
            return this.loc.chw_time_until;
        }
    },
    progressBarWrapClass() {
        if (this.ready) {
            return 'chw-progress-bar-wrap-complete';
        }
    },
},
watch: {
}
};
</script>
<script>
const MainMenuItem = {
template: '#main-menu-item',
props: ['loc', 'item', 'currentScreen', 'screens', 'mode', 'currentMode', 'isPaused'],
data: function() {
    return {
        inGame: false
    }
},
methods: {
    onMenuItemClick() {
        if (this.item.screen === this.currentScreen && !this.item.mode) {
            return;
        }
        this.$emit('previous-screen', this.currentScreen);
        switch (this.item.screen) {
            case this.screens.home:
                if (!extern.inGame) {
                    vueApp.switchToHomeUi();
                    if (this.currentScreen === this.screens.equip) {
                        vueApp.onBackClick();
                    }
                } else {
                    vueApp.onHomeClicked();
                    vueApp.showRespawnDisplayAd();
                    ga('send', 'event','respawn-popup', 'click', 'quit');
                }
                break;
            case this.screens.equip:

                // this should only show once a day
                vueApp.showChickenPopup();

                if (this.item.mode.includes(this.mode.inventory)) {
                    ga('send', 'event', extern.inGame ? 'respawn-popup' : 'home', 'click', 'inventory');
                    vueApp.openEquipSwitchTo(this.mode.inventory);
                } else {
                    ga('send', 'event', extern.inGame ? 'respawn-popup' : 'home', 'click', 'shop');
                    vueApp.openEquipSwitchTo(this.mode.shop);
                }
                if (extern.inGame) {
                    setTimeout(() => {
                        extern.resize();
                    }, 200);
                }
                break;
            case this.screens.profile:
                if (this.currentScreen === this.screens.equip) {
                    vueApp.onBackClick();
                }
                ga('send', 'event', extern.inGame ? 'respawn-popup' : 'home', 'click', 'profile');
                vueApp.switchToProfileUi();
                break;
            case this.screens.photoBooth: 
                vueApp.switchToPhotoBoothUi();
                break;
            default:
                break;
        }
    },
    // showOn(item) {
    // 	if (item.locKey === 'account_title_home' && extern.inGame) {
    // 		return false;
    // 	} else {
    // 		return item.showOn.alwasyOn || (!item.showOn.alwasyOn && item.showOn.screen === this.currentScreen);
    // 	}
    // }
},
computed: {
    locKey() {
        if ((this.isPaused) && this.item.locKey === 'account_title_home') {
            return 'p_pause_quit';
        } else {
            return this.item.locKey;
        }
    },
    iconCls() {
        return `${this.item.icon}`;
    },
    listCls() {
        return `${this.loc[__uv.$wrap((this.item.locKey))].toLowerCase().replace(/\s/g, '') + '-menu-item'}`
    },
    getIcon() {
        return `${this.item.icon}`;
    },
    itemCls() {
        if (this.item.mode.length === 0) {
            if (this.item.screen === this.currentScreen) {
                return 'current-screen';
            }
        } else if (this.item.mode.includes(this.currentMode) && this.item.screen === this.currentScreen) {
            return 'current-screen';
        }
    },
},

watch: {
    currentScreen() {
        this.inGame = extern.inGame;
    }
}
};
</script><script id="player-name-input" type="text/x-template">
<input id="player-name" name="name" :value="playerName" v-bind:placeholder="loc.play_enter_name" @change="onNameChange($event)" v-on:keyup="onPlayerNameKeyUp($event)" :class="cls">
</script>

<script>
const PlayerNameInput = {
template: '#player-name-input',
props: ['loc', 'playerName', 'pickedGameType', 'currentScreen', 'screens'],
data: function() {
    return {

    }
},
methods: {
    onNameChange (event) {
        console.log('name changed to: ' + event.target.value);
        console.log('play name event handler');
        vueApp.setPlayerName(event.target.value);
        BAWK.play('ui_onchange');
    },
    onPlayerNameKeyUp (event) {
        event.target.value = extern.filterUnicode(event.target.value);
        event.target.value = extern.fixStringWidth(event.target.value);
        event.target.value = event.target.value.substring(0, 128);

        // Send username to server to start the game!
        if (event.code == "Enter" || event.keyCode == 13) {
            if (vueData.playerName.length > 0) {
                if (vueData.playerName.length > 0) {
                    vueApp.externPlayObject(vueData.playTypes.joinPublic, this.pickedGameType, this.playerName, -1, '');
                }
            }
        }
    },
},
computed: {
    cls() {
        return this.currentScreen === this.screens.profile ? 'font-sigmar text-shadow-black-40 text_white box_relative profile-name' : 'box_absolute ss_field font-nunito ss_name';
    }
}

};
</script>
<script>
var COMPMAINSIDE = {
template: '#main-sidebar-template',
components: {
    // 'house-ad': CompHouseAd,
    'menu-item': MainMenuItem,
    'player-name': PlayerNameInput
},

props: ['loc', 'playerName', 'menuItems', 'currentScreen', 'screens', 'mode', 'currentMode', 'inGame', 'isGamePaused', 'pickedGameType'],
data: function() {
    return {
        itemSelected: 0,
    }
},		
methods: {
    onLogoClick(e) {
        if (extern.inGame) {
            e.preventDefault();
            return;
        }
        BAWK.play('ui_click')
    },
    onBackClick() {
        if (this.currentScreen === this.screens.equip) {
            vueApp.onBackClick();
        }
        setTimeout(() => {
            extern.resize();
        }, 1);
        vueApp.switchToGameUi();
        vueApp.showGameMenu();
        vueApp.showRespawnDisplayAd();
    },
    previousScreen(screen) {
        this.$emit('previous-screen', screen);
    }
}
};
</script><script id="social-panel-template" type="text/x-template">
<div ref="socialMediaIcons" class="social_icons roundme_sm f_row justify-content-end gap-sm ss_marginright">
    <!-- <a :href="newsLetterUrl" target="_blank" @click="playSound('newYolker')">
        <div class="icon-wrap bg_blue3 roundme_sm">
            <span class="sr-only">Get the Shell Shocker's Newsletter: The New Yolker</span>
            <i aria-hidden="true" class="text_blue1 fas fa-envelope-open-text"></i>
        </div>
    </a> -->
    <!-- ['name', 'reward', 'url', 'img', 'icon'] -->
    <social-promo ref="socialIcons" v-for="(item, idx) in socialItems" :key="idx" :name="item.name" :reward="item.reward" :url="item.url" :img="item.imgPath" :icon="item.icon" :is-active="item.active" :loc="loc" :is-poki="isPoki" :use-social="socialMedia" :id="item.id"></social-promo>
    <!-- <social-promo ref="socialIcons" :name="showSocialMedia.name" :reward="showSocialMedia.reward" :url="showSocialMedia.url" :img="showSocialMedia.imgPath" :icon="showSocialMedia.icon" :is-active="showSocialMedia.active" :loc="loc" :is-poki="isPoki" :use-social="showSocialMedia.reward" :overlap="adOverlap"></social-promo> -->

</div>
</script>
<script id="social-promo-template" type="text/x-template">
<div class="social-media" :class="cls">
    <div v-if="isActive" class="tool-tip" :class="{'active' : isBubbleActive}">
        <a :href="url" target="_blank" :title="urlTitle" class="bg_blue4"  @click="onClickReward()">
            <div class="icon-wrap bg_blue3 roundme_sm text-center">
                <span class="sr-only">Vist Shell Shocker's {{ name }} page</span>
                <i aria-hidden="true" class="text_blue1" :class="useIcon"></i>
            </div>
        </a>
        <div class="tool-tip--bubble" v-show="bubbleHover">
            <div class="tool-tip--group display-grid grid-column-1-2">
                <div class="tool-tip--image box_relative">
                    <img v-if="img" class="discord-bubble-img box_absolute" :src="imgSrc" :alt="imgAlt">
                </div>
                <div class="tool-tip--text text-left">
                    <section v-html="socialDesc"></section>
                </div>
            </div>
            <!-- .tool-tip--group -->
        </div>
            <!-- .tool-tip--bubble -->
    </div>
    <!-- .tool-tip -->
    <a v-if="!isActive" :href="url" target="_blank" class="bg_blue4" @click="onClickReward()">
        <div class="icon-wrap bg_blue3 roundme_sm text-center">
            <span class="sr-only">Vist Shell Shocker's {{ name }} page</span>
            <i aria-hidden="true" class="text_blue1 fab" :class="useIcon"></i>
        </div>
    </a>
</div>
</script>


<script>
var COMPSOCIALPROMO = {
template: '#social-promo-template',
props: ['name', 'reward', 'url', 'img', 'icon', 'loc', 'isPoki', 'useSocial', 'id'],
data: function () {
    return {
        isBubbleActive: false,
        bubbleRepeat : '',
        bubbleHover: true,
        isActive: false,
        isItemOwned: false,
        inventoryCheck: 0
    }
},
mounted() {
    this.discordBubbleTimer();
},
methods: {
    playSound (label) {
        BAWK.play('ui_click');
    },
    discordBubbleTimer() {
        if (this.reward === this.useSocial) {
            if (extern.isGameReady) {
                this.inventoryCheck = 0;
                setTimeout(() => {
                    this.isItemOwned = extern.isItemOwned({id: this.id});
                    if (!this.isItemOwned) {
                        this.isActive = true;
                        this.bubbleRepeat = setInterval(() => {
                           this.isBubbleActive = this.isBubbleActive ? false : true;
                           }, 3000);
                    }
                }, 1000);
            } else {
                this.inventoryCheck++;
                if (this.inventoryCheck < 6 && !this.isActive) {
                    setTimeout(() => this.discordBubbleTimer(), 2000);
                }
            }
        }
    },

    onClickReward() {
        if (!this.reward) return;
        this.gaSend(this.reward);

        if (!this.isItemOwned && this.reward) {
            extern.socialReward(this.reward);
        }
        this.playSound();
        this.isBubbleActive = false;
        this.bubbleHover = false;

        if (this.bubbleRepeat) {
            clearInterval(this.bubbleRepeat);
        }
    },
    gaSend(label) {
        if (!label) return;
        ga('send', 'event', 'social-buttons', 'click', label);
    }
},
computed: {
    itemRedeemed() {
        return localStore.getItem(this.reward + 'Rewarded');
    },
    urlTitle() {
        return `Blue Wizard ${this.name} page`;
    },
    imgAlt() {
        return `Join Blue Wizard's ${this.name} page`;
    },
    imgSrc() {
        return `img/social-media/${this.img}`;
    },
    socialDesc() {
        return this.loc[__uv.$wrap(('footer_social_media_' + this.name.toLowerCase()))];
    },
    cls() {
        return this.useSocial === this.reward ? `active-social-${this.useSocial.toLowerCase()}` : '';
    },
    useIcon() {
        if (this.name == 'newYolker') {
            return `fas ${this.icon}`;
        } else {
            return `fab ${this.icon}`;
        }
    },
},
watch: {
    // useSocial(val) {
    // 	if (!val) {
    // 		return;
    // 	}
    // 	this.isActive = this.reward === val;
    // }
}
};
</script><script>
var comp_social_panel = {
template: '#social-panel-template',
components: {
    'social-promo': COMPSOCIALPROMO
},
props: ['loc', 'isPoki', 'socialMedia', 'useSocial'],
data: function () {
    return {
        // adOverlap: false,
        newsLetterUrl: 'https://bluewizard.com/subscribe-to-the-new-yolker/',
    }
},
computed: {
    // showSocialMedia() {
    // 	return this.useSocial[Math.floor(Math.random()*this.useSocial.length)];
    // },
    socialItems() {
        const idx = this.useSocial.findIndex(el => el.reward === this.socialMedia);
        if (idx >= 0) {
            const social = this.useSocial[__uv.$wrap((idx))]
            this.useSocial.splice(idx, 1);
            this.useSocial.push(social);
        }
        return this.useSocial;
    }
}
};
</script><script id="profile-screen-template" type="text/x-template">
<div id="mainLayout" class="profile-content-wrap">
    <section class="profile-page-content roundme_sm ss_marginright bg_blue6 common-box-shadow">
        <section class="display-grid grid-column-2-eq paddings_xl bg_blue3">
            <header class="f_row align-items-center">
                <section>
                    <h1 class="text-shadow-black-40 text_white nospace">{{ playerName }}</h1>
                    <!-- <player-name :loc="loc" :player-name="playerName" :picked-game-type="currentGameType" :current-screen="showScreen" :screens="screens"></player-name> -->
                    <button v-if="showTwitchEvent" class="ss_button btn-twitch bevel_twitch justify-content-center btn_sm box_relative f_row gap-sm align-items-center" @click="onTwitchDropsClick"><i aria-hidden="true" class="fab fa-twitch"></i> {{ isTwitchLinked }}</button>
                </section>
            </header>
            <aside class="justify-self-end text-right">
                <p class="account-create-date nospace text_white opacity-7" v-html="accountStatus"></p>
                <button id="account-button" @click="onAccountBtnClicked" class="ss_button btn_md font-800" :class="accountBtnCls">{{ accountBtnTxt }}</button>
            </aside>
        </section>
        <section class="profile-stat-wrap center_h paddings_xl box_relative">
            <div v-if="ui.game.stats.loading" class="stats-loading box_absolute">
                <strong><span class="text_blue5 font-size-md text-uppercase">Stats loading... <i class="fas fa-spinner fa-spin"></i></span></strong>
            </div>
            <stats-content :loc="loc" :stats-monthly="statsCurrent" :stats-lifetime="statsLifetime" :kdr="kdr" :kdrLifetime="kdrLifetime" :showLifetime="ui.profile.statTab" :eggs-spent="eggsSpent" :eggs-spent-monthly="eggsSpentMonthly"></stats-content>
        </section>
    </section>
    <small-popup id="loginPopupWarning" ref="loginPopupWarning" @popup-confirm="onQuitAndLoginManage">
        <template slot="header">{{ loc.feedback_account_deletion_title }}</template>
        <template slot="content">
            <div>{{ loginPopupWarningTxt }}</div>
        </template>
        <template slot="cancel">{{ loc.no }}</template>
        <template slot="confirm">{{ loc.yes }}</template>
    </small-popup>
</div>
<!-- .main-content -->
</script>

<script id="stats-stats-template" type="text/x-template">
<div class="stats-box">
    <header class="display-grid stats-grid-other stat-grid-main-header stat-wrapper ss_paddingright_lg ss_paddingleft_xl">
        <div><h3 class="text-shadow-black-40 text_white nospace">Stats</h3></div>
        <div class="text-center"><h3 class="text-shadow-black-40 text_white nospace">{{ loc.stat_lifetime }}</h3></div>
        <div class="text-center"><h3 class="text-shadow-black-40 text_white nospace">{{ loc.stat_monthly }}</h3></div>
    </header>
    <div class="stats-container box_relative center_h ss_margintop_sm">
        <div class="bg_blue2 roundme_lg ss_marginright_sm">
            <div class="stat-wrapper paddings_lg">
                <section v-if="renderReady" class="stat-columns">
                    <stat-item :loc="loc" :stat="{'name': 'kills', 'lifetime': statsLifetime.kills.total, 'current': statsMonthly.kills.total }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'deaths', 'lifetime': statsLifetime.deaths.total, 'current': statsMonthly.deaths.total }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'streak', 'lifetime': statsLifetime.streak, 'current': statsMonthly.streak }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'kdr', kdr: true, 'lifetime': [statsLifetime.kills.total, statsLifetime.deaths.total], 'current': [statsMonthly.kills.total, statsMonthly.deaths.total] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_kotc_wins', 'lifetime': statsLifetime.gameType.kotc.wins, 'current': statsMonthly.gameType.kotc.wins }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_kotc_captured', 'lifetime': statsLifetime.gameType.kotc.captured, 'current': statsMonthly.gameType.kotc.captured }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_eggs_spent', 'lifetime': eggsSpent, 'current': eggsSpentMonthly }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_public_kdr', kdr: true, 'lifetime': [statsLifetime.kills.mode.public, statsLifetime.deaths.mode.public], 'current': [statsMonthly.kills.mode.public, statsMonthly.deaths.mode.public] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_private_kdr', kdr: true, 'lifetime': [statsLifetime.kills.mode.private, statsLifetime.deaths.mode.private], 'current': [statsMonthly.kills.mode.private, statsMonthly.deaths.mode.private] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_fa_kdr', kdr: true, 'lifetime': [statsLifetime.kills.gameType.ffa, statsLifetime.deaths.gameType.ffa], 'current': [statsMonthly.kills.gameType.ffa, statsMonthly.deaths.gameType.ffa] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_teams_kdr', kdr: true, 'lifetime': [statsLifetime.kills.gameType.team, statsLifetime.deaths.gameType.team], 'current': [statsMonthly.kills.gameType.team, statsMonthly.deaths.gameType.team] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_ctf_kdr', kdr: true, 'lifetime': [statsLifetime.kills.gameType.spatula, statsLifetime.deaths.gameType.spatula], 'current': [statsMonthly.kills.gameType.spatula, statsMonthly.deaths.gameType.spatula] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_kotc_kdr', kdr: true, 'lifetime': [statsLifetime.kills.gameType.kotc, statsLifetime.deaths.gameType.kotc], 'current': [statsMonthly.kills.gameType.kotc, statsMonthly.deaths.gameType.kotc] }"></stat-item>
                </section>
            </div>

            <header class="display-grid stats-grid-other stat-grid-main-header stat-wrapper ss_paddingright_lg ss_paddingleft_xl ss_paddingtop_sm ss_paddingbottom_sm">
                <div><h4 class="nospace">{{ loc.stat_game_mode }}</h4></div>
                <div class="text-center display-grid grid-auto-flow-column" style="margin-left: 0.9em;"><h4 class="nospace">{{ loc.kills }}</h4> <h4 class="nospace">{{ loc.deaths }}</h4></div>
                <div class="text-center display-grid grid-auto-flow-column" style="margin-left: 0.9em;"><h4 class="nospace">{{ loc.kills }}</h4> <h4 class="nospace">{{ loc.deaths }}</h4></div>
            </header>
            <div class="stat-wrapper paddings_lg">
                <section v-if="renderReady" class="stat-columns">
                    <stat-item :loc="loc" :stat="{'name': 'stat_public', 'lifetime': [statsLifetime.kills.mode.public, statsLifetime.deaths.mode.public], 'current': [statsMonthly.kills.mode.public, statsMonthly.deaths.mode.public] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'stat_private', 'lifetime': [statsLifetime.kills.mode.private, statsLifetime.deaths.mode.private], 'current': [statsMonthly.kills.mode.private, statsMonthly.deaths.mode.private] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'gametype_ffa', 'lifetime': [statsLifetime.kills.gameType.ffa, statsLifetime.deaths.gameType.ffa], 'current': [statsMonthly.kills.gameType.ffa, statsMonthly.deaths.gameType.ffa] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'gametype_teams', 'lifetime': [statsLifetime.kills.gameType.team, statsLifetime.deaths.gameType.team], 'current': [statsMonthly.kills.gameType.team, statsMonthly.deaths.gameType.team] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'gametype_ctf', 'lifetime': [statsLifetime.kills.gameType.spatula, statsLifetime.deaths.gameType.spatula], 'current': [statsMonthly.kills.gameType.spatula, statsMonthly.deaths.gameType.spatula] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'gametype_king', 'lifetime': [statsLifetime.kills.gameType.kotc, statsLifetime.deaths.gameType.kotc], 'current': [statsMonthly.kills.gameType.kotc, statsMonthly.deaths.gameType.kotc] }"></stat-item>
                </section>
            </div>

            <header class="display-grid stats-grid-other stat-grid-main-header stat-wrapper ss_paddingright_lg ss_paddingleft_xl ss_paddingtop_sm ss_paddingbottom_sm">
                <div><h4 class="nospace">{{ loc.stat_weapons }}</h4></div>
                <div class="text-center display-grid grid-auto-flow-column" style="margin-left: 0.9em;"><h4 class="nospace">{{ loc.kills }}</h4> <h4 class="nospace">{{ loc.deaths }}</h4></div>
                <div class="text-center display-grid grid-auto-flow-column" style="margin-left: 0.9em;"><h4 class="nospace">{{ loc.kills }}</h4> <h4 class="nospace">{{ loc.deaths }}</h4></div>
            </header>
            <div class="stat-wrapper paddings_lg">
                <section v-if="renderReady" class="stat-columns">
                    <stat-item :loc="loc" :stat="{'name': 'item_type_3_0', 'lifetime': [statsLifetime.kills.dmgType.eggk, statsLifetime.deaths.dmgType.eggk], 'current': [statsMonthly.kills.dmgType.eggk, statsMonthly.deaths.dmgType.eggk] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'item_type_3_1', 'lifetime': [statsLifetime.kills.dmgType.scrambler, statsLifetime.deaths.dmgType.scrambler], 'current': [statsMonthly.kills.dmgType.scrambler, statsMonthly.deaths.dmgType.scrambler] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'item_type_3_2', 'lifetime': [statsLifetime.kills.dmgType.ranger, statsLifetime.deaths.dmgType.ranger], 'current': [statsMonthly.kills.dmgType.ranger, statsMonthly.deaths.dmgType.ranger] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'item_type_3_3', 'lifetime': [statsLifetime.kills.dmgType.rpegg, statsLifetime.deaths.dmgType.rpegg], 'current': [statsMonthly.kills.dmgType.rpegg, statsMonthly.deaths.dmgType.rpegg] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'item_type_3_4', 'lifetime': [statsLifetime.kills.dmgType.whipper, statsLifetime.deaths.dmgType.whipper], 'current': [statsMonthly.kills.dmgType.whipper, statsMonthly.deaths.dmgType.whipper] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'item_type_3_5', 'lifetime': [statsLifetime.kills.dmgType.crackshot, statsLifetime.deaths.dmgType.crackshot], 'current': [statsMonthly.kills.dmgType.crackshot, statsMonthly.deaths.dmgType.crackshot] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'item_type_3_6', 'lifetime': [statsLifetime.kills.dmgType.trihard, statsLifetime.deaths.dmgType.trihard], 'current': [statsMonthly.kills.dmgType.trihard, statsMonthly.deaths.dmgType.trihard] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'weapon_cluck_9mm', 'lifetime': [statsLifetime.kills.dmgType.pistol, statsLifetime.deaths.dmgType.pistol], 'current': [statsMonthly.kills.dmgType.pistol, statsMonthly.deaths.dmgType.pistol] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'item_type_6', 'lifetime': [statsLifetime.kills.dmgType.grenade, statsLifetime.deaths.dmgType.grenade], 'current': [statsMonthly.kills.dmgType.grenade, statsMonthly.deaths.dmgType.grenade] }"></stat-item>
                    <stat-item :loc="loc" :stat="{'name': 'item_type_7', 'lifetime': [statsLifetime.kills.dmgType.melee, statsLifetime.deaths.dmgType.melee], 'current': [statsMonthly.kills.dmgType.melee, statsMonthly.deaths.dmgType.melee] }"></stat-item>
                </section>
            </div>
        </div>
    </div>
</div>
</script>

<script id="the-stat-template" type="text/x-template">
<section class="stat display-grid font-600" :class="statWrapper">
    <div class="text_white roundme_sm_top-bottom_right ss_paddingleft ss_paddingtop_micro ss_marginbottom_sm"><p>{{ statName }}</p></div>
    <div class="text-center text_white roundme_sm_top-bottom_left ss_paddingleft ss_paddingtop_micro ss_marginbottom_sm ss_marginright_sm" :class="lifetimeCls" v-html="statLifetime"></div>
    <div class="text-center text_white roundme_sm ss_paddingleft ss_paddingtop_micro ss_marginbottom_sm" :class="currentCls" v-html="statMonthly"></div>
</section>
</script>

<script>
var StatTemplate = {
template: '#the-stat-template',
props: ['loc', 'stat'],
data: function () {
    return {
        lifetimeCls: '',
        currentCls: '',
    }
},
methods: {
    statName(key) {
        if (key=== 'eggk') {
            key= 'eggK-47';
        }
        return key.toUpperCase();
    },
    kdr(kills, deaths) {
        return Math.floor((kills / Math.max(deaths, 1)) * 100) / 100;
    },
    setupStat(stat) {
        if (this.stat.kdr !== undefined && stat.length !== undefined) {
            return this.kdr(stat[__uv.$wrap((0))], stat[__uv.$wrap((1))]);
        } else if (stat && stat.length !== undefined) {
            return `<div>${stat[__uv.$wrap((0))]}</div> <div>${stat[__uv.$wrap((1))]}</div>`;
        } else {
            return stat;
        }
    }
},
computed: {
    statName() {
        // if (this.stat.name === 'eggk') {
        // 	return 'eggK-47';
        // }
        return this.loc[__uv.$wrap((this.stat.name))];
        // return this.stat.name;
    },
    statMonthly() {
        if (this.stat.current && this.stat.current.length !== undefined && this.stat.kdr === undefined) {
            this.currentCls = 'display-grid grid-column-2-eq';
        }
        return this.setupStat(this.stat.current);
    },
    statLifetime() {
        if (hasValue(this.stat.lifetime) && this.stat.lifetime.length !== undefined && this.stat.kdr === undefined) {
            this.lifetimeCls = 'display-grid grid-column-2-eq';
        }
        return this.setupStat(this.stat.lifetime);
    },
    statWrapper() {
        // return this.stat.lifetime.length !== undefined && this.stat.kdr === undefined ? 'stats-grid-other' : 'stats-grid';
        return 'stats-grid-other';
    },
},
};
</script>
<script>
var STATSPOPUP = {
template: '#stats-stats-template',
props: ['loc', 'statsMonthly', 'statsLifetime', 'kdr', 'kdrLifetime', 'showLifetime', 'eggsSpent', 'eggsSpentMonthly'],
components: {
    'stat-item': StatTemplate
},
methods: {
    statName(key) {
        if (key === 'eggk') {
            key = 'eggK-47';
        }
        return key.toUpperCase();
    },
    kdr(kills, deaths) {
        return Math.floor((kills / Math.max(deaths, 1)) * 100) / 100;
    }
},
computed: {
    // VUE is taking it's time passing these props, so we need to wait for them to be ready
    renderReady() {
        return Object.keys(this.statsLifetime).length > 0 && Object.keys(this.statsMonthly).length > 0;
    }
}
};
</script>
<script>
const ProfileScreen = {
template: '#profile-screen-template',
components: {
    'stats-content': STATSPOPUP,
    // 'player-name': PlayerNameInput
},

props: ['loc'],

data: function () {
    return vueData;
},

methods: {
    showSignIn: function () {
        extern.showSignInDialog();
        vueApp.$refs.firebaseSignInPopup.show();
    },
    onAccountBtnClicked: function () {
        if (this.showAdBlockerVideoAd) {
            return;
        }

        if (extern.inGame) {
            this.$refs.loginPopupWarning.show();
        } else {
            if (this.isAnonymous && this.showSignIn) {
            vueApp.onSignInClicked();
            } else {
                vueApp.onSignOutClicked();
            }
        }
    },

    onQuitAndLoginManage() {
        vueApp.onLeaveGameConfirm();
        setTimeout(() => {
            this.$emit('leave-game-confimed');
        }, 1000);
    },

    onTwitchDropsClick() {
        if (this.showAdBlockerVideoAd) {
            return;
        }

        ga('send', 'event', 'profilePage', 'click', 'twitch_drops');
        window.open(dynamicContentPrefix + 'twitch');
    },
    selectTab(val) {
        if (this.ui.profile.statTab === val) {
            return;
        }
        this.ui.profile.statTabClicked = true;
        setTimeout(() => this.ui.profile.statTabClicked = false, 500);
        BAWK.play('ui_toggletab');
        this.ui.profile.statTab = val;
    }
},
computed: {
    isEggStoreSaleItem() {
        return this.eggStoreItems.some( item => item[__uv.$wrap(('salePrice'))] !== '');
    },
    showTwitchEvent() {
        return this.ui.events.twitch;
    },
    isTwitchLinked() {
        return this.twitchLinked ? this.loc.account_linked_to_twitch : this.loc.account_link_to_twitch;
    },
    accountStatus() {
        if (this.accountCreated) {
            return `${this.loc.account_created}: <strong>${this.accountCreated}</strong>`;	
        }
        return this.loc.account_profile_login_desc;
    },
    accountBtnCls() {
        if (this.isAnonymous && this.showSignIn) {
            return 'btn_green bevel_green';
        }
        return 'btn_yolk bevel_yolk';
        
    },
    accountBtnTxt() {
        if (this.isAnonymous && this.showSignIn) {
            return this.loc.sign_in;
        }
        return this.loc.sign_out;
    },
    loginPopupWarningTxt(){
        return this.isAnonymous && this.showSignIn ? this.loc.sign_in_and_leave_game : this.loc.sign_out_and_leave_game;
    }
}
};
</script><script id="gauge-template" type="text/x-template">
<div id="ss-shell-meter-wrap">
    {{popupOpen}}
    <div id="gauge-meter" class="gauge-meter centered_x" @click="onGaugeMeterClick">
            <div class="hvsm-character-area hvsm-heroes-area-glow box_absolute" :style="heroesStyle">
            </div>
            <div class="hvsm-character-area hvsm-monsters-area-glow box_absolute" :style="monstersStyle">
            </div>
        <!-- <div id="motion-demo"></div> -->
        <div class="ss-shell-meter centered_x">
            <!-- ss-shell-gauge-->
            <div id="ss-shell-gauge" class="gauge">
                <img src="img/gauge-bar/hero-vs-monster-bar.png" class="centered_x">
                <div ref="needle" class="needle">
                    <!-- <div class="needle-head"></div> -->
                    <img src="img/gauge-bar/hero-vs-monster-pointer.svg" class="centered_x">
                </div>
                <!-- .needle -->
            </div>
            <!-- #ss-shell-gauge -->
        </div>
        <!-- .ss-shell-meter -->
    </div>
</div>
</script>

<script>
var CompGauge = {
template: '#gauge-template',
props: ['popupOpen'],
data() {
    return {
        current: 180,
        min: 164,
        max: 196,
        loadvalue: null,
        setValue: 180,
        stop: false,
        started: false,
        rotateAnimation: 'hvsm-animation',
        pauseAnimation: 'hvsm-paused',
        stopCount: 0,
    };
},

methods: {
    setGaugeMeterData(data) {
        this.min = Number(data.min);
        this.max = Number(data.max);
        this.loadvalue = Number(data.loadvalue);
        this.stop = data.active;
        this.setValue = Number(data.setValue);
    },
    startMeter() {
        this.current = this.loadvalue;
        this.$refs.needle.addEventListener('animationend', () => this.restartAnimation());
        this.startAnimation();
    },
    getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
    },
    startAnimation() {
        const NeedleCls = this.$refs.needle.classList,
              Current = this.current,
              End = Math.round(this.getRandomInt(this.min, this.max)),
              StepTime = ((Math.max(End, this.current) - Math.min(End,this.current)) * 1000),
              Timer = Math.min(StepTime, 7000);

        if (NeedleCls.contains(this.pauseAnimation)) this.$refs.needle.classList.remove(this.pauseAnimation);
        if (NeedleCls.contains(this.rotateAnimation)) this.$refs.needle.classList.remove(this.rotateAnimation);

        this.setAnimationTimer(Timer);
        this.setAnimationStart(this.current);

        if (this.stop) {
            this.current = this.setValue
            this.setGaugeValue(this.current);
        } else {
            this.setGaugeValue(End);
            this.current = End;
        }

        this.$refs.needle.classList.add(this.rotateAnimation);
    },
    restartAnimation() {
        this.$refs.needle.classList.remove(this.rotateAnimation);
        if (this.stopCount >= 1) {
            this.stopMeter();
            this.stopCount = 0;
        }
        if (this.stop) {
            this.startAnimation();
            this.stopCount++;
            return;
        }
        setTimeout(() => {
            this.startAnimation();
        }, 3500);
    },
    minMax(val) {
        return val <= this.min || val >= this.max;
    },
    stopMeter() {
        this.$refs.needle.classList.add(this.pauseAnimation);
        this.$refs.needle.removeEventListener('animationend', () => this.restartAnimation());
    },
    opacityChange() {
        if (this.current >= 180) {
            return .1;
        } else {
            return ((180 - this.current) / 180) * 10;
        }
    },
    opacityChangeMonster() {
        if (this.current <= 180) {
            return .1;
        } else {
            return ((180 - this.current) / 180) * -10;
        }
    },
    onGaugeMeterClick() {
        this.$emit('gauge-meter-click');
    },
    setAnimationTimer(val) {
        this.$refs.needle.style.setProperty('--gauge-timer-sec', val/1000+'s');
    },
    setAnimationStart(val) {
        this.$refs.needle.style.setProperty('--gauge-value-start', val+'deg');
    },
    setGaugeValue(val) {
        this.$refs.needle.style.setProperty('--gauge-value', val+'deg');
    },
},
computed: {
    monsters() {
        return this.opacityChangeMonster()
    },
    heroes(){
        return this.opacityChange()
    },
    heroesStyle() {
        return {
            opacity: this.heroes,
        };
    },
    monstersStyle() {
        return {
            opacity: this.monsters,
        };
    },
    isPopupOpen() {
        return this.popupOpen ? 'hvsm-popup-open' : '';
    },
},
watch: {
    loadvalue(val) {
        if (val && !this.started) this.startMeter();
    },
},
};
</script>
<script>
var comp_home_screen = {
template: '#home-screen-template',
components: {
    'play-panel': comp_play_panel,
    'house-ad-big': comp_house_ad_big,
    'house-ad-small': comp_house_ad_small,
    'account-panel': comp_account_panel,
    'chicken-panel': comp_chicken_panel,
    'footer-links-panel': comp_footer_links_panel,
    'event-panel': comp_events,
    'media-tabs': MEDIATABS,
    'main-sidebar': COMPMAINSIDE,
    'profile-screen': ProfileScreen,
    'social-panel': comp_social_panel,
    'gauge-meter': CompGauge,
    'item': comp_item,
    // 'pwa-button': comp_pwa_btn,
},

data: function () {
    return vueData;
},

methods: {
    onHvsmPopupOpen() {
        this.getHvsmItems();
    },
    onHvsmPopupClose() {
    },
    onHvsmClicked(item) {
        let tag;	
        if (typeof item === 'object') {
            tag = item.item_data.tags.includes('Monsters') ? 'Monsters' : 'Heroes';
        } else {
            tag = item;
        }
        vueApp.showTaggedItemsOnEquipScreen(tag);
        // this.$refs.hvsmPopup.close();
    },
    playSound (sound) {
        BAWK.play(sound);
    },
    onEquipClicked: function () {
        if (this.showAdBlockerVideoAd) {
            return;
        }
        vueApp.openEquipSwitchTo();
        BAWK.play('ui_equip');
    },
    showSignIn: function () {
        extern.showSignInDialog();
        vueApp.$refs.firebaseSignInPopup.show();
    },
    onSignInClicked: function () {
        if (this.showAdBlockerVideoAd) {
            return;
        }
        this.showSignIn();
    },
    onSignOutClicked: function () {
        if (this.showAdBlockerVideoAd) {
            return;
        }
        extern.signOut();
    },
    leaveGameConfirmed() {
        if (this.showAdBlockerVideoAd) {
            return;
        }

        if (this.isAnonymous && this.showSignIn) {
            this.onSignInClicked();
        } else {
            extern.signOut();
        }
    },
    onResendEmailClicked: function () {
        extern.sendFirebaseVerificationEmail();
        // vueApp.showGenericPopup('verify_email_sent', 'verify_email_instr', 'ok');
        this.$refs.resendEmailConfirm.show();
    },
    onHideResendEmail() {
        extern.accountCreationNotification();
        // setTimeout(()=> vueApp.setDarkOverlay(true), 100);
    },
    onBigHouseAdClosed: function () {
        console.log('big house ad closed event received');
        this.ui.houseAds.big = null;
        this.urlParamSet = this.urlParams ? true : null;
        vueApp.showTitleScreenAd();
        vueApp.shellShockUrlParamaterEvents();
    },
    onPlayerNameChanged: function (newName) {
        console.log('play name event handler');
        vueApp.setPlayerName(newName);
        BAWK.play('ui_onchange');
    },
    onEggPlayClick() {
        play: 'play game',
        ga('send', 'event', vueData.googleAnalytics.cat.play, vueData.googleAnalytics.action.eggDollClick);
        vueApp.$refs.homeScreen.$refs.playPanel.onPlayButtonClick();
    },
    api_incentivizedVideoRewardRequest() {
        extern.api_incentivizedVideoRewardRequested();
    },
    onTwitchDropsClick() {
        if (this.showAdBlockerVideoAd) {
            return;
        }
        window.open(dynamicContentPrefix + 'twitch');
    },
    chwStopCycle() {
        if (this.chwHomeTimer) {
            clearInterval(this.chwHomeTimer);
            this.chwHomeTimer = '';
            this.chwHomeEl.classList.remove('.active');
        }
    },
    onGameTypeChanged(val) {
        vueApp.onGameTypeChanged(val);
    },
    // onGaugeMeterClick() {
    // 	this.$refs.hvsmPopup.show();
    // },

    getHvsmItems() {
        this.hvsm.hero.items = extern.getTaggedItems(this.hvsm.hero.name).filter( item => item.is_available);
        this.hvsm.monster.items = extern.getTaggedItems(this.hvsm.monster.name).filter( item => item.is_available);
    },
},
computed: {
    isEggStoreSaleItem() {
        return this.eggStoreItems.some( item => item[__uv.$wrap(('salePrice'))] !== '');
    },
    twitchDropsBtnImgSrs() {
        if (this.twitchLinked) {
            return '../img/events/twitch-drops-btn-linked.png';
        }
        return '../img/events/twitch-drops-btn-link-now.png';
    },
    isTwitchLinked() {
        if (this.twitchLinked) return '<i class="fas fa-check-circle text_twitch_yellow"></i>';
        return '<i class="fas fa-times-circle text_grey"></i>';
    }
}
};
</script><script id="gold-chicken-template" type="text/x-template">
<div>
    <img class="chw-popup-img" src="img/chicken-nugget/ssAd_chicknWinner800x600-min.png" />
    <h2 class="centered_x bottom-2 text_vip_yellow chw-popup-title fullwidth text-center">{{ loc.chw_popup_play }}</h2>
    <div id="btn_horizontal" class="centered_x bottom-2">
        <button @click="onCloseClick()" class="ss_button btn_red bevel_red">{{ loc.no_thanks }}</button>
        <button class="ss_button btn_green bevel_green" @click="onChickenClick">{{ loc.play_now }}</button>
    </div>
</div>
</script>

<script>
var comp_gold_chicken_popup = {
template: '#gold-chicken-template',
data: function () {
    return vueData;
},
props: ['loc'],
methods: {
    onCloseClick: function () {
        this.$emit('close-chw-popup');
    },
    onChickenClick: function () {
        this.$emit('open-chw-game');
    }
}
};
</script><script id="equip-screen-template" type="text/x-template">
<div id="#equip_wrapper" :class="screenCls" data-html2canvas-ignore>
    <div class="home-main-wrapper display-grid box_absolute height-100vh">
        <section id="equip_panel_middle" class="equip_panel middle_panel box_relative align-items-center">
            <div v-if="showShopUi" class="panel_tabs display-grid grid-column-3-eq gap-sm">
                <button class="ss_bigtab bevel_blue roundme_md font-sigmar" :class="getButtonToggleClass(equipMode.shop)" @click="switchTo(equipMode.shop)">{{ loc.eq_shop }}</button>
                <button class="ss_bigtab bevel_blue roundme_md font-sigmar" :disabled="!accountSettled" :class="getButtonToggleClass(equipMode.featured)" @click="switchTo(equipMode.featured)">{{ loc.eq_featured }}</i></button>
                <button class="ss_bigtab bevel_blue roundme_md font-sigmar" :disabled="!accountSettled" :class="getButtonToggleClass(equipMode.skins)" @click="switchTo(equipMode.skins)">{{ loc.eq_skins }}</i></button>
            </div>
            <div v-show="isOnShopInventoryLimited" id="equip_purchase_top" class="equip_purchase_top">
                <physical-tag id="physical-tag" class="ss_marginright" v-if="equip.physicalUnlockPopup.item" ref="physical-tag" :loc="loc" :item="equip.physicalUnlockPopup.item" @buy-item-clicked="onBuyItemClicked"></physical-tag>
            </div>

            <div v-show="isEquipModeInventory || isOnEquipModeSkins" id="equip_weapon_panel">
                <weapon-select-panel id="weapon_select" ref="weapon_select" :loc="loc" :account-settled="accountSettled" :play-clicked="playClicked" :current-class="classIdx" :current-screen="showScreen" :screens="screens" :hide-desc="!ui.showHomeEquipUi" @changed-class="onChangedClass"></weapon-select-panel>
            </div>
            <color-select v-if="isEquipModeInventory || isOnEquipModeSkins" id="equip.equipped_slots" ref="colorSelect" :loc="loc" :is-upgrade="isUpgraded" :color-idx="equip.colorIdx" :extra-colors-locked="equip.extraColorsLocked" @color-changed="onColorChanged" :current-screen="showScreen" :screens="screens"></color-select>
            <div id="limited-un-vaulted" v-show="isOnEquipModeFeatured || isEquipModeShop" class="limited-un-vaulted centered_x bottom-1 bg_blue2 roundme_lg paddings_lg">
                <item-grid id="item_grid" ref="itemGridVaulted" :loc="loc" :items="equip.showUnVaultedItems" :has-buy-btn="false" :selectedItem="equip.selectedItem" @item-selected="onItemSelected" :in-shop="isInShop" :in-inventory="showShopCart"></item-grid>
                <h4 class="text-center text-uppercase nospace text_blue5">{{ loc.eq_unvaulted_limited_msg }}</h4>
                <div class="price-tag-wrap">
                    <price-tag id="price_tag" v-if="equip.selectedItem && isSelectedInUnVaulted" ref="price_tag" :loc="loc" :item="equip.selectedItem" :hide-get-more-eggs="true" :egg-total="eggs" @buy-item-clicked="onBuyItemClicked" :chw-ready="chw.ready"></price-tag>
                </div>
            </div>
        </section>
        <!-- end .middle_panel -->
        <section id="equip_panel_right" class="equip_panel right_panel">
            <h3 v-if="!showPurchasesUi" class="equip-title text-center margins_sm box_relative text_white text-shadow-black-40 nospace">{{ loc[equip.categoryLocKey] }}</h3>
            <div v-if="isOnEquipModeFeatured" class="limited-msg-wrapper box_relative display-grid align-items-center text-center text_vip_yellow bg-limited roundme_md">
                <p class="nospace">{{ loc.eq_limited_msg }}</p>
            </div>
            <item-type-selector v-if="isOnShopInventory" class="box_relative" id="item_type_selector" ref="item_type_selector" :items="ui.typeSelectors" :in-limited="isOnEquipModeFeatured" :selected-item-type="equip.selectedItemType" :show-special-items="equip.showSpecialItems" :in-shop="isInShop" @item-type-changed="switchItemType"></item-type-selector>
            <egg-store v-if="isEquipModeShop" :loc="loc" :products="eggShopSortItems" :sale-event="isSale" @on-bundle-info-clicked="openProductBundlePopup" @on-try-prem-item-on="equipTryPremItemOn"></egg-store>
            <div v-show="!isEquipModeShop" id="item-search-wrap" class="item-search-wrap box_relative">
                <label for="item-search" class="centered_y item-search-label"><i class="fas fa-search text_blue3" :class="[equip.itemSearchTerm ? 'fa-times-circle text_red' : 'fa-search']" @click="onItemSearchReset"></i></label>
                <input ref="itemSearch" name="item-search" v-bind:placeholder="loc.eq_search_items" v-on:keyup="onItemSearchChange" class="ss_field font-nunito box_relative fullwidth">
                <!-- <input ref="itemSearch" name="item-search" v-bind:placeholder="loc.eq_search_items" v-model="itemSearchVal" v-on:keyup="onItemSearchChange" class="ss_field font-nunito box_relative fullwidth"> -->
            </div>
            <div v-if="currentEquipMode !== equipMode.shop" id="equip_sidebox" class="equip-main-item-grid roundme_md box_relative ss_marginbottom_lg">
                <div v-show="ui.showHomeEquipUi" id="item_mask"></div>
                <div id="item-smack-down">
                    <item-grid v-if="isOnShopInventoryLimited" id="item_grid" ref="item_grid" :loc="loc" :class="gridCls" :items="equip.showingItems" :selectedItem="equip.selectedItem" :category-loc-key="equip.categoryLocKey" :in-shop="isInShop" :in-inventory="showShopCart" :is-searching="equip.itemSearchTerm" :show-tooltips="true" @item-selected="onItemSelected" @switch-to-skins="onSwitchToSkinsClicked"></item-grid>
                </div>
                <!--<house-ad-small id="banner-ad" v-show="!isInShop"></house-ad-small>-->
            </div>
            <div v-show="isEquipModeInventory" class="ss_paddingright">
                <button  class="ss_button btn_blue bevel_blue box_relative fullwidth text-uppercase" :class="{'visibility-hidden' : !ui.showHomeEquipUi}" @click="onRedeemClick">{{ loc.eq_redeem }}</button>
                <button class="ss_button box_relative fullwidth text-uppercase btn-open-photo-booth" :class="photoBoothBtnUi.cls" @click="onPhotoboothClick" :disabled="extern.inGame">{{ photoBoothBtnUi.txt }}</button>
            </div>
            <price-tag id="price_tag" v-if="showPriceTag" ref="price_tag" :loc="loc" :item="equip.buyingItem" :egg-total="eggs" @buy-item-clicked="onBuyItemClicked" :chw-ready="chw.ready" :chw-watch-count="chw.winnerCounter"></price-tag>
        </section>
        <!-- .right_panel-->
    </div>

    <!-- Popup: Buy Item -->
    <small-popup id="buyItemPopup" ref="buyItemPopup" @popup-confirm="onBuyItemConfirm" @popup-closed="onBuyItemClose">
        <template slot="header">{{ loc.p_buy_item_title }}</template>
        <template slot="content">
            <div>
                <canvas id="buyItemCanvas" ref="buyItemCanvas" width="250" height="250"></canvas>
            </div>
            <div class="f_row f_center">
                <img v-if="!isBuyingItemPrem" src="img/ico_goldenEgg.png" class="egg_icon"/>
                <i v-else class="fas fa-dollar-sign"></i>
                <h1>{{ (equip.buyingItem) ? equip.buyingItem.price : '' }}</h1>
            </div>
        </template>
        <template slot="cancel">{{ loc.p_buy_item_cancel }}</template>
        <template slot="confirm">{{ loc.p_buy_item_confirm }}</template>
        <template slot="footer">
            <div v-if="equip.chwRewardBuyItem" class="fullwidth ss_margintop">
                <button class="ss_button btn_yolk bevel_yolk fullwidth" @click="chwWatchAd">{{ loc[chwButtonTxt] }} <icon v-show="chw.ready && chw.winnerCounter > 0" name="ico_watchAd" class="chw-icon-watch-ads"></icon></button>
            </div>
        </template>
    </small-popup>

    <!-- Popup: Redeem Code -->
    <small-popup id="redeemCodePopup" ref="redeemCodePopup" :popup-model="equip.redeemCodePopup" @popup-confirm="onRedeemCodeConfirm">
        <template slot="header">{{ loc.p_redeem_code_title }}</template>
        <template slot="content">
            <div class="error_text shadow_red" v-show="equip.redeemCodePopup.showInvalidCodeMsg">{{ loc.p_redeem_code_no_code }}</div>
            <p><input type="text" class="ss_field ss_margintop ss_marginbottom text-center width_lg" v-model="equip.redeemCodePopup.code" v-bind:placeholder="loc.p_redeem_code_enter"></p>
        </template>
        <template slot="cancel">{{ loc.cancel }}</template>
        <template slot="confirm">{{ loc.confirm }}</template>
    </small-popup>

    <!-- Popup: Physical Unlock -->
    <small-popup id="physicalUnlockPopup" ref="physicalUnlockPopup" :popup-model="equip.physicalUnlockPopup" @popup-confirm="onPhysicalUnlockConfirm">
        <template slot="header">{{ loc.p_physical_unlock_title }}</template>
        <template slot="content">
            <div v-if="(equip.physicalUnlockPopup.item !== null)">
                <div>
                    <item :loc="loc" :item="equip.physicalUnlockPopup.item" :isSelected="false" :show-item-only="true"></item>
                    <div class="f_row f_center">
                        <img src="img/ico_goldenEgg.png" class="egg_icon"/>
                        <h1>{{ loc.p_buy_special_price }}</h1>
                    </div>
                </div>
                <div class="popup_sm__item_desc">
                    {{ loc[equip.physicalUnlockPopup.item.item_data.physicalUnlockLocKey] }}
                </div>
            </div>
        </template>
        <template slot="cancel">{{ loc.cancel }}</template>
        <template slot="confirm">{{ loc.confirm }}</template>
    </small-popup>

    <small-popup id="bundlePopup" ref="bundlePopup" @popup-close="onBundlePopupClose" @popup-confirm="onBundlePopupConfirm">
        <template slot="header">{{ loc[equip.bundle.name] }} {{ loc.eq_bundle }}</template>
        <template slot="content">
            <img v-if="equip.bundle.img" :src="equip.bundle.img" class="bundle-popup-img centered_y"/>
            <item-grid id="bundleGrid" ref="bundleGrid" :loc="loc" :items="equip.bundle.items" :has-buy-btn="false" :selectedItem="null" @item-selected="onItemSelected"  :in-inventory="false" :hide-price="true" :show-tooltips="true"></item-grid>
            <h2 v-if="!equip.bundle.owned" class="bundle-popup-price text_yellow"><sup>$</sup>{{ equip.bundle.price }} USD</h2>
            <p v-if="equip.bundle.owned">{{ loc.product_bundles_items_owned }}</p>
        </template>
        <template slot="cancel">{{ loc.cancel }}</template>
        <template slot="confirm">{{ bundlePopupConfirmTxt }}</template>
    </small-popup>

    <!-- <large-popup id="hvsmPopup" ref="hvsmPopup" @popup-closed="onHvsmPopupClose" @popup-opened="onHvsmPopupOpen" @popup-x="onHvsmPopupClose" :overlayType="ui.overlayType.none">
        <template slot="content">
            <div id="hvsm-popup-item-grid-wrap" v-show="isOnEquipModeFeatured || isEquipModeShop" class="hvsm-popup-item-grid-wrap paddings_lg display-grid  grid-auto-flow-column align-items-center justify-content-center">
                <div class="hvsm-popup-item-grid">
                    <header>
                        <img class="display-block center_h" src="img/gauge-bar/shell_E&E_good_popup.png" alt="Heroes logo">
                        <h4 class="text-center text-uppercase nospace text_blue5">Heroes</h4>
                    </header>
                    <item-grid id="hvsmHeroesItemGrid" ref="hvsmHeroesItemGrid" :loc="loc" :items="equip.hvsmHeroItems" :has-buy-btn="false" :selectedItem="equip.selectedItem" @item-selected="onItemSelected" :in-shop="isInShop" :in-inventory="isEquipModeInventory"></item-grid>
                    <div class="price-tag-wrap">
                        <price-tag id="price_tag" v-if="onHsvmItemSelected(equip.hvsmHeroItems)" ref="price_tag" :loc="loc" :item="equip.selectedItem" :hide-get-more-eggs="true" :egg-total="eggs" @buy-item-clicked="onBuyItemClicked"></price-tag>
                    </div>
                </div>
                <div class="hvsm-popup-desc">
                    <header>
                        <h2 class="nospace text_white text-shadow-black-40 text-center">Egg Org & Eggventure</h2>	
                    </header>
                    <p class="text_blue5">
                        You should never have opened that chest & rolled the ancient arcane dice within‚Ä¶
                        Welcome brave Eggventurers, to a tale of mystery, magic, & mayhem!
                    </p>
                    <p class="text_blue5">
                        Here on the Outer Reach, Heroes & Monsters clash in epic battles, & danger lurks in the forest. Will the mighty Warriors, skilled Sorcerers, & cunning Rogues defeat the Beholders, Owlbears and Gelatinous Mounds?!
                    </p>
                    <p class="text_blue5">
                        Equip your skins of choice to choose your side. Each kill with the equipped Monsters or Heroes items will bring your side closer to victory! Who will win? You decide. Either way you need to survive to get out of here!
                    </p>
                    <p class="text_blue5">
                        Grab your swords & prepare yourshellves, for the eggventure of a lifetime awaits!
                    </p>
                </div>
                <div class="hvsm-popup-item-grid">
                    <header>
                        <img class="display-block center_h" src="img/gauge-bar/shell_E&E_evil_popup.png" alt="Monsters logo">
                        <h4 class="text-center text-uppercase nospace text_blue5">Monsters</h4>
                    </header>
                    <item-grid id="hvsmMonsterItemGrid" ref="hvsmMonsterItemGrid" :loc="loc" :items="equip.hvsmMonsterItems" :has-buy-btn="false" :selectedItem="equip.selectedItem" @item-selected="onItemSelected" :in-shop="isInShop" :in-inventory="isEquipModeInventory"></item-grid>
                    <div class="price-tag-wrap">
                        <price-tag id="price_tag" v-if="onHsvmItemSelected(equip.hvsmHeroItems)" ref="price_tag" :loc="loc" :item="equip.selectedItem" :hide-get-more-eggs="true" :egg-total="eggs" @buy-item-clicked="onBuyItemClicked"></price-tag>
                    </div>
                </div>
            </div>
        </template>
    </large-popup> -->
</div>
</script>

<script id="equipped-slots-template" type="text/x-template">
<div>
    <h3 class="margins_sm">{{ loc.eq_equipped }}</h3>
    <div id="equip_equippedslots">
        <div class="equip_item roundme_lg clickme f_row f_center" @click="onClick(itemType.Primary)">
            <item :loc="loc" id="primary_item" ref="primary_item" v-if="primaryItem" :item="primaryItem" class="equip_icon" :equippedSlot="true"></item>
            <div v-if="!primaryItem" class="equip_icon equip_icon_hat equip_icon_no_item"><img src="img/inventory-icons/ico_weaponPrimary.svg" alt="Primary equip slot"></div>
        </div>

        <div class="equip_item roundme_lg clickme f_row f_center" @click="onClick(itemType.Secondary)">
            <item :loc="loc" id="secondary_item" ref="secondary_item" v-if="secondaryItem" :item="secondaryItem" class="equip_icon" :equippedSlot="true"></item>
            <div v-if="!secondaryItem" class="equip_icon equip_icon_hat equip_icon_no_item"><img src="img/inventory-icons/ico_weaponSecondary.svg" alt="Secondary equip slot"></div>
        </div>

        <div class="equip_item roundme_lg clickme f_row f_center" @click="onClick(itemType.Grenade)">
            <item :loc="loc" id="grenade_item" ref="grenade_item" v-if="grenadeItem" :item="grenadeItem" class="equip_icon" :equippedSlot="true"></item>
            <div v-if="!grenadeItem" class="equip_icon equip_icon_hat equip_icon_no_item"><img src="img/inventory-icons/ico_grenade.svg" alt="Grenade equip slot"></div>

        </div>
        
        <div class="equip_item roundme_lg clickme f_row f_center" @click="onClick(itemType.Hat)">
            <item :loc="loc" id="hat_item" ref="hat_item" v-if="hatItem" :item="hatItem" :equippedSlot="true"></item>
            <div v-if="!hatItem" class="equip_icon equip_icon_hat equip_icon_no_item"><img src="img/inventory-icons/ico_hat.svg" alt="Hat item slot"></div>
        </div>
        
        <div class="equip_item roundme_lg clickme f_row f_center" @click="onClick(itemType.Stamp)">
            <item :loc="loc" id="stamp_item" ref="stamp_item" v-if="stampItem" :item="stampItem" :equippedSlot="true"></item>
            <div v-if="!stampItem" class="equip_icon equip_icon_stamp equip_icon_no_item"><img src="img/inventory-icons/ico_stamp.svg" alt="Stamp item slot"></div>
        </div>
    </div>
</div>
</script>

<script>
var comp_equipped_slots = {
template: '#equipped-slots-template',
components: { 'item': comp_item },
props: ['loc', 'primaryItem', 'secondaryItem', 'hatItem', 'stampItem', 'grenadeItem'],

data: function () {
    return {
        itemType: ItemType
    }
},

methods: {
    onClick: function (itemType) {
        this.$emit('equipped-type-selected', itemType);
    }
},

computed: {
    emptyHatClass: function () {
        return (this.hatItem === null) ? 'equip_icon_hat' : '';
    },

    emptyStampClass: function () {
        return (this.stampItem === null) ? 'equip_icon_stamp' : '';
    }
}
};
</script><script id="color-select-template" type="text/x-template">
<div class="text-center egg-color-select roundme_sm common-box-shadow">
    <!-- <h3 class="margins_sm">{{ loc.eq_color }}</h3> -->
    <div id="equip_free_colors" class="display-grid text-center grid-auto-flow-column align-items-center ">
        <!-- <svg v-for="(c, index) in freeColors" class="eggIcon equip_color" :style="{ color: c }" :class="isSelectedClass(index)" @click="onClick(index)"><use xlink:href="#icon-egg"></use></svg> -->
        <span v-for="(c, index) in freeColors" class="box_relative roundme_sm egg-color-icon " @click="onClick(index)">
            <img v-if="index === colorIdx" class="centered_x color-select-arrow" src="img/svg/ico-arrow-colorPicker.svg"/>
            <i  class="fas fa-egg" :style="{ color: c }" :class="isSelectedClass(index)"></i>
        </span>
    <!-- </div>
    <div id="equip_paid_colors" class="display-grid text-center grid-auto-flow-column align-items-center "> -->

        <!-- <svg v-for="(c, index) in paidColors" class="eggIcon equip_color" :style="{ color: c }" :class="isSelectedClass(index + freeColors.length)" @click="onClick(index + freeColors.length)"><use :xlink:href="getExtraColorEggIcon"></use></svg> -->
        <span v-for="(c, index) in paidColors" class="box_relative roundme_sm egg-color-icon" @click="onClick(index + freeColors.length)">
            <img v-if="colorIdx === (index + freeColors.length)" class="centered_x color-select-arrow" src="img/svg/ico-arrow-colorPicker.svg"/>
            <span class="fa-stack roundme_sm" :class="isSelectedClass(index + freeColors.length)">
                <i class="fas fa-egg fa-stack-1x" :style="{ color: c }"></i>
                <i v-if="!isUpgrade" class="fas fa-lock fa-stack-1x text_white"></i>
            </span>
        </span>
    </div>
</div>
</script>

<script>
var comp_color_select = {
template: '#color-select-template',
props: ['loc', 'colorIdx', 'extraColorsLocked', 'isUpgrade'],

data: function () {
    return {
        freeColors: freeColors,
        paidColors: paidColors
    }
},

methods: {
    isSelectedClass: function (idx) {
        return (idx === this.colorIdx) ? 'selected' : ''
    },

    onClick: function (idx) {
        if (idx >= freeColors.length && this.extraColorsLocked === true) {
            vueApp.showSubStorePopup();
            // BAWK.play('ui_chicken');
            return;
        }

        this.$emit('color-changed', idx);
    },
},

computed: {
    getExtraColorEggIcon() {
        return (this.extraColorsLocked === true && !this.isUpgrade) ? '#icon-egg-locked' : '#icon-egg';
    },
}
};
</script><script id="item-timer-template" type="text/x-template">
<div>
    <div id="equip_timerem" class="box_blue3 roundme_sm shadow_blue4">
        <i class="fas fa-hourglass-start"></i> 9{{ loc.eq_day }}<span class="blink">:</span>12{{ loc.eq_hour }}
        <br>{{ loc.eq_remaining }}
    </div>
</div>
</script>

<script>
var comp_item_timer = {
template: '#item-timer-template',
props: ['loc']
};
</script><script id="price-tag-template" type="text/x-template">
<div id="equip_purchase_items" v-if="isNoPrice" class="equip_purchase_items box_relative">

    <button v-if="!playerNeedsMoreEggs && !isItemOwned" class="ss_button btn_green bevel_green btn_md btn_buy_item display-grid fullwidth font-nunito f_row align-items-center justify-content-center" @click="onBuyClick">
        {{priceTagText}}
        <img v-if="!isPremium" src="img/ico_goldenEgg.png" class="ss_marginright_sm ss_marginleft">
        <i v-else class="fas fa-dollar-sign ss_marginleft"></i>
        {{ item.price }}
    </button>

    <button v-show="playerNeedsMoreEggs && !isItemOwned" class="ss_button btn_yolk bevel_yolk text-shadow-black-40 fullwidth text-center" @click="onWatchAdsClick">{{ watchAdsTxt }}! <icon v-show="showChwVideoIcon" name="ico_watchAd" class="chw-icon-watch-ads"></icon></button>
    <button v-show="!hideGetMoreEggs && !isItemOwned" class="ss_button btn_blue bevel_blue text-shadow-black-40 fullwidth text-center" @click="onGetMoreEggsClick">{{ loc.account_title_eggshop }}</button>
</div>
</script>

<script>
var comp_price_tag = {
template: '#price-tag-template',
props: ['loc', 'item', 'eggTotal', 'chwReady', 'hideGetMoreEggs', 'chwWatchCount'],
data() {
    return {
    };
},

methods: {
    onBuyClick: function () {
        if (this.isPremium) {
            return extern.buyProductForMoney(this.item.sku[__uv.$wrap((0))]);
        }
        this.$emit('buy-item-clicked', this.item);
    },
    onWatchAdsClick() {
        if (this.chwReady) ga('send', 'event', 'Chickn Winner', `btnClick${extern.inGame ? 'InGame' : 'Home'}`, 'watchToWinEggs');
        vueApp.showNuggyPopup();
    },
    onGetMoreEggsClick() {
        vueApp.openEquipSwitchTo(vueApp.equipMode.shop)
    }
},
computed: {
    isPremium() {
        return this.item.unlock === 'premium';
    },
    isNoPrice() {
        return this.item.price < 1000000000;
    },
    playerNeedsMoreEggs() {
        if (this.isPremium) {
            return false;
        } else {
            return this.item.price > this.eggTotal;
        }
    },
    priceTagText() {
        if (!this.playerNeedsMoreEggs) {
            return this.loc.eq_buy;
        }
        return;
    },
    priceTagTextCls() {
        if (!this.playerNeedsMoreEggs) {
            return 'text_blue5';
        } else {
            return 'text_red';
        }
    },
    watchAdsTxt() {
        if (this.chwReady) {
            return this.loc.chw_btn_watch_ad;
        } else {
            return 'Wait for more eggs';
        }
    },
    isItemOwned() {
        return extern.isItemOwned(this.item)
    },
    showChwVideoIcon() {
        return this.chwReady && this.chwWatchCount > 0;
    }
}
};
</script><script id="physical-tag-template" type="text/x-template">
<div id="equip_get_physical_item" class="equip_purchase_items">
    <div id="equip_pricetag" class="equip_pricetag shadow_blue2">
        <img src="img/pricetag_left.png">
        <div class="equip_pricetag__tag equip_pricetag__is_special_tag">
            <img src="img/ico_goldenEgg.png" class="ss_marginright">{{ loc.p_buy_special_price }}
        </div>
        <img src="img/pricetag_right.png">
    </div>
    <button class="ss_button btn_yolk bevel_yolk is_special_get_btn" @click="onBuyClick">{{ loc.p_chicken_goldbutton }}</button>
</div>
</script>

<script>
var comp_physical_tag = {
template: '#physical-tag-template',
props: ['loc', 'item'],

methods: {
    onBuyClick: function () {
        this.$emit('buy-item-clicked', this.item);
    }
}
};
</script><script id="item-type-selector-template" type="text/x-template">
<div class="ss_marginbottom_sm">
    <div id="equip_itemtype" class="equip_panelhead display-grid grid-auto-flow-column align-items-center f_space_between">
        <div v-for="item in items" class="ico_itemtype clickme roundme_lg f_row align-items-center" :class="{'selected' : item.type === selectedItemType}" @click="onItemTypeClick(item.type)">
            <svg>
                <use :xlink:href="item.img"></use>
            </svg>
        </div>
    </div>
</div>
</script>

<script>
var comp_item_type_selector = {
template: '#item-type-selector-template',
props: ['items', 'showSpecialItems', 'selectedItemType', 'inShop', 'inLimited'],

data: function () {
    return {
        showingTagged: false,
        selected: null
    }
},

methods: {
    onItemTypeClick: function (itemType) {
        this.selected = itemType;
        this.$emit('item-type-changed', itemType);
    },
}
};
</script><script id="item-grid-template" type="text/x-template">
<div>
    <div v-if="accountSettled" id="equip_grid" :class="gridCls" class="display-grid">
        <item v-for="i in itemsSorted" :loc="loc" :item="i" :key="i.id" :isSelected="isSelected(i)" :has-buy-btn="hasBuyBtn" @item-selected="onItemSelected" :is-shop="inShop" :hide-price="hidePrice" :show-tooltip="showTooltips"></item>
        <div v-show="inInventory && !isSearching" class="grid-item roundme_sm clickme morestuff box_relative common-box-shadow btn_green bevel_green f_row align-items-center justify-content-center" @click="onSwitchToSkinsClick">
            <icon class="fill-white shadow-filter" name="ico-nav-shop"></icon>
        </div>
        <div v-show="(inShop && !hiddenPremItemCheck) || !itemsSorted.length" class="grid-item roundme_lg box_absolute centered soldout text-center">
            <div class="soldout_head shadow_bluebig5" v-html="emptyGridMsg.title"></div>
            <div class="soldout_text shadow_bluebig5" v-html="emptyGridMsg.text"></div>
        </div>
    </div>
    <div id="items-account-not-loaded" v-show="!accountSettled" class="text-center">
        <h3>{{loc.signin_auth_title}}</h3>
        <p>{{loc.signin_auth_msg}}</p>
    </div>
</div>
</script>

<script>
var comp_item_grid = {
template: '#item-grid-template',
components: { 'item': comp_item },
props: ['loc', 'items', 'selectedItem', 'gridClass', 'categoryLocKey', 'inShop', 'hasBuyBtn', 'inInventory', 'hidePrice', 'showTooltips', 'isSearching'],
data() {
    return vueData;
},

methods: {
    onItemSelected: function (selectedItem) {
        this.$emit('item-selected', selectedItem);
    },

    isSelected: function (item) {
        if (!hasValue(this.selectedItem)) {
            return false;
        }

        return (this.selectedItem.id === item.id);
    },

    onSwitchToSkinsClick: function () {
        this.$emit('switch-to-skins');
        BAWK.play('ui_playconfirm');
    },

    isPremItemInStore() {
        let hasItem = false;
        for (let i = 0; i < this.items.length; i++) {
            const item = this.items[__uv.$wrap((i))];
                const isItem = vueApp.premiumShopItems.find(i => i.isActive && i.itemId.id === item.id);
                if (hasValue(isItem)) {
                    hasItem = true;
                    break;
                }
        }
        return hasItem;
    }
},

computed: {
    categoryName: function () {
        if (!hasValue(this.selectedItem)) {
            return null;
        }

        return this.loc[__uv.$wrap(('item_type_' + this.selectedItem.item_type_id))];
    },

    hiddenPremItemCheck() {
        if (this.items.some(i => i.unlock === 'purchase') || this.items.length !== 0) return true;
        if (this.items.some(i => i.unlock === 'premium')) return this.isPremItemInStore();
        return false;
    },

    gridCls() {
        if (this.hasBuyBtn) {
            return 'grid-auto-flow-column gap-1';
        } else {
            return 'grid-column-3-eq align-content-start align-content-start gap-sm';
        }
    },
    itemsSorted() {
        return this.items.sort((b, a) => {
            // if (a.id === this.selectedItem.id && b.id !== this.selectedItem.id && !this.inShop) return 1;
            // if (a.id !== this.selectedItem.id && b.id === this.selectedItem.id && !this.inShop) return -1;
            if (a.unlock === 'premium' && b.unlock !== 'premium') return 1;
            if (a.unlock !== 'premium' && b.unlock === 'premium') return -1;
            if (a.unlock === 'vip' && b.unlock !== 'vip') return 1;
            if (a.unlock !== 'vip' && b.unlock === 'vip') return -1;
            if (a.unlock === 'physical' && b.unlock !== 'physical') return 1;
            if (a.unlock !== 'physical' && b.unlock === 'physical') return -1;
            if (a.unlock === 'manual' && b.unlock !== 'manual') return 1;
            if (a.unlock !== 'manual' && b.unlock === 'manual') return -1;
            if (a.unlock === 'default' && b.unlock !== 'default') return 1;
            if (a.unlock !== 'default' && b.unlock === 'default') return -1;
            if (a.unlock === 'purchase' && b.unlock !== 'purchase') return 1;
            if (a.unlock !== 'purchase' && b.unlock === 'purchase') return -1;
            return 0;
        });
    }, 
    emptyGridMsg() {
        if (this.isSearching) {
            return {
                title: this.loc[__uv.$wrap(('eq_search_out_head'))],
                text: this.loc[__uv.$wrap(('eq_search_out_text'))]
            }
        } else {
            return {
                title: this.loc[__uv.$wrap(('eq_sold_out_head'))],
                text: this.loc[__uv.$wrap(('eq_sold_out_text'))]
            }
        }

    }
}
};
</script><script id="egg-store-template" type="text/x-template">
<div class="f_col">
    <egg-store-item v-for="item in products" :key="item.sku" :item="item" :loc="loc" inStore="true" :account-set="accountSettled" :isUpgraded="isUpgraded" :isSaleEvent="saleEvent" @on-bundle-info-clicked="openProductBundlePopup" @on-try-prem-item-on="onTryPremItemOn"></egg-store-item>
</div>
</script>

<template id="comp-store-item">
<div v-if="showItem" class="single-egg-store-item box_relative align-items-center roundme_md common-box-shadow" :class="[itemCls, {purchased: purchased}]">
    <header v-if="productTypeItem || productTypeBundle" class="grid-span-2-start-1">
        <h6 class="single-egg-store-header nospace f_row align-items-center f_space_between">
            {{ loc[title] }}
            <icon v-if="productTypeItem" class="egg-store-item-type" :name="productIcon"></icon>
        </h6>
    </header>
    <div class="display-grid grid-column-1-2 align-items-center text-center">
        <div>
            <img :src="img" class="eggshop_image roundme_md display-block center_h" :class="imgCls" @click="onTryPremItemOn">
            <div v-if="productTypeItem" class="text-center">
                <div class="eggshop_pricebox text_brown" :class="{ slashed: item.salePrice }">
                    ${{ price }} <span>USD</span>
                </div>
            </div>
        </div>
        <div>
            <header v-if="!productTypeItem &amp;&amp; !productTypeBundle">
                <h6 class="eggshop_bigtitle nospace text_blue5">{{ loc[title] }}</h6>
            </header>
            <div class="display-grid">
                <p v-if="showSubtitle" class="eggshop_subtitle font-sigmar" :class="subTitleCls" v-html="loc[description]"></p>
            </div>
            <div class="single-egg-store-price box_relative z-index-2">
                <p v-if="!productTypeItem" class="eggshop_pricebox nospace display-inline" :class="priceCls"><span class="eggshop-dollar-sign">$</span>{{ item.price }}<span class="eggshop-currency-type"> USD</span></p>
                <button v-if="productTypeBundle" class="btn_store ss_button btn_yolk bevel_yolk btn_sm" @click="onBundleInfoClicked">More info</button>
                <button class="btn_store ss_button btn_green bevel_green btn_sm" @click="onItemClicked()" :disabled="purchased &amp;&amp; productTypeBundle">{{ buyBtnText }}</button>
            </div>
            <button v-if="productTypeItem &amp;&amp; !purchased &amp;&amp; inStore" class="ss_button btn_yolk bevel_yolk btn_sm center_h vip-get-btn f_row align-items-center" @click="onVipClick"><span v-html="loc.p_egg_shop_free_with_vip"></span><icon class="egg-store-item-type shadow-filter" name="ico-vip"></icon></button>

        </div>
    </div>
    <!-- <div v-if="item.salePrice" class="sale-desc box_absolute bottom-0">{{ loc.egg_pack_special_msg }}</div> -->
</div>
</template>
<script>
const comp_store_item = {
    template: '#comp-store-item',
    props: ['loc', 'item', 'inStore', 'accountSet', 'isUpgraded', 'isSaleEvent'],
    data() {
        return {
            purchased: false,
            attempt: 0,
            productItems: [],
            productIcon: '',
            bundleInfo: {
                items: [],
                isOwned: false,
                price: 0,
                img: '',
                name: '',
            },
        };
    },
    mounted() {
        this.setupProduct();
    },
    methods: {

        onTryPremItemOn() {
            if (this.productTypeItem) {
                this.$emit('on-try-prem-item-on', this.productItems[__uv.$wrap((0))]);
            }
        },

        onItemClicked() {
            if (!this.accountSet || !vueApp.accountSettled) {
                vueApp.hideEggStorePopup();
                setTimeout(() => {
                    if (this.attempt < 5) {
                        this.onItemClicked(this.item.sku);
                        this.attempt++;
                    } else {
                        vueApp.showGenericPopup('uh_oh', 'error', 'ok');
                    }
                }, 300);
                vueApp.pleaseWaitPopup();
                return;
            }
            
            vueApp.hidePopupEggStoreSingle();

            if ((this.item.type === 'item' || this.item.type === 'bundle') && !hasValue(this.item.itemIds[__uv.$wrap((0))])) {
                vueApp.showGenericPopup('uh_oh', 'p_egg_shop_no_item_id', 'ok');
                return;
            }

            if (this.purchased && this.productTypeItem) {
                console.log('Item is owned so lets go see it.');
                vueApp.showItemOnEquipScreen(extern.catalog.findItemById(this.item.itemIds[__uv.$wrap((0))]));
                return;
            }

            extern.buyProductForMoney(this.item.sku);

            ga('send', 'event', vueApp.googleAnalytics.cat.purchases, vueApp.googleAnalytics.action.eggShackProductClick, this.item.sku);
        },
        onBundleInfoClicked() {
            if (this.bundleInfo.items.length === 0) {
                this.productItems.forEach(item => {
                    this.bundleInfo.items.push(item);
                });
                this.bundleInfo.isOwned = this.purchased;
                this.bundleInfo.price = this.price;
                this.bundleInfo.img = this.img;
                this.bundleInfo.name = this.description;
            }

            this.$emit('on-bundle-info-clicked', this.bundleInfo);
        },
        onVipClick() {
            // this.$parent.$parent.hide();
            vueApp.showSubStorePopup();
        },
        getItemType() {
            const item = extern.catalog.findItemById(this.item.itemIds[__uv.$wrap((0))]);
            const obj = {};

            if (item.exclusive_for_class !== null) {
                obj.name = getKeyByValue(CharClass, item.exclusive_for_class).toLowerCase();
                obj.isClass = true;
            } else {
                obj.name = getKeyByValue(ItemType, item.item_type_id).toLowerCase();
                obj.isClass = false;
            }

            return obj;
        },
        setupProduct() {
            switch (this.item.type) {
                case 'item':
                    this.productItems = [extern.catalog.findItemById(this.item.itemIds[__uv.$wrap((0))])];
                    this.purchased = extern.isItemOwned(this.productItems[__uv.$wrap((0))]);
                    this.getIcon();
                    break;
                case 'bundle':
                    let owned = [];
                    this.productItems = extern.catalog.findItemsByIds(this.item.itemIds);
                    this.productItems.forEach(item => {
                        if (extern.isItemOwned(item)) {
                            owned.push(item.id)
                        }
                    });
                    this.purchased = owned.length === this.productItems.length;
                    break;
            
                default:
                    break;
            }
        },
        getIcon() {
            if (this.productItems[__uv.$wrap((0))].exclusive_for_class !== null) {
                this.productIcon = `ico-weapon-${getKeyByValue(CharClass, this.productItems[__uv.$wrap((0))].exclusive_for_class).toLowerCase()}`;
            } else {
                this.productIcon = `ico-${getKeyByValue(ItemType, this.productItems[__uv.$wrap((0))].item_type_id).toLowerCase()}`;
            }
        }
    },
    computed: {
        productTypeItem() {
            return this.item.type === 'item'
        },
        productTypeBundle() {
            return this.item.type === 'bundle'
        },
        productTypeCurrency() {
            return this.item.type === 'currency'
        },
        title() {
            if (this.productTypeBundle) {
                return `product_bundles_title`;
            }
            return `${this.item.sku}_title`;
        },
        imgCls() {
            return this.productTypeBundle ? 'box_absolute egg-store-bundle-img centered_y z-index-1' : '';
        },
        priceCls() {
            return this.productTypeBundle ? 'text_yellow' : 'text_blue5';
        },
        description() {
            if (this.productTypeBundle) {
                return `${this.item.sku}_title`;
            }
            return `${this.item.sku}_desc`;
        },
        saleDesc() {
            if (this.item.salePrice) {
                return `${this.item.sku}_sale_desc`;
            }
        },
        img() {
            switch (this.item.type) {
                case 'item':
                    return `img/store/items/${this.item.sku}.gif`;
                    break;
                case 'bundle':
                    return `img/store/bundles/${this.item.sku}.png`;
                    break;
                default:
                return `img/${!this.isSaleEvent ? '' : 'store-black-friday/'}${this.item.sku}.png`;
                    break;
            }
        },
        itemType() {
            return 'single-egg-store-item-is-' + this.item.type;
        },
        itemCls() {
            return `${this.itemType} ${this.item.sku} ${this.item.type === 'currency' ? '' : ''}`;
        },
        buyBtnText() {
            if (this.purchased && this.productTypeItem) {
                return this.loc.p_egg_shop_see_item;
            } else if (this.productTypeBundle && this.purchased) {
                return this.loc.eq_owned;
            }
            return this.loc.p_buy_item_confirm;
        },
        showItem() {
            if (this.inStore) return this.item.inStore;
            return true;
        },
        flagTxt() {
            if (this.item.salePrice) {
                return 'fa-tag';
            }
            return 'fa-gem'
        },
        showSubtitle() {
            if (this.productTypeItem) return true;
            if (this.isSaleEvent) {
                return false;
            }
            return true;
        },
        price() {
            if (this.item.salePrice) {
                return this.item.salePrice;
            } else {
                return this.item.price;
            }
        },
        subTitleCls() {
            switch (this.item.type) {
                case 'item':
                    return 'text-center text_brown';
                    break;
                case 'bundle':
                    return 'text-shadow-black-40 text_white';
                    break;
            
                default:
                    return 'text_blue5 nospace';
                    break;
            }
        },
    },
};
</script>
<script>
var comp_egg_store = {
template: '#egg-store-template',
components: {
    'egg-store-item': comp_store_item,
},
data() {
    return vueData;
},
props: ['loc', 'products', 'saleEvent'],

methods: {
    onItemClicked: function (sku) {
        if (!this.accountSettled) {
            console.log(this.$parent.hide());
            setTimeout(() => {
                this.onItemClicked(sku[__uv.$wrap((0))])
            }, 300);
            vueApp.pleaseWaitPopup();
            return;
        }
        if (vueApp.$refs.genericPopup.isShowing === true) vueApp.$refs.genericPopup.close();
        this.$parent.hide();
        extern.buyProductForMoney(sku[__uv.$wrap((0))]);
        ga('send', 'event', this.googleAnalytics.cat.purchases, this.googleAnalytics.action.eggShackProductClick, sku);
    },
    openProductBundlePopup(items) {
        this.$emit('on-bundle-info-clicked', items);
    },
    onTryPremItemOn(item) {
        this.$emit('on-try-prem-item-on', item);
    },
},
};
</script>


<script>
var comp_equip_screen = {
template: '#equip-screen-template',
components: {
    'equipped-slots': comp_equipped_slots,
    'color-select': comp_color_select,
    'item-timer': comp_item_timer,
    'price-tag': comp_price_tag,
    'physical-tag': comp_physical_tag,
    'item-type-selector': comp_item_type_selector,
    'item-grid': comp_item_grid,
    'house-ad-small': comp_house_ad_small,
    'weapon-select-panel': comp_weapon_select_panel,
    'item': comp_item,
    // 'account-panel': comp_account_panel,
    'house-ad-small': comp_house_ad_small,
    'egg-store': comp_egg_store,
    'settings-control-binder': comp_settings_control_binder,
    'settings-gamepad-binder': comp_settings_gamepad_binder,
    'language-selector': comp_language_selector,
    'settings-adjuster': comp_settings_adjuster,
    'settings-toggler': comp_settings_toggler
},

created() {
    this.debouncedSearch = debounce((newValue, oldValue) => this.onItemSearch(newValue, oldValue), 500);
},

data: function () {
    return vueData;
},

equippedItems: {},

methods: {

    onItemSearchChange() {
        this.itemSearchVal = this.$refs.itemSearch.value;
    },

    setupItemGridMain() {
        if (this.isOnEquipModeFeatured) {
            this.populateItemGridWithTagged(this.equip.specialItemsTag);
        } else {
            this.populateItemGridWithType(this.equip.selectedItemType);
        }
    },

    setup: function (itemType, wasFeatured) {
        if (!itemType) {
            itemType = ItemType.Primary;
        }

        this.updateEquippedItems();
        this.poseEquippedItems();

        if (itemType === 'tagged' || wasFeatured) {
            this.populateItemGridWithTagged(this.equip.specialItemsTag);
        } else {
            this.populateItemGridWithType(itemType);
        }

        this.selectEquippedItemForType();
    },

    itemAvailForPurchase(i) {
        return i.is_available && i.unlock === 'purchase';
    },

    onHvsmPopupOpen() {
        this.setup('tagged');
        this.equip.hvsmHeroItems = extern.getTaggedItems('premFeatOne').filter(i => this.itemAvailForPurchase(i));
        this.equip.hvsmMonsterItems = extern.getTaggedItems('premFeatOne').filter(i => this.itemAvailForPurchase(i));
    },
    onHvsmPopupClose() {
        vueApp.switchToHomeUi();
    },
    // onHsvmItemSelected(items) {
    // 	return this.equip.selectedItem !== undefined ? items.some(i => i.id === this.equip.selectedItem.id) : false;
    // },

    updateEquippedItems: function () {
        this.equipped = extern.getEquippedItems();
    },

    poseEquippedItems: function () {
        let items = {
            [ItemType.Hat]: this.equipped[__uv.$wrap((ItemType.Hat))],
            [ItemType.Stamp]: this.equipped[__uv.$wrap((ItemType.Stamp))],
            [ItemType.Primary]: this.equipped[__uv.$wrap((ItemType.Primary))],
            [ItemType.Secondary]: this.equipped[__uv.$wrap((ItemType.Secondary))],
            [ItemType.Grenade]: this.equipped[__uv.$wrap((ItemType.Grenade))],
            [ItemType.Melee]: this.equipped[__uv.$wrap((ItemType.Melee))]
        }

        if (this.ui.showHomeEquipUi === false) {
            Object.keys(items).forEach(key => {
                key = parseInt(key, 10);
                if (key !== this.equip.selectedItemType) {
                    delete items[__uv.$wrap((key))];
                }
            });
        } else {
            switch (this.equip.showingWeaponType) {
                case ItemType.Primary:
                    items[__uv.$wrap((ItemType.Melee))] = null;
                    items[__uv.$wrap((ItemType.Grenade))] = null;
                    break;
                case ItemType.Secondary:
                    items[__uv.$wrap((ItemType.Melee))] = null;
                    items[__uv.$wrap((ItemType.Grenade))] = null;
                    break;
                case ItemType.Melee:
                    items[__uv.$wrap((ItemType.Primary))] = null;
                    items[__uv.$wrap((ItemType.Grenade))] = null;
                    break;
                case ItemType.Grenade:
                    items[__uv.$wrap((ItemType.Secondary))] = null;
                    items[__uv.$wrap((ItemType.Melee))] = null;
                    break;
                default:
                    items[__uv.$wrap((ItemType.Melee))] = null;
                    items[__uv.$wrap((ItemType.Grenade))] = null;
                    break;
            }
        }

        extern.poseWithItems(items);
    },

    selectEquippedItemForType: function () {
        this.equip.selectedItem = this.equipped[__uv.$wrap((this.equip.selectedItemType))];
    },

    populateItemGridWithType: function (itemType) {
        this.equip.selectedItemType = itemType;
        var items = extern.getItemsOfType(itemType);
        this.populateItemGrid(items);
        
        this.equip.categoryLocKey = 'item_type_{0}{1}'.format(itemType, ((itemType === ItemType.Primary) ? '_' + this.classIdx : ''));
    },

    populateItemGridWithTagged: function (tag, itemType) {
        var items = extern.getTaggedItems(tag, itemType);
        this.populateItemGrid(items);
        this.equip.categoryLocKey = 'item_type_5';
    },

    populateItemGrid: function (items) {
        if (this.currentEquipMode === vueData.equipMode.inventory) {
            items = items.filter(i => extern.isItemOwned(i) || (i.is_available && i.unlock === "default"));
        } else {
            items = items.filter(i => i.is_available && !extern.isItemOwned(i) && (i.unlock === 'purchase' || (i.unlock === 'premium' && i.sku && i.activeProduct)));
        }

        this.equip.showingItems = items;
    },

    onBackClick: function () {
        vueApp.showSpinner();
        extern.saveEquipment(() => {
            if (extern.inGame) {
                extern.closeEquipInGame();
            }
            vueApp.hideSpinner();
            this.equip.showingWeaponType = ItemType.Primary;
        });
    },

    switchItemType: function (itemType) {
        if (itemType !== this.equip.selectedItemType) {

            // skins should only show the selected primary/secondary weapon if it's on the primary/secondary tab
            if (this.currentEquipMode === this.equipMode.skins) {
                this.equipped[__uv.$wrap((ItemType.Primary))] = extern.account.getPrimaryWeapon();
                this.equipped[__uv.$wrap((ItemType.Secondary))] = extern.account.getSecondaryWeapon();
            }

            if (itemType === ItemType.Primary || itemType === ItemType.Secondary || itemType == ItemType.Grenade || itemType == ItemType.Melee) {
                this.equip.showingWeaponType = itemType;
            }
            else {
                this.equip.showingWeaponType = null;
            }

            this.equip.selectedItemType = itemType;

            if (!this.ui.showHomeEquipUi) this.$emit('photo-booth-type-id');

            this.poseEquippedItems();
            this.populateItemGridWithType(itemType);

            if (this.equip.itemSearchTerm) {
                this.itemSearch();
            }

            if (this.isEquipModeInventory) {
                this.selectEquippedItemForType();
            } else {
                this.selectFirstItemInShop();
            }

        }
        if (!this.isInShop) {

            this.hideItemForSale();
            this.hideItemForSpecial();

        }

        BAWK.play('ui_click');
    },

    itemSearch() {
        const SearchItems = new Fuse(this.equip.showingItems, extern.fuseOptions).search(this.equip.itemSearchTerm);

        if (SearchItems.length > 0) {
            console.log('ItemSearch result start');
            console.log('ItemSearch Term', this.equip.itemSearchTerm);
            console.log('ItemSearch Items array');
            console.log('ItemSearch SearchItems', SearchItems);
            this.equip.showingItems.length = 0;
            SearchItems.forEach(i => {

                console.log('ItemSearch item: ', i.item.name, 'tags: ', i.item.hasOwnProperty('item_data') && i.item.item_data.hasOwnProperty('tags') ? JSON.stringify(i.item.item_data.tags) : '', 'meshName: ', i.item.hasOwnProperty('item_data') && i.item.item_data.hasOwnProperty('meshName') ? i.item.item_data.meshName : 'None, i am a stamp', 'unlock: ', i.item.unlock)
                this.equip.showingItems.push(i.item)
            });
            console.log('ItemSearch result end');

        } else {
            this.equip.showingItems.length = 0;
        }
    },

    onItemSearch(newVal, oldVal) {
        // reset the grid if the search term shortens so we search the full list again
        if (newVal !== oldVal) {
            this.setupItemGridMain();
        }

        if (newVal.length >= 1) {
            this.equip.itemSearchTerm = newVal.toLowerCase().replace(/\s/g, '');
            this.itemSearch();
        } else if (!newVal.length) {
            this.onItemSearchReset();
        }
    },

    onItemSearchReset() {
        this.itemSearchVal = '';
        this.equip.itemSearchTerm = '';
        this.$refs.itemSearch.value = '';
        this.setupItemGridMain();
    },

    onTaggedItemsClicked: function () {
        if (this.equip.selectedItemType === 'tagged') {
            return;
        }
        this.showTaggedItems(this.equip.specialItemsTag);
        this.selectFirstItemInShop();
    },

    onTaggedResetItems() {
        this.showTaggedItems(this.equip.specialItemsTag);
        this.selectFirstItemInShop();	
    },

    onPremiumItemsClicked() {
        if (this.equip.selectedItemType === 'premium') {
            return;
        }
        this.showPremiumItems();
        this.selectFirstItemInShop();
    },

    showPremiumItems() {
        this.equip.selectedItemType = 'premium';
        var items = extern.getPremiumItems();
        this.populateItemGrid(items);
        this.equip.categoryLocKey = 'item_type_7';
    },

    showTaggedItems: function (tag, itemType) {
        this.equip.selectedItemType = 'tagged';

        if ((this.isEquipModeInventory && !this.ownsTaggedItems(this.equip.specialItemsTag)) || extern.openShopOnly) {
            this.currentEquipMode = this.equipMode.shop;
            vueApp.conditionalAnonWarningCall();
            extern.openShopOnly = false;

        }
        
        this.populateItemGridWithTagged(tag);
    },

    showSelectedTagItems(tag) {
        this.equip.selectedItemType = 'tagged';
        // if (this.equip.mode === this.equip.equipMode.inventory) {
        // 	this.equip.mode = this.equip.equipMode.shop;
        // }
        this.populateItemGridWithTagged(tag);
    },

    ownsTaggedItems: function (tag) {
        return extern.getTaggedItems(tag).filter(i => {
                return extern.isItemOwned(i);
            }).length > 0;
    },

    selectFirstItemInShop: function () {
        if (this.isInShop && this.equip.showingItems.length > 0) {
            this.selectItem(this.equip.showingItems[__uv.$wrap((0))]);
        }
    },

    switchTo: function (mode, useItemType) {
        this.equip.showingItems = [];
        if (!useItemType) this.equip.showingWeaponType = ItemType.Primary;

        if (useItemType) this.switchItemType(useItemType);

        this.$refs.itemSearch.value = '';
        this.equip.itemSearchTerm = '';

        switch (mode) {
            case this.equipMode.shop:
                this.currentEquipMode = this.equipMode.shop;
                this.getVaultedItemsForGrid(true);
                this.updateEquippedItems();
                this.poseEquippedItems();
                vueApp.conditionalAnonWarningCall();
                break;

            case this.equipMode.inventory:
                if (this.equip.selectedItemType === 'tagged' && this.isOnEquipModeSkins || this.equip.selectedItemType === 'tagged' && this.isOnEquipModeFeatured) {
                    if (!this.ownsTaggedItems(this.equip.specialItemsTag)) {
                        this.switchItemType(ItemType.Primary);
                    }
                }
                this.currentEquipMode = this.equipMode.inventory;
                this.hideItemForSale();
                this.hideItemForSpecial();
                this.poseEquippedItems();
                this.showItemsAfterEquipModeSwitch();
                this.selectEquippedItemForType();
                break;

            case this.equipMode.featured:
                this.updateEquippedItems();
                this.poseEquippedItems();
                this.showTaggedItems(this.equip.specialItemsTag)
                this.onTaggedItemsClicked();
                this.getVaultedItemsForGrid(true);
                this.currentEquipMode = this.equipMode.featured;
                vueApp.conditionalAnonWarningCall();
                break;

            case this.equipMode.skins:
                this.setup(useItemType);
                this.currentEquipMode = this.equipMode.skins;
                this.showItemsAfterEquipModeSwitch();
                vueApp.conditionalAnonWarningCall();
                break;
        
            default:
                break;
        }

        this.selectFirstItemInShop();

        BAWK.play('ui_toggletab');
        // vueApp.histPushState({game: this.screens.equip}, 'Shellshockers equipment shop', '?equip=shop');
    },

    showItemsAfterEquipModeSwitch: function () {
        if (this.equip.selectedItemType === 'tagged') {
            this.showTaggedItems(this.equip.specialItemsTag)
        } else if (this.equip.selectedItemType === 'premium') {
            this.showPremiumItems();
        } else {
            this.populateItemGridWithType(this.equip.selectedItemType);
        }
    },

    onEquippedTypeSelected: function (itemType) {
        this.equip.selectedItemType = itemType;
        if ([ItemType.Primary, ItemType.Secondary, ItemType.Grenade, ItemType.Melee].includes(this.equip.selectedItemType)) {
            this.equip.showingWeaponType = itemType;
        } else {
            this.equip.showingWeaponType = null;
        }
        this.switchTo(this.equipMode.inventory);
    },

    onChangedClass: function () {

        this.hideItemForSale();
        this.hideItemForSpecial();
        this.updateEquippedItems();

        if (this.equip.selectedItemType !== ItemType.Primary) {
            this.onEquippedTypeSelected(ItemType.Primary);
        }

        this.populateItemGridWithType(this.equip.selectedItemType);

        if (this.equip.itemSearchTerm) {
            this.itemSearch();
        }

        if (extern.inGame && this.showScreen !== this.screens.equip) {
            this.equip.showingWeaponType = ItemType.Primary;
            extern.closeEquipInGame(true);
        }
        if (!this.ui.showHomeEquipUi) this.$emit('photo-booth-type-id');
        this.poseEquippedItems();
    },

    autoSelectItem: function (item) {
        if (extern.isItemOwned(item)) {
            this.switchTo(this.equipMode.inventory);
        } else {
            this.switchTo(this.equipMode.skins);
        }
        if (item.exclusive_for_class) {
            extern.changeClass(item.exclusive_for_class);
            this.onChangedClass();
        } else {
            this.switchItemType(item.item_type_id);
        }
        this.selectItem(item);
    },

    selectItemClickSound(selectedItem) {
        let selectSound;
        if (![ItemType.Hat, ItemType.Stamp].includes(selectedItem.item_type_id) && selectedItem.unlock !== 'default') {
            switch (selectedItem.item_type_id) {
                case ItemType.Grenade:
                    selectSound = selectedItem.item_data.sound;
                    break;
                case ItemType.Melee:
                    selectSound = selectedItem.item_data.meshName;
                    break;
                default:
                    selectSound = selectedItem.item_data.meshName + '_fire';
                    break;
            }
        }
        BAWK.play(selectSound, '', 'ui_click');
    },

    onItemSelected: function (item) {
        if (this.$refs.buyItemPopup.isShowing) return;
        this.selectItem(item);
    },

    isPremItemInStore(item) {
        let hasItem = false;
        const isItem = this.premiumShopItems.find(i => i.isActive && i.itemId.id === item.id);
        if (hasValue(isItem)) {
            hasItem = true;
        }
        return hasItem;
    },

    selectItem: function (item) {
        if (!hasValue(item)) return;
        var selectingSame = hasValue(this.equip.selectedItem) && this.equip.selectedItem.id === item.id;
        var selectedId = selectingSame ? this.equip.selectedItem.id : null;
        var isWeapon = (item.item_type_id === ItemType.Primary || item.item_type_id === ItemType.Secondary || item.item_type_id === ItemType.Grenade || item.item_type_id === ItemType.Melee);
        var typeId = item.item_type_id;

        if (selectingSame) {
            if (this.isInShop) {
                this.hideItemForSale();
            } else {
                if (!isWeapon) {
                    this.equipped[__uv.$wrap((typeId))] = null;
                    extern.tryEquipItem(null, typeId)
                }
            }

            this.equip.selectedItem = null;
            this.updateEquippedItems();
            this.poseEquippedItems();
            return;
        }

        this.equipped[__uv.$wrap((typeId))] = item;

        if (item) {
            this.equip.selectedItem = item;

            if (this.currentEquipMode === this.equipMode.featured) {
                this.equip.selectedItemType = typeId;
                if (isWeapon) {
                    this.equip.showingWeaponType = typeId
                } else {
                    this.equip.showingWeaponType = null;
                }
            }

            // this.equip.selectedItemType = null;
            if (!this.ui.showHomeEquipUi) this.$emit('photo-booth-type-id');
        }

        if (!this.isInShop) extern.tryEquipItem(item, typeId);		

        if (hasValue(item)) {
            if (this.isInShop) {
                switch (item.unlock) {
                    case "purchase":
                    case "premium":
                            this.offerItemForSale(item);
                            this.hideItemForSpecial();
                    break;
                }
            }
        } else {
            this.hideItemForSale();
            this.hideItemForSpecial();

        }

        this.selectItemClickSound(item);
        this.poseEquippedItems();
    },
    getButtonToggleClass: function (equipMode) {
        return (equipMode === this.currentEquipMode) ? 'btn_toggleon' : 'btn_toggleoff';
    },

    offerItemForSpecial: function(item) {
        return this.equip.physicalUnlockPopup.item = item;
    },

    hideItemForSpecial: function() {
        this.equip.physicalUnlockPopup.item = null;
    },

    offerItemForSale: function (item) {
        this.equip.buyingItem = item;
    },

    hideItemForSale: function () {
        this.equip.buyingItem = null;
        // this.equip.physicalUnlockPopup.item = null
    },

    onBuyItemClicked: function () {
        // If item is buying item show buyItemPopup or show physicalUnlockPopup
        if (this.equip.selectedItem && (this.isEquipModeShop || this.isOnEquipModeFeatured)) {
            this.equip.buyingItem = this.equip.selectedItem;
        }
        if (this.equip.buyingItem) {
            if (this.chwRewardIds.includes(this.equip.buyingItem.id)) {
                this.equip.chwRewardBuyItem = true;
            }
            this.$refs.buyItemPopup.toggle();
            extern.renderItemToCanvas(this.equip.buyingItem, this.$refs.buyItemCanvas)
        } else {
            this.$refs.physicalUnlockPopup.toggle()
        }
        BAWK.play('ui_popupopen');
    },

    onBuyItemConfirm: function () {
        if (this.equip.buyingItem.unlock === 'premium') {
            extern.buyProductForMoney(this.equip.buyingItem.sku[__uv.$wrap((0))]);
            return;
        } else {
            extern.api_buy(this.equip.buyingItem, this.boughtItemSuccess, this.boughtItemFailed);
        }
        BAWK.play('ui_playconfirm');
    },

    onBuyItemClose() {
        if (this.equip.chwRewardBuyItem) this.equip.chwRewardBuyItem = false;
    },

    boughtItemSuccess: function () {
        this.equip.selectedItem = this.equip.buyingItem;
        ga('send', 'event', {
            eventCategory: this.googleAnalytics.cat.itemShop,
            eventAction: this.googleAnalytics.action.shopItemPopupBuy,
            eventLabel: this.equip.buyingItem.name,
            eventValue: this.equip.selectedItem.price
        });
        var itemType = this.equip.selectedItem.item_type_id;
        if (itemType === ItemType.Primary || itemType === ItemType.Secondary || itemType == ItemType.Grenade || itemType == ItemType.Melee) {
            this.equip.showingWeaponType = itemType;
        }
        else {
            this.equip.showingWeaponType = null;
        }
        this.hideItemForSale();

        this.setup(itemType, this.isOnEquipModeFeatured);

        if (this.isEquipModeShop) {
            this.equip.showUnVaultedItems = [];
            setTimeout(() => this.equip.showUnVaultedItems = extern.getTaggedItems(this.ui.premiumFeaturedTag), 1);
        }
    },

    boughtItemFailed: function () {
        vueApp.showGenericPopup('p_buy_error_title', 'p_buy_error_content', 'ok');
        BAWK.play('ui_reset');
    },

    onRedeemClick: function () {
        this.$refs.redeemCodePopup.code = '';
        this.$refs.redeemCodePopup.toggle();
        BAWK.play('ui_popupopen');
    },

    onRedeemCodeConfirm: function () {
        if (this.equip.redeemCodePopup.code.toUpperCase() === 'D3LL0RKC1R') {
            this.giveStuffPopup.eggOrg = false;
            this.giveStuffPopup.rickroll = true;
            vueApp.showGiveStuffPopup('p_give_stuff_title');
        } else {
            this.giveStuffPopup.rickroll = false;
            this.giveStuffPopup.eggOrg = false;
            extern.api_redeem(this.equip.redeemCodePopup.code, this.redeemCodeSuccess, this.redeemCodeFailed);
        }
        BAWK.play('ui_playconfirm');
    },

    redeemCodeSuccess: function (eggs, items) {
        this.populateItemGridWithType(this.equip.selectedItemType);
        

        this.giveStuffPopup.eggs = eggs;
        this.giveStuffPopup.items = items;
        vueApp.showGiveStuffPopup('p_give_stuff_title', eggs, items);

        let itemString = '';
        this.giveStuffPopup.items.forEach(item => itemString += item.name);

        ga('send', 'event', {
            eventCategory: this.googleAnalytics.cat.redeem,
            eventAction: this.googleAnalytics.action.redeemed,
            eventLabel: `${itemString ? itemString : ''} ${this.giveStuffPopup.eggs ? this.giveStuffPopup.eggs + 'eggs' : ''}`
        });
    },

    redeemCodeFailed: function () {
        vueApp.showGenericPopup('p_redeem_error_title', 'p_redeem_error_content', 'ok');
        BAWK.play('ui_reset');
    },

    onPhysicalUnlockConfirm: function () {
        window.open(this.equip.physicalUnlockPopup.item.item_data.physicalItemStoreURL, '_blank');
    },

    onColorChanged: function (colorIdx) {
        this.equip.colorIdx = colorIdx;
        extern.setShellColor(this.equip.colorIdx);
        BAWK.play('ui_onchange');
    },

    onSwitchToSkinsClicked: function () {
        this.switchTo(this.equipMode.skins, this.equip.selectedItemType);
    },

    getVaultedItemsForGrid(selectFirstItem) {
        this.equip.showUnVaultedItems.splice(0, this.equip.showUnVaultedItems.length)
        this.$nextTick().then(() => {
            this.equip.showUnVaultedItems = extern.getTaggedItems(this.ui.premiumFeaturedTag);
            if (selectFirstItem) {
                this.equip.selectedItem = this.equip.showUnVaultedItems[__uv.$wrap((0))];
            }
        });
    },
    onPhotoboothClick: function () {
        if (extern.inGame) {
            return;
        }
        vueApp.switchToPhotoBoothUi();
        BAWK.play('ui_popupopen');
    },
    openProductBundlePopup(bundle) {
        if (this.equip.bundle.items.length === 0) {
            this.equip.bundle.items.length = 0;
            this.equip.bundle.items = bundle.items;
            this.equip.bundle.owned = bundle.isOwned;
            this.equip.bundle.price = bundle.price;
            this.equip.bundle.img = bundle.img;
            this.equip.bundle.name = bundle.name;
        }

        this.$refs.bundlePopup.toggle();
    },
    onBundlePopupConfirm() {
        if (this.equip.bundle.owned) {
            return this.equipAllItemsInbundle();
        }
        extern.buyProductForMoney(this.equip.bundle.items[__uv.$wrap((0))].sku[__uv.$wrap((0))]);
    },
    onBundlePopupClose() {
        this.equip.bundle.owned = false;
        this.equip.bundle.items.length = 0;
    },

    equipTryPremItemOn(item) {
        BAWK.play('ui_click');
        this.selectItem(item);
        extern.tryEquipItem(item)
    },

    equipAllItemsInbundle() {
        this.equip.bundle.items.forEach(item => {
            this.selectItem(item);
            extern.tryEquipItem(item)
        });
    },

    chwWatchAd() {
        this.$refs.buyItemPopup.toggle();	
        vueApp.chwDoIncentivized();
    }
},

computed: {
    showShop() {
        return this.showScreen === this.screens.equip;
    },

    isOnEquipModeSkins() {
        return this.currentEquipMode === this.equipMode.skins;
    },

    isOnEquipModeFeatured() {
        return this.currentEquipMode === this.equipMode.featured;
    },

    isEquipModeInventory() {
        return this.currentEquipMode === this.equipMode.inventory;
    },

    isEquipModeShop() {
        return this.currentEquipMode === this.equipMode.shop;
    },

    isInShop: function () {
        return (this.isOnEquipModeSkins || this.isOnEquipModeFeatured || this.isEquipModeShop);
    },

    isOnShopInventoryLimited() {
        return (this.isOnEquipModeSkins || this.isEquipModeInventory || this.isOnEquipModeFeatured)
    },

    isOnShopInventory() {
        return (this.isOnEquipModeSkins || this.isEquipModeInventory)
    },

    getGridClass: function () {
        if (this.equip.selectedItemType !== 'tagged') {
            return`item-grid-${getKeyByValue(ItemType, this.equip.selectedItemType).toLowerCase()}`;
        }
    },

    gridCls() {
        return 'box_relative center_h overflow-x-hidden';
    },

    isEggStoreSaleItem() {
        return this.eggStoreItems.some( item => item[__uv.$wrap(('salePrice'))] !== '');
    },
    isBuyingItemPrem() {
        if (!this.equip.buyingItem) {
            return;
        }
        return this.equip.buyingItem.unlock === 'premium';
    },
    showPurchasesUi() {
        return this.showShop && this.isEquipModeShop;
    },
    showShopUi() {
        return this.showShop && (this.isOnEquipModeSkins || this.isOnEquipModeFeatured || this.isEquipModeShop);
    },
    screenCls() {
        return `screen-${getKeyByValue(this.equipMode, this.currentEquipMode)}`;
    },
    isSelectedInUnVaulted() {
        return this.equip.showUnVaultedItems.some(item => item.id === this.equip.selectedItem.id);
    },
    showPriceTag() {
        return this.equip.buyingItem && (this.isOnEquipModeFeatured || this.isOnEquipModeSkins) && this.equip.showingItems.length > 0
    },
    showShopCart(){
        return this.isEquipModeInventory && this.ui.showHomeEquipUi;
    },
    photoBoothBtnTxt() {
        return this.ui.showHomeEquipUi ? this.loc.screen_photo_booth_menu : this.loc.screen_photo_booth_menu_close;
    },
    eggShopSortItems() {
        return this.eggStoreItems.sort((b, a) => {
            if (a.type === 'item' && b.type !== 'item') return 1;
            if (a.type !== 'item' && b.type === 'item') return -1;
            if (a.type === 'bundle' && b.type !== 'bundle') return 1;
            if (a.type !== 'bundle' && b.type === 'bundle') return -1;
            return 0;
        });
    },
    photoBoothBtnUi() {
        return {
            icon: this.ui.showHomeEquipUi ? 'fa-camera' : 'fa-times',
            cls: this.ui.showHomeEquipUi ? 'btn_blue bevel_blue' : 'btn_red bevel_red',
            txt: this.ui.showHomeEquipUi ? this.loc.screen_photo_booth_menu : this.loc.screen_photo_booth_menu_close
        }
    },
    chwButtonTxt() {
        if (this.chw.ready) {
            return 'chw_chance_to_win_item';
        } else {
            return 'chw_wait_msg';
        }
    },

    bundlePopupConfirmTxt() {
        return this.equip.bundle.owned ? this.loc.product_bundles_popup_owned_text : this.loc.p_buy_item_confirm;
    },
},
watch: {
    itemSearchVal(val, old) {
        this.debouncedSearch(val, old);
    },
}
};
</script><script id="game-screen-template" type="text/x-template">
<div :class="pauseScreenStateClass">
    <div class="pause-screen-header grid-auto-flow-column box_absolute display-grid z-index-1">
        <button v-show="game.isPaused" class="ss_button btn_md ss_button btn_green bevel_green btn_tutorial" @click="onTutorialPopupClick">{{ loc.tutorial_title }}</button>
    </div>
    <div ref="canvasWrap"></div>
    <!-- end .pause-screen-header -->

    <div ref="vipWrapper">
        <div id="chickenBadge" ref="chickenBadge" v-show="game.isPaused && isSubscriber && showScreen === screens.game"><img :src="upgradeBadgeUrl"></div>
    </div>

    <div ref="gameUIWrapper">
        <div ref="gameUiInner" class="paused-game-ui z-index-1 centered_x fullwidth" v-show="showScreen === screens.game">
            <div ref="playerListWrapper" class="player-list-wrapper">
                <div ref="playerContainer" class="player__container" v-show="showScreen === screens.game">
                    <div id="playerSlot" class="playerSlot" style="display: none">
                        <div>
                            <span></span> <!-- Name -->
                            <span></span> <!-- Score -->
                        </div>
                        <div style="display: block;"></div> <!-- Icons -->
                    </div>
                    <!-- end .playerSlot -->
                    <div id="playerList"></div>
                </div>
                <!-- end .player__container -->
            </div>
            <!-- end .player_list_wrapper -->

            <!-- Scope -->
            <div id="scopeBorder">
                <div id="maskleft"></div>
                <div id="maskmiddle"></div>
                <div id="maskright"></div>
            </div>

            <!-- Best Streak -->
            <div ref="bestStreakWrapper">
                <div ref="bestStreak" id="best_streak_container"> 
                    <h1 v-show="(((doubleEggWeekend || doubleEggWeekendSoon) && !ui.showCornerButtons) || (!doubleEggWeekend && !doubleEggWeekendSoon))" id="bestStreak">x0</h1>
                </div>
            </div>

            <div v-show="announcementMessage" id="announcement_message">{{ announcementMessage }}</div>

            <div id="shellStreakContainer">
                <h1 id="shellStreakCaption"></h1>
                <h1 id="shellStreakMessage" class="disappear"></h1>
            </div>

            <!-- Team Scores -->
            <div id="teamScores">
                <div id="teamScore2" class="teamScore red inactive">
                        <div id="teamScoreNum2" class="number">0</div>
                        <div class="teamLetter red" style="color: #f00;">R</div>
                </div>
                <div id="teamScore1" class="teamScore blue inactive">
                        <div id="teamScoreNum1" class="number">0</div>
                        <div class="teamLetter blue" style="color: #0af;">B</div>
                </div>
                <!--<div>
                        <img src="img/spatulaIcon.png" style="width: 3em; transform: rotate(60deg)">
                </div>-->
            </div>

            <!-- Capture Icon -->
            <div ref="captureIconWrap" id="captureIconWrap">
                <div ref="captureIconContainer" id="captureIconContainer">
                    <div id="captureInsideContainer">
                        <div id="captureIconCaption">20M</div>
                        <div id="captureRingBackground"></div>
                        <div id="captureRingContainer">
                            <div id="captureRing"></div>
                        </div>
    
                        <svg id="captureIcon" viewBox="0 0 53.6 36">
                            <use href="img/kotc/crown.svg#crown" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Reticle -->
            <div id="reticleDot"></div>
            <div id="reticleContainer">
                <div id="redDotReticle"></div>
                
                <div id="crosshairContainer">
                    <div id="crosshair0" class="crosshair normal"></div>
                    <div id="crosshair1" class="crosshair normal"></div>
                    <div id="crosshair2" class="crosshair normal"></div>
                    <div id="crosshair3" class="crosshair normal"></div>
                </div>

                <div id="shotReticleContainer">
                    <div id="shotBracket0" class="shotReticle border normal"></div>
                    <div id="shotBracket1" class="shotReticle border normal"></div>
                    <div id="shotBracket2" class="shotReticle fill normal"></div>
                    <div id="shotBracket3" class="shotReticle fill normal"></div>
                </div>

                <div id="readyBrackets">
                    <div class="readyBracket"></div>
                    <div class="readyBracket"></div>
                    <div class="readyBracket"></div>
                    <div class="readyBracket"></div>
                </div>
            </div>

            <!-- Capture Zone progress -->
            <div id="captureContainer">
                <div class="captureScoreContainer">
                    <svg class="captureCrown" viewBox="0 0 53.6 36">
                        <use href="img/kotc/crown.svg#crown" fill="var(--ss-team-red-light)" />
                    </svg>

                    <div id="captureScoreRed" class="captureScore">0/5</div>
                </div>

                <div id="captureCenter">
                    <div id="captureBarContainer">
                        <div id="captureBar"></div>
                    </div>
                    <div id="captureBarText"></div>
                </div>

                <div class="captureScoreContainer">
                    <svg class="captureCrown" viewBox="0 0 53.6 36">
                        <use href="img/kotc/crown.svg#crown" fill="var(--ss-team-blue-light)" />
                    </svg>
                    <div id="captureScoreBlue" class="captureScore">0/5</div>
                </div>
            </div>

            <!-- Big Message Bar -->
            <div id="bigMessageContainer" style="display: none">
                <div id="bigMessageBar"> 
                    <div id="bigMessage"></div>
                    <div id="bigMessageCaption"></div>
                </div>
            </div>

            <!-- Weapon -->
            <div id="weaponBox">
                <div id="grenades">
                    <img id="grenade3" class="grenade" src="img/ico_grenadeEmpty.png?v=1"/>
                    <img id="grenade2" class="grenade" src="img/ico_grenadeEmpty.png?v=1"/>
                    <img id="grenade1" class="grenade" src="img/ico_grenadeEmpty.png?v=1"/>
                </div>
                <h2 id="weaponName"></h2>
                <h2 id="ammo" class="shadow_grey"></h2>
            </div>

            <!-- Health -->
            <div id="healthContainer" v-show="!game.isPaused && !ui.game.spectate">
                <svg class="healthSvg">
                    <circle id="healthBar" class="healthBar" cx="50%" cy="50%" r="2.15em" />
                    <circle class="healthYolk" cx="50%" cy="50%" r="1.35em" />
                </svg>

                <div id="healthHp">100</div>
            </div>

            <!-- Hard Boiled -->
            <div id="hardBoiledContainer">
                <div id="hardBoiledShieldContainer">
                    <img class="hardBoiledShield" src="img/hardBoiledEmpty.png">
                    <img class="hardBoiledShield" id="hardBoiledShieldFill" src="img/hardBoiledFilled.png">
                </div>

                <div id="hardBoiledValue">100</div>
            </div>

            <!-- EggBreaker Shellstreak -->
            <div id="eggBreakerContainer" class="off">
                <img id="eggBreakerIcon" src="img/ico_eggBreaker.png" />
                <div id="eggBreakerTimer">15</div>
            </div>

            <!-- Spatula -->
            <img id="spatulaPlayer" src="img/spatulaIcon.png" />

            <!-- Grenade throw power -->
            <div id="grenadeThrowContainer">
                <div id="grenadeThrow"></div>
            </div>

            <!-- Kill -->
            <div id="killBox" class="shadow_grey">
                <!-- <h3>{{ loc.ui_game_youkilled }}</h3> -->
                <div v-html="killedMessage"></div>
                <!-- <h2 id="KILLED_NAME"></h2> -->
                <h3 id="KILL_STREAK"></h3>
            </div>

            <!-- Death -->
            <div id="deathBox">
                <div v-html="killedByMessage"></div>
            </div>

            <!-- Game messages -->
            <div id="gameMessage"></div>

            <!-- Kill ticker -->
            <div ref="killTickerWrapper">
                <div ref="killTicker" id="killTicker" class="chat"></div>
            </div>

            <!-- Spectator controls -->
            <div id="spectate">
                <div class="h4 margins_sm">{{ loc.ui_game_spectating }}</div>

                <div v-if="ui.game.spectatingPlayerName">
                    <div class="h1 margins_sm">{{ ui.game.spectatingPlayerName }}</div>
                    <div>
                        <span class="fas fa-arrow-up"></span>
                        &nbsp;/&nbsp;
                        <span class="fas fa-arrow-down"></span>
                        &nbsp;{{ loc.ui_game_spectate_select }}
                    </div>
                </div>

                <div>{{ spectateControls }}</div>
            </div>

            <div ref="spectateWrap" class="spectate-wrapper">
                <button ref="spectateBtn" v-show="!isRespawning && game.isPaused && showScreen === screens.game && delayTheCracking" @click="onSpectateClicked()" class="ss_button btn_blue bevel_blue btn_sm pause-screen-btn-spectate" :disabled="isRespawning" :title="loc.p_pause_spectate">
                    <i class="fas fa-eye fa-2x"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- ref gameUIWrapper -->
    
    <div ref="chatWrapper" :class="{'chat-hidden': !chatEnabled}" class="chat-wrapper pause-ui-element box_absolute roundme_lg">
        <div v-show="!chatEnabled" class="paddings_md">
            <h4 class="text_white nospace">{{ loc.ingame_chat_hidden }}</h4>
            <p @click="onSettingsClicked(true)" class="nospace text_white">{{ loc.ingame_chat_open_settings }}</p>
        </div>
        <div ref="chatContainer" v-show="chatEnabled" class="chat-container">
            <div id="chatOut" class="chat roundme_sm"></div>
            <input id="chatIn" class="chat roundme_sm" maxlength=64 tabindex=-1 v-bind:placeholder="loc.ingame_press_tab_to_exit" onkeydown="extern.onChatKeyDown(event)" onclick="extern.startChat(event)" onblur="extern.stopChat(event)"></input>
        </div>
    </div>
    <!-- Chat -->

    <!-- Ingame UI Stuff --> 
    <div id="inGameUI" class="roundme_lg">
        <div id ="serverAndMapInfo">
            <h5 class="nospace title text-right">{{ loc.map }}</h5>
            <p class="name">{{ game.mapName }}</p>
            <h5 class="nospace title text-right">{{ loc.server }}</h5>
            <p class="name">{{ serverLoc }}</p>
        </div>
        <div id="readouts">
           <h5 class="nospace title">{{ loc.ui_game_fps }}</h5>
            <p id="FPS" class="name"></p>
            <h5 class="nospace title">{{ loc.ui_game_ping }}</h5>
            <p id="ping" class="name"></p>
        </div>
    </div>

    <!-- Popup: Mute/Boot Player -->
    <small-popup id="playerActionsPopup" ref="playerActionsPopup" @popup-cancel="onPlayerActionsCancel" @popup-closed="onPlayerActionsCancel" :hide-confirm="true" @popup-opened="sharedPopupOpened" @popup-closed="sharedPopupClosed">
        <template slot="header">{{ playerActionsPopup.playerName }}</template>
        <template slot="content">
            <div v-if="playerActionsPopup.vipMember" class="vip-member-wraper display-grid align-items-center grid-column-1-2 ss_marginbottom_xl">
                <figure class="player-action-vip-img center_h">
                    <img src="img/vip-club/vip-club-popup-emblem.png" alt="Vip member icon" class="center_h">
                </figure>
                <div>
                    <h6 class="roundme_sm shadow_blue4 ss_margintop ss_marginbottom">{{loc.ui_game_playeractions_vip_member}}</h6>
                    <button v-if="!isSubscriber" class="ss_button btn_pink bevel_pink fullwidth" @click="openVipPopup">{{loc.ui_game_playeractions_join_vip}}</button>
                </div>
            </div>
            <!-- .vip-member-wraper -->
            <p>{{ loc.ui_game_playeractions_header }}</p>
            <button v-if="playerActionsPopup.social" class="ss_button btn_medium btn_yolk bevel_yolk fullwidth" @click="onClickCreator(playerActionsPopup.social.url)"><i class="fab" :class="playerSocial"></i> {{loc.ui_game_playeractions_creator}}</button>
            <h4 class="ss_button btn_medium btn_blue bevel_blue" v-on:click="onMuteClicked">{{ muteButtonLabel }}</h4>
            <h4 class="ss_button btn_medium btn_red bevel_red" v-on:click="onReportActionClicked">{{ loc.ui_game_playeractions_report }}</h4>
            <h4 class="ss_button btn_medium btn_yolk bevel_yolk" v-if="extern.isGameOwner" v-on:click="onBootClicked">{{ loc.ui_game_playeractions_boot }}</h4>
            <h4 class="ss_button btn_medium btn_pink bevel_pink" v-if="extern.adminRoles & 4" v-on:click="onBanActionClicked">{{ loc.ui_game_playeractions_ban }}</h4>
            <h4 class="ss_button btn_medium btn_green bevel_green" v-if="extern.adminRoles & 64" v-on:click="onInfoClicked">Info</h4>
        </template>
        <template slot="cancel">{{ loc.cancel }}</template>
    </small-popup>

    <!-- Popup: Ban Player -->
    <small-popup id="banPlayerPopup" ref="banPlayerPopup" :hide-confirm="true" @popup-opened="sharedPopupOpened" @popup-closed="sharedPopupClosed">
        <template slot="header">Ban Player</template>
        <template slot="content">
            <h5 class="text_yellow">{{ playerActionsPopup.playerName }}</h5>
            <input ref="banReason" type="text" placeholder="Reason" class="ss_field ss_margintop ss_marginbottom fullwidth" @focus="$event.target.select()">
            <select ref="banDuration" class="ss_field">
                <option v-for="d in banDurations" v-bind:value="d.value" v-html="d.label"></option>
            </select>
            <h4 class="ss_button btn_medium btn_green bevel_green" v-if="extern.adminRoles & 4" v-on:click="onBanClicked">{{ loc.ui_game_playeractions_ban }}</h4>
        </template>
        <template slot="cancel">{{ loc.cancel }}</template>
    </small-popup>

    <!-- Popup: Report Player -->
    <small-popup id="reportPlayerPopup" ref="reportPlayerPopup" :hide-confirm="true" @popup-opened="sharedPopupOpened" @popup-closed="sharedPopupClosed">
        <template slot="header">{{ loc.report_player_title }}</template>
        <template slot="content">
            <h5 class="text_yellow">{{ playerActionsPopup.playerName }}</h5>
            <p v-for="(r, i) in reportReasons">
                <label class="ss_checkbox label"> {{ loc[r.locKey] }}
                    <input type="checkbox" v-model="reportPlayerPopup.checked[i]">
                    <span class="checkmark"></span>
                </label>
            </p>
            <br>
            <button class="ss_button btn_medium btn_green bevel_green" :disabled="!isReportFilled" v-on:click="onReportClicked">{{ loc.ui_game_playeractions_report }}</button>
        </template>
        <template slot="cancel">{{ loc.cancel }}</template>
    </small-popup>

    <!-- Popup: Switch Team -->
    <small-popup id="switchTeamPopup" ref="switchTeamPopup" @popup-cancel="onSwitchTeamCancel" :overlay-close="false" @popup-closed="onSwitchTeamCancel" @popup-confirm="onSwitchTeamConfirm" @popup-opened="sharedPopupOpened" @popup-closed="sharedPopupClosed">
        <template slot="header">{{ loc.p_switch_team_title }}</template>
        <template slot="content">
            <h4 class="roundme_sm" :class="newTeamColorCss">{{ newTeamName }} <i class="fa fa-flag"></i></h4>
            <p>{{ loc.p_switch_team_text }}</p>
        </template>
        <template slot="cancel">{{ loc.no }}</template>
        <template slot="confirm">{{ loc.yes }}</template>
    </small-popup>

    <!-- Popup: Share Link -->
    <small-popup id="shareLinkPopup" ref="shareLinkPopup" :popup-model="game.shareLinkPopup" @popup-confirm="onShareLinkConfirm" @popup-closed="onShareLinkClosed" @popup-opened="sharedPopupOpened" @popup-closed="sharedPopupClosed">
        <template slot="header">{{ loc.p_sharelink_title }}</template>
        <template slot="content">
            <p>{{ loc.p_sharelink_text }}</p>
            <p><input ref="shareLinkUrl" type="text" class="ss_field ss_margintop ss_marginbottom fullwidth" v-model="game.shareLinkPopup.url" @focus="$event.target.select()" @popup-opened="sharedPopupOpened" @popup-closed="sharedPopupClosed"></p>
        </template>
        <template slot="cancel">{{ loc.close }}</template>
        <template slot="confirm">{{ loc.p_sharelink_copylink }}</template>
    </small-popup>

    <!-- Popup: Pause -->
    <div ref="pausePopupWrap" id="pausePopupWrap">
        <div v-show="game.pauseScreen.showMenu" ref="pausePopup" class="pause-container centered">
            <div class="pause-screen-wrapper" :class="pauseScreenWrapGrid">
                <div ref="pauseContainer" class="pause-popup--container box_relative roundme_lg display-grid gap-1">
                    <div class="pause-ad-wrap display-grid gap-1 center_h align-items-center">
                        <div>
                            <div v-show="!isPoki && firebaseId && game.isPaused" id="chw-progress-wrapper" class="chw-progress-wrapper box_relative pause-screen-ui">
                                <!-- incentivized-mini-game -->
                                <img class="box_aboslute chw-progress-img chw-chick" :src="chwChickSrc">
                                <div class="chw-progress-bar-wrap ss_button btn-account-status box_relative fullwidth" :class="progressBarWrapClass" @click="playIncentivizedAd">
                                    <p class="chw-progress-bar-msg box_aboslute centered nospace text-center chw-msg chw-p-msg text-shadow-black-40">
                                        {{ progressMsg }} <span v-show="!chw.ready && !chw.adBlockDetect"><span v-if="!chw.ready"><span v-show="chw.hours" class="chw-pie-num">{{chw.hours}}:</span><span class="chw-pie-num">{{chw.minutes}}:</span><span class="chw-pie-num">{{chw.seconds}}</span></span> <icon v-show="chwShowVideoIcon" name="ico_watchAd" class="chw-icon-watch-ads"></icon></span>
                                    </p>
                                    <div class="chw-progress-bar-inner" @click="playIncentivizedAd" :class="{'chw-ready' : chw.ready}" :style="{width: chwProgress}">
                                    </div>
                                </div>
                                <img src="img/egg_pack_small.png" class="centered_y chw-egg-bundle">
                            </div>
                            <!-- #chw-progress-wrapper -->
                            <div class="pause-screen-content pause-bg roundme_md box_relative center_h">
                                <section id="btn_horizontal" class="pause-game-weapon-select pause-popup--btn-group">
                                    <header class="weapon-select weapon-select--title">
                                        <h1 class="shadow_bluebig4 ss_marginbottom_lg">{{loc.p_weapon_title}}</h1>
                                    </header>
                                    <weapon-select-panel ref="weaponSelect" id="weapon_select" :loc="loc" :current-class="classIdx" :account-settled="true" :play-clicked="false" @changed-class="pauseWeaponSelect" :current-screen="showScreen" :screens="screens"></weapon-select-panel>
                                </section>
                            </div>
                            <!-- end .pause-screen-content -->
                            <div class="pause-screen-play-btn center_h text-center display-grid grid-auto-flow-column ss_margintop gap-1">
                                <button v-if="delayTheCracking" v-show="isTeamGame" @click="onSwitchTeamClicked" class="ss_button btn_big btn_team_switch btn-respawn" :class="teamColorCss">
                                    <div class="display-grid grid-column-1-2 align-items-center">
                                        <i class="fa fa-flag fa-2x"></i> <div v-html="teamName" class="team-switch-text text-left"></div>
                                    </div>
                                </button>
                                <button v-if="!extern.observingGame" @click="onPlayClicked()" class="ss_button btn_big btn-respawn" :class="playBtnColor" :disabled="isRespawning"><i v-if="delayTheCracking" v-show="!isRespawning" class="fa fa-play"></i>{{ playBtnText }} <span style="display: inline-block; font-size: .4em">{{ playBtnAdBlockerText }}</span></button>
                                <h1 class="text_white" v-if="extern.observingGame">OBSERVING - SPECTATE ONLY</h1>
                            </div>
                        </div>
                        <div v-if="!isSubscriber" class="respawn-container respawn-two" v-show="game.isPaused">
                            <display-ad id="shellshockers_respawn_banner_2_ad" ref="respawnTwoDisplayAd" class="pauseFiller" :ignoreSize="false" :adUnit="displayAd.adUnit.respawnTwo" adSize="300x250"></display-ad>
                        </div>
                        <!-- .respawn-two smaller-->
                    </div>

                    <!-- wrapper -->
                    <div v-if="!isSubscriber" class="respawn-container respawn-one" v-show="game.isPaused">
                        <display-ad id="shellshockers_respawn_banner-new_ad" ref="respawnDisplayAd" class="pauseFiller" :ignoreSize="false" :adUnit="displayAd.adUnit.respawn" adSize="728x90"></display-ad>
                    </div>
                    <!-- .respawn-one -->
                </div>
                <!-- end .pause-popup--container -->
            </div>
            <!-- end .pause-screen-wrapper -->
        </div>
    </div>
</div>
</script>


<script>
var comp_game_screen = {
template: '#game-screen-template',
components: {
    'account-panel': comp_account_panel,
    'weapon-select-panel': comp_weapon_select_panel,
    'weapon-select-panel': comp_weapon_select_panel,
},
props: ['kname', 'kdname'],
data: function () {
    return vueData;
},
created: function () {
    this.isPoki = pokiActive;
},
methods: {
    pauseScreenPlayerListOverflowCheck() {
        if (this.$refs.playerContainer.clientHeight < this.$refs.playerContainer.scrollHeight) {
            this.ui.playerListOverflow = true;
        } else {
            this.ui.playerListOverflow = false;
        }
    },
    windowResize() {
        this.pauseScreenPlayerListOverflowCheck();
        window.addEventListener("resize", this.pauseScreenPlayerListOverflowCheck);
    },
    placeBannerAdTagForGame: function (tagEl) {
        this.$refs.pauseAdPlacement.appendChild(tagEl);
    },
    sharedPopupOpened(id) {
        this.game.openPopupId = id ? id : '';
    },

    sharedPopupClosed(id) {
    },

    showGameMenu: function () {
        vueApp.setDarkOverlay(false);
        this.game.pauseScreen.showMenu = true;
        // this.game.tipIdx = this.loc.tip_ofthe_day
        // ? Math.randomInt(0, this.loc.tip_ofthe_day.length)
        // : 0;

        this.game.gameType = extern.gameType;
        vueApp.showRespawnDisplayAd();
        setTimeout(() => vueApp.disableRespawnButton(false), 500);
        vueData.ui.showCornerButtons = true;
        vueApp.gameUiAddClassForNoScroll();

        addEventListener('gamepadbuttondown', this.onControllerButton);
        this.crazyAdsRespawn();
        vueApp.hideShareLinkPopup();

        this.pauseUi();
        
        vueApp.setPause(true);

        this.ui.game.spectate = false;
    
        setTimeout(() => {
            this.windowResize();
        }, 300);
    },

    delayGameMenuPlayButtons() {
        setTimeout(() => {
            this.delayTheCracking = true;
        }, 3000);
    },

    hideGameMenu: function () {

        if (!extern.inGame)  {
            return;
        }
        this.game.pauseScreen.showMenu = false;
        if (crazyGamesActive) crazysdk.clearAllBanners(); // Per CG's request
        vueApp.gameUiAddClassForNoScroll();

        removeEventListener('gamepadbuttondown', this.onControllerButton);
        removeEventListener('resize', this.pauseScreenPlayerListOverflowCheck);
    },

    onLeaveGameConfirm: function () {
        if (this.showScreen === this.screens.equip) {
            vueApp.onBackClick();
        }
        this.resetUi();
        this.leaveGame();
        this.delayTheCracking = false;
    },

    onLeaveGameCancel: function () {
        this.showGameMenu();
    },

    leaveGame: function () {
        // clientGame.js manipulates chickenBadge element directly to hide/show it
        removeEventListener('resize', this.pauseScreenPlayerListOverflowCheck);
        vueApp.disablePlayButton(false);
        this.$refs.chickenBadge.style.display = 'none';
        document.body.style.overflow = 'visible';
        window.scrollY = 0;
        this.hidePopupsIfGameCloses();
        extern.leaveGame(this.afterLeftGame);
        vueData.ui.showCornerButtons = true;
        // OneSignal elements are not part of the Vue app
        var oneSignalBell = document.getElementById('onesignal-bell-container');
        if (oneSignalBell) {
            oneSignalBell.style.display = 'none';
        }

    },

    hidePopupsIfGameCloses: function() {
        const gamePopups = vueApp.$refs.gameScreen.$children;
        if (Array.isArray(gamePopups)) {
            gamePopups.forEach( gamePopup => {;
                if ( gamePopup.isShowing === true && gamePopup.$el.id !== 'pausePopup' ) {
                    gamePopup.close();
                    console.log(`Closing ${gamePopup.$el.id}`);
                }
            });
        }
    },

    afterLeftGame: function () {
        vueApp.showSpinner();
        setTimeout(() => {
            extern.resize();
            vueApp.hideSpinner();
        }, 200);
        vueApp.showTitleScreenAd();
        vueApp.switchToHomeUi();
    },

    onHelpClicked: function () {
        // this.hideGameMenu();
        vueApp.showHelpPopup();
        BAWK.play('ui_popupopen');
    },

    onShareLinkClicked: function () {
        extern.inviteFriends();
        BAWK.play('ui_popupopen');
    },

    onSettingsClicked: function (openMisc) {
        if (!openMisc) openMisc = false;
        // this.hideGameMenu();
        vueApp.showSettingsPopup();
        BAWK.play('ui_popupopen');
        if (openMisc) vueApp.onSettingsPopupSwitchTabMisc();
    },

    onShareLinkConfirm: function () {
        extern.copyFriendCode(this.$refs.shareLinkUrl);
    },

    onShareLinkClosed: function () {
        if (extern.inGame) {
            vueApp.showRespawnDisplayAd();
        }
        this.showGameMenu();
    },

    onEquipClicked: function () {
        this.game.pauseScreen.wasGameInventoryOpen = true;
        this.game.pauseScreen.classChanged = false;
        this.gaSend('inventory');
        vueApp.openEquipSwitchTo(this.equipMode.inventory);
        BAWK.play('ui_equip');
    },

    onSwitchTeamClicked: function () {
        // this.hideGameMenu();
        BAWK.play('ui_popupopen');
        this.$refs.switchTeamPopup.show();
    },

    onSwitchTeamCancel: function () {
        this.showGameMenu();
    },

    onSwitchTeamConfirm: function () {
        extern.switchTeam();
    },

    onControllerButton: function (e) {
        switch (e.detail) {
            case '9':
                if (document.hasFocus() && !this.isRespawning && this.delayTheCracking) {
                    this.onPlayClicked();
                }
                break;

            case '4':
            case '6':
            case '14':
                vueData.classIdx = Math.max(0, vueData.classIdx - 1);
                this.$refs.weaponSelect.selectClass(vueData.classIdx);
                break;

            case '5':
            case '7':
            case '15':
                vueData.classIdx = Math.min(6, vueData.classIdx + 1);
                this.$refs.weaponSelect.selectClass(vueData.classIdx);
                break;
        }
    },

    gaSendOnClassChange() {
        if (!this.game.pauseScreen.wasGameInventoryOpen && this.game.pauseScreen.classChanged) {
            ga('send', 'event', 'respawn-popup', 'classClick', Object.keys(CharClass).find(key => CharClass[__uv.$wrap((key))] === vueApp.classIdx));
        }

        // reset for good measure
        this.game.pauseScreen.wasGameInventoryOpen = false;
        this.game.pauseScreen.classChanged = false;
    },

    onPlayClicked() {
        if ((!this.delayTheCracking && !this.isRespawning) || (this.delayTheCracking && this.isRespawning) || this.game.disableRespawnButton) {
            return;
        }

        vueApp.disableRespawnButton(true);
        vueData.ui.showCornerButtons = false;
        extern.respawn();
        BAWK.play('ui_playconfirm');
        this.gaSendOnClassChange();
    },

    onSpectateClicked: function () {
        this.gaSend('spectate');
        this.hideGameMenu();
        vueData.ui.showCornerButtons = false;
        extern.enterSpectatorMode();
        this.ui.game.spectate = true;
        BAWK.play('ui_playconfirm');
    },

    showPlayerActionsPopup: function () {
        // this.hideGameMenu();
        this.$refs.playerActionsPopup.show();
    },

    onPlayerActionsCancel: function () {
        this.showGameMenu();
    },

    onMuteClicked: function () {
        this.$refs.playerActionsPopup.hide();
        this.playerActionsPopup.muteFunc();
    },

    onReportActionClicked: function () {
        for (let i = 0; i < this.reportPlayerPopup.checked.length; i++) {
            this.reportPlayerPopup.checked[__uv.$wrap((i))] = false;
        }

        this.$refs.playerActionsPopup.hide();
        this.$refs.reportPlayerPopup.show();
    },

    onReportClicked: function () {
        this.$refs.reportPlayerPopup.hide();

        let reasons = 0;

        for (let i = 0; i < this.reportPlayerPopup.checked.length; i++) {
            if (this.reportPlayerPopup.checked[__uv.$wrap((i))]) {
                reasons |= (1 << i);
            }
        }

        this.playerActionsPopup.reportFunc(reasons);
    },

    onBootClicked: function () {
        this.$refs.playerActionsPopup.hide();
        this.playerActionsPopup.bootFunc();
    },

    onBanActionClicked: function () {
        this.$refs.playerActionsPopup.hide();
        this.$refs.banPlayerPopup.show();
    },

    onBanClicked: function () {
        this.$refs.banPlayerPopup.hide();
        this.playerActionsPopup.banFunc(this.$refs.banReason.value, this.$refs.banDuration.value);
    },

    onInfoClicked: function () {
        this.$refs.playerActionsPopup.hide();
        this.playerActionsPopup.infoFunc();
    },

    resizeBannerAdTagForGame: function() {
        const pauseAdPlacement = document.getElementById('pauseAdPlacement');
        const rect = document.getElementById('pausePopup').getBoundingClientRect();

        pauseAdPlacement.style.__uv$setSource(__uv).__uv$top = (rect.height).toString() + 'px';
    },
    earnInGameReward() {
        // this.hideGameMenu();
        vueApp.setDarkOverlay(true);
        this.pokiRewardReady = false;
         this.isPokiNewRewardTimer = false;
        extern.api_inGameReward(this.inGameRewardSuccessCallback, this.inGameRewardFailedCallback, this.rewardReachedDailyLimits);
        extern.setVolume(0);
    },
    inGameRewardSuccessCallback() {
        extern.pokiRewardedBreak(this.inGameRewardIsGranted, this.inGameRewardFailedCallback);
    },
    inGameRewardIsGranted(rewardValue) {
        console.log('inGameRewardSuccessCallback');
        this.isPokiNewRewardTimer = true;
        vueApp.showGiveStuffPopup('reward_title', rewardValue, '');
        ga('send', 'event', 'Poki', 'Rewarded Video', 'Reward Success', this.pokiRewNum);
        this.pokiRewNum ++;
    },
    inGameRewardFailedCallback() {
        vueApp.showGenericPopup('p_redeem_error_title', 'in_game_reward_try_again', 'ok');
        this.isPokiNewRewardTimer = false;
        ga('send', 'event', 'Poki', 'Rewarded Video', 'Failed');
    },
    rewardReachedDailyLimits() {
        vueApp.showGenericPopup('in_game_reward_title', 'in_game_reward_try_again', 'ok');
        this.isPokiNewRewardTimer = false;
        localStore.setItem('inGameRewardLimitDate',  Date.now());
        extern.setVolume();
        ga('send', 'event', 'Poki', 'Rewarded Video', 'Reached Daily Limit');
    },

    pokiTimers(value, milliseconds) {
        let pokiSetTimer;

        if (value === false) {
            clearTimeout(pokiSetTimer);
            console.log('cancelTimer');
            return;
        }
        pokiSetTimer = setTimeout(() => this.pokiRewardReady = true, milliseconds);
    },

    pauseWeaponSelect() {
        this.game.pauseScreen.wasGameInventoryOpen = false;
        this.game.pauseScreen.classChanged = true;
        vueApp.$refs.equipScreen.onChangedClass();
    },
    songHasChanged() {
        setTimeout(() => this.songChanged = false , 2000);
    },

    // So crazy games requires an array for multiple display ad calls on the same screen
    crazyAdsRespawn() {
        if (!crazyGamesActive && !testCrazy) return;

        // Removing delay per CG's request. Refresh rate is restricted server-side
        /*if (this.cGrespawnBannerTimeout) return;
        this.cGrespawnBannerTimeout = setTimeout(() => {
            clearTimeout(this.cGrespawnBannerTimeout);
            this.cGrespawnBannerTimeout = null;
        }, 20000);*/

        this.cGrespawnBannerErrors = 0;

        crazysdk.requestBanner([{
                containerId: 'shellshockers_respawn_banner-new_ad',
                size: '728x90',
            },{
                containerId: 'shellshockers_respawn_banner_2_ad',
                size: '300x250',
            }]);
    },

    onClickCreator(url) {
        window.open(url, )
    },

    openVipPopup() {
        this.$refs.playerActionsPopup.hide();
        vueApp.showSubStorePopup();
    },
    gaSend(label) {
        if (!label) return;
        ga('send', 'event', 'respawn-popup', 'click', label);
    },
    playIncentivizedAd(e) {
        if (!this.chw.ready || this.chw.onClick || this.isChicknWinnerError || this.chw.adBlockDetect) {
            e.preventDefault();
            return;
        }
        vueApp.hideGameMenu();
        vueApp.disableRespawnButton(true);
        vueApp.chwOnClick(true);
        vueApp.loadNuggetVideo();
        ga('send', 'event', 'Chickn Winner', 'Free eggs btn', 'click-in-game');

    },
    onEggShopClicked() {
        vueApp.openEquipSwitchTo(this.equipMode.shop);
    },
    onFullscreenClicked() {
        extern.toggleFullscreen();
    },
    pauseUi() {
        vueApp.$refs.gameCanvas.appendChild(this.$refs.gameUiInner);
        vueApp.$refs.gameCanvas.appendChild(this.$refs.pausePopup);
    },
    resetUi() {
        this.$refs.pausePopupWrap.appendChild(this.$refs.pausePopup);
        this.$refs.gameUIWrapper.appendChild(this.$refs.gameUiInner);
    },
    onTutorialPopupClick() {
        this.gaSend('tutorial');
        vueApp.onTutorialPopupClick();
    },
},

computed: {
    isRespawning: function () {
        return this.game.respawnTime > 0;
    },

    isTeamGame: function () {
        // Would be better to use the same enum as the client game code
        return this.game.gameType !== 0;
    },

    teamColorCss: function () {
        return this.game.team === this.ui.team.blue ? 'blueTeam btn_red bevel_red' : 'redTeam btn_blue bevel_blue';
    },

    teamName: function () {
        return this.game.team === this.ui.team.blue ? this.loc.p_pause_joinred : this.loc.p_pause_joinblue;
    },

    newTeamColorCss: function () {
        return this.game.team === this.ui.team.blue ? 'redTeam btn_red' : 'blueTeam btn_blue';
    },

    newTeamName: function () {
        return this.game.team === this.ui.team.blue ? this.loc.team_red : this.loc.team_blue;
    },

    muteButtonLabel: function () {
        return this.playerActionsPopup.muted ? this.loc.ui_game_playeractions_unmute : this.loc.ui_game_playeractions_mute;
    },
    showIngameWidget() {
        if (!this.game.isPaused && this.songChanged) {
            this.songHasChanged();
            return true;
        }
        return false;
    },
    showMusicWidget() {
        return this.showScreen === 2;
    },
    isEggStoreSaleItem() {
        return this.eggStoreItems.some( item => item[__uv.$wrap(('salePrice'))] !== '' && this.ui.showCornerButtons);
    },
    upgradeBadgeUrl() {
        return 'img/vip-club/vip-club-popup-emblem.png';
    },
    playerSocial() {
        return SOCIALMEDIA[__uv.$wrap((this.playerActionsPopup.social.id))];
    },
    chwShowVideoIcon() {
        return this.chw.winnerCounter > 0 && !this.chw.limitReached && this.chw.ready;
    },
    progressMsg() {
        if (this.chw.adBlockDetect) {
            return 'Please turn off ad blocker';
        }
        if (this.isChicknWinnerError) {
            return this.loc.chw_error_text;
        }
        if (this.chw.ready && !this.chw.limitReached) {
            if (this.chw.winnerCounter > 0) {
                return this.loc.chw_cooldown_msg;
            } else {
                return this.loc.chw_ready_msg;
            }
        } else if (!this.chw.ready && !this.chw.limitReached) {
            return this.loc.chw_time_until;
        } else if ((this.chw.ready || !this.chw.ready) && this.chw.limitReached) {
            return this.loc.chw_daily_limit_msg;
        }
    },
    progressBarWrapClass() {
        if (this.isChicknWinnerError) {
            return 'chw-progress-bar-wrap-error';
        }

        if (this.chw.ready && !this.chw.limitReached) {
            return 'chw-progress-bar-wrap-complete';
        }
    },
    playAdText() {
        return vueApp.getChwPlayAdText();
    },
    chwShowCountdown() {
        if (this.chw.limitReached || this.isChicknWinnerError) {
            return 'hideme';
        } else {
            if (this.chw.ready) {
                return 'hideme';
            } else {
                return 'display-inline';
            }
        }
    },
    chwChickSrc() {
        if (this.chw.limitReached || this.isChicknWinnerError) {
            return 'img/chicken-nugget/chickLoop_daily_limit.svg';
        } else {
            if (!this.chw.ready) {
                return 'img/chicken-nugget/chickLoop_sleep.svg';
            } else {
                return 'img/chicken-nugget/chickLoop_speak.svg';
            }
        }
    },

    playBtnColor() {
        if (!this.delayTheCracking && !this.isRespawning || this.delayTheCracking && this.isRespawning) {
            return 'btn_red bevel_red';
        } else {
            return 'ss_button btn_green bevel_green';
        }
    },

    playBtnText() {
        if (!this.delayTheCracking && !this.isRespawning) {
            return this.loc.ui_game_get_ready;
        } else if (this.delayTheCracking && this.isRespawning) {
            if (this.game.respawnTime > 5) {
                return this.game.respawnTime - 5;
            } else {
                return this.game.respawnTime
            }
        } else {
            return this.loc.p_pause_play;
        }
    },

    playBtnAdBlockerText() {
        if (this.delayTheCracking && this.isRespawning && extern.adBlocker && this.game.respawnTime <= 5 && !extern.productBlockAds && !this.isPoki) {
            return 'Ad block delay!';
        }
    },
    classGameType() {
        if (this.game.gameType === 0) {
            return 'pause-screen-free-for-all'
        }
    },
    pauseScreenWrapGrid() {
        if (!this.isSubscriber) {
            return 'pause-screen-wrapper-no-vip';
        } else {
            return 'pause-screen-wrapper-is-vip'
        }
    },
    pauseScreenStateClass() {
        if (this.game.isPaused) {
            return `is-paused ${this.game.openPopupId}`
        }
    },
    chatEnabled() {
        return this.settingsUi.togglers.misc[__uv.$wrap((this.settingsUi.togglers.misc.findIndex(item => item.id === "enableChat")))].value
    },
    chwProgress() {
        return this.chw.progress + '%';
    },
    isReportFilled () {
        return this.reportPlayerPopup.checked.some(checked => checked === true);
    },
    serverLoc() {
        return this.loc[__uv.$wrap(('server_' + this.currentRegionId))];
    },
    spectateControls () {
        let key = this.settingsUi.controls.keyboard.spectate[__uv.$wrap((this.settingsUi.controls.keyboard.spectate.findIndex(item => item.id === "toggle_freecam")))].value;
        return this.loc[__uv.$wrap(('ui_game_spectate_controls'))].format(key);
    }
},

watch: {
    isPokiGameLoad(value) {
        this.pokiTimers(value, this.videoRewardTimers.initial);
        // this.pokiTimers(value, 300);
    },
    isPokiNewRewardTimer(value) {
        this.pokiTimers(value, this.videoRewardTimers.primary);
        // this.pokiTimers(value, 300);
    },
    kname(val) {
        this.killedByMessage = this.loc[__uv.$wrap(('ui_game_killedby'))].format(val);
    },
    kdname(val) {
        this.killedMessage = this.loc[__uv.$wrap(('ui_game_youkilled'))].format(val);
    },
}

};
</script>
<script id="photoBooth-screen-template" type="text/x-template">
<div data-html2canvas-ignore>
    <div class="box_relative margins_lg screens-menu" :class="{'phb-active-bg' : bgIdx}">
        <div v-show="uiActive">
            <h3 class="pb-title text-center text_white display-grid grid-auto-flow-column justify-content-center gap-sm text-shadow-black-40"><img class="pb-title-img" src="img/photo-booth/ico_shelfieStars.svg" />Shellfie<br /> Booth <img class="pb-title-img pb-title-img-flip"src="img/photo-booth/ico_shelfieStars.svg" /></h3>
            <section id="photoBooth-map" class="ss_marginbottom photo-booth-map-section">
                <ss-button-dropdown class="btn-1 fullwidth" :loc="loc" :loc-txt="mapTxt" :list-items="bgData" :selected-item="bgIdx" menuPos="right" @onListItemClick="onChangeMap"></ss-button-dropdown>
            </section>
            <section id="photoBooth-egg-sizes" class="ss_marginbottom">
                <ss-button-dropdown class="btn-1 fullwidth" :loc="loc" :loc-txt="eggSizeTxt" :list-items="egg.sizes" :selected-item="eggSize" menuPos="right" @onListItemClick="onChangeEggSize" :loc-list="true"></ss-button-dropdown>
            </section>
            <!-- <section id="photoBooth-vignette" class="ph-egg-hide pb-vignette-setting btn_big common-box-shadow btn_game_mode bg_blue6 text-left border-blue5 ss_marginbottom display-grid align-items-center">
                <h3 class="ss-dropdown-select text_blue3 display-grid grid-column-2-1 fullwidth align-items-center">{{ loc.screen_photo_booth_vignette }} Vignette<label class="ss_checkbox label justify-self-end"> <span class="hideme">{{ loc.screen_photo_booth_vignette }}</span> <input type="checkbox" :checked="vignette" @change="onVignetteChange(true)"> <span class="checkmark"></span></label></h3>
            </section> -->
            <section id="photoBooth-egg-hide-item" class="ph-egg-hide btn_big common-box-shadow btn_game_mode bg_blue6 text-left border-blue5 ss_marginbottom">
                <h3 class="ss-dropdown-select text_blue3">{{ loc.screen_photo_booth_show_hide }}</h3>
                <div class="display-grid grid-column-3-eq justify-items-center align-items-center center_h">
                    <button v-for="(item, idx) in egg.items" :id="item.id" :key="item.value" class="ico_itemtype clickme roundme_sm f_row align-items-center" @click="hideEggItem(item.value, idx)" :class="{'selected' : !item.hidden}">
                        <svg>
                            <use :xlink:href="item.icon"></use>
                        </svg>
                    </button>
                </div>
            </section>
            <section id="photoBooth-instructions" class="ph-egg-hide btn_big common-box-shadow btn_game_mode bg_blue6 text-left border-blue5 ss_marginbottom">
                <h3 class="ss-dropdown-select text_blue3">{{ loc.screen_photo_booth_instructions }}</h3>
                <ul class="font-nunito text_blue5">
                    <li><strong>{{ loc.screen_photo_booth_point_one }}</strong></li>
                    <li><strong>{{ loc.screen_photo_booth_point_two }}</strong></li>
                </ul>
            </section>
        </div>
        <div class="fullwidth ss_marginbottom display-flex">
            <button class="ss_button btn_yolk bevel_yolk box_relative fullwidth text-uppercase" @click="screenGrabStartProcess"><i class="fas fa-camera"></i> {{ loc.screen_photo_booth_screenshot }}</button>
        </div>
        <div ref="photoBoothDisplayAd" class="hideme f_col align-items-center"></div>
    </div>
    <small-popup id="screenshotPopup" ref="screenshotPopup" @popup-confirm="screenGabDownload">
        <template slot="header">{{ loc.screen_photo_booth_screenshot2 }}</template>
        <template slot="content">
            <div ref="grabImage" class="photo-booth-screen-grab"></div>
        </template>
        <template slot="cancel">{{ loc.close }}</template>
        <template slot="confirm">{{ loc.screen_photo_booth_download }}</template>
    </small-popup>

</div>
</script>


<script>
const CompPhotoboothUi = {
template: '#photoBooth-screen-template',
props: ['loc', 'playerName', 'itemTypeChange'],
data: function () {
    return {
        eggSize: 0,
        bgIdx: 0,
        uiActive: true,
        showBtn : true,
        screenshotImg: '',
        // vignette: false,
        // vignetteUpdated: false,
        egg: {
            sizes: [
                { id: 'egg-size-normal', name: 'screen_photo_booth_size_normal', value: 0 },
                { id: 'egg-size-medium', name: 'screen_photo_booth_size_medium', value: 1 },
                { id: 'egg-size-large', name: 'screen_photo_booth_size_large', value: 2 }
            ],
            items: [
                { id: 'item-type-3', name: 'Primary', value: 3,  hidden: false, icon: ItemIcons.Primary},
                { id: 'item-type-4', name: 'Secondary', value: 4,  hidden: false, icon: ItemIcons.Secondary},
                { id: 'item-type-1', name: 'Hat', value: 1, hidden: false, icon: ItemIcons.Hat},
                { id: 'item-type-2', name: 'Stamp', value: 2,  hidden: false, icon: ItemIcons.Stamp},
                { id: 'item-type-6', name: 'Grenade', value: 6, hidden: false, icon: ItemIcons.Grenade},
                { id: 'item-type-7', name: 'Melee', value: 7,  hidden: false, icon: ItemIcons.Melee}
            ],
        },
        background: {
            map: {
                names: ['none', 'aqueduct', 'backstage', 'bedrock', 'castle', 'castletwo', 'catacombs', 'dirt', 'enchanted', 'exposure', 'jinx', 'mansion', 'quarters', 'rats2', 'scales', 'spacefactory', 'teggtris', 'timetwist', 'wimble'],
            },
            color: {
                none: '',
                colorRed: 'bg_red',
                colorBlue: 'bg_blue3',
                colorGreen: 'bg_green',
            }
        },
    }
},
methods: {
    onChangeEggSize(size) {
        if (size === this.eggSize) return;
        this.eggSize = size;
        extern.photoBooth.eggDollSize(this.eggSize);
        BAWK.play('ui_click');
    },
    onChangeMap(idx) {
        if (idx === this.bgIdx) return;
        this.bgIdx = idx;
        if (this.bgData[__uv.$wrap((this.bgIdx))].bgColor) {
            this.$emit('bg-change-image', this.bgData[__uv.$wrap((0))].url);
            this.$emit('bg-change-color', this.background.color[__uv.$wrap((this.bgData[__uv.$wrap((this.bgIdx))].url))]);
        } else {
            this.$emit('bg-change-color', this.background.color.none);
            this.$emit('bg-change-image', this.bgData[__uv.$wrap((this.bgIdx))].url);
        }
        BAWK.play('ui_click');
    },
    hideEggItem(item, idx, hideAudio) {

        if (this.egg.items[__uv.$wrap((idx))].hidden) {
            this.egg.items[__uv.$wrap((idx))].hidden = false;
            this.$nextTick().then(()=> {
                vueApp.$refs.equipScreen.switchItemType(this.egg.items[__uv.$wrap((idx))].value);
            })

        } else {
            this.egg.items[__uv.$wrap((idx))].hidden = true;
        }

        extern.photoBooth.hideItem(this.egg.items[__uv.$wrap((idx))]);
        if (!hideAudio || hideAudio === undefined) {
            BAWK.play('ui_click');
        }
    },
    onShowOuterUi() {
        this.showOuterUi(this.uiActive ? false : true);
        BAWK.play('ui_click');
    },
    showOuterUi(val) {
        this.uiActive = val;
        this.$emit('hide-ui', this.uiActive);
    },
    open() {
        // this.onVignetteChange();
        // randomize background
        this.onChangeMap(Math.floor(Math.random()*this.background.map.names.length));
    },
    close() {
        // this.vignette = false;
        this.eggSize = 0;
        this.bgIdx = 0;
        this.uiActive = true;
        this.showBtn = true;
        this.screenshotLoaded = false;
        this.egg.items.forEach((el, idx) => this.egg.items[__uv.$wrap((idx))].hidden = false);
        // this.updateVignette(this.vignette);
        this.$emit('bg-change-image', this.background.map.names[__uv.$wrap((this.bgIdx))].url);
        this.$emit('bg-change-color', this.background.color.none);
    },
    screenGrabStartProcess() {
        BAWK.play('ui_click');
        // if (!this.bgIdx) {
        // 	this.updateVignette(false);
        // 	this.vignetteUpdated = true;
        // }
        extern.photoBooth.getScreenshot(!this.bgIdx);

        // this.$nextTick().then(() => {
        // 	extern.photoBooth.getScreenshot(!this.bgIdx);
        // });
    },
    screenGrabDone(canvas) {
        if (!hasValue(canvas)) {
            this.showOuterUi(true);
            return;
        }

        // if (this.vignetteUpdated) {
        // 	this.updateVignette(true);
        // 	this.vignetteUpdated = false;
        // }
    
        if (this.screenshotImg) {
            if (this.$refs.grabImage.hasChildNodes()) {
                this.$refs.grabImage.removeChild(this.$refs.grabImage.children[__uv.$wrap((0))]);
                this.screenshotImg = null;
            }
        }
        this.screenshotImg = new Image();
        this.screenshotImg.src = canvas;
        // this.$refs.grabCanvas.appendChild(canvas);
        this.$refs.grabImage.appendChild(this.screenshotImg);
        this.showOuterUi(true);

        // extern.photoBooth.screenGrab(false, this.$refs.screenshotPopup.show());
        this.$refs.screenshotPopup.show()
        this.gaSendStuff();

    },
    gaSendStuff() {
        let items = extern.getEquippedItems();
        Object.keys(items).forEach((key) => {
            let idx = this.egg.items.findIndex(el => el.value === Number(key));
            ga('send', 'event', 'photo-booth', getKeyByValue(ItemType, Number(key)), !hasValue(items[__uv.$wrap((key))]) || this.egg.items[__uv.$wrap((idx))].hidden ? 'hidden' : `${items[__uv.$wrap((key))].name}` );
        });
        ga('send', 'event', 'photo-booth', 'background', this.bgData[__uv.$wrap((this.bgIdx))].url);
    },
    screenGrabStart() {
        extern.photoBooth.screenGrabRequested = true;
        extern.photoBooth.screenGrab();
    },
    screenGabDownload() {
        if (this.screenshotImg) {
            this.screenshotImg.crossOrigin = 'anonymous';
            const link = document.createElement('a');
            link.download = `Shellshock-io-${this.playerName}.png`;

            link.href = this.screenshotImg.src;
            link.click();
            ga('send', 'event', 'photo-booth', 'click', 'download');

        }
    },
    updateTypeVisibility(val) {
        let idx = this.egg.items.findIndex(el => el.value === val);
        if (this.egg.items[__uv.$wrap((idx))].hidden) this.egg.items[__uv.$wrap((idx))].hidden = false;
    },
    // updateVignette(val) {
    // 	this.vignette = val;
    // 	this.$emit('vignette-change', val);
    // },
    // onVignetteChange(playSound) {
    // 	if (this.vignette) {
    // 		this.vignette = false;
    // 	} else {
    // 		this.vignette = true;
    // 	}
    // 	if (playSound) BAWK.play('ui_onchange');
    // 	this.updateVignette(this.vignette);
    // },
},
computed: {
    eggSizeTxt() {
        return {
            title: this.loc.screen_photo_booth_size_title,
            subTitle: this.loc[__uv.$wrap((this.egg.sizes[__uv.$wrap((this.eggSize))].name))],
        }
    },
    mapTxt() {
        return {
            title: this.loc.screen_photo_booth_background,
            subTitle: this.bgData[__uv.$wrap((this.bgIdx))].name,
        }
    },
    uiTxt() {
        return this.uiActive ? this.loc.screen_photo_booth_hide_ui : this.loc.screen_photo_booth_show_ui;
    },
    bgData() {
        const maps = [];
        this.background.map.names.forEach((el, idx) => maps.push({ name: this.loc[__uv.$wrap((`screen_photo_booth_map_${el}`))], value: idx, url: el, bgColor: el.includes('color') ? true : false}));
        return maps;
    }
},
watch: {

}
};
</script>
<script id="vip-club-template" type="text/x-template">
<div class="vip-club fullwidth">

    <div class="vip-club-log-content--outer roundme_sm display-grid align-items-center grid-column-1-2 grid-gap-space-lg">
        <header class="grid-span-2-start-1">
            <!-- <h2><span class="text-orange">V</span>ery <span class="text-orange">I</span>mportant <span class="text-orange">P</span>oultry</h2> -->
            <span class="sr-only">Very Important Poultry</span>
            <img class="vip-club-water-mark display-block center_h" src="img/vip-club/very-important-poultry.png" alt="Very Important Poultry text image">
        </header>
        <div class="vip-club--logo">
            <img src="img/vip-club/vip-club-popup-emblem.png">
        </div>
        <div class="vip-club--content">
            <div class="subs-info">
                <ul>
                    <li>{{loc.p_chicken_goldfeature1}}</li>
                    <li v-html="loc.p_chicken_goldfeature3"></li>
                    <li>{{loc.p_chicken_goldfeature2}}</li>
                    <li>{{loc.s_popup_feature_premium_items}}</li>
                </ul>
                <!-- <p class="more">{{loc.home_media_apply_now}}</p> -->
                <button v-on:click="openVipPopup" class="margins_lg ss_button btn_sm bevel_blue btn_blue">{{loc.faq}}</button>
            </div>
        </div>
    </div>

    <div class="subscription-plans" :class="[hasPlan ? 'display-grid grid-column-1-2 grid-gap-space-lg' : '']">
        <div class="vip-club-items--outer display-grid" :class="[hasPlan ? 'grid-column-1-eq justify-items-center' : 'grid-column-3-eq']">
            <sub-item v-for="sub in subs" :key="sub.sku" :item="sub" :loc="loc" :upgrade-name="upgradeName" :is-subscriber="isSubscriber" :is-upgraded="isUpgraded" :account-set="accountSettled"></sub-item>
        </div>
        <div v-if="hasPlan" class="manage-subscription-wrapper">
            <div v-if="hasPlan" class="plan-details text-center vip-club-log-content--outer roundme_sm">
                <h5>{{loc.sRenewalDate}}:</h5>
                    <p v-if="expireDate" class="plan-expiry">{{ expireDate }}</p>
                    <p class="manage-details" v-html="manageInfo"></p>
                <button class="ss_button btn_manage_sub btn_sm bevel_blue btn_blue" v-on:click="onManageClick">{{loc.sManageBtn}}</button>
            </div>
        </div>
    </div>
</div>
</script>

<template id="comp-sub-item">
<div v-if="isActive" class="vip-item" :class="nameLowerCaseHyphens">
    <div class="vip-item--inner centered">
        <div class="subscription-details">
            <header>
                <h3>{{loc[name]}}</h3>
            </header>
            <p class="price-tag roundme_sm" v-html="priceTag"></p>
            <button v-if="!hasSub" class="ss_button btn_sm btn_blue bevel_blue" v-on:click="subClick">
                {{loc[buyBtnText]}}
            </button>
        </div>
    </div>
    <div v-if="flagText" class="vip-banner" :class="flagText">
        <span>{{loc[flagText]}}</span>
    </div>
    <img aria-hidden="true" :src="img">
</div>
</template>
<script>
const comp_sub_item = {
    template: '#comp-sub-item',
    props: ['loc', 'item', 'upgradeName', 'isUpgraded', 'isSubscriber'],
    data() {
        return {
            isCurrentSub: false,
            hasSub: false,
            hasUpgrade: false,
            locName: '',
        };
    },
    methods: {
        subClick() {

            if (this.$parent.$el.id === 'shell-subscriptions') {
                this.$parent.$parent.hide();
            } else {
                this.$parent.hide();
            }

            BAWK.play('ui_click');

            if (this.hasSub) {
                extern.buyProductForMoney();
            } else {
                extern.buyProductForMoney(this.item.sku, true);
                ga('send', 'event', 'subscriptions', 'click', this.locName);
            }
        }
    },
    computed: {
        nameLowerCaseHyphens() {
            this.locName =  this.item.name.replace(' ', '-').toLowerCase().replace(' ', '-');
            return this.locName;
        },
        name() {
            return `s-${this.locName}-title`;
        },
        img() {
            return `img/vip-club/vip-club-popup-item-${this.locName}-bg.png`;
        },
        priceTag() {
            let price = this.item.salePrice ? this.item.salePrice : this.item.price,
                priceWcents = `${(price / 100).toFixed(2)}`,
                thePrice = priceWcents.split('.');
            return `$${thePrice[__uv.$wrap((0))]}<span class="price-tag--cents">.${thePrice[__uv.$wrap((1))]}</span>`;
        },
        buyBtnText() {
            if (this.isCurrentSub && this.hasUpgrade) {
                return 'sManageBtn';
            }
            return 's_btn_txt_subscribe';
        },
        isActive() {
            if (this.isCurrentSub && this.hasUpgrade) {
                return true
            } else if (this.hasSub && this.hasUpgrade) {
                return false
            } else {
                return true
            };
        },
        flagText() {
            if (this.isCurrentSub && this.hasUpgrade) return 'p_egg_shop_purchased';
            return this.item.flagText;
        }
    },
    watch: {
        upgradeName(val) {
            
        },
        isUpgraded(val) {
            this.hasUpgrade = val;
            this.hasSub = this.isSubscriber && this.hasUpgrade;
            this.isCurrentSub = this.upgradeName === this.item.name && this.hasUpgrade;
        }
    }
};
</script>
<script>
var compVipClubTemplate = {
template: '#vip-club-template',
components: {
    'sub-item': comp_sub_item,
},
data() {
    return vueData;
},
props: ['loc', 'subs'],

methods: {
    onManageClick() {
        if (this.$parent.$el.id === 'shell-subscriptions') {
            this.$parent.$parent.hide();
        } else {
            this.$parent.hide();
        }
        extern.buyProductForMoney();
    },
    openVipPopup() {
        if (this.$parent.$el.id === 'shell-subscriptions') {
            this.$parent.$parent.hide();
        } else {
            this.$parent.hide();
        }
        BAWK.play('ui_click');
        vueApp.showVipPopup();
    }
},
computed: {
    hasPlan() {
        return this.isSubscriber && this.isUpgraded;
    },
    expireDate() {
        if (this.hasPlan) {
            return new Date(extern.account.upgradeExpiryDate).toUTCString();
        }
        return;
    },
    planName() {
        if (this.hasPlan) {
            return 's-' + this.upgradeName.replace(' ', '-').toLowerCase().replace(' ', '-') + '-title';
        }
        return;
    },
    manageInfo() {
        return this.loc.sManageInfo;
    }
}
};
</script><script id="give-stuff-popup" type="text/x-template">
<!-- Popup: Give Stuff -->
<!-- <large-popup id="giveStuffPopup" ref="giveStuffPopup" :popup-model="giveStuffPopup" @popup-closed="onSharedPopupClosed" :class="giveStuffPopup.type"> -->
<large-popup id="giveStuffPopup" ref="giveStuffPopup" :popup-model="giveStuffPopup" :class="giveStuffPopup.type">
    <template slot="content">
        <div id="giveStuffPopup-content" class="giveStuffPopup-content" :class="{'fullwidth' : giveStuffPopup.type === 'twitchDrops'}">
            <div v-if="giveStuffPopup.type === 'vip'" id="give-stuff-icon" class="give-stuff-icon">
                <img src="img/vip-club/vip-club-popup-emblem.png" alt="Shell Shockers VIP">
            </div>

            <h3 v-if="giveStuffPopup.type !== 'twitchDrops'" :class="{'popup-title-vip' : giveStuffPopup.type === 'vip'}" id="popup_title" class="roundme_sm text-center text_white">
                {{ popupTitle }}
            </h3>

            <h2 v-if="giveStuffPopup.type === 'twitchDrops'" id="popup_title" class="roundme_sm text-center title-shadow text-twitch-yellow">
                {{ loc[giveStuffPopup.titleLoc] }}
            </h2>

            <p v-if="giveStuffPopup.type === 'twitchDrops'" class="text-center">{{ loc.give_stuff_twitch_sub_desc }}</p>
            <div v-show="(giveStuffPopup.eggs)" class="f_row">
                <div class="egg-give-stuff">
                    <img src="img/egg_pack_small.png" />
                    <h2>+ <img class="vertical-align-middle width_1" src="img/svg/ico_goldenEgg.svg" />{{giveStuffPopup.eggs}}</h2>
                </div>
            </div>
            <div v-show="giveStuffPopup.rickroll" class="f_row">
                <img src="img/rickroll.gif" style="margin-bottom: 1em; height: 25em;" />
            </div>
            <div v-show="giveStuffPopup.eggOrg" class="f_row">
                <img src="img/egg-org/eggOrg_timeTravel_splash800x600-min.png" style="margin-bottom: 1em;">
            </div>
            <div v-show="(giveStuffPopup.items && giveStuffPopup.items.length > 0)" class="items-container f_row gap-1 " :class="{'popup-items-vip' : giveStuffPopup.type === 'vip'}">
                <item v-for="i in giveStuffPopup.items" :loc="loc" :item="i" :key="i.id" :isSelected="false" :show-item-only="true"></item>
            </div>
            <p v-if="giveStuffPopup.type === 'twitchDrops'"></p>
        </div>
        <footer :class="{'text-center' : giveStuffPopup.type === 'twitchDrops'}">
            <!-- <p v-if="giveStuffPopup.type === 'twitchDrops'" class="text-center">{{ loc.give_stuff_twitch_footer_desc }}</p> -->
            <button class="ss_button width_xs text-center" :class="giveStuffPopup.type === 'twitchDrops' ? 'twitch-btn twitch-btn-purple' : 'btn_green bevel_green'" @click="onGiveStuffComplete">{{ loc.ok }}</button>
            <button v-if="giveStuffPopup.type === 'twitchDrops'"class="ss_button twitch-btn twitch-btn-pink width_xs text-center" @click="onClickTwitchDropsMore">{{ loc.eq_buy_stuff }}</button>
        </footer>

    </template>
    <template slot="confirm">{{ loc.confirm }}</template>
</large-popup>
</script>


<script>
const GIVESTUFFPOPUP = {
template: '#give-stuff-popup',
components: {
    'item': comp_item,
},
props: ['loc', 'giveStuffPopup'],

data: function () {
    return {
        languageCode: this.selectedLanguageCode,
        eggBalance: 0,
        vueData,
    }
},
methods: {
    onGiveStuffComplete: function () {
        this.giveStuffPopup.eggOrg = false;
        this.giveStuffPopup.rickroll = false;
        vueApp.onGiveStuffComplete();
    },
    onClickTwitchDropsMore() {
        window.open(dynamicContentPrefix + 'twitch');
        this.onGiveStuffComplete();
    }
},
computed: {
    popupTitle() {
        if (this.giveStuffPopup.type === 'rew_monsterswin') {
            return this.loc[__uv.$wrap((this.giveStuffPopup.titleLoc))];
        } else {
            return this.loc.reward_title;
        }
    },
}
};
</script>
<script id="notification-content" type="text/x-template">
<!-- Popup: Give Stuff -->
<!-- <large-popup id="giveStuffPopup" ref="giveStuffPopup" :popup-model="giveStuffPopup" @popup-closed="onSharedPopupClosed" :class="giveStuffPopup.type"> -->
<div id="give-stuff-wrap" class="f_row gap-1">
    <div v-for="notify in notification" class="notification-content" :class="typeBg(notify.type)">
        <section>
            <notification-slider v-if="notify.data.items.length > 0" :loc="loc" :items="notify.data.items" :type="notify.type" :ids="notify.data.ids" @open-bundle="openBundle" @close-popup="onClosePopup" @close-item="onItemClosed"></notification-slider>
            <div v-show="(notify.data.eggs) && eggsActive" class="notify-group notify-group-eggs  f_col justify-content-center roundme_lg box_relative" :class="eggPackClass(notify.data.eggs)">
                <button @click="onEggPackClosed" class="popup_close clickme roundme_sm"><i class="fas fa-times text_blue5 fa-2x"></i></button>
                <div class="egg-give-stuff">
                    <header>
                        <h1 class="text-center">{{ rewardTitle }}</h1>
                    </header>
                    <img  src="img/egg_pack_small.png" />
                    <h2><img class="vertical-align-middle width_1 egg-img" src="img/svg/ico_goldenEgg.svg" />{{notify.data.eggs}}</h2>
                    <p class="item-name text-center text_blue5">{{eggName(notify.data.eggs)}}</p>
                    <button v-if="bonus" @click="goToShop" class="ss_button btn_lg btn_green bevel_green f_row align-items-center justify-content-center fullwidth">{{loc.account_creation_popup_button}}</button>
                </div>
            </div>
        </section>	
    </div>
</div>
</script>

<script id="notification-slider" type="text/x-template">
<div v-if="active" class="notify-group notify-group-items f_col justify-content-center roundme_lg box_relative" :class="clsType">
    <button v-if="endOfItems" @click="closeItem" class="popup_close clickme roundme_sm text_blue5"><i class="fas fa-times text_blue5 fa-2x"></i></button>
    <img v-if="isVip" class="vip-emblem centered_x" src="img/vip-club/vip-club-popup-emblem.png">
    <header>
        <h1 class="text-center">{{ title }}</h1>
    </header>
    <item v-for="(i, idx) in items" v-show="idx === notifyIdx" :loc="loc" :item="i" :key="i.id" :isSelected="false" :show-item-only="true" :notify="true"></item>
    <button v-show="!isSingleItem " @click="nextItem" class="ss_button btn_lg btn_green bevel_green f_row align-items-center justify-content-center">{{btnTxt}} <i class="fas fa-caret-right fa-2x" v-show="!endOfItems"></i></button>
</div>
</script>


<script>
const NotifiSlider = {
template: '#notification-slider',
components: {
    'item': comp_item,
},
props: ['loc', 'items', 'type', 'ids'],

data: function () {
    return {
        notifyIdx: 0,
        active: true,
        lastIdx: this.items.length,
        bundleTxt: [
            'Cluck yeah!',
            "Keep em' coming!",
            "There's more?",
            'See bundle',
        ],
        vipTxt: [
            'Ooh... shiny!',
            "Golden",
            "Hallelujah!",
            'Ok',
        ],
    }
},
methods: {
    nextItem() {
        if (this.notifyIdx < this.items.length - 1) {
            this.notifyIdx++;
        } else {
            // equip bundle
            if (this.isBundle) {
                this.$emit('open-bundle');
            }

            this.closeItem();
        }
    },
    closeItem() {
        this.active = false;
        this.$emit('close-item');
    }
},

computed: {
    btnTxt() {
        if (!this.isSingleItem) {
            if (this.isBundle) {
                return this.bundleTxt[__uv.$wrap((this.notifyIdx))];
            } else if (this.isVip) {
                return this.vipTxt[__uv.$wrap((this.notifyIdx))];
            }
        }
    },
    endOfItems() {
        if (this.isSingleItem) {
            return true;
        } else {
            return this.notifyIdx === this.items.length - 1;
        }
    },
    isSingleItem() {
        return this.items.length === 1;
    },
    title() {
        switch (this.type) {
            case 'bundle':
                const product = extern.getProductTitle(this.ids);
                if (product[__uv.$wrap((0))].sku) {
                    return this.loc[__uv.$wrap((`${product[__uv.$wrap((0))].sku}_title`))] + ' Bundle';
                }		
                break;
            case 'item':
                return this.loc.reward_title;
                break;
            case 'subscription':
                return 'Thanks for subscribing!';
                break;
        
            default:
                break;
        }
    },
    isBundle() {
        return this.type === 'bundle';
    },
    isVip() {
        return this.type === 'subscription';
    },
    clsType() {
        return `notify-group-${this.type}`
    }
},
};
</script>

<script>

const notifiInitState = () => {
return {
    eggBalance: 0,
    notifyIdx: 0,
    activeIdxs: 0,
    eggsActive: true
}
}

const NotificationContent = {
template: '#notification-content',
components: {
    'notification-slider': NotifiSlider,
},
props: ['loc', 'notification', 'bonus'],

data: function () {
    return notifiInitState();
},

methods: {
    resetState() {
        Object.assign(this.$data, notifiInitState());
    },
    onItemClosed() {
        if (!this.activeIdxs) {
            this.activeIdxs = this.notification.length;
        }
        this.activeIdxs--;
        if (this.activeIdxs === 0) {
            this.onClosePopup();
        }
    },
    onEggPackClosed() {
        this.eggsActive = false;
        vueApp.ui.bonus.showing = false;
        this.onItemClosed();
    },
    onGiveStuffComplete: function () {
        this.giveStuffPopup.eggOrg = false;
        this.giveStuffPopup.rickroll = false;
        vueApp.onGiveStuffComplete();
    },
    onClickTwitchDropsMore() {
        window.open(dynamicContentPrefix + 'twitch');
        this.onGiveStuffComplete();
    },
    typeBg(type) {
        switch (type) {
            case 'vip':
                return 'bg_blue5';
                break;
            
            case 'purchases':
                return 'bg_blue6';
                break;
        
            default:
                break;
        }
    },
    getProductTitle(data) {
        const product = extern.getProductTitle(data);
        if (product[__uv.$wrap((0))].sku) {
            return this.loc[__uv.$wrap((`${product[__uv.$wrap((0))].sku}_title`))];
        }
    },
    openBundle() {
        this.$emit('open-bundle', this.activeIdxs);
    },
    onClosePopup() {
        this.$emit('close-popup');
    },
    eggPackClass(eggs) {
        const name = extern.getProductTitleByEggVaule(eggs);
        if (name) {
            return name;
        }
    },
    eggName(eggs) {
        const name = extern.getProductTitleByEggVaule(eggs);
        if (name) {
            return this.loc[__uv.$wrap((name + '_title'))] + ' EGGS!';
        }
    },
    goToShop() {
        this.onEggPackClosed();
        vueApp.openEquipSwitchTo(vueData.equipMode.skins);
    }
},
computed: {
    rewardTitle() {
        if (this.bonus) {
            return this.loc.account_creation_popup_title;
        } else {
            this.loc.reward_title;
        }
    },
}
};
</script>


<script>

function startVue(languageCode, locData) {

    vueData.extern = extern;
    vueData.loc = locData;
    
    vueApp = new Vue({
        el: '#app',
        components: {
            'dark-overlay': comp_dark_overlay,
            'light-overlay': comp_light_overlay,
            'spinner-overlay': comp_spinner_overlay,
            'gdpr': comp_gdpr,
            'settings': comp_settings,
            'help': comp_help,
            'vip-help': vip_help,
            'subscription-store': compVipClubTemplate,
            // 'subscription-store': comp_egg_store,
            'item': comp_item,
            'home-screen': comp_home_screen,
            'equip-screen': comp_equip_screen,
            'game-screen': comp_game_screen,
            'gold-chicken-popup': comp_gold_chicken_popup,
            'chicken-nugget-popup': comp_chickn_winner_popup,
            'egg-store-item': comp_store_item,
            'give-stuff-popup': GIVESTUFFPOPUP,
            'main-sidebar': COMPMAINSIDE,
            'account-panel': comp_account_panel,
            'house-ad': CompHouseAd,
            'photo-booth-ui': CompPhotoboothUi,
            'notification-content': NotificationContent,
        },

        data: vueData,

        createdTime: null,
        mountedTime: null,
        fullyRenderedTime: null,
        
        multisizeAdTag: null,

        created () {
            console.log('Vue instance created');
            createdTime = performance.now();
            this.currentLanguageCode = languageCode;
            this.urlParams = parsedUrl.query.open ? parsedUrl.query.open : null;
        },

        mounted () {
            console.log('Vue instance mounted');
            mountedTime = performance.now();
            console.log('create -> mount time (ms): ' + (mountedTime - createdTime));
            this.currentGameType = extern.gameType;

            // Cannot modify data within the mounted hook, so wait until next tick
            this.$nextTick(function () {
                fullyRenderedTime = performance.now();
                console.log('mounted -> fully rendered time (ms): ' + (fullyRenderedTime - mountedTime));
                console.log('created -> fully rendered time (ms): ' + (fullyRenderedTime - createdTime));

                this.ready = true;
                // vueApp.getNuggetTimer();
                
                //this.showSpinner('ui_game_loading', 'ui_game_waitforit');
                // this.histPushState({game: this.screens.home}, 'Shellshockers home', '?home');
                //this.playMusic();
                this.getLocLang();
                extern.continueStartup();
                this.changelog.version = extern.version;
                this.changelog.current = this.changelogContent();
                //this.fetchSponsors();
            });
        },

        methods: {
            getGameElements: function () {
                return {
                    canvas: this.$refs.canvas,
                    canvasWrapper: this.$refs.canvasWrapper,
                }
            },

            playMusic: function () {
                myAudio = new Audio('./sound/theme');
                // Uncomment for looping.
                // myAudio.addEventListener('ended', function() {
                //     this.currentTime = 0;
                //     this.play();
                // }, false);
                myAudio.volume = this.volume;
                myAudio.play();
            },

            changeLanguage: function (languageCode) {
                extern.getLanguageData(languageCode, this.setLocData);
            },

            setLocData: function (languageCode, newLocData) {
                this.currentLanguageCode = getStoredString('languageSelected', null) ? localStore.getItem('languageSelected') : languageCode;
                this.loc = newLocData;
            },

            setPlayerName: function (playerName) {
                this.playerName = playerName.substring(0, 128);
            },

            showSpinner: function (headerLocKey, footerLocKey, showTips) {
                this.$refs.spinnerOverlay.show(headerLocKey, footerLocKey, showTips);
            },

            showSpinnerLoadProgress: function (percent) {
                this.$refs.spinnerOverlay.showSpinnerLoadProgress(percent);
            },

            hideSpinner: function () {
                this.$refs.spinnerOverlay.hide();
            },

            onSettingsPopupOpened: function () {
                this.$refs.settings.captureOriginalSettings();
                this.sharedIngamePopupOpened();
            },

            onSettingsPopupSwitchTabMisc: function () {
                this.$refs.settings.switchTab('misc_button');
            },

            onSettingsX: function () {
                this.$refs.settings.applyOriginalSettings();
                this.$refs.settings.cancelLanguageSelect();
                this.sharedIngamePopupClosed();
            },

            onSettingsQuickSave() {
                this.$refs.settings.quickSave();
            },

            onNoAnonPopupConfirm: function () {
                ga('send', 'event', this.googleAnalytics.cat.playerStats, this.googleAnalytics.action.denyAnonUserPopup, this.googleAnalytics.label.signInClick);
                this.showFirebaseSignIn();
            },

            onSharedPopupClosed: function () {
                // If in-game, show game menu after closing the popup
                this.blackFridayBanner = false;
                if (this.showScreen === this.screens.game && extern.inGame) {
                    this.showGameMenu();
                }
            },

            sharedIngamePopupOpened() {
                if (extern.inGame) this.$refs.gameScreen.sharedPopupOpened();
            },

            sharedIngamePopupClosed() {
                if (extern.inGame) this.$refs.gameScreen.sharedPopupClosed();
            },

            onGiveStuffComplete: function () {
                this.$refs.giveStuffPopup.$refs.giveStuffPopup.hide();
                if (extern.inGame) {
                    this.showGameMenu();
                    if (this.$refs.equipScreen.showScreen === this.$refs.equipScreen.screens.equip) {
                        vueApp.setDarkOverlay(false);
                    }
                }
            },

            onPrivacyOptionsOpened: function () {
                this.showPrivacyPopup();
            },
            /**
             * Creates a generic popup that passes content 3 data options to slots on the genericPopup smallPopup
             * @param titleLockKey mixed - popup header text
             * @param contentLocKey mixed- popup content
             * @param confirmLocKey mixed - popup button text
             */
            showGenericPopup: function (titleLocKey, contentLocKey, confirmLocKey) {
                this.genericMessagePopup.titleLocKey = titleLocKey;
                this.genericMessagePopup.contentLocKey = contentLocKey;
                this.genericMessagePopup.confirmLocKey = confirmLocKey;
                this.hidePausePopupIfGenericPopupOpen();
                this.$refs.genericPopup.show();
            },
            hidePausePopupIfGenericPopupOpen: function() {

                if (!this.$refs.gameScreen.$refs.pausePopup && $refs.gameScreen.$refs.pausePopup.isShowing === false) {
                    return;
                }

                // return this.$refs.gameScreen.$refs.pausePopup.hide();
            },
            showOpenUrlPopup: function (url, titleLocKey, content, confirmLocKey, cancelLocKey) {
                console.log('title: ' + this.loc[__uv.$wrap((titleLocKey))]);
                console.log('confirm: ' + this.loc[__uv.$wrap((confirmLocKey))]);
                console.log('cancel: ' + this.loc[__uv.$wrap((cancelLocKey))]);

                this.openUrlPopup.url = url;
                this.openUrlPopup.titleLocKey = titleLocKey;
                this.openUrlPopup.content = content;
                this.openUrlPopup.confirmLocKey = confirmLocKey;
                this.openUrlPopup.cancelLocKey = cancelLocKey;
                this.$refs.openUrlPopup.show();
            },

            onOpenUrlPopupConfirm: function () {
                extern.openUrlAndGiveReward();
            },

            showUnsupportedPlatformPopup: function (contentLocKey) {
                this.showScreen = -1;
                this.unsupportedPlatformPopup.contentLocKey = contentLocKey;
                this.$refs.unsupportedPlatformPopup.show();
            },

            showMissingFeaturesPopup: function () {
                this.showScreen = -1;
                this.$refs.missingFeaturesPopup.show();
            },

            showFirebaseSignIn: function () {
                this.$refs.homeScreen.showSignIn();
            },

            hideFirebaseSignIn: function () {
                this.$refs.firebaseSignInPopup.hide();
            },

            showCheckEmail: function () {
                this.$refs.homeScreen.$refs.checkEmailPopup.show();
            },

            hideCheckEmail: function () {
                this.$refs.homeScreen.$refs.checkEmailPopup.hide();
            },

            showResendEmail: function () {
                this.$refs.homeScreen.$refs.resendEmailPopup.show();
            },

            hideResendEmail: function () {
                this.$refs.homeScreen.$refs.resendEmailPopup.hide();
            },

            dontShowChwStuff() {
                return (extern.inGame || (this.isChicknWinnerError || !this.chw.ready || this.chw.winnerCounter > 3))
            },

            showChickenPopup: function () {

                if (this.dontShowChwStuff()) {
                    return;
                }

                const show = localStore.getItem('chickenPopupShow'),
                      today = new Date(),
                      dd = String(today.getDate()).padStart(2, '0'),
                      mm = String(today.getMonth() + 1).padStart(2, '0'), //January is 0!
                      yyyy = today.getFullYear(),
                      whole = dd + mm + yyyy;

                if (!show || show !== whole) {
                    this.$refs.goldChickenPopup.show();
                    localStore.setItem('chickenPopupShow', whole);
                }
            },

            hideChickenPopup: function () {
                this.$refs.goldChickenPopup.hide();
                ga('send', 'event', 'Chickn Winner', 'chw-cta-popup', 'click-close-btn' );
            },

            goldChickenPopupOpenChw() {
                this.hideChickenPopup();
                if (this.dontShowChwStuff()) {
                    return;
                }

                ga('send', 'event', 'Chickn Winner', 'chw-cta-popup', 'click-play-btn' );

                this.chwDoIncentivized();
            },

            showHelpPopup: function () {
                if (!extern.inGame) {
                    this.hideGameMenu();
                }
                this.$refs.helpPopup.show();
            },

            showHelpPopupFeedbackWithDelete() {
                this.$refs.help.openFeedbackTabWith(this.feedbackType.delete.id);
                this.showHelpPopup();
            },

            showVipPopup: function () {
                if (!extern.inGame) {
                    this.hideGameMenu();
                }
                BAWK.play('ui_popupopen');
                this.$refs.vipPopup.show();
            },

            showGetMobilePopup() {
                this.$refs.mobileAdPopup.show();
            },

            showAttentionPopup: function () {
                if (!extern.inGame) {
                    this.hideGameMenu();
                }
                this.$refs.anonWarningPopup.show();
            },

            hideHelpPopup: function () {
                this.$refs.helpPopup.hide();
            },

            showSettingsPopup: function () {
                if (!extern.inGame) {
                    this.hideGameMenu();
                }
                this.$refs.settingsPopup.show();
                extern.settingsMenuOpened();
                this.sharedIngamePopupOpened();
            },

            hideSettingsPopup: function () {
                this.$refs.settingsPopup.hide();
            },

        showEggStorePopup: function () {
            this.$nextTick(() => {
                this.hideGameMenu();
                this.$refs.eggStorePopup.show();
                if (this.isSale) {
                    this.blackFridayBanner = true;
                }
                ga('send', 'event', this.googleAnalytics.cat.itemShop, this.googleAnalytics.action.shopItemNeedMoreEggsPopup, this.googleAnalytics.label.getMoreEggs);
            });
        },

        showSubStorePopup: function () {
            this.$nextTick(() => {
                if (!extern.inGame) {
                    this.hideGameMenu();
                }
                this.$refs.subStorePopup.show();
                BAWK.play('ui_popupopen');
                // ga('send', 'event', this.googleAnalytics.cat.itemShop, this.googleAnalytics.action.shopItemNeedMoreEggsPopup, this.googleAnalytics.label.getMoreEggs);
            });
        },

        vipEndedPopup() {
            this.$refs.vipEnded.show();
            BAWK.play('ui_popupopen');
        },

        showPopupEggStoreSingle(sku) {
            if (!sku) {
                console.log('No sku for popup');
                return;
            }
            if (!this.premiumShopItems.some( i => i.sku === sku)) {
                vueApp.showGenericPopup("uh_oh", "p_egg_shop_no_item_desc", "ok");
                return;
            }

            this.eggStorePopupSku = sku;
            this.$refs.popupEggStoreSingle.show();
        },

        hidePopupEggStoreSingle() {
            this.eggStorePopupSku = null;
            this.$refs.popupEggStoreSingle.hide();
        },

        hideEggStorePopup: function () {
            this.$refs.eggStorePopup.hide();
        },

        showChangelogPopup: function () {
            this.$refs.changelogPopup.show();
        },

        showHistoryChangelogPopup() {
            fetch('./changelog/oldChangelog.json', {cache: "no-cache"})
                .then(response => response.json())
                .then(data => {
                    data.forEach(el => this.changelog.current.push(el));
            });

            this.changelog.showHistoryBtn = false;
        },

        hideChangelogPopup: function () {
            this.$refs.changelogPopup.hide();
        },

        photoBoothTypeChange() {
                this.$refs.photoBooth.updateTypeVisibility(this.equip.selectedItemType);
        },

        openPhotoBooth() {
            this.$nextTick().then( () => {
                this.openEquipSwitchTo(this.equipMode.inventory);
                this.$nextTick().then(() => {
                    this.switchToPhotoBoothUi();
                });
            });
        },

        switchToPhotoBoothUi: function () {

            const homeDisplayAd = document.getElementById('shellshockers_titlescreen_wrap');
            const homeDisplayAdChild = homeDisplayAd ? homeDisplayAd.firstElementChild : null;

            this.ui.showHomeEquipUi = this.ui.showHomeEquipUi ? false : true;
            this.$refs.photoBooth.$refs.photoBoothDisplayAd.classList.toggle('hideme', this.ui.showHomeEquipUi);

            if (this.ui.showHomeEquipUi) {
                extern.photoBooth.close();
                if (homeDisplayAd) {
                    homeDisplayAd.appendChild(this.$refs.photoBooth.$refs.photoBoothDisplayAd.firstElementChild);
                }
            } else {
                extern.photoBooth.open();
                if (homeDisplayAdChild) {
                    this.$refs.photoBooth.$refs.photoBoothDisplayAd.appendChild(homeDisplayAdChild);
                    this.showTitleScreenAd();
                }					
            }
            ga('send', 'event', 'photo-booth', 'click', this.ui.showHomeEquipUi ? 'close' : 'open');
            BAWK.play('ui_toggletab');
        },

        onPhotoboothBgColorChange(bgClass) {
            document.getElementById('ss_background').className = bgClass;
        },

        onPhotoBoothBgImageChange(url) {
            document.getElementById('ss_background').style.backgroundImage = (url && url !== 'none') ? `url(img/photo-booth/maps/${url}.jpg)` : '';
        },

        onPhotoBoothHideUi(show) {
            if (!show) {
                this.showScreen = -1;
            } else {
                this.showScreen = this.screens.equip;
            }
        },

        // photoBoothVignetteChange(val) {
        // 	this.ui.photoBooth.vignette = val;
        // },

        screenGrabDone(canvasData) {
            this.$refs.photoBooth.screenGrabDone(canvasData);
        },

        gameUiAddClassForNoScroll() {
            let html = document.getElementsByTagName("html")[__uv.$wrap((0))];
            html.classList.add('noScrollIngame');
        },

        showGiveStuffPopup: function (titleLoc, eggs, items, type, callback) {
            if (this.giveStuffPopup.eggOrg) {
                ga('send', 'event', 'Egg Org', 'Code Cracked', 'redeemed');
            }
            type = type || '';
            this.giveStuffPopup.titleLoc = titleLoc;
            this.giveStuffPopup.eggs = eggs;
            this.giveStuffPopup.items = items;
            this.giveStuffPopup.type = type;
            this.$refs.giveStuffPopup.$refs.giveStuffPopup.show();
            if (callback) callback();
        },

        showPurchasesPopup: function (types, callback) {
            this.$refs.notifiContent.resetState()
            this.ui.notification = types;
            this.$refs.notificationPopup.show();
            if (callback) callback();
        },

        showEggOrgPopup() {
            this.giveStuffPopup.eggOrg = true;
            this.showGiveStuffPopup('p_give_stuff_title');
        },

        showShareLinkPopup: function (url) {
            if (!extern.inGame) {
                this.hideGameMenu();
            }
            this.game.shareLinkPopup.url = url;
            BAWK.play('ui_popupopen');
            this.$refs.gameScreen.$refs.shareLinkPopup.show();
        },

        hideShareLinkPopup() {
            if (!this.$refs.gameScreen.$refs.shareLinkPopup.isShowing) {
                return;
            }
            this.$refs.gameScreen.$refs.shareLinkPopup.hide();
        },

        showJoinPrivateGamePopup: function (code) {
            this.$refs.homeScreen.$refs.playPanel.showJoinPrivateGamePopup(code, true);
        },

        showPrivateGamePopup() {
            this.$refs.homeScreen.$refs.playPanel.$refs.createPrivateGamePopup.toggle();
        },

        showBannedPopup: function (expire) {
            this.bannedPopup.expire = expire;
            //this.ui.notification = types;
            this.$refs.bannedPopup.show();
            //if (callback) callback();
        },


        onBackClick() {
            this.$refs.equipScreen.onBackClick();
        },

        switchToHomeUi: function () {
            this.showScreen = this.screens.home;
            BAWK.play('ui_toggletab');
            vueApp.showTitleScreenAd();
            this.gameUiRemoveClassForNoScroll();
            // extern.chwRadialProgress();
            extern.resetPaperDoll();
        },

        switchToProfileUi: function () {
            this.showScreen = this.screens.profile;
            BAWK.play('ui_toggletab');
            vueApp.showTitleScreenAd();
            // this.histPushState({game: this.screens.home}, 'Shellshockers home', '?home');
            this.gameUiRemoveClassForNoScroll();
        },

        openEquipSwitchTo: function (mode) {
            this.showScreen = this.screens.equip;
            this.$refs.equipScreen.setup();
            this.$refs.equipScreen.switchTo(mode);

            if (extern.inGame) {
                this.hideGameMenu();
                extern.openEquipInGame();
            }
            else {
                vueApp.hideTitleScreenAd();
            }
        },

        switchToGameUi: function () {
            this.showScreen = this.screens.game;
        },

        gameUiAddClassForNoScroll() {
            let html = document.getElementsByTagName("html")[__uv.$wrap((0))];
            html.classList.add('noScrollIngame');
        },

        gameUiRemoveClassForNoScroll() {
            let html = document.getElementsByTagName("html")[__uv.$wrap((0))];
            html.classList.remove('noScrollIngame');
        },

        switchToGameUiQuickPlay () {
            this.showScreen = this.screens.game;
            this.ui.showCornerButtons = false;
            vueApp.hideTitleScreenAd();
            this.gameUiAddClassForNoScroll();
        },

        showGameMenu: function () {
            this.$refs.gameScreen.showGameMenu();
        },

        hideGameMenu: function () {
            this.$refs.gameScreen.hideGameMenu();
        },

        onMiniGameCompleted: function () {
            this.$refs.homeScreen.onMiniGameCompleted();
        },

        setShellColor: function (colorIdx) {
            this.equip.colorIdx = colorIdx;
        },

        setAccountUpgraded: function (upgraded, endDate) {
            this.isUpgraded = upgraded;
            this.equip.extraColorsLocked = !this.isUpgraded;
            this.nugStart = endDate;

        },

        setDarkOverlay: function (visible, overlayClass) {
            this.$refs.darkOverlay.show = visible;
            this.$refs.darkOverlay.overlayClass = overlayClass;
        },

        setLightOverlay: function (visible, overlayClass) {
            this.$refs.lightOverlay.show = visible;
            this.$refs.darkOverlay.overlayClass = overlayClass;
        },

        authCompleted: function () {
            this.accountSettled = true;
            if (vueApp.$refs.firebaseSignInPopup.isShowing) this.hideFirebaseSignIn();

        },

        showItemOnEquipScreen: function (item) {
            this.openEquipSwitchTo();
            this.$refs.equipScreen.autoSelectItem(item);
        },

        showItem: function (item) {
            vueApp.openEquipSwitchTo(this.equipMode.inventory);
            this.$refs.equipScreen.autoSelectItem(item);
        },

        showTaggedItemsOnEquipScreen: function (tag) {
            this.openEquipSwitchTo(this.equipMode.featured);
            this.$refs.equipScreen.showTaggedItems(tag);
        },

        useHouseAdSmall: function (smallHouseAd) {
            this.ui.houseAds.small = smallHouseAd;
        },

        useHouseAdBig: function (bigHouseAd) {
            this.ui.houseAds.big = bigHouseAd;
        },

        denyAnonUser: function () {
            ga('send', 'event', vueApp.googleAnalytics.cat.playerStats, vueApp.googleAnalytics.action.denyAnonUserPopup);
            if (extern.inGame) {
                this.hideGameMenu();
            }
            this.$refs.noAnonPopup.show();
        },

        showGdprNotification: function () {
            this.$refs.gdpr.show();
        },

        showPrivacyPopup: function () {
            this.hideSettingsPopup();
            this.$refs.privacyPopup.show();
        },

        hidePrivacyPopup: function () {
            this.$refs.privacyPopup.hide();
            this.showSettingsPopup();
        },

        ofAgeChanged: function () {
            extern.setOfAge(this.isOfAge);
            BAWK.play('ui_onchange');
        },

        targetedAdsChanged: function () {
            extern.setTargetedAds(this.showTargetedAds);
            BAWK.play('ui_onchange');
        },

        setPrivacySettings: function (ofAge, targetedAds) {
            this.isOfAge = ofAge;
            this.showTargetedAds = targetedAds;
        },

        gameJoined: function (gameType, team) {
            this.game.gameType = gameType;
            this.setTeam(team);
        },

        setTeam: function (team) {
            if (hasValue(team)) {
                this.game.team = team;
            }
        },

        showGoldChickenPopup: function () {
            this.$refs.goldChickenPopup.show();
        },

        hideGoldChickenPopup: function () {
            this.$refs.goldChickenPopup.hide();
        },

        showChicknWinnerPopup: function () {
            this.$refs.chicknWinner.show();
            vueApp.$refs.chickenNugget.showAd();
            this.isBuyNugget = true;
        },

        hideChicknWinnerPopup: function () {
            this.$refs.chicknWinner.hide();
            this.$refs.chickenNugget.onGotWinner();
            console.log('Hide nugget');
        },

        chicknWinnerIsReady() {
            if (this.chw.limitReached) {
                this.chwOnClick(true);
                return;
            }
        },

        chwAdBlockerDetected() {
            this.chw.adBlockDetect = true;
        },

        chicknWinnerError(val) {
            this.isChicknWinnerError = val;
        },

        chicknWinnerDailyLimit() {
            this.chicknWinnerDailyLimitReached = true;
        },

        loadNuggetVideo() {
            if (!extern.inGame) {
                this.hideGameMenu();
            }
            this.chwDoIncentivized();
            BAWK.play('ui_playconfirm');
        },

        chwDoIncentivized() {
            extern.chwTryPlay();
        },

        chwOnClick(val) {
            this.chw.onClick = val;
        },

        chwMiniGameCompleted(val) {
            this.chwMiniGameComplete = val;
            setTimeout(() => vueApp.chwOnClick(false), 500);
        },
        
        onChwPopupClosed() {
            this.$refs.chickenNugget.resetGame();
        },

            placeBannerAdTagForNugget: function (tagEl) {
                this.$refs.chickenNugget.placeBannerAdTag(tagEl);
            },

            useSpecialItemsTag: function (tag) {
                this.equip.specialItemsTag = tag;
                this.equip.showSpecialItems = true;
            },

            disableSpecialItems: function () {
                this.equip.showSpecialItems = false;
            },

            setUiSettings: function (settings) {
                this.settingsUi.settings = settings;
                this.$refs.settings.setSettings(settings);
            },

            leaveGame: function () {
                this.$refs.gameScreen.leaveGame();
            },

            showPlayerActionsPopup: function (slot) {
                if (this.showAdBlockerVideoAd) {
                    return;
                }

                this.playerActionsPopup = slot;
                this.$refs.gameScreen.showPlayerActionsPopup();
            },
            onSignInCancelClicked: function () {
                vueApp.$refs.firebaseSignInPopup.hide();
                BAWK.play('ui_popupclose');
            },
            anonWarningPopupCancel: function() {
                let anonWarnConfrimed = localStore.getItem('anonWarningConfirmed');
                this.urlParamSet = this.urlParams ? true : null;
                this.shellShockUrlParamaterEvents();
                ga('send', 'event', this.googleAnalytics.cat.playerStats, this.googleAnalytics.action.anonymousPopupOpenAuto, this.googleAnalytics.label.understood);
                return anonWarnConfrimed === null && localStore.setItem('anonWarningConfirmed', true);
            },
            anonWarningPopupConfrim() {
                let anonWarnConfrimed = localStore.getItem('anonWarningConfirmed');
                anonWarnConfrimed === null && localStore.setItem('anonWarningConfirmed', true);
                ga('send', 'event', this.googleAnalytics.cat.playerStats, 'Account egg bonus popup', this.googleAnalytics.label.signInClick);
                extern.showSignInDialog();
                this.urlParamSet = false;
                vueApp.$refs.firebaseSignInPopup.show();
            },
            conditionalAnonWarningCall: function() {

                if (!this.isAnonymous) {
                    return;
                }

                // set eggTotal checks
                let lastIdx = localStore.getItem('anonPopupLastIdx');
                const allChecks = [100000, 90000, 80000, 70000, 60000, 50000, 40000, 30000, 20000, 10000, 1000, 100, 0];

                // Need to remove the all the past values so all the checks to run with each screen change
                lastIdx = lastIdx === null ? allChecks.length : lastIdx;
                const checks = allChecks.filter( (i, idx) => lastIdx > idx);

                // set localStore items to match the values in checks
                const localItems = [];
                checks.forEach((i, idx) => localItems.push(`anonPopup${i}`));

                for (let i = 0; i < localItems.length; i++) {
                    if (localStore.getItem(localItems[__uv.$wrap((i))]) === null) {
                        if (this.eggsEarnedBalance >= checks[__uv.$wrap((i))]) {
                            vueApp.showAttentionPopup();
                            ga('send', 'event', this.googleAnalytics.cat.playerStats, 'Account egg bonus popup auto', checks[__uv.$wrap((i))]);
                            localStore.setItem(localItems[__uv.$wrap((i))], true);
                            localStore.setItem('anonPopupLastIdx', i);
                            break;
                        }
                    }
                }
            },
            needMoreEggsPopupCall: function() {
                ga('send', 'event', this.googleAnalytics.cat.itemShop, this.googleAnalytics.action.shopItemNeedMoreEggsPopup);
                this.$refs.needMoreEggsPopup.show();
            },
            /**
             * Not 100 % certain this should live in vue but here it is.
             * Add the ability to use url paramaters to trigger events in the game.
             * e.g. shellshock.io/?open=eggStore&type=Hat&item=1111 will open the spiderman hat item.
             * Called in the extern closure under gameApp.js => afterGameReady()
             */
            shellShockUrlParamaterEvents() {
                // VUE next tick https://vuejs.org/v2/api/#Vue-nextTick
                this.$nextTick( ()=> {
                    this.doSsUlrParams();
                });
            },

            doSsUlrParams() {
                if ( ! this.urlParams) {
                    return;
                }

                console.log(hasValue(this.isAnonymous));

                if (hasValue(this.ui.houseAds.big)) {
                    this.urlParamSet = false;
                    return;
                } else if (this.isAnonymous && ! hasValue(localStore.getItem('anonWarningConfirmed'))) {
                    this.urlParamSet = false;
                    console.log('Almost there!');
                    this.conditionalAnonWarningCall();
                    return;
                }

                console.log('Passed Popup gate');

                switch (this.urlParams) {
                    case 'eggStore' :
                        // Opens the purchase egg store popup
                        this.showEggStorePopup();
                        break;
                    case 'goldenChicken' :
                        // Opens the golden chicken popup
                        vueApp.$refs.goldChickenPopup.show();
                        break;
                    case 'twoTimesTheEggs' :
                        // Opens the chicken nugget video
                            extern.chwTryPlay();
                            BAWK.play('ui_playconfirm');
                        break;
                    case 'itemShop' :
                        // Opens shop options
                        // /?open=itemShop
                        // /?open=itemShop&type=Hat/Stamp/Primary/Secondary/Grenade/Premium/Tagged 
                        // /?open=itemShop&gunClass=Soldier/Soldier/Scrambler/Ranger/Eggsploder/Whipper/Crackshot/TriHard
                        // /?open=itemShop&item=1111 opens hat store and then selects item
                        // /?open=itemShop&item=1111&openBuyNow=1 opens hat store, selects item and then opens items popup
                        this.openEquipSwitchTo(this.equipMode.shop);
                        this.eggStoreUrlParams();
                        break;
                    case 'vipStore' :
                        vueApp.showSubStorePopup();
                        break;
                    case 'redeem' :
                        vueApp.openEquipSwitchTo(this.equipMode.inventory);
                        BAWK.play('ui_popupopen');
                        this.$refs.equipScreen.$refs.redeemCodePopup.show();
                        if ('code' in parsedUrl.query) this.equip.redeemCodePopup.code = parsedUrl.query.code;
                        break;
                    case 'faq' :
                        this.showHelpPopup();
                        break;
                    case 'taggedItems' : 
                        this.openSpecialTagItemsTab();
                        break;
                    case 'privateGame' :
                        this.showPrivateGamePopup();
                        break;
                    case 'kotcInstruction' : 
                        this.showKotcInstrucPopup();
                        break;
                    default:
                        null;
                };
            },
            eggStoreUrlParams() {
                if (parsedUrl.query.hasOwnProperty('item')) {
                    this.urlParamShowItem(parseInt(parsedUrl.query.item), parsedUrl.query.hasOwnProperty('openBuyNow'));
                    return;
                } else if (parsedUrl.query.hasOwnProperty('type')) {
                    this.urlParamShowItemType(parsedUrl.query.type);
                    return;
                } else if (parsedUrl.query.hasOwnProperty('gunClass') && CharClass.hasOwnProperty(parsedUrl.query.gunClass)) {
                    this.urlParamShowClass(parsedUrl.query.gunClass)
                    return;
                }
            },
            urlParamShowItem(itemId, openBuy) {
                let item = extern.catalog.findItemById(itemId);
                if (!item.is_available) {
                    vueApp.showGenericPopup("uh_oh", "no_anon_title", "ok");
                    return;
                }
                this.$nextTick().then(() => {
                    this.$refs.equipScreen.autoSelectItem(item);
                    if (openBuy) {
                        vueApp.$refs.equipScreen.onBuyItemClicked();
                    }
                })
            },
            urlParamShowItemType(type) {
                if (ItemType.hasOwnProperty(type)) {
                    this.$nextTick().then(() => this.equipSwitchTo('item', ItemType[__uv.$wrap((parsedUrl.query.type))]))
                } else if (type === 'Premium' || type === 'Tagged') {
                    this.$nextTick().then(() => this.openEquipSwitchTo(this.equipMode.featured));	
                }
            },
            urlParamShowClass(gClass) {
                if (!CharClass.hasOwnProperty(gClass)) return;
                this.$nextTick().then(() => {
                    this.equipSwitchTo('item', ItemType[__uv.$wrap(('Primary'))])
                    this.$nextTick().then(() => {
                        this.openEquipSwitchTo(this.equipMode.skins);
                        this.$nextTick().then(() => {
                            this.equipSwitchTo('class', CharClass[__uv.$wrap((gClass))])
                        })
                    })
                })
            },
            equipSwitchTo(type, val) {
                switch (type) {
                    case 'item':
                        vueApp.$refs.equipScreen.switchItemType(val);
                        break;
                    case 'class':
                        vueApp.$refs.equipScreen.$refs.weapon_select.selectClass(val);
                        break;
                    default:
                        break;
                }
            },
            openSpecialTagItemsTab() {
                let tag = parsedUrl.query.tag ? parsedUrl.query.tag : null;
                vueApp.showTaggedItemsOnEquipScreen(tag);
            },

            delayInGamePlayButtons() {
                vueApp.$refs.gameScreen.delayGameMenuPlayButtons();
            },
            //Call/hide display ads
            hideRespawnDisplayAd() {
                if (extern.productBlockAds) {
                    return;
                }
                this.$refs.gameScreen.$refs.respawnDisplayAd.hide();
                this.$refs.gameScreen.$refs.respawnTwoDisplayAd.hide();
            },
            showRespawnDisplayAd() {
                if (extern.productBlockAds || this.ui.tutorialPopup.show) {
                    return;
                }
                this.$refs.gameScreen.$refs.respawnDisplayAd.show();
                this.$refs.gameScreen.$refs.respawnTwoDisplayAd.show();
            },
            hideLoadingScreenAd() {
                this.$refs.spinnerOverlay.$refs.loadingScreenDisplayAd.hide()
            },
            showLoadingScreenAd() {
                if (this.ui.tutorialPopup.show) {
                    return;
                }

                this.$refs.spinnerOverlay.$refs.loadingScreenDisplayAd.show();
                // this.histPushState({game: 3}, 'Shellshockers Loading display ad', '?loadingAd=true');
            },
            displayAdEventObject(event) {
                let object = event;
                this.displayAdObject = object.size[__uv.$wrap((0))];
            },
            showTitleScreenAd() {
                if (extern.productBlockAds) {
                    return;
                }
                this.$refs.homeScreen.$refs.titleScreenDisplayAd.show();
            },
            hideTitleScreenAd() {
                if (extern.productBlockAds) {
                    return;
                }
                this.$refs.homeScreen.$refs.titleScreenDisplayAd.hide();
            },
            toggleTitleScreenAd() {
                if (extern.productBlockAds) {
                    return;
                }
                this.$refs.homeScreen.$refs.titleScreenDisplayAd.toggleAd();
            },
            scrollToTop() {
                let position =
                    document.body.scrollTop || document.documentElement.scrollTop,
                    scrollAnimation;
                if (position) {
                    window.scrollBy(0, -Math.max(1, Math.floor(position / 10)));
                    scrollAnimation = setTimeout(this.scrollToTop, 10);
                } else clearTimeout(scrollAnimation);
            },
            externPlayObject(playType, gameType, playerName, mapIdx, joinCode) {
                extern.play({playType, gameType, playerName, mapIdx, joinCode});
            },
            pleaseWaitPopup() {
                vueApp.showGenericPopup("signin_auth_title", "signin_auth_msg");
            },
            isPlayingPoki() {
                this.isPoki = true;
                this.ready = true;
                return;
            },
            histPushState(obj, title, param) {
                return history.pushState(obj, title, param);
            },
            disablePlayButton(val) {
                const playBtns = document.querySelectorAll('.is-for-play');
                playBtns.forEach(btn => btn.disabled = val);
                this.playClicked = val;
                // document.querySelector('.play-button').disabled = val;
            },
            disableRespawnButton(val) {
                this.game.disableRespawn = val;
            },
            disaplyAdEventObject(event) {
                this.displayAdObject = event.size === null ? null : event.size[__uv.$wrap((0))];
            },
            adBlockerPopupToggle() {
                return vueApp.$refs.adBlockerPopup.toggle();
            },
            // musicPlayOnce() {
            //     return setTimeout(() => this.$refs.gameScreen.$refs.gameScreenMusic.playOnce(), 2000);
            // },
            // musicPause() {
            //     this.$refs.gameScreen.$refs.gameScreenMusic.pause();
            // },
            musicVolumeControl(value) {
                return;
                this.settingsUi.adjusters.music[__uv.$wrap((0))].value = Number(value);
                this.$refs.gameScreen.$refs.gameScreenMusic.loadVolume();
            },
            toggleMusic() {
                this.$refs.gameScreen.$refs.gameScreenMusic.toggleMusic();
            },
            musicWidget(val) {
                this.music.isMusic = val;
            },
            fetchSponsors() {
                fetch(this.music.musicJson)
                    .then((response) => response.json())
                    .then((sponsors) => this.music.sponsors = sponsors)
                    .catch((error) => console.log('Sponsors fetch error', error));
            },
            pwaPopup() {
                return this.$refs.pwaPopup.show();
            },
            pwaBtnClick() {
                // Track the click
                ga('send', 'event', 'pwa', 'button', 'click');
                //close popup
                this.$refs.pwaPopup.hide();
                // Get the event
                this.pwaDeferEvent = extern.getPwaEvent;

                if (!this.pwaDeferEvent) {
                    return;
                }
                this.pwaDeferEvent.prompt();

                this.pwaDeferEvent.userChoice
                    .then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the A2HS prompt');
                        } else {
                            console.log('User dismissed the A2HS prompt');
                        }
                        ga('send', 'event', 'pwa', 'a2hs', choiceResult.outcome);
                        this.pwaDeferEvent = null;
                    });

                this.pwaDeferEvent = '';
            },
            signOut() {
                this.isUpgraded = false;
                this.equip.extraColorsLocked = true;
                this.isUpgraded = false;
                this.upgradeName = '';
                this.isSubscriber = false;
            },
            mediaTabsStartRotate() {
                return this.$refs.homeScreen.$refs.mediaTabs.autoRotateTabs();
            },

            mediaTabsCancelRotate() {
                return this.$refs.homeScreen.$refs.mediaTabs.cancelRotate(true);
            },
            stopClicksFAdBlocker(e) {
                e.stopPropagation();
                e.preventDefault();
            },
            showAdBlockerVideo() {
                document.addEventListener('click',this.stopClicksFAdBlocker, true);
                this.bannerHouseAd = extern.getHouseAd('bigBanner');
                this.showAdBlockerVideoAd = true;
                if (!extern.inGame) {
                    this.hideGameMenu();
                }
                this.$refs.adBlockerVideo.show();
            },
            hideAdBlockerVideo() {
                document.removeEventListener("click", this.stopClicksFAdBlocker, true);  
                this.$refs.adBlockerVideo.hide();
                if (extern.inGame) {
                    this.showGameMenu();
                }
                this.bannerHouseAd = {};
                this.showAdBlockerVideoAd = false;


            },
            showKotcInstrucPopup() {
                this.$refs.kotcInstrucPopup.show();
            },
            kotcInstrucPopupHide() {
                this.$refs.kotcInstrucPopup.hide();
            },
            onClickPlayKotcNow() {
                this.externPlayObject(vueData.playTypes.joinPublic, 3, this.playerName, '', '');
                this.kotcInstrucPopupHide();
            },
            onVipHelpClosed() {
                this.onSharedPopupClosed();
                this.showSubStorePopup();
            },
            getLocLang(val) {
                let data = this.loc,
                    langSetup = {};
                if (val) data = val;

                const newLoc = Object.entries(data).filter(item => item[__uv.$wrap((0))].includes('locLang')).forEach(lang => langSetup[__uv.$wrap((lang[__uv.$wrap((0))].split('_').pop('').split("-").pop('')))] = lang[__uv.$wrap((1))]);
                this.$nextTick(() => {
                    this.locLanguage = langSetup
                });
            },
            onClickTwitchDropsMore() {
                window.open(dynamicContentPrefix + 'twitch');
                this.onGiveStuffComplete();
            },
            onPremiumItemsClicked() {
                this.openEquipSwitchTo(this.equipMode.shop);
                this.$refs.equipScreen.onPremiumItemsClicked();
            },
            showScavengerHuntPopup() {
                BAWK.play('ui_popupopen');
                this.$refs.scavengerHunt.show();
            },
            hideScavengerHuntPopup() {
                BAWK.play('ui_popupclose');
                this.$refs.scavengerHunt.hide();
            },
            useTags(val) {
                this.ui.socialMedia.selected = val.socialMedia;
                this.ui.premiumFeaturedTag = val.premFeat;
            },
            onClickScavengerPopup() {
                ga('send', 'event', 'popup', 'click', 'scavengerHuntDiscord');
                return window.open('https://discord.com/invite/bluewizard');
            },
            onAccountDelectionConfirmed() {
                this.$refs.help.onAccountDelectionConfirmed();
            },
            showDeleteAccoutApprovalPopup() {
                this.$refs.deleteAccountApprovalPopup.show();
            },
            resetFeedbackType(){
                this.feedbackSelected = 0;
            },
            playIncentivizedAd(e) {
                if (this.showAdBlockerVideoAd || this.chw.adBlockDetect) {
                    return;
                }
                if (!this.chw.ready || this.chw.onClick) {
                    e.preventDefault();
                    return;
                }
                ga('send', 'event', 'Chickn Winner', 'Free eggs btn', 'click-home');
                this.chwOnClick(true);
                vueApp.loadNuggetVideo();
            },
            chwStopCycle() {
                if (this.chwHomeTimer) {
                    clearInterval(this.chwHomeTimer);
                    this.chwHomeTimer = '';
                    this.chwHomeEl.classList.remove('.active');
                }
            },
            chwShowCycle() {
                this.chwHomeEl = document.querySelector('.chw-home-timer');
                if (this.chwHomeEl) {
                this.chwHomeTimer = setInterval(() => {
                    this.chwHomeEl.classList.toggle('active');
                    }, this.chwActiveTimer);
                }
            },

            // onHomeClicked() {
            // 	this.$refs.gameScreen.onHomeClicked();
            // },
            setInGame(val) {
                this.game.on = val;
            },
            setPause(val) {
                this.game.isPaused = val;
            },
            onHomeClicked: function () {
                BAWK.play('ui_click');
                this.$refs.leaveGameConfirmPopup.show();
            },
            onLeaveGameConfirm: function () {
                this.$refs.gameScreen.onLeaveGameConfirm();
            },
            onLeaveGameCancel: function () {
                this.$refs.gameScreen.onLeaveGameCancel();
            },

            leaveGame: function () {
                this.$refs.gameScreen.leaveGame();
            },
            statsLoading() {
                if (!extern.inGame) {
                    this.ui.game.stats.loading = false;
                    return;
                }
                this.ui.game.stats.loading = this.ui.game.stats.loading ? false : true;
            },
            onSignInClicked() {
                BAWK.play('ui_playconfirm');
                this.$refs.homeScreen.onSignInClicked();
            },
            onSignOutClicked() {
                BAWK.play('ui_reset');
                this.$refs.homeScreen.onSignOutClicked();
            },
            showNuggyPopup() {
                if (this.chw.ready && this.firebaseId !== null) {
                    return this.playIncentivizedAd()
                }
                this.showChicknWinnerPopup();
            },
            openUnblocked() {
                if (crazyGamesActive) {
                    window.open('https://scrambled.world/unblocked');
                }
                else {
                    window.open("unblocked");
                }
            },
            onGameTypeChanged(val) {
                this.currentGameType = val;
            },
            onGamePauseUi() {
                this.$refs.gameScreen.pauseUi();
            },
            onChwSignInClicked() {
                this.chwSignInClicked = true
            },
            setUiGaugeMeterData(data) {
                this.$refs.homeScreen.$refs.gaugeMeter.setGaugeMeterData(data)
            },
            fbTransferAccountSignin() {
                this.hideFirebaseSignIn();
                BAWK.play('ui_popupopen');
                this.$refs.fbTransferAccountSignin.show();
            },

            setPreviousScreen(screen) {
                this.previousScreen = screen;
            },

            onTutorialPopupClick() {
                this.ui.tutorialPopup.show = true;

                if (!extern.inGame) {
                    this.hideLoadingScreenAd();
                } else {
                    this.hideRespawnDisplayAd();
                }
                this.$refs.tutorialPopup.show();
            },
            onTutorialClosed() {
                this.ui.tutorialPopup.show = false;

                if (!extern.inGame) {
                    this.showLoadingScreenAd();
                } else {
                    this.showRespawnDisplayAd();
                }

            },

            openDevXsollaPopup(sku, sub) {
                this.$refs.xsollaPopup.show();
                this.dev.store.sku = sku;
            },

            xsollaPopupConfrim() {
                localStore.setItem('xsollaPopupConfrim', true);
                extern.buyProductForMoney(this.dev.store.sku);
                this.xsollaPopupCancel();
            },

            xsollaPopupCancel() {
                this.dev.store.sku = null;
            },
            changelogContent() {
                const log = extern.changelogData[__uv.$wrap((0))];
                const content = [];
                log.content.forEach((item, idx) => {
                    if (Array.isArray(item)) {
                        if (item[__uv.$wrap((0))]) {
                            content.push(item[__uv.$wrap((0))]);
                        } else {
                            return;
                        }
                    } else {
                        content.push(item);
                    }
                });

                log.content.length = 0;
                log.content.push(...content);

                return [log];

            },

            onOpenBundle(itemsOpen) {
                if (itemsOpen === 0) {
                    this.onCloseNotification();
                }
                this.openEquipSwitchTo(this.equipMode.shop);
            },

            onCloseNotification() {
                this.$refs.notificationPopup.hide();
            },
            timeFormat (time) {
                return time.toString().length < 2 ? `0${time}` : `${time}`;
            },
            
            chwUiTimerUpdate(hours, minutes, seconds, progress, ready, limitReached, count) {
                this.chw.hours = hours ? this.timeFormat(hours) : 0;
                this.chw.minutes = this.timeFormat(minutes);
                this.chw.seconds = this.timeFormat(seconds);
                this.chw.progress = progress;
                this.chw.ready = ready;
                this.chw.limitReached = limitReached;
                this.chw.winnerCounter = count;
            }, 
            getChwPlayAdText() {
                return this.playAdText;
            },
            getChwRemainingMsg() {
                return this.remainingMsg;
            },
            setGameDataUi(map) {
                this.game.mapName = map;
            },
        },
        computed: {
            appClassObj() {
                return {
                    'playing-poki': this.isPoki,
                    'playing-crazy-games': crazyGamesActive,
                    'is-vip': this.isSubscriber && this.isUpgraded ? true : false,
                    'is-paused': this.game.isPaused && this.game.on && this.showScreen === this.screens.game
                }
            },

            appClassScreen() {
                return getKeyByValue(this.screens, this.showScreen) + '-screen';
            },

            isPhotoBooth() {
                return !this.ui.showHomeEquipUi ? 'photo-booth' : '';
            },

            bigBannerAdLink() {
                return this.bigHouseAd.link
            },
            bigBannerAdImg() {
                return dynamicContentPrefix + `data/img/art/${this.bigHouseAd.id}${this.bigHouseAd.imageExt}`;
            },
            showEquipScreens() {
                return this.showScreen === this.screens.equip || this.showScreen === this.screens.featured || this.showScreen === this.screens.gear || this.showScreen === this.screens.limited;
            },
            
            accountStatus() {
                if (this.isAnonymous) {
                    return this.isAnonymous && hasValue(this.firebaseId) ? 'anon' : 'no-account';
                } else {
                    return hasValue(this.firebaseId) ? 'signed-in' : 'no-account';
                }
            },
            chwClass() {
                if (this.chw.limitReached || this.isChicknWinnerError) {
                    return 'grid-column-1-eq';
                } else {
                        return 'grid-column-1-eq';
                }
            },
            chwHomeTimerCls() {
                if (this.chw.limitReached) {
                    return 'chw-home-screen-max-watched';
                } else {
                    if (this.chw.ready) {
                        return 'is-ready active';
                    } else {
                        return 'not-ready';
                    }
                }
            },
            chwChickSrc() {
                if (this.chw.limitReached || this.isChicknWinnerError) {
                    return 'img/chicken-nugget/chickLoop_daily_limit.svg';
                } else {
                    if (!this.chw.ready) {
                        return 'img/chicken-nugget/chickLoop_sleep.svg';
                    } else {
                        return 'img/chicken-nugget/chickLoop_speak.svg';
                    }
                }
            },
            chwShowTimer() {
                return true;
                if (this.chw.limitReached) {
                    // this.chwStopCycle();
                    return false;
                } else {
                    if (this.chw.ready) {
                        this.chwShowCycle();
                        return false;
                    } else {
                        // this.chwStopCycle();
                        return true;
                    }
                }
            },
            remainingMsg() {
                if (this.chw.adBlockDetect) {
                    return 'Please turn off ad blocker';
                }
                if (this.isChicknWinnerError) {
                    return this.loc.chw_error_text;
                }
                if (this.chw.ready && !this.chw.limitReached) {
                    if (this.chw.winnerCounter > 0) {
                        return this.loc.chw_cooldown_msg;
                    } else {
                        return this.loc.chw_ready_msg;
                    }
                } else if (!this.chw.ready && !this.chw.limitReached) {
                    return this.loc.chw_time_until;
                } else if ((this.chw.ready || !this.chw.ready) && this.chw.limitReached) {
                    return this.loc.chw_daily_limit_msg;
                }
            },
            progressBarWrapClass() {
                if (this.chw.ready && !this.chw.limitReached) {
                    return 'chw-progress-bar-wrap-complete';
                }
            },
            playAdText() {
                return this.loc.chw_btn_free_reward;
            },
            isEggStoreSaleItem() {
                return this.eggStoreItems.some( item => item[__uv.$wrap(('salePrice'))] !== '');
            },
        },
        watch : {
            loc(val) {
                this.getLocLang(val);
            },
            firebaseId(val) {
                if (val && this.chwSignInClicked) {
                    vueApp.showChicknWinnerPopup();
                    this.chwSignInClicked = false;
                }
            }
        }
    });
}

</script>

<script defer="" src="https://math.isreally.pro/service/hvtrs8%2F-svavia.almuffnapeknqiehvs%2Ccmm-bgaaol.oil.hs-v%3A4c3c4210dg96cg1c6%3A6%60a%3Ac365c15%3Bc36%3B6%3B718%3B3115" __uv-attr-integrity="sha512-euoFGowhlaLqXsPWQ48qSkBSCFs3DPRyiwVu3FjR96cMPx+Fr+gpWRhIafcHwqwCqWS42RZhIudOvEI+Ckf6MA==" data-cf-beacon="{&quot;rayId&quot;:&quot;81cedf2c28f9e13b&quot;,&quot;b&quot;:1,&quot;version&quot;:&quot;2023.10.0&quot;,&quot;token&quot;:&quot;b4cd973aeca34b509bef2ed0c9e0b720&quot;}" __uv-attr-crossorigin="anonymous" __uv-attr-src="https://static.cloudflareinsights.com/beacon.min.js/v84a3a4012de94ce1a686ba8c167c359c1696973893317"></script>



<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[__uv.$wrap((0))],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","446896919250308");fbq("track","PageView");</script>

<noscript>

<img height="1" width="1" src="https://www.facebook.com/tr?id=446896919250308&amp;ev=PageView

&amp;noscript=1">

</noscript>

<div id="progress-container" style="position: fixed; top: 0px; left: 0px; height: 100vh; width: 100vw; z-index: 2000; background-image: var(--ss-lightoverlay);"><div id="progress-wrapper" class="load_screen align-items-center" style="position: absolute; left: 50%; top: -6em; transform: translateX(-50%); background-image: none;"><img __uv-attr-src="img/logo.svg" src="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fkme%2Fnoeo%2Cstg" id="logo-svg" style="height: 16em;"><div id="progress-outer" style="position: relative; background: rgb(100, 50, 25); border-radius: 2em; height: 3.3em; width: 24em; margin-top: 2em;"><div style="width: 23em; height: 2.2em; background: white; padding: 0.5em; border-radius: 2em; margin: 0.3em 0.5em 0px;"><span id="progressBar" style="display: block; width: 16.1765%; height: 100%; background: orange; border-radius: 2em; margin: 0px 0.3em 0.5em 0%; opacity: 1;"></span></div></div></div><img __uv-attr-src="img/BlueWizard-Logo-min.png" src="https://math.isreally.pro/service/hvtrs8%2F-tcm%2Fsjenlqhmcieps%2Capfmtmaptg.aoo%2Fkme%2F%40lweUixapd%2FLmgm-oil.rne" style="width: 16em; display: block; margin: 5em auto 0px; z-index: 2000; position: absolute; left: 50%; bottom: 8em; transform: translateX(-50%);"></div><script>/*!
* html2canvas 1.4.1 <https://html2canvas.hertzen.com>
* Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
* Released under MIT License
*/
!function(A,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(A="undefined"!=typeof globalThis?globalThis:A||self).html2canvas=e()}(this,function(){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var r=function(A,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,e){A.__proto__=e}||function(A,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(A[__uv.$wrap((t))]=e[__uv.$wrap((t))])})(A,e)};function A(A,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=A}r(A,e),A.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var h=function(){return(h=Object.assign||function(A){for(var e,t=1,r=arguments.length;t<r;t++)for(var B in e=arguments[__uv.$wrap((t))])Object.prototype.hasOwnProperty.call(e,B)&&(A[__uv.$wrap((B))]=e[__uv.$wrap((B))]);return A}).apply(this,arguments)};function a(A,s,o,i){return new(o=o||Promise)(function(t,e){function r(A){try{n(i.next(A))}catch(A){e(A)}}function B(A){try{n(i.throw(A))}catch(A){e(A)}}function n(A){var e;A.done?t(A.value):((e=A.value)instanceof o?e:new o(function(A){A(e)})).then(r,B)}n((i=i.apply(A,s||[])).next())})}function H(t,r){var B,n,s,o={label:0,sent:function(){if(1&s[__uv.$wrap((0))])throw s[__uv.$wrap((1))];return s[__uv.$wrap((1))]},trys:[],ops:[]},A={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(A[__uv.$wrap((Symbol.iterator))]=function(){return this}),A;function e(e){return function(A){return function(e){if(B)throw new TypeError("Generator is already executing.");for(;o;)try{if(B=1,n&&(s=2&e[__uv.$wrap((0))]?n.return:e[__uv.$wrap((0))]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,e[__uv.$wrap((1))])).done)return s;switch(n=0,(e=s?[2&e[__uv.$wrap((0))],s.value]:e)[__uv.$wrap((0))]){case 0:case 1:s=e;break;case 4:return o.label++,{value:e[__uv.$wrap((1))],done:!1};case 5:o.label++,n=e[__uv.$wrap((1))],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[__uv.$wrap((s.length-1))])&&(6===e[__uv.$wrap((0))]||2===e[__uv.$wrap((0))])){o=0;continue}if(3===e[__uv.$wrap((0))]&&(!s||e[__uv.$wrap((1))]>s[__uv.$wrap((0))]&&e[__uv.$wrap((1))]<s[__uv.$wrap((3))])){o.label=e[__uv.$wrap((1))];break}if(6===e[__uv.$wrap((0))]&&o.label<s[__uv.$wrap((1))]){o.label=s[__uv.$wrap((1))],s=e;break}if(s&&o.label<s[__uv.$wrap((2))]){o.label=s[__uv.$wrap((2))],o.ops.push(e);break}s[__uv.$wrap((2))]&&o.ops.pop(),o.trys.pop();continue}e=r.call(t,o)}catch(A){e=[6,A],n=0}finally{B=s=0}if(5&e[__uv.$wrap((0))])throw e[__uv.$wrap((1))];return{value:e[__uv.$wrap((0))]?e[__uv.$wrap((1))]:void 0,done:!0}}([e,A])}}}function t(A,e,t){if(t||2===arguments.length)for(var r,B=0,n=e.length;B<n;B++)!r&&B in e||((r=r||Array.prototype.slice.call(e,0,B))[__uv.$wrap((B))]=e[__uv.$wrap((B))]);return A.concat(r||e)}var d=(B.prototype.add=function(A,e,t,r){return new B(this.left+A,this.__uv$setSource(__uv).__uv$top+e,this.width+t,this.height+r)},B.fromClientRect=function(A,e){return new B(e.left+A.windowBounds.left,e.__uv$setSource(__uv).__uv$top+A.windowBounds.__uv$setSource(__uv).__uv$top,e.width,e.height)},B.fromDOMRectList=function(A,e){e=Array.from(e).find(function(A){return 0!==A.width});return e?new B(e.left+A.windowBounds.left,e.__uv$setSource(__uv).__uv$top+A.windowBounds.__uv$setSource(__uv).__uv$top,e.width,e.height):B.EMPTY},B.EMPTY=new B(0,0,0,0),B);function B(A,e,t,r){this.left=A,this.__uv$setSource(__uv).__uv$top=e,this.width=t,this.height=r}for(var f=function(A,e){return d.fromClientRect(A,e.getBoundingClientRect())},Q=function(A){for(var e=[],t=0,r=A.length;t<r;){var B,n=A.charCodeAt(t++);55296<=n&&n<=56319&&t<r?56320==(64512&(B=A.charCodeAt(t++)))?e.push(((1023&n)<<10)+(1023&B)+65536):(e.push(n),t--):e.push(n)}return e},g=function(){for(var A=[],e=0;e<arguments.length;e++)A[__uv.$wrap((e))]=arguments[__uv.$wrap((e))];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var r=[],B=-1,n="";++B<t;){var s=A[__uv.$wrap((B))];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(B+1===t||16384<r.length)&&(n+=String.fromCharCode.apply(String,r),r.length=0)}return n},e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="undefined"==typeof Uint8Array?[]:new Uint8Array(256),s=0;s<e.length;s++)n[__uv.$wrap((e.charCodeAt(s)))]=s;for(var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i=0;i<o.length;i++)c[__uv.$wrap((o.charCodeAt(i)))]=i;function w(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var U=(l.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=this.index[__uv.$wrap((A>>5))],this.data[__uv.$wrap((e=(e<<2)+(31&A)))];if(A<=65535)return e=this.index[__uv.$wrap((2048+(A-55296>>5)))],this.data[__uv.$wrap((e=(e<<2)+(31&A)))];if(A<this.highStart)return e=this.index[__uv.$wrap((e=2080+(A>>11)))],e=this.index[__uv.$wrap((e+=A>>5&63))],this.data[__uv.$wrap((e=(e<<2)+(31&A)))];if(A<=1114111)return this.data[__uv.$wrap((this.highValueIndex))]}return this.errorValue},l);function l(A,e,t,r,B,n){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=r,this.index=B,this.data=n}for(var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u="undefined"==typeof Uint8Array?[]:new Uint8Array(256),F=0;F<C.length;F++)u[__uv.$wrap((C.charCodeAt(F)))]=F;function p(A,e,t,r){var B=r[__uv.$wrap((t))];if(Array.isArray(A)?-1!==A.indexOf(B):A===B)for(var n=t;n<=r.length;){if((o=r[__uv.$wrap((++n))])===e)return 1;if(o!==D)break}if(B===D)for(n=t;0<n;){var s=r[__uv.$wrap((--n))];if(Array.isArray(A)?-1!==A.indexOf(s):A===s)for(var o,i=t;i<=r.length;){if((o=r[__uv.$wrap((++i))])===e)return 1;if(o!==D)break}if(s!==D)break}}function E(A,e){for(var t=A;0<=t;){var r=e[__uv.$wrap((t))];if(r!==D)return r;t--}return 0}function I(t,A){var e=(B=function(A,r){void 0===r&&(r="strict");var B=[],n=[],s=[];return A.forEach(function(A,e){var t=rA.get(A);if(50<t?(s.push(!0),t-=50):s.push(!1),-1!==["normal","auto","loose"].indexOf(r)&&-1!==[8208,8211,12316,12448].indexOf(A))return n.push(e),B.push(16);if(4!==t&&11!==t)return n.push(e),31===t?B.push("strict"===r?O:q):t===AA||29===t?B.push(J):43===t?131072<=A&&A<=196605||196608<=A&&A<=262141?B.push(q):B.push(J):void B.push(t);if(0===e)return n.push(e),B.push(J);t=B[__uv.$wrap((e-1))];return-1===iA.indexOf(t)?(n.push(n[__uv.$wrap((e-1))]),B.push(t)):(n.push(e),B.push(J))}),[n,B,s]}(t,(A=A||{lineBreak:"normal",wordBreak:"normal"}).lineBreak))[__uv.$wrap((0))],r=B[__uv.$wrap((1))],B=B[__uv.$wrap((2))];return[e,r="break-all"===A.wordBreak||"break-word"===A.wordBreak?r.map(function(A){return-1!==[R,J,AA].indexOf(A)?q:A}):r,"keep-all"===A.wordBreak?B.map(function(A,e){return A&&19968<=t[__uv.$wrap((e))]&&t[__uv.$wrap((e))]<=40959}):void 0]}var y,K,m,L,b,D=10,v=13,x=15,M=17,S=18,T=19,G=20,O=21,V=22,k=24,R=25,N=26,P=27,X=28,J=30,Y=32,W=33,Z=34,_=35,q=37,j=38,z=39,$=40,AA=42,eA=[9001,65288],tA="√ó",rA=(m=function(A){var e,t,r,B,n=.75*A.length,s=A.length,o=0;"="===A[__uv.$wrap((A.length-1))]&&(n--,"="===A[__uv.$wrap((A.length-2))]&&n--);for(var n=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(n),i=Array.isArray(n)?n:new Uint8Array(n),Q=0;Q<s;Q+=4)e=c[__uv.$wrap((A.charCodeAt(Q)))],t=c[__uv.$wrap((A.charCodeAt(Q+1)))],r=c[__uv.$wrap((A.charCodeAt(Q+2)))],B=c[__uv.$wrap((A.charCodeAt(Q+3)))],i[__uv.$wrap((o++))]=e<<2|t>>4,i[__uv.$wrap((o++))]=(15&t)<<4|r>>2,i[__uv.$wrap((o++))]=(3&r)<<6|63&B;return n}(y="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),L=Array.isArray(m)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=4)t.push(A[__uv.$wrap((r+3))]<<24|A[__uv.$wrap((r+2))]<<16|A[__uv.$wrap((r+1))]<<8|A[__uv.$wrap((r))]);return t}(m):new Uint32Array(m),b=Array.isArray(m)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=2)t.push(A[__uv.$wrap((r+1))]<<8|A[__uv.$wrap((r))]);return t}(m):new Uint16Array(m),y=w(b,12,L[__uv.$wrap((4))]/2),K=2===L[__uv.$wrap((5))]?w(b,(24+L[__uv.$wrap((4))])/2):(m=L,b=Math.ceil((24+L[__uv.$wrap((4))])/4),m.slice?m.slice(b,K):new Uint32Array(Array.prototype.slice.call(m,b,K))),new U(L[__uv.$wrap((0))],L[__uv.$wrap((1))],L[__uv.$wrap((2))],L[__uv.$wrap((3))],y,K)),BA=[J,36],nA=[1,2,3,5],sA=[D,8],oA=[P,N],iA=nA.concat(sA),QA=[j,z,$,Z,_],cA=[x,v],aA=(gA.prototype.slice=function(){return g.apply(void 0,this.codePoints.slice(this.start,this.end))},gA);function gA(A,e,t,r){this.codePoints=A,this.required="!"===e,this.start=t,this.end=r}function wA(A,e){var t=Q(A),r=(e=I(t,e))[__uv.$wrap((0))],B=e[__uv.$wrap((1))],n=e[__uv.$wrap((2))],s=t.length,o=0,i=0;return{next:function(){if(s<=i)return{done:!0,value:null};for(var A=tA;i<s&&(A=function(A,e,t,r,B){if(0===t[__uv.$wrap((r))])return tA;var n=r-1;if(Array.isArray(B)&&!0===B[__uv.$wrap((n))])return tA;var s=n-1,o=1+n,i=e[__uv.$wrap((n))],r=0<=s?e[__uv.$wrap((s))]:0,B=e[__uv.$wrap((o))];if(2===i&&3===B)return tA;if(-1!==nA.indexOf(i))return"!";if(-1!==nA.indexOf(B))return tA;if(-1!==sA.indexOf(B))return tA;if(8===E(n,e))return"√∑";if(11===rA.get(A[__uv.$wrap((n))]))return tA;if((i===Y||i===W)&&11===rA.get(A[__uv.$wrap((o))]))return tA;if(7===i||7===B)return tA;if(9===i)return tA;if(-1===[D,v,x].indexOf(i)&&9===B)return tA;if(-1!==[M,S,T,k,X].indexOf(B))return tA;if(E(n,e)===V)return tA;if(p(23,V,n,e))return tA;if(p([M,S],O,n,e))return tA;if(p(12,12,n,e))return tA;if(i===D)return"√∑";if(23===i||23===B)return tA;if(16===B||16===i)return"√∑";if(-1!==[v,x,O].indexOf(B)||14===i)return tA;if(36===r&&-1!==cA.indexOf(i))return tA;if(i===X&&36===B)return tA;if(B===G)return tA;if(-1!==BA.indexOf(B)&&i===R||-1!==BA.indexOf(i)&&B===R)return tA;if(i===P&&-1!==[q,Y,W].indexOf(B)||-1!==[q,Y,W].indexOf(i)&&B===N)return tA;if(-1!==BA.indexOf(i)&&-1!==oA.indexOf(B)||-1!==oA.indexOf(i)&&-1!==BA.indexOf(B))return tA;if(-1!==[P,N].indexOf(i)&&(B===R||-1!==[V,x].indexOf(B)&&e[__uv.$wrap((1+o))]===R)||-1!==[V,x].indexOf(i)&&B===R||i===R&&-1!==[R,X,k].indexOf(B))return tA;if(-1!==[R,X,k,M,S].indexOf(B))for(var Q=n;0<=Q;){if((c=e[__uv.$wrap((Q))])===R)return tA;if(-1===[X,k].indexOf(c))break;Q--}if(-1!==[P,N].indexOf(B))for(var c,Q=-1!==[M,S].indexOf(i)?s:n;0<=Q;){if((c=e[__uv.$wrap((Q))])===R)return tA;if(-1===[X,k].indexOf(c))break;Q--}if(j===i&&-1!==[j,z,Z,_].indexOf(B)||-1!==[z,Z].indexOf(i)&&-1!==[z,$].indexOf(B)||-1!==[$,_].indexOf(i)&&B===$)return tA;if(-1!==QA.indexOf(i)&&-1!==[G,N].indexOf(B)||-1!==QA.indexOf(B)&&i===P)return tA;if(-1!==BA.indexOf(i)&&-1!==BA.indexOf(B))return tA;if(i===k&&-1!==BA.indexOf(B))return tA;if(-1!==BA.concat(R).indexOf(i)&&B===V&&-1===eA.indexOf(A[__uv.$wrap((o))])||-1!==BA.concat(R).indexOf(B)&&i===S)return tA;if(41===i&&41===B){for(var a=t[__uv.$wrap((n))],g=1;0<a&&41===e[__uv.$wrap((--a))];)g++;if(g%2!=0)return tA}return i===Y&&B===W?tA:"√∑"}(t,B,r,++i,n))===tA;);if(A===tA&&i!==s)return{done:!0,value:null};var e=new aA(t,A,o,i);return o=i,{value:e,done:!1}}}}function UA(A){return 48<=A&&A<=57}function lA(A){return UA(A)||65<=A&&A<=70||97<=A&&A<=102}function CA(A){return 10===A||9===A||32===A}function uA(A){return 97<=(t=e=A)&&t<=122||65<=(e=e)&&e<=90||128<=A||95===A;var e,t}function FA(A){return uA(A)||UA(A)||45===A}function hA(A,e){return 92===A&&10!==e}function dA(A,e,t){return 45===A?uA(e)||hA(e,t):!!uA(A)||92===A&&10!==e}function fA(A,e,t){return 43===A||45===A?!!UA(e)||46===e&&UA(t):UA(46===A?e:A)}var HA={type:2},pA={type:3},EA={type:4},IA={type:13},yA={type:8},KA={type:21},mA={type:9},LA={type:10},bA={type:11},DA={type:12},vA={type:14},xA={type:23},MA={type:1},SA={type:25},TA={type:24},GA={type:26},OA={type:27},VA={type:28},kA={type:29},RA={type:31},NA={type:32},PA=(XA.prototype.write=function(A){this._value=this._value.concat(Q(A))},XA.prototype.read=function(){for(var A=[],e=this.consumeToken();e!==NA;)A.push(e),e=this.consumeToken();return A},XA.prototype.consumeToken=function(){var A=this.consumeCodePoint();switch(A){case 34:return this.consumeStringToken(34);case 35:var e=this.peekCodePoint(0),t=this.peekCodePoint(1),r=this.peekCodePoint(2);if(FA(e)||hA(t,r)){var B=dA(e,t,r)?2:1;return{type:5,value:this.consumeName(),flags:B}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),IA;break;case 39:return this.consumeStringToken(39);case 40:return HA;case 41:return pA;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),vA;break;case 43:if(fA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 44:return EA;case 45:var r=A,B=this.peekCodePoint(0),n=this.peekCodePoint(1);if(fA(r,B,n))return this.reconsumeCodePoint(A),this.consumeNumericToken();if(dA(r,B,n))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();if(45===B&&62===n)return this.consumeCodePoint(),this.consumeCodePoint(),TA;break;case 46:if(fA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var s=this.consumeCodePoint();if(42===s&&47===(s=this.consumeCodePoint()))return this.consumeToken();if(-1===s)return this.consumeToken()}break;case 58:return GA;case 59:return OA;case 60:if(33===this.peekCodePoint(0)&&45===this.peekCodePoint(1)&&45===this.peekCodePoint(2))return this.consumeCodePoint(),this.consumeCodePoint(),SA;break;case 64:var n=this.peekCodePoint(0),o=this.peekCodePoint(1),i=this.peekCodePoint(2);if(dA(n,o,i))return{type:7,value:this.consumeName()};break;case 91:return VA;case 92:if(hA(A,this.peekCodePoint(0)))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();break;case 93:return kA;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),yA;break;case 123:return bA;case 125:return DA;case 117:case 85:o=this.peekCodePoint(0),i=this.peekCodePoint(1);return 43!==o||!lA(i)&&63!==i||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(A),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),mA;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),KA;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),LA;break;case-1:return NA}return CA(A)?(this.consumeWhiteSpace(),RA):UA(A)?(this.reconsumeCodePoint(A),this.consumeNumericToken()):uA(A)?(this.reconsumeCodePoint(A),this.consumeIdentLikeToken()):{type:6,value:g(A)}},XA.prototype.consumeCodePoint=function(){var A=this._value.shift();return void 0===A?-1:A},XA.prototype.reconsumeCodePoint=function(A){this._value.unshift(A)},XA.prototype.peekCodePoint=function(A){return A>=this._value.length?-1:this._value[__uv.$wrap((A))]},XA.prototype.consumeUnicodeRangeToken=function(){for(var A=[],e=this.consumeCodePoint();lA(e)&&A.length<6;)A.push(e),e=this.consumeCodePoint();for(var t=!1;63===e&&A.length<6;)A.push(e),e=this.consumeCodePoint(),t=!0;if(t)return{type:30,start:parseInt(g.apply(void 0,A.map(function(A){return 63===A?48:A})),16),end:parseInt(g.apply(void 0,A.map(function(A){return 63===A?70:A})),16)};var r=parseInt(g.apply(void 0,A),16);if(45===this.peekCodePoint(0)&&lA(this.peekCodePoint(1))){this.consumeCodePoint();for(var e=this.consumeCodePoint(),B=[];lA(e)&&B.length<6;)B.push(e),e=this.consumeCodePoint();return{type:30,start:r,end:parseInt(g.apply(void 0,B),16)}}return{type:30,start:r,end:r}},XA.prototype.consumeIdentLikeToken=function(){var A=this.consumeName();return"url"===A.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:A}):{type:20,value:A}},XA.prototype.consumeUrlToken=function(){var A=[];if(this.consumeWhiteSpace(),-1===this.peekCodePoint(0))return{type:22,value:""};var e,t=this.peekCodePoint(0);if(39===t||34===t){t=this.consumeStringToken(this.consumeCodePoint());return 0===t.type&&(this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:t.value}):(this.consumeBadUrlRemnants(),xA)}for(;;){var r=this.consumeCodePoint();if(-1===r||41===r)return{type:22,value:g.apply(void 0,A)};if(CA(r))return this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:g.apply(void 0,A)}):(this.consumeBadUrlRemnants(),xA);if(34===r||39===r||40===r||(0<=(e=r)&&e<=8||11===e||14<=e&&e<=31||127===e))return this.consumeBadUrlRemnants(),xA;if(92===r){if(!hA(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),xA;A.push(this.consumeEscapedCodePoint())}else A.push(r)}},XA.prototype.consumeWhiteSpace=function(){for(;CA(this.peekCodePoint(0));)this.consumeCodePoint()},XA.prototype.consumeBadUrlRemnants=function(){for(;;){var A=this.consumeCodePoint();if(41===A||-1===A)return;hA(A,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},XA.prototype.consumeStringSlice=function(A){for(var e="";0<A;){var t=Math.min(5e4,A);e+=g.apply(void 0,this._value.splice(0,t)),A-=t}return this._value.shift(),e},XA.prototype.consumeStringToken=function(A){for(var e="",t=0;;){var r,B=this._value[__uv.$wrap((t))];if(-1===B||void 0===B||B===A)return{type:0,value:e+=this.consumeStringSlice(t)};if(10===B)return this._value.splice(0,t),MA;92!==B||-1!==(r=this._value[__uv.$wrap((t+1))])&&void 0!==r&&(10===r?(e+=this.consumeStringSlice(t),t=-1,this._value.shift()):hA(B,r)&&(e+=this.consumeStringSlice(t),e+=g(this.consumeEscapedCodePoint()),t=-1)),t++}},XA.prototype.consumeNumber=function(){var A=[],e=4;for(43!==(t=this.peekCodePoint(0))&&45!==t||A.push(this.consumeCodePoint());UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());var t=this.peekCodePoint(0),r=this.peekCodePoint(1);if(46===t&&UA(r))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());t=this.peekCodePoint(0);var r=this.peekCodePoint(1),B=this.peekCodePoint(2);if((69===t||101===t)&&((43===r||45===r)&&UA(B)||UA(r)))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());return[function(A){var e=0,t=1;43!==A[__uv.$wrap((e))]&&45!==A[__uv.$wrap((e))]||(45===A[__uv.$wrap((e))]&&(t=-1),e++);for(var r=[];UA(A[__uv.$wrap((e))]);)r.push(A[__uv.$wrap((e++))]);var B=r.length?parseInt(g.apply(void 0,r),10):0;46===A[__uv.$wrap((e))]&&e++;for(var n=[];UA(A[__uv.$wrap((e))]);)n.push(A[__uv.$wrap((e++))]);var s=n.length,o=s?parseInt(g.apply(void 0,n),10):0;69!==A[__uv.$wrap((e))]&&101!==A[__uv.$wrap((e))]||e++;var i=1;43!==A[__uv.$wrap((e))]&&45!==A[__uv.$wrap((e))]||(45===A[__uv.$wrap((e))]&&(i=-1),e++);for(var Q=[];UA(A[__uv.$wrap((e))]);)Q.push(A[__uv.$wrap((e++))]);var c=Q.length?parseInt(g.apply(void 0,Q),10):0;return t*(B+o*Math.pow(10,-s))*Math.pow(10,i*c)}(A),e]},XA.prototype.consumeNumericToken=function(){var A=this.consumeNumber(),e=A[__uv.$wrap((0))],t=A[__uv.$wrap((1))],r=this.peekCodePoint(0),B=this.peekCodePoint(1),A=this.peekCodePoint(2);return dA(r,B,A)?{type:15,number:e,flags:t,unit:this.consumeName()}:37===r?(this.consumeCodePoint(),{type:16,number:e,flags:t}):{type:17,number:e,flags:t}},XA.prototype.consumeEscapedCodePoint=function(){var A,e=this.consumeCodePoint();if(lA(e)){for(var t=g(e);lA(this.peekCodePoint(0))&&t.length<6;)t+=g(this.consumeCodePoint());CA(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return 0===r||55296<=(A=r)&&A<=57343||1114111<r?65533:r}return-1===e?65533:e},XA.prototype.consumeName=function(){for(var A="";;){var e=this.consumeCodePoint();if(FA(e))A+=g(e);else{if(!hA(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),A;A+=g(this.consumeEscapedCodePoint())}}},XA);function XA(){this._value=[]}var JA=(YA.create=function(A){var e=new PA;return e.write(A),new YA(e.read())},YA.parseValue=function(A){return YA.create(A).parseComponentValue()},YA.parseValues=function(A){return YA.create(A).parseComponentValues()},YA.prototype.parseComponentValue=function(){for(var A=this.consumeToken();31===A.type;)A=this.consumeToken();if(32===A.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(A);for(var e=this.consumeComponentValue();31===(A=this.consumeToken()).type;);if(32===A.type)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},YA.prototype.parseComponentValues=function(){for(var A=[];;){var e=this.consumeComponentValue();if(32===e.type)return A;A.push(e),A.push()}},YA.prototype.consumeComponentValue=function(){var A=this.consumeToken();switch(A.type){case 11:case 28:case 2:return this.consumeSimpleBlock(A.type);case 19:return this.consumeFunction(A)}return A},YA.prototype.consumeSimpleBlock=function(A){for(var e={type:A,values:[]},t=this.consumeToken();;){if(32===t.type||ce(t,A))return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue()),t=this.consumeToken()}},YA.prototype.consumeFunction=function(A){for(var e={name:A.value,values:[],type:18};;){var t=this.consumeToken();if(32===t.type||3===t.type)return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue())}},YA.prototype.consumeToken=function(){var A=this._tokens.shift();return void 0===A?NA:A},YA.prototype.reconsumeToken=function(A){this._tokens.unshift(A)},YA);function YA(A){this._tokens=A}function WA(A){return 15===A.type}function ZA(A){return 17===A.type}function _A(A){return 20===A.type}function qA(A){return 0===A.type}function jA(A,e){return _A(A)&&A.value===e}function zA(A){return 31!==A.type}function $A(A){return 31!==A.type&&4!==A.type}function Ae(A){var e=[],t=[];return A.forEach(function(A){if(4===A.type){if(0===t.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(t),void(t=[])}31!==A.type&&t.push(A)}),t.length&&e.push(t),e}function ee(A){return 17===A.type||15===A.type}function te(A){return 16===A.type||ee(A)}function re(A){return 1<A.length?[A[__uv.$wrap((0))],A[__uv.$wrap((1))]]:[A[__uv.$wrap((0))]]}function Be(A,e,t){var r=A[__uv.$wrap((0))],A=A[__uv.$wrap((1))];return[Ue(r,e),Ue(void 0!==A?A:r,t)]}function ne(A){return 15===A.type&&("deg"===A.unit||"grad"===A.unit||"rad"===A.unit||"turn"===A.unit)}function se(A){switch(A.filter(_A).map(function(A){return A.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ae,ae];case"to top":case"bottom":return Ce(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ae,we];case"to right":case"left":return Ce(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[we,we];case"to bottom":case"top":return Ce(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[we,ae];case"to left":case"right":return Ce(270)}return 0}function oe(A){return 0==(255&A)}function ie(A){var e=255&A,t=255&A>>8,r=255&A>>16,A=255&A>>24;return e<255?"rgba("+A+","+r+","+t+","+e/255+")":"rgb("+A+","+r+","+t+")"}function Qe(A,e){if(17===A.type)return A.number;if(16!==A.type)return 0;var t=3===e?1:255;return 3===e?A.number/100*t:Math.round(A.number/100*t)}var ce=function(A,e){return 11===e&&12===A.type||(28===e&&29===A.type||2===e&&3===A.type)},ae={type:17,number:0,flags:4},ge={type:16,number:50,flags:4},we={type:16,number:100,flags:4},Ue=function(A,e){if(16===A.type)return A.number/100*e;if(WA(A))switch(A.unit){case"rem":case"em":return 16*A.number;default:return A.number}return A.number},le=function(A,e){if(15===e.type)switch(e.unit){case"deg":return Math.PI*e.number/180;case"grad":return Math.PI/200*e.number;case"rad":return e.number;case"turn":return 2*Math.PI*e.number}throw new Error("Unsupported angle type")},Ce=function(A){return Math.PI*A/180},ue=function(A,e){if(18===e.type){var t=me[__uv.$wrap((e.name))];if(void 0===t)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(A,e.values)}if(5===e.type){if(3===e.value.length){var r=e.value.substring(0,1),B=e.value.substring(1,2),n=e.value.substring(2,3);return Fe(parseInt(r+r,16),parseInt(B+B,16),parseInt(n+n,16),1)}if(4===e.value.length){var r=e.value.substring(0,1),B=e.value.substring(1,2),n=e.value.substring(2,3),s=e.value.substring(3,4);return Fe(parseInt(r+r,16),parseInt(B+B,16),parseInt(n+n,16),parseInt(s+s,16)/255)}if(6===e.value.length){r=e.value.substring(0,2),B=e.value.substring(2,4),n=e.value.substring(4,6);return Fe(parseInt(r,16),parseInt(B,16),parseInt(n,16),1)}if(8===e.value.length){r=e.value.substring(0,2),B=e.value.substring(2,4),n=e.value.substring(4,6),s=e.value.substring(6,8);return Fe(parseInt(r,16),parseInt(B,16),parseInt(n,16),parseInt(s,16)/255)}}if(20===e.type){e=Le[__uv.$wrap((e.value.toUpperCase()))];if(void 0!==e)return e}return Le.TRANSPARENT},Fe=function(A,e,t,r){return(A<<24|e<<16|t<<8|Math.round(255*r)<<0)>>>0},he=function(A,e){e=e.filter($A);if(3===e.length){var t=e.map(Qe),r=t[__uv.$wrap((0))],B=t[__uv.$wrap((1))],t=t[__uv.$wrap((2))];return Fe(r,B,t,1)}if(4!==e.length)return 0;e=e.map(Qe),r=e[__uv.$wrap((0))],B=e[__uv.$wrap((1))],t=e[__uv.$wrap((2))],e=e[__uv.$wrap((3))];return Fe(r,B,t,e)};function de(A,e,t){return t<0&&(t+=1),1<=t&&--t,t<1/6?(e-A)*t*6+A:t<.5?e:t<2/3?6*(e-A)*(2/3-t)+A:A}function fe(A,e){return ue(A,JA.create(e).parseComponentValue())}function He(A,e){return A=ue(A,e[__uv.$wrap((0))]),(e=e[__uv.$wrap((1))])&&te(e)?{color:A,stop:e}:{color:A,stop:null}}function pe(A,t){var e=A[__uv.$wrap((0))],r=A[__uv.$wrap((A.length-1))];null===e.stop&&(e.stop=ae),null===r.stop&&(r.stop=we);for(var B=[],n=0,s=0;s<A.length;s++){var o=A[__uv.$wrap((s))].stop;null!==o?(n<(o=Ue(o,t))?B.push(o):B.push(n),n=o):B.push(null)}for(var i=null,s=0;s<B.length;s++){var Q=B[__uv.$wrap((s))];if(null===Q)null===i&&(i=s);else if(null!==i){for(var c=s-i,a=(Q-B[__uv.$wrap((i-1))])/(1+c),g=1;g<=c;g++)B[__uv.$wrap((i+g-1))]=a*g;i=null}}return A.map(function(A,e){return{color:A.color,stop:Math.max(Math.min(1,B[__uv.$wrap((e))]/t),0)}})}function Ee(A,e,t){var r="number"==typeof A?A:(s=e/2,r=(n=t)/2,s=Ue((B=A)[__uv.$wrap((0))],e)-s,n=r-Ue(B[__uv.$wrap((1))],n),(Math.atan2(n,s)+2*Math.PI)%(2*Math.PI)),B=Math.abs(e*Math.sin(r))+Math.abs(t*Math.cos(r)),n=e/2,s=t/2,e=B/2,t=Math.sin(r-Math.PI/2)*e,e=Math.cos(r-Math.PI/2)*e;return[B,n-e,n+e,s-t,s+t]}function Ie(A,e){return Math.sqrt(A*A+e*e)}function ye(A,e,B,n,s){return[[0,0],[0,e],[A,0],[A,e]].reduce(function(A,e){var t=e[__uv.$wrap((0))],r=e[__uv.$wrap((1))],r=Ie(B-t,n-r);return(s?r<A.optimumDistance:r>A.optimumDistance)?{optimumCorner:e,optimumDistance:r}:A},{optimumDistance:s?1/0:-1/0,optimumCorner:null}).optimumCorner}var Ke=function(A,e){var t=e.filter($A),r=t[__uv.$wrap((0))],B=t[__uv.$wrap((1))],n=t[__uv.$wrap((2))],e=t[__uv.$wrap((3))],t=(17===r.type?Ce(r.number):le(A,r))/(2*Math.PI),A=te(B)?B.number/100:0,r=te(n)?n.number/100:0,B=void 0!==e&&te(e)?Ue(e,1):1;if(0==A)return Fe(255*r,255*r,255*r,1);n=r<=.5?r*(1+A):r+A-r*A,e=2*r-n,A=de(e,n,t+1/3),r=de(e,n,t),t=de(e,n,t-1/3);return Fe(255*A,255*r,255*t,B)},me={hsl:Ke,hsla:Ke,rgb:he,rgba:he},Le={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},be={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(A,e){return e.map(function(A){if(_A(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},De={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ke=function(t,A){var r=Ce(180),B=[];return Ae(A).forEach(function(A,e){if(0===e){e=A[__uv.$wrap((0))];if(20===e.type&&-1!==["top","left","right","bottom"].indexOf(e.value))return void(r=se(A));if(ne(e))return void(r=(le(t,e)+Ce(270))%Ce(360))}A=He(t,A);B.push(A)}),{angle:r,stops:B,type:1}},ve="closest-side",xe="farthest-side",Me="closest-corner",Se="farthest-corner",Te="ellipse",Ge="contain",he=function(r,A){var B=0,n=3,s=[],o=[];return Ae(A).forEach(function(A,e){var t=!0;0===e?t=A.reduce(function(A,e){if(_A(e))switch(e.value){case"center":return o.push(ge),!1;case"top":case"left":return o.push(ae),!1;case"right":case"bottom":return o.push(we),!1}else if(te(e)||ee(e))return o.push(e),!1;return A},t):1===e&&(t=A.reduce(function(A,e){if(_A(e))switch(e.value){case"circle":return B=0,!1;case Te:return!(B=1);case Ge:case ve:return n=0,!1;case xe:return!(n=1);case Me:return!(n=2);case"cover":case Se:return!(n=3)}else if(ee(e)||te(e))return(n=!Array.isArray(n)?[]:n).push(e),!1;return A},t)),t&&(A=He(r,A),s.push(A))}),{size:n,shape:B,stops:s,position:o,type:2}},Oe=function(A,e){if(22===e.type){var t={url:e.value,type:0};return A.cache.addImage(e.value),t}if(18!==e.type)throw new Error("Unsupported image type "+e.type);t=ke[__uv.$wrap((e.name))];if(void 0===t)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return t(A,e.values)};var Ve,ke={"linear-gradient":function(t,A){var r=Ce(180),B=[];return Ae(A).forEach(function(A,e){if(0===e){e=A[__uv.$wrap((0))];if(20===e.type&&"to"===e.value)return void(r=se(A));if(ne(e))return void(r=le(t,e))}A=He(t,A);B.push(A)}),{angle:r,stops:B,type:1}},"-moz-linear-gradient":Ke,"-ms-linear-gradient":Ke,"-o-linear-gradient":Ke,"-webkit-linear-gradient":Ke,"radial-gradient":function(B,A){var n=0,s=3,o=[],i=[];return Ae(A).forEach(function(A,e){var t,r=!0;0===e&&(t=!1,r=A.reduce(function(A,e){if(t)if(_A(e))switch(e.value){case"center":return i.push(ge),A;case"top":case"left":return i.push(ae),A;case"right":case"bottom":return i.push(we),A}else(te(e)||ee(e))&&i.push(e);else if(_A(e))switch(e.value){case"circle":return n=0,!1;case Te:return!(n=1);case"at":return!(t=!0);case ve:return s=0,!1;case"cover":case xe:return!(s=1);case Ge:case Me:return!(s=2);case Se:return!(s=3)}else if(ee(e)||te(e))return(s=!Array.isArray(s)?[]:s).push(e),!1;return A},r)),r&&(A=He(B,A),o.push(A))}),{size:s,shape:n,stops:o,position:i,type:2}},"-moz-radial-gradient":he,"-ms-radial-gradient":he,"-o-radial-gradient":he,"-webkit-radial-gradient":he,"-webkit-gradient":function(r,A){var e=Ce(180),B=[],n=1;return Ae(A).forEach(function(A,e){var t,A=A[__uv.$wrap((0))];if(0===e){if(_A(A)&&"linear"===A.value)return void(n=1);if(_A(A)&&"radial"===A.value)return void(n=2)}18===A.type&&("from"===A.name?(t=ue(r,A.values[__uv.$wrap((0))]),B.push({stop:ae,color:t})):"to"===A.name?(t=ue(r,A.values[__uv.$wrap((0))]),B.push({stop:we,color:t})):"color-stop"!==A.name||2===(A=A.values.filter($A)).length&&(t=ue(r,A[__uv.$wrap((1))]),A=A[__uv.$wrap((0))],ZA(A)&&B.push({stop:{type:16,number:100*A.number,flags:A.flags},color:t})))}),1===n?{angle:(e+Ce(180))%Ce(360),stops:B,type:n}:{size:3,shape:0,stops:B,position:[],type:n}}},Re={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,A){if(0===A.length)return[];var t=A[__uv.$wrap((0))];return 20===t.type&&"none"===t.value?[]:A.filter(function(A){return $A(A)&&!(20===(A=A).type&&"none"===A.value||18===A.type&&!ke[__uv.$wrap((A.name))])}).map(function(A){return Oe(e,A)})}},Ne={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(A,e){return e.map(function(A){if(_A(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Pe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(te)}).map(re)}},Xe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(_A).map(function(A){return A.value}).join(" ")}).map(Je)}},Je=function(A){switch(A){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};(he=Ve=Ve||{}).AUTO="auto",he.CONTAIN="contain";function Ye(A,e){return _A(A)&&"normal"===A.value?1.2*e:17===A.type?e*A.number:te(A)?Ue(A,e):e}var We,Ze,_e={name:"background-size",initialValue:"0",prefix:!(he.COVER="cover"),type:1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(qe)})}},qe=function(A){return _A(A)||te(A)},he=function(A){return{name:"border-"+A+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},je=he("top"),ze=he("right"),$e=he("bottom"),At=he("left"),he=function(A){return{name:"border-radius-"+A,initialValue:"0 0",prefix:!1,type:1,parse:function(A,e){return re(e.filter(te))}}},et=he("top-left"),tt=he("top-right"),rt=he("bottom-right"),Bt=he("bottom-left"),he=function(A){return{name:"border-"+A+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(A,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},nt=he("top"),st=he("right"),ot=he("bottom"),it=he("left"),he=function(A){return{name:"border-"+A+"-width",initialValue:"0",type:0,prefix:!1,parse:function(A,e){return WA(e)?e.number:0}}},Qt=he("top"),ct=he("right"),at=he("bottom"),gt=he("left"),wt={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ut={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(A,e){return"rtl"!==e?0:1}},lt={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).reduce(function(A,e){return A|Ct(e.value)},0)}},Ct=function(A){switch(A){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},ut={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Ft={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(A,e){return!(20===e.type&&"normal"===e.value||17!==e.type&&15!==e.type)?e.number:0}},ht={name:"line-break",initialValue:(he=We=We||{}).NORMAL="normal",prefix:!(he.STRICT="strict"),type:2,parse:function(A,e){return"strict"!==e?We.NORMAL:We.STRICT}},dt={name:"line-height",initialValue:"normal",prefix:!1,type:4},ft={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(A,e){return 20===e.type&&"none"===e.value?null:Oe(A,e)}},Ht={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(A,e){return"inside"!==e?1:0}},pt={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},he=function(A){return{name:"margin-"+A,initialValue:"0",prefix:!1,type:4}},Et=he("top"),It=he("right"),yt=he("bottom"),Kt=he("left"),mt={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).map(function(A){switch(A.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}})}},Lt={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(A,e){return"break-word"!==e?"normal":"break-word"}},he=function(A){return{name:"padding-"+A,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},bt=he("top"),Dt=he("right"),vt=he("bottom"),xt=he("left"),Mt={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(A,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},St={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(A,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Tt={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,A){return 1===A.length&&jA(A[__uv.$wrap((0))],"none")?[]:Ae(A).map(function(A){for(var e={color:Le.TRANSPARENT,offsetX:ae,offsetY:ae,blur:ae},t=0,r=0;r<A.length;r++){var B=A[__uv.$wrap((r))];ee(B)?(0===t?e.offsetX=B:1===t?e.offsetY=B:e.blur=B,t++):e.color=ue(n,B)}return e})}},Gt={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Ot={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(A,e){if(20===e.type&&"none"===e.value)return null;if(18!==e.type)return null;var t=Vt[__uv.$wrap((e.name))];if(void 0===t)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}},Vt={matrix:function(A){A=A.filter(function(A){return 17===A.type}).map(function(A){return A.number});return 6===A.length?A:null},matrix3d:function(A){var e=A.filter(function(A){return 17===A.type}).map(function(A){return A.number}),t=e[__uv.$wrap((0))],r=e[__uv.$wrap((1))];e[__uv.$wrap((2))],e[__uv.$wrap((3))];var B=e[__uv.$wrap((4))],n=e[__uv.$wrap((5))];e[__uv.$wrap((6))],e[__uv.$wrap((7))],e[__uv.$wrap((8))],e[__uv.$wrap((9))],e[__uv.$wrap((10))],e[__uv.$wrap((11))];var s=e[__uv.$wrap((12))],A=e[__uv.$wrap((13))];return e[__uv.$wrap((14))],e[__uv.$wrap((15))],16===e.length?[t,r,B,n,s,A]:null}},he={type:16,number:50,flags:4},kt=[he,he],Rt={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(A,e){e=e.filter(te);return 2!==e.length?kt:[e[__uv.$wrap((0))],e[__uv.$wrap((1))]]}},Nt={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}};(he=Ze=Ze||{}).NORMAL="normal",he.BREAK_ALL="break-all";function Pt(A,e){return 0!=(A&e)}function Xt(A,e,t){return(A=A&&A[__uv.$wrap((Math.min(e,A.length-1)))])?t?A.open:A.close:""}var Jt={name:"word-break",initialValue:"normal",prefix:!(he.KEEP_ALL="keep-all"),type:2,parse:function(A,e){switch(e){case"break-all":return Ze.BREAK_ALL;case"keep-all":return Ze.KEEP_ALL;default:return Ze.NORMAL}}},Yt={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(A,e){if(20===e.type)return{auto:!0,order:0};if(ZA(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Wt=function(A,e){if(15===e.type)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")},Zt={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(A,e){return ZA(e)?e.number:1}},_t={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},qt={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).map(function(A){switch(A.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(A){return 0!==A})}},jt={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(A,e){var t=[],r=[];return e.forEach(function(A){switch(A.type){case 20:case 0:t.push(A.value);break;case 17:t.push(A.number.toString());break;case 4:r.push(t.join(" ")),t.length=0}}),t.length&&r.push(t.join(" ")),r.map(function(A){return-1===A.indexOf(" ")?A:"'"+A+"'"})}},zt={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},$t={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(A,e){return ZA(e)?e.number:!_A(e)||"bold"!==e.value?400:700}},Ar={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(A,e){return e.filter(_A).map(function(A){return A.value})}},er={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(A,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},tr={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(A,e){if(0===e.length)return[];var t=e[__uv.$wrap((0))];return 20===t.type&&"none"===t.value?[]:e}},rr={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return null;var t=e[__uv.$wrap((0))];if(20===t.type&&"none"===t.value)return null;for(var r=[],B=e.filter(zA),n=0;n<B.length;n++){var s=B[__uv.$wrap((n))],o=B[__uv.$wrap((n+1))];20===s.type&&(o=o&&ZA(o)?o.number:1,r.push({counter:s.value,increment:o}))}return r}},Br={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return[];for(var t=[],r=e.filter(zA),B=0;B<r.length;B++){var n=r[__uv.$wrap((B))],s=r[__uv.$wrap((B+1))];_A(n)&&"none"!==n.value&&(s=s&&ZA(s)?s.number:0,t.push({counter:n.value,reset:s}))}return t}},nr={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,A){return A.filter(WA).map(function(A){return Wt(e,A)})}},sr={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return null;var t=e[__uv.$wrap((0))];if(20===t.type&&"none"===t.value)return null;var r=[],B=e.filter(qA);if(B.length%2!=0)return null;for(var n=0;n<B.length;n+=2){var s=B[__uv.$wrap((n))].value,o=B[__uv.$wrap((n+1))].value;r.push({open:s,close:o})}return r}},or={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,A){return 1===A.length&&jA(A[__uv.$wrap((0))],"none")?[]:Ae(A).map(function(A){for(var e={color:255,offsetX:ae,offsetY:ae,blur:ae,spread:ae,inset:!1},t=0,r=0;r<A.length;r++){var B=A[__uv.$wrap((r))];jA(B,"inset")?e.inset=!0:ee(B)?(0===t?e.offsetX=B:1===t?e.offsetY=B:2===t?e.blur=B:e.spread=B,t++):e.color=ue(n,B)}return e})}},ir={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(A,e){var t=[];return e.filter(_A).forEach(function(A){switch(A.value){case"stroke":t.push(1);break;case"fill":t.push(0);break;case"markers":t.push(2)}}),[0,1,2].forEach(function(A){-1===t.indexOf(A)&&t.push(A)}),t}},Qr={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},cr={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(A,e){return WA(e)?e.number:0}},ar=(gr.prototype.isVisible=function(){return 0<this.display&&0<this.opacity&&0===this.visibility},gr.prototype.isTransparent=function(){return oe(this.backgroundColor)},gr.prototype.isTransformed=function(){return null!==this.transform},gr.prototype.isPositioned=function(){return 0!==this.position},gr.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},gr.prototype.isFloating=function(){return 0!==this.float},gr.prototype.isInlineLevel=function(){return Pt(this.display,4)||Pt(this.display,33554432)||Pt(this.display,268435456)||Pt(this.display,536870912)||Pt(this.display,67108864)||Pt(this.display,134217728)},gr);function gr(A,e){this.animationDuration=lr(A,nr,e.animationDuration),this.backgroundClip=lr(A,be,e.backgroundClip),this.backgroundColor=lr(A,De,e.backgroundColor),this.backgroundImage=lr(A,Re,e.backgroundImage),this.backgroundOrigin=lr(A,Ne,e.backgroundOrigin),this.backgroundPosition=lr(A,Pe,e.backgroundPosition),this.backgroundRepeat=lr(A,Xe,e.backgroundRepeat),this.backgroundSize=lr(A,_e,e.backgroundSize),this.borderTopColor=lr(A,je,e.borderTopColor),this.borderRightColor=lr(A,ze,e.borderRightColor),this.borderBottomColor=lr(A,$e,e.borderBottomColor),this.borderLeftColor=lr(A,At,e.borderLeftColor),this.borderTopLeftRadius=lr(A,et,e.borderTopLeftRadius),this.borderTopRightRadius=lr(A,tt,e.borderTopRightRadius),this.borderBottomRightRadius=lr(A,rt,e.borderBottomRightRadius),this.borderBottomLeftRadius=lr(A,Bt,e.borderBottomLeftRadius),this.borderTopStyle=lr(A,nt,e.borderTopStyle),this.borderRightStyle=lr(A,st,e.borderRightStyle),this.borderBottomStyle=lr(A,ot,e.borderBottomStyle),this.borderLeftStyle=lr(A,it,e.borderLeftStyle),this.borderTopWidth=lr(A,Qt,e.borderTopWidth),this.borderRightWidth=lr(A,ct,e.borderRightWidth),this.borderBottomWidth=lr(A,at,e.borderBottomWidth),this.borderLeftWidth=lr(A,gt,e.borderLeftWidth),this.boxShadow=lr(A,or,e.boxShadow),this.color=lr(A,wt,e.color),this.direction=lr(A,Ut,e.direction),this.display=lr(A,lt,e.display),this.float=lr(A,ut,e.cssFloat),this.fontFamily=lr(A,jt,e.fontFamily),this.fontSize=lr(A,zt,e.fontSize),this.fontStyle=lr(A,er,e.fontStyle),this.fontVariant=lr(A,Ar,e.fontVariant),this.fontWeight=lr(A,$t,e.fontWeight),this.letterSpacing=lr(A,Ft,e.letterSpacing),this.lineBreak=lr(A,ht,e.lineBreak),this.lineHeight=lr(A,dt,e.lineHeight),this.listStyleImage=lr(A,ft,e.listStyleImage),this.listStylePosition=lr(A,Ht,e.listStylePosition),this.listStyleType=lr(A,pt,e.listStyleType),this.marginTop=lr(A,Et,e.marginTop),this.marginRight=lr(A,It,e.marginRight),this.marginBottom=lr(A,yt,e.marginBottom),this.marginLeft=lr(A,Kt,e.marginLeft),this.opacity=lr(A,Zt,e.opacity);var t=lr(A,mt,e.overflow);this.overflowX=t[__uv.$wrap((0))],this.overflowY=t[__uv.$wrap((1<t.length?1:0))],this.overflowWrap=lr(A,Lt,e.overflowWrap),this.paddingTop=lr(A,bt,e.paddingTop),this.paddingRight=lr(A,Dt,e.paddingRight),this.paddingBottom=lr(A,vt,e.paddingBottom),this.paddingLeft=lr(A,xt,e.paddingLeft),this.paintOrder=lr(A,ir,e.paintOrder),this.position=lr(A,St,e.position),this.textAlign=lr(A,Mt,e.textAlign),this.textDecorationColor=lr(A,_t,null!==(t=e.textDecorationColor)&&void 0!==t?t:e.color),this.textDecorationLine=lr(A,qt,null!==(t=e.textDecorationLine)&&void 0!==t?t:e.textDecoration),this.textShadow=lr(A,Tt,e.textShadow),this.textTransform=lr(A,Gt,e.textTransform),this.transform=lr(A,Ot,e.transform),this.transformOrigin=lr(A,Rt,e.transformOrigin),this.visibility=lr(A,Nt,e.visibility),this.webkitTextStrokeColor=lr(A,Qr,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=lr(A,cr,e.webkitTextStrokeWidth),this.wordBreak=lr(A,Jt,e.wordBreak),this.zIndex=lr(A,Yt,e.zIndex)}for(var wr=function(A,e){this.content=lr(A,tr,e.content),this.quotes=lr(A,sr,e.quotes)},Ur=function(A,e){this.counterIncrement=lr(A,rr,e.counterIncrement),this.counterReset=lr(A,Br,e.counterReset)},lr=function(A,e,t){var r=new PA,t=null!=t?t.toString():e.initialValue;r.write(t);var B=new JA(r.read());switch(e.type){case 2:var n=B.parseComponentValue();return e.parse(A,_A(n)?n.value:e.initialValue);case 0:return e.parse(A,B.parseComponentValue());case 1:return e.parse(A,B.parseComponentValues());case 4:return B.parseComponentValue();case 3:switch(e.format){case"angle":return le(A,B.parseComponentValue());case"color":return ue(A,B.parseComponentValue());case"image":return Oe(A,B.parseComponentValue());case"length":var s=B.parseComponentValue();return ee(s)?s:ae;case"length-percentage":s=B.parseComponentValue();return te(s)?s:ae;case"time":return Wt(A,B.parseComponentValue())}}},Cr=function(A,e){A=function(A){switch(A.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(A);return 1===A||e===A},ur=function(A,e){this.context=A,this.textNodes=[],this.elements=[],this.flags=0,Cr(e,3),this.styles=new ar(A,window.getComputedStyle(e,null)),JB(e)&&(this.styles.animationDuration.some(function(A){return 0<A})&&(e.style.animationDuration="0s"),null!==this.styles.transform&&(e.style.transform="none")),this.bounds=f(this.context,e),Cr(e,4)&&(this.flags|=16)},Fr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hr="undefined"==typeof Uint8Array?[]:new Uint8Array(256),dr=0;dr<Fr.length;dr++)hr[__uv.$wrap((Fr.charCodeAt(dr)))]=dr;function fr(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var Hr=(pr.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=this.index[__uv.$wrap((A>>5))],this.data[__uv.$wrap((e=(e<<2)+(31&A)))];if(A<=65535)return e=this.index[__uv.$wrap((2048+(A-55296>>5)))],this.data[__uv.$wrap((e=(e<<2)+(31&A)))];if(A<this.highStart)return e=this.index[__uv.$wrap((e=2080+(A>>11)))],e=this.index[__uv.$wrap((e+=A>>5&63))],this.data[__uv.$wrap((e=(e<<2)+(31&A)))];if(A<=1114111)return this.data[__uv.$wrap((this.highValueIndex))]}return this.errorValue},pr);function pr(A,e,t,r,B,n){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=r,this.index=B,this.data=n}for(var Er="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ir="undefined"==typeof Uint8Array?[]:new Uint8Array(256),yr=0;yr<Er.length;yr++)Ir[__uv.$wrap((Er.charCodeAt(yr)))]=yr;function Kr(A){return kr.get(A)}function mr(A){var t=function(A){for(var e=[],t=0,r=A.length;t<r;){var B,n=A.charCodeAt(t++);55296<=n&&n<=56319&&t<r?56320==(64512&(B=A.charCodeAt(t++)))?e.push(((1023&n)<<10)+(1023&B)+65536):(e.push(n),t--):e.push(n)}return e}(A),r=t.length,B=0,n=0,s=t.map(Kr);return{next:function(){if(r<=B)return{done:!0,value:null};for(var A=Rr;B<r&&(A=function(A,e){var t=e-2,r=A[__uv.$wrap((t))],B=A[__uv.$wrap((e-1))],e=A[__uv.$wrap((e))];if(2===B&&3===e)return Rr;if(2===B||3===B||4===B)return"√∑";if(2===e||3===e||4===e)return"√∑";if(B===Tr&&-1!==[Tr,Gr,Or,Vr].indexOf(e))return Rr;if(!(B!==Or&&B!==Gr||e!==Gr&&10!==e))return Rr;if((B===Vr||10===B)&&10===e)return Rr;if(13===e||5===e)return Rr;if(7===e)return Rr;if(1===B)return Rr;if(13===B&&14===e){for(;5===r;)r=A[__uv.$wrap((--t))];if(14===r)return Rr}if(15===B&&15===e){for(var n=0;15===r;)n++,r=A[__uv.$wrap((--t))];if(n%2==0)return Rr}return"√∑"}(s,++B))===Rr;);if(A===Rr&&B!==r)return{done:!0,value:null};var e=function(){for(var A=[],e=0;e<arguments.length;e++)A[__uv.$wrap((e))]=arguments[__uv.$wrap((e))];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var r=[],B=-1,n="";++B<t;){var s=A[__uv.$wrap((B))];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(B+1===t||16384<r.length)&&(n+=String.fromCharCode.apply(String,r),r.length=0)}return n}.apply(null,t.slice(n,B));return n=B,{value:e,done:!1}}}}function Lr(A){return 0===A[__uv.$wrap((0))]&&255===A[__uv.$wrap((1))]&&0===A[__uv.$wrap((2))]&&255===A[__uv.$wrap((3))]}var br,Dr,vr,xr,Mr,Sr,Tr=8,Gr=9,Or=11,Vr=12,kr=(vr=function(A){var e,t,r,B,n=.75*A.length,s=A.length,o=0;"="===A[__uv.$wrap((A.length-1))]&&(n--,"="===A[__uv.$wrap((A.length-2))]&&n--);for(var n=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(n),i=Array.isArray(n)?n:new Uint8Array(n),Q=0;Q<s;Q+=4)e=hr[__uv.$wrap((A.charCodeAt(Q)))],t=hr[__uv.$wrap((A.charCodeAt(Q+1)))],r=hr[__uv.$wrap((A.charCodeAt(Q+2)))],B=hr[__uv.$wrap((A.charCodeAt(Q+3)))],i[__uv.$wrap((o++))]=e<<2|t>>4,i[__uv.$wrap((o++))]=(15&t)<<4|r>>2,i[__uv.$wrap((o++))]=(3&r)<<6|63&B;return n}(br="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),xr=Array.isArray(vr)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=4)t.push(A[__uv.$wrap((r+3))]<<24|A[__uv.$wrap((r+2))]<<16|A[__uv.$wrap((r+1))]<<8|A[__uv.$wrap((r))]);return t}(vr):new Uint32Array(vr),Mr=Array.isArray(vr)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=2)t.push(A[__uv.$wrap((r+1))]<<8|A[__uv.$wrap((r))]);return t}(vr):new Uint16Array(vr),br=fr(Mr,12,xr[__uv.$wrap((4))]/2),Dr=2===xr[__uv.$wrap((5))]?fr(Mr,(24+xr[__uv.$wrap((4))])/2):(vr=xr,Mr=Math.ceil((24+xr[__uv.$wrap((4))])/4),vr.slice?vr.slice(Mr,Dr):new Uint32Array(Array.prototype.slice.call(vr,Mr,Dr))),new Hr(xr[__uv.$wrap((0))],xr[__uv.$wrap((1))],xr[__uv.$wrap((2))],xr[__uv.$wrap((3))],br,Dr)),Rr="√ó",Nr=function(A,e,t,r,B){var n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),n=document.createElementNS(n,"foreignObject");return s.setAttributeNS(null,"width",A.toString()),s.setAttributeNS(null,"height",e.toString()),n.setAttributeNS(null,"width","100%"),n.setAttributeNS(null,"height","100%"),n.setAttributeNS(null,"x",t.toString()),n.setAttributeNS(null,"y",r.toString()),n.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(n),n.appendChild(B),s},Pr=function(r){return new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},Xr={get SUPPORT_RANGE_BOUNDS(){var A=function(A){if(A.createRange){var e=A.createRange();if(e.getBoundingClientRect){var t=A.createElement("boundtest");t.style.height="123px",t.style.display="block",A.body.appendChild(t),e.selectNode(t);e=e.getBoundingClientRect(),e=Math.round(e.height);if(A.body.removeChild(t),123===e)return!0}}return!1}(document);return Object.defineProperty(Xr,"SUPPORT_RANGE_BOUNDS",{value:A}),A},get SUPPORT_WORD_BREAKING(){var A=Xr.SUPPORT_RANGE_BOUNDS&&function(A){var e=A.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",A.body.appendChild(e);var r=A.createRange();e.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var B=e.firstChild,t=Q(B.data).map(function(A){return g(A)}),n=0,s={},t=t.every(function(A,e){r.setStart(B,n),r.setEnd(B,n+A.length);var t=r.getBoundingClientRect();n+=A.length;A=t.x>s.x||t.y>s.y;return s=t,0===e||A});return A.body.removeChild(e),t}(document);return Object.defineProperty(Xr,"SUPPORT_WORD_BREAKING",{value:A}),A},get SUPPORT_SVG_DRAWING(){var A=function(A){var e=new Image,t=A.createElement("canvas"),A=t.getContext("2d");if(!A)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{A.drawImage(e,0,0),t.toDataURL()}catch(A){return!1}return!0}(document);return Object.defineProperty(Xr,"SUPPORT_SVG_DRAWING",{value:A}),A},get SUPPORT_FOREIGNOBJECT_DRAWING(){var A="function"==typeof Array.from&&"function"==typeof window.fetch?function(t){var A=t.createElement("canvas"),r=100;A.width=r,A.height=r;var B=A.getContext("2d");if(!B)return Promise.reject(!1);B.fillStyle="rgb(0, 255, 0)",B.fillRect(0,0,r,r);var e=new Image,n=A.toDataURL();e.src=n;e=Nr(r,r,0,0,e);return B.fillStyle="red",B.fillRect(0,0,r,r),Pr(e).then(function(A){B.drawImage(A,0,0);var e=B.getImageData(0,0,r,r).data;B.fillStyle="red",B.fillRect(0,0,r,r);A=t.createElement("div");return A.style.backgroundImage="url("+n+")",A.style.height="100px",Lr(e)?Pr(Nr(r,r,0,0,A)):Promise.reject(!1)}).then(function(A){return B.drawImage(A,0,0),Lr(B.getImageData(0,0,r,r).data)}).catch(function(){return!1})}(document):Promise.resolve(!1);return Object.defineProperty(Xr,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:A}),A},get SUPPORT_CORS_IMAGES(){var A=void 0!==(new Image).crossOrigin;return Object.defineProperty(Xr,"SUPPORT_CORS_IMAGES",{value:A}),A},get SUPPORT_RESPONSE_TYPE(){var A="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Xr,"SUPPORT_RESPONSE_TYPE",{value:A}),A},get SUPPORT_CORS_XHR(){var A="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Xr,"SUPPORT_CORS_XHR",{value:A}),A},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var A=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Xr,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:A}),A}},Jr=function(A,e){this.text=A,this.bounds=e},Yr=function(A,e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));t=e.parentNode;if(t){t.replaceChild(r,e);A=f(A,r);return r.firstChild&&t.replaceChild(r.firstChild,r),A}}return d.EMPTY},Wr=function(A,e,t){var r=A.ownerDocument;if(!r)throw new Error("Node has no owner document");r=r.createRange();return r.setStart(A,e),r.setEnd(A,e+t),r},Zr=function(A){if(Xr.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(A)).map(function(A){return A.segment})}return function(A){for(var e,t=mr(A),r=[];!(e=t.next()).done;)e.value&&r.push(e.value.slice());return r}(A)},_r=function(A,e){return 0!==e.letterSpacing?Zr(A):function(A,e){if(Xr.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(A)).map(function(A){return A.segment})}return jr(A,e)}(A,e)},qr=[32,160,4961,65792,65793,4153,4241],jr=function(A,e){for(var t,r=wA(A,{lineBreak:e.lineBreak,wordBreak:"break-word"===e.overflowWrap?"break-word":e.wordBreak}),B=[];!(t=r.next()).done;)!function(){var A,e;t.value&&(A=t.value.slice(),A=Q(A),e="",A.forEach(function(A){-1===qr.indexOf(A)?e+=g(A):(e.length&&B.push(e),B.push(g(A)),e="")}),e.length&&B.push(e))}();return B},zr=function(A,e,t){var B,n,s,o,i;this.text=$r(e.data,t.textTransform),this.textBounds=(B=A,A=this.text,s=e,A=_r(A,n=t),o=[],i=0,A.forEach(function(A){var e,t,r;n.textDecorationLine.length||0<A.trim().length?Xr.SUPPORT_RANGE_BOUNDS?1<(r=Wr(s,i,A.length).getClientRects()).length?(e=Zr(A),t=0,e.forEach(function(A){o.push(new Jr(A,d.fromDOMRectList(B,Wr(s,t+i,A.length).getClientRects()))),t+=A.length})):o.push(new Jr(A,d.fromDOMRectList(B,r))):(r=s.splitText(A.length),o.push(new Jr(A,Yr(B,s))),s=r):Xr.SUPPORT_RANGE_BOUNDS||(s=s.splitText(A.length)),i+=A.length}),o)},$r=function(A,e){switch(e){case 1:return A.toLowerCase();case 3:return A.replace(AB,eB);case 2:return A.toUpperCase();default:return A}},AB=/(^|\s|:|-|\(|\))([a-z])/g,eB=function(A,e,t){return 0<A.length?e+t.toUpperCase():A},tB=(A(rB,Sr=ur),rB);function rB(A,e){A=Sr.call(this,A,e)||this;return A.src=e.currentSrc||e.src,A.intrinsicWidth=e.naturalWidth,A.intrinsicHeight=e.naturalHeight,A.context.cache.addImage(A.src),A}var BB,nB=(A(sB,BB=ur),sB);function sB(A,e){A=BB.call(this,A,e)||this;return A.canvas=e,A.intrinsicWidth=e.width,A.intrinsicHeight=e.height,A}var oB,iB=(A(QB,oB=ur),QB);function QB(A,e){var t=oB.call(this,A,e)||this,r=new XMLSerializer,A=f(A,e);return e.setAttribute("width",A.width+"px"),e.setAttribute("height",A.height+"px"),t.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(e)),t.intrinsicWidth=e.width.baseVal.value,t.intrinsicHeight=e.height.baseVal.value,t.context.cache.addImage(t.svg),t}var cB,aB=(A(gB,cB=ur),gB);function gB(A,e){A=cB.call(this,A,e)||this;return A.value=e.value,A}var wB,UB=(A(lB,wB=ur),lB);function lB(A,e){A=wB.call(this,A,e)||this;return A.start=e.start,A.reversed="boolean"==typeof e.reversed&&!0===e.reversed,A}var CB,uB=[{type:15,flags:0,unit:"px",number:3}],FB=[{type:16,flags:0,number:50}],hB="checkbox",dB="radio",fB="password",HB=707406591,pB=(A(EB,CB=ur),EB);function EB(A,e){var t=CB.call(this,A,e)||this;switch(t.type=e.type.toLowerCase(),t.checked=e.checked,t.value=0===(e=(A=e).type===fB?new Array(A.value.length+1).join("‚Ä¢"):A.value).length?A.placeholder||"":e,t.type!==hB&&t.type!==dB||(t.styles.backgroundColor=3739148031,t.styles.borderTopColor=t.styles.borderRightColor=t.styles.borderBottomColor=t.styles.borderLeftColor=2779096575,t.styles.borderTopWidth=t.styles.borderRightWidth=t.styles.borderBottomWidth=t.styles.borderLeftWidth=1,t.styles.borderTopStyle=t.styles.borderRightStyle=t.styles.borderBottomStyle=t.styles.borderLeftStyle=1,t.styles.backgroundClip=[0],t.styles.backgroundOrigin=[0],t.bounds=(e=t.bounds).width>e.height?new d(e.left+(e.width-e.height)/2,e.__uv$setSource(__uv).__uv$top,e.height,e.height):e.width<e.height?new d(e.left,e.__uv$setSource(__uv).__uv$top+(e.height-e.width)/2,e.width,e.width):e),t.type){case hB:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=uB;break;case dB:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=FB}return t}var IB,yB=(A(KB,IB=ur),KB);function KB(A,e){A=IB.call(this,A,e)||this,e=e.options[__uv.$wrap((e.selectedIndex||0))];return A.value=e&&e.text||"",A}var mB,LB=(A(bB,mB=ur),bB);function bB(A,e){A=mB.call(this,A,e)||this;return A.value=e.value,A}var DB,vB=(A(xB,DB=ur),xB);function xB(A,e){var t,r,B=DB.call(this,A,e)||this;B.src=e.src,B.width=parseInt(e.width,10)||0,B.height=parseInt(e.height,10)||0,B.backgroundColor=B.styles.backgroundColor;try{e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.documentElement&&(B.tree=kB(A,e.contentWindow.document.documentElement),t=e.contentWindow.document.documentElement?fe(A,getComputedStyle(e.contentWindow.document.documentElement).backgroundColor):Le.TRANSPARENT,r=e.contentWindow.document.body?fe(A,getComputedStyle(e.contentWindow.document.body).backgroundColor):Le.TRANSPARENT,B.backgroundColor=oe(t)?oe(r)?B.styles.backgroundColor:r:t)}catch(A){}return B}function MB(A){return"VIDEO"===A.tagName}function SB(A){return"STYLE"===A.tagName}function TB(A){return 0<A.tagName.indexOf("-")}var GB=["OL","UL","MENU"],OB=function(e,A,t,r){for(var B=A.firstChild;B;B=s){var n,s=B.nextSibling;PB(B)&&0<B.data.trim().length?t.textNodes.push(new zr(e,B,t.styles)):XB(B)&&(rn(B)&&B.assignedNodes?B.assignedNodes().forEach(function(A){return OB(e,A,t,r)}):(n=VB(e,B)).styles.isVisible()&&(RB(B,n,r)?n.flags|=4:NB(n.styles)&&(n.flags|=2),-1!==GB.indexOf(B.tagName)&&(n.flags|=8),t.elements.push(n),B.slot,B.shadowRoot?OB(e,B.shadowRoot,n,r):en(B)||qB(B)||tn(B)||OB(e,B,n,r)))}},VB=function(A,e){return new($B(e)?tB:zB(e)?nB:qB(e)?iB:WB(e)?aB:ZB(e)?UB:_B(e)?pB:tn(e)?yB:en(e)?LB:An(e)?vB:ur)(A,e)},kB=function(A,e){var t=VB(A,e);return t.flags|=4,OB(A,e,t,t),t},RB=function(A,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||jB(A)&&t.styles.isTransparent()},NB=function(A){return A.isPositioned()||A.isFloating()},PB=function(A){return A.nodeType===Node.TEXT_NODE},XB=function(A){return A.nodeType===Node.ELEMENT_NODE},JB=function(A){return XB(A)&&void 0!==A.style&&!YB(A)},YB=function(A){return"object"==typeof A.className},WB=function(A){return"LI"===A.tagName},ZB=function(A){return"OL"===A.tagName},_B=function(A){return"INPUT"===A.tagName},qB=function(A){return"svg"===A.tagName},jB=function(A){return"BODY"===A.tagName},zB=function(A){return"CANVAS"===A.tagName},$B=function(A){return"IMG"===A.tagName},An=function(A){return"IFRAME"===A.tagName},en=function(A){return"TEXTAREA"===A.tagName},tn=function(A){return"SELECT"===A.tagName},rn=function(A){return"SLOT"===A.tagName},Bn=(nn.prototype.getCounterValue=function(A){A=this.counters[__uv.$wrap((A))];return A&&A.length?A[__uv.$wrap((A.length-1))]:1},nn.prototype.getCounterValues=function(A){A=this.counters[__uv.$wrap((A))];return A||[]},nn.prototype.pop=function(A){var e=this;A.forEach(function(A){return e.counters[__uv.$wrap((A))].pop()})},nn.prototype.parse=function(A){var t=this,e=A.counterIncrement,A=A.counterReset,r=!0;null!==e&&e.forEach(function(A){var e=t.counters[__uv.$wrap((A.counter))];e&&0!==A.increment&&(r=!1,e.length||e.push(1),e[__uv.$wrap((Math.max(0,e.length-1)))]+=A.increment)});var B=[];return r&&A.forEach(function(A){var e=t.counters[__uv.$wrap((A.counter))];B.push(A.counter),(e=e||(t.counters[__uv.$wrap((A.counter))]=[])).push(A.reset)}),B},nn);function nn(){this.counters={}}function sn(r,A,e,B,t,n){return r<A||e<r?Fn(r,t,0<n.length):B.integers.reduce(function(A,e,t){for(;e<=r;)r-=e,A+=B.values[__uv.$wrap((t))];return A},"")+n}function on(A,e,t,r){for(var B="";t||A--,B=r(A)+B,e<=(A/=e)*e;);return B}function Qn(A,e,t,r,B){var n=t-e+1;return(A<0?"-":"")+(on(Math.abs(A),n,r,function(A){return g(Math.floor(A%n)+e)})+B)}function cn(A,e,t){void 0===t&&(t=". ");var r=e.length;return on(Math.abs(A),r,!1,function(A){return e[__uv.$wrap((Math.floor(A%r)))]})+t}function an(A,e,t,r,B,n){if(A<-9999||9999<A)return Fn(A,4,0<B.length);var s=Math.abs(A),o=B;if(0===s)return e[__uv.$wrap((0))]+o;for(var i=0;0<s&&i<=4;i++){var Q=s%10;0==Q&&Pt(n,1)&&""!==o?o=e[__uv.$wrap((Q))]+o:1<Q||1==Q&&0===i||1==Q&&1===i&&Pt(n,2)||1==Q&&1===i&&Pt(n,4)&&100<A||1==Q&&1<i&&Pt(n,8)?o=e[__uv.$wrap((Q))]+(0<i?t[__uv.$wrap((i-1))]:"")+o:1==Q&&0<i&&(o=t[__uv.$wrap((i-1))]+o),s=Math.floor(s/10)}return(A<0?r:"")+o}var gn,wn={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Un={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["’î","’ì","’í","’ë","’ê","’è","’é","’ç","’å","’ã","’ä","’â","’à","’á","’Ü","’Ö","’Ñ","’É","’Ç","’Å","’Ä","‘ø","‘æ","‘Ω","‘º","‘ª","‘∫","‘π","‘∏","‘∑","‘∂","‘µ","‘¥","‘≥","‘≤","‘±"]},ln={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["◊ô◊≥","◊ò◊≥","◊ó◊≥","◊ñ◊≥","◊ï◊≥","◊î◊≥","◊ì◊≥","◊í◊≥","◊ë◊≥","◊ê◊≥","◊™","◊©","◊®","◊ß","◊¶","◊§","◊¢","◊°","◊†","◊û","◊ú","◊õ","◊ô◊ò","◊ô◊ó","◊ô◊ñ","◊ò◊ñ","◊ò◊ï","◊ô","◊ò","◊ó","◊ñ","◊ï","◊î","◊ì","◊í","◊ë","◊ê"]},Cn={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["·Éµ","·É∞","·ÉØ","·É¥","·ÉÆ","·É≠","·É¨","·É´","·É™","·É©","·É®","·Éß","·É¶","·É•","·É§","·É≥","·É¢","·É°","·É†","·Éü","·Éû","·Éù","·É≤","·Éú","·Éõ","·Éö","·Éô","·Éò","·Éó","·É±","·Éñ","·Éï","·Éî","·Éì","·Éí","·Éë","·Éê"]},un="ÎßàÏù¥ÎÑàÏä§",Fn=function(A,e,t){var r=t?". ":"",B=t?"„ÄÅ":"",n=t?", ":"",s=t?" ":"";switch(e){case 0:return"‚Ä¢"+s;case 1:return"‚ó¶"+s;case 2:return"‚óæ"+s;case 5:var o=Qn(A,48,57,!0,r);return o.length<4?"0"+o:o;case 4:return cn(A,"„Äá‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù",B);case 6:return sn(A,1,3999,wn,3,r).toLowerCase();case 7:return sn(A,1,3999,wn,3,r);case 8:return Qn(A,945,969,!1,r);case 9:return Qn(A,97,122,!1,r);case 10:return Qn(A,65,90,!1,r);case 11:return Qn(A,1632,1641,!0,r);case 12:case 49:return sn(A,1,9999,Un,3,r);case 35:return sn(A,1,9999,Un,3,r).toLowerCase();case 13:return Qn(A,2534,2543,!0,r);case 14:case 30:return Qn(A,6112,6121,!0,r);case 15:return cn(A,"Â≠ê‰∏ëÂØÖÂçØËæ∞Â∑≥ÂçàÊú™Áî≥ÈÖâÊàå‰∫•",B);case 16:return cn(A,"Áî≤‰πô‰∏ô‰∏ÅÊàäÂ∑±Â∫öËæõÂ£¨Áô∏",B);case 17:case 48:return an(A,"Èõ∂‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù","ÂçÅÁôæÂçÉËê¨","Ë≤†",B,14);case 47:return an(A,"Èõ∂Â£πË≤≥ÂèÉËÇÜ‰ºçÈô∏ÊüíÊçåÁéñ","Êãæ‰Ω∞‰ªüËê¨","Ë≤†",B,15);case 42:return an(A,"Èõ∂‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù","ÂçÅÁôæÂçÉËê¨","Ë¥ü",B,14);case 41:return an(A,"Èõ∂Â£πË¥∞ÂèÅËÇÜ‰ºçÈôÜÊüíÊçåÁéñ","Êãæ‰Ω∞‰ªüËê¨","Ë¥ü",B,15);case 26:return an(A,"„Äá‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù","ÂçÅÁôæÂçÉ‰∏á","„Éû„Ç§„Éä„Çπ",B,0);case 25:return an(A,"Èõ∂Â£±ÂºêÂèÇÂõõ‰ºçÂÖ≠‰∏ÉÂÖ´‰πù","ÊãæÁôæÂçÉ‰∏á","„Éû„Ç§„Éä„Çπ",B,7);case 31:return an(A,"ÏòÅÏùºÏù¥ÏÇºÏÇ¨Ïò§Ïú°Ïπ†ÌåîÍµ¨","Ïã≠Î∞±Ï≤úÎßå",un,n,7);case 33:return an(A,"Èõ∂‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù","ÂçÅÁôæÂçÉËê¨",un,n,0);case 32:return an(A,"Èõ∂Â£πË≤≥ÂèÉÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πù","ÊãæÁôæÂçÉ",un,n,7);case 18:return Qn(A,2406,2415,!0,r);case 20:return sn(A,1,19999,Cn,3,r);case 21:return Qn(A,2790,2799,!0,r);case 22:return Qn(A,2662,2671,!0,r);case 22:return sn(A,1,10999,ln,3,r);case 23:return cn(A,"„ÅÇ„ÅÑ„ÅÜ„Åà„Åä„Åã„Åç„Åè„Åë„Åì„Åï„Åó„Åô„Åõ„Åù„Åü„Å°„Å§„Å¶„Å®„Å™„Å´„Å¨„Å≠„ÅÆ„ÅØ„Å≤„Åµ„Å∏„Åª„Åæ„Åø„ÇÄ„ÇÅ„ÇÇ„ÇÑ„ÇÜ„Çà„Çâ„Çä„Çã„Çå„Çç„Çè„Çê„Çë„Çí„Çì");case 24:return cn(A,"„ÅÑ„Çç„ÅØ„Å´„Åª„Å∏„Å®„Å°„Çä„Å¨„Çã„Çí„Çè„Åã„Çà„Åü„Çå„Åù„Å§„Å≠„Å™„Çâ„ÇÄ„ÅÜ„Çê„ÅÆ„Åä„Åè„ÇÑ„Åæ„Åë„Åµ„Åì„Åà„Å¶„ÅÇ„Åï„Åç„ÇÜ„ÇÅ„Åø„Åó„Çë„Å≤„ÇÇ„Åõ„Åô");case 27:return Qn(A,3302,3311,!0,r);case 28:return cn(A,"„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É∞„É±„É≤„É≥",B);case 29:return cn(A,"„Ç§„É≠„Éè„Éã„Éõ„Éò„Éà„ÉÅ„É™„Éå„É´„É≤„ÉØ„Ç´„É®„Çø„É¨„ÇΩ„ÉÑ„Éç„Éä„É©„É†„Ç¶„É∞„Éé„Ç™„ÇØ„É§„Éû„Ç±„Éï„Ç≥„Ç®„ÉÜ„Ç¢„Çµ„Ç≠„É¶„É°„Éü„Ç∑„É±„Éí„É¢„Çª„Çπ",B);case 34:return Qn(A,3792,3801,!0,r);case 37:return Qn(A,6160,6169,!0,r);case 38:return Qn(A,4160,4169,!0,r);case 39:return Qn(A,2918,2927,!0,r);case 40:return Qn(A,1776,1785,!0,r);case 43:return Qn(A,3046,3055,!0,r);case 44:return Qn(A,3174,3183,!0,r);case 45:return Qn(A,3664,3673,!0,r);case 46:return Qn(A,3872,3881,!0,r);default:return Qn(A,48,57,!0,r)}},hn="data-html2canvas-ignore",dn=(fn.prototype.toIFrame=function(A,r){var e=this,B=pn(A,r);if(!B.contentWindow)return Promise.reject("Unable to find iframe window");var t=A.defaultView.pageXOffset,n=A.defaultView.pageYOffset,s=B.contentWindow,o=s.document,A=In(B).then(function(){return a(e,void 0,void 0,function(){var e,t;return H(this,function(A){switch(A.label){case 0:return this.scrolledElements.forEach(bn),s&&(s.scrollTo(r.left,r.__uv$setSource(__uv).__uv$top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||s.scrollY===r.__uv$setSource(__uv).__uv$top&&s.scrollX===r.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-r.left,s.scrollY-r.__uv$setSource(__uv).__uv$top,0,0))),e=this.options.onclone,void 0===(t=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:o.fonts&&o.fonts.ready?[4,o.fonts.ready]:[3,2];case 1:A.sent(),A.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,En(o)]:[3,4];case 3:A.sent(),A.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then(function(){return e(o,t)}).then(function(){return B})]:[2,B]}})})});return o.open(),o.write(mn(document.doctype)+"<html></html>"),Ln(this.referenceElement.ownerDocument,t,n),o.replaceChild(o.adoptNode(this.documentElement),o.documentElement),o.close(),A},fn.prototype.createElementClone=function(A){if(Cr(A,2),zB(A))return this.createCanvasClone(A);if(MB(A))return this.createVideoClone(A);if(SB(A))return this.createStyleClone(A);var e=A.cloneNode(!1);return $B(e)&&($B(A)&&A.currentSrc&&A.currentSrc!==A.src&&(e.src=A.currentSrc,e.srcset=""),"lazy"===e.loading&&(e.loading="eager")),TB(e)?this.createCustomElementClone(e):e},fn.prototype.createCustomElementClone=function(A){var e=document.createElement("html2canvascustomelement");return Kn(A.style,e),e},fn.prototype.createStyleClone=function(A){try{var e=A.sheet;if(e&&e.cssRules){var t=[].slice.call(e.cssRules,0).reduce(function(A,e){return e&&"string"==typeof e.cssText?A+e.cssText:A},""),r=A.cloneNode(!1);return r.textContent=t,r}}catch(A){if(this.context.logger.error("Unable to access cssRules property",A),"SecurityError"!==A.name)throw A}return A.cloneNode(!1)},fn.prototype.createCanvasClone=function(e){var A;if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(A){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}t=e.cloneNode(!1);try{t.width=e.width,t.height=e.height;var r,B,n=e.getContext("2d"),s=t.getContext("2d");return s&&(!this.options.allowTaint&&n?s.putImageData(n.getImageData(0,0,e.width,e.height),0,0):(!(r=null!==(A=e.getContext("webgl2"))&&void 0!==A?A:e.getContext("webgl"))||!1===(null==(B=r.getContextAttributes())?void 0:B.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e),s.drawImage(e,0,0))),t}catch(A){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return t},fn.prototype.createVideoClone=function(e){var A=e.ownerDocument.createElement("canvas");A.width=e.offsetWidth,A.height=e.offsetHeight;var t=A.getContext("2d");try{return t&&(t.drawImage(e,0,0,A.width,A.height),this.options.allowTaint||t.getImageData(0,0,A.width,A.height)),A}catch(A){this.context.logger.info("Unable to clone video as it is tainted",e)}A=e.ownerDocument.createElement("canvas");return A.width=e.offsetWidth,A.height=e.offsetHeight,A},fn.prototype.appendChildNode=function(A,e,t){XB(e)&&("SCRIPT"===e.tagName||e.hasAttribute(hn)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(e))||this.options.copyStyles&&XB(e)&&SB(e)||A.appendChild(this.cloneNode(e,t))},fn.prototype.cloneChildNodes=function(A,e,t){for(var r,B=this,n=(A.shadowRoot||A).firstChild;n;n=n.nextSibling)XB(n)&&rn(n)&&"function"==typeof n.assignedNodes?(r=n.assignedNodes()).length&&r.forEach(function(A){return B.appendChildNode(e,A,t)}):this.appendChildNode(e,n,t)},fn.prototype.cloneNode=function(A,e){if(PB(A))return document.createTextNode(A.data);if(!A.ownerDocument)return A.cloneNode(!1);var t=A.ownerDocument.defaultView;if(t&&XB(A)&&(JB(A)||YB(A))){var r=this.createElementClone(A);r.style.transitionProperty="none";var B=t.getComputedStyle(A),n=t.getComputedStyle(A,":before"),s=t.getComputedStyle(A,":after");this.referenceElement===A&&JB(r)&&(this.clonedReferenceElement=r),jB(r)&&Mn(r);t=this.counters.parse(new Ur(this.context,B)),n=this.resolvePseudoContent(A,r,n,gn.BEFORE);TB(A)&&(e=!0),MB(A)||this.cloneChildNodes(A,r,e),n&&r.insertBefore(n,r.firstChild);s=this.resolvePseudoContent(A,r,s,gn.AFTER);return s&&r.appendChild(s),this.counters.pop(t),(B&&(this.options.copyStyles||YB(A))&&!An(A)||e)&&Kn(B,r),0===A.scrollTop&&0===A.scrollLeft||this.scrolledElements.push([r,A.scrollLeft,A.scrollTop]),(en(A)||tn(A))&&(en(r)||tn(r))&&(r.value=A.value),r}return A.cloneNode(!1)},fn.prototype.resolvePseudoContent=function(o,A,e,t){var i=this;if(e){var r=e.content,Q=A.ownerDocument;if(Q&&r&&"none"!==r&&"-moz-alt-content"!==r&&"none"!==e.display){this.counters.parse(new Ur(this.context,e));var c=new wr(this.context,e),a=Q.createElement("html2canvaspseudoelement");Kn(e,a),c.content.forEach(function(A){if(0===A.type)a.appendChild(Q.createTextNode(A.value));else if(22===A.type){var e=Q.createElement("img");e.src=A.value,e.style.opacity="1",a.appendChild(e)}else if(18===A.type){var t,r,B,n,s;"attr"===A.name?(e=A.values.filter(_A)).length&&a.appendChild(Q.createTextNode(o.getAttribute(e[__uv.$wrap((0))].value)||"")):"counter"===A.name?(B=(r=A.values.filter($A))[__uv.$wrap((0))],r=r[__uv.$wrap((1))],B&&_A(B)&&(t=i.counters.getCounterValue(B.value),s=r&&_A(r)?pt.parse(i.context,r.value):3,a.appendChild(Q.createTextNode(Fn(t,s,!1))))):"counters"===A.name&&(B=(t=A.values.filter($A))[__uv.$wrap((0))],s=t[__uv.$wrap((1))],r=t[__uv.$wrap((2))],B&&_A(B)&&(B=i.counters.getCounterValues(B.value),n=r&&_A(r)?pt.parse(i.context,r.value):3,s=s&&0===s.type?s.value:"",s=B.map(function(A){return Fn(A,n,!1)}).join(s),a.appendChild(Q.createTextNode(s))))}else if(20===A.type)switch(A.value){case"open-quote":a.appendChild(Q.createTextNode(Xt(c.quotes,i.quoteDepth++,!0)));break;case"close-quote":a.appendChild(Q.createTextNode(Xt(c.quotes,--i.quoteDepth,!1)));break;default:a.appendChild(Q.createTextNode(A.value))}}),a.className=Dn+" "+vn;t=t===gn.BEFORE?" "+Dn:" "+vn;return YB(A)?A.className.baseValue+=t:A.className+=t,a}}},fn.destroy=function(A){return!!A.parentNode&&(A.parentNode.removeChild(A),!0)},fn);function fn(A,e,t){if(this.context=A,this.options=t,this.scrolledElements=[],this.referenceElement=e,this.counters=new Bn,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}(he=gn=gn||{})[__uv.$wrap((he.BEFORE=0))]="BEFORE",he[__uv.$wrap((he.AFTER=1))]="AFTER";function Hn(e){return new Promise(function(A){!e.complete&&e.src?(e.onload=A,e.onerror=A):A()})}var pn=function(A,e){var t=A.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.__uv$setSource(__uv).__uv$top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(hn,"true"),A.body.appendChild(t),t},En=function(A){return Promise.all([].slice.call(A.images,0).map(Hn))},In=function(B){return new Promise(function(e,A){var t=B.contentWindow;if(!t)return A("No window assigned for iframe");var r=t.document;t.onload=B.onload=function(){t.onload=B.onload=null;var A=setInterval(function(){0<r.body.childNodes.length&&"complete"===r.readyState&&(clearInterval(A),e(B))},50)}})},yn=["all","d","content"],Kn=function(A,e){for(var t=A.length-1;0<=t;t--){var r=A.item(t);-1===yn.indexOf(r)&&e.style.setProperty(r,A.getPropertyValue(r))}return e},mn=function(A){var e="";return A&&(e+="<!DOCTYPE ",A.name&&(e+=A.name),A.internalSubset&&(e+=A.internalSubset),A.publicId&&(e+='"'+A.publicId+'"'),A.systemId&&(e+='"'+A.systemId+'"'),e+=">"),e},Ln=function(A,e,t){A&&A.defaultView&&(e!==A.defaultView.pageXOffset||t!==A.defaultView.pageYOffset)&&A.defaultView.scrollTo(e,t)},bn=function(A){var e=A[__uv.$wrap((0))],t=A[__uv.$wrap((1))],A=A[__uv.$wrap((2))];e.scrollLeft=t,e.scrollTop=A},Dn="___html2canvas___pseudoelement_before",vn="___html2canvas___pseudoelement_after",xn='{\n    content: "" !important;\n    display: none !important;\n}',Mn=function(A){Sn(A,"."+Dn+":before"+xn+"\n         ."+vn+":after"+xn)},Sn=function(A,e){var t=A.ownerDocument;t&&((t=t.createElement("style")).textContent=e,A.appendChild(t))},Tn=(Gn.getOrigin=function(A){var e=Gn._link;return e?(e.href=A,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},Gn.isSameOrigin=function(A){return Gn.getOrigin(A)===Gn._origin},Gn.setContext=function(A){Gn._link=A.document.createElement("a"),Gn._origin=Gn.getOrigin(A.__uv$setSource(__uv).__uv$location.href)},Gn._origin="about:blank",Gn);function Gn(){}var On=(Vn.prototype.addImage=function(A){var e=Promise.resolve();return this.has(A)||(Yn(A)||Pn(A))&&(this._cache[__uv.$wrap((A))]=this.loadImage(A)).catch(function(){}),e},Vn.prototype.match=function(A){return this._cache[__uv.$wrap((A))]},Vn.prototype.loadImage=function(s){return a(this,void 0,void 0,function(){var e,r,t,B,n=this;return H(this,function(A){switch(A.label){case 0:return(e=Tn.isSameOrigin(s),r=!Xn(s)&&!0===this._options.useCORS&&Xr.SUPPORT_CORS_IMAGES&&!e,t=!Xn(s)&&!e&&!Yn(s)&&"string"==typeof this._options.proxy&&Xr.SUPPORT_CORS_XHR&&!r,e||!1!==this._options.allowTaint||Xn(s)||Yn(s)||t||r)?(B=s,t?[4,this.proxy(B)]:[3,2]):[2];case 1:B=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+s.substring(0,256)),[4,new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,(Jn(B)||r)&&(t.crossOrigin="anonymous"),t.src=B,!0===t.complete&&setTimeout(function(){return A(t)},500),0<n._options.imageTimeout&&setTimeout(function(){return e("Timed out ("+n._options.imageTimeout+"ms) loading image")},n._options.imageTimeout)})];case 3:return[2,A.sent()]}})})},Vn.prototype.has=function(A){return void 0!==this._cache[__uv.$wrap((A))]},Vn.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},Vn.prototype.proxy=function(s){var o=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var Q=s.substring(0,256);return new Promise(function(e,t){var r=Xr.SUPPORT_RESPONSE_TYPE?"blob":"text",B=new XMLHttpRequest;B.onload=function(){var A;200===B.status?"text"==r?e(B.response):((A=new FileReader).addEventListener("load",function(){return e(A.result)},!1),A.addEventListener("error",function(A){return t(A)},!1),A.readAsDataURL(B.response)):t("Failed to proxy resource "+Q+" with status code "+B.status)},B.onerror=t;var A,n=-1<i.indexOf("?")?"&":"?";B.open("GET",i+n+"url="+encodeURIComponent(s)+"&responseType="+r),"text"!=r&&B instanceof XMLHttpRequest&&(B.responseType=r),o._options.imageTimeout&&(A=o._options.imageTimeout,B.timeout=A,B.ontimeout=function(){return t("Timed out ("+A+"ms) proxying "+Q)}),B.send()})},Vn);function Vn(A,e){this.context=A,this._options=e,this._cache={}}var kn=/^data:image\/svg\+xml/i,Rn=/^data:image\/.*;base64,/i,Nn=/^data:image\/.*/i,Pn=function(A){return Xr.SUPPORT_SVG_DRAWING||!Wn(A)},Xn=function(A){return Nn.test(A)},Jn=function(A){return Rn.test(A)},Yn=function(A){return"blob"===A.substr(0,4)},Wn=function(A){return"svg"===A.substr(-3).toLowerCase()||kn.test(A)},Zn=(_n.prototype.add=function(A,e){return new _n(this.x+A,this.y+e)},_n);function _n(A,e){this.type=0,this.x=A,this.y=e}function qn(A,e,t){return new Zn(A.x+(e.x-A.x)*t,A.y+(e.y-A.y)*t)}var jn=(zn.prototype.subdivide=function(A,e){var t=qn(this.start,this.startControl,A),r=qn(this.startControl,this.endControl,A),B=qn(this.endControl,this.end,A),n=qn(t,r,A),r=qn(r,B,A),A=qn(n,r,A);return e?new zn(this.start,t,n,A):new zn(A,r,B,this.end)},zn.prototype.add=function(A,e){return new zn(this.start.add(A,e),this.startControl.add(A,e),this.endControl.add(A,e),this.end.add(A,e))},zn.prototype.reverse=function(){return new zn(this.end,this.endControl,this.startControl,this.start)},zn);function zn(A,e,t,r){this.type=1,this.start=A,this.startControl=e,this.endControl=t,this.end=r}function $n(A){return 1===A.type}var As,es=function(A){var e=A.styles,t=A.bounds,r=(C=Be(e.borderTopLeftRadius,t.width,t.height))[__uv.$wrap((0))],B=C[__uv.$wrap((1))],n=(u=Be(e.borderTopRightRadius,t.width,t.height))[__uv.$wrap((0))],s=u[__uv.$wrap((1))],o=(F=Be(e.borderBottomRightRadius,t.width,t.height))[__uv.$wrap((0))],i=F[__uv.$wrap((1))],Q=(h=Be(e.borderBottomLeftRadius,t.width,t.height))[__uv.$wrap((0))],c=h[__uv.$wrap((1))];(d=[]).push((r+n)/t.width),d.push((Q+o)/t.width),d.push((B+c)/t.height),d.push((s+i)/t.height),1<(f=Math.max.apply(Math,d))&&(r/=f,B/=f,n/=f,s/=f,o/=f,i/=f,Q/=f,c/=f);var a=t.width-n,g=t.height-i,w=t.width-o,U=t.height-c,l=e.borderTopWidth,C=e.borderRightWidth,u=e.borderBottomWidth,F=e.borderLeftWidth,h=Ue(e.paddingTop,A.bounds.width),d=Ue(e.paddingRight,A.bounds.width),f=Ue(e.paddingBottom,A.bounds.width),A=Ue(e.paddingLeft,A.bounds.width);this.topLeftBorderDoubleOuterBox=0<r||0<B?ss(t.left+F/3,t.__uv$setSource(__uv).__uv$top+l/3,r-F/3,B-l/3,As.TOP_LEFT):new Zn(t.left+F/3,t.__uv$setSource(__uv).__uv$top+l/3),this.topRightBorderDoubleOuterBox=0<r||0<B?ss(t.left+a,t.__uv$setSource(__uv).__uv$top+l/3,n-C/3,s-l/3,As.TOP_RIGHT):new Zn(t.left+t.width-C/3,t.__uv$setSource(__uv).__uv$top+l/3),this.bottomRightBorderDoubleOuterBox=0<o||0<i?ss(t.left+w,t.__uv$setSource(__uv).__uv$top+g,o-C/3,i-u/3,As.BOTTOM_RIGHT):new Zn(t.left+t.width-C/3,t.__uv$setSource(__uv).__uv$top+t.height-u/3),this.bottomLeftBorderDoubleOuterBox=0<Q||0<c?ss(t.left+F/3,t.__uv$setSource(__uv).__uv$top+U,Q-F/3,c-u/3,As.BOTTOM_LEFT):new Zn(t.left+F/3,t.__uv$setSource(__uv).__uv$top+t.height-u/3),this.topLeftBorderDoubleInnerBox=0<r||0<B?ss(t.left+2*F/3,t.__uv$setSource(__uv).__uv$top+2*l/3,r-2*F/3,B-2*l/3,As.TOP_LEFT):new Zn(t.left+2*F/3,t.__uv$setSource(__uv).__uv$top+2*l/3),this.topRightBorderDoubleInnerBox=0<r||0<B?ss(t.left+a,t.__uv$setSource(__uv).__uv$top+2*l/3,n-2*C/3,s-2*l/3,As.TOP_RIGHT):new Zn(t.left+t.width-2*C/3,t.__uv$setSource(__uv).__uv$top+2*l/3),this.bottomRightBorderDoubleInnerBox=0<o||0<i?ss(t.left+w,t.__uv$setSource(__uv).__uv$top+g,o-2*C/3,i-2*u/3,As.BOTTOM_RIGHT):new Zn(t.left+t.width-2*C/3,t.__uv$setSource(__uv).__uv$top+t.height-2*u/3),this.bottomLeftBorderDoubleInnerBox=0<Q||0<c?ss(t.left+2*F/3,t.__uv$setSource(__uv).__uv$top+U,Q-2*F/3,c-2*u/3,As.BOTTOM_LEFT):new Zn(t.left+2*F/3,t.__uv$setSource(__uv).__uv$top+t.height-2*u/3),this.topLeftBorderStroke=0<r||0<B?ss(t.left+F/2,t.__uv$setSource(__uv).__uv$top+l/2,r-F/2,B-l/2,As.TOP_LEFT):new Zn(t.left+F/2,t.__uv$setSource(__uv).__uv$top+l/2),this.topRightBorderStroke=0<r||0<B?ss(t.left+a,t.__uv$setSource(__uv).__uv$top+l/2,n-C/2,s-l/2,As.TOP_RIGHT):new Zn(t.left+t.width-C/2,t.__uv$setSource(__uv).__uv$top+l/2),this.bottomRightBorderStroke=0<o||0<i?ss(t.left+w,t.__uv$setSource(__uv).__uv$top+g,o-C/2,i-u/2,As.BOTTOM_RIGHT):new Zn(t.left+t.width-C/2,t.__uv$setSource(__uv).__uv$top+t.height-u/2),this.bottomLeftBorderStroke=0<Q||0<c?ss(t.left+F/2,t.__uv$setSource(__uv).__uv$top+U,Q-F/2,c-u/2,As.BOTTOM_LEFT):new Zn(t.left+F/2,t.__uv$setSource(__uv).__uv$top+t.height-u/2),this.topLeftBorderBox=0<r||0<B?ss(t.left,t.__uv$setSource(__uv).__uv$top,r,B,As.TOP_LEFT):new Zn(t.left,t.__uv$setSource(__uv).__uv$top),this.topRightBorderBox=0<n||0<s?ss(t.left+a,t.__uv$setSource(__uv).__uv$top,n,s,As.TOP_RIGHT):new Zn(t.left+t.width,t.__uv$setSource(__uv).__uv$top),this.bottomRightBorderBox=0<o||0<i?ss(t.left+w,t.__uv$setSource(__uv).__uv$top+g,o,i,As.BOTTOM_RIGHT):new Zn(t.left+t.width,t.__uv$setSource(__uv).__uv$top+t.height),this.bottomLeftBorderBox=0<Q||0<c?ss(t.left,t.__uv$setSource(__uv).__uv$top+U,Q,c,As.BOTTOM_LEFT):new Zn(t.left,t.__uv$setSource(__uv).__uv$top+t.height),this.topLeftPaddingBox=0<r||0<B?ss(t.left+F,t.__uv$setSource(__uv).__uv$top+l,Math.max(0,r-F),Math.max(0,B-l),As.TOP_LEFT):new Zn(t.left+F,t.__uv$setSource(__uv).__uv$top+l),this.topRightPaddingBox=0<n||0<s?ss(t.left+Math.min(a,t.width-C),t.__uv$setSource(__uv).__uv$top+l,a>t.width+C?0:Math.max(0,n-C),Math.max(0,s-l),As.TOP_RIGHT):new Zn(t.left+t.width-C,t.__uv$setSource(__uv).__uv$top+l),this.bottomRightPaddingBox=0<o||0<i?ss(t.left+Math.min(w,t.width-F),t.__uv$setSource(__uv).__uv$top+Math.min(g,t.height-u),Math.max(0,o-C),Math.max(0,i-u),As.BOTTOM_RIGHT):new Zn(t.left+t.width-C,t.__uv$setSource(__uv).__uv$top+t.height-u),this.bottomLeftPaddingBox=0<Q||0<c?ss(t.left+F,t.__uv$setSource(__uv).__uv$top+Math.min(U,t.height-u),Math.max(0,Q-F),Math.max(0,c-u),As.BOTTOM_LEFT):new Zn(t.left+F,t.__uv$setSource(__uv).__uv$top+t.height-u),this.topLeftContentBox=0<r||0<B?ss(t.left+F+A,t.__uv$setSource(__uv).__uv$top+l+h,Math.max(0,r-(F+A)),Math.max(0,B-(l+h)),As.TOP_LEFT):new Zn(t.left+F+A,t.__uv$setSource(__uv).__uv$top+l+h),this.topRightContentBox=0<n||0<s?ss(t.left+Math.min(a,t.width+F+A),t.__uv$setSource(__uv).__uv$top+l+h,a>t.width+F+A?0:n-F+A,s-(l+h),As.TOP_RIGHT):new Zn(t.left+t.width-(C+d),t.__uv$setSource(__uv).__uv$top+l+h),this.bottomRightContentBox=0<o||0<i?ss(t.left+Math.min(w,t.width-(F+A)),t.__uv$setSource(__uv).__uv$top+Math.min(g,t.height+l+h),Math.max(0,o-(C+d)),i-(u+f),As.BOTTOM_RIGHT):new Zn(t.left+t.width-(C+d),t.__uv$setSource(__uv).__uv$top+t.height-(u+f)),this.bottomLeftContentBox=0<Q||0<c?ss(t.left+F+A,t.__uv$setSource(__uv).__uv$top+U,Math.max(0,Q-(F+A)),c-(u+f),As.BOTTOM_LEFT):new Zn(t.left+F+A,t.__uv$setSource(__uv).__uv$top+t.height-(u+f))};(he=As=As||{})[__uv.$wrap((he.TOP_LEFT=0))]="TOP_LEFT",he[__uv.$wrap((he.TOP_RIGHT=1))]="TOP_RIGHT",he[__uv.$wrap((he.BOTTOM_RIGHT=2))]="BOTTOM_RIGHT",he[__uv.$wrap((he.BOTTOM_LEFT=3))]="BOTTOM_LEFT";function ts(A){return[A.topLeftBorderBox,A.topRightBorderBox,A.bottomRightBorderBox,A.bottomLeftBorderBox]}function rs(A){return[A.topLeftPaddingBox,A.topRightPaddingBox,A.bottomRightPaddingBox,A.bottomLeftPaddingBox]}function Bs(A){return 1===A.type}function ns(A,t){return A.length===t.length&&A.some(function(A,e){return A===t[__uv.$wrap((e))]})}var ss=function(A,e,t,r,B){var n=(Math.sqrt(2)-1)/3*4,s=t*n,o=r*n,i=A+t,Q=e+r;switch(B){case As.TOP_LEFT:return new jn(new Zn(A,Q),new Zn(A,Q-o),new Zn(i-s,e),new Zn(i,e));case As.TOP_RIGHT:return new jn(new Zn(A,e),new Zn(A+s,e),new Zn(i,Q-o),new Zn(i,Q));case As.BOTTOM_RIGHT:return new jn(new Zn(i,e),new Zn(i,e+o),new Zn(A+s,Q),new Zn(A,Q));default:As.BOTTOM_LEFT;return new jn(new Zn(i,Q),new Zn(i-s,Q),new Zn(A,e+o),new Zn(A,e))}},os=function(A,e,t){this.offsetX=A,this.offsetY=e,this.matrix=t,this.type=0,this.target=6},is=function(A,e){this.path=A,this.target=e,this.type=1},Qs=function(A){this.opacity=A,this.type=2,this.target=6},cs=function(A){this.element=A,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},as=(gs.prototype.getEffects=function(e){for(var A=-1===[2,3].indexOf(this.container.styles.position),t=this.__uv$setSource(__uv).__uv$parent,r=this.effects.slice(0);t;){var B,n,s=t.effects.filter(function(A){return!Bs(A)});A||0!==t.container.styles.position||!t.__uv$setSource(__uv).__uv$parent?(r.unshift.apply(r,s),A=-1===[2,3].indexOf(t.container.styles.position),0!==t.container.styles.overflowX&&(B=ts(t.curves),n=rs(t.curves),ns(B,n)||r.unshift(new is(n,6)))):r.unshift.apply(r,s),t=t.__uv$setSource(__uv).__uv$parent}return r.filter(function(A){return Pt(A.target,e)})},gs);function gs(A,e){var t,r;this.container=A,this.__uv$setSource(__uv).__uv$parent=e,this.effects=[],this.curves=new es(this.container),this.container.styles.opacity<1&&this.effects.push(new Qs(this.container.styles.opacity)),null!==this.container.styles.transform&&(e=this.container.bounds.left+this.container.styles.transformOrigin[__uv.$wrap((0))].number,t=this.container.bounds.__uv$setSource(__uv).__uv$top+this.container.styles.transformOrigin[__uv.$wrap((1))].number,r=this.container.styles.transform,this.effects.push(new os(e,t,r))),0!==this.container.styles.overflowX&&(t=ts(this.curves),r=rs(this.curves),ns(t,r)?this.effects.push(new is(t,6)):(this.effects.push(new is(t,2)),this.effects.push(new is(r,4))))}function ws(A,e){switch(e){case 0:return Hs(A.topLeftBorderBox,A.topLeftPaddingBox,A.topRightBorderBox,A.topRightPaddingBox);case 1:return Hs(A.topRightBorderBox,A.topRightPaddingBox,A.bottomRightBorderBox,A.bottomRightPaddingBox);case 2:return Hs(A.bottomRightBorderBox,A.bottomRightPaddingBox,A.bottomLeftBorderBox,A.bottomLeftPaddingBox);default:return Hs(A.bottomLeftBorderBox,A.bottomLeftPaddingBox,A.topLeftBorderBox,A.topLeftPaddingBox)}}function Us(A){var e=A.bounds,A=A.styles;return e.add(A.borderLeftWidth,A.borderTopWidth,-(A.borderRightWidth+A.borderLeftWidth),-(A.borderTopWidth+A.borderBottomWidth))}function ls(A){var e=A.styles,t=A.bounds,r=Ue(e.paddingLeft,t.width),B=Ue(e.paddingRight,t.width),n=Ue(e.paddingTop,t.width),A=Ue(e.paddingBottom,t.width);return t.add(r+e.borderLeftWidth,n+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+B),-(e.borderTopWidth+e.borderBottomWidth+n+A))}function Cs(A,e,t){var r=(B=Es(A.styles.backgroundOrigin,e),n=A,0===B?n.bounds:(2===B?ls:Us)(n)),B=(s=Es(A.styles.backgroundClip,e),o=A,0===s?o.bounds:(2===s?ls:Us)(o)),n=ps(Es(A.styles.backgroundSize,e),t,r),s=n[__uv.$wrap((0))],o=n[__uv.$wrap((1))],t=Be(Es(A.styles.backgroundPosition,e),r.width-s,r.height-o);return[Is(Es(A.styles.backgroundRepeat,e),t,n,r,B),Math.round(r.left+t[__uv.$wrap((0))]),Math.round(r.__uv$setSource(__uv).__uv$top+t[__uv.$wrap((1))]),s,o]}function us(A){return _A(A)&&A.value===Ve.AUTO}function Fs(A){return"number"==typeof A}var hs=function(Q,c,a,g){Q.container.elements.forEach(function(A){var e=Pt(A.flags,4),t=Pt(A.flags,2),r=new as(A,Q);Pt(A.styles.display,2048)&&g.push(r);var B,n,s,o,i=Pt(A.flags,8)?[]:g;e||t?(B=e||A.styles.isPositioned()?a:c,t=new cs(r),A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()?(n=A.styles.zIndex.order)<0?(s=0,B.negativeZIndex.some(function(A,e){return n>A.element.container.styles.zIndex.order?(s=e,!1):0<s}),B.negativeZIndex.splice(s,0,t)):0<n?(o=0,B.positiveZIndex.some(function(A,e){return n>=A.element.container.styles.zIndex.order?(o=e+1,!1):0<o}),B.positiveZIndex.splice(o,0,t)):B.zeroOrAutoZIndexOrTransformedOrOpacity.push(t):(A.styles.isFloating()?B.nonPositionedFloats:B.nonPositionedInlineLevel).push(t),hs(r,t,e?t:a,i)):((A.styles.isInlineLevel()?c.inlineLevel:c.nonInlineLevel).push(r),hs(r,c,a,i)),Pt(A.flags,8)&&ds(A,i)})},ds=function(A,e){for(var t=A instanceof UB?A.start:1,r=A instanceof UB&&A.reversed,B=0;B<e.length;B++){var n=e[__uv.$wrap((B))];n.container instanceof aB&&"number"==typeof n.container.value&&0!==n.container.value&&(t=n.container.value),n.listValue=Fn(t,n.container.styles.listStyleType,!0),t+=r?-1:1}},fs=function(A,e){var t=[];return $n(A)?t.push(A.subdivide(.5,!1)):t.push(A),$n(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Hs=function(A,e,t,r){var B=[];return $n(A)?B.push(A.subdivide(.5,!1)):B.push(A),$n(t)?B.push(t.subdivide(.5,!0)):B.push(t),$n(r)?B.push(r.subdivide(.5,!0).reverse()):B.push(r),$n(e)?B.push(e.subdivide(.5,!1).reverse()):B.push(e),B},ps=function(A,e,t){var r=e[__uv.$wrap((0))],B=e[__uv.$wrap((1))],n=e[__uv.$wrap((2))],s=A[__uv.$wrap((0))],o=A[__uv.$wrap((1))];if(!s)return[0,0];if(te(s)&&o&&te(o))return[Ue(s,t.width),Ue(o,t.height)];var i=Fs(n);if(_A(s)&&(s.value===Ve.CONTAIN||s.value===Ve.COVER))return Fs(n)?t.width/t.height<n!=(s.value===Ve.COVER)?[t.width,t.width/n]:[t.height*n,t.height]:[t.width,t.height];var Q=Fs(r),e=Fs(B),A=Q||e;if(us(s)&&(!o||us(o)))return Q&&e?[r,B]:i||A?A&&i?[Q?r:B*n,e?B:r/n]:[Q?r:t.width,e?B:t.height]:[t.width,t.height];if(i){var c=0,a=0;return te(s)?c=Ue(s,t.width):te(o)&&(a=Ue(o,t.height)),us(s)?c=a*n:o&&!us(o)||(a=c/n),[c,a]}c=null,a=null;if(te(s)?c=Ue(s,t.width):o&&te(o)&&(a=Ue(o,t.height)),null!==(c=null!==(a=null!==c&&(!o||us(o))?Q&&e?c/r*B:t.height:a)&&us(s)?Q&&e?a/B*r:t.width:c)&&null!==a)return[c,a];throw new Error("Unable to calculate background-size for element")},Es=function(A,e){e=A[__uv.$wrap((e))];return void 0===e?A[__uv.$wrap((0))]:e},Is=function(A,e,t,r,B){var n=e[__uv.$wrap((0))],s=e[__uv.$wrap((1))],o=t[__uv.$wrap((0))],i=t[__uv.$wrap((1))];switch(A){case 2:return[new Zn(Math.round(r.left),Math.round(r.__uv$setSource(__uv).__uv$top+s)),new Zn(Math.round(r.left+r.width),Math.round(r.__uv$setSource(__uv).__uv$top+s)),new Zn(Math.round(r.left+r.width),Math.round(i+r.__uv$setSource(__uv).__uv$top+s)),new Zn(Math.round(r.left),Math.round(i+r.__uv$setSource(__uv).__uv$top+s))];case 3:return[new Zn(Math.round(r.left+n),Math.round(r.__uv$setSource(__uv).__uv$top)),new Zn(Math.round(r.left+n+o),Math.round(r.__uv$setSource(__uv).__uv$top)),new Zn(Math.round(r.left+n+o),Math.round(r.height+r.__uv$setSource(__uv).__uv$top)),new Zn(Math.round(r.left+n),Math.round(r.height+r.__uv$setSource(__uv).__uv$top))];case 1:return[new Zn(Math.round(r.left+n),Math.round(r.__uv$setSource(__uv).__uv$top+s)),new Zn(Math.round(r.left+n+o),Math.round(r.__uv$setSource(__uv).__uv$top+s)),new Zn(Math.round(r.left+n+o),Math.round(r.__uv$setSource(__uv).__uv$top+s+i)),new Zn(Math.round(r.left+n),Math.round(r.__uv$setSource(__uv).__uv$top+s+i))];default:return[new Zn(Math.round(B.left),Math.round(B.__uv$setSource(__uv).__uv$top)),new Zn(Math.round(B.left+B.width),Math.round(B.__uv$setSource(__uv).__uv$top)),new Zn(Math.round(B.left+B.width),Math.round(B.height+B.__uv$setSource(__uv).__uv$top)),new Zn(Math.round(B.left),Math.round(B.height+B.__uv$setSource(__uv).__uv$top))]}},ys="Hidden Text",Ks=(ms.prototype.parseMetrics=function(A,e){var t=this._document.createElement("div"),r=this._document.createElement("img"),B=this._document.createElement("span"),n=this._document.body;t.style.visibility="hidden",t.style.fontFamily=A,t.style.fontSize=e,t.style.margin="0",t.style.padding="0",t.style.whiteSpace="nowrap",n.appendChild(t),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",B.style.fontFamily=A,B.style.fontSize=e,B.style.margin="0",B.style.padding="0",B.appendChild(this._document.createTextNode(ys)),t.appendChild(B),t.appendChild(r);e=r.offsetTop-B.offsetTop+2;t.removeChild(B),t.appendChild(this._document.createTextNode(ys)),t.style.lineHeight="normal",r.style.verticalAlign="super";r=r.offsetTop-t.offsetTop+2;return n.removeChild(t),{baseline:e,middle:r}},ms.prototype.getMetrics=function(A,e){var t=A+" "+e;return void 0===this._data[__uv.$wrap((t))]&&(this._data[__uv.$wrap((t))]=this.parseMetrics(A,e)),this._data[__uv.$wrap((t))]},ms);function ms(A){this._data={},this._document=A}var Ls,he=function(A,e){this.context=A,this.options=e},bs=(A(Ds,Ls=he),Ds.prototype.applyEffects=function(A){for(var e=this;this._activeEffects.length;)this.popEffect();A.forEach(function(A){return e.applyEffect(A)})},Ds.prototype.applyEffect=function(A){this.ctx.save(),2===A.type&&(this.ctx.globalAlpha=A.opacity),0===A.type&&(this.ctx.translate(A.offsetX,A.offsetY),this.ctx.transform(A.matrix[__uv.$wrap((0))],A.matrix[__uv.$wrap((1))],A.matrix[__uv.$wrap((2))],A.matrix[__uv.$wrap((3))],A.matrix[__uv.$wrap((4))],A.matrix[__uv.$wrap((5))]),this.ctx.translate(-A.offsetX,-A.offsetY)),Bs(A)&&(this.path(A.path),this.ctx.clip()),this._activeEffects.push(A)},Ds.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},Ds.prototype.renderStack=function(e){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:A.sent(),A.label=2;case 2:return[2]}})})},Ds.prototype.renderNode=function(e){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return Pt(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return A.sent(),[4,this.renderNodeContent(e)];case 2:A.sent(),A.label=3;case 3:return[2]}})})},Ds.prototype.renderTextWithLetterSpacing=function(t,A,r){var B=this;0===A?this.ctx.fillText(t.text,t.bounds.left,t.bounds.__uv$setSource(__uv).__uv$top+r):Zr(t.text).reduce(function(A,e){return B.ctx.fillText(e,A,t.bounds.__uv$setSource(__uv).__uv$top+r),A+B.ctx.measureText(e).width},t.bounds.left)},Ds.prototype.createFontStyle=function(A){var e=A.fontVariant.filter(function(A){return"normal"===A||"small-caps"===A}).join(""),t=Gs(A.fontFamily).join(", "),r=WA(A.fontSize)?""+A.fontSize.number+A.fontSize.unit:A.fontSize.number+"px";return[[A.fontStyle,e,A.fontWeight,r,t].join(" "),t,r]},Ds.prototype.renderTextNode=function(i,Q){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o=this;return H(this,function(A){return r=this.createFontStyle(Q),e=r[__uv.$wrap((0))],t=r[__uv.$wrap((1))],r=r[__uv.$wrap((2))],this.ctx.font=e,this.ctx.direction=1===Q.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",r=this.fontMetrics.getMetrics(t,r),B=r.baseline,n=r.middle,s=Q.paintOrder,i.textBounds.forEach(function(t){s.forEach(function(A){switch(A){case 0:o.ctx.fillStyle=ie(Q.color),o.renderTextWithLetterSpacing(t,Q.letterSpacing,B);var e=Q.textShadow;e.length&&t.text.trim().length&&(e.slice(0).reverse().forEach(function(A){o.ctx.shadowColor=ie(A.color),o.ctx.shadowOffsetX=A.offsetX.number*o.options.scale,o.ctx.shadowOffsetY=A.offsetY.number*o.options.scale,o.ctx.shadowBlur=A.blur.number,o.renderTextWithLetterSpacing(t,Q.letterSpacing,B)}),o.ctx.shadowColor="",o.ctx.shadowOffsetX=0,o.ctx.shadowOffsetY=0,o.ctx.shadowBlur=0),Q.textDecorationLine.length&&(o.ctx.fillStyle=ie(Q.textDecorationColor||Q.color),Q.textDecorationLine.forEach(function(A){switch(A){case 1:o.ctx.fillRect(t.bounds.left,Math.round(t.bounds.__uv$setSource(__uv).__uv$top+B),t.bounds.width,1);break;case 2:o.ctx.fillRect(t.bounds.left,Math.round(t.bounds.__uv$setSource(__uv).__uv$top),t.bounds.width,1);break;case 3:o.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.__uv$setSource(__uv).__uv$top+n),t.bounds.width,1)}}));break;case 1:Q.webkitTextStrokeWidth&&t.text.trim().length&&(o.ctx.strokeStyle=ie(Q.webkitTextStrokeColor),o.ctx.lineWidth=Q.webkitTextStrokeWidth,o.ctx.lineJoin=window.chrome?"miter":"round",o.ctx.strokeText(t.text,t.bounds.left,t.bounds.__uv$setSource(__uv).__uv$top+B)),o.ctx.strokeStyle="",o.ctx.lineWidth=0,o.ctx.lineJoin="miter"}})}),[2]})})},Ds.prototype.renderReplacedElement=function(A,e,t){var r;t&&0<A.intrinsicWidth&&0<A.intrinsicHeight&&(r=ls(A),e=rs(e),this.path(e),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(t,0,0,A.intrinsicWidth,A.intrinsicHeight,r.left,r.__uv$setSource(__uv).__uv$top,r.width,r.height),this.ctx.restore())},Ds.prototype.renderNodeContent=function(w){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g;return H(this,function(A){switch(A.label){case 0:this.applyEffects(w.getEffects(4)),e=w.container,t=w.curves,r=e.styles,B=0,n=e.textNodes,A.label=1;case 1:return B<n.length?(s=n[__uv.$wrap((B))],[4,this.renderTextNode(s,r)]):[3,4];case 2:A.sent(),A.label=3;case 3:return B++,[3,1];case 4:if(!(e instanceof tB))return[3,8];A.label=5;case 5:return A.trys.push([5,7,,8]),[4,this.context.cache.match(e.src)];case 6:return Q=A.sent(),this.renderReplacedElement(e,t,Q),[3,8];case 7:return A.sent(),this.context.logger.error("Error loading image "+e.src),[3,8];case 8:if(e instanceof nB&&this.renderReplacedElement(e,t,e.canvas),!(e instanceof iB))return[3,12];A.label=9;case 9:return A.trys.push([9,11,,12]),[4,this.context.cache.match(e.svg)];case 10:return Q=A.sent(),this.renderReplacedElement(e,t,Q),[3,12];case 11:return A.sent(),this.context.logger.error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof vB&&e.tree?[4,new Ds(this.context,{scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,width:e.width,height:e.height}).render(e.tree)]:[3,14];case 13:s=A.sent(),e.width&&e.height&&this.ctx.drawImage(s,0,0,e.width,e.height,e.bounds.left,e.bounds.__uv$setSource(__uv).__uv$top,e.bounds.width,e.bounds.height),A.label=14;case 14:if(e instanceof pB&&(i=Math.min(e.bounds.width,e.bounds.height),e.type===hB?e.checked&&(this.ctx.save(),this.path([new Zn(e.bounds.left+.39363*i,e.bounds.__uv$setSource(__uv).__uv$top+.79*i),new Zn(e.bounds.left+.16*i,e.bounds.__uv$setSource(__uv).__uv$top+.5549*i),new Zn(e.bounds.left+.27347*i,e.bounds.__uv$setSource(__uv).__uv$top+.44071*i),new Zn(e.bounds.left+.39694*i,e.bounds.__uv$setSource(__uv).__uv$top+.5649*i),new Zn(e.bounds.left+.72983*i,e.bounds.__uv$setSource(__uv).__uv$top+.23*i),new Zn(e.bounds.left+.84*i,e.bounds.__uv$setSource(__uv).__uv$top+.34085*i),new Zn(e.bounds.left+.39363*i,e.bounds.__uv$setSource(__uv).__uv$top+.79*i)]),this.ctx.fillStyle=ie(HB),this.ctx.fill(),this.ctx.restore()):e.type===dB&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+i/2,e.bounds.__uv$setSource(__uv).__uv$top+i/2,i/4,0,2*Math.PI,!0),this.ctx.fillStyle=ie(HB),this.ctx.fill(),this.ctx.restore())),xs(e)&&e.value.length){switch(c=this.createFontStyle(r),a=c[__uv.$wrap((0))],i=c[__uv.$wrap((1))],c=this.fontMetrics.getMetrics(a,i).baseline,this.ctx.font=a,this.ctx.fillStyle=ie(r.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Ss(e.styles.textAlign),g=ls(e),o=0,e.styles.textAlign){case 1:o+=g.width/2;break;case 2:o+=g.width}i=g.add(o,0,0,-g.height/2+1),this.ctx.save(),this.path([new Zn(g.left,g.__uv$setSource(__uv).__uv$top),new Zn(g.left+g.width,g.__uv$setSource(__uv).__uv$top),new Zn(g.left+g.width,g.__uv$setSource(__uv).__uv$top+g.height),new Zn(g.left,g.__uv$setSource(__uv).__uv$top+g.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Jr(e.value,i),r.letterSpacing,c),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Pt(e.styles.display,2048))return[3,20];if(null===e.styles.listStyleImage)return[3,19];if(0!==(c=e.styles.listStyleImage).type)return[3,18];Q=void 0,c=c.url,A.label=15;case 15:return A.trys.push([15,17,,18]),[4,this.context.cache.match(c)];case 16:return Q=A.sent(),this.ctx.drawImage(Q,e.bounds.left-(Q.width+10),e.bounds.__uv$setSource(__uv).__uv$top),[3,18];case 17:return A.sent(),this.context.logger.error("Error loading list-style-image "+c),[3,18];case 18:return[3,20];case 19:w.listValue&&-1!==e.styles.listStyleType&&(a=this.createFontStyle(r)[__uv.$wrap((0))],this.ctx.font=a,this.ctx.fillStyle=ie(r.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",g=new d(e.bounds.left,e.bounds.__uv$setSource(__uv).__uv$top+Ue(e.styles.paddingTop,e.bounds.width),e.bounds.width,Ye(r.lineHeight,r.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Jr(w.listValue,g),r.letterSpacing,Ye(r.lineHeight,r.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),A.label=20;case 20:return[2]}})})},Ds.prototype.renderStackContent=function(C){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g,w,U,l;return H(this,function(A){switch(A.label){case 0:return Pt(C.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(C.element)];case 1:A.sent(),e=0,t=C.negativeZIndex,A.label=2;case 2:return e<t.length?(l=t[__uv.$wrap((e))],[4,this.renderStack(l)]):[3,5];case 3:A.sent(),A.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(C.element)];case 6:A.sent(),r=0,B=C.nonInlineLevel,A.label=7;case 7:return r<B.length?(l=B[__uv.$wrap((r))],[4,this.renderNode(l)]):[3,10];case 8:A.sent(),A.label=9;case 9:return r++,[3,7];case 10:n=0,s=C.nonPositionedFloats,A.label=11;case 11:return n<s.length?(l=s[__uv.$wrap((n))],[4,this.renderStack(l)]):[3,14];case 12:A.sent(),A.label=13;case 13:return n++,[3,11];case 14:o=0,i=C.nonPositionedInlineLevel,A.label=15;case 15:return o<i.length?(l=i[__uv.$wrap((o))],[4,this.renderStack(l)]):[3,18];case 16:A.sent(),A.label=17;case 17:return o++,[3,15];case 18:Q=0,c=C.inlineLevel,A.label=19;case 19:return Q<c.length?(l=c[__uv.$wrap((Q))],[4,this.renderNode(l)]):[3,22];case 20:A.sent(),A.label=21;case 21:return Q++,[3,19];case 22:a=0,g=C.zeroOrAutoZIndexOrTransformedOrOpacity,A.label=23;case 23:return a<g.length?(l=g[__uv.$wrap((a))],[4,this.renderStack(l)]):[3,26];case 24:A.sent(),A.label=25;case 25:return a++,[3,23];case 26:w=0,U=C.positiveZIndex,A.label=27;case 27:return w<U.length?(l=U[__uv.$wrap((w))],[4,this.renderStack(l)]):[3,30];case 28:A.sent(),A.label=29;case 29:return w++,[3,27];case 30:return[2]}})})},Ds.prototype.mask=function(A){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(A.slice(0).reverse()),this.ctx.closePath()},Ds.prototype.path=function(A){this.ctx.beginPath(),this.formatPath(A),this.ctx.closePath()},Ds.prototype.formatPath=function(A){var r=this;A.forEach(function(A,e){var t=$n(A)?A.start:A;0===e?r.ctx.moveTo(t.x,t.y):r.ctx.lineTo(t.x,t.y),$n(A)&&r.ctx.bezierCurveTo(A.startControl.x,A.startControl.y,A.endControl.x,A.endControl.y,A.end.x,A.end.y)})},Ds.prototype.renderRepeat=function(A,e,t,r){this.path(A),this.ctx.fillStyle=e,this.ctx.translate(t,r),this.ctx.fill(),this.ctx.translate(-t,-r)},Ds.prototype.resizeImage=function(A,e,t){if(A.width===e&&A.height===t)return A;var r=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return r.width=Math.max(1,e),r.height=Math.max(1,t),r.getContext("2d").drawImage(A,0,0,A.width,A.height,0,0,e,t),r},Ds.prototype.renderBackgroundImage=function(f){return a(this,void 0,void 0,function(){var h,e,d,t,r,B;return H(this,function(A){switch(A.label){case 0:h=f.styles.backgroundImage.length-1,e=function(e){var t,r,B,n,s,o,i,Q,c,a,g,w,U,l,C,u,F;return H(this,function(A){switch(A.label){case 0:if(0!==e.type)return[3,5];t=void 0,r=e.url,A.label=1;case 1:return A.trys.push([1,3,,4]),[4,d.context.cache.match(r)];case 2:return t=A.sent(),[3,4];case 3:return A.sent(),d.context.logger.error("Error loading background-image "+r),[3,4];case 4:return t&&(B=Cs(f,h,[t.width,t.height,t.width/t.height]),o=B[__uv.$wrap((0))],g=B[__uv.$wrap((1))],w=B[__uv.$wrap((2))],c=B[__uv.$wrap((3))],a=B[__uv.$wrap((4))],s=d.ctx.createPattern(d.resizeImage(t,c,a),"repeat"),d.renderRepeat(o,s,g,w)),[3,6];case 5:1===e.type?(F=Cs(f,h,[null,null,null]),o=F[__uv.$wrap((0))],g=F[__uv.$wrap((1))],w=F[__uv.$wrap((2))],c=F[__uv.$wrap((3))],a=F[__uv.$wrap((4))],C=Ee(e.angle,c,a),l=C[__uv.$wrap((0))],B=C[__uv.$wrap((1))],i=C[__uv.$wrap((2))],u=C[__uv.$wrap((3))],Q=C[__uv.$wrap((4))],(F=document.createElement("canvas")).width=c,F.height=a,C=F.getContext("2d"),n=C.createLinearGradient(B,u,i,Q),pe(e.stops,l).forEach(function(A){return n.addColorStop(A.stop,ie(A.color))}),C.fillStyle=n,C.fillRect(0,0,c,a),0<c&&0<a&&(s=d.ctx.createPattern(F,"repeat"),d.renderRepeat(o,s,g,w))):2===e.type&&(u=Cs(f,h,[null,null,null]),o=u[__uv.$wrap((0))],i=u[__uv.$wrap((1))],Q=u[__uv.$wrap((2))],c=u[__uv.$wrap((3))],a=u[__uv.$wrap((4))],l=0===e.position.length?[ge]:e.position,g=Ue(l[__uv.$wrap((0))],c),w=Ue(l[__uv.$wrap((l.length-1))],a),C=function(A,e,t,r,B){var n,s,o,i,Q=0,c=0;switch(A.size){case 0:0===A.shape?Q=c=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-B)):1===A.shape&&(Q=Math.min(Math.abs(e),Math.abs(e-r)),c=Math.min(Math.abs(t),Math.abs(t-B)));break;case 2:0===A.shape?Q=c=Math.min(Ie(e,t),Ie(e,t-B),Ie(e-r,t),Ie(e-r,t-B)):1===A.shape&&(n=Math.min(Math.abs(t),Math.abs(t-B))/Math.min(Math.abs(e),Math.abs(e-r)),o=(s=ye(r,B,e,t,!0))[__uv.$wrap((0))],i=s[__uv.$wrap((1))],c=n*(Q=Ie(o-e,(i-t)/n)));break;case 1:0===A.shape?Q=c=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-B)):1===A.shape&&(Q=Math.max(Math.abs(e),Math.abs(e-r)),c=Math.max(Math.abs(t),Math.abs(t-B)));break;case 3:0===A.shape?Q=c=Math.max(Ie(e,t),Ie(e,t-B),Ie(e-r,t),Ie(e-r,t-B)):1===A.shape&&(n=Math.max(Math.abs(t),Math.abs(t-B))/Math.max(Math.abs(e),Math.abs(e-r)),o=(s=ye(r,B,e,t,!1))[__uv.$wrap((0))],i=s[__uv.$wrap((1))],c=n*(Q=Ie(o-e,(i-t)/n)))}return Array.isArray(A.size)&&(Q=Ue(A.size[__uv.$wrap((0))],r),c=2===A.size.length?Ue(A.size[__uv.$wrap((1))],B):Q),[Q,c]}(e,g,w,c,a),F=C[__uv.$wrap((0))],u=C[__uv.$wrap((1))],0<F&&0<u&&(U=d.ctx.createRadialGradient(i+g,Q+w,0,i+g,Q+w,F),pe(e.stops,2*F).forEach(function(A){return U.addColorStop(A.stop,ie(A.color))}),d.path(o),d.ctx.fillStyle=U,F!==u?(l=f.bounds.left+.5*f.bounds.width,C=f.bounds.__uv$setSource(__uv).__uv$top+.5*f.bounds.height,F=1/(u=u/F),d.ctx.save(),d.ctx.translate(l,C),d.ctx.transform(1,0,0,u,0,0),d.ctx.translate(-l,-C),d.ctx.fillRect(i,F*(Q-C)+C,c,a*F),d.ctx.restore()):d.ctx.fill())),A.label=6;case 6:return h--,[2]}})},d=this,t=0,r=f.styles.backgroundImage.slice(0).reverse(),A.label=1;case 1:return t<r.length?(B=r[__uv.$wrap((t))],[5,e(B)]):[3,4];case 2:A.sent(),A.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},Ds.prototype.renderSolidBorder=function(e,t,r){return a(this,void 0,void 0,function(){return H(this,function(A){return this.path(ws(r,t)),this.ctx.fillStyle=ie(e),this.ctx.fill(),[2]})})},Ds.prototype.renderDoubleBorder=function(t,r,B,n){return a(this,void 0,void 0,function(){var e;return H(this,function(A){switch(A.label){case 0:return r<3?[4,this.renderSolidBorder(t,B,n)]:[3,2];case 1:return A.sent(),[2];case 2:return e=function(A,e){switch(e){case 0:return Hs(A.topLeftBorderBox,A.topLeftBorderDoubleOuterBox,A.topRightBorderBox,A.topRightBorderDoubleOuterBox);case 1:return Hs(A.topRightBorderBox,A.topRightBorderDoubleOuterBox,A.bottomRightBorderBox,A.bottomRightBorderDoubleOuterBox);case 2:return Hs(A.bottomRightBorderBox,A.bottomRightBorderDoubleOuterBox,A.bottomLeftBorderBox,A.bottomLeftBorderDoubleOuterBox);default:return Hs(A.bottomLeftBorderBox,A.bottomLeftBorderDoubleOuterBox,A.topLeftBorderBox,A.topLeftBorderDoubleOuterBox)}}(n,B),this.path(e),this.ctx.fillStyle=ie(t),this.ctx.fill(),e=function(A,e){switch(e){case 0:return Hs(A.topLeftBorderDoubleInnerBox,A.topLeftPaddingBox,A.topRightBorderDoubleInnerBox,A.topRightPaddingBox);case 1:return Hs(A.topRightBorderDoubleInnerBox,A.topRightPaddingBox,A.bottomRightBorderDoubleInnerBox,A.bottomRightPaddingBox);case 2:return Hs(A.bottomRightBorderDoubleInnerBox,A.bottomRightPaddingBox,A.bottomLeftBorderDoubleInnerBox,A.bottomLeftPaddingBox);default:return Hs(A.bottomLeftBorderDoubleInnerBox,A.bottomLeftPaddingBox,A.topLeftBorderDoubleInnerBox,A.topLeftPaddingBox)}}(n,B),this.path(e),this.ctx.fill(),[2]}})})},Ds.prototype.renderNodeBackgroundAndBorders=function(c){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q=this;return H(this,function(A){switch(A.label){case 0:return(this.applyEffects(c.getEffects(2)),e=c.container.styles,t=!oe(e.backgroundColor)||e.backgroundImage.length,r=[{style:e.borderTopStyle,color:e.borderTopColor,width:e.borderTopWidth},{style:e.borderRightStyle,color:e.borderRightColor,width:e.borderRightWidth},{style:e.borderBottomStyle,color:e.borderBottomColor,width:e.borderBottomWidth},{style:e.borderLeftStyle,color:e.borderLeftColor,width:e.borderLeftWidth}],B=Ms(Es(e.backgroundClip,0),c.curves),t||e.boxShadow.length)?(this.ctx.save(),this.path(B),this.ctx.clip(),oe(e.backgroundColor)||(this.ctx.fillStyle=ie(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:A.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach(function(A){Q.ctx.save();var t,r,B,n,e=ts(c.curves),s=A.inset?0:1e4,o=(t=-s+(A.inset?1:-1)*A.spread.number,r=(A.inset?1:-1)*A.spread.number,B=A.spread.number*(A.inset?-2:2),n=A.spread.number*(A.inset?-2:2),e.map(function(A,e){switch(e){case 0:return A.add(t,r);case 1:return A.add(t+B,r);case 2:return A.add(t+B,r+n);case 3:return A.add(t,r+n)}return A}));A.inset?(Q.path(e),Q.ctx.clip(),Q.mask(o)):(Q.mask(e),Q.ctx.clip(),Q.path(o)),Q.ctx.shadowOffsetX=A.offsetX.number+s,Q.ctx.shadowOffsetY=A.offsetY.number,Q.ctx.shadowColor=ie(A.color),Q.ctx.shadowBlur=A.blur.number,Q.ctx.fillStyle=A.inset?ie(A.color):"rgba(0,0,0,1)",Q.ctx.fill(),Q.ctx.restore()}),A.label=2;case 2:s=n=0,o=r,A.label=3;case 3:return s<o.length?0!==(i=o[__uv.$wrap((s))]).style&&!oe(i.color)&&0<i.width?2!==i.style?[3,5]:[4,this.renderDashedDottedBorder(i.color,i.width,n,c.curves,2)]:[3,11]:[3,13];case 4:return A.sent(),[3,11];case 5:return 3!==i.style?[3,7]:[4,this.renderDashedDottedBorder(i.color,i.width,n,c.curves,3)];case 6:return A.sent(),[3,11];case 7:return 4!==i.style?[3,9]:[4,this.renderDoubleBorder(i.color,i.width,n,c.curves)];case 8:return A.sent(),[3,11];case 9:return[4,this.renderSolidBorder(i.color,n,c.curves)];case 10:A.sent(),A.label=11;case 11:n++,A.label=12;case 12:return s++,[3,3];case 13:return[2]}})})},Ds.prototype.renderDashedDottedBorder=function(g,w,U,l,C){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a;return H(this,function(A){return this.ctx.save(),Q=function(A,e){switch(e){case 0:return fs(A.topLeftBorderStroke,A.topRightBorderStroke);case 1:return fs(A.topRightBorderStroke,A.bottomRightBorderStroke);case 2:return fs(A.bottomRightBorderStroke,A.bottomLeftBorderStroke);default:return fs(A.bottomLeftBorderStroke,A.topLeftBorderStroke)}}(l,U),e=ws(l,U),2===C&&(this.path(e),this.ctx.clip()),s=$n(e[__uv.$wrap((0))])?(t=e[__uv.$wrap((0))].start.x,e[__uv.$wrap((0))].start.y):(t=e[__uv.$wrap((0))].x,e[__uv.$wrap((0))].y),o=$n(e[__uv.$wrap((1))])?(r=e[__uv.$wrap((1))].end.x,e[__uv.$wrap((1))].end.y):(r=e[__uv.$wrap((1))].x,e[__uv.$wrap((1))].y),B=0===U||2===U?Math.abs(t-r):Math.abs(s-o),this.ctx.beginPath(),3===C?this.formatPath(Q):this.formatPath(e.slice(0,2)),n=w<3?3*w:2*w,s=w<3?2*w:w,3===C&&(s=n=w),o=!0,B<=2*n?o=!1:B<=2*n+s?(n*=i=B/(2*n+s),s*=i):(Q=Math.floor((B+s)/(n+s)),i=(B-Q*n)/(Q-1),s=(Q=(B-(Q+1)*n)/Q)<=0||Math.abs(s-i)<Math.abs(s-Q)?i:Q),o&&(3===C?this.ctx.setLineDash([0,n+s]):this.ctx.setLineDash([n,s])),3===C?(this.ctx.lineCap="round",this.ctx.lineWidth=w):this.ctx.lineWidth=2*w+1.1,this.ctx.strokeStyle=ie(g),this.ctx.stroke(),this.ctx.setLineDash([]),2===C&&($n(e[__uv.$wrap((0))])&&(c=e[__uv.$wrap((3))],a=e[__uv.$wrap((0))],this.ctx.beginPath(),this.formatPath([new Zn(c.end.x,c.end.y),new Zn(a.start.x,a.start.y)]),this.ctx.stroke()),$n(e[__uv.$wrap((1))])&&(c=e[__uv.$wrap((1))],a=e[__uv.$wrap((2))],this.ctx.beginPath(),this.formatPath([new Zn(c.end.x,c.end.y),new Zn(a.start.x,a.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},Ds.prototype.render=function(B){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ie(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=new as(e=B,null),r=new cs(t),hs(t,r,r,e=[]),ds(t.container,e),[4,this.renderStack(r)];case 1:return A.sent(),this.applyEffects([]),[2,this.canvas]}var e,t,r})})},Ds);function Ds(A,e){A=Ls.call(this,A,e)||this;return A._activeEffects=[],A.canvas=e.canvas||document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),e.canvas||(A.canvas.width=Math.floor(e.width*e.scale),A.canvas.height=Math.floor(e.height*e.scale),A.canvas.style.width=e.width+"px",A.canvas.style.height=e.height+"px"),A.fontMetrics=new Ks(document),A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-e.x,-e.y),A.ctx.textBaseline="bottom",A._activeEffects=[],A.context.logger.debug("Canvas renderer initialized ("+e.width+"x"+e.height+") with scale "+e.scale),A}var vs,xs=function(A){return A instanceof LB||(A instanceof yB||A instanceof pB&&A.type!==dB&&A.type!==hB)},Ms=function(A,e){switch(A){case 0:return ts(e);case 2:return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox];default:return rs(e)}},Ss=function(A){switch(A){case 1:return"center";case 2:return"right";default:return"left"}},Ts=["-apple-system","system-ui"],Gs=function(A){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?A.filter(function(A){return-1===Ts.indexOf(A)}):A},Os=(A(Vs,vs=he),Vs.prototype.render=function(t){return a(this,void 0,void 0,function(){var e;return H(this,function(A){switch(A.label){case 0:return e=Nr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,ks(e)];case 1:return e=A.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ie(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(e,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},Vs);function Vs(A,e){A=vs.call(this,A,e)||this;return A.canvas=e.canvas||document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),A.options=e,A.canvas.width=Math.floor(e.width*e.scale),A.canvas.height=Math.floor(e.height*e.scale),A.canvas.style.width=e.width+"px",A.canvas.style.height=e.height+"px",A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-e.x,-e.y),A.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale),A}var ks=function(r){return new Promise(function(A,e){var t=new Image;t.onload=function(){A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},Rs=(Ns.prototype.debug=function(){for(var A=[],e=0;e<arguments.length;e++)A[__uv.$wrap((e))]=arguments[__uv.$wrap((e))];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.prototype.getTime=function(){return Date.now()-this.start},Ns.prototype.info=function(){for(var A=[],e=0;e<arguments.length;e++)A[__uv.$wrap((e))]=arguments[__uv.$wrap((e))];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,t([this.id,this.getTime()+"ms"],A))},Ns.prototype.warn=function(){for(var A=[],e=0;e<arguments.length;e++)A[__uv.$wrap((e))]=arguments[__uv.$wrap((e))];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.prototype.error=function(){for(var A=[],e=0;e<arguments.length;e++)A[__uv.$wrap((e))]=arguments[__uv.$wrap((e))];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.instances={},Ns);function Ns(A){var e=A.id,A=A.enabled;this.id=e,this.enabled=A,this.start=Date.now()}var Ps=(Xs.instanceCount=1,Xs);function Xs(A,e){this.windowBounds=e,this.instanceName="#"+Xs.instanceCount++,this.logger=new Rs({id:this.instanceName,enabled:A.logging}),this.cache=null!==(e=A.cache)&&void 0!==e?e:new On(this,A)}"undefined"!=typeof window&&Tn.setContext(window);var Js=function(u,F){return a(void 0,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g,w,U,l,C;return H(this,function(A){switch(A.label){case 0:if(!u||"object"!=typeof u)return[2,Promise.reject("Invalid element provided as first argument")];if(!(e=u.ownerDocument))throw new Error("Element is not attached to a Document");if(!(t=e.defaultView))throw new Error("Document is not attached to a Window");return w={allowTaint:null!==(U=F.allowTaint)&&void 0!==U&&U,imageTimeout:null!==(c=F.imageTimeout)&&void 0!==c?c:15e3,proxy:F.proxy,useCORS:null!==(a=F.useCORS)&&void 0!==a&&a},U=h({logging:null===(g=F.logging)||void 0===g||g,cache:F.cache},w),c={windowWidth:null!==(c=F.windowWidth)&&void 0!==c?c:t.innerWidth,windowHeight:null!==(a=F.windowHeight)&&void 0!==a?a:t.innerHeight,scrollX:null!==(g=F.scrollX)&&void 0!==g?g:t.pageXOffset,scrollY:null!==(w=F.scrollY)&&void 0!==w?w:t.pageYOffset},a=new d(c.scrollX,c.scrollY,c.windowWidth,c.windowHeight),g=new Ps(U,a),c=null!==(w=F.foreignObjectRendering)&&void 0!==w&&w,w={allowTaint:null!==(U=F.allowTaint)&&void 0!==U&&U,onclone:F.onclone,ignoreElements:F.ignoreElements,inlineImages:c,copyStyles:c},g.logger.debug("Starting document clone with size "+a.width+"x"+a.height+" scrolled to "+-a.left+","+-a.__uv$setSource(__uv).__uv$top),U=new dn(g,u,w),(w=U.clonedReferenceElement)?[4,U.toIFrame(e,a)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return(r=A.sent(),l=jB(w)||"HTML"===w.tagName?function(A){var e=A.body,t=A.documentElement;if(!e||!t)throw new Error("Unable to get document size");A=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),t=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new d(0,0,A,t)}(w.ownerDocument):f(g,w),B=l.width,n=l.height,s=l.left,o=l.__uv$setSource(__uv).__uv$top,i=Ys(g,w,F.backgroundColor),l={canvas:F.canvas,backgroundColor:i,scale:null!==(l=null!==(l=F.scale)&&void 0!==l?l:t.devicePixelRatio)&&void 0!==l?l:1,x:(null!==(l=F.x)&&void 0!==l?l:0)+s,y:(null!==(l=F.y)&&void 0!==l?l:0)+o,width:null!==(l=F.width)&&void 0!==l?l:Math.ceil(B),height:null!==(l=F.height)&&void 0!==l?l:Math.ceil(n)},c)?(g.logger.debug("Document cloned, using foreign object rendering"),[4,new Os(g,l).render(w)]):[3,3];case 2:return Q=A.sent(),[3,5];case 3:return g.logger.debug("Document cloned, element located at "+s+","+o+" with size "+B+"x"+n+" using computed rendering"),g.logger.debug("Starting DOM parsing"),C=kB(g,w),i===C.styles.backgroundColor&&(C.styles.backgroundColor=Le.TRANSPARENT),g.logger.debug("Starting renderer for element at "+l.x+","+l.y+" with size "+l.width+"x"+l.height),[4,new bs(g,l).render(C)];case 4:Q=A.sent(),A.label=5;case 5:return null!==(C=F.removeContainer)&&void 0!==C&&!C||dn.destroy(r)||g.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore"),g.logger.debug("Finished rendering"),[2,Q]}})})},Ys=function(A,e,t){var r=e.ownerDocument,B=r.documentElement?fe(A,getComputedStyle(r.documentElement).backgroundColor):Le.TRANSPARENT,n=r.body?fe(A,getComputedStyle(r.body).backgroundColor):Le.TRANSPARENT,t="string"==typeof t?fe(A,t):null===t?Le.TRANSPARENT:4294967295;return e===r.documentElement?oe(B)?oe(n)?t:n:B:t};return function(A,e){return Js(A,e=void 0===e?{}:e)}});</script><script>var extern=function(){!function(e,i){var r=[],n=e.CANNON||this.CANNON,a=e.OIMO||this.OIMO,o=e.earcut||this.earcut;if("object"==typeof exports&&"object"==typeof module){try{n=n||require("cannon")}catch(e){}try{a=a||require("oimo")}catch(e){}try{o=o||require("earcut")}catch(e){}module.exports=i(n,a,o)}else if("function"==typeof define&&define.amd)require.specified&&require.specified("cannon")&&r.push("cannon"),require.specified&&require.specified("oimo")&&r.push("oimo"),require.specified&&require.specified("earcut")&&r.push("earcut"),define("babylonjs",r,i);else if("object"==typeof exports){try{n=n||require("cannon")}catch(e){}try{a=a||require("oimo")}catch(e){}try{o=o||require("earcut")}catch(e){}exports.babylonjs=i(n,a,o)}else"undefined"==typeof window?e.BABYLON=i(n,a,o):t=i(n,a,o)}(this,(function(e,t,i){e=e||this.CANNON,t=t||this.OIMO,i=i||this.earcut;var r,n=this&&this.__decorate||function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[__uv.$wrap((s))])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},a=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[__uv.$wrap((i))]=t[__uv.$wrap((i))])},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});!function(e){var t=function(){function e(){this._defines={},this._currentRank=32,this._maxRank=-1}return e.prototype.unBindMesh=function(){this._mesh=null},e.prototype.addFallback=function(e,t){this._defines[__uv.$wrap((e))]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[__uv.$wrap((e))]=new Array),this._defines[__uv.$wrap((e))].push(t)},e.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(e.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),e.prototype.reduce=function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0&&this._mesh.material){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var i=this._mesh.getScene(),r=0;r<i.meshes.length;r++){var n=i.meshes[__uv.$wrap((r))];if(n.material&&(n.computeBonesUsingShaders&&0!==n.numBoneInfluencers))if(n.material.getEffect()===t)n.computeBonesUsingShaders=!1;else if(n.subMeshes)for(var a=0,o=n.subMeshes;a<o.length;a++){if(o[__uv.$wrap((a))].effect===t){n.computeBonesUsingShaders=!1;break}}}}else{var s=this._defines[__uv.$wrap((this._currentRank))];if(s)for(r=0;r<s.length;r++)e=e.replace("#define "+s[__uv.$wrap((r))],"");this._currentRank++}return e},e}();e.EffectFallbacks=t;var i=function(){};e.EffectCreationOptions=i;var r=function(){function t(i,r,n,a,o,s,l,c,u,h){void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null);var d,p,m=this;if(this.uniqueId=0,this.onCompileObservable=new e.Observable,this.onErrorObservable=new e.Observable,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._isReady=!1,this._compilationError="",this.name=i,r.attributes){var _=r;if(this._engine=n,this._attributesNames=_.attributes,this._uniformsNames=_.uniformsNames.concat(_.samplers),this._samplers=_.samplers.slice(),this.defines=_.defines,this.onError=_.onError,this.onCompiled=_.onCompiled,this._fallbacks=_.fallbacks,this._indexParameters=_.indexParameters,this._transformFeedbackVaryings=_.transformFeedbackVaryings,_.uniformBuffersNames)for(var f=0;f<_.uniformBuffersNames.length;f++)this._uniformBuffersNames[__uv.$wrap((_.uniformBuffersNames[__uv.$wrap((f))]))]=f}else this._engine=o,this.defines=s,this._uniformsNames=n.concat(a),this._samplers=a?a.slice():[],this._attributesNames=r,this.onError=u,this.onCompiled=c,this._indexParameters=h,this._fallbacks=l;this.uniqueId=t._uniqueIdSeed++,i.vertexElement?(d=document.getElementById(i.vertexElement))||(d=i.vertexElement):d=i.vertex||i,i.fragmentElement?(p=document.getElementById(i.fragmentElement))||(p=i.fragmentElement):p=i.fragment||i,this._loadVertexShader(d,(function(e){m._processIncludes(e,(function(e){m._processShaderConversion(e,!1,(function(e){m._loadFragmentShader(p,(function(t){m._processIncludes(t,(function(t){m._processShaderConversion(t,!0,(function(t){if(i){var r=i.vertexElement||i.vertex||i,n=i.fragmentElement||i.fragment||i;m._vertexSourceCode="#define SHADER_NAME vertex:"+r+"\n"+e,m._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t}else m._vertexSourceCode=e,m._fragmentSourceCode=t;m._prepareEffect()}))}))}))}))}))}))}return Object.defineProperty(t.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new e.Observable),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),t.prototype.isReady=function(){return this._isReady},t.prototype.getEngine=function(){return this._engine},t.prototype.getProgram=function(){return this._program},t.prototype.getAttributesNames=function(){return this._attributesNames},t.prototype.getAttributeLocation=function(e){return this._attributes[__uv.$wrap((e))]},t.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[__uv.$wrap((t))]},t.prototype.getAttributesCount=function(){return this._attributes.length},t.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},t.prototype.getUniform=function(e){return this._uniforms[__uv.$wrap((this._uniformsNames.indexOf(e)))]},t.prototype.getSamplers=function(){return this._samplers},t.prototype.getCompilationError=function(){return this._compilationError},t.prototype.executeWhenCompiled=function(e){this.isReady()?e(this):this.onCompileObservable.add((function(t){e(t)}))},t.prototype._loadVertexShader=function(i,r){var n;if(e.Tools.IsWindowObjectExist()&&i instanceof HTMLElement)return void r(e.Tools.GetDOMTextContent(i));"base64:"!==i.substr(0,7)?t.ShadersStore[__uv.$wrap((i+"VertexShader"))]?r(t.ShadersStore[__uv.$wrap((i+"VertexShader"))]):(n="."===i[__uv.$wrap((0))]||"/"===i[__uv.$wrap((0))]||i.indexOf("http")>-1?i:e.Engine.ShadersRepository+i,this._engine._loadFile(n+".vertex.fx",r)):r(window.atob(i.substr(7)))},t.prototype._loadFragmentShader=function(i,r){var n;if(e.Tools.IsWindowObjectExist()&&i instanceof HTMLElement)return void r(e.Tools.GetDOMTextContent(i));"base64:"!==i.substr(0,7)?t.ShadersStore[__uv.$wrap((i+"PixelShader"))]?r(t.ShadersStore[__uv.$wrap((i+"PixelShader"))]):t.ShadersStore[__uv.$wrap((i+"FragmentShader"))]?r(t.ShadersStore[__uv.$wrap((i+"FragmentShader"))]):(n="."===i[__uv.$wrap((0))]||"/"===i[__uv.$wrap((0))]||i.indexOf("http")>-1?i:e.Engine.ShadersRepository+i,this._engine._loadFile(n+".fragment.fx",r)):r(window.atob(i.substr(7)))},t.prototype._dumpShadersSource=function(t,i,r){var n=(this._engine.webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"")+(r?r+"\n":"");i=n+i;var a=2,o=/\n/gm,s="\n1\t"+(t=n+t).replace(o,(function(){return"\n"+a+++"\t"}));a=2;var l="\n1\t"+i.replace(o,(function(){return"\n"+a+++"\t"}));this.name.vertexElement?(e.Tools.Error("Vertex shader: "+this.name.vertexElement+s),e.Tools.Error("Fragment shader: "+this.name.fragmentElement+l)):this.name.vertex?(e.Tools.Error("Vertex shader: "+this.name.vertex+s),e.Tools.Error("Fragment shader: "+this.name.fragment+l)):(e.Tools.Error("Vertex shader: "+this.name+s),e.Tools.Error("Fragment shader: "+this.name+l))},t.prototype._processShaderConversion=function(e,t,i){var r=this._processPrecision(e);if(1!=this._engine.webGLVersion)if(-1===r.indexOf("#version 3")){var n=-1!==r.search(/#extension.+GL_EXT_draw_buffers.+require/),a=r.replace(/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"");a=(a=(a=a.replace(/varying(?![\n\r])\s/g,t?"in ":"out ")).replace(/attribute[ \t]/g,"in ")).replace(/[ \t]attribute/g," in"),t&&(a=(a=(a=(a=(a=(a=(a=(a=a.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/texture2D\s*\(/g,"texture(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(n?"":"out vec4 glFragColor;\n")+"void main(")),i(a)}else i(r.replace("#version 300 es",""));else i(r)},t.prototype._processIncludes=function(i,r){for(var n=this,a=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=a.exec(i),s=new String(i);null!=o;){var l=o[__uv.$wrap((1))];if(-1!==l.indexOf("__decl__")&&(l=l.replace(/__decl__/,""),this._engine.supportsUniformBuffers&&(l=(l=l.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),l+="Declaration"),!t.IncludesShadersStore[__uv.$wrap((l))]){var c=e.Engine.ShadersRepository+"ShadersInclude/"+l+".fx";return void this._engine._loadFile(c,(function(e){t.IncludesShadersStore[__uv.$wrap((l))]=e,n._processIncludes(s,r)}))}var u=t.IncludesShadersStore[__uv.$wrap((l))];if(o[__uv.$wrap((2))])for(var h=o[__uv.$wrap((3))].split(","),d=0;d<h.length;d+=2){var p=new RegExp(h[__uv.$wrap((d))],"g"),m=h[__uv.$wrap((d+1))];u=u.replace(p,m)}if(o[__uv.$wrap((4))]){var _=o[__uv.$wrap((5))];if(-1!==_.indexOf("..")){var f=_.split(".."),g=parseInt(f[__uv.$wrap((0))]),y=parseInt(f[__uv.$wrap((1))]),v=u.slice(0);u="",isNaN(y)&&(y=this._indexParameters[__uv.$wrap((f[__uv.$wrap((1))]))]);for(var b=g;b<y;b++)this._engine.supportsUniformBuffers||(v=v.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),u+=v.replace(/\{X\}/g,b.toString())+"\n"}else this._engine.supportsUniformBuffers||(u=u.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),u=u.replace(/\{X\}/g,_)}s=s.replace(o[__uv.$wrap((0))],u),o=a.exec(i)}r(s)},t.prototype._processPrecision=function(e){return-1===e.indexOf("precision highp float")?e=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+e:"precision mediump float;\n"+e:this._engine.getCaps().highPrecisionShaderSupported||(e=e.replace("precision highp float","precision mediump float")),e},t.prototype._rebuildProgram=function(t,i,r,n){var a=this;this._isReady=!1,this._vertexSourceCodeOverride=t,this._fragmentSourceCodeOverride=i,this.onError=function(e,t){n&&n(t)},this.onCompiled=function(){for(var t=a.getEngine().scenes,i=0;i<t.length;i++)t[__uv.$wrap((i))].markAllMaterialsAsDirty(e.Material.TextureDirtyFlag);r&&r(a._program)},this._fallbacks=null,this._prepareEffect()},t.prototype.getSpecificUniformLocations=function(e){return this._engine.getUniforms(this._program,e)},t.prototype._prepareEffect=function(){var t=this._attributesNames,i=this.defines,r=this._fallbacks;this._valueCache={};var n=this._program;try{var a,o=this._engine;if(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._program=o.createRawShaderProgram(this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,void 0,this._transformFeedbackVaryings):this._program=o.createShaderProgram(this._vertexSourceCode,this._fragmentSourceCode,i,void 0,this._transformFeedbackVaryings),this._program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this),o.supportsUniformBuffers)for(var s in this._uniformBuffersNames)this.bindUniformBlock(s,this._uniformBuffersNames[__uv.$wrap((s))]);for(this._uniforms=o.getUniforms(this._program,this._uniformsNames),this._attributes=o.getAttributes(this._program,t),a=0;a<this._samplers.length;a++){null==this.getUniform(this._samplers[__uv.$wrap((a))])&&(this._samplers.splice(a,1),a--)}o.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),n&&this.getEngine()._deleteProgram(n)}catch(i){this._compilationError=i.message,e.Tools.Error("Unable to compile effect:"),e.Tools.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),e.Tools.Error("Attributes: "+t.map((function(e){return" "+e}))),e.Tools.Error("Error: "+this._compilationError),n&&(this._program=n,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),r&&r.isMoreFallbacks?(e.Tools.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())}},Object.defineProperty(t.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),t.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers.indexOf(e),t)},t.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers.indexOf(e),this.getUniform(e),t)},t.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers.indexOf(e),this.getUniform(e),t)},t.prototype.setTextureArray=function(e,t){if(-1===this._samplers.indexOf(e+"Ex"))for(var i=this._samplers.indexOf(e),r=1;r<t.length;r++)this._samplers.splice(i+r,0,e+"Ex");this._engine.setTextureArray(this._samplers.indexOf(e),this.getUniform(e),t)},t.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers.indexOf(e),t)},t.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers.indexOf(e),t)},t.prototype._cacheMatrix=function(e,t){var i=this._valueCache[__uv.$wrap((e))],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[__uv.$wrap((e))]=r,!0)},t.prototype._cacheFloat2=function(e,t,i){var r=this._valueCache[__uv.$wrap((e))];if(!r)return r=[t,i],this._valueCache[__uv.$wrap((e))]=r,!0;var n=!1;return r[__uv.$wrap((0))]!==t&&(r[__uv.$wrap((0))]=t,n=!0),r[__uv.$wrap((1))]!==i&&(r[__uv.$wrap((1))]=i,n=!0),n},t.prototype._cacheFloat3=function(e,t,i,r){var n=this._valueCache[__uv.$wrap((e))];if(!n)return n=[t,i,r],this._valueCache[__uv.$wrap((e))]=n,!0;var a=!1;return n[__uv.$wrap((0))]!==t&&(n[__uv.$wrap((0))]=t,a=!0),n[__uv.$wrap((1))]!==i&&(n[__uv.$wrap((1))]=i,a=!0),n[__uv.$wrap((2))]!==r&&(n[__uv.$wrap((2))]=r,a=!0),a},t.prototype._cacheFloat4=function(e,t,i,r,n){var a=this._valueCache[__uv.$wrap((e))];if(!a)return a=[t,i,r,n],this._valueCache[__uv.$wrap((e))]=a,!0;var o=!1;return a[__uv.$wrap((0))]!==t&&(a[__uv.$wrap((0))]=t,o=!0),a[__uv.$wrap((1))]!==i&&(a[__uv.$wrap((1))]=i,o=!0),a[__uv.$wrap((2))]!==r&&(a[__uv.$wrap((2))]=r,o=!0),a[__uv.$wrap((3))]!==n&&(a[__uv.$wrap((3))]=n,o=!0),o},t.prototype.bindUniformBuffer=function(e,i){var r=this._uniformBuffersNames[__uv.$wrap((i))];void 0!==r&&t._baseCache[__uv.$wrap((r))]!==e&&(t._baseCache[__uv.$wrap((r))]=e,this._engine.bindUniformBufferBase(e,r))},t.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._program,e,t)},t.prototype.setInt=function(e,t){var i=this._valueCache[__uv.$wrap((e))];return void 0!==i&&i===t||(this._valueCache[__uv.$wrap((e))]=t,this._engine.setInt(this.getUniform(e),t)),this},t.prototype.setIntArray=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setIntArray(this.getUniform(e),t),this},t.prototype.setIntArray2=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setIntArray2(this.getUniform(e),t),this},t.prototype.setIntArray3=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setIntArray3(this.getUniform(e),t),this},t.prototype.setIntArray4=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setIntArray4(this.getUniform(e),t),this},t.prototype.setFloatArray=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setFloatArray(this.getUniform(e),t),this},t.prototype.setFloatArray2=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setFloatArray2(this.getUniform(e),t),this},t.prototype.setFloatArray3=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setFloatArray3(this.getUniform(e),t),this},t.prototype.setFloatArray4=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setFloatArray4(this.getUniform(e),t),this},t.prototype.setArray=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setArray(this.getUniform(e),t),this},t.prototype.setArray2=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setArray2(this.getUniform(e),t),this},t.prototype.setArray3=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setArray3(this.getUniform(e),t),this},t.prototype.setArray4=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setArray4(this.getUniform(e),t),this},t.prototype.setMatrices=function(e,t){return t?(this._valueCache[__uv.$wrap((e))]=null,this._engine.setMatrices(this.getUniform(e),t),this):this},t.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrix(this.getUniform(e),t),this},t.prototype.setMatrix3x3=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setMatrix3x3(this.getUniform(e),t),this},t.prototype.setMatrix2x2=function(e,t){return this._valueCache[__uv.$wrap((e))]=null,this._engine.setMatrix2x2(this.getUniform(e),t),this},t.prototype.setFloat=function(e,t){var i=this._valueCache[__uv.$wrap((e))];return void 0!==i&&i===t||(this._valueCache[__uv.$wrap((e))]=t,this._engine.setFloat(this.getUniform(e),t)),this},t.prototype.setBool=function(e,t){var i=this._valueCache[__uv.$wrap((e))];return void 0!==i&&i===t||(this._valueCache[__uv.$wrap((e))]=t,this._engine.setBool(this.getUniform(e),t?1:0)),this},t.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this.getUniform(e),t.x,t.y),this},t.prototype.setFloat2=function(e,t,i){return this._cacheFloat2(e,t,i)&&this._engine.setFloat2(this.getUniform(e),t,i),this},t.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this.getUniform(e),t.x,t.y,t.z),this},t.prototype.setFloat3=function(e,t,i,r){return this._cacheFloat3(e,t,i,r)&&this._engine.setFloat3(this.getUniform(e),t,i,r),this},t.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this.getUniform(e),t.x,t.y,t.z,t.w),this},t.prototype.setFloat4=function(e,t,i,r,n){return this._cacheFloat4(e,t,i,r,n)&&this._engine.setFloat4(this.getUniform(e),t,i,r,n),this},t.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setColor3(this.getUniform(e),t),this},t.prototype.setColor4=function(e,t,i){return this._cacheFloat4(e,t.r,t.g,t.b,i)&&this._engine.setColor4(this.getUniform(e),t,i),this},t.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setDirectColor4(this.getUniform(e),t),this},t.RegisterShader=function(e,i,r){i&&(t.ShadersStore[__uv.$wrap((e+"PixelShader"))]=i),r&&(t.ShadersStore[__uv.$wrap((e+"VertexShader"))]=r)},t.ResetCache=function(){t._baseCache={}},t._uniqueIdSeed=0,t._baseCache={},t.ShadersStore={},t.IncludesShadersStore={},t}();e.Effect=r}(s||(s={})),function(e){var t=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}();e.KeyboardEventTypes=t;var i=function(e,t){this.type=e,this.event=t};e.KeyboardInfo=i;var r=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.type=t,r.event=i,r.skipOnPointerObservable=!1,r}return a(t,e),t}(i);e.KeyboardInfoPre=r}(s||(s={})),function(e){var t=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}();e.PointerEventTypes=t;var i=function(e,t){this.type=e,this.event=t};e.PointerInfoBase=i;var r=function(t){function i(i,r,n,a){var o=t.call(this,i,r)||this;return o.ray=null,o.skipOnPointerObservable=!1,o.localPosition=new e.Vector2(n,a),o}return a(i,t),i}(i);e.PointerInfoPre=r;var n=function(e){function t(t,i,r){var n=e.call(this,t,i)||this;return n.pickInfo=r,n}return a(t,e),t}(i);e.PointerInfo=n}(s||(s={})),function(e){e.ToGammaSpace=1/2.2,e.ToLinearSpace=2.2,e.Epsilon=.001;var t=function(){function t(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.r=e,this.g=t,this.b=i}return t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.getClassName=function(){return"Color3"},t.prototype.getHashCode=function(){var e=this.r||0;return e=397*(e=397*e^(this.g||0))^(this.b||0)},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[__uv.$wrap((t))]=this.r,e[__uv.$wrap((t+1))]=this.g,e[__uv.$wrap((t+2))]=this.b,this},t.prototype.toColor4=function(e){return void 0===e&&(e=1),new i(this.r,this.g,this.b,e)},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(e){return new t(this.r*e.r,this.g*e.g,this.b*e.b)},t.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},t.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},t.prototype.equalsFloats=function(e,t,i){return this.r===e&&this.g===t&&this.b===i},t.prototype.scale=function(e){return new t(this.r*e,this.g*e,this.b*e)},t.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},t.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},t.prototype.clampToRef=function(t,i,r){return void 0===t&&(t=0),void 0===i&&(i=1),r.r=e.Scalar.Clamp(this.r,t,i),r.g=e.Scalar.Clamp(this.g,t,i),r.b=e.Scalar.Clamp(this.b,t,i),this},t.prototype.add=function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b)},t.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},t.prototype.subtract=function(e){return new t(this.r-e.r,this.g-e.g,this.b-e.b)},t.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},t.prototype.copyFromFloats=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},t.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},t.prototype.toHexString=function(){var t=255*this.r|0,i=255*this.g|0,r=255*this.b|0;return"#"+e.Scalar.ToHex(t)+e.Scalar.ToHex(i)+e.Scalar.ToHex(r)},t.prototype.toLinearSpace=function(){var e=new t;return this.toLinearSpaceToRef(e),e},t.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToLinearSpace),t.g=Math.pow(this.g,e.ToLinearSpace),t.b=Math.pow(this.b,e.ToLinearSpace),this},t.prototype.toGammaSpace=function(){var e=new t;return this.toGammaSpaceToRef(e),e},t.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToGammaSpace),t.g=Math.pow(this.g,e.ToGammaSpace),t.b=Math.pow(this.b,e.ToGammaSpace),this},t.FromHexString=function(e){if("#"!==e.substring(0,1)||7!==e.length)return new t(0,0,0);var i=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16);return t.FromInts(i,r,n)},t.FromArray=function(e,i){return void 0===i&&(i=0),new t(e[__uv.$wrap((i))],e[__uv.$wrap((i+1))],e[__uv.$wrap((i+2))])},t.FromInts=function(e,i,r){return new t(e/255,i/255,r/255)},t.Lerp=function(e,i,r){var n=new t(0,0,0);return t.LerpToRef(e,i,r,n),n},t.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t.Teal=function(){return new t(0,1,1)},t.Random=function(){return new t(Math.random(),Math.random(),Math.random())},t}();e.Color3=t;var i=function(){function t(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.r=e,this.g=t,this.b=i,this.a=r}return t.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[__uv.$wrap((t))]=this.r,e[__uv.$wrap((t+1))]=this.g,e[__uv.$wrap((t+2))]=this.b,e[__uv.$wrap((t+3))]=this.a,this},t.prototype.add=function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},t.prototype.subtract=function(e){return new t(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},t.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},t.prototype.scale=function(e){return new t(this.r*e,this.g*e,this.b*e,this.a*e)},t.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},t.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},t.prototype.clampToRef=function(t,i,r){return void 0===t&&(t=0),void 0===i&&(i=1),r.r=e.Scalar.Clamp(this.r,t,i),r.g=e.Scalar.Clamp(this.g,t,i),r.b=e.Scalar.Clamp(this.b,t,i),r.a=e.Scalar.Clamp(this.a,t,i),this},t.prototype.multiply=function(e){return new t(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)},t.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var e=this.r||0;return e=397*(e=397*(e=397*e^(this.g||0))^(this.b||0))^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},t.prototype.copyFromFloats=function(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this},t.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},t.prototype.toHexString=function(){var t=255*this.r|0,i=255*this.g|0,r=255*this.b|0,n=255*this.a|0;return"#"+e.Scalar.ToHex(t)+e.Scalar.ToHex(i)+e.Scalar.ToHex(r)+e.Scalar.ToHex(n)},t.prototype.toLinearSpace=function(){var e=new t;return this.toLinearSpaceToRef(e),e},t.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToLinearSpace),t.g=Math.pow(this.g,e.ToLinearSpace),t.b=Math.pow(this.b,e.ToLinearSpace),t.a=this.a,this},t.prototype.toGammaSpace=function(){var e=new t;return this.toGammaSpaceToRef(e),e},t.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToGammaSpace),t.g=Math.pow(this.g,e.ToGammaSpace),t.b=Math.pow(this.b,e.ToGammaSpace),t.a=this.a,this},t.FromHexString=function(e){if("#"!==e.substring(0,1)||9!==e.length)return new t(0,0,0,0);var i=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),a=parseInt(e.substring(7,9),16);return t.FromInts(i,r,n,a)},t.Lerp=function(e,i,r){var n=new t(0,0,0,0);return t.LerpToRef(e,i,r,n),n},t.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i},t.FromColor3=function(e,i){return void 0===i&&(i=1),new t(e.r,e.g,e.b,i)},t.FromArray=function(e,i){return void 0===i&&(i=0),new t(e[__uv.$wrap((i))],e[__uv.$wrap((i+1))],e[__uv.$wrap((i+2))],e[__uv.$wrap((i+3))])},t.FromInts=function(e,i,r,n){return new t(e/255,i/255,r/255,n/255)},t.CheckColors4=function(e,t){if(e.length===3*t){for(var i=[],r=0;r<e.length;r+=3){var n=r/3*4;i[__uv.$wrap((n))]=e[__uv.$wrap((r))],i[__uv.$wrap((n+1))]=e[__uv.$wrap((r+1))],i[__uv.$wrap((n+2))]=e[__uv.$wrap((r+2))],i[__uv.$wrap((n+3))]=1}return i}return e},t}();e.Color4=i;var r=function(){function t(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},t.prototype.getClassName=function(){return"Vector2"},t.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0)},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[__uv.$wrap((t))]=this.x,e[__uv.$wrap((t+1))]=this.y,this},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},t.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},t.prototype.set=function(e,t){return this.copyFromFloats(e,t)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},t.prototype.addVector3=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},t.prototype.multiplyByFloats=function(e,i){return new t(this.x*e,this.y*i)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},t.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},t.prototype.scale=function(e){var i=new t(0,0);return this.scaleToRef(e,i),i},t.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},t.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=e.Epsilon),t&&e.Scalar.WithinEpsilon(this.x,t.x,i)&&e.Scalar.WithinEpsilon(this.y,t.y,i)},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.Zero=function(){return new t(0,0)},t.One=function(){return new t(1,1)},t.FromArray=function(e,i){return void 0===i&&(i=0),new t(e[__uv.$wrap((i))],e[__uv.$wrap((i+1))])},t.FromArrayToRef=function(e,t,i){i.x=e[__uv.$wrap((t))],i.y=e[__uv.$wrap((t+1))]},t.CatmullRom=function(e,i,r,n,a){var o=a*a,s=a*o;return new t(.5*(2*i.x+(-e.x+r.x)*a+(2*e.x-5*i.x+4*r.x-n.x)*o+(-e.x+3*i.x-3*r.x+n.x)*s),.5*(2*i.y+(-e.y+r.y)*a+(2*e.y-5*i.y+4*r.y-n.y)*o+(-e.y+3*i.y-3*r.y+n.y)*s))},t.Clamp=function(e,i,r){var n=e.x;n=(n=n>r.x?r.x:n)<i.x?i.x:n;var a=e.y;return new t(n,a=(a=a>r.y?r.y:a)<i.y?i.y:a)},t.Hermite=function(e,i,r,n,a){var o=a*a,s=a*o,l=2*s-3*o+1,c=-2*s+3*o,u=s-2*o+a,h=s-o;return new t(e.x*l+r.x*c+i.x*u+n.x*h,e.y*l+r.y*c+i.y*u+n.y*h)},t.Lerp=function(e,i,r){return new t(e.x+(i.x-e.x)*r,e.y+(i.y-e.y)*r)},t.Dot=function(e,t){return e.x*t.x+e.y*t.y},t.Normalize=function(e){var t=e.clone();return t.normalize(),t},t.Minimize=function(e,i){return new t(e.x<i.x?e.x:i.x,e.y<i.y?e.y:i.y)},t.Maximize=function(e,i){return new t(e.x>i.x?e.x:i.x,e.y>i.y?e.y:i.y)},t.Transform=function(e,i){var r=t.Zero();return t.TransformToRef(e,i,r),r},t.TransformToRef=function(e,t,i){var r=e.x*t.m[__uv.$wrap((0))]+e.y*t.m[__uv.$wrap((4))]+t.m[__uv.$wrap((12))],n=e.x*t.m[__uv.$wrap((1))]+e.y*t.m[__uv.$wrap((5))]+t.m[__uv.$wrap((13))];i.x=r,i.y=n},t.PointInTriangle=function(e,t,i,r){var n=.5*(-i.y*r.x+t.y*(-i.x+r.x)+t.x*(i.y-r.y)+i.x*r.y),a=n<0?-1:1,o=(t.y*r.x-t.x*r.y+(r.y-t.y)*e.x+(t.x-r.x)*e.y)*a,s=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*a;return o>0&&s>0&&o+s<2*n*a},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},t.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},t.DistanceOfPointFromSegment=function(e,i,r){var n=t.DistanceSquared(i,r);if(0===n)return t.Distance(e,i);var a=r.subtract(i),o=Math.max(0,Math.min(1,t.Dot(e.subtract(i),a)/n)),s=i.add(a.multiplyByFloats(o,o));return t.Distance(e,s)},t}();e.Vector2=r;var n=function(){function t(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=i}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},t.prototype.getClassName=function(){return"Vector3"},t.prototype.getHashCode=function(){var e=this.x||0;return e=397*(e=397*e^(this.y||0))^(this.z||0)},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[__uv.$wrap((t))]=this.x,e[__uv.$wrap((t+1))]=this.y,e[__uv.$wrap((t+2))]=this.z,this},t.prototype.toQuaternion=function(){return e.Quaternion.RotationYawPitchRoll(this.x,this.y,this.z)},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,this},t.prototype.subtractFromFloats=function(e,i,r){return new t(this.x-e,this.y-i,this.z-r)},t.prototype.subtractFromFloatsToRef=function(e,t,i,r){return r.x=this.x-e,r.y=this.y-t,r.z=this.z-i,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e)},t.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,this},t.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,this},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=e.Epsilon),t&&e.Scalar.WithinEpsilon(this.x,t.x,i)&&e.Scalar.WithinEpsilon(this.y,t.y,i)&&e.Scalar.WithinEpsilon(this.z,t.z,i)},t.prototype.equalsToFloats=function(e,t,i){return this.x===e&&this.y===t&&this.z===i},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,this},t.prototype.multiplyByFloats=function(e,i,r){return new t(this.x*e,this.y*i,this.z*r)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,this},t.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},t.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e.x,e.y,e.z)},t.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e.x,e.y,e.z)},t.prototype.minimizeInPlaceFromFloats=function(e,t,i){return e<this.x&&(this.x=e),t<this.y&&(this.y=t),i<this.z&&(this.z=i),this},t.prototype.maximizeInPlaceFromFloats=function(e,t,i){return e>this.x&&(this.x=e),t>this.y&&(this.y=t),i>this.z&&(this.z=i),this},Object.defineProperty(t.prototype,"isNonUniform",{get:function(){var e=Math.abs(this.x),t=Math.abs(this.y);if(e!==t)return!0;var i=Math.abs(this.z);return e!==i||t!==i},enumerable:!0,configurable:!0}),t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){var e=this.length();if(0===e||1===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.normalizeToNew=function(){var e=new t(0,0,0);return this.normalizeToRef(e),e},t.prototype.normalizeToRef=function(e){var t=this.length();if(0===t||1===t)return e.set(this.x,this.y,this.z),e;var i=1/t;return this.scaleToRef(i,e),e},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},t.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},t.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},t.GetClipFactor=function(e,i,r,n){var a=t.Dot(e,r)-n;return a/(a-(t.Dot(i,r)-n))},t.GetAngleBetweenVectors=function(e,i,r){var n=T.Vector3[__uv.$wrap((1))].copyFrom(e).normalize(),a=T.Vector3[__uv.$wrap((2))].copyFrom(i).normalize(),o=t.Dot(n,a),s=T.Vector3[__uv.$wrap((3))];return t.CrossToRef(n,a,s),t.Dot(s,r)>0?Math.acos(o):-Math.acos(o)},t.FromArray=function(e,i){return i||(i=0),new t(e[__uv.$wrap((i))],e[__uv.$wrap((i+1))],e[__uv.$wrap((i+2))])},t.FromFloatArray=function(e,i){return t.FromArray(e,i)},t.FromArrayToRef=function(e,t,i){i.x=e[__uv.$wrap((t))],i.y=e[__uv.$wrap((t+1))],i.z=e[__uv.$wrap((t+2))]},t.FromFloatArrayToRef=function(e,i,r){return t.FromArrayToRef(e,i,r)},t.FromFloatsToRef=function(e,t,i,r){r.x=e,r.y=t,r.z=i},t.Zero=function(){return new t(0,0,0)},t.One=function(){return new t(1,1,1)},t.Up=function(){return new t(0,1,0)},t.Down=function(){return new t(0,-1,0)},t.Forward=function(){return new t(0,0,1)},t.Backward=function(){return new t(0,0,-1)},t.Right=function(){return new t(1,0,0)},t.Left=function(){return new t(-1,0,0)},t.TransformCoordinates=function(e,i){var r=t.Zero();return t.TransformCoordinatesToRef(e,i,r),r},t.TransformCoordinatesToRef=function(e,t,i){var r=e.x*t.m[__uv.$wrap((0))]+e.y*t.m[__uv.$wrap((4))]+e.z*t.m[__uv.$wrap((8))]+t.m[__uv.$wrap((12))],n=e.x*t.m[__uv.$wrap((1))]+e.y*t.m[__uv.$wrap((5))]+e.z*t.m[__uv.$wrap((9))]+t.m[__uv.$wrap((13))],a=e.x*t.m[__uv.$wrap((2))]+e.y*t.m[__uv.$wrap((6))]+e.z*t.m[__uv.$wrap((10))]+t.m[__uv.$wrap((14))],o=e.x*t.m[__uv.$wrap((3))]+e.y*t.m[__uv.$wrap((7))]+e.z*t.m[__uv.$wrap((11))]+t.m[__uv.$wrap((15))];i.x=r/o,i.y=n/o,i.z=a/o},t.TransformCoordinatesFromFloatsToRef=function(e,t,i,r,n){var a=e*r.m[__uv.$wrap((0))]+t*r.m[__uv.$wrap((4))]+i*r.m[__uv.$wrap((8))]+r.m[__uv.$wrap((12))],o=e*r.m[__uv.$wrap((1))]+t*r.m[__uv.$wrap((5))]+i*r.m[__uv.$wrap((9))]+r.m[__uv.$wrap((13))],s=e*r.m[__uv.$wrap((2))]+t*r.m[__uv.$wrap((6))]+i*r.m[__uv.$wrap((10))]+r.m[__uv.$wrap((14))],l=e*r.m[__uv.$wrap((3))]+t*r.m[__uv.$wrap((7))]+i*r.m[__uv.$wrap((11))]+r.m[__uv.$wrap((15))];n.x=a/l,n.y=o/l,n.z=s/l},t.TransformNormal=function(e,i){var r=t.Zero();return t.TransformNormalToRef(e,i,r),r},t.TransformNormalToRef=function(e,t,i){var r=e.x*t.m[__uv.$wrap((0))]+e.y*t.m[__uv.$wrap((4))]+e.z*t.m[__uv.$wrap((8))],n=e.x*t.m[__uv.$wrap((1))]+e.y*t.m[__uv.$wrap((5))]+e.z*t.m[__uv.$wrap((9))],a=e.x*t.m[__uv.$wrap((2))]+e.y*t.m[__uv.$wrap((6))]+e.z*t.m[__uv.$wrap((10))];i.x=r,i.y=n,i.z=a},t.TransformNormalFromFloatsToRef=function(e,t,i,r,n){n.x=e*r.m[__uv.$wrap((0))]+t*r.m[__uv.$wrap((4))]+i*r.m[__uv.$wrap((8))],n.y=e*r.m[__uv.$wrap((1))]+t*r.m[__uv.$wrap((5))]+i*r.m[__uv.$wrap((9))],n.z=e*r.m[__uv.$wrap((2))]+t*r.m[__uv.$wrap((6))]+i*r.m[__uv.$wrap((10))]},t.CatmullRom=function(e,i,r,n,a){var o=a*a,s=a*o;return new t(.5*(2*i.x+(-e.x+r.x)*a+(2*e.x-5*i.x+4*r.x-n.x)*o+(-e.x+3*i.x-3*r.x+n.x)*s),.5*(2*i.y+(-e.y+r.y)*a+(2*e.y-5*i.y+4*r.y-n.y)*o+(-e.y+3*i.y-3*r.y+n.y)*s),.5*(2*i.z+(-e.z+r.z)*a+(2*e.z-5*i.z+4*r.z-n.z)*o+(-e.z+3*i.z-3*r.z+n.z)*s))},t.Clamp=function(e,i,r){var n=e.x;n=(n=n>r.x?r.x:n)<i.x?i.x:n;var a=e.y;a=(a=a>r.y?r.y:a)<i.y?i.y:a;var o=e.z;return new t(n,a,o=(o=o>r.z?r.z:o)<i.z?i.z:o)},t.Hermite=function(e,i,r,n,a){var o=a*a,s=a*o,l=2*s-3*o+1,c=-2*s+3*o,u=s-2*o+a,h=s-o;return new t(e.x*l+r.x*c+i.x*u+n.x*h,e.y*l+r.y*c+i.y*u+n.y*h,e.z*l+r.z*c+i.z*u+n.z*h)},t.Lerp=function(e,i,r){var n=new t(0,0,0);return t.LerpToRef(e,i,r,n),n},t.LerpToRef=function(e,t,i,r){r.x=e.x+(t.x-e.x)*i,r.y=e.y+(t.y-e.y)*i,r.z=e.z+(t.z-e.z)*i},t.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.Cross=function(e,i){var r=t.Zero();return t.CrossToRef(e,i,r),r},t.CrossToRef=function(e,t,i){T.Vector3[__uv.$wrap((0))].x=e.y*t.z-e.z*t.y,T.Vector3[__uv.$wrap((0))].y=e.z*t.x-e.x*t.z,T.Vector3[__uv.$wrap((0))].z=e.x*t.y-e.y*t.x,i.copyFrom(T.Vector3[__uv.$wrap((0))])},t.Normalize=function(e){var i=t.Zero();return t.NormalizeToRef(e,i),i},t.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},t.Project=function(e,i,r,n){var a=n.width,o=n.height,s=n.x,c=n.y,u=t._viewportMatrixCache?t._viewportMatrixCache:t._viewportMatrixCache=new l;l.FromValuesToRef(a/2,0,0,0,0,-o/2,0,0,0,0,.5,0,s+a/2,o/2+c,.5,1,u);var h=T.Matrix[__uv.$wrap((0))];return i.multiplyToRef(r,h),h.multiplyToRef(u,h),t.TransformCoordinates(e,h)},t.UnprojectFromTransform=function(i,r,n,a,o){var s=T.Matrix[__uv.$wrap((0))];a.multiplyToRef(o,s),s.invert(),i.x=i.x/r*2-1,i.y=-(i.y/n*2-1);var l=t.TransformCoordinates(i,s),c=i.x*s.m[__uv.$wrap((3))]+i.y*s.m[__uv.$wrap((7))]+i.z*s.m[__uv.$wrap((11))]+s.m[__uv.$wrap((15))];return e.Scalar.WithinEpsilon(c,1)&&(l=l.scale(1/c)),l},t.Unproject=function(e,i,r,n,a,o){var s=t.Zero();return t.UnprojectToRef(e,i,r,n,a,o,s),s},t.UnprojectToRef=function(e,i,r,n,a,o,s){t.UnprojectFloatsToRef(e.x,e.y,e.z,i,r,n,a,o,s)},t.UnprojectFloatsToRef=function(i,r,n,a,o,s,l,c,u){var h=T.Matrix[__uv.$wrap((0))];s.multiplyToRef(l,h),h.multiplyToRef(c,h),h.invert();var d=T.Vector3[__uv.$wrap((0))];d.x=i/a*2-1,d.y=-(r/o*2-1),d.z=2*n-1,t.TransformCoordinatesToRef(d,h,u);var p=d.x*h.m[__uv.$wrap((3))]+d.y*h.m[__uv.$wrap((7))]+d.z*h.m[__uv.$wrap((11))]+h.m[__uv.$wrap((15))];e.Scalar.WithinEpsilon(p,1)&&u.scaleInPlace(1/p)},t.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},t.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return i*i+r*r+n*n},t.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},t.RotationFromAxis=function(e,i,r){var n=t.Zero();return t.RotationFromAxisToRef(e,i,r,n),n},t.RotationFromAxisToRef=function(e,t,i,r){var n=T.Quaternion[__uv.$wrap((0))];s.RotationQuaternionFromAxisToRef(e,t,i,n),n.toEulerAnglesToRef(r)},t}();e.Vector3=n;var a=function(){function t(e,t,i,r){this.x=e,this.y=t,this.z=i,this.w=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Vector4"},t.prototype.getHashCode=function(){var e=this.x||0;return e=397*(e=397*(e=397*e^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[__uv.$wrap((t))]=this.x,e[__uv.$wrap((t+1))]=this.y,e[__uv.$wrap((t+2))]=this.z,e[__uv.$wrap((t+3))]=this.w,this},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},t.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},t.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},t.prototype.subtractFromFloats=function(e,i,r,n){return new t(this.x-e,this.y-i,this.z-r,this.w-n)},t.prototype.subtractFromFloatsToRef=function(e,t,i,r,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-i,n.w=this.w-r,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e,this.w*e)},t.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},t.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=e.Epsilon),t&&e.Scalar.WithinEpsilon(this.x,t.x,i)&&e.Scalar.WithinEpsilon(this.y,t.y,i)&&e.Scalar.WithinEpsilon(this.z,t.z,i)&&e.Scalar.WithinEpsilon(this.w,t.w,i)},t.prototype.equalsToFloats=function(e,t,i,r){return this.x===e&&this.y===t&&this.z===i&&this.w===r},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},t.prototype.multiplyByFloats=function(e,i,r,n){return new t(this.x*e,this.y*i,this.z*r,this.w*n)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},t.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},t.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},t.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toVector3=function(){return new n(this.x,this.y,this.z)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},t.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},t.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},t.FromArray=function(e,i){return i||(i=0),new t(e[__uv.$wrap((i))],e[__uv.$wrap((i+1))],e[__uv.$wrap((i+2))],e[__uv.$wrap((i+3))])},t.FromArrayToRef=function(e,t,i){i.x=e[__uv.$wrap((t))],i.y=e[__uv.$wrap((t+1))],i.z=e[__uv.$wrap((t+2))],i.w=e[__uv.$wrap((t+3))]},t.FromFloatArrayToRef=function(e,i,r){t.FromArrayToRef(e,i,r)},t.FromFloatsToRef=function(e,t,i,r,n){n.x=e,n.y=t,n.z=i,n.w=r},t.Zero=function(){return new t(0,0,0,0)},t.One=function(){return new t(1,1,1,1)},t.Normalize=function(e){var i=t.Zero();return t.NormalizeToRef(e,i),i},t.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},t.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},t.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z,a=e.w-t.w;return i*i+r*r+n*n+a*a},t.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},t.TransformNormal=function(e,i){var r=t.Zero();return t.TransformNormalToRef(e,i,r),r},t.TransformNormalToRef=function(e,t,i){var r=e.x*t.m[__uv.$wrap((0))]+e.y*t.m[__uv.$wrap((4))]+e.z*t.m[__uv.$wrap((8))],n=e.x*t.m[__uv.$wrap((1))]+e.y*t.m[__uv.$wrap((5))]+e.z*t.m[__uv.$wrap((9))],a=e.x*t.m[__uv.$wrap((2))]+e.y*t.m[__uv.$wrap((6))]+e.z*t.m[__uv.$wrap((10))];i.x=r,i.y=n,i.z=a,i.w=e.w},t.TransformNormalFromFloatsToRef=function(e,t,i,r,n,a){a.x=e*n.m[__uv.$wrap((0))]+t*n.m[__uv.$wrap((4))]+i*n.m[__uv.$wrap((8))],a.y=e*n.m[__uv.$wrap((1))]+t*n.m[__uv.$wrap((5))]+i*n.m[__uv.$wrap((9))],a.z=e*n.m[__uv.$wrap((2))]+t*n.m[__uv.$wrap((6))]+i*n.m[__uv.$wrap((10))],a.w=r},t}();e.Vector4=a;var o=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},e.prototype.getClassName=function(){return"Size"},e.prototype.getHashCode=function(){var e=this.width||0;return e=397*e^(this.height||0)},e.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.multiplyByFloats=function(t,i){return new e(this.width*t,this.height*i)},e.prototype.clone=function(){return new e(this.width,this.height)},e.prototype.equals=function(e){return!!e&&(this.width===e.width&&this.height===e.height)},Object.defineProperty(e.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.Zero=function(){return new e(0,0)},e.prototype.add=function(t){return new e(this.width+t.width,this.height+t.height)},e.prototype.subtract=function(t){return new e(this.width-t.width,this.height-t.height)},e.Lerp=function(t,i,r){return new e(t.width+(i.width-t.width)*r,t.height+(i.height-t.height)*r)},e}();e.Size=o;var s=function(){function e(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=e,this.y=t,this.z=i,this.w=r}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){var e=this.x||0;return e=397*(e=397*(e=397*e^(this.y||0))^(this.z||0))^(this.w||0)},e.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},e.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.multiply=function(t){var i=new e(0,0,0,1);return this.multiplyToRef(t,i),i},e.prototype.multiplyToRef=function(e,t){var i=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,r=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,n=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,a=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;return t.copyFromFloats(i,r,n,a),this},e.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},e.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){return new e(-this.x,-this.y,-this.z,this.w)},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var e=1/this.length();return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.toEulerAngles=function(e){void 0===e&&(e="YZX");var t=n.Zero();return this.toEulerAnglesToRef(t,e),t},e.prototype.toEulerAnglesToRef=function(e,t){void 0===t&&(t="YZX");var i=this.z,r=this.x,n=this.y,a=this.w,o=a*a,s=i*i,l=r*r,c=n*n,u=n*i-r*a;return u<-.4999999?(e.y=2*Math.atan2(n,a),e.x=Math.PI/2,e.z=0):u>.4999999?(e.y=2*Math.atan2(n,a),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(r*n+i*a),-s-l+c+o),e.x=Math.asin(-2*(i*n-r*a)),e.y=Math.atan2(2*(i*r+n*a),s-l-c+o)),this},e.prototype.toRotationMatrix=function(e){var t=this.x*this.x,i=this.y*this.y,r=this.z*this.z,n=this.x*this.y,a=this.z*this.w,o=this.z*this.x,s=this.y*this.w,l=this.y*this.z,c=this.x*this.w;return e.m[__uv.$wrap((0))]=1-2*(i+r),e.m[__uv.$wrap((1))]=2*(n+a),e.m[__uv.$wrap((2))]=2*(o-s),e.m[__uv.$wrap((3))]=0,e.m[__uv.$wrap((4))]=2*(n-a),e.m[__uv.$wrap((5))]=1-2*(r+t),e.m[__uv.$wrap((6))]=2*(l+c),e.m[__uv.$wrap((7))]=0,e.m[__uv.$wrap((8))]=2*(o+s),e.m[__uv.$wrap((9))]=2*(l-c),e.m[__uv.$wrap((10))]=1-2*(i+t),e.m[__uv.$wrap((11))]=0,e.m[__uv.$wrap((12))]=0,e.m[__uv.$wrap((13))]=0,e.m[__uv.$wrap((14))]=0,e.m[__uv.$wrap((15))]=1,e._markAsUpdated(),this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var i=new e;return e.FromRotationMatrixToRef(t,i),i},e.FromRotationMatrixToRef=function(e,t){var i,r=e.m,n=r[__uv.$wrap((0))],a=r[__uv.$wrap((4))],o=r[__uv.$wrap((8))],s=r[__uv.$wrap((1))],l=r[__uv.$wrap((5))],c=r[__uv.$wrap((9))],u=r[__uv.$wrap((2))],h=r[__uv.$wrap((6))],d=r[__uv.$wrap((10))],p=n+l+d;p>0?(i=.5/Math.sqrt(p+1),t.w=.25/i,t.x=(h-c)*i,t.y=(o-u)*i,t.z=(s-a)*i):n>l&&n>d?(i=2*Math.sqrt(1+n-l-d),t.w=(h-c)/i,t.x=.25*i,t.y=(a+s)/i,t.z=(o+u)/i):l>d?(i=2*Math.sqrt(1+l-n-d),t.w=(o-u)/i,t.x=(a+s)/i,t.y=.25*i,t.z=(c+h)/i):(i=2*Math.sqrt(1+d-n-l),t.w=(s-a)/i,t.x=(o+u)/i,t.y=(c+h)/i,t.z=.25*i)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},e.AreClose=function(t,i){return e.Dot(t,i)>=0},e.Zero=function(){return new e(0,0,0,0)},e.Inverse=function(t){return new e(-t.x,-t.y,-t.z,t.w)},e.Identity=function(){return new e(0,0,0,1)},e.IsIdentity=function(e){return e&&0===e.x&&0===e.y&&0===e.z&&1===e.w},e.RotationAxis=function(t,i){return e.RotationAxisToRef(t,i,new e)},e.RotationAxisToRef=function(e,t,i){var r=Math.sin(t/2);return e.normalize(),i.w=Math.cos(t/2),i.x=e.x*r,i.y=e.y*r,i.z=e.z*r,i},e.FromArray=function(t,i){return i||(i=0),new e(t[__uv.$wrap((i))],t[__uv.$wrap((i+1))],t[__uv.$wrap((i+2))],t[__uv.$wrap((i+3))])},e.RotationYawPitchRoll=function(t,i,r){var n=new e;return e.RotationYawPitchRollToRef(t,i,r,n),n},e.RotationYawPitchRollToRef=function(e,t,i,r){var n=.5*i,a=.5*t,o=.5*e,s=Math.sin(n),l=Math.cos(n),c=Math.sin(a),u=Math.cos(a),h=Math.sin(o),d=Math.cos(o);r.x=d*c*l+h*u*s,r.y=h*u*l-d*c*s,r.z=d*u*s-h*c*l,r.w=d*u*l+h*c*s},e.RotationAlphaBetaGamma=function(t,i,r){var n=new e;return e.RotationAlphaBetaGammaToRef(t,i,r,n),n},e.RotationAlphaBetaGammaToRef=function(e,t,i,r){var n=.5*(i+e),a=.5*(i-e),o=.5*t;r.x=Math.cos(a)*Math.sin(o),r.y=Math.sin(a)*Math.sin(o),r.z=Math.sin(n)*Math.cos(o),r.w=Math.cos(n)*Math.cos(o)},e.RotationQuaternionFromAxis=function(t,i,r){var n=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,i,r,n),n},e.RotationQuaternionFromAxisToRef=function(t,i,r,n){var a=T.Matrix[__uv.$wrap((0))];l.FromXYZAxesToRef(t.normalize(),i.normalize(),r.normalize(),a),e.FromRotationMatrixToRef(a,n)},e.Slerp=function(t,i,r){var n=e.Identity();return e.SlerpToRef(t,i,r,n),n},e.SlerpToRef=function(e,t,i,r){var n,a,o=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,s=!1;if(o<0&&(s=!0,o=-o),o>.999999)a=1-i,n=s?-i:i;else{var l=Math.acos(o),c=1/Math.sin(l);a=Math.sin((1-i)*l)*c,n=s?-Math.sin(i*l)*c:Math.sin(i*l)*c}r.x=a*e.x+n*t.x,r.y=a*e.y+n*t.y,r.z=a*e.z+n*t.z,r.w=a*e.w+n*t.w},e.Hermite=function(t,i,r,n,a){var o=a*a,s=a*o,l=2*s-3*o+1,c=-2*s+3*o,u=s-2*o+a,h=s-o;return new e(t.x*l+r.x*c+i.x*u+n.x*h,t.y*l+r.y*c+i.y*u+n.y*h,t.z*l+r.z*c+i.z*u+n.z*h,t.w*l+r.w*c+i.w*u+n.w*h)},e}();e.Quaternion=s;var l=function(){function e(){this._isIdentity=!1,this._isIdentityDirty=!0,this.m=new Float32Array(16),this._markAsUpdated()}return e.prototype._markAsUpdated=function(){this.updateFlag=e._updateFlagSeed++,this._isIdentityDirty=!0},e.prototype.isIdentity=function(e){return void 0===e&&(e=!1),this._isIdentityDirty&&(this._isIdentityDirty=!1,1!==this.m[__uv.$wrap((0))]||1!==this.m[__uv.$wrap((5))]||1!==this.m[__uv.$wrap((15))]||0!==this.m[__uv.$wrap((1))]||0!==this.m[__uv.$wrap((2))]||0!==this.m[__uv.$wrap((3))]||0!==this.m[__uv.$wrap((4))]||0!==this.m[__uv.$wrap((6))]||0!==this.m[__uv.$wrap((7))]||0!==this.m[__uv.$wrap((8))]||0!==this.m[__uv.$wrap((9))]||0!==this.m[__uv.$wrap((11))]||0!==this.m[__uv.$wrap((12))]||0!==this.m[__uv.$wrap((13))]||0!==this.m[__uv.$wrap((14))]?this._isIdentity=!1:this._isIdentity=!0,e||1===this.m[__uv.$wrap((10))]||(this._isIdentity=!1)),this._isIdentity},e.prototype.determinant=function(){var e=this.m[__uv.$wrap((10))]*this.m[__uv.$wrap((15))]-this.m[__uv.$wrap((11))]*this.m[__uv.$wrap((14))],t=this.m[__uv.$wrap((9))]*this.m[__uv.$wrap((15))]-this.m[__uv.$wrap((11))]*this.m[__uv.$wrap((13))],i=this.m[__uv.$wrap((9))]*this.m[__uv.$wrap((14))]-this.m[__uv.$wrap((10))]*this.m[__uv.$wrap((13))],r=this.m[__uv.$wrap((8))]*this.m[__uv.$wrap((15))]-this.m[__uv.$wrap((11))]*this.m[__uv.$wrap((12))],n=this.m[__uv.$wrap((8))]*this.m[__uv.$wrap((14))]-this.m[__uv.$wrap((10))]*this.m[__uv.$wrap((12))],a=this.m[__uv.$wrap((8))]*this.m[__uv.$wrap((13))]-this.m[__uv.$wrap((9))]*this.m[__uv.$wrap((12))];return this.m[__uv.$wrap((0))]*(this.m[__uv.$wrap((5))]*e-this.m[__uv.$wrap((6))]*t+this.m[__uv.$wrap((7))]*i)-this.m[__uv.$wrap((1))]*(this.m[__uv.$wrap((4))]*e-this.m[__uv.$wrap((6))]*r+this.m[__uv.$wrap((7))]*n)+this.m[__uv.$wrap((2))]*(this.m[__uv.$wrap((4))]*t-this.m[__uv.$wrap((5))]*r+this.m[__uv.$wrap((7))]*a)-this.m[__uv.$wrap((3))]*(this.m[__uv.$wrap((4))]*i-this.m[__uv.$wrap((5))]*n+this.m[__uv.$wrap((6))]*a)},e.prototype.toArray=function(){return this.m},e.prototype.asArray=function(){return this.toArray()},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){for(var e=0;e<16;e++)this.m[__uv.$wrap((e))]=0;return this._markAsUpdated(),this},e.prototype.add=function(t){var i=new e;return this.addToRef(t,i),i},e.prototype.addToRef=function(e,t){for(var i=0;i<16;i++)t.m[__uv.$wrap((i))]=this.m[__uv.$wrap((i))]+e.m[__uv.$wrap((i))];return t._markAsUpdated(),this},e.prototype.addToSelf=function(e){for(var t=0;t<16;t++)this.m[__uv.$wrap((t))]+=e.m[__uv.$wrap((t))];return this._markAsUpdated(),this},e.prototype.invertToRef=function(e){var t=this.m[__uv.$wrap((0))],i=this.m[__uv.$wrap((1))],r=this.m[__uv.$wrap((2))],n=this.m[__uv.$wrap((3))],a=this.m[__uv.$wrap((4))],o=this.m[__uv.$wrap((5))],s=this.m[__uv.$wrap((6))],l=this.m[__uv.$wrap((7))],c=this.m[__uv.$wrap((8))],u=this.m[__uv.$wrap((9))],h=this.m[__uv.$wrap((10))],d=this.m[__uv.$wrap((11))],p=this.m[__uv.$wrap((12))],m=this.m[__uv.$wrap((13))],_=this.m[__uv.$wrap((14))],f=this.m[__uv.$wrap((15))],g=h*f-d*_,y=u*f-d*m,v=u*_-h*m,b=c*f-d*p,x=c*_-h*p,S=c*m-u*p,T=o*g-s*y+l*v,E=-(a*g-s*b+l*x),P=a*y-o*b+l*S,A=-(a*v-o*x+s*S),M=1/(t*T+i*E+r*P+n*A),C=s*f-l*_,R=o*f-l*m,w=o*_-s*m,I=a*f-l*p,O=a*_-s*p,D=a*m-o*p,k=s*d-l*h,B=o*d-l*u,F=o*h-s*u,L=a*d-l*c,N=a*h-s*c,V=a*u-o*c;return e.m[__uv.$wrap((0))]=T*M,e.m[__uv.$wrap((4))]=E*M,e.m[__uv.$wrap((8))]=P*M,e.m[__uv.$wrap((12))]=A*M,e.m[__uv.$wrap((1))]=-(i*g-r*y+n*v)*M,e.m[__uv.$wrap((5))]=(t*g-r*b+n*x)*M,e.m[__uv.$wrap((9))]=-(t*y-i*b+n*S)*M,e.m[__uv.$wrap((13))]=(t*v-i*x+r*S)*M,e.m[__uv.$wrap((2))]=(i*C-r*R+n*w)*M,e.m[__uv.$wrap((6))]=-(t*C-r*I+n*O)*M,e.m[__uv.$wrap((10))]=(t*R-i*I+n*D)*M,e.m[__uv.$wrap((14))]=-(t*w-i*O+r*D)*M,e.m[__uv.$wrap((3))]=-(i*k-r*B+n*F)*M,e.m[__uv.$wrap((7))]=(t*k-r*L+n*N)*M,e.m[__uv.$wrap((11))]=-(t*B-i*L+n*V)*M,e.m[__uv.$wrap((15))]=(t*F-i*N+r*V)*M,e._markAsUpdated(),this},e.prototype.setTranslationFromFloats=function(e,t,i){return this.m[__uv.$wrap((12))]=e,this.m[__uv.$wrap((13))]=t,this.m[__uv.$wrap((14))]=i,this._markAsUpdated(),this},e.prototype.setTranslation=function(e){return this.m[__uv.$wrap((12))]=e.x,this.m[__uv.$wrap((13))]=e.y,this.m[__uv.$wrap((14))]=e.z,this._markAsUpdated(),this},e.prototype.getTranslation=function(){return new n(this.m[__uv.$wrap((12))],this.m[__uv.$wrap((13))],this.m[__uv.$wrap((14))])},e.prototype.getTranslationToRef=function(e){return e.x=this.m[__uv.$wrap((12))],e.y=this.m[__uv.$wrap((13))],e.z=this.m[__uv.$wrap((14))],this},e.prototype.removeRotationAndScaling=function(){return this.setRowFromFloats(0,1,0,0,0),this.setRowFromFloats(1,0,1,0,0),this.setRowFromFloats(2,0,0,1,0),this},e.prototype.multiply=function(t){var i=new e;return this.multiplyToRef(t,i),i},e.prototype.copyFrom=function(e){for(var t=0;t<16;t++)this.m[__uv.$wrap((t))]=e.m[__uv.$wrap((t))];return this._markAsUpdated(),this},e.prototype.copyToArray=function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)e[__uv.$wrap((t+i))]=this.m[__uv.$wrap((i))];return this},e.prototype.multiplyToRef=function(e,t){return this.multiplyToArray(e,t.m,0),t._markAsUpdated(),this},e.prototype.multiplyToArray=function(e,t,i){var r=this.m[__uv.$wrap((0))],n=this.m[__uv.$wrap((1))],a=this.m[__uv.$wrap((2))],o=this.m[__uv.$wrap((3))],s=this.m[__uv.$wrap((4))],l=this.m[__uv.$wrap((5))],c=this.m[__uv.$wrap((6))],u=this.m[__uv.$wrap((7))],h=this.m[__uv.$wrap((8))],d=this.m[__uv.$wrap((9))],p=this.m[__uv.$wrap((10))],m=this.m[__uv.$wrap((11))],_=this.m[__uv.$wrap((12))],f=this.m[__uv.$wrap((13))],g=this.m[__uv.$wrap((14))],y=this.m[__uv.$wrap((15))],v=e.m[__uv.$wrap((0))],b=e.m[__uv.$wrap((1))],x=e.m[__uv.$wrap((2))],S=e.m[__uv.$wrap((3))],T=e.m[__uv.$wrap((4))],E=e.m[__uv.$wrap((5))],P=e.m[__uv.$wrap((6))],A=e.m[__uv.$wrap((7))],M=e.m[__uv.$wrap((8))],C=e.m[__uv.$wrap((9))],R=e.m[__uv.$wrap((10))],w=e.m[__uv.$wrap((11))],I=e.m[__uv.$wrap((12))],O=e.m[__uv.$wrap((13))],D=e.m[__uv.$wrap((14))],k=e.m[__uv.$wrap((15))];return t[__uv.$wrap((i))]=r*v+n*T+a*M+o*I,t[__uv.$wrap((i+1))]=r*b+n*E+a*C+o*O,t[__uv.$wrap((i+2))]=r*x+n*P+a*R+o*D,t[__uv.$wrap((i+3))]=r*S+n*A+a*w+o*k,t[__uv.$wrap((i+4))]=s*v+l*T+c*M+u*I,t[__uv.$wrap((i+5))]=s*b+l*E+c*C+u*O,t[__uv.$wrap((i+6))]=s*x+l*P+c*R+u*D,t[__uv.$wrap((i+7))]=s*S+l*A+c*w+u*k,t[__uv.$wrap((i+8))]=h*v+d*T+p*M+m*I,t[__uv.$wrap((i+9))]=h*b+d*E+p*C+m*O,t[__uv.$wrap((i+10))]=h*x+d*P+p*R+m*D,t[__uv.$wrap((i+11))]=h*S+d*A+p*w+m*k,t[__uv.$wrap((i+12))]=_*v+f*T+g*M+y*I,t[__uv.$wrap((i+13))]=_*b+f*E+g*C+y*O,t[__uv.$wrap((i+14))]=_*x+f*P+g*R+y*D,t[__uv.$wrap((i+15))]=_*S+f*A+g*w+y*k,this},e.prototype.equals=function(e){return e&&this.m[__uv.$wrap((0))]===e.m[__uv.$wrap((0))]&&this.m[__uv.$wrap((1))]===e.m[__uv.$wrap((1))]&&this.m[__uv.$wrap((2))]===e.m[__uv.$wrap((2))]&&this.m[__uv.$wrap((3))]===e.m[__uv.$wrap((3))]&&this.m[__uv.$wrap((4))]===e.m[__uv.$wrap((4))]&&this.m[__uv.$wrap((5))]===e.m[__uv.$wrap((5))]&&this.m[__uv.$wrap((6))]===e.m[__uv.$wrap((6))]&&this.m[__uv.$wrap((7))]===e.m[__uv.$wrap((7))]&&this.m[__uv.$wrap((8))]===e.m[__uv.$wrap((8))]&&this.m[__uv.$wrap((9))]===e.m[__uv.$wrap((9))]&&this.m[__uv.$wrap((10))]===e.m[__uv.$wrap((10))]&&this.m[__uv.$wrap((11))]===e.m[__uv.$wrap((11))]&&this.m[__uv.$wrap((12))]===e.m[__uv.$wrap((12))]&&this.m[__uv.$wrap((13))]===e.m[__uv.$wrap((13))]&&this.m[__uv.$wrap((14))]===e.m[__uv.$wrap((14))]&&this.m[__uv.$wrap((15))]===e.m[__uv.$wrap((15))]},e.prototype.clone=function(){return e.FromValues(this.m[__uv.$wrap((0))],this.m[__uv.$wrap((1))],this.m[__uv.$wrap((2))],this.m[__uv.$wrap((3))],this.m[__uv.$wrap((4))],this.m[__uv.$wrap((5))],this.m[__uv.$wrap((6))],this.m[__uv.$wrap((7))],this.m[__uv.$wrap((8))],this.m[__uv.$wrap((9))],this.m[__uv.$wrap((10))],this.m[__uv.$wrap((11))],this.m[__uv.$wrap((12))],this.m[__uv.$wrap((13))],this.m[__uv.$wrap((14))],this.m[__uv.$wrap((15))])},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var e=this.m[__uv.$wrap((0))]||0,t=1;t<16;t++)e=397*e^(this.m[__uv.$wrap((t))]||0);return e},e.prototype.decompose=function(t,i,r){return r&&(r.x=this.m[__uv.$wrap((12))],r.y=this.m[__uv.$wrap((13))],r.z=this.m[__uv.$wrap((14))]),(t=t||T.Vector3[__uv.$wrap((0))]).x=Math.sqrt(this.m[__uv.$wrap((0))]*this.m[__uv.$wrap((0))]+this.m[__uv.$wrap((1))]*this.m[__uv.$wrap((1))]+this.m[__uv.$wrap((2))]*this.m[__uv.$wrap((2))]),t.y=Math.sqrt(this.m[__uv.$wrap((4))]*this.m[__uv.$wrap((4))]+this.m[__uv.$wrap((5))]*this.m[__uv.$wrap((5))]+this.m[__uv.$wrap((6))]*this.m[__uv.$wrap((6))]),t.z=Math.sqrt(this.m[__uv.$wrap((8))]*this.m[__uv.$wrap((8))]+this.m[__uv.$wrap((9))]*this.m[__uv.$wrap((9))]+this.m[__uv.$wrap((10))]*this.m[__uv.$wrap((10))]),this.determinant()<=0&&(t.y*=-1),0===t.x||0===t.y||0===t.z?(i&&(i.x=0,i.y=0,i.z=0,i.w=1),!1):(i&&(e.FromValuesToRef(this.m[__uv.$wrap((0))]/t.x,this.m[__uv.$wrap((1))]/t.x,this.m[__uv.$wrap((2))]/t.x,0,this.m[__uv.$wrap((4))]/t.y,this.m[__uv.$wrap((5))]/t.y,this.m[__uv.$wrap((6))]/t.y,0,this.m[__uv.$wrap((8))]/t.z,this.m[__uv.$wrap((9))]/t.z,this.m[__uv.$wrap((10))]/t.z,0,0,0,0,1,T.Matrix[__uv.$wrap((0))]),s.FromRotationMatrixToRef(T.Matrix[__uv.$wrap((0))],i)),!0)},e.prototype.getRow=function(e){if(e<0||e>3)return null;var t=4*e;return new a(this.m[__uv.$wrap((t+0))],this.m[__uv.$wrap((t+1))],this.m[__uv.$wrap((t+2))],this.m[__uv.$wrap((t+3))])},e.prototype.setRow=function(e,t){if(e<0||e>3)return this;var i=4*e;return this.m[__uv.$wrap((i+0))]=t.x,this.m[__uv.$wrap((i+1))]=t.y,this.m[__uv.$wrap((i+2))]=t.z,this.m[__uv.$wrap((i+3))]=t.w,this._markAsUpdated(),this},e.prototype.transpose=function(){return e.Transpose(this)},e.prototype.transposeToRef=function(t){return e.TransposeToRef(this,t),this},e.prototype.setRowFromFloats=function(e,t,i,r,n){if(e<0||e>3)return this;var a=4*e;return this.m[__uv.$wrap((a+0))]=t,this.m[__uv.$wrap((a+1))]=i,this.m[__uv.$wrap((a+2))]=r,this.m[__uv.$wrap((a+3))]=n,this._markAsUpdated(),this},e.prototype.scale=function(t){var i=new e;return this.scaleToRef(t,i),i},e.prototype.scaleToRef=function(e,t){for(var i=0;i<16;i++)t.m[__uv.$wrap((i))]=this.m[__uv.$wrap((i))]*e;return t._markAsUpdated(),this},e.prototype.scaleAndAddToRef=function(e,t){for(var i=0;i<16;i++)t.m[__uv.$wrap((i))]+=this.m[__uv.$wrap((i))]*e;return t._markAsUpdated(),this},e.prototype.toNormalMatrix=function(t){this.invertToRef(t),t.transpose();var i=t.m;e.FromValuesToRef(i[__uv.$wrap((0))],i[__uv.$wrap((1))],i[__uv.$wrap((2))],0,i[__uv.$wrap((4))],i[__uv.$wrap((5))],i[__uv.$wrap((6))],0,i[__uv.$wrap((8))],i[__uv.$wrap((9))],i[__uv.$wrap((10))],0,0,0,0,1,t)},e.prototype.getRotationMatrix=function(){var t=e.Identity();return this.getRotationMatrixToRef(t),t},e.prototype.getRotationMatrixToRef=function(t){var i=this.m,r=Math.sqrt(i[__uv.$wrap((0))]*i[__uv.$wrap((0))]+i[__uv.$wrap((1))]*i[__uv.$wrap((1))]+i[__uv.$wrap((2))]*i[__uv.$wrap((2))]),n=Math.sqrt(i[__uv.$wrap((4))]*i[__uv.$wrap((4))]+i[__uv.$wrap((5))]*i[__uv.$wrap((5))]+i[__uv.$wrap((6))]*i[__uv.$wrap((6))]),a=Math.sqrt(i[__uv.$wrap((8))]*i[__uv.$wrap((8))]+i[__uv.$wrap((9))]*i[__uv.$wrap((9))]+i[__uv.$wrap((10))]*i[__uv.$wrap((10))]);return this.determinant()<=0&&(n*=-1),0===r||0===n||0===a?e.IdentityToRef(t):e.FromValuesToRef(i[__uv.$wrap((0))]/r,i[__uv.$wrap((1))]/r,i[__uv.$wrap((2))]/r,0,i[__uv.$wrap((4))]/n,i[__uv.$wrap((5))]/n,i[__uv.$wrap((6))]/n,0,i[__uv.$wrap((8))]/a,i[__uv.$wrap((9))]/a,i[__uv.$wrap((10))]/a,0,0,0,0,1,t),this},e.FromArray=function(t,i){var r=new e;return i||(i=0),e.FromArrayToRef(t,i,r),r},e.FromArrayToRef=function(e,t,i){for(var r=0;r<16;r++)i.m[__uv.$wrap((r))]=e[__uv.$wrap((r+t))];i._markAsUpdated()},e.FromFloat32ArrayToRefScaled=function(e,t,i,r){for(var n=0;n<16;n++)r.m[__uv.$wrap((n))]=e[__uv.$wrap((n+t))]*i;r._markAsUpdated()},e.FromValuesToRef=function(e,t,i,r,n,a,o,s,l,c,u,h,d,p,m,_,f){f.m[__uv.$wrap((0))]=e,f.m[__uv.$wrap((1))]=t,f.m[__uv.$wrap((2))]=i,f.m[__uv.$wrap((3))]=r,f.m[__uv.$wrap((4))]=n,f.m[__uv.$wrap((5))]=a,f.m[__uv.$wrap((6))]=o,f.m[__uv.$wrap((7))]=s,f.m[__uv.$wrap((8))]=l,f.m[__uv.$wrap((9))]=c,f.m[__uv.$wrap((10))]=u,f.m[__uv.$wrap((11))]=h,f.m[__uv.$wrap((12))]=d,f.m[__uv.$wrap((13))]=p,f.m[__uv.$wrap((14))]=m,f.m[__uv.$wrap((15))]=_,f._markAsUpdated()},Object.defineProperty(e,"IdentityReadOnly",{get:function(){return e._identityReadOnly},enumerable:!0,configurable:!0}),e.FromValues=function(t,i,r,n,a,o,s,l,c,u,h,d,p,m,_,f){var g=new e;return g.m[__uv.$wrap((0))]=t,g.m[__uv.$wrap((1))]=i,g.m[__uv.$wrap((2))]=r,g.m[__uv.$wrap((3))]=n,g.m[__uv.$wrap((4))]=a,g.m[__uv.$wrap((5))]=o,g.m[__uv.$wrap((6))]=s,g.m[__uv.$wrap((7))]=l,g.m[__uv.$wrap((8))]=c,g.m[__uv.$wrap((9))]=u,g.m[__uv.$wrap((10))]=h,g.m[__uv.$wrap((11))]=d,g.m[__uv.$wrap((12))]=p,g.m[__uv.$wrap((13))]=m,g.m[__uv.$wrap((14))]=_,g.m[__uv.$wrap((15))]=f,g},e.Compose=function(t,i,r){var n=e.Identity();return e.ComposeToRef(t,i,r,n),n},e.ComposeToRef=function(t,i,r,n){e.FromValuesToRef(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1,T.Matrix[__uv.$wrap((1))]),i.toRotationMatrix(T.Matrix[__uv.$wrap((0))]),T.Matrix[__uv.$wrap((1))].multiplyToRef(T.Matrix[__uv.$wrap((0))],n),n.setTranslation(r)},e.Identity=function(){return e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},e.Zero=function(){return e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},e.RotationX=function(t){var i=new e;return e.RotationXToRef(t,i),i},e.Invert=function(t){var i=new e;return t.invertToRef(i),i},e.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[__uv.$wrap((0))]=1,t.m[__uv.$wrap((15))]=1,t.m[__uv.$wrap((5))]=r,t.m[__uv.$wrap((10))]=r,t.m[__uv.$wrap((9))]=-i,t.m[__uv.$wrap((6))]=i,t.m[__uv.$wrap((1))]=0,t.m[__uv.$wrap((2))]=0,t.m[__uv.$wrap((3))]=0,t.m[__uv.$wrap((4))]=0,t.m[__uv.$wrap((7))]=0,t.m[__uv.$wrap((8))]=0,t.m[__uv.$wrap((11))]=0,t.m[__uv.$wrap((12))]=0,t.m[__uv.$wrap((13))]=0,t.m[__uv.$wrap((14))]=0,t._markAsUpdated()},e.RotationY=function(t){var i=new e;return e.RotationYToRef(t,i),i},e.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[__uv.$wrap((5))]=1,t.m[__uv.$wrap((15))]=1,t.m[__uv.$wrap((0))]=r,t.m[__uv.$wrap((2))]=-i,t.m[__uv.$wrap((8))]=i,t.m[__uv.$wrap((10))]=r,t.m[__uv.$wrap((1))]=0,t.m[__uv.$wrap((3))]=0,t.m[__uv.$wrap((4))]=0,t.m[__uv.$wrap((6))]=0,t.m[__uv.$wrap((7))]=0,t.m[__uv.$wrap((9))]=0,t.m[__uv.$wrap((11))]=0,t.m[__uv.$wrap((12))]=0,t.m[__uv.$wrap((13))]=0,t.m[__uv.$wrap((14))]=0,t._markAsUpdated()},e.RotationZ=function(t){var i=new e;return e.RotationZToRef(t,i),i},e.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[__uv.$wrap((10))]=1,t.m[__uv.$wrap((15))]=1,t.m[__uv.$wrap((0))]=r,t.m[__uv.$wrap((1))]=i,t.m[__uv.$wrap((4))]=-i,t.m[__uv.$wrap((5))]=r,t.m[__uv.$wrap((2))]=0,t.m[__uv.$wrap((3))]=0,t.m[__uv.$wrap((6))]=0,t.m[__uv.$wrap((7))]=0,t.m[__uv.$wrap((8))]=0,t.m[__uv.$wrap((9))]=0,t.m[__uv.$wrap((11))]=0,t.m[__uv.$wrap((12))]=0,t.m[__uv.$wrap((13))]=0,t.m[__uv.$wrap((14))]=0,t._markAsUpdated()},e.RotationAxis=function(t,i){var r=e.Zero();return e.RotationAxisToRef(t,i,r),r},e.RotationAxisToRef=function(e,t,i){var r=Math.sin(-t),n=Math.cos(-t),a=1-n;e.normalize(),i.m[__uv.$wrap((0))]=e.x*e.x*a+n,i.m[__uv.$wrap((1))]=e.x*e.y*a-e.z*r,i.m[__uv.$wrap((2))]=e.x*e.z*a+e.y*r,i.m[__uv.$wrap((3))]=0,i.m[__uv.$wrap((4))]=e.y*e.x*a+e.z*r,i.m[__uv.$wrap((5))]=e.y*e.y*a+n,i.m[__uv.$wrap((6))]=e.y*e.z*a-e.x*r,i.m[__uv.$wrap((7))]=0,i.m[__uv.$wrap((8))]=e.z*e.x*a-e.y*r,i.m[__uv.$wrap((9))]=e.z*e.y*a+e.x*r,i.m[__uv.$wrap((10))]=e.z*e.z*a+n,i.m[__uv.$wrap((11))]=0,i.m[__uv.$wrap((15))]=1,i._markAsUpdated()},e.RotationYawPitchRoll=function(t,i,r){var n=new e;return e.RotationYawPitchRollToRef(t,i,r,n),n},e.RotationYawPitchRollToRef=function(e,t,i,r){s.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},e.Scaling=function(t,i,r){var n=e.Zero();return e.ScalingToRef(t,i,r,n),n},e.ScalingToRef=function(e,t,i,r){r.m[__uv.$wrap((0))]=e,r.m[__uv.$wrap((1))]=0,r.m[__uv.$wrap((2))]=0,r.m[__uv.$wrap((3))]=0,r.m[__uv.$wrap((4))]=0,r.m[__uv.$wrap((5))]=t,r.m[__uv.$wrap((6))]=0,r.m[__uv.$wrap((7))]=0,r.m[__uv.$wrap((8))]=0,r.m[__uv.$wrap((9))]=0,r.m[__uv.$wrap((10))]=i,r.m[__uv.$wrap((11))]=0,r.m[__uv.$wrap((12))]=0,r.m[__uv.$wrap((13))]=0,r.m[__uv.$wrap((14))]=0,r.m[__uv.$wrap((15))]=1,r._markAsUpdated()},e.Translation=function(t,i,r){var n=e.Identity();return e.TranslationToRef(t,i,r,n),n},e.TranslationToRef=function(t,i,r,n){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,i,r,1,n)},e.Lerp=function(t,i,r){var n=e.Zero();return e.LerpToRef(t,i,r,n),n},e.LerpToRef=function(e,t,i,r){for(var n=0;n<16;n++)r.m[__uv.$wrap((n))]=e.m[__uv.$wrap((n))]*(1-i)+t.m[__uv.$wrap((n))]*i;r._markAsUpdated()},e.DecomposeLerp=function(t,i,r){var n=e.Zero();return e.DecomposeLerpToRef(t,i,r,n),n},e.DecomposeLerpToRef=function(t,i,r,a){var o=T.Vector3[__uv.$wrap((0))],l=T.Quaternion[__uv.$wrap((0))],c=T.Vector3[__uv.$wrap((1))];t.decompose(o,l,c);var u=T.Vector3[__uv.$wrap((2))],h=T.Quaternion[__uv.$wrap((1))],d=T.Vector3[__uv.$wrap((3))];i.decompose(u,h,d);var p=T.Vector3[__uv.$wrap((4))];n.LerpToRef(o,u,r,p);var m=T.Quaternion[__uv.$wrap((2))];s.SlerpToRef(l,h,r,m);var _=T.Vector3[__uv.$wrap((5))];n.LerpToRef(c,d,r,_),e.ComposeToRef(p,m,_,a)},e.LookAtLH=function(t,i,r){var n=e.Zero();return e.LookAtLHToRef(t,i,r,n),n},e.LookAtLHToRef=function(t,i,r,a){i.subtractToRef(t,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var o=-n.Dot(this._xAxis,t),s=-n.Dot(this._yAxis,t),l=-n.Dot(this._zAxis,t);return e.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,o,s,l,1,a)},e.LookAtRH=function(t,i,r){var n=e.Zero();return e.LookAtRHToRef(t,i,r,n),n},e.LookAtRHToRef=function(t,i,r,a){t.subtractToRef(i,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var o=-n.Dot(this._xAxis,t),s=-n.Dot(this._yAxis,t),l=-n.Dot(this._zAxis,t);return e.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,o,s,l,1,a)},e.OrthoLH=function(t,i,r,n){var a=e.Zero();return e.OrthoLHToRef(t,i,r,n,a),a},e.OrthoLHToRef=function(t,i,r,n,a){var o=2/t,s=2/i,l=2/(n-r),c=-(n+r)/(n-r);e.FromValuesToRef(o,0,0,0,0,s,0,0,0,0,l,0,0,0,c,1,a)},e.OrthoOffCenterLH=function(t,i,r,n,a,o){var s=e.Zero();return e.OrthoOffCenterLHToRef(t,i,r,n,a,o,s),s},e.OrthoOffCenterLHToRef=function(t,i,r,n,a,o,s){var l=2/(i-t),c=2/(n-r),u=2/(o-a),h=-(o+a)/(o-a),d=(t+i)/(t-i),p=(n+r)/(r-n);e.FromValuesToRef(l,0,0,0,0,c,0,0,0,0,u,0,d,p,h,1,s)},e.OrthoOffCenterRH=function(t,i,r,n,a,o){var s=e.Zero();return e.OrthoOffCenterRHToRef(t,i,r,n,a,o,s),s},e.OrthoOffCenterRHToRef=function(t,i,r,n,a,o,s){e.OrthoOffCenterLHToRef(t,i,r,n,a,o,s),s.m[__uv.$wrap((10))]*=-1},e.PerspectiveLH=function(t,i,r,n){var a=e.Zero(),o=2*r/t,s=2*r/i,l=(n+r)/(n-r),c=-2*n*r/(n-r);return e.FromValuesToRef(o,0,0,0,0,s,0,0,0,0,l,1,0,0,c,0,a),a},e.PerspectiveFovLH=function(t,i,r,n){var a=e.Zero();return e.PerspectiveFovLHToRef(t,i,r,n,a),a},e.PerspectiveFovLHToRef=function(t,i,r,n,a,o){void 0===o&&(o=!0);var s=r,l=n,c=1/Math.tan(.5*t),u=o?c/i:c,h=o?c:c*i,d=(l+s)/(l-s),p=-2*l*s/(l-s);e.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,d,1,0,0,p,0,a)},e.PerspectiveFovRH=function(t,i,r,n){var a=e.Zero();return e.PerspectiveFovRHToRef(t,i,r,n,a),a},e.PerspectiveFovRHToRef=function(t,i,r,n,a,o){void 0===o&&(o=!0);var s=r,l=n,c=1/Math.tan(.5*t),u=o?c/i:c,h=o?c:c*i,d=-(l+s)/(l-s),p=-2*l*s/(l-s);e.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,d,-1,0,0,p,0,a)},e.PerspectiveFovWebVRToRef=function(e,t,i,r,n){void 0===n&&(n=!1);var a=n?-1:1,o=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),l=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),u=2/(l+c),h=2/(o+s);r.m[__uv.$wrap((0))]=u,r.m[__uv.$wrap((1))]=r.m[__uv.$wrap((2))]=r.m[__uv.$wrap((3))]=r.m[__uv.$wrap((4))]=0,r.m[__uv.$wrap((5))]=h,r.m[__uv.$wrap((6))]=r.m[__uv.$wrap((7))]=0,r.m[__uv.$wrap((8))]=(l-c)*u*.5,r.m[__uv.$wrap((9))]=-(o-s)*h*.5,r.m[__uv.$wrap((10))]=-i/(t-i),r.m[__uv.$wrap((11))]=1*a,r.m[__uv.$wrap((12))]=r.m[__uv.$wrap((13))]=r.m[__uv.$wrap((15))]=0,r.m[__uv.$wrap((14))]=-2*i*t/(i-t),r._markAsUpdated()},e.GetFinalMatrix=function(t,i,r,n,a,o){var s=t.width,l=t.height,c=t.x,u=t.y,h=e.FromValues(s/2,0,0,0,0,-l/2,0,0,0,0,o-a,0,c+s/2,l/2+u,a,1);return i.multiply(r).multiply(n).multiply(h)},e.GetAsMatrix2x2=function(e){return new Float32Array([e.m[__uv.$wrap((0))],e.m[__uv.$wrap((1))],e.m[__uv.$wrap((4))],e.m[__uv.$wrap((5))]])},e.GetAsMatrix3x3=function(e){return new Float32Array([e.m[__uv.$wrap((0))],e.m[__uv.$wrap((1))],e.m[__uv.$wrap((2))],e.m[__uv.$wrap((4))],e.m[__uv.$wrap((5))],e.m[__uv.$wrap((6))],e.m[__uv.$wrap((8))],e.m[__uv.$wrap((9))],e.m[__uv.$wrap((10))]])},e.Transpose=function(t){var i=new e;return e.TransposeToRef(t,i),i},e.TransposeToRef=function(e,t){t.m[__uv.$wrap((0))]=e.m[__uv.$wrap((0))],t.m[__uv.$wrap((1))]=e.m[__uv.$wrap((4))],t.m[__uv.$wrap((2))]=e.m[__uv.$wrap((8))],t.m[__uv.$wrap((3))]=e.m[__uv.$wrap((12))],t.m[__uv.$wrap((4))]=e.m[__uv.$wrap((1))],t.m[__uv.$wrap((5))]=e.m[__uv.$wrap((5))],t.m[__uv.$wrap((6))]=e.m[__uv.$wrap((9))],t.m[__uv.$wrap((7))]=e.m[__uv.$wrap((13))],t.m[__uv.$wrap((8))]=e.m[__uv.$wrap((2))],t.m[__uv.$wrap((9))]=e.m[__uv.$wrap((6))],t.m[__uv.$wrap((10))]=e.m[__uv.$wrap((10))],t.m[__uv.$wrap((11))]=e.m[__uv.$wrap((14))],t.m[__uv.$wrap((12))]=e.m[__uv.$wrap((3))],t.m[__uv.$wrap((13))]=e.m[__uv.$wrap((7))],t.m[__uv.$wrap((14))]=e.m[__uv.$wrap((11))],t.m[__uv.$wrap((15))]=e.m[__uv.$wrap((15))]},e.Reflection=function(t){var i=new e;return e.ReflectionToRef(t,i),i},e.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,a=-2*i,o=-2*r,s=-2*n;t.m[__uv.$wrap((0))]=a*i+1,t.m[__uv.$wrap((1))]=o*i,t.m[__uv.$wrap((2))]=s*i,t.m[__uv.$wrap((3))]=0,t.m[__uv.$wrap((4))]=a*r,t.m[__uv.$wrap((5))]=o*r+1,t.m[__uv.$wrap((6))]=s*r,t.m[__uv.$wrap((7))]=0,t.m[__uv.$wrap((8))]=a*n,t.m[__uv.$wrap((9))]=o*n,t.m[__uv.$wrap((10))]=s*n+1,t.m[__uv.$wrap((11))]=0,t.m[__uv.$wrap((12))]=a*e.d,t.m[__uv.$wrap((13))]=o*e.d,t.m[__uv.$wrap((14))]=s*e.d,t.m[__uv.$wrap((15))]=1,t._markAsUpdated()},e.FromXYZAxesToRef=function(e,t,i,r){r.m[__uv.$wrap((0))]=e.x,r.m[__uv.$wrap((1))]=e.y,r.m[__uv.$wrap((2))]=e.z,r.m[__uv.$wrap((3))]=0,r.m[__uv.$wrap((4))]=t.x,r.m[__uv.$wrap((5))]=t.y,r.m[__uv.$wrap((6))]=t.z,r.m[__uv.$wrap((7))]=0,r.m[__uv.$wrap((8))]=i.x,r.m[__uv.$wrap((9))]=i.y,r.m[__uv.$wrap((10))]=i.z,r.m[__uv.$wrap((11))]=0,r.m[__uv.$wrap((12))]=0,r.m[__uv.$wrap((13))]=0,r.m[__uv.$wrap((14))]=0,r.m[__uv.$wrap((15))]=1,r._markAsUpdated()},e.FromQuaternionToRef=function(e,t){var i=e.x*e.x,r=e.y*e.y,n=e.z*e.z,a=e.x*e.y,o=e.z*e.w,s=e.z*e.x,l=e.y*e.w,c=e.y*e.z,u=e.x*e.w;t.m[__uv.$wrap((0))]=1-2*(r+n),t.m[__uv.$wrap((1))]=2*(a+o),t.m[__uv.$wrap((2))]=2*(s-l),t.m[__uv.$wrap((3))]=0,t.m[__uv.$wrap((4))]=2*(a-o),t.m[__uv.$wrap((5))]=1-2*(n+i),t.m[__uv.$wrap((6))]=2*(c+u),t.m[__uv.$wrap((7))]=0,t.m[__uv.$wrap((8))]=2*(s+l),t.m[__uv.$wrap((9))]=2*(c-u),t.m[__uv.$wrap((10))]=1-2*(r+i),t.m[__uv.$wrap((11))]=0,t.m[__uv.$wrap((12))]=0,t.m[__uv.$wrap((13))]=0,t.m[__uv.$wrap((14))]=0,t.m[__uv.$wrap((15))]=1,t._markAsUpdated()},e._tempQuaternion=new s,e._xAxis=n.Zero(),e._yAxis=n.Zero(),e._zAxis=n.Zero(),e._updateFlagSeed=0,e._identityReadOnly=e.Identity(),e}();e.Matrix=l;var c=function(){function e(e,t,i,r){this.normal=new n(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=397*e^(this.d||0)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=l.Transpose(t),r=this.normal.x,n=this.normal.y,a=this.normal.z,o=this.d;return new e(r*i.m[__uv.$wrap((0))]+n*i.m[__uv.$wrap((1))]+a*i.m[__uv.$wrap((2))]+o*i.m[__uv.$wrap((3))],r*i.m[__uv.$wrap((4))]+n*i.m[__uv.$wrap((5))]+a*i.m[__uv.$wrap((6))]+o*i.m[__uv.$wrap((7))],r*i.m[__uv.$wrap((8))]+n*i.m[__uv.$wrap((9))]+a*i.m[__uv.$wrap((10))]+o*i.m[__uv.$wrap((11))],r*i.m[__uv.$wrap((12))]+n*i.m[__uv.$wrap((13))]+a*i.m[__uv.$wrap((14))]+o*i.m[__uv.$wrap((15))])},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,a=t.y-e.y,o=t.z-e.z,s=i.x-e.x,l=i.y-e.y,c=i.z-e.z,u=a*c-o*l,h=o*s-n*c,d=n*l-a*s,p=Math.sqrt(u*u+h*h+d*d);return r=0!==p?1/p:0,this.normal.x=u*r,this.normal.y=h*r,this.normal.z=d*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){return n.Dot(this.normal,e)<=t},e.prototype.signedDistanceTo=function(e){return n.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[__uv.$wrap((0))],t[__uv.$wrap((1))],t[__uv.$wrap((2))],t[__uv.$wrap((3))])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return n.Dot(i,t)+r},e}();e.Plane=c;var u=function(){function e(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}return e.prototype.toGlobal=function(t,i){if(t.getRenderWidth){var r=t;return this.toGlobal(r.getRenderWidth(),r.getRenderHeight())}var n=t;return new e(this.x*n,this.y*i,this.width*n,this.height*i)},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}();e.Viewport=u;var h=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;r<6;r++)i.push(new c(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetNearPlaneToRef=function(e,t){t.normal.x=e.m[__uv.$wrap((3))]+e.m[__uv.$wrap((2))],t.normal.y=e.m[__uv.$wrap((7))]+e.m[__uv.$wrap((6))],t.normal.z=e.m[__uv.$wrap((11))]+e.m[__uv.$wrap((10))],t.d=e.m[__uv.$wrap((15))]+e.m[__uv.$wrap((14))],t.normalize()},e.GetFarPlaneToRef=function(e,t){t.normal.x=e.m[__uv.$wrap((3))]-e.m[__uv.$wrap((2))],t.normal.y=e.m[__uv.$wrap((7))]-e.m[__uv.$wrap((6))],t.normal.z=e.m[__uv.$wrap((11))]-e.m[__uv.$wrap((10))],t.d=e.m[__uv.$wrap((15))]-e.m[__uv.$wrap((14))],t.normalize()},e.GetLeftPlaneToRef=function(e,t){t.normal.x=e.m[__uv.$wrap((3))]+e.m[__uv.$wrap((0))],t.normal.y=e.m[__uv.$wrap((7))]+e.m[__uv.$wrap((4))],t.normal.z=e.m[__uv.$wrap((11))]+e.m[__uv.$wrap((8))],t.d=e.m[__uv.$wrap((15))]+e.m[__uv.$wrap((12))],t.normalize()},e.GetRightPlaneToRef=function(e,t){t.normal.x=e.m[__uv.$wrap((3))]-e.m[__uv.$wrap((0))],t.normal.y=e.m[__uv.$wrap((7))]-e.m[__uv.$wrap((4))],t.normal.z=e.m[__uv.$wrap((11))]-e.m[__uv.$wrap((8))],t.d=e.m[__uv.$wrap((15))]-e.m[__uv.$wrap((12))],t.normalize()},e.GetTopPlaneToRef=function(e,t){t.normal.x=e.m[__uv.$wrap((3))]-e.m[__uv.$wrap((1))],t.normal.y=e.m[__uv.$wrap((7))]-e.m[__uv.$wrap((5))],t.normal.z=e.m[__uv.$wrap((11))]-e.m[__uv.$wrap((9))],t.d=e.m[__uv.$wrap((15))]-e.m[__uv.$wrap((13))],t.normalize()},e.GetBottomPlaneToRef=function(e,t){t.normal.x=e.m[__uv.$wrap((3))]+e.m[__uv.$wrap((1))],t.normal.y=e.m[__uv.$wrap((7))]+e.m[__uv.$wrap((5))],t.normal.z=e.m[__uv.$wrap((11))]+e.m[__uv.$wrap((9))],t.d=e.m[__uv.$wrap((15))]+e.m[__uv.$wrap((13))],t.normalize()},e.GetPlanesToRef=function(t,i){e.GetNearPlaneToRef(t,i[__uv.$wrap((0))]),e.GetFarPlaneToRef(t,i[__uv.$wrap((1))]),e.GetLeftPlaneToRef(t,i[__uv.$wrap((2))]),e.GetRightPlaneToRef(t,i[__uv.$wrap((3))]),e.GetTopPlaneToRef(t,i[__uv.$wrap((4))]),e.GetBottomPlaneToRef(t,i[__uv.$wrap((5))])},e}();e.Frustum=h,function(e){e[__uv.$wrap((e.LOCAL=0))]="LOCAL",e[__uv.$wrap((e.WORLD=1))]="WORLD",e[__uv.$wrap((e.BONE=2))]="BONE"}(e.Space||(e.Space={}));var d=function(){function e(){}return e.X=new n(1,0,0),e.Y=new n(0,1,0),e.Z=new n(0,0,1),e}();e.Axis=d;var p,m=function(){function e(){}return e.Interpolate=function(e,t,i,r,n){for(var a=1-3*r+3*t,o=3*r-6*t,s=3*t,l=e,c=0;c<5;c++){var u=l*l;l-=(a*(u*l)+o*u+s*l-e)*(1/(3*a*u+2*o*l+s)),l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*i+3*(1-l)*Math.pow(l,2)*n+Math.pow(l,3)},e}();e.BezierCurve=m,function(e){e[__uv.$wrap((e.CW=0))]="CW",e[__uv.$wrap((e.CCW=1))]="CCW"}(p=e.Orientation||(e.Orientation={}));var _=function(){function e(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.prototype.degrees=function(){return 180*this._radians/Math.PI},e.prototype.radians=function(){return this._radians},e.BetweenTwoPoints=function(t,i){var r=i.subtract(t);return new e(Math.atan2(r.y,r.x))},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=_;var f=function(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),a=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,o=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,s=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((a*(t.y-i.y)-o*(e.y-t.y))/s,((e.x-t.x)*o-(t.x-i.x)*a)/s),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=_.BetweenTwoPoints(this.centerPoint,this.startPoint);var l=this.startAngle.degrees(),c=_.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),u=_.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();c-l>180&&(c-=360),c-l<-180&&(c+=360),u-c>180&&(u-=360),u-c<-180&&(u+=360),this.orientation=c-l<0?p.CW:p.CCW,this.angle=_.FromDegrees(this.orientation===p.CW?l-u:u-l)};e.Arc2=f;var g=function(){function e(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return e.prototype.addLineTo=function(e,t){if(this.closed)return this;var i=new r(e,t),n=this._points[__uv.$wrap((this._points.length-1))];return this._points.push(i),this._length+=i.subtract(n).length(),this},e.prototype.addArcTo=function(e,t,i,n,a){if(void 0===a&&(a=36),this.closed)return this;var o=this._points[__uv.$wrap((this._points.length-1))],s=new r(e,t),l=new r(i,n),c=new f(o,s,l),u=c.angle.radians()/a;c.orientation===p.CW&&(u*=-1);for(var h=c.startAngle.radians()+u,d=0;d<a;d++){var m=Math.cos(h)*c.radius+c.centerPoint.x,_=Math.sin(h)*c.radius+c.centerPoint.y;this.addLineTo(m,_),h+=u}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[__uv.$wrap((this._points.length-1))];e+=this._points[__uv.$wrap((0))].subtract(t).length()}return e},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(e){if(e<0||e>1)return r.Zero();for(var t=e*this.length(),i=0,n=0;n<this._points.length;n++){var a=(n+1)%this._points.length,o=this._points[__uv.$wrap((n))],s=this._points[__uv.$wrap((a))].subtract(o),l=s.length()+i;if(t>=i&&t<=l){var c=s.normalize(),u=t-i;return new r(o.x+c.x*u,o.y+c.y*u)}i=l}return r.Zero()},e.StartingAt=function(t,i){return new e(t,i)},e}();e.Path2=g;var y=function(){function t(e,t,i){void 0===t&&(t=null),this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var r=0;r<e.length;r++)this._curve[__uv.$wrap((r))]=e[__uv.$wrap((r))].clone();this._raw=i||!1,this._compute(t)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(e,t){void 0===t&&(t=null);for(var i=0;i<e.length;i++)this._curve[__uv.$wrap((i))].x=e[__uv.$wrap((i))].x,this._curve[__uv.$wrap((i))].y=e[__uv.$wrap((i))].y,this._curve[__uv.$wrap((i))].z=e[__uv.$wrap((i))].z;return this._compute(t),this},t.prototype._compute=function(e){var t=this._curve.length;this._tangents[__uv.$wrap((0))]=this._getFirstNonNullVector(0),this._raw||this._tangents[__uv.$wrap((0))].normalize(),this._tangents[__uv.$wrap((t-1))]=this._curve[__uv.$wrap((t-1))].subtract(this._curve[__uv.$wrap((t-2))]),this._raw||this._tangents[__uv.$wrap((t-1))].normalize();var i,r,a,o,s=this._tangents[__uv.$wrap((0))],l=this._normalVector(this._curve[__uv.$wrap((0))],s,e);this._normals[__uv.$wrap((0))]=l,this._raw||this._normals[__uv.$wrap((0))].normalize(),this._binormals[__uv.$wrap((0))]=n.Cross(s,this._normals[__uv.$wrap((0))]),this._raw||this._binormals[__uv.$wrap((0))].normalize(),this._distances[__uv.$wrap((0))]=0;for(var c=1;c<t;c++)i=this._getLastNonNullVector(c),c<t-1&&(r=this._getFirstNonNullVector(c),this._tangents[__uv.$wrap((c))]=i.add(r),this._tangents[__uv.$wrap((c))].normalize()),this._distances[__uv.$wrap((c))]=this._distances[__uv.$wrap((c-1))]+i.length(),a=this._tangents[__uv.$wrap((c))],o=this._binormals[__uv.$wrap((c-1))],this._normals[__uv.$wrap((c))]=n.Cross(o,a),this._raw||this._normals[__uv.$wrap((c))].normalize(),this._binormals[__uv.$wrap((c))]=n.Cross(a,this._normals[__uv.$wrap((c))]),this._raw||this._binormals[__uv.$wrap((c))].normalize()},t.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[__uv.$wrap((e+t))].subtract(this._curve[__uv.$wrap((e))]);0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[__uv.$wrap((e+t))].subtract(this._curve[__uv.$wrap((e))]);return i},t.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[__uv.$wrap((e))].subtract(this._curve[__uv.$wrap((e-t))]);0===i.length()&&e>t+1;)t++,i=this._curve[__uv.$wrap((e))].subtract(this._curve[__uv.$wrap((e-t))]);return i},t.prototype._normalVector=function(t,i,r){var a,o,s=i.length();(0===s&&(s=1),null==r)?(o=e.Scalar.WithinEpsilon(Math.abs(i.y)/s,1,e.Epsilon)?e.Scalar.WithinEpsilon(Math.abs(i.x)/s,1,e.Epsilon)?e.Scalar.WithinEpsilon(Math.abs(i.z)/s,1,e.Epsilon)?n.Zero():new n(0,0,1):new n(1,0,0):new n(0,-1,0),a=n.Cross(i,o)):(a=n.Cross(i,r),n.CrossToRef(a,i,a));return a.normalize(),a},t}();e.Path3D=y;var v=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,r,a){a=a>2?a:3;for(var o=new Array,s=function(e,t,i,r){return(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r},l=0;l<=a;l++)o.push(new n(s(l/a,t.x,i.x,r.x),s(l/a,t.y,i.y,r.y),s(l/a,t.z,i.z,r.z)));return new e(o)},e.CreateCubicBezier=function(t,i,r,a,o){o=o>3?o:4;for(var s=new Array,l=function(e,t,i,r,n){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n},c=0;c<=o;c++)s.push(new n(l(c/o,t.x,i.x,r.x,a.x),l(c/o,t.y,i.y,r.y,a.y),l(c/o,t.z,i.z,r.z,a.z)));return new e(s)},e.CreateHermiteSpline=function(t,i,r,a,o){for(var s=new Array,l=1/o,c=0;c<=o;c++)s.push(n.Hermite(t,i,r,a,c*l));return new e(s)},e.CreateCatmullRomSpline=function(t,i,r){var a=new Array,o=1/i,s=0;if(r){for(var l=t.length,c=0;c<l;c++){s=0;for(var u=0;u<i;u++)a.push(n.CatmullRom(t[__uv.$wrap((c%l))],t[__uv.$wrap(((c+1)%l))],t[__uv.$wrap(((c+2)%l))],t[__uv.$wrap(((c+3)%l))],s)),s+=o}a.push(a[__uv.$wrap((0))])}else{var h=new Array;h.push(t[__uv.$wrap((0))].clone()),Array.prototype.push.apply(h,t),h.push(t[__uv.$wrap((t.length-1))].clone());for(c=0;c<h.length-3;c++){s=0;for(u=0;u<i;u++)a.push(n.CatmullRom(h[__uv.$wrap((c))],h[__uv.$wrap((c+1))],h[__uv.$wrap((c+2))],h[__uv.$wrap((c+3))],s)),s+=o}c--,a.push(n.CatmullRom(h[__uv.$wrap((c))],h[__uv.$wrap((c+1))],h[__uv.$wrap((c+2))],h[__uv.$wrap((c+3))],s))}return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype.continue=function(t){for(var i=this._points[__uv.$wrap((this._points.length-1))],r=this._points.slice(),n=t.getPoints(),a=1;a<n.length;a++)r.push(n[__uv.$wrap((a))].subtract(n[__uv.$wrap((0))]).add(i));return new e(r)},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[__uv.$wrap((i))].subtract(e[__uv.$wrap((i-1))]).length();return t},e}();e.Curve3=v;var b=function(){function e(e,t){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var x=function(){function e(e,t,i){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=x;var S=function(){function e(){}return e.Color3=[t.Black(),t.Black(),t.Black()],e.Color4=[new i(0,0,0,0),new i(0,0,0,0)],e.Vector2=[r.Zero(),r.Zero(),r.Zero()],e.Vector3=[n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero()],e.Vector4=[a.Zero(),a.Zero(),a.Zero()],e.Quaternion=[s.Zero(),s.Zero()],e.Matrix=[l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero()],e}();e.Tmp=S;var T=function(){function e(){}return e.Vector3=[n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero()],e.Matrix=[l.Zero(),l.Zero()],e.Quaternion=[s.Zero(),s.Zero(),s.Zero()],e}()}(s||(s={})),function(e){var t=function(){function e(){}return e.WithinEpsilon=function(e,t,i){void 0===i&&(i=1401298e-51);var r=e-t;return-i<=r&&r<=i},e.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},e.Sign=function(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1},e.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},e.Log2=function(e){return Math.log(e)*Math.LOG2E},e.Repeat=function(e,t){return e-Math.floor(e/t)*t},e.Normalize=function(e,t,i){return(e-t)/(i-t)},e.Denormalize=function(e,t,i){return e*(i-t)+t},e.DeltaAngle=function(t,i){var r=e.Repeat(i-t,360);return r>180&&(r-=360),r},e.PingPong=function(t,i){var r=e.Repeat(t,2*i);return i-Math.abs(r-i)},e.SmoothStep=function(t,i,r){var n=e.Clamp(r);return i*(n=-2*n*n*n+3*n*n)+t*(1-n)},e.MoveTowards=function(t,i,r){return Math.abs(i-t)<=r?i:t+e.Sign(i-t)*r},e.MoveTowardsAngle=function(t,i,r){var n=e.DeltaAngle(t,i),a=0;return-r<n&&n<r?a=i:(i=t+n,a=e.MoveTowards(t,i,r)),a},e.Lerp=function(e,t,i){return e+(t-e)*i},e.LerpAngle=function(t,i,r){var n=e.Repeat(i-t,360);return n>180&&(n-=360),t+n*e.Clamp(r)},e.InverseLerp=function(t,i,r){return t!=i?e.Clamp((r-t)/(i-t)):0},e.Hermite=function(e,t,i,r,n){var a=n*n,o=n*a;return e*(2*o-3*a+1)+i*(-2*o+3*a)+t*(o-2*a+n)+r*(o-a)},e.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},e.RangeToPercent=function(e,t,i){return(e-t)/(i-t)},e.PercentToRange=function(e,t,i){return(i-t)*e+t},e.NormalizeRadians=function(t){return t-=e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)},e.TwoPi=2*Math.PI,e}();e.Scalar=t}(s||(s={})),function(e){var t={},i={},r=function(t,i,r){var a=t();e.Tags&&e.Tags.AddTagsTo(a,i.tags);var o=n(a);for(var s in o){var l=o[__uv.$wrap((s))],c=i[__uv.$wrap((s))],u=l.type;if(null!=c)switch(u){case 0:case 6:case 11:a[__uv.$wrap((s))]=c;break;case 1:a[__uv.$wrap((s))]=r||c.isRenderTarget?c:c.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:a[__uv.$wrap((s))]=r?c:c.clone()}}return a};function n(e){var r=e.getClassName();if(i[__uv.$wrap((r))])return i[__uv.$wrap((r))];i[__uv.$wrap((r))]={};for(var n=i[__uv.$wrap((r))],a=e,o=r;o;){var s=t[__uv.$wrap((o))];for(var l in s)n[__uv.$wrap((l))]=s[__uv.$wrap((l))];var c=void 0,u=!1;do{if(!(c=Object.getPrototypeOf(a)).getClassName){u=!0;break}if(c.getClassName()!==o)break;a=c}while(c);if(u)break;o=c.getClassName(),a=c}return n}function a(e,i){return function(r,n){var a=function(e){var i=e.getClassName();return t[__uv.$wrap((i))]||(t[__uv.$wrap((i))]={}),t[__uv.$wrap((i))]}(r);a[__uv.$wrap((n))]||(a[__uv.$wrap((n))]={type:e,sourceName:i})}}e.expandToProperty=function(e,t){return void 0===t&&(t=null),function(e,t){return void 0===t&&(t=null),function(i,r){var n=t||"_"+r;Object.defineProperty(i,r,{get:function(){return this[__uv.$wrap((n))]},set:function(t){this[__uv.$wrap((n))]!==t&&(this[__uv.$wrap((n))]=t,i[__uv.$wrap((e))].apply(this))},enumerable:!0,configurable:!0})}}(e,t)},e.serialize=function(e){return a(0,e)},e.serializeAsTexture=function(e){return a(1,e)},e.serializeAsColor3=function(e){return a(2,e)},e.serializeAsFresnelParameters=function(e){return a(3,e)},e.serializeAsVector2=function(e){return a(4,e)},e.serializeAsVector3=function(e){return a(5,e)},e.serializeAsMeshReference=function(e){return a(6,e)},e.serializeAsColorCurves=function(e){return a(7,e)},e.serializeAsColor4=function(e){return a(8,e)},e.serializeAsImageProcessingConfiguration=function(e){return a(9,e)},e.serializeAsQuaternion=function(e){return a(10,e)},e.serializeAsCameraReference=function(e){return a(11,e)};var o=function(){function t(){}return t.Serialize=function(t,i){i||(i={}),e.Tags&&(i.tags=e.Tags.GetTags(t));var r=n(t);for(var a in r){var o=r[__uv.$wrap((a))],s=o.sourceName||a,l=o.type,c=t[__uv.$wrap((a))];if(null!=c)switch(l){case 0:i[__uv.$wrap((s))]=c;break;case 1:i[__uv.$wrap((s))]=c.serialize();break;case 2:i[__uv.$wrap((s))]=c.asArray();break;case 3:i[__uv.$wrap((s))]=c.serialize();break;case 4:case 5:i[__uv.$wrap((s))]=c.asArray();break;case 6:i[__uv.$wrap((s))]=c.id;break;case 7:i[__uv.$wrap((s))]=c.serialize();break;case 8:i[__uv.$wrap((s))]=c.asArray();break;case 9:i[__uv.$wrap((s))]=c.serialize();break;case 10:i[__uv.$wrap((s))]=c.asArray();break;case 11:i[__uv.$wrap((s))]=c.id}}return i},t.Parse=function(t,i,r,a){void 0===a&&(a=null);var o=t();a||(a=""),e.Tags&&e.Tags.AddTagsTo(o,i.tags);var s=n(o);for(var l in s){var c=s[__uv.$wrap((l))],u=i[__uv.$wrap((c.sourceName||l))],h=c.type;if(null!=u){var d=o;switch(h){case 0:d[__uv.$wrap((l))]=u;break;case 1:r&&(d[__uv.$wrap((l))]=e.Texture.Parse(u,r,a));break;case 2:d[__uv.$wrap((l))]=e.Color3.FromArray(u);break;case 3:d[__uv.$wrap((l))]=e.FresnelParameters.Parse(u);break;case 4:d[__uv.$wrap((l))]=e.Vector2.FromArray(u);break;case 5:d[__uv.$wrap((l))]=e.Vector3.FromArray(u);break;case 6:r&&(d[__uv.$wrap((l))]=r.getLastMeshByID(u));break;case 7:d[__uv.$wrap((l))]=e.ColorCurves.Parse(u);break;case 8:d[__uv.$wrap((l))]=e.Color4.FromArray(u);break;case 9:d[__uv.$wrap((l))]=e.ImageProcessingConfiguration.Parse(u);break;case 10:d[__uv.$wrap((l))]=e.Quaternion.FromArray(u);break;case 11:r&&(d[__uv.$wrap((l))]=r.getCameraByID(u))}}}return o},t.Clone=function(e,t){return r(e,t,!1)},t.Instanciate=function(e,t){return r(e,t,!0)},t}();e.SerializationHelper=o}(s||(s={})),function(e){var t=function(){function e(){var e=this;this.promise=new Promise((function(t,i){e._resolve=t,e._reject=i}))}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),e}();e.Deferred=t}(s||(s={})),function(e){var t=function(){function e(e,t,i,r){void 0===t&&(t=!1),this.initalize(e,t,i,r)}return e.prototype.initalize=function(e,t,i,r){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this},e}();e.EventState=t;var i=function(e,t,i){void 0===i&&(i=null),this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1};e.Observer=i;var r=function(){function e(){}return e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[__uv.$wrap((e))].remove(this._observers[__uv.$wrap((e))]);this._observers=null,this._observables=null},e.Watch=function(t,i,r,n){void 0===r&&(r=-1),void 0===n&&(n=null);var a=new e;a._observers=new Array,a._observables=t;for(var o=0,s=t;o<s.length;o++){var l=s[__uv.$wrap((o))].add(i,r,!1,n);l&&a._observers.push(l)}return a},e}();e.MultiObserver=r;var n=function(){function r(e){this._observers=new Array,this._eventState=new t(0),e&&(this._onObserverAdded=e)}return r.prototype.add=function(e,t,r,n,a){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===n&&(n=null),void 0===a&&(a=!1),!e)return null;var o=new i(e,t,n);return o.unregisterOnNextCall=a,r?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},r.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},r.prototype.remove=function(e){return!!e&&(-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))},r.prototype.removeCallback=function(e,t){for(var i=0;i<this._observers.length;i++)if(this._observers[__uv.$wrap((i))].callback===e&&(!t||t===this._observers[__uv.$wrap((i))].scope))return this._deferUnregister(this._observers[__uv.$wrap((i))]),!0;return!1},r.prototype._deferUnregister=function(t){var i=this;t.unregisterOnNextCall=!1,t._willBeUnregistered=!0,e.Tools.SetImmediate((function(){i._remove(t)}))},r.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},r.prototype.notifyObservers=function(e,t,i,r){if(void 0===t&&(t=-1),!this._observers.length)return!0;var n=this._eventState;n.mask=t,n.target=i,n.currentTarget=r,n.skipNextObservers=!1,n.lastReturnValue=e;for(var a=0,o=this._observers;a<o.length;a++){var s=o[__uv.$wrap((a))];if(!s._willBeUnregistered&&(s.mask&t&&(s.scope?n.lastReturnValue=s.callback.apply(s.scope,[e,n]):n.lastReturnValue=s.callback(e,n),s.unregisterOnNextCall&&this._deferUnregister(s)),n.skipNextObservers))return!1}return!0},r.prototype.notifyObserversWithPromise=function(e,t,i,r){var n=this;void 0===t&&(t=-1);var a=Promise.resolve(e);if(!this._observers.length)return a;var o=this._eventState;return o.mask=t,o.target=i,o.currentTarget=r,o.skipNextObservers=!1,this._observers.forEach((function(i){o.skipNextObservers||i._willBeUnregistered||i.mask&t&&(a=i.scope?a.then((function(t){return o.lastReturnValue=t,i.callback.apply(i.scope,[e,o])})):a.then((function(t){return o.lastReturnValue=t,i.callback(e,o)})),i.unregisterOnNextCall&&n._deferUnregister(i))})),a.then((function(){return e}))},r.prototype.notifyObserver=function(e,t,i){void 0===i&&(i=-1);var r=this._eventState;r.mask=i,r.skipNextObservers=!1,e.callback(t,r)},r.prototype.hasObservers=function(){return this._observers.length>0},r.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},r.prototype.clone=function(){var e=new r;return e._observers=this._observers.slice(0),e},r.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,i=this._observers;t<i.length;t++){var r=i[__uv.$wrap((t))];if(r.mask&e||r.mask===e)return!0}return!1},r}();e.Observable=n}(s||(s={})),function(e){var t=function(){function e(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[__uv.$wrap((this.length++))]=e,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[__uv.$wrap((t))])},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[__uv.$wrap((this.length++))]=(e.data||e)[__uv.$wrap((t))]}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e.prototype.contains=function(e){return-1!==this.indexOf(e)},e._GlobalId=0,e}();e.SmartArray=t;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}return a(t,e),t.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[__uv.$wrap((this._id))]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[__uv.$wrap((this._id))]!==this._duplicateId)&&(this.push(e),!0)},t.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[__uv.$wrap((t))];this.pushNoDuplicate(i)}}},t}(t);e.SmartArrayNoDuplicate=i}(s||(s={})),function(e){var t=function(){function t(){}return t.prototype.getColorToRef=function(t){this.color2?e.Color4.LerpToRef(this.color1,this.color2,Math.random(),t):t.copyFrom(this.color1)},t}();e.ColorGradient=t;var i=function(){};e.Color3Gradient=i;var r=function(){function t(){}return t.prototype.getFactor=function(){return void 0===this.factor2?this.factor1:e.Scalar.Lerp(this.factor1,this.factor2,Math.random())},t}();e.FactorGradient=r;var n=function(e){function t(i,r){var n=e.call(this,i)||this;return n.request=r,n.name="LoadFileError",t._setPrototypeOf(n,t.prototype),n}return a(t,e),t._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t}(Error);e.LoadFileError=n;var o,s=function(){function e(){}return e.ExponentialBackoff=function(e,t){return void 0===e&&(e=3),void 0===t&&(t=500),function(i,r,n){return 0!==r.status||n>=e||-1!==i.indexOf("file:")?-1:Math.pow(2,n)*t}},e}();e.RetryStrategy=s;var l=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},c=function(){function t(){}return t.FetchToRef=function(e,t,i,r,n,a){var o=4*((Math.abs(e)*i%i|0)+(Math.abs(t)*r%r|0)*i);a.r=n[__uv.$wrap((o))]/255,a.g=n[__uv.$wrap((o+1))]/255,a.b=n[__uv.$wrap((o+2))]/255,a.a=n[__uv.$wrap((o+3))]/255},t.Mix=function(e,t,i){return e*(1-i)+t*i},t.Instantiate=function(e){if(t.RegisteredExternalClasses&&t.RegisteredExternalClasses[__uv.$wrap((e))])return t.RegisteredExternalClasses[__uv.$wrap((e))];for(var i=e.split("."),r=window||this,n=0,a=i.length;n<a;n++)r=r[__uv.$wrap((i[__uv.$wrap((n))]))];return"function"!=typeof r?null:r},t.Slice=function(e,t,i){return e.slice?e.slice(t,i):Array.prototype.slice.call(e,t,i)},t.SetImmediate=function(e){t.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},t.IsExponentOfTwo=function(e){var t=1;do{t*=2}while(t<e);return t===e},t.FloatRound=function(e){return Math.fround?Math.fround(e):t._tmpFloatArray[__uv.$wrap((0))]=e},t.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},t.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},t.NearestPOT=function(e){var i=t.CeilingPOT(e),r=t.FloorPOT(e);return i-e>e-r?r:i},t.GetExponentOfTwo=function(i,r,n){var a;switch(void 0===n&&(n=e.Engine.SCALEMODE_NEAREST),n){case e.Engine.SCALEMODE_FLOOR:a=t.FloorPOT(i);break;case e.Engine.SCALEMODE_NEAREST:a=t.NearestPOT(i);break;case e.Engine.SCALEMODE_CEILING:default:a=t.CeilingPOT(i)}return Math.min(a,r)},t.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},t.GetFolderPath=function(e,t){void 0===t&&(t=!1);var i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)},t.GetDOMTextContent=function(e){for(var t="",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},t.ToDegrees=function(e){return 180*e/Math.PI},t.ToRadians=function(e){return e*Math.PI/180},t.EncodeArrayBufferTobase64=function(e){for(var t,i,r,n,a,o,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0,h=new Uint8Array(e);u<h.length;)n=(t=h[__uv.$wrap((u++))])>>2,a=(3&t)<<4|(i=u<h.length?h[__uv.$wrap((u++))]:Number.NaN)>>4,o=(15&i)<<2|(r=u<h.length?h[__uv.$wrap((u++))]:Number.NaN)>>6,s=63&r,isNaN(i)?o=s=64:isNaN(r)&&(s=64),c+=l.charAt(n)+l.charAt(a)+l.charAt(o)+l.charAt(s);return"data:image/png;base64,"+c},t.ExtractMinAndMaxIndexed=function(t,i,r,n,a){void 0===a&&(a=null);for(var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=r;l<r+n;l++){var c=3*i[__uv.$wrap((l))],u=t[__uv.$wrap((c))],h=t[__uv.$wrap((c+1))],d=t[__uv.$wrap((c+2))];o.minimizeInPlaceFromFloats(u,h,d),s.maximizeInPlaceFromFloats(u,h,d)}return a&&(o.x-=o.x*a.x+a.y,o.y-=o.y*a.x+a.y,o.z-=o.z*a.x+a.y,s.x+=s.x*a.x+a.y,s.y+=s.y*a.x+a.y,s.z+=s.z*a.x+a.y),{minimum:o,maximum:s}},t.ExtractMinAndMax=function(t,i,r,n,a){void 0===n&&(n=null);var o=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);a||(a=3);for(var l=i,c=i*a;l<i+r;l++,c+=a){var u=t[__uv.$wrap((c))],h=t[__uv.$wrap((c+1))],d=t[__uv.$wrap((c+2))];o.minimizeInPlaceFromFloats(u,h,d),s.maximizeInPlaceFromFloats(u,h,d)}return n&&(o.x-=o.x*n.x+n.y,o.y-=o.y*n.x+n.y,o.z-=o.z*n.x+n.y,s.x+=s.x*n.x+n.y,s.y+=s.y*n.x+n.y,s.z+=s.z*n.x+n.y),{minimum:o,maximum:s}},t.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},t.GetPointerPrefix=function(){var e="pointer";return!t.IsWindowObjectExist()||window.PointerEvent||navigator.pointerEnabled||(e="mouse"),e},t.QueueNewFrame=function(i,r){return e.chrome84BugWorkaround?setTimeout(()=>requestAnimationFrame(i),0):t.IsWindowObjectExist()?(r||(r=window),r.requestAnimationFrame?r.requestAnimationFrame(i):r.msRequestAnimationFrame?r.msRequestAnimationFrame(i):r.webkitRequestAnimationFrame?r.webkitRequestAnimationFrame(i):r.mozRequestAnimationFrame?r.mozRequestAnimationFrame(i):r.oRequestAnimationFrame?r.oRequestAnimationFrame(i):window.setTimeout(i,16)):window.setTimeout(i,16)},t.RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},t.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},t.SetCorsBehavior=function(e,i){if((!e||0!==e.indexOf("data:"))&&t.CorsBehavior)if("string"==typeof t.CorsBehavior||t.CorsBehavior instanceof String)i.crossOrigin=t.CorsBehavior;else{var r=t.CorsBehavior(e);r&&(i.crossOrigin=r)}},t.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},t.LoadImage=function(i,r,n,a){var o,s=!1;i instanceof ArrayBuffer?(o=URL.createObjectURL(new Blob([i])),s=!0):i instanceof Blob?(o=URL.createObjectURL(i),s=!0):(o=t.CleanUrl(i),o=t.PreprocessUrl(i));var l=new Image;t.SetCorsBehavior(o,l);var c=function(){s&&l.src&&URL.revokeObjectURL(l.src),l.removeEventListener("load",c),l.removeEventListener("error",u),r(l)},u=function(e){s&&l.src&&URL.revokeObjectURL(l.src),l.removeEventListener("load",c),l.removeEventListener("error",u),t.Error("Error while trying to load image: "+i),n&&n("Error while trying to load image: "+i,e)};l.addEventListener("load",c),l.addEventListener("error",u);var h=function(){l.src=o};if("data:"!==o.substr(0,5)&&a&&a.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)a.openAsync((function(){a&&a.loadImageFromDB(o,l)}),h);else{if(-1!==o.indexOf("file:")){var d=decodeURIComponent(o.substring(5).toLowerCase());if(e.FilesInput.FilesToLoad[__uv.$wrap((d))]){try{var p;try{p=URL.createObjectURL(e.FilesInput.FilesToLoad[__uv.$wrap((d))])}catch(t){p=URL.createObjectURL(e.FilesInput.FilesToLoad[__uv.$wrap((d))])}l.src=p,s=!0}catch(e){l.src=""}return l}}h()}return l},t.LoadFile=function(i,r,a,o,s,l){if(i=t.CleanUrl(i),-1!==(i=t.PreprocessUrl(i)).indexOf("file:")){var c=decodeURIComponent(i.substring(5).toLowerCase());if(e.FilesInput.FilesToLoad[__uv.$wrap((c))])return t.ReadFile(e.FilesInput.FilesToLoad[__uv.$wrap((c))],r,a,s)}var u=t.BaseUrl+i,h=!1,d={onCompleteObservable:new e.Observable,abort:function(){return h=!0}},p=function(){var e=new XMLHttpRequest,i=null;d.abort=function(){h=!0,e.readyState!==(XMLHttpRequest.DONE||4)&&e.abort(),null!==i&&(clearTimeout(i),i=null)};var o=function(c){e.open("GET",u,!0),s&&(e.responseType="arraybuffer"),a&&e.addEventListener("progress",a);var p=function(){e.removeEventListener("loadend",p),d.onCompleteObservable.notifyObservers(d),d.onCompleteObservable.clear()};e.addEventListener("loadend",p);var m=function(){if(!h&&e.readyState===(XMLHttpRequest.DONE||4)){if(e.removeEventListener("readystatechange",m),e.status>=200&&e.status<300||0===e.status&&(!t.IsWindowObjectExist()||t.IsFileURL()))return void r(s?e.response:e.responseText,e.responseURL);var a=t.DefaultRetryStrategy;if(a){var d=a(u,e,c);if(-1!==d)return e.removeEventListener("loadend",p),e=new XMLHttpRequest,void(i=setTimeout((function(){return o(c+1)}),d))}var _=new n("Error status: "+e.status+" "+e.statusText+" - Unable to load "+u,e);if(!l)throw _;l(e,_)}};e.addEventListener("readystatechange",m),e.send()};o(0)};if(o&&o.enableSceneOffline){var m=function(e){e&&e.status>400?l&&l(e):h||p()};o.openAsync((function(){h||o&&o.loadFileFromDB(i,(function(e){h||r(e),d.onCompleteObservable.notifyObservers(d)}),a?function(e){h||a(e)}:void 0,m,s)}),m)}else p();return d},t.LoadScript=function(e,i,r){if(t.IsWindowObjectExist()){var n=document.getElementsByTagName("head")[__uv.$wrap((0))],a=document.createElement("script");a.type="text/javascript",a.src=e,a.onload=function(){i&&i()},a.onerror=function(t){r&&r("Unable to load script '"+e+"'",t)},n.appendChild(a)}},t.ReadFileAsDataURL=function(t,i,r){var n=new FileReader,a={onCompleteObservable:new e.Observable,abort:function(){return n.abort()}};return n.onloadend=function(e){a.onCompleteObservable.notifyObservers(a)},n.onload=function(e){i(e.target.result)},n.onprogress=r,n.readAsDataURL(t),a},t.ReadFile=function(i,r,n,a){var o=new FileReader,s={onCompleteObservable:new e.Observable,abort:function(){return o.abort()}};return o.onloadend=function(e){return s.onCompleteObservable.notifyObservers(s)},o.onerror=function(e){t.Log("Error while reading file: "+i.name),r(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){r(e.target.result)},n&&(o.onprogress=n),a?o.readAsArrayBuffer(i):o.readAsText(i),s},t.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},t.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},t.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},t.DeepCopy=function(e,t,i,r){for(var n in e)if(("_"!==n[__uv.$wrap((0))]||r&&-1!==r.indexOf(n))&&(!i||-1===i.indexOf(n))){var a=e[__uv.$wrap((n))],o=typeof a;if("function"!==o)try{if("object"===o)if(a instanceof Array){if(t[__uv.$wrap((n))]=[],a.length>0)if("object"==typeof a[__uv.$wrap((0))])for(var s=0;s<a.length;s++){var c=l(a[__uv.$wrap((s))],t);-1===t[__uv.$wrap((n))].indexOf(c)&&t[__uv.$wrap((n))].push(c)}else t[__uv.$wrap((n))]=a.slice(0)}else t[__uv.$wrap((n))]=l(a,t);else t[__uv.$wrap((n))]=a}catch(e){}}},t.IsEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[__uv.$wrap((t))];window.addEventListener(i.name,i.handler,!1);try{window.__uv$setSource(__uv).__uv$parent&&window.__uv$setSource(__uv).__uv$parent.addEventListener(i.name,i.handler,!1)}catch(e){}}},t.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[__uv.$wrap((t))];window.removeEventListener(i.name,i.handler);try{window.__uv$setSource(__uv).__uv$parent&&window.__uv$setSource(__uv).__uv$parent.removeEventListener(i.name,i.handler)}catch(e){}}},t.DumpFramebuffer=function(e,i,r,n,a,s){void 0===a&&(a="image/png");for(var l=4*e,c=i/2,u=r.readPixels(0,0,e,i),h=0;h<c;h++)for(var d=0;d<l;d++){var p=d+h*l,m=d+(i-h-1)*l,_=u[__uv.$wrap((p))];u[__uv.$wrap((p))]=u[__uv.$wrap((m))],u[__uv.$wrap((m))]=_}o||(o=document.createElement("canvas")),o.width=e,o.height=i;var f=o.getContext("2d");if(f){var g=f.createImageData(e,i);g.data.set(u),f.putImageData(g,0,0),t.EncodeScreenshotCanvasData(n,a,s)}},t.ToBlob=function(e,t,i){void 0===i&&(i="image/png"),e.toBlob||(e.toBlob=function(e,t,i){var r=this;setTimeout((function(){for(var n=atob(r.toDataURL(t,i).split(",")[__uv.$wrap((1))]),a=n.length,o=new Uint8Array(a),s=0;s<a;s++)o[__uv.$wrap((s))]=n.charCodeAt(s);e(new Blob([o]))}))}),e.toBlob((function(e){t(e)}),i)},t.EncodeScreenshotCanvasData=function(e,i,r){(void 0===i&&(i="image/png"),e)?e(o.toDataURL(i)):this.ToBlob(o,(function(e){if("download"in document.createElement("a")){if(!r){var i=new Date,n=(i.getFullYear()+"-"+(i.getMonth()+1)).slice(2)+"-"+i.getDate()+"_"+i.getHours()+"-"+("0"+i.getMinutes()).slice(-2);r="screenshot_"+n+".png"}t.Download(e,r)}else{var a=URL.createObjectURL(e),o=window.open("");if(!o)return;var s=o.document.createElement("img");s.onload=function(){URL.revokeObjectURL(a)},s.src=a,o.document.body.appendChild(s)}}),i)},t.Download=function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var i=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=i,r.download=t,r.addEventListener("click",(function(){r.parentElement&&r.parentElement.removeChild(r)})),r.click(),window.URL.revokeObjectURL(i)}},t.CreateScreenshot=function(e,i,r,n,a){var s,l;if(void 0===a&&(a="image/png"),r.precision)s=Math.round(e.getRenderWidth()*r.precision),l=Math.round(s/e.getAspectRatio(i));else if(r.width&&r.height)s=r.width,l=r.height;else if(r.width&&!r.height)s=r.width,l=Math.round(s/e.getAspectRatio(i));else if(r.height&&!r.width)l=r.height,s=Math.round(l*e.getAspectRatio(i));else{if(isNaN(r))return void t.Error("Invalid 'size' parameter !");l=r,s=r}o||(o=document.createElement("canvas")),o.width=s,o.height=l;var c=o.getContext("2d"),u=e.getRenderWidth()/e.getRenderHeight(),h=s,d=h/u;d>l&&(h=(d=l)*u);var p=Math.max(0,s-h)/2,m=Math.max(0,l-d)/2,_=e.getRenderingCanvas();c&&_&&c.drawImage(_,p,m,h,d),t.EncodeScreenshotCanvasData(n,a)},t.CreateScreenshotUsingRenderTarget=function(i,r,n,a,o,s,l,c){var u,h;if(void 0===o&&(o="image/png"),void 0===s&&(s=1),void 0===l&&(l=!1),n.precision)u=Math.round(i.getRenderWidth()*n.precision),h=Math.round(u/i.getAspectRatio(r)),n={width:u,height:h};else if(n.width&&n.height)u=n.width,h=n.height;else if(n.width&&!n.height)u=n.width,h=Math.round(u/i.getAspectRatio(r)),n={width:u,height:h};else if(n.height&&!n.width)h=n.height,n={width:u=Math.round(h*i.getAspectRatio(r)),height:h};else{if(isNaN(n))return void t.Error("Invalid 'size' parameter !");h=n,u=n}var d=r.getScene(),p=null;d.activeCamera!==r&&(p=d.activeCamera,d.activeCamera=r);var m=new e.RenderTargetTexture("screenShot",n,d,!1,!1,e.Engine.TEXTURETYPE_UNSIGNED_INT,!1,e.Texture.NEAREST_SAMPLINGMODE);m.renderList=null,m.samples=s,l&&m.addPostProcess(new e.FxaaPostProcess("antialiasing",1,d.activeCamera)),m.onAfterRenderObservable.add((function(){t.DumpFramebuffer(u,h,i,a,o,c)})),d.incrementRenderId(),d.resetCachedMaterial(),m.render(!0),m.dispose(),p&&(d.activeCamera=p),r.getProjectionMatrix(!0)},t.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var r=e.TGATools.GetTGAHeader(t.response);if(r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i){var n=new Uint8Array(t.response,0,3);return 68===n[__uv.$wrap((0))]&&68===n[__uv.$wrap((1))]&&83===n[__uv.$wrap((2))]}}catch(e){}return!1},t.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},t.IsBase64=function(e){return!(e.length<5)&&"data:"===e.substr(0,5)},t.DecodeBase64=function(e){for(var t=atob(e.split(",")[__uv.$wrap((1))]),i=t.length,r=new Uint8Array(new ArrayBuffer(i)),n=0;n<i;n++)r[__uv.$wrap((n))]=t.charCodeAt(n);return r.buffer},t._AddLogEntry=function(e){t._LogCache=e+t._LogCache,t.OnNewCacheEntry&&t.OnNewCacheEntry(e)},t._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},t._LogDisabled=function(e){},t._LogEnabled=function(e){var i=t._FormatMessage(e);console.log("BJS - "+i);var r="<div style='color:white'>"+i+"</div><br>";t._AddLogEntry(r)},t._WarnDisabled=function(e){},t._WarnEnabled=function(e){var i=t._FormatMessage(e);console.warn("BJS - "+i);var r="<div style='color:orange'>"+i+"</div><br>";t._AddLogEntry(r)},t._ErrorDisabled=function(e){},t._ErrorEnabled=function(e){t.errorsCount++;var i=t._FormatMessage(e);console.error("BJS - "+i);var r="<div style='color:red'>"+i+"</div><br>";t._AddLogEntry(r)},Object.defineProperty(t,"LogCache",{get:function(){return t._LogCache},enumerable:!0,configurable:!0}),t.ClearLogCache=function(){t._LogCache="",t.errorsCount=0},Object.defineProperty(t,"LogLevels",{set:function(e){(e&t.MessageLogLevel)===t.MessageLogLevel?t.Log=t._LogEnabled:t.Log=t._LogDisabled,(e&t.WarningLogLevel)===t.WarningLogLevel?t.Warn=t._WarnEnabled:t.Warn=t._WarnDisabled,(e&t.ErrorLogLevel)===t.ErrorLogLevel?t.Error=t._ErrorEnabled:t.Error=t._ErrorDisabled},enumerable:!0,configurable:!0}),t.IsFileURL=function(){return"file:"===__uv.$get(location).protocol},t.IsWindowObjectExist=function(){return"undefined"!=typeof window},Object.defineProperty(t,"PerformanceLogLevel",{set:function(e){return(e&t.PerformanceUserMarkLogLevel)===t.PerformanceUserMarkLogLevel?(t.StartPerformanceCounter=t._StartUserMark,void(t.EndPerformanceCounter=t._EndUserMark)):(e&t.PerformanceConsoleLogLevel)===t.PerformanceConsoleLogLevel?(t.StartPerformanceCounter=t._StartPerformanceConsole,void(t.EndPerformanceCounter=t._EndPerformanceConsole)):(t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,void(t.EndPerformanceCounter=t._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),t._StartPerformanceCounterDisabled=function(e,t){},t._EndPerformanceCounterDisabled=function(e,t){},t._StartUserMark=function(e,i){if(void 0===i&&(i=!0),!t._performance){if(!t.IsWindowObjectExist())return;t._performance=window.performance}i&&t._performance.mark&&t._performance.mark(e+"-Begin")},t._EndUserMark=function(e,i){void 0===i&&(i=!0),i&&t._performance.mark&&(t._performance.mark(e+"-End"),t._performance.measure(e,e+"-Begin",e+"-End"))},t._StartPerformanceConsole=function(e,i){void 0===i&&(i=!0),i&&(t._StartUserMark(e,i),console.time&&console.time(e))},t._EndPerformanceConsole=function(e,i){void 0===i&&(i=!0),i&&(t._EndUserMark(e,i),console.time&&console.timeEnd(e))},Object.defineProperty(t,"Now",{get:function(){return t.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),t.GetClassName=function(e,t){void 0===t&&(t=!1);var i=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object)i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__;i||(i=typeof e)}return i},t.First=function(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[__uv.$wrap((i))];if(t(n))return n}return null},t.getFullClassName=function(e,t){void 0===t&&(t=!1);var i=null,r=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){var n=t?e:Object.getPrototypeOf(e);i=n.constructor.__bjsclassName__,r=n.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(null!=r?r+".":"")+i:null},t.DelayAsync=function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))},t.GetCurrentGradient=function(e,t,i){for(var r=0;r<t.length-1;r++){var n=t[__uv.$wrap((r))],a=t[__uv.$wrap((r+1))];if(e>=n.gradient&&e<=a.gradient)return void i(n,a,(e-n.gradient)/(a.gradient-n.gradient))}var o=t.length-1;i(t[__uv.$wrap((o))],t[__uv.$wrap((o))],1)},t.BaseUrl="",t.DefaultRetryStrategy=s.ExponentialBackoff(),t.CorsBehavior="anonymous",t.UseFallbackTexture=!0,t.RegisteredExternalClasses={},t.fallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",t._tmpFloatArray=new Float32Array(1),t.PreprocessUrl=function(e){return e},t.NoneLogLevel=0,t.MessageLogLevel=1,t.WarningLogLevel=2,t.ErrorLogLevel=4,t.AllLogLevel=7,t._LogCache="",t.errorsCount=0,t.Log=t._LogEnabled,t.Warn=t._WarnEnabled,t.Error=t._ErrorEnabled,t.PerformanceNoneLogLevel=0,t.PerformanceUserMarkLogLevel=1,t.PerformanceConsoleLogLevel=2,t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,t.EndPerformanceCounter=t._EndPerformanceCounterDisabled,t}();e.Tools=c;var u=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,i){e.Enabled&&(this._current+=t,i&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=c.Now)},e.prototype.endMonitoring=function(t){if(void 0===t&&(t=!0),e.Enabled){t&&this.fetchNewFrame();var i=c.Now;this._current=i-this._startMonitoringTime,t&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=c.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}();e.PerfCounter=u,e.className=function(e,t){return function(i){i.__bjsclassName__=e,i.__bjsmoduleName__=null!=t?t:null}};var h=function(){function e(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this.index=r-1,this._done=!1,this._fn=t,this._successCallback=i}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,r,n){void 0===n&&(n=0);var a=new e(t,i,r,n);return a.executeNext(),a},e.SyncAsyncForLoop=function(t,i,r,n,a,o){return void 0===o&&(o=0),e.Run(Math.ceil(t/i),(function(e){a&&a()?e.breakLoop():setTimeout((function(){for(var n=0;n<i;++n){var o=e.index*i+n;if(o>=t)break;if(r(o),a&&a()){e.breakLoop();break}}e.executeNext()}),o)}),n)},e}();e.AsyncLoop=h}(s||(s={})),function(e){var t;!function(e){e[__uv.$wrap((e.Pending=0))]="Pending",e[__uv.$wrap((e.Fulfilled=1))]="Fulfilled",e[__uv.$wrap((e.Rejected=2))]="Rejected"}(t||(t={}));var i=function(){this.count=0,this.target=0,this.results=[]},r=function(){function r(e){var i=this;if(this._state=t.Pending,this._children=new Array,this._rejectWasConsumed=!1,e)try{e((function(e){i._resolve(e)}),(function(e){i._reject(e)}))}catch(e){this._reject(e)}}return Object.defineProperty(r.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&void 0===this._parent._result&&(this._parent._result=e)},enumerable:!0,configurable:!0}),r.prototype.catch=function(e){return this.then(void 0,e)},r.prototype.then=function(i,n){var a=this,o=new r;return o._onFulfilled=i,o._onRejected=n,this._children.push(o),o._parent=this,this._state!==t.Pending&&e.Tools.SetImmediate((function(){if(a._state===t.Fulfilled||a._rejectWasConsumed){var e=o._resolve(a._result);if(null!=e)if(void 0!==e._state){var i=e;o._children.push(i),i._parent=o,o=i}else o._result=e}else o._reject(a._reason)})),o},r.prototype._moveChildren=function(e){var i,r=this;if((i=this._children).push.apply(i,e.splice(0,e.length)),this._children.forEach((function(e){e._parent=r})),this._state===t.Fulfilled)for(var n=0,a=this._children;n<a.length;n++){a[__uv.$wrap((n))]._resolve(this._result)}else if(this._state===t.Rejected)for(var o=0,s=this._children;o<s.length;o++){s[__uv.$wrap((o))]._reject(this._reason)}},r.prototype._resolve=function(e){try{this._state=t.Fulfilled;var i=null;if(this._onFulfilled&&(i=this._onFulfilled(e)),null!=i)if(void 0!==i._state){var r=i;r._parent=this,r._moveChildren(this._children),e=r._result}else e=i;this._result=e;for(var n=0,a=this._children;n<a.length;n++){a[__uv.$wrap((n))]._resolve(e)}this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(e){this._reject(e,!0)}},r.prototype._reject=function(e,i){if(void 0===i&&(i=!1),this._state=t.Rejected,this._reason=e,this._onRejected&&!i)try{this._onRejected(e),this._rejectWasConsumed=!0}catch(t){e=t}for(var r=0,n=this._children;r<n.length;r++){var a=n[__uv.$wrap((r))];this._rejectWasConsumed?a._resolve(null):a._reject(e)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},r.resolve=function(e){var t=new r;return t._resolve(e),t},r._RegisterForFulfillment=function(e,i,r){e.then((function(e){return i.results[__uv.$wrap((r))]=e,i.count++,i.count===i.target&&i.rootPromise._resolve(i.results),null}),(function(e){i.rootPromise._state!==t.Rejected&&i.rootPromise._reject(e)}))},r.all=function(e){var t=new r,n=new i;if(n.target=e.length,n.rootPromise=t,e.length)for(var a=0;a<e.length;a++)r._RegisterForFulfillment(e[__uv.$wrap((a))],n,a);else t._resolve([]);return t},r.race=function(e){var t=new r;if(e.length)for(var i=0,n=e;i<n.length;i++){n[__uv.$wrap((i))].then((function(e){return t&&(t._resolve(e),t=null),null}),(function(e){t&&(t._reject(e),t=null)}))}return t},r}(),n=function(){function e(){}return e.Apply=function(e){(void 0===e&&(e=!1),e||"undefined"==typeof Promise)&&(window.Promise=r)},e}();e.PromisePolyfill=n}(s||(s={})),function(e){var t=function(){function e(e){this._pendingActions=new Array,this._workerInfos=e.map((function(e){return{worker:e,active:!1}}))}return e.prototype.dispose=function(){for(var e=0,t=this._workerInfos;e<t.length;e++){t[__uv.$wrap((e))].worker.terminate()}delete this._workerInfos,delete this._pendingActions},e.prototype.push=function(e){for(var t=0,i=this._workerInfos;t<i.length;t++){var r=i[__uv.$wrap((t))];if(!r.active)return void this._execute(r,e)}this._pendingActions.push(e)},e.prototype._execute=function(e,t){var i=this;e.active=!0,t(e.worker,(function(){e.active=!1;var t=i._pendingActions.shift();t&&i._execute(e,t)}))},e}();e.WorkerPool=t}(s||(s={})),function(e){var t=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,i,r){this._blendConstants[__uv.$wrap((0))]===e&&this._blendConstants[__uv.$wrap((1))]===t&&this._blendConstants[__uv.$wrap((2))]===i&&this._blendConstants[__uv.$wrap((3))]===r||(this._blendConstants[__uv.$wrap((0))]=e,this._blendConstants[__uv.$wrap((1))]=t,this._blendConstants[__uv.$wrap((2))]=i,this._blendConstants[__uv.$wrap((3))]=r,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){this._blendFunctionParameters[__uv.$wrap((0))]===e&&this._blendFunctionParameters[__uv.$wrap((1))]===t&&this._blendFunctionParameters[__uv.$wrap((2))]===i&&this._blendFunctionParameters[__uv.$wrap((3))]===r||(this._blendFunctionParameters[__uv.$wrap((0))]=e,this._blendFunctionParameters[__uv.$wrap((1))]=t,this._blendFunctionParameters[__uv.$wrap((2))]=i,this._blendFunctionParameters[__uv.$wrap((3))]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[__uv.$wrap((0))]===e&&this._blendEquationParameters[__uv.$wrap((1))]===t||(this._blendEquationParameters[__uv.$wrap((0))]=e,this._blendEquationParameters[__uv.$wrap((1))]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[__uv.$wrap((0))]=null,this._blendFunctionParameters[__uv.$wrap((1))]=null,this._blendFunctionParameters[__uv.$wrap((2))]=null,this._blendFunctionParameters[__uv.$wrap((3))]=null,this._blendEquationParameters[__uv.$wrap((0))]=null,this._blendEquationParameters[__uv.$wrap((1))]=null,this._blendConstants[__uv.$wrap((0))]=null,this._blendConstants[__uv.$wrap((1))]=null,this._blendConstants[__uv.$wrap((2))]=null,this._blendConstants[__uv.$wrap((3))]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[__uv.$wrap((0))],this._blendFunctionParameters[__uv.$wrap((1))],this._blendFunctionParameters[__uv.$wrap((2))],this._blendFunctionParameters[__uv.$wrap((3))]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[__uv.$wrap((0))],this._blendEquationParameters[__uv.$wrap((1))]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[__uv.$wrap((0))],this._blendConstants[__uv.$wrap((1))],this._blendConstants[__uv.$wrap((2))],this._blendConstants[__uv.$wrap((3))]),this._isBlendConstantsDirty=!1))},e}();e._AlphaState=t}(s||(s={})),function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}();e._DepthCullingState=t}(s||(s={})),function(e){var t=function(){function t(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.Engine.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.Engine.KEEP,this._stencilOpDepthFail=e.Engine.KEEP,this._stencilOpStencilDepthPass=e.Engine.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},t.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},t}();e._StencilState=t}(s||(s={}));var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[__uv.$wrap((i))])Object.prototype.hasOwnProperty.call(t,n)&&(e[__uv.$wrap((n))]=t[__uv.$wrap((n))]);return e}).apply(this,arguments)};!function(e){var t=function(){},i=function(){};e.InstancingAttributeInfo=i;var r=function(){};e.RenderTargetCreationOptions=r;var n=function(){};e.DepthTextureCreationOptions=n;var a=function(){};e.EngineCapabilities=a;var s=function(){function i(r,n,a,o){void 0===o&&(o=!1);var s=this;this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.scenes=new Array,this.postProcesses=new Array,this.validateShaderPrograms=!1,this.onResizeObservable=new e.Observable,this.onCanvasBlurObservable=new e.Observable,this.onCanvasFocusObservable=new e.Observable,this.onCanvasPointerOutObservable=new e.Observable,this.onBeforeTextureInitObservable=new e.Observable,this._vrDisplay=void 0,this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this.onBeginFrameObservable=new e.Observable,this.onEndFrameObservable=new e.Observable,this.onBeforeShaderCompilationObservable=new e.Observable,this.onAfterShaderCompilationObservable=new e.Observable,this._windowIsBackground=!1,this._webGLVersion=1,this._badOS=!1,this._badDesktopOS=!1,this.disableTextureBindingOptimization=!1,this.onVRDisplayChangedObservable=new e.Observable,this.onVRRequestPresentComplete=new e.Observable,this.onVRRequestPresentStart=new e.Observable,this._colorWrite=!0,this._drawCalls=new e.PerfCounter,this._textureCollisions=new e.PerfCounter,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new e.Observable,this.onContextRestoredObservable=new e.Observable,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new e.PerformanceMonitor,this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this._depthCullingState=new e._DepthCullingState,this._stencilState=new e._StencilState,this._alphaState=new e._AlphaState,this._alphaMode=i.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._firstBoundInternalTextureTracker=new e.DummyInternalTextureTracker,this._lastBoundInternalTextureTracker=new e.DummyInternalTextureTracker,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this._viewportCached=new e.Vector4(0,0,0,0),this._onVRFullScreenTriggered=function(){if(s._vrDisplay&&s._vrDisplay.isPresenting){s._oldSize=new e.Size(s.getRenderWidth(),s.getRenderHeight()),s._oldHardwareScaleFactor=s.getHardwareScalingLevel();var t=s._vrDisplay.getEyeParameters("left");s.setHardwareScalingLevel(1),s.setSize(2*t.renderWidth,t.renderHeight)}else s.setHardwareScalingLevel(s._oldHardwareScaleFactor),s.setSize(s._oldSize.width,s._oldSize.height)},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},e.PromisePolyfill.Apply();var l=null;if(i.Instances.push(this),r){if(a=a||{},r.getContext){if(l=r,this._renderingCanvas=l,null!=n&&(a.antialias=n),void 0===a.deterministicLockstep&&(a.deterministicLockstep=!1),void 0===a.lockstepMaxSteps&&(a.lockstepMaxSteps=4),void 0===a.preserveDrawingBuffer&&(a.preserveDrawingBuffer=!1),void 0===a.audioEngine&&(a.audioEngine=!0),void 0===a.stencil&&(a.stencil=!0),!1===a.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._deterministicLockstep=a.deterministicLockstep,this._lockstepMaxSteps=a.lockstepMaxSteps,this._doNotHandleContextLost=!!a.doNotHandleContextLost,navigator&&navigator.userAgent)for(var c=navigator.userAgent,u=0,h=i.ExceptionList;u<h.length;u++){var d=h[__uv.$wrap((u))],p=d.key,m=d.targets;if(c.indexOf(p)>-1){if(d.capture&&d.captureConstraint){var _=d.capture,f=d.captureConstraint,g=new RegExp(_).exec(c);if(g&&g.length>0)if(parseInt(g[__uv.$wrap((g.length-1))])>=f)continue}for(var y=0,v=m;y<v.length;y++){switch(v[__uv.$wrap((y))]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"textureBindingOptimization":this.disableTextureBindingOptimization=!0}}}}if(!a.disableWebGL2Support)try{this._gl=l.getContext("webgl2",a)||l.getContext("experimental-webgl2",a),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!l)throw new Error("The provided canvas is null or undefined.");try{this._gl=l.getContext("webgl",a)||l.getContext("experimental-webgl",a)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._onCanvasFocus=function(){s.onCanvasFocusObservable.notifyObservers(s)},this._onCanvasBlur=function(){s.onCanvasBlurObservable.notifyObservers(s)},l.addEventListener("focus",this._onCanvasFocus),l.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.disable(),s._windowIsBackground=!0},this._onFocus=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.enable(),s._windowIsBackground=!1},this._onCanvasPointerOut=function(e){s.onCanvasPointerOutObservable.notifyObservers(e)},window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus),l.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(t){t.preventDefault(),s._contextWasLost=!0,e.Tools.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(t){setTimeout((function(){s._initGLContext(),s._rebuildEffects(),s._rebuildInternalTextures(),s._rebuildBuffers(),s.wipeCaches(!0),e.Tools.Warn("WebGL context successfully restored."),s.onContextRestoredObservable.notifyObservers(s),s._contextWasLost=!1}),0)},l.addEventListener("webglcontextlost",this._onContextLost,!1),l.addEventListener("webglcontextrestored",this._onContextRestored,!1))}else{this._gl=r,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var b=this._gl.getContextAttributes();b&&(a.stencil=b.stencil)}var x=a.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=o?1/Math.min(x,window.devicePixelRatio||1):1,this.resize(),this._isStencilEnable=!!a.stencil,this._initGLContext(),l&&(this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&l&&(l.requestPointerLock=l.requestPointerLock||l.msRequestPointerLock||l.mozRequestPointerLock||l.webkitRequestPointerLock,l.requestPointerLock&&l.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===l||document.webkitPointerLockElement===l||document.msPointerLockElement===l||document.pointerLockElement===l},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._onVRDisplayPointerRestricted=function(){l&&l.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){document.exitPointerLock()},window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)),!i.audioEngine&&a.audioEngine&&i.AudioEngineFactory&&(i.audioEngine=i.AudioEngineFactory(this.getRenderingCanvas()));for(var S=0;S<this._caps.maxVertexAttribs;S++)this._currentBufferPointers[__uv.$wrap((S))]=new t;this._linkTrackers(this._firstBoundInternalTextureTracker,this._lastBoundInternalTextureTracker),a.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),console.log("Babylon.js engine (v"+i.Version+") launched"),this.enableOfflineSupport=void 0!==e.Database}}return Object.defineProperty(i,"LastCreatedEngine",{get:function(){return 0===i.Instances.length?null:i.Instances[__uv.$wrap((i.Instances.length-1))]},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LastCreatedScene",{get:function(){var e=i.LastCreatedEngine;return e?0===e.scenes.length?null:e.scenes[__uv.$wrap((e.scenes.length-1))]:null},enumerable:!0,configurable:!0}),i.MarkAllMaterialsAsDirty=function(e,t){for(var r=0;r<i.Instances.length;r++)for(var n=i.Instances[__uv.$wrap((r))],a=0;a<n.scenes.length;a++)n.scenes[__uv.$wrap((a))].markAllMaterialsAsDirty(e,t)},Object.defineProperty(i,"Version",{get:function(){return"3.3.0"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,i.TEXTUREFORMAT_RGBA,!1,!1,i.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,i.TEXTUREFORMAT_RGBA,!1,!1,i.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,i.TEXTUREFORMAT_RGBA,i.TEXTURETYPE_UNSIGNED_INT,!1,!1,i.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),i.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++){t[__uv.$wrap((e))]._rebuild()}},i.prototype._rebuildEffects=function(){for(var t in this._compiledEffects){this._compiledEffects[__uv.$wrap((t))]._prepareEffect()}e.Effect.ResetCache()},i.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var i=t[__uv.$wrap((e))];i.resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}for(var r=0,n=this._uniformBuffers;r<n.length;r++){n[__uv.$wrap((r))]._rebuild()}},i.prototype._initGLContext=function(){this._caps=new a,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxCombinedTexturesImageUnits=this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!0,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++)this._gl[__uv.$wrap(("COLOR_ATTACHMENT"+i+"_WEBGL"))]=t[__uv.$wrap(("COLOR_ATTACHMENT"+i+"_WEBGL"))]}else this._caps.drawBuffersExtension=!1}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var r=this._gl.getExtension("WEBGL_depth_texture");null!=r&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=r.UNSIGNED_INT_24_8_WEBGL)}if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");null!=n?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var o=this._gl.getExtension("ANGLE_instanced_arrays");null!=o?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=o.drawArraysInstancedANGLE.bind(o),this._gl.drawElementsInstanced=o.drawElementsInstancedANGLE.bind(o),this._gl.vertexAttribDivisor=o.vertexAttribDivisorANGLE.bind(o)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var s=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);s&&(this._caps.highPrecisionShaderSupported=0!==s.precision)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var l=0;l<this._maxSimultaneousTextures;l++)this._nextFreeTextureSlots.push(l)},Object.defineProperty(i.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),i.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},i.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)if(this._boundTexturesCache.hasOwnProperty(e)){var t=this._boundTexturesCache[__uv.$wrap((e))];t&&this._removeDesignatedSlot(t),this._boundTexturesCache[__uv.$wrap((e))]=null}if(!this.disableTextureBindingOptimization){this._nextFreeTextureSlots=[];for(var i=0;i<this._maxSimultaneousTextures;i++)this._nextFreeTextureSlots.push(i)}this._currentTextureChannel=-1},i.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},i.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},i.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},i.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},i.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},i.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},i.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},i.prototype.getRenderingCanvas=function(){return this._renderingCanvas},i.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},i.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},i.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},i.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},i.prototype.getCaps=function(){return this._caps},Object.defineProperty(i.prototype,"drawCalls",{get:function(){return e.Tools.Warn("drawCalls is deprecated. Please use SceneInstrumentation class"),0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"drawCallsPerfCounter",{get:function(){return e.Tools.Warn("drawCallsPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),i.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},i.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},i.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},i.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},i.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},i.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},i.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},i.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},i.prototype.getStencilMask=function(){return this._stencilState.stencilMask},i.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},i.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},i.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},i.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},i.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},i.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},i.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},i.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},i.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},i.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},i.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},i.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},i.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},i.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},i.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},i.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},i.prototype._renderLoop=function(){if(!this._contextWasLost){var t=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(t=!1),t){this.beginFrame();for(var i=0;i<this._activeRenderLoops.length;i++){(0,this._activeRenderLoops[__uv.$wrap((i))])()}this.endFrame()}}if(this._activeRenderLoops.length>0){var r=null;this._vrDisplay&&this._vrDisplay.isPresenting&&(r=this._vrDisplay),this._frameHandler=e.Tools.QueueNewFrame(this._bindedRenderFunction,r)}else this._renderingQueueLaunched=!1},i.prototype.runRenderLoop=function(t){-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=e.Tools.QueueNewFrame(this._bindedRenderFunction)))},i.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,this._renderingCanvas&&e.Tools.RequestFullscreen(this._renderingCanvas))},i.prototype.clear=function(e,t,i,r){void 0===r&&(r=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),i&&(this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},i.prototype.scissorClear=function(e,t,i,r,n){var a=this._gl,o=a.getParameter(a.SCISSOR_TEST),s=a.getParameter(a.SCISSOR_BOX);a.enable(a.SCISSOR_TEST),a.scissor(e,t,i,r),this.clear(n,!0,!0,!0),a.scissor(s[__uv.$wrap((0))],s[__uv.$wrap((1))],s[__uv.$wrap((2))],s[__uv.$wrap((3))]),!0===o?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST)},i.prototype._viewport=function(e,t,i,r){e===this._viewportCached.x&&t===this._viewportCached.y&&i===this._viewportCached.z&&r===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=r,this._gl.viewport(e,t,i,r))},i.prototype.setViewport=function(e,t,i){var r=t||this.getRenderWidth(),n=i||this.getRenderHeight(),a=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(a*r,o*n,r*e.width,n*e.height)},i.prototype.setDirectViewport=function(e,t,i,r){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,r),n},i.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},i.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame(),this.onEndFrameObservable.notifyObservers(this)},i.prototype.resize=function(){if(!this._vrDisplay||!this._vrDisplay.isPresenting){var e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)}},i.prototype.setSize=function(e,t){if(this._renderingCanvas&&(this._renderingCanvas.width!==e||this._renderingCanvas.height!==t)){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[__uv.$wrap((i))],n=0;n<r.cameras.length;n++){r.cameras[__uv.$wrap((n))]._currentRenderId=0}this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},i.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},i.prototype.getVRDevice=function(){return this._vrDisplay},i.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},i.prototype.initWebVRAsync=function(){var t=this,i=function(){var e={vrDisplay:t._vrDisplay,vrSupported:t._vrSupported};t.onVRDisplayChangedObservable.notifyObservers(e),t._webVRInitPromise=new Promise((function(t){t(e)}))};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(e){t._vrDisplay=e.display,i()},this._onVrDisplayDisconnect=function(){t._vrDisplay.cancelAnimationFrame(t._frameHandler),t._vrDisplay=void 0,t._frameHandler=e.Tools.QueueNewFrame(t._bindedRenderFunction),i()},this._onVrDisplayPresentChange=function(){t._vrExclusivePointerMode=t._vrDisplay&&t._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(i),this._webVRInitPromise},i.prototype.enableVR=function(){var e=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then((function(){e.onVRRequestPresentComplete.notifyObservers(!0),e._onVRFullScreenTriggered()})).catch((function(){e.onVRRequestPresentComplete.notifyObservers(!1)}))}},i.prototype.disableVR=function(){this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(this._onVRFullScreenTriggered).catch(this._onVRFullScreenTriggered)},i.prototype._getVRDisplaysAsync=function(){var e=this;return new Promise((function(t,i){navigator.getVRDisplays?navigator.getVRDisplays().then((function(i){e._vrSupported=!0,e._vrDisplay=i[__uv.$wrap((0))],t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported})})):(e._vrDisplay=void 0,e._vrSupported=!1,t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported}))}))},i.prototype.bindFramebuffer=function(e,t,i,r,n,a,o){void 0===o&&(o=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this.bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var s=this._gl;e.isCube&&(void 0===t&&(t=0),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,o),a&&(a._generateStencilBuffer?s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,a._webGLTexture,o):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,a._webGLTexture,o))),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,r):(i||(i=e.width,o&&(i/=Math.pow(2,o))),r||(r=e.height,o&&(r/=Math.pow(2,o))),this._viewport(0,0,i,r)),this.wipeCaches()},i.prototype.bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},i.prototype.unBindFramebuffer=function(e,t,i){void 0===t&&(t=!1),this._currentRenderTarget=null;var r=this._gl;e._MSAAFramebuffer&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,e._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e._framebuffer),r.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,r.COLOR_BUFFER_BIT,r.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(r.TEXTURE_2D,e,!0),r.generateMipmap(r.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null)),i&&(e._MSAAFramebuffer&&this.bindUnboundFramebuffer(e._framebuffer),i()),this.bindUnboundFramebuffer(null)},i.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t,i){void 0===t&&(t=!1),this._currentRenderTarget=null;var r=this._gl;if(e[__uv.$wrap((0))]._MSAAFramebuffer){r.bindFramebuffer(r.READ_FRAMEBUFFER,e[__uv.$wrap((0))]._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e[__uv.$wrap((0))]._framebuffer);var n=e[__uv.$wrap((0))]._attachments;n||(n=new Array(e.length),e[__uv.$wrap((0))]._attachments=n);for(var a=0;a<e.length;a++){for(var o=e[__uv.$wrap((a))],s=0;s<n.length;s++)n[__uv.$wrap((s))]=r.NONE;n[__uv.$wrap((a))]=r[__uv.$wrap((this.webGLVersion>1?"COLOR_ATTACHMENT"+a:"COLOR_ATTACHMENT"+a+"_WEBGL"))],r.readBuffer(n[__uv.$wrap((a))]),r.drawBuffers(n),r.blitFramebuffer(0,0,o.width,o.height,0,0,o.width,o.height,r.COLOR_BUFFER_BIT,r.NEAREST)}for(a=0;a<n.length;a++)n[__uv.$wrap((a))]=r[__uv.$wrap((this.webGLVersion>1?"COLOR_ATTACHMENT"+a:"COLOR_ATTACHMENT"+a+"_WEBGL"))];r.drawBuffers(n)}for(a=0;a<e.length;a++){!(o=e[__uv.$wrap((a))]).generateMipMaps||t||o.isCube||(this._bindTextureDirectly(r.TEXTURE_2D,o),r.generateMipmap(r.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null))}i&&(e[__uv.$wrap((0))]._MSAAFramebuffer&&this.bindUnboundFramebuffer(e[__uv.$wrap((0))]._framebuffer),i()),this.bindUnboundFramebuffer(null)},i.prototype.generateMipMapsForCubemap=function(e){if(e.generateMipMaps){var t=this._gl;this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,e,!0),t.generateMipmap(t.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}},i.prototype.flushFramebuffer=function(){this._gl.flush()},i.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this.bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},i.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");return this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},i.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");return this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},i.prototype.updateUniformBuffer=function(e,t,i,r){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this.bindUniformBuffer(null)},i.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},i.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create vertex buffer");return this.bindArrayBuffer(t),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},i.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic vertex buffer");return this.bindArrayBuffer(t),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},i.prototype.updateDynamicIndexBuffer=function(e,t,i){var r;void 0===i&&(i=0),this._currentBoundBuffer[__uv.$wrap((this._gl.ELEMENT_ARRAY_BUFFER))]=null,this.bindIndexBuffer(e),r=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},i.prototype.updateDynamicVertexBuffer=function(e,t,i,r){this.bindArrayBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+r)):(t=t instanceof ArrayBuffer?new Uint8Array(t,i,r):new Uint8Array(t.buffer,t.byteOffset+i,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},i.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},i.prototype.createIndexBuffer=function(e,t){var i,r=this._gl.createBuffer();if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(r);var n=!1;if(e instanceof Uint16Array)i=e;else if(this._caps.uintIndices)if(e instanceof Uint32Array)i=e,n=!0;else{for(var a=0;a<e.length;a++)if(e[__uv.$wrap((a))]>65535){n=!0;break}i=n?new Uint32Array(e):new Uint16Array(e)}else i=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),r.references=1,r.is32Bits=n,r},i.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},i.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e)},i.prototype.bindUniformBufferBase=function(e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e)},i.prototype.bindUniformBlock=function(e,t,i){var r=this._gl.getUniformBlockIndex(e,t);this._gl.uniformBlockBinding(e,r,i)},i.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},i.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[__uv.$wrap((t))]!==e)&&(this._gl.bindBuffer(t,e),this._currentBoundBuffer[__uv.$wrap((t))]=e)},i.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},i.prototype._vertexAttribPointer=function(e,t,i,r,n,a,o){var s=this._currentBufferPointers[__uv.$wrap((t))],l=!1;s.active?(s.buffer!==e&&(s.buffer=e,l=!0),s.size!==i&&(s.size=i,l=!0),s.type!==r&&(s.type=r,l=!0),s.normalized!==n&&(s.normalized=n,l=!0),s.stride!==a&&(s.stride=a,l=!0),s.offset!==o&&(s.offset=o,l=!0)):(l=!0,s.active=!0,s.index=t,s.size=i,s.type=r,s.normalized=n,s.stride=a,s.offset=o,s.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,i,r,n,a,o))},i.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},i.prototype._bindVertexBuffersAttributes=function(e,t){var i=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var r=0;r<i.length;r++){var n=t.getAttributeLocation(r);if(n>=0){var a=e[__uv.$wrap((i[__uv.$wrap((r))]))];if(!a)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[__uv.$wrap((n))]=!0);var o=a.getBuffer();o&&(this._vertexAttribPointer(o,n,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(o))))}}},i.prototype.recordVertexArrayObject=function(e,t,i){var r=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(r),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),r},i.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},i.prototype.bindBuffersDirectly=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var a=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,s=0;s<a;s++)if(s<i.length){var l=n.getAttributeLocation(s);l>=0&&(this._gl.enableVertexAttribArray(l),this._vertexAttribArraysEnabled[__uv.$wrap((l))]=!0,this._vertexAttribPointer(e,l,i[__uv.$wrap((s))],this._gl.FLOAT,!1,r,o)),o+=4*i[__uv.$wrap((s))]}}this._bindIndexBufferWithCache(t)},i.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},i.prototype.bindBuffers=function(e,t,i){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i)),this._bindIndexBufferWithCache(t)},i.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;t<i;t++){var r=this._currentInstanceBuffers[__uv.$wrap((t))];e!=r&&r.references&&(e=r,this.bindArrayBuffer(r));var n=this._currentInstanceLocations[__uv.$wrap((t))];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},i.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},i.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._gl.deleteBuffer(e),!0)},i.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");return t.capacity=e,this.bindArrayBuffer(t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},i.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},i.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[__uv.$wrap((0))].index){for(var r=0,n=0;n<i.length;n++){r+=4*(a=i[__uv.$wrap((n))]).attributeSize}for(n=0;n<i.length;n++){var a=i[__uv.$wrap((n))];this._vertexAttribArraysEnabled[__uv.$wrap((a.index))]||(this._gl.enableVertexAttribArray(a.index),this._vertexAttribArraysEnabled[__uv.$wrap((a.index))]=!0),this._vertexAttribPointer(e,a.index,a.attributeSize,a.attribyteType||this._gl.FLOAT,a.normalized||!1,r,a.offset),this._gl.vertexAttribDivisor(a.index,1),this._currentInstanceLocations.push(a.index),this._currentInstanceBuffers.push(e)}}else for(var o=0;o<4;o++){var s=i[__uv.$wrap((o))];this._vertexAttribArraysEnabled[__uv.$wrap((s))]||(this._gl.enableVertexAttribArray(s),this._vertexAttribArraysEnabled[__uv.$wrap((s))]=!0),this._vertexAttribPointer(e,s,4,this._gl.FLOAT,!1,64,16*o),this._gl.vertexAttribDivisor(s,1),this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(e)}},i.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},i.prototype.draw=function(t,i,r,n){this.drawElementsType(t?e.Material.TriangleFillMode:e.Material.WireFrameFillMode,i,r,n)},i.prototype.drawPointClouds=function(t,i,r){this.drawArraysType(e.Material.PointFillMode,t,i,r)},i.prototype.drawUnIndexed=function(t,i,r,n){this.drawArraysType(t?e.Material.TriangleFillMode:e.Material.WireFrameFillMode,i,r,n)},i.prototype.drawElementsType=function(e,t,i,r){this.applyStates(),this._drawCalls.addCount(1,!1);var n=this._drawMode(e),a=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(n,i,a,t*o,r):this._gl.drawElements(n,i,a,t*o)},i.prototype.drawArraysType=function(e,t,i,r){this.applyStates(),this._drawCalls.addCount(1,!1);var n=this._drawMode(e);r?this._gl.drawArraysInstanced(n,t,i,r):this._gl.drawArrays(n,t,i)},i.prototype._drawMode=function(t){switch(t){case e.Material.TriangleFillMode:return this._gl.TRIANGLES;case e.Material.PointFillMode:return this._gl.POINTS;case e.Material.WireFrameFillMode:return this._gl.LINES;case e.Material.PointListDrawMode:return this._gl.POINTS;case e.Material.LineListDrawMode:return this._gl.LINES;case e.Material.LineLoopDrawMode:return this._gl.LINE_LOOP;case e.Material.LineStripDrawMode:return this._gl.LINE_STRIP;case e.Material.TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case e.Material.TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},i.prototype._releaseEffect=function(e){this._compiledEffects[__uv.$wrap((e._key))]&&(delete this._compiledEffects[__uv.$wrap((e._key))],this._deleteProgram(e.getProgram()))},i.prototype._deleteProgram=function(e){e&&(e.__SPECTOR_rebuildProgram=null,e.transformFeedback&&(this.deleteTransformFeedback(e.transformFeedback),e.transformFeedback=null),this._gl.deleteProgram(e))},i.prototype.createEffect=function(t,i,r,n,a,o,s,l,c){var u=(t.vertexElement||t.vertex||t)+"+"+(t.fragmentElement||t.fragment||t)+"@"+(a||i.defines);if(this._compiledEffects[__uv.$wrap((u))]){var h=this._compiledEffects[__uv.$wrap((u))];return s&&h.isReady()&&s(h),h}var d=new e.Effect(t,i,r,n,this,a,o,s,l,c);return d._key=u,this._compiledEffects[__uv.$wrap((u))]=d,d},i.prototype._compileShader=function(e,t,i,r){return this._compileRawShader(r+(i?i+"\n":"")+e,t)},i.prototype._compileRawShader=function(e,t){var i=this._gl,r=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!r)throw new Error("Something went wrong while compile the shader.");if(i.shaderSource(r,e),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS)){var n=i.getShaderInfoLog(r);if(n)throw new Error(n)}return r},i.prototype.createRawShaderProgram=function(e,t,i,r){void 0===r&&(r=null),i=i||this._gl;var n=this._compileRawShader(e,"vertex"),a=this._compileRawShader(t,"fragment");return this._createShaderProgram(n,a,i,r)},i.prototype.createShaderProgram=function(e,t,i,r,n){void 0===n&&(n=null),r=r||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var a=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",o=this._compileShader(e,"vertex",i,a),s=this._compileShader(t,"fragment",i,a),l=this._createShaderProgram(o,s,r,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),l},i.prototype._createShaderProgram=function(e,t,i,r){void 0===r&&(r=null);var n,a=i.createProgram();if(!a)throw new Error("Unable to create program");if(i.attachShader(a,e),i.attachShader(a,t),this.webGLVersion>1&&r){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(a,r),a.transformFeedback=o}if((i.linkProgram(a),this.webGLVersion>1&&r&&this.bindTransformFeedback(null),!i.getProgramParameter(a,i.LINK_STATUS))&&(n=i.getProgramInfoLog(a)))throw new Error(n);if(this.validateShaderPrograms&&(i.validateProgram(a),!i.getProgramParameter(a,i.VALIDATE_STATUS)&&(n=i.getProgramInfoLog(a))))throw new Error(n);return i.deleteShader(e),i.deleteShader(t),a},i.prototype.getUniforms=function(e,t){for(var i=new Array,r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e,t[__uv.$wrap((r))]));return i},i.prototype.getAttributes=function(e,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e,t[__uv.$wrap((r))]))}catch(e){i.push(-1)}return i},i.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},i.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},i.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},i.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},i.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},i.prototype.setFloatArray=function(e,t){e&&this._gl.uniform1fv(e,t)},i.prototype.setFloatArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},i.prototype.setFloatArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},i.prototype.setFloatArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},i.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},i.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},i.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},i.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},i.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},i.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},i.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},i.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},i.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},i.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},i.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},i.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},i.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},i.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},i.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},i.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},i.prototype.setDirectColor4=function(e,t){e&&this._gl.uniform4f(e,t.r,t.g,t.b,t.a)},i.prototype.setState=function(e,t,i,r){void 0===t&&(t=0),void 0===r&&(r=!1),(this._depthCullingState.cull!==e||i)&&(this._depthCullingState.cull=e);var n=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==n||i)&&(this._depthCullingState.cullFace=n),this.setZOffset(t);var a=r?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==a||i)&&(this._depthCullingState.frontFace=a)},i.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},i.prototype.getZOffset=function(){return this._depthCullingState.zOffset},i.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},i.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},i.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},i.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e),this._colorWrite=e},i.prototype.getColorWrite=function(){return this._colorWrite},i.prototype.setAlphaConstants=function(e,t,i,r){this._alphaState.setAlphaBlendConstants(e,t,i,r)},i.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case i.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case i.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case i.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case i.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case i.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||this.setDepthWrite(e===i.ALPHA_DISABLE),this._alphaMode=e}},i.prototype.getAlphaMode=function(){return this._alphaMode},i.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},i.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,e&&(this.resetTextureCache(),this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._unpackFlipYCached=null),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null))},i.prototype.setTextureFormatToUse=function(e){for(var t=0,i=this.texturesSupported.length;t<i;t++)for(var r=0,n=e.length;r<n;r++)if(this._texturesSupported[__uv.$wrap((t))]===e[__uv.$wrap((r))].toLowerCase())return this._textureFormatInUse=this._texturesSupported[__uv.$wrap((t))];return this._textureFormatInUse=null,null},i.prototype._getSamplingParameters=function(e,t){var r=this._gl,n=r.NEAREST,a=r.NEAREST;switch(e){case i.TEXTURE_BILINEAR_SAMPLINGMODE:n=r.LINEAR,a=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case i.TEXTURE_TRILINEAR_SAMPLINGMODE:n=r.LINEAR,a=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case i.TEXTURE_NEAREST_SAMPLINGMODE:n=r.NEAREST,a=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case i.TEXTURE_NEAREST_NEAREST_MIPNEAREST:n=r.NEAREST,a=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case i.TEXTURE_NEAREST_LINEAR_MIPNEAREST:n=r.NEAREST,a=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case i.TEXTURE_NEAREST_LINEAR_MIPLINEAR:n=r.NEAREST,a=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case i.TEXTURE_NEAREST_LINEAR:n=r.NEAREST,a=r.LINEAR;break;case i.TEXTURE_NEAREST_NEAREST:n=r.NEAREST,a=r.NEAREST;break;case i.TEXTURE_LINEAR_NEAREST_MIPNEAREST:n=r.LINEAR,a=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case i.TEXTURE_LINEAR_NEAREST_MIPLINEAR:n=r.LINEAR,a=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case i.TEXTURE_LINEAR_LINEAR:n=r.LINEAR,a=r.LINEAR;break;case i.TEXTURE_LINEAR_NEAREST:n=r.LINEAR,a=r.NEAREST}return{min:a,mag:n}},i.prototype._partialLoadImg=function(t,i,r,n,a,o){var s;void 0===o&&(o=null);s=e.Tools.LoadImage(t,(function(){r[__uv.$wrap((i))]=s,r._internalCount++,n&&n._removePendingData(s),6===r._internalCount&&a(r)}),(function(e,t){n&&n._removePendingData(s),o&&o(e,t)}),n?n.database:null),n&&n._addPendingData(s)},i.prototype._cascadeLoadImgs=function(e,t,i,r,n){void 0===n&&(n=null);var a=[];a._internalCount=0;for(var o=0;o<6;o++)this._partialLoadImg(r[__uv.$wrap((o))],o,a,t,i,n)},i.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},i.prototype.createTexture=function(t,r,n,a,o,s,l,c,u,h,d){var p=this;void 0===o&&(o=i.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===d&&(d=null);for(var m=String(t),_="data:"===m.substr(0,5),f="blob:"===m.substr(0,5),g=_&&-1!==m.indexOf(";base64,"),y=u||new e.InternalTexture(this,e.InternalTexture.DATASOURCE_URL),v=m.lastIndexOf("."),b=d||(v>-1?m.substring(v).toLowerCase():""),x=null,S=0,T=i._TextureLoaders;S<T.length;S++){var E=T[__uv.$wrap((S))];if(E.canLoad(b,this._textureFormatInUse,u,g,!!c)){x=E;break}}x&&(m=x.transformUrl(m,this._textureFormatInUse)),a&&a._addPendingData(y),y.url=m,y.generateMipMaps=!r,y.samplingMode=o,y.invertY=n,this._doNotHandleContextLost||(y._buffer=c);var P=null;s&&!u&&(P=y.onLoadedObservable.add(s)),u||this._internalTexturesCache.push(y);var A=function(i,s){a&&a._removePendingData(y);var u=!1;x&&(x.getFallbackTextureUrl(m,p._textureFormatInUse)&&(u=!0,p.createTexture(t,r,n,a,o,null,l,c,y)));u||(P&&y.onLoadedObservable.remove(P),e.Tools.UseFallbackTexture&&p.createTexture(e.Tools.fallbackTexture,r,n,a,o,null,l,c,y)),l&&l(i||"Unknown error",s)};if(x){var M=function(e){x.loadData(e,y,(function(e,t,i,r,s){p._prepareWebGLTexture(y,a,e,t,n,!i,r,(function(){return s(),!1}),o)}))};c?M(c):this._loadFile(m,M,void 0,a?a.database:void 0,!0,(function(e,t){A("Unable to load "+(e&&e.responseURL,t))}))}else{var C=function(t){f&&!p._doNotHandleContextLost&&(y._buffer=t),p._prepareWebGLTexture(y,a,t.width,t.height,n,r,!1,(function(i,r,n){var o=p._gl,s=t.width===i&&t.height===r,l=h?p._getInternalFormat(h):".jpg"===b?o.RGB:o.RGBA;if(s)return o.texImage2D(o.TEXTURE_2D,0,l,l,o.UNSIGNED_BYTE,t),!1;var c=p._caps.maxTextureSize;if(t.width>c||t.height>c)return p._prepareWorkingCanvas(),!(!p._workingCanvas||!p._workingContext)&&(p._workingCanvas.width=i,p._workingCanvas.height=r,p._workingContext.drawImage(t,0,0,t.width,t.height,0,0,i,r),o.texImage2D(o.TEXTURE_2D,0,l,l,o.UNSIGNED_BYTE,p._workingCanvas),y.width=i,y.height=r,!1);var u=new e.InternalTexture(p,e.InternalTexture.DATASOURCE_TEMP);return p._bindTextureDirectly(o.TEXTURE_2D,u,!0),o.texImage2D(o.TEXTURE_2D,0,l,l,o.UNSIGNED_BYTE,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),p._rescaleTexture(u,y,a,l,(function(){p._releaseTexture(u),p._bindTextureDirectly(o.TEXTURE_2D,y,!0),n()})),!0}),o)};!_||g?c instanceof HTMLImageElement?C(c):e.Tools.LoadImage(m,C,A,a?a.database:null):"string"==typeof c||c instanceof ArrayBuffer||c instanceof Blob?e.Tools.LoadImage(c,C,A,a?a.database:null):C(c)}return y},i.prototype._rescaleTexture=function(t,r,n,a,o){var s=this,l=this.createRenderTargetTexture({width:r.width,height:r.height},{generateMipMaps:!1,type:i.TEXTURETYPE_UNSIGNED_INT,samplingMode:i.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});this._rescalePostProcess||(this._rescalePostProcess=new e.PassPostProcess("rescale",1,null,i.TEXTURE_BILINEAR_SAMPLINGMODE,this,!1,i.TEXTURETYPE_UNSIGNED_INT)),this._rescalePostProcess.getEffect().executeWhenCompiled((function(){s._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};var e=n;e||(e=s.scenes[__uv.$wrap((s.scenes.length-1))]),e.postProcessManager.directRender([s._rescalePostProcess],l,!0),s._bindTextureDirectly(s._gl.TEXTURE_2D,r,!0),s._gl.copyTexImage2D(s._gl.TEXTURE_2D,0,a,0,0,r.width,r.height,0),s.unBindFramebuffer(l),s._releaseTexture(l),o&&o()}))},i.prototype.updateRawTexture=function(e,t,r,n,a,o){if(void 0===a&&(a=null),void 0===o&&(o=i.TEXTURETYPE_UNSIGNED_INT),e){var s=this._getRGBABufferInternalSizedFormat(o,r),l=this._getInternalFormat(r),c=this._getWebGLTextureType(o);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===n||!!n),this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.type=o,e.invertY=n,e._compression=a),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),a&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[__uv.$wrap((a))],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,s,e.width,e.height,0,l,c,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},i.prototype.createRawTexture=function(t,r,n,a,o,s,l,c,u){void 0===c&&(c=null),void 0===u&&(u=i.TEXTURETYPE_UNSIGNED_INT);var h=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RAW);h.baseWidth=r,h.baseHeight=n,h.width=r,h.height=n,h.format=a,h.generateMipMaps=o,h.samplingMode=l,h.invertY=s,h._compression=c,h.type=u,this._doNotHandleContextLost||(h._bufferView=t),this.updateRawTexture(h,t,a,s,c,u),this._bindTextureDirectly(this._gl.TEXTURE_2D,h,!0);var d=this._getSamplingParameters(l,o);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,d.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,d.min),o&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(h),h},i.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},i.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},i.prototype.createDynamicTexture=function(t,i,r,n){var a=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_DYNAMIC);return a.baseWidth=t,a.baseHeight=i,r&&(t=this.needPOTTextures?e.Tools.GetExponentOfTwo(t,this._caps.maxTextureSize):t,i=this.needPOTTextures?e.Tools.GetExponentOfTwo(i,this._caps.maxTextureSize):i),a.width=t,a.height=i,a.isReady=!1,a.generateMipMaps=r,a.samplingMode=n,this.updateTextureSamplingMode(n,a),this._internalTexturesCache.push(a),a},i.prototype.updateTextureSamplingMode=function(e,t){var i=this._getSamplingParameters(e,t.generateMipMaps);t.isCube?(this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,i.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,i.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):t.is3D?(this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,i.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,i.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t.samplingMode=e},i.prototype.updateDynamicTexture=function(e,t,i,r,n){if(void 0===r&&(r=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(i),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var a=n?this._getInternalFormat(n):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,a,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}},i.prototype.updateVideoTexture=function(e,t,i){if(e&&!e._isDisabled){var r=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!i);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=document.createElement("canvas");var n=e._workingCanvas.getContext("2d");if(!n)throw new Error("Unable to get 2d context");e._workingContext=n,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),r||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(t){e._isDisabled=!0}}},i.prototype.updateTextureComparisonFunction=function(t,r){if(1!==this.webGLVersion){var n=this._gl;t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),0===r?(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,i.LEQUAL),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,r),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),0===r?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,i.LEQUAL),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t._comparisonFunction=r}else e.Tools.Error("WebGL 1 does not support texture comparison.")},i.prototype._setupDepthStencilTexture=function(e,t,r,n,a){var o=t.width||t,s=t.height||t;e.baseWidth=o,e.baseHeight=s,e.width=o,e.height=s,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=r,e.samplingMode=n?i.TEXTURE_BILINEAR_SAMPLINGMODE:i.TEXTURE_NEAREST_SAMPLINGMODE,e.type=i.TEXTURETYPE_UNSIGNED_INT,e._comparisonFunction=a;var l=this._gl,c=e.isCube?l.TEXTURE_CUBE_MAP:l.TEXTURE_2D,u=this._getSamplingParameters(e.samplingMode,!1);l.texParameteri(c,l.TEXTURE_MAG_FILTER,u.mag),l.texParameteri(c,l.TEXTURE_MIN_FILTER,u.min),l.texParameteri(c,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(c,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),0===a?(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,i.LEQUAL),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(c,l.TEXTURE_COMPARE_FUNC,a),l.texParameteri(c,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE))},i.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var i=e.width||e;return this._createDepthStencilCubeTexture(i,t)}return this._createDepthStencilTexture(e,t)},i.prototype._createDepthStencilTexture=function(t,i){var r=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_DEPTHTEXTURE);if(!this._caps.depthTextureExtension)return e.Tools.Error("Depth texture is not supported by your browser or hardware."),r;var n=o({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},i),a=this._gl;return this._bindTextureDirectly(a.TEXTURE_2D,r,!0),this._setupDepthStencilTexture(r,t,n.generateStencil,n.bilinearFiltering,n.comparisonFunction),this.webGLVersion>1?n.generateStencil?a.texImage2D(a.TEXTURE_2D,0,a.DEPTH24_STENCIL8,r.width,r.height,0,a.DEPTH_STENCIL,a.UNSIGNED_INT_24_8,null):a.texImage2D(a.TEXTURE_2D,0,a.DEPTH_COMPONENT24,r.width,r.height,0,a.DEPTH_COMPONENT,a.UNSIGNED_INT,null):n.generateStencil?a.texImage2D(a.TEXTURE_2D,0,a.DEPTH_STENCIL,r.width,r.height,0,a.DEPTH_STENCIL,a.UNSIGNED_INT_24_8,null):a.texImage2D(a.TEXTURE_2D,0,a.DEPTH_COMPONENT,r.width,r.height,0,a.DEPTH_COMPONENT,a.UNSIGNED_INT,null),this._bindTextureDirectly(a.TEXTURE_2D,null),r},i.prototype._createDepthStencilCubeTexture=function(t,i){var r=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_UNKNOWN);if(r.isCube=!0,1===this.webGLVersion)return e.Tools.Error("Depth cube texture is not supported by WebGL 1."),r;var n=o({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},i),a=this._gl;this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,r,!0),this._setupDepthStencilTexture(r,t,n.generateStencil,n.bilinearFiltering,n.comparisonFunction);for(var s=0;s<6;s++)n.generateStencil?a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a.DEPTH24_STENCIL8,t,t,0,a.DEPTH_STENCIL,a.UNSIGNED_INT_24_8,null):a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a.DEPTH_COMPONENT24,t,t,0,a.DEPTH_COMPONENT,a.UNSIGNED_INT,null);return this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),r},i.prototype.setFrameBufferDepthStencilTexture=function(e){var t=e.getInternalTexture();if(t&&t._framebuffer&&e.depthStencilTexture){var i=this._gl,r=e.depthStencilTexture;this.bindUnboundFramebuffer(t._framebuffer),r.isCube?r._generateStencilBuffer?i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_CUBE_MAP_POSITIVE_X,r._webGLTexture,0):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_CUBE_MAP_POSITIVE_X,r._webGLTexture,0):r._generateStencilBuffer?i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,r._webGLTexture,0):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,r._webGLTexture,0),this.bindUnboundFramebuffer(null)}},i.prototype.createRenderTargetTexture=function(t,n){var a=new r;void 0!==n&&"object"==typeof n?(a.generateMipMaps=n.generateMipMaps,a.generateDepthBuffer=void 0===n.generateDepthBuffer||n.generateDepthBuffer,a.generateStencilBuffer=a.generateDepthBuffer&&n.generateStencilBuffer,a.type=void 0===n.type?i.TEXTURETYPE_UNSIGNED_INT:n.type,a.samplingMode=void 0===n.samplingMode?i.TEXTURE_TRILINEAR_SAMPLINGMODE:n.samplingMode,a.format=void 0===n.format?i.TEXTUREFORMAT_RGBA:n.format):(a.generateMipMaps=n,a.generateDepthBuffer=!0,a.generateStencilBuffer=!1,a.type=i.TEXTURETYPE_UNSIGNED_INT,a.samplingMode=i.TEXTURE_TRILINEAR_SAMPLINGMODE,a.format=i.TEXTUREFORMAT_RGBA),(a.type!==i.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(a.type!==i.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(a.samplingMode=i.TEXTURE_NEAREST_SAMPLINGMODE);var o=this._gl,s=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(o.TEXTURE_2D,s,!0);var l=t.width||t,c=t.height||t,u=this._getSamplingParameters(a.samplingMode,!!a.generateMipMaps);a.type!==i.TEXTURETYPE_FLOAT||this._caps.textureFloat||(a.type=i.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,u.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,u.min),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texImage2D(o.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(a.type,a.format),l,c,0,this._getInternalFormat(a.format),this._getWebGLTextureType(a.type),null);var h=this._currentFramebuffer,d=o.createFramebuffer();return this.bindUnboundFramebuffer(d),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,s._webGLTexture,0),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!a.generateStencilBuffer,a.generateDepthBuffer,l,c),a.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),o.bindRenderbuffer(o.RENDERBUFFER,null),this.bindUnboundFramebuffer(h),s._framebuffer=d,s.baseWidth=l,s.baseHeight=c,s.width=l,s.height=c,s.isReady=!0,s.samples=1,s.generateMipMaps=!!a.generateMipMaps,s.samplingMode=a.samplingMode,s.type=a.type,s.format=a.format,s._generateDepthBuffer=a.generateDepthBuffer,s._generateStencilBuffer=!!a.generateStencilBuffer,this._internalTexturesCache.push(s),s},i.prototype.createMultipleRenderTarget=function(t,r){var n=!1,a=!0,o=!1,s=!1,l=1,c=i.TEXTURETYPE_UNSIGNED_INT,u=i.TEXTURE_TRILINEAR_SAMPLINGMODE,h=new Array,d=new Array;void 0!==r&&(n=void 0!==r.generateMipMaps&&r.generateMipMaps,a=void 0===r.generateDepthBuffer||r.generateDepthBuffer,o=void 0!==r.generateStencilBuffer&&r.generateStencilBuffer,s=void 0!==r.generateDepthTexture&&r.generateDepthTexture,l=r.textureCount||1,r.types&&(h=r.types),r.samplingModes&&(d=r.samplingModes));var p=this._gl,m=p.createFramebuffer();this.bindUnboundFramebuffer(m);for(var _=t.width||t,f=t.height||t,g=[],y=[],v=this._setupFramebufferDepthAttachments(o,a,_,f),b=0;b<l;b++){var x=d[__uv.$wrap((b))]||u,S=h[__uv.$wrap((b))]||c;(S!==i.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(S!==i.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(x=i.TEXTURE_NEAREST_SAMPLINGMODE);var T=this._getSamplingParameters(x,n);S!==i.TEXTURETYPE_FLOAT||this._caps.textureFloat||(S=i.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var E=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_MULTIRENDERTARGET),P=p[__uv.$wrap((this.webGLVersion>1?"COLOR_ATTACHMENT"+b:"COLOR_ATTACHMENT"+b+"_WEBGL"))];g.push(E),y.push(P),p.activeTexture(p[__uv.$wrap(("TEXTURE"+b))]),p.bindTexture(p.TEXTURE_2D,E._webGLTexture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,T.mag),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,T.min),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(S),_,f,0,p.RGBA,this._getWebGLTextureType(S),null),p.framebufferTexture2D(p.DRAW_FRAMEBUFFER,P,p.TEXTURE_2D,E._webGLTexture,0),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(p.TEXTURE_2D,null),E._framebuffer=m,E._depthStencilBuffer=v,E.baseWidth=_,E.baseHeight=f,E.width=_,E.height=f,E.isReady=!0,E.samples=1,E.generateMipMaps=n,E.samplingMode=x,E.type=S,E._generateDepthBuffer=a,E._generateStencilBuffer=o,E._attachments=y,this._internalTexturesCache.push(E)}if(s&&this._caps.depthTextureExtension){var A=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_MULTIRENDERTARGET);p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,A._webGLTexture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,this.webGLVersion<2?p.DEPTH_COMPONENT:p.DEPTH_COMPONENT16,_,f,0,p.DEPTH_COMPONENT,p.UNSIGNED_SHORT,null),p.framebufferTexture2D(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.TEXTURE_2D,A._webGLTexture,0),A._framebuffer=m,A.baseWidth=_,A.baseHeight=f,A.width=_,A.height=f,A.isReady=!0,A.samples=1,A.generateMipMaps=n,A.samplingMode=p.NEAREST,A._generateDepthBuffer=a,A._generateStencilBuffer=o,g.push(A),this._internalTexturesCache.push(A)}return p.drawBuffers(y),p.bindRenderbuffer(p.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),this.resetTextureCache(),g},i.prototype._setupFramebufferDepthAttachments=function(e,t,i,r,n){void 0===n&&(n=1);var a=null,o=this._gl;return e?(a=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,a),n>1?o.renderbufferStorageMultisample(o.RENDERBUFFER,n,o.DEPTH24_STENCIL8,i,r):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,i,r),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,a)):t&&(a=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,a),n>1?o.renderbufferStorageMultisample(o.RENDERBUFFER,n,o.DEPTH_COMPONENT16,i,r):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,i,r),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,a)),a},i.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var i=this._gl;if(t=Math.min(t,i.getParameter(i.MAX_SAMPLES)),e._depthStencilBuffer&&(i.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(i.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),t>1){var r=i.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=r,this.bindUnboundFramebuffer(e._MSAAFramebuffer);var n=i.createRenderbuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorageMultisample(i.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n),e._MSAARenderBuffer=n}else this.bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),i.bindRenderbuffer(i.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),t},i.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e||0==e.length)return 1;if(e[__uv.$wrap((0))].samples===t)return t;var i=this._gl;t=Math.min(t,i.getParameter(i.MAX_SAMPLES)),e[__uv.$wrap((0))]._depthStencilBuffer&&(i.deleteRenderbuffer(e[__uv.$wrap((0))]._depthStencilBuffer),e[__uv.$wrap((0))]._depthStencilBuffer=null),e[__uv.$wrap((0))]._MSAAFramebuffer&&(i.deleteFramebuffer(e[__uv.$wrap((0))]._MSAAFramebuffer),e[__uv.$wrap((0))]._MSAAFramebuffer=null);for(var r=0;r<e.length;r++)e[__uv.$wrap((r))]._MSAARenderBuffer&&(i.deleteRenderbuffer(e[__uv.$wrap((r))]._MSAARenderBuffer),e[__uv.$wrap((r))]._MSAARenderBuffer=null);if(t>1){var n=i.createFramebuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");this.bindUnboundFramebuffer(n);var a=this._setupFramebufferDepthAttachments(e[__uv.$wrap((0))]._generateStencilBuffer,e[__uv.$wrap((0))]._generateDepthBuffer,e[__uv.$wrap((0))].width,e[__uv.$wrap((0))].height,t),o=[];for(r=0;r<e.length;r++){var s=e[__uv.$wrap((r))],l=i[__uv.$wrap((this.webGLVersion>1?"COLOR_ATTACHMENT"+r:"COLOR_ATTACHMENT"+r+"_WEBGL"))],c=i.createRenderbuffer();if(!c)throw new Error("Unable to create multi sampled framebuffer");i.bindRenderbuffer(i.RENDERBUFFER,c),i.renderbufferStorageMultisample(i.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(s.type),s.width,s.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,c),s._MSAAFramebuffer=n,s._MSAARenderBuffer=c,s.samples=t,s._depthStencilBuffer=a,i.bindRenderbuffer(i.RENDERBUFFER,null),o.push(l)}i.drawBuffers(o)}else this.bindUnboundFramebuffer(e[__uv.$wrap((0))]._framebuffer);return this.bindUnboundFramebuffer(null),t},i.prototype._uploadCompressedDataToTextureDirectly=function(e,t,i,r,n,a,o){void 0===a&&(a=0),void 0===o&&(o=0);var s=this._gl,l=s.TEXTURE_2D;e.isCube&&(l=s.TEXTURE_CUBE_MAP_POSITIVE_X+a),this._gl.compressedTexImage2D(l,o,t,i,r,0,n)},i.prototype._uploadDataToTextureDirectly=function(t,i,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var a=this._gl,o=this._getWebGLTextureType(t.type),s=this._getInternalFormat(t.format),l=this._getRGBABufferInternalSizedFormat(t.type,s);this._unpackFlipY(t.invertY);var c=a.TEXTURE_2D;t.isCube&&(c=a.TEXTURE_CUBE_MAP_POSITIVE_X+r);var u=Math.round(e.Scalar.Log2(t.width)),h=Math.round(e.Scalar.Log2(t.height)),d=Math.pow(2,Math.max(u-n,0)),p=Math.pow(2,Math.max(h-n,0));a.texImage2D(c,n,l,d,p,0,s,o,i)},i.prototype._uploadArrayBufferViewToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=this._gl,a=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(a,e,!0),this._uploadDataToTextureDirectly(e,t,i,r),this._bindTextureDirectly(a,null,!0)},i.prototype._uploadImageToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=this._gl,a=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),s=this._getRGBABufferInternalSizedFormat(e.type,o),l=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(l,e,!0),this._unpackFlipY(e.invertY);var c=n.TEXTURE_2D;e.isCube&&(c=n.TEXTURE_CUBE_MAP_POSITIVE_X+i),n.texImage2D(c,r,s,o,a,t),this._bindTextureDirectly(l,null,!0)},i.prototype.createRenderTargetCubeTexture=function(t,r){var n=o({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:i.TEXTURETYPE_UNSIGNED_INT,samplingMode:i.TEXTURE_TRILINEAR_SAMPLINGMODE,format:i.TEXTUREFORMAT_RGBA},r);n.generateStencilBuffer=n.generateDepthBuffer&&n.generateStencilBuffer,(n.type!==i.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(n.type!==i.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=i.TEXTURE_NEAREST_SAMPLINGMODE);var a=this._gl,s=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,s,!0);var l=this._getSamplingParameters(n.samplingMode,n.generateMipMaps);n.type!==i.TEXTURETYPE_FLOAT||this._caps.textureFloat||(n.type=i.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,l.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,l.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(var c=0;c<6;c++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,this._getRGBABufferInternalSizedFormat(n.type,n.format),t,t,0,this._getInternalFormat(n.format),this._getWebGLTextureType(n.type),null);var u=a.createFramebuffer();return this.bindUnboundFramebuffer(u),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(n.generateStencilBuffer,n.generateDepthBuffer,t,t),n.generateMipMaps&&a.generateMipmap(a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),a.bindRenderbuffer(a.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),s._framebuffer=u,s.width=t,s.height=t,s.isReady=!0,s.isCube=!0,s.samples=1,s.generateMipMaps=n.generateMipMaps,s.samplingMode=n.samplingMode,s.type=n.type,s.format=n.format,s._generateDepthBuffer=n.generateDepthBuffer,s._generateStencilBuffer=n.generateStencilBuffer,this._internalTexturesCache.push(s),s},i.prototype.createPrefilteredCubeTexture=function(t,i,r,n,a,o,s,l,c){var u=this;void 0===a&&(a=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===c&&(c=!0);return this.createCubeTexture(t,i,null,!1,(function(t){if(t){var o=t.texture;if(c?t.info.sphericalPolynomial&&(o._sphericalPolynomial=t.info.sphericalPolynomial):o._sphericalPolynomial=new e.SphericalPolynomial,o._dataSource=e.InternalTexture.DATASOURCE_CUBEPREFILTERED,u._caps.textureLOD)a&&a(o);else{var s=u._gl,l=t.width;if(l){for(var h=[],d=0;d<3;d++){var p=1-d/2,m=n,_=e.Scalar.Log2(l)*r+n,f=m+(_-m)*p,g=Math.round(Math.min(Math.max(f,0),_)),y=new e.InternalTexture(u,e.InternalTexture.DATASOURCE_TEMP);if(y.type=o.type,y.format=o.format,y.width=Math.pow(2,Math.max(e.Scalar.Log2(l)-g,0)),y.height=y.width,y.isCube=!0,u._bindTextureDirectly(s.TEXTURE_CUBE_MAP,y,!0),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),t.isDDS){var v=t.info,b=t.data;u._unpackFlipY(v.isCompressed),e.DDSTools.UploadDDSLevels(u,y,b,v,!0,6,g)}else e.Tools.Warn("DDS is the only prefiltered cube map supported so far.");u._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null);var x=new e.BaseTexture(i);x.isCube=!0,x._texture=y,y.isReady=!0,h.push(x)}o._lodTextureHigh=h[__uv.$wrap((2))],o._lodTextureMid=h[__uv.$wrap((1))],o._lodTextureLow=h[__uv.$wrap((0))],a&&a(o)}}}else a&&a(null)}),o,s,l,c,r,n)},i.prototype.createCubeTexture=function(t,r,n,a,o,s,l,c,u,h,d,p){var m=this;void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=null),void 0===u&&(u=!1),void 0===h&&(h=0),void 0===d&&(d=0),void 0===p&&(p=null);var _=this._gl,f=p||new e.InternalTexture(this,e.InternalTexture.DATASOURCE_CUBE);f.isCube=!0,f.url=t,f.generateMipMaps=!a,f._lodGenerationScale=h,f._lodGenerationOffset=d,this._doNotHandleContextLost||(f._extension=c,f._files=n);for(var g=t.lastIndexOf("."),y=c||(g>-1?t.substring(g).toLowerCase():""),v=null,b=0,x=i._TextureLoaders;b<x.length;b++){var S=x[__uv.$wrap((b))];if(S.canLoad(y,this._textureFormatInUse,p,!1,!1)){v=S;break}}if(v){t=v.transformUrl(t,this._textureFormatInUse);var T=function(e){m._bindTextureDirectly(_.TEXTURE_CUBE_MAP,f,!0),v.loadCubeData(e,f,u,o,s)};n&&6===n.length?v.supportCascades?this._cascadeLoadFiles(r,T,n,s):s&&s("Textures type does not support cascades."):this._loadFile(t,T,void 0,void 0,!0,(function(e,i){if(v){var c=v.getFallbackTextureUrl(t,m._textureFormatInUse);c&&m.createCubeTexture(c,r,n,a,o,s,l,y,u,h,d,f)}s&&e&&s(e.status+" "+e.statusText,i)}))}else{if(!n)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(t,r,(function(t){var i=m.needPOTTextures?e.Tools.GetExponentOfTwo(t[__uv.$wrap((0))].width,m._caps.maxCubemapTextureSize):t[__uv.$wrap((0))].width,r=i;if(m._prepareWorkingCanvas(),m._workingCanvas&&m._workingContext){m._workingCanvas.width=i,m._workingCanvas.height=r;var n=[_.TEXTURE_CUBE_MAP_POSITIVE_X,_.TEXTURE_CUBE_MAP_POSITIVE_Y,_.TEXTURE_CUBE_MAP_POSITIVE_Z,_.TEXTURE_CUBE_MAP_NEGATIVE_X,_.TEXTURE_CUBE_MAP_NEGATIVE_Y,_.TEXTURE_CUBE_MAP_NEGATIVE_Z];m._bindTextureDirectly(_.TEXTURE_CUBE_MAP,f,!0),m._unpackFlipY(!1);for(var s=l?m._getInternalFormat(l):m._gl.RGBA,c=0;c<n.length;c++)m._workingContext.drawImage(t[__uv.$wrap((c))],0,0,t[__uv.$wrap((c))].width,t[__uv.$wrap((c))].height,0,0,i,r),_.texImage2D(n[__uv.$wrap((c))],0,s,s,_.UNSIGNED_BYTE,m._workingCanvas);a||_.generateMipmap(_.TEXTURE_CUBE_MAP),m._setCubeMapTextureParams(!a),f.width=i,f.height=r,f.isReady=!0,l&&(f.format=l),f.onLoadedObservable.notifyObservers(f),f.onLoadedObservable.clear(),o&&o()}}),n,s)}return this._internalTexturesCache.push(f),f},i.prototype._setCubeMapTextureParams=function(e){var t=this._gl;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)},i.prototype.updateRawCubeTexture=function(t,i,r,n,a,o,s){void 0===o&&(o=null),void 0===s&&(s=0),t._bufferViewArray=i,t.format=r,t.type=n,t.invertY=a,t._compression=o;var l=this._gl,c=this._getWebGLTextureType(n),u=this._getInternalFormat(r),h=this._getRGBABufferInternalSizedFormat(n),d=!1;u===l.RGB&&(u=l.RGBA,d=!0),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,t,!0),this._unpackFlipY(void 0===a||!!a),t.width%4!=0&&l.pixelStorei(l.UNPACK_ALIGNMENT,1);for(var p=0;p<6;p++){var m=i[__uv.$wrap((p))];o?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+p,s,this.getCaps().s3tc[__uv.$wrap((o))],t.width,t.height,0,m):(d&&(m=this._convertRGBtoRGBATextureData(m,t.width,t.height,n)),l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+p,s,h,t.width,t.height,0,u,c,m))}(!this.needPOTTextures||e.Tools.IsExponentOfTwo(t.width)&&e.Tools.IsExponentOfTwo(t.height))&&t.generateMipMaps&&0===s&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),t.isReady=!0},i.prototype.createRawCubeTexture=function(t,r,n,a,o,s,l,c){void 0===c&&(c=null);var u=this._gl,h=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_CUBERAW);h.isCube=!0,h.format=n,h.type=a,this._doNotHandleContextLost||(h._bufferViewArray=t);var d=this._getWebGLTextureType(a),p=this._getInternalFormat(n);p===u.RGB&&(p=u.RGBA),d!==u.FLOAT||this._caps.textureFloatLinearFiltering?d!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?d!==u.FLOAT||this._caps.textureFloatRender?d!==u.HALF_FLOAT||this._caps.colorBufferFloat||(o=!1,e.Tools.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(o=!1,e.Tools.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(o=!1,l=i.TEXTURE_NEAREST_SAMPLINGMODE,e.Tools.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(o=!1,l=i.TEXTURE_NEAREST_SAMPLINGMODE,e.Tools.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var m=r,_=m;h.width=m,h.height=_,!this.needPOTTextures||e.Tools.IsExponentOfTwo(h.width)&&e.Tools.IsExponentOfTwo(h.height)||(o=!1),t&&this.updateRawCubeTexture(h,t,n,a,s,c),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,h,!0),t&&o&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var f=this._getSamplingParameters(l,o);return u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MAG_FILTER,f.mag),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MIN_FILTER,f.min),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),this._bindTextureDirectly(u.TEXTURE_CUBE_MAP,null),h.generateMipMaps=o,h},i.prototype.createRawCubeTextureFromUrl=function(e,t,r,n,a,o,s,l,c,u,h,d){var p=this;void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=i.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===d&&(d=!1);var m=this._gl,_=this.createRawCubeTexture(null,r,n,a,!o,d,h);t._addPendingData(_),_.url=e,this._internalTexturesCache.push(_);return this._loadFile(e,(function(e){!function(e){var i=_.width,r=s(e);if(r){if(l){var o=p._getWebGLTextureType(a),u=p._getInternalFormat(n),h=p._getRGBABufferInternalSizedFormat(a),f=!1;u===m.RGB&&(u=m.RGBA,f=!0),p._bindTextureDirectly(m.TEXTURE_CUBE_MAP,_,!0),p._unpackFlipY(!1);for(var g=l(r),y=0;y<g.length;y++)for(var v=i>>y,b=0;b<6;b++){var x=g[__uv.$wrap((y))][__uv.$wrap((b))];f&&(x=p._convertRGBtoRGBATextureData(x,v,v,a)),m.texImage2D(b,y,h,v,v,0,u,o,x)}p._bindTextureDirectly(m.TEXTURE_CUBE_MAP,null)}else p.updateRawCubeTexture(_,r,n,a,d);_.isReady=!0,t._removePendingData(_),c&&c()}}(e)}),void 0,t.database,!0,(function(e,i){t._removePendingData(_),u&&e&&u(e.status+" "+e.statusText,i)})),_},i.prototype.updateRawTexture3D=function(e,t,r,n,a,o){void 0===a&&(a=null),void 0===o&&(o=i.TEXTURETYPE_UNSIGNED_INT);var s=this._getWebGLTextureType(o),l=this._getInternalFormat(r),c=this._getRGBABufferInternalSizedFormat(o,r);this._bindTextureDirectly(this._gl.TEXTURE_3D,e,!0),this._unpackFlipY(void 0===n||!!n),this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.invertY=n,e._compression=a),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),a&&t?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[__uv.$wrap((a))],e.width,e.height,e.depth,0,t):this._gl.texImage3D(this._gl.TEXTURE_3D,0,c,e.width,e.height,e.depth,0,l,s,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),e.isReady=!0},i.prototype.createRawTexture3D=function(t,r,n,a,o,s,l,c,u,h){void 0===u&&(u=null),void 0===h&&(h=i.TEXTURETYPE_UNSIGNED_INT);var d=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RAW3D);d.baseWidth=r,d.baseHeight=n,d.baseDepth=a,d.width=r,d.height=n,d.depth=a,d.format=o,d.type=h,d.generateMipMaps=s,d.samplingMode=c,d.is3D=!0,this._doNotHandleContextLost||(d._bufferView=t),this.updateRawTexture3D(d,t,o,l,u,h),this._bindTextureDirectly(this._gl.TEXTURE_3D,d,!0);var p=this._getSamplingParameters(c,s);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,p.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,p.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(d),d},i.prototype._prepareWebGLTextureContinuation=function(e,t,i,r,n){var a=this._gl;if(a){var o=this._getSamplingParameters(n,!i);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,o.mag),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,o.min),i||r||a.generateMipmap(a.TEXTURE_2D),this._bindTextureDirectly(a.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},i.prototype._prepareWebGLTexture=function(t,r,n,a,o,s,l,c,u){var h=this;void 0===u&&(u=i.TEXTURE_TRILINEAR_SAMPLINGMODE);var d=this.getCaps().maxTextureSize,p=Math.min(d,this.needPOTTextures?e.Tools.GetExponentOfTwo(n,d):n),m=Math.min(d,this.needPOTTextures?e.Tools.GetExponentOfTwo(a,d):a),_=this._gl;_&&(t._webGLTexture?(this._bindTextureDirectly(_.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===o||!!o),t.baseWidth=n,t.baseHeight=a,t.width=p,t.height=m,t.isReady=!0,c(p,m,(function(){h._prepareWebGLTextureContinuation(t,r,s,l,u)}))||this._prepareWebGLTextureContinuation(t,r,s,l,u)):r&&r._removePendingData(t))},i.prototype._convertRGBtoRGBATextureData=function(e,t,r,n){var a;a=n===i.TEXTURETYPE_FLOAT?new Float32Array(t*r*4):new Uint32Array(t*r*4);for(var o=0;o<t;o++)for(var s=0;s<r;s++){var l=3*(s*t+o),c=4*(s*t+o);a[__uv.$wrap((c+0))]=e[__uv.$wrap((l+0))],a[__uv.$wrap((c+1))]=e[__uv.$wrap((l+1))],a[__uv.$wrap((c+2))]=e[__uv.$wrap((l+2))],a[__uv.$wrap((c+3))]=1}return a},i.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},i.prototype._releaseTexture=function(e){var t=this._gl;this._releaseFramebufferObjects(e),t.deleteTexture(e._webGLTexture),this.unbindAllTextures();var i=this._internalTexturesCache.indexOf(e);-1!==i&&this._internalTexturesCache.splice(i,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),this.scenes.forEach((function(t){t.postProcesses.forEach((function(t){t._outputTexture==e&&(t._outputTexture=null)})),t.cameras.forEach((function(t){t._postProcesses.forEach((function(t){t&&t._outputTexture==e&&(t._outputTexture=null)}))}))}))},i.prototype.setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},i.prototype.bindSamplers=function(e){this.setProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var r=e.getUniform(t[__uv.$wrap((i))]);r&&(this._boundUniforms[__uv.$wrap((i))]=r)}this._currentEffect=null},i.prototype._moveBoundTextureOnTop=function(e){this.disableTextureBindingOptimization||this._lastBoundInternalTextureTracker.previous===e||(this._linkTrackers(e.previous,e.next),this._linkTrackers(this._lastBoundInternalTextureTracker.previous,e),this._linkTrackers(e,this._lastBoundInternalTextureTracker))},i.prototype._getCorrectTextureChannel=function(e,t){if(!t)return-1;if(t._initialSlot=e,this.disableTextureBindingOptimization)e!==t._designatedSlot&&this._textureCollisions.addCount(1,!1);else if(e!==t._designatedSlot)return t._designatedSlot>-1?t._designatedSlot:this._nextFreeTextureSlots.length?this._nextFreeTextureSlots[__uv.$wrap((0))]:(this._textureCollisions.addCount(1,!1),this._removeDesignatedSlot(this._firstBoundInternalTextureTracker.next));return e},i.prototype._linkTrackers=function(e,t){e.next=t,t.previous=e},i.prototype._removeDesignatedSlot=function(e){var t=e._designatedSlot;return-1===t?-1:(e._designatedSlot=-1,this.disableTextureBindingOptimization?-1:(this._linkTrackers(e.previous,e.next),this._boundTexturesCache[__uv.$wrap((t))]=null,this._nextFreeTextureSlots.push(t),t))},i.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},i.prototype._bindTextureDirectly=function(e,t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=!1;i&&t&&t._designatedSlot>-1&&(this._activeChannel=t._designatedSlot);var a=this._boundTexturesCache[__uv.$wrap((this._activeChannel))],o=t&&t._initialSlot>-1;if(a!==t||r){if(a&&this._removeDesignatedSlot(a),this._activateCurrentTexture(),this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[__uv.$wrap((this._activeChannel))]=t,t){if(!this.disableTextureBindingOptimization){var s=this._nextFreeTextureSlots.indexOf(this._activeChannel);s>-1&&this._nextFreeTextureSlots.splice(s,1),this._linkTrackers(this._lastBoundInternalTextureTracker.previous,t),this._linkTrackers(t,this._lastBoundInternalTextureTracker)}t._designatedSlot=this._activeChannel}}else i&&(n=!0,this._activateCurrentTexture());return o&&!i&&this._bindSamplerUniformToChannel(t._initialSlot,this._activeChannel),n},i.prototype._bindTexture=function(e,t){e<0||(t&&(e=this._getCorrectTextureChannel(e,t)),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},i.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[__uv.$wrap((t._currentRenderTextureInd))]:null)},i.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},i.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},i.prototype.setTexture=function(e,t,i){e<0||(t&&(this._boundUniforms[__uv.$wrap((e))]=t),this._setTexture(e,i))},i.prototype.setDepthStencilTexture=function(e,t,i){e<0||(t&&(this._boundUniforms[__uv.$wrap((e))]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0):this._setTexture(e,null))},i.prototype._bindSamplerUniformToChannel=function(e,t){var i=this._boundUniforms[__uv.$wrap((e))];i._currentState!==t&&(this._gl.uniform1i(i,t),i._currentState=t)},i.prototype._getTextureWrapMode=function(e){switch(e){case i.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case i.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case i.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},i.prototype._setTexture=function(e,t,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),!t)return null!=this._boundTexturesCache[__uv.$wrap((e))]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;if(t.video)this._activeChannel=e,t.update();else if(t.delayLoadState===i.DELAYLOADSTATE_NOTLOADED)return t.delayLoad(),!1;var a;a=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:this.emptyTexture,r||(e=this._getCorrectTextureChannel(e,a));var o=!0;if(this._boundTexturesCache[__uv.$wrap((e))]===a&&(this._moveBoundTextureOnTop(a),r||this._bindSamplerUniformToChannel(a._initialSlot,e),o=!1),this._activeChannel=e,a&&a.is3D)o&&this._bindTextureDirectly(this._gl.TEXTURE_3D,a,r),a&&a._cachedWrapU!==t.wrapU&&(a._cachedWrapU=t.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),a)),a&&a._cachedWrapV!==t.wrapV&&(a._cachedWrapV=t.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),a)),a&&a._cachedWrapR!==t.wrapR&&(a._cachedWrapR=t.wrapR,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),a)),this._setAnisotropicLevel(this._gl.TEXTURE_3D,t);else if(a&&a.isCube){if(o&&this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,a,r),a._cachedCoordinatesMode!==t.coordinatesMode){a._cachedCoordinatesMode=t.coordinatesMode;var s=t.coordinatesMode!==i.TEXTURE_CUBIC_MODE&&t.coordinatesMode!==i.TEXTURE_SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,s,a),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,s)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,t)}else o&&this._bindTextureDirectly(this._gl.TEXTURE_2D,a,r),a&&a._cachedWrapU!==t.wrapU&&(a._cachedWrapU=t.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),a)),a&&a._cachedWrapV!==t.wrapV&&(a._cachedWrapV=t.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),a)),this._setAnisotropicLevel(this._gl.TEXTURE_2D,t);return!0},i.prototype.setTextureArray=function(e,t,i){if(!(e<0)&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(var r=0;r<i.length;r++)this._textureUnits[__uv.$wrap((r))]=this._getCorrectTextureChannel(e+r,i[__uv.$wrap((r))].getInternalTexture());this._gl.uniform1iv(t,this._textureUnits);for(var n=0;n<i.length;n++)this._setTexture(this._textureUnits[__uv.$wrap((n))],i[__uv.$wrap((n))],!0)}},i.prototype._setAnisotropicLevel=function(e,t){var r=t.getInternalTexture();if(r){var n=this._caps.textureAnisotropicFilterExtension,a=t.anisotropicFilteringLevel;r.samplingMode!==i.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&r.samplingMode!==i.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&r.samplingMode!==i.TEXTURE_LINEAR_LINEAR&&(a=1),n&&r._cachedAnisotropicFilteringLevel!==a&&(this._setTextureParameterFloat(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a,this._caps.maxAnisotropy),r),r._cachedAnisotropicFilteringLevel=a)}},i.prototype._setTextureParameterFloat=function(e,t,i,r){this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameterf(e,t,i)},i.prototype._setTextureParameterInteger=function(e,t,i,r){r&&this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameteri(e,t,i)},i.prototype.readPixels=function(e,t,i,r){var n=new Uint8Array(r*i*4);return this._gl.readPixels(e,t,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},i.prototype.addExternalData=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.add(t,i)},i.prototype.getExternalData=function(t){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.get(t)},i.prototype.getOrAddExternalDataWithFactory=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.getOrAddWithFactory(t,i)},i.prototype.removeExternalData=function(t){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.remove(t)},i.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[__uv.$wrap((e))]=!1,this._currentBufferPointers[__uv.$wrap((e))].active=!1}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[__uv.$wrap((e))]||(this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[__uv.$wrap((e))]=!1,this._currentBufferPointers[__uv.$wrap((e))].active=!1)}},i.prototype.releaseEffects=function(){for(var e in this._compiledEffects)this._deleteProgram(this._compiledEffects[__uv.$wrap((e))]._program);this._compiledEffects={}},i.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.postProcesses.length;)this.postProcesses[__uv.$wrap((0))].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[__uv.$wrap((0))].dispose();1===i.Instances.length&&i.audioEngine&&i.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),e.Tools.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null));var t=i.Instances.indexOf(this);t>=0&&i.Instances.splice(t,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._bindedRenderFunction=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),e.Effect.ResetCache();for(var r=0,n=this._activeRequests;r<n.length;r++){n[__uv.$wrap((r))].abort()}},i.prototype.displayLoadingUI=function(){if(e.Tools.IsWindowObjectExist()){var t=this.loadingScreen;t&&t.displayLoadingUI()}},i.prototype.hideLoadingUI=function(){if(e.Tools.IsWindowObjectExist()){var t=this.loadingScreen;t&&t.hideLoadingUI()}},Object.defineProperty(i.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&e.DefaultLoadingScreen&&this._renderingCanvas&&(this._loadingScreen=new e.DefaultLoadingScreen(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),i.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},i.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},i.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[__uv.$wrap((0))]):null},i.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[__uv.$wrap((1))]):null},i.prototype.getError=function(){return this._gl.getError()},i.prototype.getFps=function(){return this._fps},i.prototype.getDeltaTime=function(){return this._deltaTime},i.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},i.prototype._readTexturePixels=function(e,t,i,r,n,a){void 0===r&&(r=-1),void 0===n&&(n=0),void 0===a&&(a=null);var o=this._gl;if(!this._dummyFramebuffer){var s=o.createFramebuffer();if(!s)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=s}o.bindFramebuffer(o.FRAMEBUFFER,this._dummyFramebuffer),r>-1?o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._webGLTexture,n):o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e._webGLTexture,n);var l=void 0!==e.type?this._getWebGLTextureType(e.type):o.UNSIGNED_BYTE;switch(l){case o.UNSIGNED_BYTE:a||(a=new Uint8Array(4*t*i)),l=o.UNSIGNED_BYTE;break;default:a||(a=new Float32Array(4*t*i)),l=o.FLOAT}return o.readPixels(0,0,t,i,o.RGBA,l,a),o.bindFramebuffer(o.FRAMEBUFFER,this._currentFramebuffer),a},i.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(i.TEXTURETYPE_FLOAT)},i.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(i.TEXTURETYPE_HALF_FLOAT)},i.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var i=!0,r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var a=t.checkFramebufferStatus(t.FRAMEBUFFER);if((i=(i=i&&a===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,s=t.UNSIGNED_BYTE,l=new Uint8Array(4);t.readPixels(0,0,1,1,o,s,l),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(r),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i},i.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case i.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case i.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case i.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE}return this._gl.UNSIGNED_BYTE}switch(e){case i.TEXTURETYPE_BYTE:return this._gl.BYTE;case i.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case i.TEXTURETYPE_SHORT:return this._gl.SHORT;case i.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case i.TEXTURETYPE_INT:return this._gl.INT;case i.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case i.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case i.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case i.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},i.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case i.TEXTUREFORMAT_ALPHA:t=this._gl.ALPHA;break;case i.TEXTUREFORMAT_LUMINANCE:t=this._gl.LUMINANCE;break;case i.TEXTUREFORMAT_LUMINANCE_ALPHA:t=this._gl.LUMINANCE_ALPHA;break;case i.TEXTUREFORMAT_RED:t=this._gl.RED;break;case i.TEXTUREFORMAT_RG:t=this._gl.RG;break;case i.TEXTUREFORMAT_RGB:t=this._gl.RGB;break;case i.TEXTUREFORMAT_RGBA:t=this._gl.RGBA}if(this._webGLVersion>1)switch(e){case i.TEXTUREFORMAT_RED_INTEGER:t=this._gl.RED_INTEGER;break;case i.TEXTUREFORMAT_RG_INTEGER:t=this._gl.RG_INTEGER;break;case i.TEXTUREFORMAT_RGB_INTEGER:t=this._gl.RGB_INTEGER;break;case i.TEXTUREFORMAT_RGBA_INTEGER:t=this._gl.RGBA_INTEGER}return t},i.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case i.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case i.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case i.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA}return this._gl.RGBA}switch(e){case i.TEXTURETYPE_BYTE:switch(t){case i.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case i.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case i.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case i.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case i.TEXTURETYPE_UNSIGNED_BYTE:switch(t){case i.TEXTUREFORMAT_RED:return this._gl.R8;case i.TEXTUREFORMAT_RG:return this._gl.RG8;case i.TEXTUREFORMAT_RGB:return this._gl.RGB8;case i.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case i.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;default:return this._gl.RGBA8}case i.TEXTURETYPE_SHORT:switch(t){case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case i.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case i.TEXTURETYPE_UNSIGNED_SHORT:switch(t){case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case i.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case i.TEXTURETYPE_INT:switch(t){case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case i.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case i.TEXTURETYPE_UNSIGNED_INTEGER:switch(t){case i.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case i.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case i.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case i.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case i.TEXTURETYPE_FLOAT:switch(t){case i.TEXTUREFORMAT_RED:return this._gl.R32F;case i.TEXTUREFORMAT_RG:return this._gl.RG32F;case i.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case i.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case i.TEXTURETYPE_HALF_FLOAT:switch(t){case i.TEXTUREFORMAT_RED:return this._gl.R16F;case i.TEXTUREFORMAT_RG:return this._gl.RG16F;case i.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case i.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(t){case i.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case i.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},i.prototype._getRGBAMultiSampleBufferFormat=function(e){return e===i.TEXTURETYPE_FLOAT?this._gl.RGBA32F:e===i.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},i.prototype._loadFile=function(t,i,r,n,a,o){var s=this,l=e.Tools.LoadFile(t,i,r,n,a,o);return this._activeRequests.push(l),l.onCompleteObservable.add((function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)})),l},i.prototype._loadFileAsync=function(e,t,i){var r=this;return new Promise((function(n,a){r._loadFile(e,(function(e){n(e)}),void 0,t,i,(function(e,t){a(t)}))}))},i.prototype._partialLoadFile=function(e,t,i,r,n,a){void 0===a&&(a=null);this._loadFile(e,(function(e){i[__uv.$wrap((t))]=e,i._internalCount++,6===i._internalCount&&n(i)}),void 0,void 0,!0,(function(e,t){a&&e&&a(e.status+" "+e.statusText,t)}))},i.prototype._cascadeLoadFiles=function(e,t,i,r){void 0===r&&(r=null);var n=[];n._internalCount=0;for(var a=0;a<6;a++)this._partialLoadFile(i[__uv.$wrap((a))],a,n,e,t,r)},i.isSupported=function(){try{var e=document.createElement("canvas");return null!=(e.getContext("webgl")||e.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(e){return!1}},i.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Macintosh",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]},{key:"iPhone",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]},{key:"iPad",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]}],i.Instances=new Array,i._TextureLoaders=[],i.ALPHA_DISABLE=0,i.ALPHA_ADD=1,i.ALPHA_COMBINE=2,i.ALPHA_SUBTRACT=3,i.ALPHA_MULTIPLY=4,i.ALPHA_MAXIMIZED=5,i.ALPHA_ONEONE=6,i.ALPHA_PREMULTIPLIED=7,i.ALPHA_PREMULTIPLIED_PORTERDUFF=8,i.ALPHA_INTERPOLATE=9,i.ALPHA_SCREENMODE=10,i.DELAYLOADSTATE_NONE=0,i.DELAYLOADSTATE_LOADED=1,i.DELAYLOADSTATE_LOADING=2,i.DELAYLOADSTATE_NOTLOADED=4,i.NEVER=512,i.ALWAYS=519,i.LESS=513,i.EQUAL=514,i.LEQUAL=515,i.GREATER=516,i.GEQUAL=518,i.NOTEQUAL=517,i.KEEP=7680,i.REPLACE=7681,i.INCR=7682,i.DECR=7683,i.INVERT=5386,i.INCR_WRAP=34055,i.DECR_WRAP=34056,i.TEXTURE_CLAMP_ADDRESSMODE=0,i.TEXTURE_WRAP_ADDRESSMODE=1,i.TEXTURE_MIRROR_ADDRESSMODE=2,i.TEXTUREFORMAT_ALPHA=0,i.TEXTUREFORMAT_LUMINANCE=1,i.TEXTUREFORMAT_LUMINANCE_ALPHA=2,i.TEXTUREFORMAT_RGB=4,i.TEXTUREFORMAT_RGBA=5,i.TEXTUREFORMAT_RED=6,i.TEXTUREFORMAT_R=6,i.TEXTUREFORMAT_RG=7,i.TEXTUREFORMAT_RED_INTEGER=8,i.TEXTUREFORMAT_R_INTEGER=8,i.TEXTUREFORMAT_RG_INTEGER=9,i.TEXTUREFORMAT_RGB_INTEGER=10,i.TEXTUREFORMAT_RGBA_INTEGER=11,i.TEXTURETYPE_UNSIGNED_BYTE=0,i.TEXTURETYPE_UNSIGNED_INT=0,i.TEXTURETYPE_FLOAT=1,i.TEXTURETYPE_HALF_FLOAT=2,i.TEXTURETYPE_BYTE=3,i.TEXTURETYPE_SHORT=4,i.TEXTURETYPE_UNSIGNED_SHORT=5,i.TEXTURETYPE_INT=6,i.TEXTURETYPE_UNSIGNED_INTEGER=7,i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,i.TEXTURETYPE_UNSIGNED_INT_24_8=12,i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,i.TEXTURE_NEAREST_SAMPLINGMODE=1,i.TEXTURE_BILINEAR_SAMPLINGMODE=2,i.TEXTURE_TRILINEAR_SAMPLINGMODE=3,i.TEXTURE_NEAREST_NEAREST_MIPLINEAR=1,i.TEXTURE_LINEAR_LINEAR_MIPNEAREST=2,i.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,i.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,i.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,i.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,i.TEXTURE_NEAREST_LINEAR=7,i.TEXTURE_NEAREST_NEAREST=8,i.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,i.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,i.TEXTURE_LINEAR_LINEAR=11,i.TEXTURE_LINEAR_NEAREST=12,i.TEXTURE_EXPLICIT_MODE=0,i.TEXTURE_SPHERICAL_MODE=1,i.TEXTURE_PLANAR_MODE=2,i.TEXTURE_CUBIC_MODE=3,i.TEXTURE_PROJECTION_MODE=4,i.TEXTURE_SKYBOX_MODE=5,i.TEXTURE_INVCUBIC_MODE=6,i.TEXTURE_EQUIRECTANGULAR_MODE=7,i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,i.SCALEMODE_FLOOR=1,i.SCALEMODE_NEAREST=2,i.SCALEMODE_CEILING=3,i.CollisionsEpsilon=.001,i.CodeRepository="src/",i.ShadersRepository="src/Shaders/",i}();e.Engine=s}(s||(s={})),function(e){var t=function(){function t(t,i){void 0===i&&(i=null),this.state="",this.metadata=null,this.doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this._childRenderId=-1,this._worldMatrix=e.Matrix.Identity(),this._worldMatrixDeterminant=0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this.onDisposeObservable=new e.Observable,this._behaviors=new Array,this.name=t,this.id=t,this._scene=i||e.Engine.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),this.addToSceneRootNodes()}return t.AddNodeConstructor=function(e,t){this._NodeConstructors[__uv.$wrap((e))]=t},t.Construct=function(e,t,i,r){var n=this._NodeConstructors[__uv.$wrap((e))];return n?n(t,i,r):null},t.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var i=this._parentNode._children.indexOf(this);-1!==i&&this._parentNode._children.splice(i,1),e||this.addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this.removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),t.prototype.addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},t.prototype.removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[__uv.$wrap((this._sceneRootNodesIndex))]=e[__uv.$wrap((t))],e[__uv.$wrap((this._sceneRootNodesIndex))]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Node"},Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.addBehavior=function(e,t){var i=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((function(){e.attach(i)})):e.attach(this),this._behaviors.push(e)),this},t.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[__uv.$wrap((t))].detach(),this._behaviors.splice(t,1)),this},Object.defineProperty(t.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),t.prototype.getBehaviorByName=function(e){for(var t=0,i=this._behaviors;t<i.length;t++){var r=i[__uv.$wrap((t))];if(r.name===e)return r}return null},t.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},t.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminant},Object.defineProperty(t.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),t.prototype._initCache=function(){this._cache={},this._cache.__uv$setSource(__uv).__uv$parent=void 0},t.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.__uv$setSource(__uv).__uv$parent=this.__uv$setSource(__uv).__uv$parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentRenderId=this._parentNode._childRenderId)},t.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentRenderId===this._parentNode._childRenderId&&this._parentNode.isSynchronized()},t.prototype.isSynchronized=function(){return this._cache.__uv$setSource(__uv).__uv$parent!=this._parentNode?(this._cache.__uv$setSource(__uv).__uv$parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},t.prototype.isReady=function(e){return void 0===e&&(e=!1),this._isReady},t.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},t.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((function(e){e._syncParentEnabledState()}))},t.prototype.setEnabled=function(e){this._isEnabled=e,this._syncParentEnabledState()},t.prototype.isDescendantOf=function(e){return!!this.__uv$setSource(__uv).__uv$parent&&(this.__uv$setSource(__uv).__uv$parent===e||this.__uv$setSource(__uv).__uv$parent.isDescendantOf(e))},t.prototype._getDescendants=function(e,t,i){if(void 0===t&&(t=!1),this._children)for(var r=0;r<this._children.length;r++){var n=this._children[__uv.$wrap((r))];i&&!i(n)||e.push(n),t||n._getDescendants(e,!1,i)}},t.prototype.getDescendants=function(e,t){var i=new Array;return this._getDescendants(i,e,t),i},t.prototype.getChildMeshes=function(t,i){var r=[];return this._getDescendants(r,t,(function(t){return(!i||i(t))&&t instanceof e.AbstractMesh})),r},t.prototype.getChildTransformNodes=function(t,i){var r=[];return this._getDescendants(r,t,(function(t){return(!i||i(t))&&t instanceof e.TransformNode})),r},t.prototype.getChildren=function(e){return this.getDescendants(!0,e)},t.prototype._setReady=function(e){e!==this._isReady&&(e?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},t.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var i=this.animations[__uv.$wrap((t))];if(i.name===e)return i}return null},t.prototype.createAnimationRange=function(t,i,r){if(!this._ranges[__uv.$wrap((t))]){this._ranges[__uv.$wrap((t))]=new e.AnimationRange(t,i,r);for(var n=0,a=this.animations.length;n<a;n++)this.animations[__uv.$wrap((n))]&&this.animations[__uv.$wrap((n))].createRange(t,i,r)}},t.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,r=this.animations.length;i<r;i++)this.animations[__uv.$wrap((i))]&&this.animations[__uv.$wrap((i))].deleteRange(e,t);this._ranges[__uv.$wrap((e))]=null},t.prototype.getAnimationRange=function(e){return this._ranges[__uv.$wrap((e))]},t.prototype.beginAnimation=function(e,t,i,r){var n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,i,r):null},t.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var i=this._ranges[__uv.$wrap((t))];if(i){var r={};r.name=t,r.from=i.from,r.to=i.to,e.push(r)}}return e},t.prototype.computeWorldMatrix=function(t){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},t.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),e)for(var i=0,r=this.getChildTransformNodes(!0);i<r.length;i++){var n=r[__uv.$wrap((i))];n.__uv$setSource(__uv).__uv$parent=null,n.computeWorldMatrix(!0)}else for(var a=0,o=this.getDescendants(!0);a<o.length;a++){o[__uv.$wrap((a))].dispose(e,t)}this.__uv$setSource(__uv).__uv$parent?this.__uv$setSource(__uv).__uv$parent=null:this.removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var s=0,l=this._behaviors;s<l.length;s++){l[__uv.$wrap((s))].detach()}this._behaviors=[],this._isDisposed=!0},t.ParseAnimationRanges=function(e,t,i){if(t.ranges)for(var r=0;r<t.ranges.length;r++){var n=t.ranges[__uv.$wrap((r))];e.createAnimationRange(n.name,n.from,n.to)}},t._NodeConstructors={},n([e.serialize()],t.prototype,"name",void 0),n([e.serialize()],t.prototype,"id",void 0),n([e.serialize()],t.prototype,"uniqueId",void 0),n([e.serialize()],t.prototype,"state",void 0),n([e.serialize()],t.prototype,"metadata",void 0),t}();e.Node=t}(s||(s={})),function(e){var t=e.Matrix.Identity(),i=function(){function i(t,i){this.center=e.Vector3.Zero(),this.centerWorld=e.Vector3.Zero(),this.minimum=e.Vector3.Zero(),this.maximum=e.Vector3.Zero(),this.reConstruct(t,i)}return i.prototype.reConstruct=function(i,r){this.minimum.copyFrom(i),this.maximum.copyFrom(r);var n=e.Vector3.Distance(i,r);e.Vector3.LerpToRef(i,r,.5,this.center),this.radius=.5*n,this.centerWorld.set(0,0,0),this._update(t)},i.prototype.scale=function(t){var i=this.radius*t,r=e.Tmp.Vector3[__uv.$wrap((0))].set(i,i,i),n=e.Tmp.Vector3[__uv.$wrap((1))].copyFrom(this.center).subtractInPlace(r),a=e.Tmp.Vector3[__uv.$wrap((2))].copyFrom(this.center).addInPlace(r);return this.reConstruct(n,a),this},i.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld);var i=e.Tmp.Vector3[__uv.$wrap((0))];e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,i),this.radiusWorld=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z))*this.radius},i.prototype.isInFrustum=function(e){for(var t=0;t<6;t++)if(e[__uv.$wrap((t))].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},i.prototype.intersectsPoint=function(e){var t=this.centerWorld.x-e.x,i=this.centerWorld.y-e.y,r=this.centerWorld.z-e.z,n=Math.sqrt(t*t+i*i+r*r);return!(this.radiusWorld<n)},i.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,r=e.centerWorld.y-t.centerWorld.y,n=e.centerWorld.z-t.centerWorld.z,a=Math.sqrt(i*i+r*r+n*n);return!(e.radiusWorld+t.radiusWorld<a)},i}();e.BoundingSphere=i}(s||(s={})),function(e){var t=function(){function t(t,i){this.vectors=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],this.center=e.Vector3.Zero(),this.centerWorld=e.Vector3.Zero(),this.extendSize=e.Vector3.Zero(),this.extendSizeWorld=e.Vector3.Zero(),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],this.vectorsWorld=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this.minimum=e.Vector3.Zero(),this.maximum=e.Vector3.Zero(),this.reConstruct(t,i)}return t.prototype.reConstruct=function(t,i){this.minimum.copyFrom(t),this.maximum.copyFrom(i),this.vectors[__uv.$wrap((0))].copyFrom(this.minimum),this.vectors[__uv.$wrap((1))].copyFrom(this.maximum),this.vectors[__uv.$wrap((2))].copyFrom(this.minimum),this.vectors[__uv.$wrap((3))].copyFrom(this.minimum),this.vectors[__uv.$wrap((4))].copyFrom(this.minimum),this.vectors[__uv.$wrap((5))].copyFrom(this.maximum),this.vectors[__uv.$wrap((6))].copyFrom(this.maximum),this.vectors[__uv.$wrap((7))].copyFrom(this.maximum),this.vectors[__uv.$wrap((2))].x=this.maximum.x,this.vectors[__uv.$wrap((3))].y=this.maximum.y,this.vectors[__uv.$wrap((4))].z=this.maximum.z,this.vectors[__uv.$wrap((5))].z=this.minimum.z,this.vectors[__uv.$wrap((6))].x=this.minimum.x,this.vectors[__uv.$wrap((7))].y=this.minimum.y,this.center.copyFrom(this.maximum).addInPlace(this.minimum).scaleInPlace(.5),this.extendSize.copyFrom(this.maximum).subtractInPlace(this.minimum).scaleInPlace(.5);for(var r=0;r<3;r++)this.directions[__uv.$wrap((r))].copyFromFloats(0,0,0);for(r=0;r<8;r++)this.vectorsWorld[__uv.$wrap((r))].copyFromFloats(0,0,0);this.minimumWorld.copyFromFloats(0,0,0),this.maximumWorld.copyFromFloats(0,0,0),this.centerWorld.copyFromFloats(0,0,0),this.extendSizeWorld.copyFromFloats(0,0,0),this._update(this._worldMatrix||e.Matrix.Identity())},t.prototype.scale=function(t){var i=e.Tmp.Vector3[__uv.$wrap((0))].copyFrom(this.maximum).subtractInPlace(this.minimum),r=i.length()*t;i.normalize();var n=i.scaleInPlace(.5*r),a=e.Tmp.Vector3[__uv.$wrap((1))].copyFrom(this.center).subtractInPlace(n),o=e.Tmp.Vector3[__uv.$wrap((2))].copyFrom(this.center).addInPlace(n);return this.reConstruct(a,o),this},t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype.setWorldMatrix=function(e){return this._worldMatrix.copyFrom(e),this},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<8;i++){var r=this.vectorsWorld[__uv.$wrap((i))];e.Vector3.TransformCoordinatesToRef(this.vectors[__uv.$wrap((i))],t,r),this.minimumWorld.minimizeInPlace(r),this.maximumWorld.maximizeInPlace(r)}this.maximumWorld.subtractToRef(this.minimumWorld,this.extendSizeWorld),this.extendSizeWorld.scaleInPlace(.5),this.maximumWorld.addToRef(this.minimumWorld,this.centerWorld),this.centerWorld.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[__uv.$wrap((0))]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[__uv.$wrap((1))]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[__uv.$wrap((2))]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t,i){var r=i?this.minimum:this.minimumWorld,n=i?this.maximum:this.maximumWorld,a=-e.Epsilon;return!(n.x-t.x<a||a>t.x-r.x)&&(!(n.y-t.y<a||a>t.y-r.y)&&!(n.z-t.z<a||a>t.z-r.z))},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return!(this.maximumWorld.x<e.x||this.minimumWorld.x>t.x)&&(!(this.maximumWorld.y<e.y||this.minimumWorld.y>t.y)&&!(this.maximumWorld.z<e.z||this.minimumWorld.z>t.z))},t.Intersects=function(e,t){return!(e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x)&&(!(e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y)&&!(e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z))},t.IntersectsSphere=function(t,i,r,n){var a=e.Vector3.Clamp(r,t,i);return e.Vector3.DistanceSquared(r,a)<=n*n},t.IsCompletelyInFrustum=function(e,t){for(var i=0;i<6;i++)for(var r=0;r<8;r++)if(t[__uv.$wrap((i))].dotCoordinate(e[__uv.$wrap((r))])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;i<6;i++){for(var r=8,n=0;n<8&&t[__uv.$wrap((i))].dotCoordinate(e[__uv.$wrap((n))])<0;n++)--r;if(0===r)return!1}return!0},t}();e.BoundingBox=t}(s||(s={})),function(e){var t=function(t,i){var r=e.Vector3.Dot(i.centerWorld,t),n=Math.abs(e.Vector3.Dot(i.directions[__uv.$wrap((0))],t))*i.extendSize.x+Math.abs(e.Vector3.Dot(i.directions[__uv.$wrap((1))],t))*i.extendSize.y+Math.abs(e.Vector3.Dot(i.directions[__uv.$wrap((2))],t))*i.extendSize.z;return{min:r-n,max:r+n}},i=function(e,i,r){var n,a,o,s,l=t(e,i),c=t(e,r);return n=l.min,a=l.max,o=c.min,s=c.max,!(n>s||o>a)},r=function(){function t(t,i){this._isLocked=!1,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return Object.defineProperty(t.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!0,configurable:!0}),t.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},t.prototype.centerOn=function(t,i){var r=e.Tmp.Vector3[__uv.$wrap((0))].copyFrom(t).subtractInPlace(i),n=e.Tmp.Vector3[__uv.$wrap((1))].copyFrom(t).addInPlace(i);return this.boundingBox.reConstruct(r,n),this.boundingSphere.reConstruct(r,n),this},t.prototype.scale=function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this},t.prototype.isInFrustum=function(t,i){return void 0===i&&(i=e.AbstractMesh.CULLINGSTRATEGY_STANDARD),!!this.boundingSphere.isInFrustum(t)&&(i===e.AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY||this.boundingBox.isInFrustum(t))},Object.defineProperty(t.prototype,"diagonalLength",{get:function(){var e=this.boundingBox;return e.maximumWorld.subtract(e.minimumWorld).length()},enumerable:!0,configurable:!0}),t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e,t){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e,t))},t.prototype.intersects=function(t,r){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!r)return!0;var n=this.boundingBox,a=t.boundingBox;return!!i(n.directions[__uv.$wrap((0))],n,a)&&(!!i(n.directions[__uv.$wrap((1))],n,a)&&(!!i(n.directions[__uv.$wrap((2))],n,a)&&(!!i(a.directions[__uv.$wrap((0))],n,a)&&(!!i(a.directions[__uv.$wrap((1))],n,a)&&(!!i(a.directions[__uv.$wrap((2))],n,a)&&(!!i(e.Vector3.Cross(n.directions[__uv.$wrap((0))],a.directions[__uv.$wrap((0))]),n,a)&&(!!i(e.Vector3.Cross(n.directions[__uv.$wrap((0))],a.directions[__uv.$wrap((1))]),n,a)&&(!!i(e.Vector3.Cross(n.directions[__uv.$wrap((0))],a.directions[__uv.$wrap((2))]),n,a)&&(!!i(e.Vector3.Cross(n.directions[__uv.$wrap((1))],a.directions[__uv.$wrap((0))]),n,a)&&(!!i(e.Vector3.Cross(n.directions[__uv.$wrap((1))],a.directions[__uv.$wrap((1))]),n,a)&&(!!i(e.Vector3.Cross(n.directions[__uv.$wrap((1))],a.directions[__uv.$wrap((2))]),n,a)&&(!!i(e.Vector3.Cross(n.directions[__uv.$wrap((2))],a.directions[__uv.$wrap((0))]),n,a)&&(!!i(e.Vector3.Cross(n.directions[__uv.$wrap((2))],a.directions[__uv.$wrap((1))]),n,a)&&!!i(e.Vector3.Cross(n.directions[__uv.$wrap((2))],a.directions[__uv.$wrap((2))]),n,a))))))))))))))},t}();e.BoundingInfo=r}(s||(s={})),function(e){var t=function(t){function i(r,n,a){void 0===n&&(n=null),void 0===a&&(a=!0);var o=t.call(this,r,n)||this;return o._forward=new e.Vector3(0,0,1),o._forwardInverted=new e.Vector3(0,0,-1),o._up=new e.Vector3(0,1,0),o._right=new e.Vector3(1,0,0),o._rightInverted=new e.Vector3(-1,0,0),o._position=e.Vector3.Zero(),o._rotation=e.Vector3.Zero(),o._scaling=e.Vector3.One(),o._isDirty=!1,o.billboardMode=i.BILLBOARDMODE_NONE,o.scalingDeterminant=1,o.infiniteDistance=!1,o.ignoreNonUniformScaling=!1,o._localWorld=e.Matrix.Zero(),o._absolutePosition=e.Vector3.Zero(),o._pivotMatrix=e.Matrix.Identity(),o._postMultiplyPivotMatrix=!1,o._isWorldMatrixFrozen=!1,o.onAfterWorldMatrixUpdateObservable=new e.Observable,o._nonUniformScaling=!1,a&&o.getScene().addTransformNode(o),o}return a(i,t),i.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"forward",{get:function(){return e.Vector3.Normalize(e.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"up",{get:function(){return e.Vector3.Normalize(e.Vector3.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return e.Vector3.Normalize(e.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),i.prototype.updatePoseMatrix=function(e){return this._poseMatrix.copyFrom(e),this},i.prototype.getPoseMatrix=function(){return this._poseMatrix},i.prototype._isSynchronized=function(){return!this._isDirty&&(this.billboardMode===this._cache.billboardMode&&this.billboardMode===i.BILLBOARDMODE_NONE&&(!this._cache.pivotMatrixUpdated&&(!this.infiniteDistance&&(!!this._cache.position.equals(this._position)&&(!(this._rotationQuaternion&&!this._cache.rotationQuaternion.equals(this._rotationQuaternion))&&(!!this._cache.rotation.equals(this._rotation)&&!!this._cache.scaling.equals(this._scaling)))))))},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0),this._cache.billboardMode=-1},i.prototype.markAsDirty=function(e){return"rotation"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(i.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},i.prototype.setPivotMatrix=function(t,i){return void 0===i&&(i=!0),this._pivotMatrix=t.clone(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=e.Matrix.Invert(this._pivotMatrix)),this},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},i.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(i.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(!t)return this;var i,r,n;if(void 0===t.x){if(arguments.length<3)return this;i=arguments[__uv.$wrap((0))],r=arguments[__uv.$wrap((1))],n=arguments[__uv.$wrap((2))]}else i=t.x,r=t.y,n=t.z;if(this.__uv$setSource(__uv).__uv$parent){var a=this.__uv$setSource(__uv).__uv$parent.getWorldMatrix().clone();a.invert();var o=new e.Vector3(i,r,n);this.position=e.Vector3.TransformCoordinates(o,a)}else this.position.x=i,this.position.y=r,this.position.z=n;return this},i.prototype.setPositionWithLocalVector=function(t){return this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld),this},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){return this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld),this},i.prototype.lookAt=function(t,r,n,a,o){void 0===r&&(r=0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===o&&(o=e.Space.LOCAL);var s=i._lookAtVectorCache,l=o===e.Space.LOCAL?this.position:this.getAbsolutePosition();t.subtractToRef(l,s);var c=-Math.atan2(s.z,s.x)-Math.PI/2,u=Math.sqrt(s.x*s.x+s.z*s.z),h=Math.atan2(s.y,u);return this.rotationQuaternion?e.Quaternion.RotationYawPitchRollToRef(c+r,h+n,a,this.rotationQuaternion):(this.rotation.x=h+n,this.rotation.y=c+r,this.rotation.z=a),this},i.prototype.getDirection=function(t){var i=e.Vector3.Zero();return this.getDirectionToRef(t,i),i},i.prototype.getDirectionToRef=function(t,i){return e.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),i),this},i.prototype.setPivotPoint=function(t,i){void 0===i&&(i=e.Space.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var r=this.getWorldMatrix();if(i==e.Space.WORLD){var n=e.Tmp.Matrix[__uv.$wrap((0))];r.invertToRef(n),t=e.Vector3.TransformCoordinates(t,n)}return this.setPivotMatrix(e.Matrix.Translation(-t.x,-t.y,-t.z),!0)},i.prototype.getPivotPoint=function(){var t=e.Vector3.Zero();return this.getPivotPointToRef(t),t},i.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[__uv.$wrap((12))],e.y=-this._pivotMatrix.m[__uv.$wrap((13))],e.z=-this._pivotMatrix.m[__uv.$wrap((14))],this},i.prototype.getAbsolutePivotPoint=function(){var t=e.Vector3.Zero();return this.getAbsolutePivotPointToRef(t),t},i.prototype.getAbsolutePivotPointToRef=function(t){return t.x=this._pivotMatrix.m[__uv.$wrap((12))],t.y=this._pivotMatrix.m[__uv.$wrap((13))],t.z=this._pivotMatrix.m[__uv.$wrap((14))],this.getPivotPointToRef(t),e.Vector3.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this},i.prototype.setParent=function(t){if(!t&&!this.__uv$setSource(__uv).__uv$parent)return this;if(t){n=e.Tmp.Quaternion[__uv.$wrap((0))],a=e.Tmp.Vector3[__uv.$wrap((0))],o=e.Tmp.Vector3[__uv.$wrap((1))];var i=e.Tmp.Matrix[__uv.$wrap((0))],r=e.Tmp.Matrix[__uv.$wrap((1))];this.computeWorldMatrix(!0),t.computeWorldMatrix(!0),t.getWorldMatrix().invertToRef(r),this.getWorldMatrix().multiplyToRef(r,i),i.decompose(o,n,a),this.rotationQuaternion?this.rotationQuaternion.copyFrom(n):n.toEulerAnglesToRef(this.rotation),this.position.x=a.x,this.position.y=a.y,this.position.z=a.z,this.scaling.x=o.x,this.scaling.y=o.y,this.scaling.z=o.z}else{var n=e.Tmp.Quaternion[__uv.$wrap((0))],a=e.Tmp.Vector3[__uv.$wrap((0))],o=e.Tmp.Vector3[__uv.$wrap((1))];this.__uv$setSource(__uv).__uv$parent&&this.__uv$setSource(__uv).__uv$parent.computeWorldMatrix&&this.__uv$setSource(__uv).__uv$parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(o,n,a),this.rotationQuaternion?this.rotationQuaternion.copyFrom(n):n.toEulerAnglesToRef(this.rotation),this.scaling.x=o.x,this.scaling.y=o.y,this.scaling.z=o.z,this.position.x=a.x,this.position.y=a.y,this.position.z=a.z}return this.__uv$setSource(__uv).__uv$parent=t,this},Object.defineProperty(i.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),i.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)},i.prototype.attachToBone=function(e,t){return this._transformToBoneReferal=t,this.__uv$setSource(__uv).__uv$parent=e,e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},i.prototype.detachFromBone=function(){return this.__uv$setSource(__uv).__uv$parent?(this.__uv$setSource(__uv).__uv$parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.__uv$setSource(__uv).__uv$parent=null,this):this},i.prototype.rotate=function(t,r,n){var a;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero()),n&&n!==e.Space.LOCAL){if(this.__uv$setSource(__uv).__uv$parent){var o=this.__uv$setSource(__uv).__uv$parent.getWorldMatrix().clone();o.invert(),t=e.Vector3.TransformNormal(t,o)}(a=e.Quaternion.RotationAxisToRef(t,r,i._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else a=e.Quaternion.RotationAxisToRef(t,r,i._rotationAxisCache),this.rotationQuaternion.multiplyToRef(a,this.rotationQuaternion);return this},i.prototype.rotateAround=function(t,i,r){return i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.copyFromFloats(0,0,0)),t.subtractToRef(this.position,e.Tmp.Vector3[__uv.$wrap((0))]),e.Matrix.TranslationToRef(e.Tmp.Vector3[__uv.$wrap((0))].x,e.Tmp.Vector3[__uv.$wrap((0))].y,e.Tmp.Vector3[__uv.$wrap((0))].z,e.Tmp.Matrix[__uv.$wrap((0))]),e.Tmp.Matrix[__uv.$wrap((0))].invertToRef(e.Tmp.Matrix[__uv.$wrap((2))]),e.Matrix.RotationAxisToRef(i,r,e.Tmp.Matrix[__uv.$wrap((1))]),e.Tmp.Matrix[__uv.$wrap((2))].multiplyToRef(e.Tmp.Matrix[__uv.$wrap((1))],e.Tmp.Matrix[__uv.$wrap((2))]),e.Tmp.Matrix[__uv.$wrap((2))].multiplyToRef(e.Tmp.Matrix[__uv.$wrap((0))],e.Tmp.Matrix[__uv.$wrap((2))]),e.Tmp.Matrix[__uv.$wrap((2))].decompose(e.Tmp.Vector3[__uv.$wrap((0))],e.Tmp.Quaternion[__uv.$wrap((0))],e.Tmp.Vector3[__uv.$wrap((1))]),this.position.addInPlace(e.Tmp.Vector3[__uv.$wrap((1))]),e.Tmp.Quaternion[__uv.$wrap((0))].multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},i.prototype.translate=function(t,i,r){var n=t.scale(i);if(r&&r!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var a=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(a)}return this},i.prototype.addRotation=function(t,i,r){var n;this.rotationQuaternion?n=this.rotationQuaternion:(n=e.Tmp.Quaternion[__uv.$wrap((1))],e.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,n));var a=e.Tmp.Quaternion[__uv.$wrap((0))];return e.Quaternion.RotationYawPitchRollToRef(i,t,r,a),n.multiplyInPlace(a),this.rotationQuaternion||n.toEulerAnglesToRef(this.rotation),this},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&this.isSynchronized())return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;(this._updateCache(),this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,e.Tmp.Matrix[__uv.$wrap((1))]),this.rotationQuaternion)&&(this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0)));this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(e.Tmp.Matrix[__uv.$wrap((0))]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,e.Tmp.Matrix[__uv.$wrap((0))]),this._cache.rotation.copyFrom(this.rotation));var r=this.getScene().activeCamera;if(this.infiniteDistance&&!this.__uv$setSource(__uv).__uv$parent&&r){var n=r.getWorldMatrix();e.Tmp.Vector3[__uv.$wrap((0))].set(n.m[__uv.$wrap((12))],n.m[__uv.$wrap((13))],n.m[__uv.$wrap((14))]),e.Matrix.TranslationToRef(this.position.x+e.Tmp.Vector3[__uv.$wrap((0))].x,this.position.y+e.Tmp.Vector3[__uv.$wrap((0))].y,this.position.z+e.Tmp.Vector3[__uv.$wrap((0))].z,e.Tmp.Matrix[__uv.$wrap((2))])}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,e.Tmp.Matrix[__uv.$wrap((2))]);if(this._pivotMatrix.multiplyToRef(e.Tmp.Matrix[__uv.$wrap((1))],e.Tmp.Matrix[__uv.$wrap((4))]),e.Tmp.Matrix[__uv.$wrap((4))].multiplyToRef(e.Tmp.Matrix[__uv.$wrap((0))],e.Tmp.Matrix[__uv.$wrap((5))]),this.billboardMode!==i.BILLBOARDMODE_NONE&&r){if((this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL){var a=e.Tmp.Vector3[__uv.$wrap((3))];this.__uv$setSource(__uv).__uv$parent&&this.__uv$setSource(__uv).__uv$parent.getWorldMatrix?this._transformToBoneReferal?(this.__uv$setSource(__uv).__uv$parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),e.Tmp.Matrix[__uv.$wrap((6))]),e.Vector3.TransformCoordinatesToRef(this.position,e.Tmp.Matrix[__uv.$wrap((6))],a)):e.Vector3.TransformCoordinatesToRef(this.position,this.__uv$setSource(__uv).__uv$parent.getWorldMatrix(),a):a.copyFrom(this.position),a.subtractInPlace(r.globalPosition);var o=e.Tmp.Vector3[__uv.$wrap((4))].copyFromFloats(0,0,0);(this.billboardMode&i.BILLBOARDMODE_X)===i.BILLBOARDMODE_X&&(o.x=Math.atan2(-a.y,a.z)),(this.billboardMode&i.BILLBOARDMODE_Y)===i.BILLBOARDMODE_Y&&(o.y=Math.atan2(a.x,a.z)),(this.billboardMode&i.BILLBOARDMODE_Z)===i.BILLBOARDMODE_Z&&(o.z=Math.atan2(a.y,a.x)),e.Matrix.RotationYawPitchRollToRef(o.y,o.x,o.z,e.Tmp.Matrix[__uv.$wrap((0))])}else e.Tmp.Matrix[__uv.$wrap((1))].copyFrom(r.getViewMatrix()),e.Tmp.Matrix[__uv.$wrap((1))].setTranslationFromFloats(0,0,0),e.Tmp.Matrix[__uv.$wrap((1))].invertToRef(e.Tmp.Matrix[__uv.$wrap((0))]);e.Tmp.Matrix[__uv.$wrap((1))].copyFrom(e.Tmp.Matrix[__uv.$wrap((5))]),e.Tmp.Matrix[__uv.$wrap((1))].multiplyToRef(e.Tmp.Matrix[__uv.$wrap((0))],e.Tmp.Matrix[__uv.$wrap((5))])}return this._postMultiplyPivotMatrix&&e.Tmp.Matrix[__uv.$wrap((5))].multiplyToRef(this._pivotMatrixInverse,e.Tmp.Matrix[__uv.$wrap((5))]),e.Tmp.Matrix[__uv.$wrap((5))].multiplyToRef(e.Tmp.Matrix[__uv.$wrap((2))],this._localWorld),this.__uv$setSource(__uv).__uv$parent&&this.__uv$setSource(__uv).__uv$parent.getWorldMatrix?(this.billboardMode!==i.BILLBOARDMODE_NONE?(this._transformToBoneReferal?(this.__uv$setSource(__uv).__uv$parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),e.Tmp.Matrix[__uv.$wrap((6))]),e.Tmp.Matrix[__uv.$wrap((5))].copyFrom(e.Tmp.Matrix[__uv.$wrap((6))])):e.Tmp.Matrix[__uv.$wrap((5))].copyFrom(this.__uv$setSource(__uv).__uv$parent.getWorldMatrix()),this._localWorld.getTranslationToRef(e.Tmp.Vector3[__uv.$wrap((5))]),e.Vector3.TransformCoordinatesToRef(e.Tmp.Vector3[__uv.$wrap((5))],e.Tmp.Matrix[__uv.$wrap((5))],e.Tmp.Vector3[__uv.$wrap((5))]),this._worldMatrix.copyFrom(this._localWorld),this._worldMatrix.setTranslation(e.Tmp.Vector3[__uv.$wrap((5))])):this._transformToBoneReferal?(this._localWorld.multiplyToRef(this.__uv$setSource(__uv).__uv$parent.getWorldMatrix(),e.Tmp.Matrix[__uv.$wrap((6))]),e.Tmp.Matrix[__uv.$wrap((6))].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.__uv$setSource(__uv).__uv$parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localWorld),this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this.scaling.isNonUniform?this._updateNonUniformScalingState(!0):this.__uv$setSource(__uv).__uv$parent&&this.__uv$setSource(__uv).__uv$parent._nonUniformScaling?this._updateNonUniformScalingState(this.__uv$setSource(__uv).__uv$parent._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[__uv.$wrap((12))],this._worldMatrix.m[__uv.$wrap((13))],this._worldMatrix.m[__uv.$wrap((14))]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=e.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix},i.prototype._afterComputeWorldMatrix=function(){},i.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},i.prototype.clone=function(t,r,n){var a=this,o=e.SerializationHelper.Clone((function(){return new i(t,a.getScene())}),this);if(o.name=t,o.id=t,r&&(o.__uv$setSource(__uv).__uv$parent=r),!n)for(var s=this.getDescendants(!0),l=0;l<s.length;l++){var c=s[__uv.$wrap((l))];c.clone&&c.clone(t+"."+c.name,o)}return o},i.prototype.serialize=function(t){var i=e.SerializationHelper.Serialize(this,t);return i.type=this.getClassName(),this.__uv$setSource(__uv).__uv$parent&&(i.parentId=this.__uv$setSource(__uv).__uv$parent.id),e.Tags&&e.Tags.HasTags(this)&&(i.tags=e.Tags.GetTags(this)),i.localMatrix=this.getPivotMatrix().asArray(),i.isEnabled=this.isEnabled(),this.__uv$setSource(__uv).__uv$parent&&(i.parentId=this.__uv$setSource(__uv).__uv$parent.id),i},i.Parse=function(t,r,n){var a=e.SerializationHelper.Parse((function(){return new i(t.name,r)}),t,r,n);return e.Tags&&e.Tags.AddTagsTo(a,t.tags),t.localMatrix?a.setPreTransformMatrix(e.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),t.parentId&&(a._waitingParentId=t.parentId),a},i.prototype.dispose=function(e,i){void 0===i&&(i=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),t.prototype.dispose.call(this,e,i)},i.BILLBOARDMODE_NONE=0,i.BILLBOARDMODE_X=1,i.BILLBOARDMODE_Y=2,i.BILLBOARDMODE_Z=4,i.BILLBOARDMODE_ALL=7,i._lookAtVectorCache=new e.Vector3(0,0,0),i._rotationAxisCache=new e.Quaternion,n([e.serializeAsVector3("position")],i.prototype,"_position",void 0),n([e.serializeAsVector3("rotation")],i.prototype,"_rotation",void 0),n([e.serializeAsQuaternion("rotationQuaternion")],i.prototype,"_rotationQuaternion",void 0),n([e.serializeAsVector3("scaling")],i.prototype,"_scaling",void 0),n([e.serialize()],i.prototype,"billboardMode",void 0),n([e.serialize()],i.prototype,"scalingDeterminant",void 0),n([e.serialize()],i.prototype,"infiniteDistance",void 0),n([e.serialize()],i.prototype,"ignoreNonUniformScaling",void 0),i}(e.Node);e.TransformNode=t}(s||(s={})),function(e){var t=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=e.Vector3.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},i=function(i){function r(n,a){void 0===a&&(a=null);var o=i.call(this,n,a,!1)||this;return o._facetData=new t,o.cullingStrategy=r.CULLINGSTRATEGY_STANDARD,o.onCollideObservable=new e.Observable,o.onCollisionPositionChangeObservable=new e.Observable,o.onMaterialChangedObservable=new e.Observable,o.definedFacingForward=!0,o._visibility=1,o.alphaIndex=Number.MAX_VALUE,o.isVisible=!0,o.isPickable=!0,o.showSubMeshesBoundingBox=!1,o.isBlocker=!1,o.enablePointerMoveEvents=!1,o.renderingGroupId=0,o._receiveShadows=!1,o.outlineColor=e.Color3.Red(),o.outlineWidth=.02,o.overlayColor=e.Color3.Red(),o.overlayAlpha=.5,o._hasVertexAlpha=!1,o._useVertexColors=!0,o._computeBonesUsingShaders=!0,o._numBoneInfluencers=4,o._applyFog=!0,o.useOctreeForRenderingSelection=!0,o.useOctreeForPicking=!0,o.useOctreeForCollisions=!0,o._layerMask=268435455,o.alwaysSelectAsActiveMesh=!1,o.actionManager=null,o._checkCollisions=!1,o._collisionMask=-1,o._collisionGroup=-1,o.ellipsoid=new e.Vector3(.5,1,.5),o.ellipsoidOffset=new e.Vector3(0,0,0),o._oldPositionForCollisions=new e.Vector3(0,0,0),o._diffPositionForCollisions=new e.Vector3(0,0,0),o.edgesWidth=1,o.edgesColor=new e.Color4(1,0,0,1),o._renderId=0,o._intersectionsInProgress=new Array,o._unIndexed=!1,o._lightSources=new Array,o.onRebuildObservable=new e.Observable,o._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider._radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions),r&&o.onCollideObservable.notifyObservers(r),o.onCollisionPositionChangeObservable.notifyObservers(o.position)},o.getScene().addMesh(o),o._resyncLightSources(),o}return a(r,i),Object.defineProperty(r,"BILLBOARDMODE_NONE",{get:function(){return e.TransformNode.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BILLBOARDMODE_X",{get:function(){return e.TransformNode.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BILLBOARDMODE_Y",{get:function(){return e.TransformNode.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BILLBOARDMODE_Z",{get:function(){return e.TransformNode.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BILLBOARDMODE_ALL",{get:function(){return e.TransformNode.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"facetNb",{get:function(){return this._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"partitioningSubdivisions",{get:function(){return this._facetData.partitioningSubdivisions},set:function(e){this._facetData.partitioningSubdivisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"partitioningBBoxRatio",{get:function(){return this._facetData.partitioningBBoxRatio},set:function(e){this._facetData.partitioningBBoxRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mustDepthSortFacets",{get:function(){return this._facetData.facetDepthSort},set:function(e){this._facetData.facetDepthSort=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"facetDepthSortFrom",{get:function(){return this._facetData.facetDepthSortFrom},set:function(e){this._facetData.facetDepthSortFrom=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFacetDataEnabled",{get:function(){return this._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),r.prototype._updateNonUniformScalingState=function(e){return!!i.prototype._updateNonUniformScalingState.call(this,e)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(r.prototype,"onCollide",{set:function(e){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver),this._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onCollisionPositionChange",{set:function(e){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver),this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visibility",{get:function(){return this._visibility},set:function(e){this._visibility!==e&&(this._visibility=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"material",{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,this.onMaterialChangedObservable.hasObservers&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(e){this._receiveShadows!==e&&(this._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasVertexAlpha",{get:function(){return this._hasVertexAlpha},set:function(e){this._hasVertexAlpha!==e&&(this._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useVertexColors",{get:function(){return this._useVertexColors},set:function(e){this._useVertexColors!==e&&(this._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"computeBonesUsingShaders",{get:function(){return this._computeBonesUsingShaders},set:function(e){this._computeBonesUsingShaders!==e&&(this._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numBoneInfluencers",{get:function(){return this._numBoneInfluencers},set:function(e){this._numBoneInfluencers!==e&&(this._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"applyFog",{get:function(){return this._applyFog},set:function(e){this._applyFog!==e&&(this._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layerMask",{get:function(){return this._layerMask},set:function(e){e!==this._layerMask&&(this._layerMask=e,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"collisionGroup",{get:function(){return this._collisionGroup},set:function(e){this._collisionGroup=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skeleton",{get:function(){return this._skeleton},set:function(e){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._skeleton=e,this._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"AbstractMesh"},r.prototype.toString=function(t){var i="Name: "+this.name+", isInstance: "+(this instanceof e.InstancedMesh?"YES":"NO");return i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(i+=", skeleton: "+this._skeleton.name),t&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][__uv.$wrap((this.billboardMode))],i+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),i},r.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++){t[__uv.$wrap((e))]._rebuild()}},r.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var e=0,t=this.getScene().lights;e<t.length;e++){var i=t[__uv.$wrap((e))];i.isEnabled()&&(i.canAffectMesh(this)&&this._lightSources.push(i))}this._markSubMeshesAsLightDirty()},r.prototype._resyncLighSource=function(e){var t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);if(-1===i){if(!t)return;this._lightSources.push(e)}else{if(t)return;this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty()},r.prototype._unBindEffect=function(){for(var e=0,t=this.subMeshes;e<t.length;e++){t[__uv.$wrap((e))].setEffect(null)}},r.prototype._removeLightSource=function(e){var t=this._lightSources.indexOf(e);-1!==t&&(this._lightSources.splice(t,1),this._markSubMeshesAsLightDirty())},r.prototype._markSubMeshesAsDirty=function(e){if(this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;t++){var r=i[__uv.$wrap((t))];r._materialDefines&&e(r._materialDefines)}},r.prototype._markSubMeshesAsLightDirty=function(){this._markSubMeshesAsDirty((function(e){return e.markAsLightDirty()}))},r.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty((function(e){return e.markAsAttributesDirty()}))},r.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;t++){var r=i[__uv.$wrap((t))].getMaterial();r&&r.markAsDirty(e.Material.MiscDirtyFlag)}},Object.defineProperty(r.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),r.prototype.getLOD=function(e){return this},r.prototype.getTotalVertices=function(){return 0},r.prototype.getIndices=function(){return null},r.prototype.getVerticesData=function(e){return null},r.prototype.setVerticesData=function(e,t,i,r){return this},r.prototype.updateVerticesData=function(e,t,i,r){return this},r.prototype.setIndices=function(e,t){return this},r.prototype.isVerticesDataPresent=function(e){return!1},r.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},r.prototype.normalizeToUnitCube=function(e){void 0===e&&(e=!0);var t=this.getHierarchyBoundingVectors(e),i=t.max.subtract(t.min),r=Math.max(i.x,i.y,i.z);if(0===r)return this;var n=1/r;return this.scaling.scaleInPlace(n),this},r.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(r.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),r.prototype._preActivate=function(){},r.prototype._preActivateForIntermediateRendering=function(e){},r.prototype._activate=function(e){this._renderId=e},r.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():i.prototype.getWorldMatrix.call(this)},r.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():i.prototype._getWorldMatrixDeterminant.call(this)},r.prototype.movePOV=function(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this},r.prototype.calcMovePOV=function(t,i,r){var n=new e.Matrix;(this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(n);var a=e.Vector3.Zero(),o=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*o,i,r*o,n,a),a},r.prototype.rotatePOV=function(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this},r.prototype.calcRotatePOV=function(t,i,r){var n=this.definedFacingForward?1:-1;return new e.Vector3(t*n,i,r*n)},r.prototype.getHierarchyBoundingVectors=function(t,i){var r,n;void 0===t&&(t=!0),void 0===i&&(i=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var a=this.getBoundingInfo();if(this.subMeshes?(r=a.boundingBox.minimumWorld,n=a.boundingBox.maximumWorld):(r=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)),t)for(var o=0,s=this.getDescendants(!1);o<s.length;o++){var l=s[__uv.$wrap((o))];if(l.computeWorldMatrix(!0),(!i||i(l))&&l.getBoundingInfo&&0!==l.getTotalVertices()){var c=l.getBoundingInfo().boundingBox,u=c.minimumWorld,h=c.maximumWorld;e.Tools.CheckExtends(u,r,n),e.Tools.CheckExtends(h,r,n)}}return{min:r,max:n}},r.prototype._updateBoundingInfo=function(){return this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo.update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},r.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var t=this.subMeshes.length,i=0;i<t;i++){var r=this.subMeshes[__uv.$wrap((i))];(t>1||!r.IsGlobal)&&r.updateBoundingInfo(e)}return this},r.prototype._afterComputeWorldMatrix=function(){this._updateBoundingInfo()},r.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},r.prototype.isCompletelyInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(e)},r.prototype.intersectsMesh=function(e,t,i){if(void 0===t&&(t=!1),!this._boundingInfo||!e._boundingInfo)return!1;if(this._boundingInfo.intersects(e._boundingInfo,t))return this;if(i)for(var r=0,n=this.getChildMeshes();r<n.length;r++){var a=n[__uv.$wrap((r))];if(a.intersectsMesh(e,t,!0))return a}return!1},r.prototype.intersectsPoint=function(e,t){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(e,t)},r.prototype.getPositionInCameraSpace=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},r.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},Object.defineProperty(r.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"collider",{get:function(){return this._collider},enumerable:!0,configurable:!0}),r.prototype.moveWithCollisions=function(t){return this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._oldPositionForCollisions),this._collider||(this._collider=new e.Collider),this._collider._radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,t,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},r.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,a=t.verticesStart+t.verticesCount,o=n;o<a;o++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[__uv.$wrap((o))],i))}return r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),r.collisionFound&&(r.collidedMesh=this),this},r.prototype._processCollisionsForSubMeshes=function(e,t){for(var i=this._scene.getCollidingSubMeshCandidates(this,e),r=i.length,n=0;n<r;n++){var a=i.data[__uv.$wrap((n))];r>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}return this},r.prototype._checkCollision=function(t){if(!this._boundingInfo||!this._boundingInfo._checkCollision(t))return this;var i=e.Tmp.Matrix[__uv.$wrap((0))],r=e.Tmp.Matrix[__uv.$wrap((1))];return e.Matrix.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,i),this.worldMatrixFromCache.multiplyToRef(i,r),this._processCollisionsForSubMeshes(t,r),this},r.prototype._generatePointsArray=function(){return!1},r.prototype.intersects=function(t,i){var r=new e.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&t.intersectsSphere(this._boundingInfo.boundingSphere)&&t.intersectsBox(this._boundingInfo.boundingBox)))return r;if(!this._generatePointsArray())return r;for(var n=null,a=this._scene.getIntersectingSubMeshCandidates(this,t),o=a.length,s=0;s<o;s++){var l=a.data[__uv.$wrap((s))];if(!(o>1)||l.canIntersects(t)){var c=l.intersects(t,this._positions,this.getIndices(),i);if(c&&(i||!n||c.distance<n.distance)&&((n=c).subMeshId=s,i))break}}if(n){var u=this.getWorldMatrix(),h=e.Vector3.TransformCoordinates(t.origin,u),d=t.direction.clone();d=d.scale(n.distance);var p=e.Vector3.TransformNormal(d,u),m=h.add(p);return r.hit=!0,r.distance=e.Vector3.Distance(h,m),r.pickedPoint=m,r.pickedMesh=this,r.bu=n.bu||0,r.bv=n.bv||0,r.faceId=n.faceId,r.subMeshId=n.subMeshId,r}return r},r.prototype.clone=function(e,t,i){return null},r.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[__uv.$wrap((0))].dispose();else this.subMeshes=new Array;return this},r.prototype.dispose=function(e,t){var r,n=this;for(void 0===t&&(t=!1),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._skeleton=null,r=0;r<this._intersectionsInProgress.length;r++){var a=this._intersectionsInProgress[__uv.$wrap((r))],o=a._intersectionsInProgress.indexOf(this);a._intersectionsInProgress.splice(o,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach((function(e){var t=e.includedOnlyMeshes.indexOf(n);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(n))&&e.excludedMeshes.splice(t,1);var i=e.getShadowGenerator();if(i){var r=i.getShadowMap();r&&r.renderList&&-1!==(t=r.renderList.indexOf(n))&&r.renderList.splice(t,1)}})),"InstancedMesh"!==this.getClassName()&&this.releaseSubMeshes();var s=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),this.getScene().removeMesh(this),t&&this.material&&this.material.dispose(!1,!0),!e)for(r=0;r<this.getScene().particleSystems.length;r++)this.getScene().particleSystems[__uv.$wrap((r))].emitter===this&&(this.getScene().particleSystems[__uv.$wrap((r))].dispose(),r--);this._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),i.prototype.dispose.call(this,e,t)},r.prototype.addChild=function(e){return e.setParent(this),this},r.prototype.removeChild=function(e){return e.setParent(null),this},r.prototype._initFacetData=function(){var t=this._facetData;t.facetNormals||(t.facetNormals=new Array),t.facetPositions||(t.facetPositions=new Array),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(var i=0;i<t.facetNb;i++)t.facetNormals[__uv.$wrap((i))]=e.Vector3.Zero(),t.facetPositions[__uv.$wrap((i))]=e.Vector3.Zero();return t.facetDataEnabled=!0,this},r.prototype.updateFacetData=function(){var t=this._facetData;t.facetDataEnabled||this._initFacetData();var i=this.getVerticesData(e.VertexBuffer.PositionKind),r=this.getIndices(),n=this.getVerticesData(e.VertexBuffer.NormalKind),a=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,r instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(r);else if(r instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(r);else{for(var o=!1,s=0;s<r.length;s++)if(r[__uv.$wrap((s))]>65535){o=!0;break}t.depthSortedIndices=o?new Uint32Array(r):new Uint16Array(r)}if(t.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!t.facetDepthSortFrom){var l=this.getScene().activeCamera;t.facetDepthSortFrom=l?l.position:e.Vector3.Zero()}t.depthSortedFacets=[];for(var c=0;c<t.facetNb;c++){var u={ind:3*c,sqDistance:0};t.depthSortedFacets.push(u)}t.invertedMatrix=e.Matrix.Identity(),t.facetDepthSortOrigin=e.Vector3.Zero()}t.bbSize.x=a.maximum.x-a.minimum.x>e.Epsilon?a.maximum.x-a.minimum.x:e.Epsilon,t.bbSize.y=a.maximum.y-a.minimum.y>e.Epsilon?a.maximum.y-a.minimum.y:e.Epsilon,t.bbSize.z=a.maximum.z-a.minimum.z>e.Epsilon?a.maximum.z-a.minimum.z:e.Epsilon;var h=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(h=h>t.bbSize.z?h:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/h),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/h),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/h),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=a,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),e.Vector3.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,e.VertexData.ComputeNormals(i,r,n,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);var d=t.depthSortedIndices.length/3|0;for(c=0;c<d;c++){var p=t.depthSortedFacets[__uv.$wrap((c))].ind;t.depthSortedIndices[__uv.$wrap((3*c))]=r[__uv.$wrap((p))],t.depthSortedIndices[__uv.$wrap((3*c+1))]=r[__uv.$wrap((p+1))],t.depthSortedIndices[__uv.$wrap((3*c+2))]=r[__uv.$wrap((p+2))]}this.updateIndices(t.depthSortedIndices)}return this},r.prototype.getFacetLocalNormals=function(){return this._facetData.facetNormals||this.updateFacetData(),this._facetData.facetNormals},r.prototype.getFacetLocalPositions=function(){return this._facetData.facetPositions||this.updateFacetData(),this._facetData.facetPositions},r.prototype.getFacetLocalPartitioning=function(){return this._facetData.facetPartitioning||this.updateFacetData(),this._facetData.facetPartitioning},r.prototype.getFacetPosition=function(t){var i=e.Vector3.Zero();return this.getFacetPositionToRef(t,i),i},r.prototype.getFacetPositionToRef=function(t,i){var r=this.getFacetLocalPositions()[__uv.$wrap((t))],n=this.getWorldMatrix();return e.Vector3.TransformCoordinatesToRef(r,n,i),this},r.prototype.getFacetNormal=function(t){var i=e.Vector3.Zero();return this.getFacetNormalToRef(t,i),i},r.prototype.getFacetNormalToRef=function(t,i){var r=this.getFacetLocalNormals()[__uv.$wrap((t))];return e.Vector3.TransformNormalToRef(r,this.getWorldMatrix(),i),this},r.prototype.getFacetsAtLocalCoordinates=function(e,t,i){var r=this.getBoundingInfo(),n=this._facetData,a=Math.floor((e-r.minimum.x*n.partitioningBBoxRatio)*n.subDiv.X*n.partitioningBBoxRatio/n.bbSize.x),o=Math.floor((t-r.minimum.y*n.partitioningBBoxRatio)*n.subDiv.Y*n.partitioningBBoxRatio/n.bbSize.y),s=Math.floor((i-r.minimum.z*n.partitioningBBoxRatio)*n.subDiv.Z*n.partitioningBBoxRatio/n.bbSize.z);return a<0||a>n.subDiv.max||o<0||o>n.subDiv.max||s<0||s>n.subDiv.max?null:n.facetPartitioning[__uv.$wrap((a+n.subDiv.max*o+n.subDiv.max*n.subDiv.max*s))]},r.prototype.getClosestFacetAtCoordinates=function(t,i,r,n,a,o){void 0===a&&(a=!1),void 0===o&&(o=!0);var s=this.getWorldMatrix(),l=e.Tmp.Matrix[__uv.$wrap((5))];s.invertToRef(l);var c=e.Tmp.Vector3[__uv.$wrap((8))];e.Vector3.TransformCoordinatesFromFloatsToRef(t,i,r,l,c);var u=this.getClosestFacetAtLocalCoordinates(c.x,c.y,c.z,n,a,o);return n&&e.Vector3.TransformCoordinatesFromFloatsToRef(n.x,n.y,n.z,s,n),u},r.prototype.getClosestFacetAtLocalCoordinates=function(e,t,i,r,n,a){void 0===n&&(n=!1),void 0===a&&(a=!0);var o=null,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,_=this.getFacetLocalPositions(),f=this.getFacetLocalNormals(),g=this.getFacetsAtLocalCoordinates(e,t,i);if(!g)return null;for(var y,v,b,x=Number.MAX_VALUE,S=x,T=0;T<g.length;T++)v=f[__uv.$wrap((y=g[__uv.$wrap((T))]))],u=(e-(b=_[__uv.$wrap((y))]).x)*v.x+(t-b.y)*v.y+(i-b.z)*v.z,(!n||n&&a&&u>=0||n&&!a&&u<=0)&&(u=v.x*b.x+v.y*b.y+v.z*b.z,h=-(v.x*e+v.y*t+v.z*i-u)/(v.x*v.x+v.y*v.y+v.z*v.z),(S=(s=(d=e+v.x*h)-e)*s+(l=(p=t+v.y*h)-t)*l+(c=(m=i+v.z*h)-i)*c)<x&&(x=S,o=y,r&&(r.x=d,r.y=p,r.z=m)));return o},r.prototype.getFacetDataParameters=function(){return this._facetData.facetParameters},r.prototype.disableFacetData=function(){return this._facetData.facetDataEnabled&&(this._facetData.facetDataEnabled=!1,this._facetData.facetPositions=new Array,this._facetData.facetNormals=new Array,this._facetData.facetPartitioning=new Array,this._facetData.facetParameters=null,this._facetData.depthSortedIndices=new Uint32Array(0)),this},r.prototype.updateIndices=function(e){return this},r.prototype.createNormals=function(t){var i,r=this.getVerticesData(e.VertexBuffer.PositionKind),n=this.getIndices();return i=this.isVerticesDataPresent(e.VertexBuffer.NormalKind)?this.getVerticesData(e.VertexBuffer.NormalKind):[],e.VertexData.ComputeNormals(r,n,i,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(e.VertexBuffer.NormalKind,i,t),this},r.prototype.alignWithNormal=function(t,i){i||(i=e.Axis.Y);var r=e.Tmp.Vector3[__uv.$wrap((0))],n=e.Tmp.Vector3[__uv.$wrap((1))];return e.Vector3.CrossToRef(i,t,n),e.Vector3.CrossToRef(t,n,r),this.rotationQuaternion?e.Quaternion.RotationQuaternionFromAxisToRef(r,t,n,this.rotationQuaternion):e.Vector3.RotationFromAxisToRef(r,t,n,this.rotation),this},r.prototype._checkOcclusionQuery=function(){return!1},r.OCCLUSION_TYPE_NONE=0,r.OCCLUSION_TYPE_OPTIMISTIC=1,r.OCCLUSION_TYPE_STRICT=2,r.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,r.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,r.CULLINGSTRATEGY_STANDARD=0,r.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,r}(e.TransformNode);e.AbstractMesh=i}(s||(s={})),function(e){var t=function(t){function i(r,n){var a=t.call(this,r,n)||this;return a.diffuse=new e.Color3(1,1,1),a.specular=new e.Color3(1,1,1),a.falloffType=i.FALLOFF_DEFAULT,a.intensity=1,a._range=Number.MAX_VALUE,a._inverseSquaredRange=0,a._photometricScale=1,a._intensityMode=i.INTENSITYMODE_AUTOMATIC,a._radius=1e-5,a.renderPriority=0,a._shadowEnabled=!0,a._excludeWithLayerMask=0,a._includeOnlyWithLayerMask=0,a._lightmapMode=0,a._excludedMeshesIds=new Array,a._includedOnlyMeshesIds=new Array,a.getScene().addLight(a),a._uniformBuffer=new e.UniformBuffer(a.getScene().getEngine()),a._buildUniformLayout(),a.includedOnlyMeshes=new Array,a.excludedMeshes=new Array,a._resyncMeshes(),a}return a(i,t),Object.defineProperty(i.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"Light"},i.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][__uv.$wrap((this.getTypeID()))],this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[__uv.$wrap((i))].toString(e);return t},i.prototype._syncParentEnabledState=function(){t.prototype._syncParentEnabledState.call(this),this._resyncMeshes()},i.prototype.setEnabled=function(e){t.prototype.setEnabled.call(this,e),this._resyncMeshes()},i.prototype.getShadowGenerator=function(){return this._shadowGenerator},i.prototype.getAbsolutePosition=function(){return e.Vector3.Zero()},i.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},i.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},i.prototype.dispose=function(e,i){void 0===i&&(i=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var r=0,n=this.getScene().meshes;r<n.length;r++){n[__uv.$wrap((r))]._removeLightSource(this)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),t.prototype.dispose.call(this,e,i)},i.prototype.getTypeID=function(){return 0},i.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},i.prototype.clone=function(t){var r=i.GetConstructorFromName(this.getTypeID(),t,this.getScene());return r?e.SerializationHelper.Clone(r,this):null},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.type=this.getTypeID(),this.__uv$setSource(__uv).__uv$parent&&(t.parentId=this.__uv$setSource(__uv).__uv$parent.id),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach((function(e){t.excludedMeshesIds.push(e.id)}))),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(e){t.includedOnlyMeshesIds.push(e.id)}))),e.Animation.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},i.GetConstructorFromName=function(t,i,r){var n=e.Node.Construct("Light_Type_"+t,i,r);return n||null},i.Parse=function(t,r){var n=i.GetConstructorFromName(t.type,t.name,r);if(!n)return null;var a=e.SerializationHelper.Parse(n,t,r);if(t.excludedMeshesIds&&(a._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(a._includedOnlyMeshesIds=t.includedOnlyMeshesIds),t.parentId&&(a._waitingParentId=t.parentId),t.animations){for(var o=0;o<t.animations.length;o++){var s=t.animations[__uv.$wrap((o))];a.animations.push(e.Animation.Parse(s))}e.Node.ParseAnimationRanges(a,t,r)}return t.autoAnimate&&r.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),a},i.prototype._hookArrayForExcluded=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[__uv.$wrap((n))]=arguments[__uv.$wrap((n))];for(var a=i.apply(e,r),o=0,s=r;o<s.length;o++){var l=s[__uv.$wrap((o))];l._resyncLighSource(t)}return a};var r=e.splice;e.splice=function(i,n){for(var a=r.apply(e,[i,n]),o=0,s=a;o<s.length;o++){s[__uv.$wrap((o))]._resyncLighSource(t)}return a};for(var n=0,a=e;n<a.length;n++){a[__uv.$wrap((n))]._resyncLighSource(this)}},i.prototype._hookArrayForIncludedOnly=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[__uv.$wrap((n))]=arguments[__uv.$wrap((n))];var a=i.apply(e,r);return t._resyncMeshes(),a};var r=e.splice;e.splice=function(i,n){var a=r.apply(e,[i,n]);return t._resyncMeshes(),a},this._resyncMeshes()},i.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){t[__uv.$wrap((e))]._resyncLighSource(this)}},i.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[__uv.$wrap((e))];-1!==i._lightSources.indexOf(this)&&i._markSubMeshesAsLightDirty()}},i.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},i.prototype._getPhotometricScale=function(){var e=0,t=this.getTypeID(),r=this.intensityMode;switch(r===i.INTENSITYMODE_AUTOMATIC&&(r=t===i.LIGHTTYPEID_DIRECTIONALLIGHT?i.INTENSITYMODE_ILLUMINANCE:i.INTENSITYMODE_LUMINOUSINTENSITY),t){case i.LIGHTTYPEID_POINTLIGHT:case i.LIGHTTYPEID_SPOTLIGHT:switch(r){case i.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case i.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case i.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case i.LIGHTTYPEID_DIRECTIONALLIGHT:switch(r){case i.INTENSITYMODE_ILLUMINANCE:e=1;break;case i.INTENSITYMODE_LUMINANCE:var n=this.radius;n=Math.max(n,.001),e=2*Math.PI*(1-Math.cos(n))}break;case i.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},i.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},i.FALLOFF_DEFAULT=0,i.FALLOFF_PHYSICAL=1,i.FALLOFF_GLTF=2,i.FALLOFF_STANDARD=3,i.LIGHTMAP_DEFAULT=0,i.LIGHTMAP_SPECULAR=1,i.LIGHTMAP_SHADOWSONLY=2,i.INTENSITYMODE_AUTOMATIC=0,i.INTENSITYMODE_LUMINOUSPOWER=1,i.INTENSITYMODE_LUMINOUSINTENSITY=2,i.INTENSITYMODE_ILLUMINANCE=3,i.INTENSITYMODE_LUMINANCE=4,i.LIGHTTYPEID_POINTLIGHT=0,i.LIGHTTYPEID_DIRECTIONALLIGHT=1,i.LIGHTTYPEID_SPOTLIGHT=2,i.LIGHTTYPEID_HEMISPHERICLIGHT=3,n([e.serializeAsColor3()],i.prototype,"diffuse",void 0),n([e.serializeAsColor3()],i.prototype,"specular",void 0),n([e.serialize()],i.prototype,"falloffType",void 0),n([e.serialize()],i.prototype,"intensity",void 0),n([e.serialize()],i.prototype,"range",null),n([e.serialize()],i.prototype,"intensityMode",null),n([e.serialize()],i.prototype,"radius",null),n([e.serialize()],i.prototype,"_renderPriority",void 0),n([e.expandToProperty("_reorderLightsInScene")],i.prototype,"renderPriority",void 0),n([e.serialize("shadowEnabled")],i.prototype,"_shadowEnabled",void 0),n([e.serialize("excludeWithLayerMask")],i.prototype,"_excludeWithLayerMask",void 0),n([e.serialize("includeOnlyWithLayerMask")],i.prototype,"_includeOnlyWithLayerMask",void 0),n([e.serialize("lightmapMode")],i.prototype,"_lightmapMode",void 0),i}(e.Node);e.Light=t}(s||(s={})),function(e){var t=function(t){function i(r,n,a,o){void 0===o&&(o=!0);var s=t.call(this,r,a)||this;return s.upVector=e.Vector3.Up(),s.orthoLeft=null,s.orthoRight=null,s.orthoBottom=null,s.orthoTop=null,s.fov=.8,s.minZ=1,s.maxZ=1e4,s.inertia=.9,s.mode=i.PERSPECTIVE_CAMERA,s.isIntermediate=!1,s.viewport=new e.Viewport(0,0,1,1),s.layerMask=268435455,s.fovMode=i.FOVMODE_VERTICAL_FIXED,s.cameraRigMode=i.RIG_MODE_NONE,s.customRenderTargets=new Array,s.onViewMatrixChangedObservable=new e.Observable,s.onProjectionMatrixChangedObservable=new e.Observable,s.onAfterCheckInputsObservable=new e.Observable,s.onRestoreStateObservable=new e.Observable,s._rigCameras=new Array,s._webvrViewMatrix=e.Matrix.Identity(),s._skipRendering=!1,s._projectionMatrix=new e.Matrix,s._postProcesses=new Array,s._activeMeshes=new e.SmartArray(256),s._globalPosition=e.Vector3.Zero(),s._computedViewMatrix=e.Matrix.Identity(),s._doNotComputeProjectionMatrix=!1,s._transformMatrix=e.Matrix.Zero(),s._refreshFrustumPlanes=!0,s.autoClear=!0,s.getScene().addCamera(s),o&&!s.getScene().activeCamera&&(s.getScene().activeCamera=s),s.position=n,s}return a(i,t),i.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},i.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},i.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},i.prototype.getClassName=function(){return"Camera"},i.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[__uv.$wrap((i))].toString(e);return t},Object.defineProperty(i.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),i.prototype.getActiveMeshes=function(){return this._activeMeshes},i.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},i.prototype.isReady=function(e){if(void 0===e&&(e=!1),e)for(var i=0,r=this._postProcesses;i<r.length;i++){var n=r[__uv.$wrap((i))];if(n&&!n.isReady())return!1}return t.prototype.isReady.call(this,e)},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.position=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},i.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},i.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},i.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===i.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()},i.prototype.attachControl=function(e,t){},i.prototype.detachControl=function(e){},i.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==i.RIG_MODE_NONE&&this._updateRigCameras()},i.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(i.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),i.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[__uv.$wrap((e))])return this._postProcesses[__uv.$wrap((e))];return null},i.prototype._cascadePostProcessesToRigCams=function(){var t=this._getFirstPostProcess();t&&t.markTextureDirty();for(var i=0,r=this._rigCameras.length;i<r;i++){var n=this._rigCameras[__uv.$wrap((i))],a=n._rigPostProcess;if(a)a instanceof e.PassPostProcess&&(n.isIntermediate=0===this._postProcesses.length),n._postProcesses=this._postProcesses.slice(0).concat(a),a.markTextureDirty();else n._postProcesses=this._postProcesses.slice(0)}},i.prototype.attachPostProcess=function(t,i){return void 0===i&&(i=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(e.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(null==i||i<0?this._postProcesses.push(t):null===this._postProcesses[__uv.$wrap((i))]?this._postProcesses[__uv.$wrap((i))]=t:this._postProcesses.splice(i,0,t),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(t))},i.prototype.detachPostProcess=function(e){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[__uv.$wrap((t))]=null),this._cascadePostProcessesToRigCams()},i.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},i.prototype._getViewMatrix=function(){return e.Matrix.Identity()},i.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this._currentRenderId,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},i.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)},i.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},i.prototype.getProjectionMatrix=function(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var r=this.getEngine(),n=this.getScene();if(this.mode===i.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=r.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),n.useRightHandedSystem?e.Matrix.PerspectiveFovRHToRef(this.fov,r.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===i.FOVMODE_VERTICAL_FIXED):e.Matrix.PerspectiveFovLHToRef(this.fov,r.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===i.FOVMODE_VERTICAL_FIXED);else{var a=r.getRenderWidth()/2,o=r.getRenderHeight()/2;n.useRightHandedSystem?e.Matrix.OrthoOffCenterRHToRef(this.orthoLeft||-a,this.orthoRight||a,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix):e.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-a,this.orthoRight||a,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=r.getRenderWidth(),this._cache.renderHeight=r.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},i.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},i.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},i.prototype.isInFrustum=function(e){return this._updateFrustumPlanes(),e.isInFrustum(this._frustumPlanes)},i.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},i.prototype.getForwardRay=function(t,i,r){void 0===t&&(t=100),i||(i=this.getWorldMatrix()),r||(r=this.position);var n=this._scene.useRightHandedSystem?new e.Vector3(0,0,-1):new e.Vector3(0,0,1),a=e.Vector3.TransformNormal(n,i),o=e.Vector3.Normalize(a);return new e.Ray(r,o,t)},i.prototype.dispose=function(e,r){for(void 0===r&&(r=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==i.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var a=this._postProcesses.length;--a>=0;){var o=this._postProcesses[__uv.$wrap((a))];o&&o.dispose(this)}for(a=this.customRenderTargets.length;--a>=0;)this.customRenderTargets[__uv.$wrap((a))].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),t.prototype.dispose.call(this,e,r)},Object.defineProperty(i.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[__uv.$wrap((0))]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[__uv.$wrap((1))]},enumerable:!0,configurable:!0}),i.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[__uv.$wrap((0))].getTarget()},i.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[__uv.$wrap((1))].getTarget()},i.prototype.setCameraRigMode=function(t,r){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=r.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==i.RIG_MODE_NONE){var a=this.createRigCamera(this.name+"_L",0),o=this.createRigCamera(this.name+"_R",1);a&&o&&(this._rigCameras.push(a),this._rigCameras.push(o))}switch(this.cameraRigMode){case i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[__uv.$wrap((0))]._rigPostProcess=new e.PassPostProcess(this.name+"_passthru",1,this._rigCameras[__uv.$wrap((0))]),this._rigCameras[__uv.$wrap((1))]._rigPostProcess=new e.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.RIG_MODE_STEREOSCOPIC_OVERUNDER:var s=this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[__uv.$wrap((0))]._rigPostProcess=new e.PassPostProcess(this.name+"_passthru",1,this._rigCameras[__uv.$wrap((0))]),this._rigCameras[__uv.$wrap((1))]._rigPostProcess=new e.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,s);break;case i.RIG_MODE_VR:var l=r.vrCameraMetrics||e.VRCameraMetrics.GetDefault();this._rigCameras[__uv.$wrap((0))]._cameraRigParams.vrMetrics=l,this._rigCameras[__uv.$wrap((0))].viewport=new e.Viewport(0,0,.5,1),this._rigCameras[__uv.$wrap((0))]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[__uv.$wrap((0))]._cameraRigParams.vrHMatrix=l.leftHMatrix,this._rigCameras[__uv.$wrap((0))]._cameraRigParams.vrPreViewMatrix=l.leftPreViewMatrix,this._rigCameras[__uv.$wrap((0))].getProjectionMatrix=this._rigCameras[__uv.$wrap((0))]._getVRProjectionMatrix,this._rigCameras[__uv.$wrap((1))]._cameraRigParams.vrMetrics=l,this._rigCameras[__uv.$wrap((1))].viewport=new e.Viewport(.5,0,.5,1),this._rigCameras[__uv.$wrap((1))]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[__uv.$wrap((1))]._cameraRigParams.vrHMatrix=l.rightHMatrix,this._rigCameras[__uv.$wrap((1))]._cameraRigParams.vrPreViewMatrix=l.rightPreViewMatrix,this._rigCameras[__uv.$wrap((1))].getProjectionMatrix=this._rigCameras[__uv.$wrap((1))]._getVRProjectionMatrix,l.compensateDistortion&&(this._rigCameras[__uv.$wrap((0))]._rigPostProcess=new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[__uv.$wrap((0))],!1,l),this._rigCameras[__uv.$wrap((1))]._rigPostProcess=new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[__uv.$wrap((1))],!0,l));break;case i.RIG_MODE_WEBVR:if(r.vrDisplay){var c=r.vrDisplay.getEyeParameters("left"),u=r.vrDisplay.getEyeParameters("right");this._rigCameras[__uv.$wrap((0))].viewport=new e.Viewport(0,0,.5,1),this._rigCameras[__uv.$wrap((0))].setCameraRigParameter("left",!0),this._rigCameras[__uv.$wrap((0))].setCameraRigParameter("specs",r.specs),this._rigCameras[__uv.$wrap((0))].setCameraRigParameter("eyeParameters",c),this._rigCameras[__uv.$wrap((0))].setCameraRigParameter("frameData",r.frameData),this._rigCameras[__uv.$wrap((0))].setCameraRigParameter("parentCamera",r.parentCamera),this._rigCameras[__uv.$wrap((0))]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[__uv.$wrap((0))].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[__uv.$wrap((0))].__uv$setSource(__uv).__uv$parent=this,this._rigCameras[__uv.$wrap((0))]._getViewMatrix=this._getWebVRViewMatrix,this._rigCameras[__uv.$wrap((1))].viewport=new e.Viewport(.5,0,.5,1),this._rigCameras[__uv.$wrap((1))].setCameraRigParameter("eyeParameters",u),this._rigCameras[__uv.$wrap((1))].setCameraRigParameter("specs",r.specs),this._rigCameras[__uv.$wrap((1))].setCameraRigParameter("frameData",r.frameData),this._rigCameras[__uv.$wrap((1))].setCameraRigParameter("parentCamera",r.parentCamera),this._rigCameras[__uv.$wrap((1))]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[__uv.$wrap((1))].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[__uv.$wrap((1))].__uv$setSource(__uv).__uv$parent=this,this._rigCameras[__uv.$wrap((1))]._getViewMatrix=this._getWebVRViewMatrix,i.UseAlternateWebVRRendering&&(this._rigCameras[__uv.$wrap((1))]._skipRendering=!0,this._rigCameras[__uv.$wrap((0))]._alternateCamera=this._rigCameras[__uv.$wrap((1))])}}this._cascadePostProcessesToRigCams(),this.update()}},i.prototype._getVRProjectionMatrix=function(){return e.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},i.prototype._updateCameraRotationMatrix=function(){},i.prototype._updateWebVRCameraRotationMatrix=function(){},i.prototype._getWebVRProjectionMatrix=function(){return e.Matrix.Identity()},i.prototype._getWebVRViewMatrix=function(){return e.Matrix.Identity()},i.prototype.setCameraRigParameter=function(t,i){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[__uv.$wrap((t))]=i,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(i/.0637))},i.prototype.createRigCamera=function(e,t){return null},i.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[__uv.$wrap((e))].minZ=this.minZ,this._rigCameras[__uv.$wrap((e))].maxZ=this.maxZ,this._rigCameras[__uv.$wrap((e))].fov=this.fov;this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[__uv.$wrap((0))].viewport=this._rigCameras[__uv.$wrap((1))].viewport=this.viewport)},i.prototype._setupInputs=function(){},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.type=this.getClassName(),this.__uv$setSource(__uv).__uv$parent&&(t.parentId=this.__uv$setSource(__uv).__uv$parent.id),this.inputs&&this.inputs.serialize(t),e.Animation.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},i.prototype.clone=function(t){return e.SerializationHelper.Clone(i.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},i.prototype.getDirection=function(t){var i=e.Vector3.Zero();return this.getDirectionToRef(t,i),i},i.prototype.getDirectionToRef=function(t,i){e.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),i)},i.GetConstructorFromName=function(t,i,r,n,a){void 0===n&&(n=0),void 0===a&&(a=!0);var o=e.Node.Construct(t,i,r,{interaxial_distance:n,isStereoscopicSideBySide:a});return o||function(){return new e.UniversalCamera(i,e.Vector3.Zero(),r)}},i.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},i.Parse=function(t,r){var n=t.type,a=i.GetConstructorFromName(n,t.name,r,t.interaxial_distance,t.isStereoscopicSideBySide),o=e.SerializationHelper.Parse(a,t,r);if(t.parentId&&(o._waitingParentId=t.parentId),o.inputs&&(o.inputs.parse(t),o._setupInputs()),o.setPosition&&(o.position.copyFromFloats(0,0,0),o.setPosition(e.Vector3.FromArray(t.position))),t.target&&o.setTarget&&o.setTarget(e.Vector3.FromArray(t.target)),t.cameraRigMode){var s=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};o.setCameraRigMode(t.cameraRigMode,s)}if(t.animations){for(var l=0;l<t.animations.length;l++){var c=t.animations[__uv.$wrap((l))];o.animations.push(e.Animation.Parse(c))}e.Node.ParseAnimationRanges(o,t,r)}return t.autoAnimate&&r.beginAnimation(o,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),o},i.PERSPECTIVE_CAMERA=0,i.ORTHOGRAPHIC_CAMERA=1,i.FOVMODE_VERTICAL_FIXED=0,i.FOVMODE_HORIZONTAL_FIXED=1,i.RIG_MODE_NONE=0,i.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,i.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,i.RIG_MODE_VR=20,i.RIG_MODE_WEBVR=21,i.ForceAttachControlToAlwaysPreventDefault=!1,i.UseAlternateWebVRRendering=!1,n([e.serializeAsVector3()],i.prototype,"position",void 0),n([e.serializeAsVector3()],i.prototype,"upVector",void 0),n([e.serialize()],i.prototype,"orthoLeft",void 0),n([e.serialize()],i.prototype,"orthoRight",void 0),n([e.serialize()],i.prototype,"orthoBottom",void 0),n([e.serialize()],i.prototype,"orthoTop",void 0),n([e.serialize()],i.prototype,"fov",void 0),n([e.serialize()],i.prototype,"minZ",void 0),n([e.serialize()],i.prototype,"maxZ",void 0),n([e.serialize()],i.prototype,"inertia",void 0),n([e.serialize()],i.prototype,"mode",void 0),n([e.serialize()],i.prototype,"layerMask",void 0),n([e.serialize()],i.prototype,"fovMode",void 0),n([e.serialize()],i.prototype,"cameraRigMode",void 0),n([e.serialize()],i.prototype,"interaxialDistance",void 0),n([e.serialize()],i.prototype,"isStereoscopicSideBySide",void 0),i}(e.Node);e.Camera=t}(s||(s={})),function(e){var t=function(){function t(i){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new e.RenderingGroupInfo,this._scene=i;for(var r=t.MIN_RENDERINGGROUPS;r<t.MAX_RENDERINGGROUPS;r++)this._autoClearDepthStencil[__uv.$wrap((r))]={autoClear:!0,depth:!0,stencil:!0}}return t.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},t.prototype.render=function(e,i,r,n){var a=this._renderingGroupInfo;if(a.scene=this._scene,a.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var o=0;o<this._scene.spriteManagers.length;o++){var s=this._scene.spriteManagers[__uv.$wrap((o))];this.dispatchSprites(s)}for(o=t.MIN_RENDERINGGROUPS;o<t.MAX_RENDERINGGROUPS;o++){this._depthStencilBufferAlreadyCleaned=o===t.MIN_RENDERINGGROUPS;var l=this._renderingGroups[__uv.$wrap((o))];if(l){var c=Math.pow(2,o);if(a.renderingGroupId=o,this._scene.onBeforeRenderingGroupObservable.notifyObservers(a,c),t.AUTOCLEAR){var u=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(o):this._autoClearDepthStencil[__uv.$wrap((o))];u&&u.autoClear&&this._clearDepthStencilBuffer(u.depth,u.stencil)}for(var h=0,d=this._scene._beforeRenderingGroupDrawStage;h<d.length;h++){d[__uv.$wrap((h))].action(o)}l.render(e,n,r,i);for(var p=0,m=this._scene._afterRenderingGroupDrawStage;p<m.length;p++){m[__uv.$wrap((p))].action(o)}this._scene.onAfterRenderingGroupObservable.notifyObservers(a,c)}}},t.prototype.reset=function(){for(var e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){var i=this._renderingGroups[__uv.$wrap((e))];i&&i.prepare()}},t.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},t.prototype.freeRenderingGroups=function(){for(var e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){var i=this._renderingGroups[__uv.$wrap((e))];i&&i.dispose()}},t.prototype._prepareRenderingGroup=function(t){void 0===this._renderingGroups[__uv.$wrap((t))]&&(this._renderingGroups[__uv.$wrap((t))]=new e.RenderingGroup(t,this._scene,this._customOpaqueSortCompareFn[__uv.$wrap((t))],this._customAlphaTestSortCompareFn[__uv.$wrap((t))],this._customTransparentSortCompareFn[__uv.$wrap((t))]))},t.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[__uv.$wrap((t))].dispatchSprites(e)},t.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[__uv.$wrap((t))].dispatchParticles(e)},t.prototype.dispatch=function(e,t,i){void 0===t&&(t=e.getMesh());var r=t.renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[__uv.$wrap((r))].dispatch(e,t,i)},t.prototype.setRenderingOrder=function(e,t,i,r){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._customOpaqueSortCompareFn[__uv.$wrap((e))]=t,this._customAlphaTestSortCompareFn[__uv.$wrap((e))]=i,this._customTransparentSortCompareFn[__uv.$wrap((e))]=r,this._renderingGroups[__uv.$wrap((e))]){var n=this._renderingGroups[__uv.$wrap((e))];n.opaqueSortCompareFn=this._customOpaqueSortCompareFn[__uv.$wrap((e))],n.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[__uv.$wrap((e))],n.transparentSortCompareFn=this._customTransparentSortCompareFn[__uv.$wrap((e))]}},t.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0),this._autoClearDepthStencil[__uv.$wrap((e))]={autoClear:t,depth:i,stencil:r}},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[__uv.$wrap((e))]},t.MAX_RENDERINGGROUPS=4,t.MIN_RENDERINGGROUPS=0,t.AUTOCLEAR=!0,t}();e.RenderingManager=t}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a){void 0===r&&(r=null),void 0===n&&(n=null),void 0===a&&(a=null),this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._depthOnlySubMeshes=new e.SmartArray(256),this._particleSystems=new e.SmartArray(256),this._spriteManagers=new e.SmartArray(256),this._edgesRenderers=new e.SmartArray(16),this._scene=i,this.opaqueSortCompareFn=r,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=a}return Object.defineProperty(t.prototype,"opaqueSortCompareFn",{set:function(e){this._opaqueSortCompareFn=e,this._renderOpaque=e?this.renderOpaqueSorted:t.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaTestSortCompareFn",{set:function(e){this._alphaTestSortCompareFn=e,this._renderAlphaTest=e?this.renderAlphaTestSorted:t.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transparentSortCompareFn",{set:function(e){this._transparentSortCompareFn=e||t.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),t.prototype.render=function(t,i,r,n){if(t)t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var a=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(a.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),a.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var o=a.getStencilBuffer();if(a.setStencilBuffer(!1),i&&this._renderSprites(),r&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),a.setAlphaMode(e.Engine.ALPHA_DISABLE)),a.setStencilBuffer(!1),this._edgesRenderers.length){for(var s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[__uv.$wrap((s))].render();a.setAlphaMode(e.Engine.ALPHA_DISABLE)}a.setStencilBuffer(o)}},t.prototype.renderOpaqueSorted=function(e){return t.renderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},t.prototype.renderAlphaTestSorted=function(e){return t.renderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},t.prototype.renderTransparentSorted=function(e){return t.renderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)},t.renderSorted=function(t,i,r,n){for(var a,o=0,s=r?r.globalPosition:e.Vector3.Zero();o<t.length;o++)(a=t.data[__uv.$wrap((o))])._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=a.getBoundingInfo().boundingSphere.centerWorld.subtract(s).length();var l=t.data.slice(0,t.length);for(i&&l.sort(i),o=0;o<l.length;o++){if(a=l[__uv.$wrap((o))],n){var c=a.getMaterial();if(c&&c.needDepthPrePass){var u=c.getScene().getEngine();u.setColorWrite(!1),u.setAlphaMode(e.Engine.ALPHA_DISABLE),a.render(!1),u.setColorWrite(!0)}}a.render(n)}},t.renderUnsorted=function(e){for(var t=0;t<e.length;t++){e.data[__uv.$wrap((t))].render(!1)}},t.defaultTransparentSortCompare=function(e,i){return e._alphaIndex>i._alphaIndex?1:e._alphaIndex<i._alphaIndex?-1:t.backToFrontSortCompare(e,i)},t.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},t.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},t.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},t.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},t.prototype.dispatch=function(e,t,i){void 0===t&&(t=e.getMesh()),void 0===i&&(i=e.getMaterial()),null!=i&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.push(t._edgesRenderer))},t.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},t.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},t.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._particleSystems.length;i++){var r=this._particleSystems.data[__uv.$wrap((i))];if(0!==(t&&t.layerMask&r.layerMask)){var n=r.emitter;n.position&&e&&-1===e.indexOf(n)||this._scene._activeParticles.addCount(r.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},t.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var i=this._spriteManagers.data[__uv.$wrap((t))];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},t}();e.RenderingGroup=t}(s||(s={})),function(e){var t=function(){function e(){}return e.NAME_EFFECTLAYER="EffectLayer",e.NAME_LAYER="Layer",e.NAME_LENSFLARESYSTEM="LensFlareSystem",e.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",e.NAME_PARTICLESYSTEM="ParticleSystem",e.NAME_GAMEPAD="Gamepad",e.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",e.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",e.NAME_DEPTHRENDERER="DepthRenderer",e.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",e.NAME_SPRITE="Sprite",e.NAME_OUTLINERENDERER="Outline",e.NAME_PROCEDURALTEXTURE="ProceduralTexture",e.NAME_SHADOWGENERATOR="ShadowGenerator",e.NAME_OCTREE="Octree",e.NAME_PHYSICSENGINE="PhysicsEngine",e.NAME_AUDIO="Audio",e.STEP_ISREADYFORMESH_EFFECTLAYER=0,e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,e.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,e.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,e.STEP_BEFORECAMERADRAW_LAYER=1,e.STEP_BEFORERENDERINGMESH_OUTLINE=0,e.STEP_AFTERRENDERINGMESH_OUTLINE=0,e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,e.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,e.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,e.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,e.STEP_AFTERCAMERADRAW_LAYER=3,e.STEP_AFTERRENDER_AUDIO=0,e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=0,e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=2,e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,e.STEP_POINTERMOVE_SPRITE=0,e.STEP_POINTERDOWN_SPRITE=0,e.STEP_POINTERUP_SPRITE=0,e}();e.SceneComponentConstants=t;var i=function(e){function t(t){return e.apply(this,t)||this}return a(t,e),t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,t,i){var r=0;for(Number.MAX_VALUE;r<this.length;r++){if(e<this[__uv.$wrap((r))].index)break}this.splice(r,0,{index:e,component:t,action:i.bind(t)})},t.prototype.clear=function(){this.length=0},t}(Array);e.Stage=i}(s||(s={})),function(e){var t=function(){function e(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array}return e.AddParser=function(e,t){this._BabylonFileParsers[__uv.$wrap((e))]=t},e.GetParser=function(e){return this._BabylonFileParsers[__uv.$wrap((e))]?this._BabylonFileParsers[__uv.$wrap((e))]:null},e.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[__uv.$wrap((e))]=t},e.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[__uv.$wrap((e))]?this._IndividualBabylonFileParsers[__uv.$wrap((e))]:null},e.Parse=function(e,t,i,r){for(var n in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(n)&&this._BabylonFileParsers[__uv.$wrap((n))](e,t,i,r)},e._BabylonFileParsers={},e._IndividualBabylonFileParsers={},e}();e.AbstractScene=t}(s||(s={})),function(e){var t=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!0,configurable:!0}),e}(),i=function(){};e.RenderingGroupInfo=i;var r=function(i){function r(t){var n=i.call(this)||this;return n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new e.Color4(.2,.2,.3,1),n.ambientColor=new e.Color3(0,0,0),n._forceWireframe=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.preventDefaultOnPointerDown=!0,n.metadata=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new e.Observable,n._onDisposeObserver=null,n.onBeforeRenderObservable=new e.Observable,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new e.Observable,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new e.Observable,n.onAfterAnimationsObservable=new e.Observable,n.onBeforeDrawPhaseObservable=new e.Observable,n.onAfterDrawPhaseObservable=new e.Observable,n.onReadyObservable=new e.Observable,n.onBeforeCameraRenderObservable=new e.Observable,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new e.Observable,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new e.Observable,n.onAfterActiveMeshesEvaluationObservable=new e.Observable,n.onBeforeParticlesRenderingObservable=new e.Observable,n.onAfterParticlesRenderingObservable=new e.Observable,n.onDataLoadedObservable=new e.Observable,n.onNewCameraAddedObservable=new e.Observable,n.onCameraRemovedObservable=new e.Observable,n.onNewLightAddedObservable=new e.Observable,n.onLightRemovedObservable=new e.Observable,n.onNewGeometryAddedObservable=new e.Observable,n.onGeometryRemovedObservable=new e.Observable,n.onNewTransformNodeAddedObservable=new e.Observable,n.onTransformNodeRemovedObservable=new e.Observable,n.onNewMeshAddedObservable=new e.Observable,n.onMeshRemovedObservable=new e.Observable,n.onNewMaterialAddedObservable=new e.Observable,n.onMaterialRemovedObservable=new e.Observable,n.onNewTextureAddedObservable=new e.Observable,n.onTextureRemovedObservable=new e.Observable,n.onBeforeRenderTargetsRenderObservable=new e.Observable,n.onAfterRenderTargetsRenderObservable=new e.Observable,n.onBeforeStepObservable=new e.Observable,n.onAfterStepObservable=new e.Observable,n.onBeforeRenderingGroupObservable=new e.Observable,n.onAfterRenderingGroupObservable=new e.Observable,n.onMeshImportedObservable=new e.Observable,n._registeredForLateAnimationBindings=new e.SmartArrayNoDuplicate(256),n.onPrePointerObservable=new e.Observable,n.onPointerObservable=new e.Observable,n._meshPickProceed=!1,n._currentPickResult=null,n._previousPickResult=null,n._totalPointersPressed=0,n._doubleClickOccured=!1,n.cameraToUseForPointers=null,n._pointerX=0,n._pointerY=0,n._startingPointerPosition=new e.Vector2(0,0),n._previousStartingPointerPosition=new e.Vector2(0,0),n._startingPointerTime=0,n._previousStartingPointerTime=0,n._pointerCaptures={},n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n.onPreKeyboardObservable=new e.Observable,n.onKeyboardObservable=new e.Observable,n._useRightHandedSystem=!1,n._fogEnabled=!0,n._fogMode=r.FOGMODE_NONE,n.fogColor=new e.Color3(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new e.Vector3(0,-9.807,0),n.postProcessesEnabled=!0,n.postProcesses=new Array,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new e.SmartArrayNoDuplicate(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new e.PerfCounter,n._activeIndices=new e.PerfCounter,n._activeParticles=new e.PerfCounter,n._activeBones=new e.PerfCounter,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=-1,n._intermediateRendering=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._alternateViewUpdateFlag=-1,n._alternateProjectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new e.SmartArray(256),n._processedMaterials=new e.SmartArray(256),n._renderTargets=new e.SmartArrayNoDuplicate(256),n._activeParticleSystems=new e.SmartArray(256),n._activeSkeletons=new e.SmartArrayNoDuplicate(32),n._softwareSkinnedMeshes=new e.SmartArrayNoDuplicate(32),n._activeAnimatables=new Array,n._transformMatrix=e.Matrix.Zero(),n._useAlternateCameraConfiguration=!1,n._alternateRendering=!1,n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=e.Stage.Create(),n._beforeClearStage=e.Stage.Create(),n._gatherRenderTargetsStage=e.Stage.Create(),n._gatherActiveCameraRenderTargetsStage=e.Stage.Create(),n._isReadyForMeshStage=e.Stage.Create(),n._beforeEvaluateActiveMeshStage=e.Stage.Create(),n._evaluateSubMeshStage=e.Stage.Create(),n._activeMeshStage=e.Stage.Create(),n._cameraDrawRenderTargetStage=e.Stage.Create(),n._beforeCameraDrawStage=e.Stage.Create(),n._beforeRenderingGroupDrawStage=e.Stage.Create(),n._beforeRenderingMeshStage=e.Stage.Create(),n._afterRenderingMeshStage=e.Stage.Create(),n._afterRenderingGroupDrawStage=e.Stage.Create(),n._afterCameraDrawStage=e.Stage.Create(),n._afterRenderStage=e.Stage.Create(),n._pointerMoveStage=e.Stage.Create(),n._pointerDownStage=e.Stage.Create(),n._pointerUpStage=e.Stage.Create(),n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._activeMeshesFrozen=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return 1e3/60},n._tempPickingRay=e.Ray?e.Ray.Zero():null,n._blockMaterialDirtyMechanism=!1,n._engine=t||e.Engine.LastCreatedEngine,n._engine.scenes.push(n),n._uid=null,n._renderingManager=new e.RenderingManager(n),e.PostProcessManager&&(n.postProcessManager=new e.PostProcessManager(n)),e.Tools.IsWindowObjectExist(),n.workerCollisions=!1,n._createUbo(),e.ImageProcessingConfiguration&&(n._imageProcessingConfiguration=new e.ImageProcessingConfiguration),n.setDefaultCandidateProviders(),n}return a(r,i),Object.defineProperty(r.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(t){this._environmentTexture!==t&&(this._environmentTexture=t,this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(t){this._forceWireframe!==t&&(this._forceWireframe=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(t){this._forcePointsCloud!==t&&(this._forcePointsCloud=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"unTranslatedPointer",{get:function(){return new e.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(t){this._useRightHandedSystem!==t&&(this._useRightHandedSystem=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),r.prototype.setStepId=function(e){this._currentStepId=e},r.prototype.getStepId=function(){return this._currentStepId},r.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(r.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fogMode",{get:function(){return this._fogMode},set:function(t){this._fogMode!==t&&(this._fogMode=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(t){this._shadowsEnabled!==t&&(this._shadowsEnabled=t,this.markAllMaterialsAsDirty(e.Material.LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(t){this._lightsEnabled!==t&&(this._lightsEnabled=t,this.markAllMaterialsAsDirty(e.Material.LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=new e.StandardMaterial("default material",this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(t){this._texturesEnabled!==t&&(this._texturesEnabled=t,this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(t){this._skeletonsEnabled!==t&&(this._skeletonsEnabled=t,this.markAllMaterialsAsDirty(e.Material.AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"_isAlternateRenderingEnabled",{get:function(){return this._alternateRendering},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),r.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,t=this._transientComponents;e<t.length;e++){t[__uv.$wrap((e))].register()}this._transientComponents=[]}},r.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var t=e;t.addFromContainer&&this._serializableComponents.push(t)},r.prototype._getComponent=function(e){for(var t=0,i=this._components;t<i.length;t++){var r=i[__uv.$wrap((t))];if(r.name===e)return r}return null},r.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},r.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},r.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(r.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(t){e.CollisionCoordinatorLegacy&&(t=t&&!!Worker&&!!e.CollisionWorker,this._workerCollisions=t,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=t?new e.CollisionCoordinatorWorker:new e.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),r.prototype.getCachedMaterial=function(){return this._cachedMaterial},r.prototype.getCachedEffect=function(){return this._cachedEffect},r.prototype.getCachedVisibility=function(){return this._cachedVisibility},r.prototype.isCachedMaterialInvalid=function(e,t,i){return void 0===i&&(i=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i},r.prototype.getEngine=function(){return this._engine},r.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(r.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),r.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(r.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),r.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(r.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),r.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(r.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),r.prototype.getInterFramePerfCounter=function(){return e.Tools.Warn("getInterFramePerfCounter is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(r.prototype,"interFramePerfCounter",{get:function(){return e.Tools.Warn("interFramePerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),r.prototype.getLastFrameDuration=function(){return e.Tools.Warn("getLastFrameDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(r.prototype,"lastFramePerfCounter",{get:function(){return e.Tools.Warn("lastFramePerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),r.prototype.getEvaluateActiveMeshesDuration=function(){return e.Tools.Warn("getEvaluateActiveMeshesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(r.prototype,"evaluateActiveMeshesDurationPerfCounter",{get:function(){return e.Tools.Warn("evaluateActiveMeshesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),r.prototype.getActiveMeshes=function(){return this._activeMeshes},r.prototype.getRenderTargetsDuration=function(){return e.Tools.Warn("getRenderTargetsDuration is deprecated. Please use SceneInstrumentation class"),0},r.prototype.getRenderDuration=function(){return e.Tools.Warn("getRenderDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(r.prototype,"renderDurationPerfCounter",{get:function(){return e.Tools.Warn("renderDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),r.prototype.getParticlesDuration=function(){return e.Tools.Warn("getParticlesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(r.prototype,"particlesDurationPerfCounter",{get:function(){return e.Tools.Warn("particlesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),r.prototype.getSpritesDuration=function(){return e.Tools.Warn("getSpritesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(r.prototype,"spriteDuractionPerfCounter",{get:function(){return e.Tools.Warn("spriteDuractionPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),r.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},r.prototype.getRenderId=function(){return this._renderId},r.prototype.getFrameId=function(){return this._frameId},r.prototype.incrementRenderId=function(){this._renderId++},r.prototype._updatePointerPosition=function(e){var t=this._engine.getRenderingCanvasClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.__uv$setSource(__uv).__uv$top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},r.prototype._createUbo=function(){this._sceneUbo=new e.UniformBuffer(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},r.prototype._createAlternateUbo=function(){this._alternateSceneUbo=new e.UniformBuffer(this._engine,void 0,!0),this._alternateSceneUbo.addUniform("viewProjection",16),this._alternateSceneUbo.addUniform("view",16)},r.prototype._setRayOnPointerInfo=function(t){t.pickInfo&&(t.pickInfo.ray||(t.pickInfo.ray=this.createPickingRay(t.event.offsetX,t.event.offsetY,e.Matrix.Identity(),this.activeCamera)))},r.prototype.simulatePointerMove=function(t,i){var r=new PointerEvent("pointermove",i);return this._checkPrePointerObservable(t,r,e.PointerEventTypes.POINTERMOVE)?this:this._processPointerMove(t,r)},r.prototype._processPointerMove=function(t,i){var r=this._engine.getRenderingCanvas();if(!r)return this;r.style.cursor=this.defaultCursor;var n=!!(t&&t.hit&&t.pickedMesh);n?(this.setPointerOverMesh(t.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(this._pointerOverMesh.actionManager.hoverCursor?r.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:r.style.cursor=this.hoverCursor)):this.setPointerOverMesh(null);for(var a=0,o=this._pointerMoveStage;a<o.length;a++){t=o[__uv.$wrap((a))].action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,n,r)}if(t){var s="mousewheel"===i.type||"DOMMouseScroll"===i.type?e.PointerEventTypes.POINTERWHEEL:e.PointerEventTypes.POINTERMOVE;if(this.onPointerMove&&this.onPointerMove(i,t,s),this.onPointerObservable.hasObservers()){var l=new e.PointerInfo(s,i,t);this._setRayOnPointerInfo(l),this.onPointerObservable.notifyObservers(l,s)}}return this},r.prototype._checkPrePointerObservable=function(t,i,r){var n=new e.PointerInfoPre(r,i,this._unTranslatedPointerX,this._unTranslatedPointerY);return t&&(n.ray=t.ray),this.onPrePointerObservable.notifyObservers(n,r),!!n.skipOnPointerObservable},r.prototype.simulatePointerDown=function(t,i){var r=new PointerEvent("pointerdown",i);return this._checkPrePointerObservable(t,r,e.PointerEventTypes.POINTERDOWN)?this:this._processPointerDown(t,r)},r.prototype._processPointerDown=function(t,i){var n=this;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var a=t.pickedMesh.actionManager;if(a){if(a.hasPickTriggers)switch(a.processTrigger(e.ActionManager.OnPickDownTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)),i.button){case 0:a.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i));break;case 1:a.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i));break;case 2:a.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i))}a.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger)&&window.setTimeout((function(){var t=n.pick(n._unTranslatedPointerX,n._unTranslatedPointerY,(function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger)&&t==n._pickedDownMesh}),!1,n.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&a&&0!==n._totalPointersPressed&&Date.now()-n._startingPointerTime>r.LongPressDelay&&!n._isPointerSwiping()&&(n._startingPointerTime=0,a.processTrigger(e.ActionManager.OnLongPressTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)))}),r.LongPressDelay)}}else for(var o=0,s=this._pointerDownStage;o<s.length;o++){t=s[__uv.$wrap((o))].action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,i)}if(t){var l=e.PointerEventTypes.POINTERDOWN;if(this.onPointerDown&&this.onPointerDown(i,t,l),this.onPointerObservable.hasObservers()){var c=new e.PointerInfo(l,i,t);this._setRayOnPointerInfo(c),this.onPointerObservable.notifyObservers(c,l)}}return this},r.prototype.simulatePointerUp=function(i,r){var n=new PointerEvent("pointerup",r),a=new t;return a.singleClick=!0,a.ignore=!0,this._checkPrePointerObservable(i,n,e.PointerEventTypes.POINTERUP)?this:this._processPointerUp(i,n,a)},r.prototype._processPointerUp=function(t,i,r){if(t&&t&&t.pickedMesh){if(this._pickedUpMesh=t.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(this.onPointerPick&&this.onPointerPick(i,t),r.singleClick&&!r.ignore&&this.onPointerObservable.hasObservers())){var n=e.PointerEventTypes.POINTERPICK,a=new e.PointerInfo(n,i,t);this._setRayOnPointerInfo(a),this.onPointerObservable.notifyObservers(a,n)}t.pickedMesh.actionManager&&(r.ignore&&t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)),r.hasSwiped||r.ignore||!r.singleClick||t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)),r.doubleClick&&!r.ignore&&t.pickedMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)&&t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnDoublePickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)))}else if(!r.ignore)for(var o=0,s=this._pointerUpStage;o<s.length;o++){t=s[__uv.$wrap((o))].action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,i)}this._pickedDownMesh&&this._pickedDownMesh.actionManager&&this._pickedDownMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnPickOutTrigger)&&this._pickedDownMesh!==this._pickedUpMesh&&this._pickedDownMesh.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger,e.ActionEvent.CreateNew(this._pickedDownMesh,i));var l=e.PointerEventTypes.POINTERUP;if(this.onPointerObservable.hasObservers())if(r.ignore){a=new e.PointerInfo(l,i,t);this._setRayOnPointerInfo(a),this.onPointerObservable.notifyObservers(a,l)}else if(!r.hasSwiped){if(r.singleClick&&this.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP)){var c=e.PointerEventTypes.POINTERTAP,a=new e.PointerInfo(c,i,t);this._setRayOnPointerInfo(a),this.onPointerObservable.notifyObservers(a,c)}if(r.doubleClick&&this.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)){var u=e.PointerEventTypes.POINTERDOUBLETAP;a=new e.PointerInfo(u,i,t);this._setRayOnPointerInfo(a),this.onPointerObservable.notifyObservers(a,u)}}return this.onPointerUp&&this.onPointerUp(i,t,l),this},r.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[__uv.$wrap((e))]},r.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>r.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>r.DragMovementThreshold},r.prototype.attachControl=function(i,n,a){var o=this;void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===a&&(a=!0),this._initActionManager=function(e,t){if(!o._meshPickProceed){var i=o.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,o.pointerDownPredicate,!1,o.cameraToUseForPointers);o._currentPickResult=i,i&&(e=i.hit&&i.pickedMesh?i.pickedMesh.actionManager:null),o._meshPickProceed=!0}return e},this._delayedSimpleClick=function(e,t,i){(Date.now()-o._previousStartingPointerTime>r.DoubleClickDelay&&!o._doubleClickOccured||e!==o._previousButtonPressed)&&(o._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,i(t,o._currentPickResult))},this._initClickEvent=function(i,n,a,s){var l=new t;o._currentPickResult=null;var c=null,u=i.hasSpecificMask(e.PointerEventTypes.POINTERPICK)||n.hasSpecificMask(e.PointerEventTypes.POINTERPICK)||i.hasSpecificMask(e.PointerEventTypes.POINTERTAP)||n.hasSpecificMask(e.PointerEventTypes.POINTERTAP)||i.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)||n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP);if(!u&&e.ActionManager&&e.ActionManager.HasPickTriggers&&(c=o._initActionManager(c,l))&&(u=c.hasPickTriggers),u){var h=a.button;if(l.hasSwiped=o._isPointerSwiping(),!l.hasSwiped){var d=!r.ExclusiveDoubleClickMode;d||(d=!i.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)&&!n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP))&&!e.ActionManager.HasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)&&(c=o._initActionManager(c,l))&&(d=!c.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)),d?(Date.now()-o._previousStartingPointerTime>r.DoubleClickDelay||h!==o._previousButtonPressed)&&(l.singleClick=!0,s(l,o._currentPickResult)):(o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,o._delayedSimpleClickTimeout=window.setTimeout(o._delayedSimpleClick.bind(o,h,l,s),r.DoubleClickDelay));var p=i.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)||n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP);!p&&e.ActionManager.HasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)&&(c=o._initActionManager(c,l))&&(p=c.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)),p&&(h===o._previousButtonPressed&&Date.now()-o._previousStartingPointerTime<r.DoubleClickDelay&&!o._doubleClickOccured?l.hasSwiped||o._isPointerSwiping()?(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=h,r.ExclusiveDoubleClickMode?(o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,s(l,o._previousPickResult)):s(l,o._currentPickResult)):(o._previousStartingPointerTime=0,o._doubleClickOccured=!0,l.doubleClick=!0,l.ignore=!1,r.ExclusiveDoubleClickMode&&o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,s(l,o._currentPickResult)):(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=h))}}l.ignore=!0,s(l,o._currentPickResult)},this._onPointerMove=function(t){if(o._updatePointerPosition(t),!o._checkPrePointerObservable(null,t,"mousewheel"===t.type||"DOMMouseScroll"===t.type?e.PointerEventTypes.POINTERWHEEL:e.PointerEventTypes.POINTERMOVE)&&(o.cameraToUseForPointers||o.activeCamera)){o.pointerMovePredicate||(o.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||o.constantlyUpdateMeshUnderPointer||null!==e.actionManager&&void 0!==e.actionManager)});var i=o.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,o.pointerMovePredicate,!1,o.cameraToUseForPointers);o._processPointerMove(i,t)}},this._onPointerDown=function(t){if(o._totalPointersPressed++,o._pickedDownMesh=null,o._meshPickProceed=!1,o._updatePointerPosition(t),o.preventDefaultOnPointerDown&&c&&(t.preventDefault(),c.focus()),!o._checkPrePointerObservable(null,t,e.PointerEventTypes.POINTERDOWN)&&(o.cameraToUseForPointers||o.activeCamera)){o._pointerCaptures[__uv.$wrap((t.pointerId))]=!0,o._startingPointerPosition.x=o._pointerX,o._startingPointerPosition.y=o._pointerY,o._startingPointerTime=Date.now(),o.pointerDownPredicate||(o.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()}),o._pickedDownMesh=null;var i=o.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,o.pointerDownPredicate,!1,o.cameraToUseForPointers);o._processPointerDown(i,t)}},this._onPointerUp=function(t){0!==o._totalPointersPressed&&(o._totalPointersPressed--,o._pickedUpMesh=null,o._meshPickProceed=!1,o._updatePointerPosition(t),o._initClickEvent(o.onPrePointerObservable,o.onPointerObservable,t,(function(i,r){if(o.onPrePointerObservable.hasObservers())if(i.ignore){if(o._checkPrePointerObservable(null,t,e.PointerEventTypes.POINTERUP))return}else if(!i.hasSwiped){if(i.singleClick&&o.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP)&&o._checkPrePointerObservable(null,t,e.PointerEventTypes.POINTERTAP))return;if(i.doubleClick&&o.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)&&o._checkPrePointerObservable(null,t,e.PointerEventTypes.POINTERDOUBLETAP))return}(o.cameraToUseForPointers||o.activeCamera)&&(o._pointerCaptures[__uv.$wrap((t.pointerId))]=!1,o.pointerUpPredicate||(o.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()}),!o._meshPickProceed&&(e.ActionManager&&e.ActionManager.HasTriggers||o.onPointerObservable.hasObservers())&&o._initActionManager(null,i),r||(r=o._currentPickResult),o._processPointerUp(r,t,i),o._previousPickResult=o._currentPickResult)})))},this._onKeyDown=function(t){var i=e.KeyboardEventTypes.KEYDOWN;if(o.onPreKeyboardObservable.hasObservers()){var r=new e.KeyboardInfoPre(i,t);if(o.onPreKeyboardObservable.notifyObservers(r,i),r.skipOnPointerObservable)return}if(o.onKeyboardObservable.hasObservers()){r=new e.KeyboardInfo(i,t);o.onKeyboardObservable.notifyObservers(r,i)}o.actionManager&&o.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger,e.ActionEvent.CreateNewFromScene(o,t))},this._onKeyUp=function(t){var i=e.KeyboardEventTypes.KEYUP;if(o.onPreKeyboardObservable.hasObservers()){var r=new e.KeyboardInfoPre(i,t);if(o.onPreKeyboardObservable.notifyObservers(r,i),r.skipOnPointerObservable)return}if(o.onKeyboardObservable.hasObservers()){r=new e.KeyboardInfo(i,t);o.onKeyboardObservable.notifyObservers(r,i)}o.actionManager&&o.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger,e.ActionEvent.CreateNewFromScene(o,t))};var s=this.getEngine();this._onCanvasFocusObserver=s.onCanvasFocusObservable.add((function(){c&&(c.addEventListener("keydown",o._onKeyDown,!1),c.addEventListener("keyup",o._onKeyUp,!1))})),this._onCanvasBlurObserver=s.onCanvasBlurObservable.add((function(){c&&(c.removeEventListener("keydown",o._onKeyDown),c.removeEventListener("keyup",o._onKeyUp))}));var l=e.Tools.GetPointerPrefix(),c=this._engine.getRenderingCanvas();c&&(a&&(c.addEventListener(l+"move",this._onPointerMove,!1),c.addEventListener("mousewheel",this._onPointerMove,!1),c.addEventListener("DOMMouseScroll",this._onPointerMove,!1)),n&&c.addEventListener(l+"down",this._onPointerDown,!1),i&&window.addEventListener(l+"up",this._onPointerUp,!1),c.tabIndex=1)},r.prototype.detachControl=function(){var t=this.getEngine(),i=e.Tools.GetPointerPrefix(),r=t.getRenderingCanvas();r&&(r.removeEventListener(i+"move",this._onPointerMove),r.removeEventListener(i+"down",this._onPointerDown),window.removeEventListener(i+"up",this._onPointerUp),this._onCanvasBlurObserver&&t.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&t.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),r.removeEventListener("mousewheel",this._onPointerMove),r.removeEventListener("DOMMouseScroll",this._onPointerMove),r.removeEventListener("keydown",this._onKeyDown),r.removeEventListener("keyup",this._onKeyUp),this.onKeyboardObservable.clear(),this.onPreKeyboardObservable.clear(),this.onPointerObservable.clear(),this.onPrePointerObservable.clear())},r.prototype.isReady=function(){if(this._isDisposed)return!1;if(this._pendingData.length>0)return!1;var t,i=this.getEngine();for(t=0;t<this.geometries.length;t++){if(this.geometries[__uv.$wrap((t))].delayLoadState===e.Engine.DELAYLOADSTATE_LOADING)return!1}for(t=0;t<this.meshes.length;t++){var r=this.meshes[__uv.$wrap((t))];if(r.isEnabled()&&(r.subMeshes&&0!==r.subMeshes.length)){if(!r.isReady(!0))return!1;for(var n="InstancedMesh"===r.getClassName()||i.getCaps().instancedArrays&&r.instances.length>0,a=0,o=this._isReadyForMeshStage;a<o.length;a++){if(!o[__uv.$wrap((a))].action(r,n))return!1}}}if(this.activeCameras&&this.activeCameras.length>0)for(var s=0,l=this.activeCameras;s<l.length;s++){if(!l[__uv.$wrap((s))].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var c=0,u=this.particleSystems;c<u.length;c++){if(!u[__uv.$wrap((c))].isReady())return!1}return!0},r.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},r.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},r.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},r.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},r.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},r.prototype._executeOnceBeforeRender=function(e){var t=this,i=function(){e(),setTimeout((function(){t.unregisterBeforeRender(i)}))};this.registerBeforeRender(i)},r.prototype.executeOnceBeforeRender=function(e,t){var i=this;void 0!==t?setTimeout((function(){i._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)},r.prototype._addPendingData=function(e){this._pendingData.push(e)},r.prototype._removePendingData=function(e){var t=this.isLoading,i=this._pendingData.indexOf(e);-1!==i&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},r.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(r.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),r.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout((function(){t._checkIsReady()}),150))},r.prototype.whenReadyAsync=function(){var e=this;return new Promise((function(t){e.executeWhenReady((function(){t()}))}))},r.prototype._checkIsReady=function(){var e=this;if(this._registerTransientComponents(),this.isReady())return this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1);this._executeWhenReadyTimeoutId=setTimeout((function(){e._checkIsReady()}),150)},r.prototype.beginWeightedAnimation=function(e,t,i,r,n,a,o,s,l){void 0===r&&(r=1),void 0===a&&(a=1);var c=this.beginAnimation(e,t,i,n,a,o,s,!1,l);return c.weight=r,c},r.prototype.beginAnimation=function(t,i,r,n,a,o,s,l,c){void 0===a&&(a=1),void 0===l&&(l=!0),i>r&&a>0&&(a*=-1),l&&this.stopAnimation(t,void 0,c),s||(s=new e.Animatable(this,t,i,r,n,a,o));var u=!c||c(t);if(t.animations&&u&&s.appendAnimations(t,t.animations),t.getAnimatables)for(var h=t.getAnimatables(),d=0;d<h.length;d++)this.beginAnimation(h[__uv.$wrap((d))],i,r,n,a,o,s,l,c);return s.reset(),s},r.prototype.beginDirectAnimation=function(t,i,r,n,a,o,s){return void 0===o&&(o=1),new e.Animatable(this,t,r,n,a,o,s,i)},r.prototype.beginDirectHierarchyAnimation=function(e,t,i,r,n,a,o,s){var l=e.getDescendants(t),c=[];c.push(this.beginDirectAnimation(e,i,r,n,a,o,s));for(var u=0,h=l;u<h.length;u++){var d=h[__uv.$wrap((u))];c.push(this.beginDirectAnimation(d,i,r,n,a,o,s))}return c},r.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[__uv.$wrap((t))].target===e)return this._activeAnimatables[__uv.$wrap((t))];return null},r.prototype.getAllAnimatablesByTarget=function(e){for(var t=[],i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[__uv.$wrap((i))].target===e&&t.push(this._activeAnimatables[__uv.$wrap((i))]);return t},Object.defineProperty(r.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),r.prototype.stopAnimation=function(e,t,i){for(var r=0,n=this.getAllAnimatablesByTarget(e);r<n.length;r++){n[__uv.$wrap((r))].stop(t,i)}},r.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[__uv.$wrap((e))].stop();this._activeAnimatables=[]}for(var t=0,i=this.animationGroups;t<i.length;t++){i[__uv.$wrap((t))].stop()}},r.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){var t=e.Tools.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}var i=this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale;this._animationTime+=i,this._animationTimeLast=t;for(var r=0;r<this._activeAnimatables.length;r++)this._activeAnimatables[__uv.$wrap((r))]._animate(this._animationTime);this._processLateAnimationBindings()}},r.prototype._registerTargetForLateAnimationBinding=function(e,t){var i=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[__uv.$wrap((e.targetPath))]||(i._lateAnimationHolders[__uv.$wrap((e.targetPath))]={totalWeight:0,animations:[],originalValue:t}),i._lateAnimationHolders[__uv.$wrap((e.targetPath))].animations.push(e),i._lateAnimationHolders[__uv.$wrap((e.targetPath))].totalWeight+=e.weight},r.prototype._processLateAnimationBindingsForMatrices=function(t){var i=1,r=e.Tmp.Vector3[__uv.$wrap((0))],n=e.Tmp.Vector3[__uv.$wrap((1))],a=e.Tmp.Quaternion[__uv.$wrap((0))],o=0,s=t.animations[__uv.$wrap((0))],l=t.originalValue,c=1;if(t.totalWeight<1)l.decompose(n,a,r),c=1-t.totalWeight;else if(o=1,i=t.totalWeight,s.currentValue.decompose(n,a,r),1==(c=s.weight/i))return s.currentValue;n.scaleInPlace(c),r.scaleInPlace(c),a.scaleInPlace(c);for(var u=o;u<t.animations.length;u++){var h=t.animations[__uv.$wrap((u))],d=(c=h.weight/i,e.Tmp.Vector3[__uv.$wrap((2))]),p=e.Tmp.Vector3[__uv.$wrap((3))],m=e.Tmp.Quaternion[__uv.$wrap((1))];h.currentValue.decompose(p,m,d),p.scaleAndAddToRef(c,n),m.scaleAndAddToRef(c,a),d.scaleAndAddToRef(c,r)}return e.Matrix.ComposeToRef(n,a,r,s._workValue),s._workValue},r.prototype._processLateAnimationBindingsForQuaternions=function(t,i){var r=t.animations[__uv.$wrap((0))],n=t.originalValue;if(1===t.animations.length)return e.Quaternion.SlerpToRef(n,r.currentValue,Math.min(1,t.totalWeight),i),i;var a,o,s=1;if(t.totalWeight<1){var l=1-t.totalWeight;o=[],(a=[]).push(n),o.push(l)}else{if(2===t.animations.length)return e.Quaternion.SlerpToRef(t.animations[__uv.$wrap((0))].currentValue,t.animations[__uv.$wrap((1))].currentValue,t.animations[__uv.$wrap((1))].weight/t.totalWeight,i),i;a=[],o=[],s=t.totalWeight}for(var c=0;c<t.animations.length;c++){var u=t.animations[__uv.$wrap((c))];a.push(u.currentValue),o.push(u.weight/s)}for(var h=0,d=null,p=0;p<a.length;)d?(h+=o[__uv.$wrap((p))],e.Quaternion.SlerpToRef(d,a[__uv.$wrap((p))],o[__uv.$wrap((p))]/h,d),p++):(e.Quaternion.SlerpToRef(a[__uv.$wrap((p))],a[__uv.$wrap((p+1))],o[__uv.$wrap((p+1))]/(o[__uv.$wrap((p))]+o[__uv.$wrap((p+1))]),i),d=i,h=o[__uv.$wrap((p))]+o[__uv.$wrap((p+1))],p+=2);return d},r.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var t=0;t<this._registeredForLateAnimationBindings.length;t++){var i=this._registeredForLateAnimationBindings.data[__uv.$wrap((t))];for(var r in i._lateAnimationHolders){var n=i._lateAnimationHolders[__uv.$wrap((r))],a=n.animations[__uv.$wrap((0))],o=n.originalValue,s=e.Animation.AllowMatrixDecomposeForInterpolation&&o.m,l=i[__uv.$wrap((r))];if(s)l=this._processLateAnimationBindingsForMatrices(n);else if(void 0!==o.w)l=this._processLateAnimationBindingsForQuaternions(n,l||e.Quaternion.Identity());else{var c=0,u=1;if(n.totalWeight<1)l=o.scale?o.scale(1-n.totalWeight):o*(1-n.totalWeight);else{u=n.totalWeight;var h=a.weight/u;l=1!==h?a.currentValue.scale?a.currentValue.scale(h):a.currentValue*h:a.currentValue,c=1}for(var d=c;d<n.animations.length;d++){var p=n.animations[__uv.$wrap((d))],m=p.weight/u;p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(m,l):l+=p.currentValue*m}}i[__uv.$wrap((r))]=l}i._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},r.prototype._switchToAlternateCameraConfiguration=function(e){this._useAlternateCameraConfiguration=e},r.prototype.getViewMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateViewMatrix:this._viewMatrix},r.prototype.getProjectionMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateProjectionMatrix:this._projectionMatrix},r.prototype.getTransformMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateTransformMatrix:this._transformMatrix},r.prototype.setTransformMatrix=function(t,i){if(this._viewUpdateFlag!==t.updateFlag||this._projectionUpdateFlag!==i.updateFlag){if(this._viewUpdateFlag=t.updateFlag,this._projectionUpdateFlag=i.updateFlag,this._viewMatrix=t,this._projectionMatrix=i,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix),this.activeCamera&&this.activeCamera._alternateCamera){var r=this.activeCamera._alternateCamera;r.getViewMatrix().multiplyToRef(r.getProjectionMatrix(),e.Tmp.Matrix[__uv.$wrap((0))]),e.Frustum.GetRightPlaneToRef(e.Tmp.Matrix[__uv.$wrap((0))],this._frustumPlanes[__uv.$wrap((3))])}this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update())}},r.prototype._setAlternateTransformMatrix=function(t,i){this._alternateViewUpdateFlag===t.updateFlag&&this._alternateProjectionUpdateFlag===i.updateFlag||(this._alternateViewUpdateFlag=t.updateFlag,this._alternateProjectionUpdateFlag=i.updateFlag,this._alternateViewMatrix=t,this._alternateProjectionMatrix=i,this._alternateTransformMatrix||(this._alternateTransformMatrix=e.Matrix.Zero()),this._alternateViewMatrix.multiplyToRef(this._alternateProjectionMatrix,this._alternateTransformMatrix),this._alternateSceneUbo||this._createAlternateUbo(),this._alternateSceneUbo.useUbo&&(this._alternateSceneUbo.updateMatrix("viewProjection",this._alternateTransformMatrix),this._alternateSceneUbo.updateMatrix("view",this._alternateViewMatrix),this._alternateSceneUbo.update()))},r.prototype.getSceneUniformBuffer=function(){return this._useAlternateCameraConfiguration?this._alternateSceneUbo:this._sceneUbo},r.prototype.getUniqueId=function(){var e=r._uniqueIdCounter;return r._uniqueIdCounter++,e},r.prototype.addMesh=function(e,t){var i=this;void 0===t&&(t=!1),this.meshes.push(e),this.collisionCoordinator&&this.collisionCoordinator.onMeshAdded(e),e._resyncLightSources(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((function(e){i.addMesh(e)}))},r.prototype.removeMesh=function(e,t){var i=this;void 0===t&&(t=!1);var r=this.meshes.indexOf(e);return-1!==r&&this.meshes.splice(r,1),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((function(e){i.removeMesh(e)})),r},r.prototype.addTransformNode=function(e){this.transformNodes.push(e),this.onNewTransformNodeAddedObservable.notifyObservers(e)},r.prototype.removeTransformNode=function(e){var t=this.transformNodes.indexOf(e);return-1!==t&&this.transformNodes.splice(t,1),this.onTransformNodeRemovedObservable.notifyObservers(e),t},r.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&this.skeletons.splice(t,1),t},r.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},r.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var i=0,r=this.meshes;i<r.length;i++){r[__uv.$wrap((i))]._removeLightSource(e)}this.lights.splice(t,1),this.sortLightsByPriority()}return this.onLightRemovedObservable.notifyObservers(e),t},r.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var i=this.activeCameras.indexOf(e);return-1!==i&&this.activeCameras.splice(i,1),this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[__uv.$wrap((0))]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},r.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&this.particleSystems.splice(t,1),t},r.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},r.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},r.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),t},r.prototype.removeMaterial=function(e){var t=this.materials.indexOf(e);return-1!==t&&this.materials.splice(t,1),this.onMaterialRemovedObservable.notifyObservers(e),t},r.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},r.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},r.prototype.addLight=function(e){this.lights.push(e),this.sortLightsByPriority();for(var t=0,i=this.meshes;t<i.length;t++){var r=i[__uv.$wrap((t))];-1===r._lightSources.indexOf(e)&&(r._lightSources.push(e),r._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)},r.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(e.Light.CompareLightsPriority)},r.prototype.addCamera=function(e){this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e)},r.prototype.addSkeleton=function(e){this.skeletons.push(e)},r.prototype.addParticleSystem=function(e){this.particleSystems.push(e)},r.prototype.addAnimation=function(e){this.animations.push(e)},r.prototype.addAnimationGroup=function(e){this.animationGroups.push(e)},r.prototype.addMultiMaterial=function(e){this.multiMaterials.push(e)},r.prototype.addMaterial=function(e){this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e)},r.prototype.addMorphTargetManager=function(e){this.morphTargetManagers.push(e)},r.prototype.addGeometry=function(e){this.geometries.push(e)},r.prototype.addActionManager=function(e){this.actionManagers.push(e)},r.prototype.addTexture=function(e){this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e)},r.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0);var i=this._engine.getRenderingCanvas();i&&(this.activeCamera&&this.activeCamera.detachControl(i),this.activeCamera=e,t&&e.attachControl(i))},r.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},r.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},r.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[__uv.$wrap((t))].name===e)return this.animationGroups[__uv.$wrap((t))];return null},r.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[__uv.$wrap((t))].id===e)return this.materials[__uv.$wrap((t))];return null},r.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[__uv.$wrap((t))].name===e)return this.materials[__uv.$wrap((t))];return null},r.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[__uv.$wrap((t))].id===e)return this.cameras[__uv.$wrap((t))];return null},r.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[__uv.$wrap((t))].uniqueId===e)return this.cameras[__uv.$wrap((t))];return null},r.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[__uv.$wrap((t))].name===e)return this.cameras[__uv.$wrap((t))];return null},r.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[__uv.$wrap((t))],r=0;r<i.bones.length;r++)if(i.bones[__uv.$wrap((r))].id===e)return i.bones[__uv.$wrap((r))];return null},r.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[__uv.$wrap((t))],r=0;r<i.bones.length;r++)if(i.bones[__uv.$wrap((r))].name===e)return i.bones[__uv.$wrap((r))];return null},r.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[__uv.$wrap((t))].name===e)return this.lights[__uv.$wrap((t))];return null},r.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[__uv.$wrap((t))].id===e)return this.lights[__uv.$wrap((t))];return null},r.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[__uv.$wrap((t))].uniqueId===e)return this.lights[__uv.$wrap((t))];return null},r.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[__uv.$wrap((t))].id===e)return this.particleSystems[__uv.$wrap((t))];return null},r.prototype.getGeometryByID=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[__uv.$wrap((t))].id===e)return this.geometries[__uv.$wrap((t))];return null},r.prototype.pushGeometry=function(e,t){return!(!t&&this.getGeometryByID(e.id))&&(this.geometries.push(e),this.collisionCoordinator&&this.collisionCoordinator.onGeometryAdded(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},r.prototype.removeGeometry=function(e){var t=this.geometries.indexOf(e);return t>-1&&(this.geometries.splice(t,1),this.collisionCoordinator&&this.collisionCoordinator.onGeometryDeleted(e),this.onGeometryRemovedObservable.notifyObservers(e),!0)},r.prototype.getGeometries=function(){return this.geometries},r.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[__uv.$wrap((t))].id===e)return this.meshes[__uv.$wrap((t))];return null},r.prototype.getMeshesByID=function(e){return this.meshes.filter((function(t){return t.id===e}))},r.prototype.getTransformNodeByID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[__uv.$wrap((t))].id===e)return this.transformNodes[__uv.$wrap((t))];return null},r.prototype.getTransformNodesByID=function(e){return this.transformNodes.filter((function(t){return t.id===e}))},r.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[__uv.$wrap((t))].uniqueId===e)return this.meshes[__uv.$wrap((t))];return null},r.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[__uv.$wrap((t))].id===e)return this.meshes[__uv.$wrap((t))];return null},r.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[__uv.$wrap((t))].id===e)return this.meshes[__uv.$wrap((t))];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[__uv.$wrap((t))].id===e)return this.transformNodes[__uv.$wrap((t))];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[__uv.$wrap((t))].id===e)return this.cameras[__uv.$wrap((t))];for(t=this.lights.length-1;t>=0;t--)if(this.lights[__uv.$wrap((t))].id===e)return this.lights[__uv.$wrap((t))];return null},r.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var i=this.getLightByID(e);if(i)return i;var r=this.getCameraByID(e);return r||this.getBoneByID(e)},r.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var i=this.getLightByName(e);if(i)return i;var r=this.getCameraByName(e);return r||this.getBoneByName(e)},r.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[__uv.$wrap((t))].name===e)return this.meshes[__uv.$wrap((t))];return null},r.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[__uv.$wrap((t))].name===e)return this.transformNodes[__uv.$wrap((t))];return null},r.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[__uv.$wrap((t))].id===e)return this.skeletons[__uv.$wrap((t))];return null},r.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[__uv.$wrap((t))].id===e)return this.skeletons[__uv.$wrap((t))];return null},r.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[__uv.$wrap((t))].name===e)return this.skeletons[__uv.$wrap((t))];return null},r.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[__uv.$wrap((t))].uniqueId===e)return this.morphTargetManagers[__uv.$wrap((t))];return null},r.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(r.prototype,"uid",{get:function(){return this._uid||(this._uid=e.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),r.prototype.addExternalData=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.add(t,i)},r.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},r.prototype.getOrAddExternalDataWithFactory=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.getOrAddWithFactory(t,i)},r.prototype.removeExternalData=function(e){return this._externalData.remove(e)},r.prototype._evaluateSubMesh=function(e,t){if(this.dispatchAllSubMeshesOfActiveMeshes||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var i=0,r=this._evaluateSubMeshStage;i<r.length;i++){r[__uv.$wrap((i))].action(t,e)}var n=e.getMaterial();null!=n&&(n.hasRenderTargetTextures&&void 0!==n.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(n)&&(this._processedMaterials.push(n),this._renderTargets.concatWithNoDuplicate(n.getRenderTargetTextures())),this._activeIndices.addCount(e.indexCount,!1),this._renderingManager.dispatch(e,t,n))}},r.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},r.prototype.freeActiveMeshes=function(){if(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras)for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[__uv.$wrap((e))];t&&t._activeMeshes&&t._activeMeshes.dispose()}},r.prototype.freeRenderingGroups=function(){if(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures)for(var e=0;e<this.textures.length;e++){var t=this.textures[__uv.$wrap((e))];t&&t.renderList&&t.freeRenderingGroups()}},r.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},r.prototype.freezeActiveMeshes=function(){return this.activeCamera?(this._frustumPlanes||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this):this},r.prototype.unfreezeActiveMeshes=function(){return this._activeMeshesFrozen=!1,this},r.prototype._evaluateActiveMeshes=function(){if((!this._activeMeshesFrozen||!this._activeMeshes.length)&&this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var t=0,i=this._beforeEvaluateActiveMeshStage;t<i.length;t++){i[__uv.$wrap((t))].action()}for(var r=this.getActiveMeshCandidates(),n=r.length,a=0;a<n;a++){var o=r.data[__uv.$wrap((a))];if(!o.isBlocked&&(this._totalVertices.addCount(o.getTotalVertices(),!1),o.isReady()&&o.isEnabled())){o.computeWorldMatrix(),o.actionManager&&o.actionManager.hasSpecificTriggers2(e.ActionManager.OnIntersectionEnterTrigger,e.ActionManager.OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(o);var s=o.getLOD(this.activeCamera);null!=s&&(o._preActivate(),o.isVisible&&o.visibility>0&&(o.alwaysSelectAsActiveMesh||0!=(o.layerMask&this.activeCamera.layerMask)&&o.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(o),this.activeCamera._activeMeshes.push(o),o._activate(this._renderId),s!==o&&s._activate(this._renderId),this._activeMesh(o,s)))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var l=0;l<this.particleSystems.length;l++){var c=this.particleSystems[__uv.$wrap((l))];if(c.isStarted()&&c.emitter){var u=c.emitter;u.position&&!u.isEnabled()||(this._activeParticleSystems.push(c),c.animate(),this._renderingManager.dispatchParticles(c))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},r.prototype._activeMesh=function(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&t.skeleton.prepare(),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));for(var i=0,r=this._activeMeshStage;i<r.length;i++){r[__uv.$wrap((i))].action(e,t)}if(null!=t&&void 0!==t.subMeshes&&null!==t.subMeshes&&t.subMeshes.length>0)for(var n=this.getActiveSubMeshCandidates(t),a=n.length,o=0;o<a;o++){var s=n.data[__uv.$wrap((o))];this._evaluateSubMesh(s,t)}},r.prototype.updateTransformMatrix=function(e){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},r.prototype.updateAlternateTransformMatrix=function(e){this._setAlternateTransformMatrix(e.getViewMatrix(),e.getProjectionMatrix())},r.prototype._renderForCamera=function(t,i){if(!t||!t._skipRendering){var r=this._engine;if(this.activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");r.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.updateTransformMatrix(),t._alternateCamera&&(this.updateAlternateTransformMatrix(t._alternateCamera),this._alternateRendering=!0),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var n=0;n<this._softwareSkinnedMeshes.length;n++){var a=this._softwareSkinnedMeshes.data[__uv.$wrap((n))];a.applySkeleton(a.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),i&&i.customRenderTargets&&i.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(i.customRenderTargets);for(var o=0,s=this._gatherActiveCameraRenderTargetsStage;o<s.length;o++){s[__uv.$wrap((o))].action(this._renderTargets)}if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){e.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var l=0;l<this._renderTargets.length;l++){var c=this._renderTargets.data[__uv.$wrap((l))];if(c._shouldRender()){this._renderId++;var u=c.activeCamera&&c.activeCamera!==this.activeCamera;c.render(u,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var h=0,d=this._cameraDrawRenderTargetStage;h<d.length;h++){d[__uv.$wrap((h))].action(this.activeCamera)}this._intermediateRendering=!1,r.restoreDefaultFramebuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&this.postProcessManager._prepareFrame();for(var p=0,m=this._beforeCameraDrawStage;p<m.length;p++){m[__uv.$wrap((p))].action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var _=0,f=this._afterCameraDrawStage;_<f.length;_++){f[__uv.$wrap((_))].action(this.activeCamera)}this.postProcessManager&&this.postProcessManager._finalizeFrame(t.isIntermediate),this._renderTargets.reset(),this._alternateRendering=!1,this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},r.prototype._processSubCameras=function(t){if(t.cameraRigMode!==e.Camera.RIG_MODE_NONE){for(var i=0;i<t._rigCameras.length;i++)this._renderForCamera(t._rigCameras[__uv.$wrap((i))],t);this.activeCamera=t,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix())}else this._renderForCamera(t)},r.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++){var i=this._meshesForIntersections.data[__uv.$wrap((t))];if(i.actionManager)for(var r=0;r<i.actionManager.actions.length;r++){var n=i.actionManager.actions[__uv.$wrap((r))];if(n.trigger===e.ActionManager.OnIntersectionEnterTrigger||n.trigger===e.ActionManager.OnIntersectionExitTrigger){var a=n.getTriggerParameter(),o=a instanceof e.AbstractMesh?a:a.mesh,s=o.intersectsMesh(i,a.usePreciseIntersection),l=i._intersectionsInProgress.indexOf(o);s&&-1===l?n.trigger===e.ActionManager.OnIntersectionEnterTrigger?(n._executeCurrent(e.ActionEvent.CreateNew(i,void 0,o)),i._intersectionsInProgress.push(o)):n.trigger===e.ActionManager.OnIntersectionExitTrigger&&i._intersectionsInProgress.push(o):!s&&l>-1&&(n.trigger===e.ActionManager.OnIntersectionExitTrigger&&n._executeCurrent(e.ActionEvent.CreateNew(i,void 0,o)),i.actionManager.hasSpecificTrigger(e.ActionManager.OnIntersectionExitTrigger,(function(t){var i=t instanceof e.AbstractMesh?t:t.mesh;return o===i}))&&n.trigger!==e.ActionManager.OnIntersectionExitTrigger||i._intersectionsInProgress.splice(l,1))}}}},r.prototype._advancePhysicsEngineStep=function(e){},r.prototype.render=function(t){if(void 0===t&&(t=!0),!this.isDisposed){if(this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger),this._engine.isDeterministicLockStep()){var i=Math.max(r.MinDeltaTime,Math.min(this._engine.getDeltaTime(),r.MaxDeltaTime))+this._timeAccumulator,n=this.getDeterministicFrameTime(),a=0,o=this._engine.getLockstepMaxSteps(),s=Math.floor(i/60);s=Math.min(s,o);do{this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=.06*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(n),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,a++,i-=n}while(i>0&&a<s);this._timeAccumulator=i<0?0:i}else{i=this.useConstantAnimationDeltaTime?16:Math.max(r.MinDeltaTime,Math.min(this._engine.getDeltaTime(),r.MaxDeltaTime));this._animationRatio=.06*i,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(i)}for(var l=0,c=this._beforeCameraUpdateStage;l<c.length;l++){c[__uv.$wrap((l))].action()}if(t)if(this.activeCameras.length>0)for(var u=0;u<this.activeCameras.length;u++){var h=this.activeCameras[__uv.$wrap((u))];if(h.update(),h.cameraRigMode!==e.Camera.RIG_MODE_NONE)for(var d=0;d<h._rigCameras.length;d++)h._rigCameras[__uv.$wrap((d))].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==e.Camera.RIG_MODE_NONE))for(d=0;d<this.activeCamera._rigCameras.length;d++)this.activeCamera._rigCameras[__uv.$wrap((d))].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var p=this.getEngine(),m=this.activeCamera;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var _=0;_<this.customRenderTargets.length;_++){var f=this.customRenderTargets[__uv.$wrap((_))];if(f._shouldRender()){if(this._renderId++,this.activeCamera=f.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");p.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),f.render(m!==this.activeCamera,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.customRenderTargets.length>0&&p.restoreDefaultFramebuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.activeCamera=m;for(var g=0,y=this._beforeClearStage;g<y.length;g++){y[__uv.$wrap((g))].action()}(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var v=0,b=this._gatherRenderTargetsStage;v<b.length;v++){b[__uv.$wrap((v))].action(this._renderTargets)}if(this.activeCameras.length>0)for(u=0;u<this.activeCameras.length;u++)u>0&&this.activeCameras[__uv.$wrap((u))].autoClear&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[__uv.$wrap((u))]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var x=0,S=this._afterRenderStage;x<S.length;x++){S[__uv.$wrap((x))].action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(d=0;d<this._toBeDisposed.length;d++){var T=this._toBeDisposed[__uv.$wrap((d))];T&&T.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},r.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[__uv.$wrap((e))].freeze()},r.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[__uv.$wrap((e))].unfreeze()},r.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,t=this._components;e<t.length;e++){t[__uv.$wrap((e))].dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var i=0,r=this._activeRequests;i<r.length;i++){r[__uv.$wrap((i))].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.detachControl();var n,a=this._engine.getRenderingCanvas();if(a)for(n=0;n<this.cameras.length;n++)this.cameras[__uv.$wrap((n))].detachControl(a);for(;this.animationGroups.length;)this.animationGroups[__uv.$wrap((0))].dispose();for(;this.lights.length;)this.lights[__uv.$wrap((0))].dispose();for(;this.meshes.length;)this.meshes[__uv.$wrap((0))].dispose(!0);for(;this.transformNodes.length;)this.removeTransformNode(this.transformNodes[__uv.$wrap((0))]);for(;this.cameras.length;)this.cameras[__uv.$wrap((0))].dispose();for(this.defaultMaterial&&this.defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[__uv.$wrap((0))].dispose();for(;this.materials.length;)this.materials[__uv.$wrap((0))].dispose();for(;this.particleSystems.length;)this.particleSystems[__uv.$wrap((0))].dispose();for(;this.postProcesses.length;)this.postProcesses[__uv.$wrap((0))].dispose();for(;this.textures.length;)this.textures[__uv.$wrap((0))].dispose();this._sceneUbo.dispose(),this._alternateSceneUbo&&this._alternateSceneUbo.dispose(),this.postProcessManager.dispose(),(n=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(n,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),r.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[__uv.$wrap((e))].geometry;if(t)for(var i in t._indices=[],t._vertexBuffers)t._vertexBuffers.hasOwnProperty(i)&&(t._vertexBuffers[__uv.$wrap((i))]._buffer._data=null)}},r.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var i=t[__uv.$wrap((e))];i._buffer&&(i._buffer=null)}},r.prototype.getWorldExtends=function(t){var i=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t=t||function(){return!0},this.meshes.filter(t).forEach((function(t){if(t.computeWorldMatrix(!0),t.subMeshes&&0!==t.subMeshes.length&&!t.infiniteDistance){var n=t.getBoundingInfo(),a=n.boundingBox.minimumWorld,o=n.boundingBox.maximumWorld;e.Tools.CheckExtends(a,i,r),e.Tools.CheckExtends(o,i,r)}})),{min:i,max:r}},r.prototype.createPickingRay=function(t,i,r,n,a){void 0===a&&(a=!1);var o=e.Ray.Zero();return this.createPickingRayToRef(t,i,r,o,n,a),o},r.prototype.createPickingRayToRef=function(t,i,r,n,a,o){void 0===o&&(o=!1);var s=this._engine;if(!a){if(!this.activeCamera)throw new Error("Active camera not set");a=this.activeCamera}var l=a.viewport.toGlobal(s.getRenderWidth(),s.getRenderHeight());return t=t/this._engine.getHardwareScalingLevel()-l.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-l.y-l.height),n.update(t,i,l.width,l.height,r||e.Matrix.Identity(),o?e.Matrix.Identity():a.getViewMatrix(),a.getProjectionMatrix()),this},r.prototype.createPickingRayInCameraSpace=function(t,i,r){var n=e.Ray.Zero();return this.createPickingRayInCameraSpaceToRef(t,i,n,r),n},r.prototype.createPickingRayInCameraSpaceToRef=function(t,i,r,n){if(!e.PickingInfo)return this;var a=this._engine;if(!n){if(!this.activeCamera)throw new Error("Active camera not set");n=this.activeCamera}var o=n.viewport.toGlobal(a.getRenderWidth(),a.getRenderHeight()),s=e.Matrix.Identity();return t=t/this._engine.getHardwareScalingLevel()-o.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-o.y-o.height),r.update(t,i,o.width,o.height,s,s,n.getProjectionMatrix()),this},r.prototype._internalPick=function(t,i,r){if(!e.PickingInfo)return null;for(var n=null,a=0;a<this.meshes.length;a++){var o=this.meshes[__uv.$wrap((a))];if(i){if(!i(o))continue}else if(!o.isEnabled()||!o.isVisible||!o.isPickable)continue;var s=t(o.getWorldMatrix()),l=o.intersects(s,r);if(l&&l.hit&&((r||null==n||!(l.distance>=n.distance))&&(n=l,r)))break}return n||new e.PickingInfo},r.prototype._internalMultiPick=function(t,i){if(!e.PickingInfo)return null;for(var r=new Array,n=0;n<this.meshes.length;n++){var a=this.meshes[__uv.$wrap((n))];if(i){if(!i(a))continue}else if(!a.isEnabled()||!a.isVisible||!a.isPickable)continue;var o=t(a.getWorldMatrix()),s=a.intersects(o,!1);s&&s.hit&&r.push(s)}return r},r.prototype.pick=function(t,i,r,n,a){var o=this;if(!e.PickingInfo)return null;var s=this._internalPick((function(e){return o.createPickingRayToRef(t,i,e,o._tempPickingRay,a||null),o._tempPickingRay}),r,n);return s&&(s.ray=this.createPickingRay(t,i,e.Matrix.Identity(),a||null)),s},r.prototype.pickWithRay=function(t,i,r){var n=this,a=this._internalPick((function(i){return n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=e.Matrix.Identity()),i.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=e.Ray.Zero()),e.Ray.TransformToRef(t,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform}),i,r);return a&&(a.ray=t),a},r.prototype.multiPick=function(e,t,i,r){var n=this;return this._internalMultiPick((function(i){return n.createPickingRay(e,t,i,r||null)}),i)},r.prototype.multiPickWithRay=function(t,i){var r=this;return this._internalMultiPick((function(i){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=e.Matrix.Identity()),i.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=e.Ray.Zero()),e.Ray.TransformToRef(t,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform}),i)},r.prototype.setPointerOverMesh=function(t){this._pointerOverMesh!==t&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=t,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)))},r.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},r.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++){t[__uv.$wrap((e))]._rebuild()}for(var i=0,r=this.meshes;i<r.length;i++){r[__uv.$wrap((i))]._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var n=0,a=this._components;n<a.length;n++){a[__uv.$wrap((n))].rebuild()}for(var o=0,s=this.particleSystems;o<s.length;o++){s[__uv.$wrap((o))].rebuild()}},r.prototype._rebuildTextures=function(){for(var t=0,i=this.textures;t<i.length;t++){i[__uv.$wrap((t))]._rebuild()}this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)},r.prototype._getByTags=function(t,i,r){if(void 0===i)return t;var n=[];for(var a in r=r||function(e){},t){var o=t[__uv.$wrap((a))];e.Tags&&e.Tags.MatchesQuery(o,i)&&(n.push(o),r(o))}return n},r.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},r.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},r.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},r.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},r.prototype.setRenderingOrder=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,i,r)},r.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,r)},r.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(r.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(t){this._blockMaterialDirtyMechanism!==t&&(this._blockMaterialDirtyMechanism=t,t||this.markAllMaterialsAsDirty(e.Material.AllDirtyFlag))},enumerable:!0,configurable:!0}),r.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var i=0,r=this.materials;i<r.length;i++){var n=r[__uv.$wrap((i))];t&&!t(n)||n.markAsDirty(e)}},r.prototype._loadFile=function(t,i,r,n,a,o){var s=this,l=e.Tools.LoadFile(t,i,r,n?this.database:void 0,a,o);return this._activeRequests.push(l),l.onCompleteObservable.add((function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)})),l},r.prototype._loadFileAsync=function(e,t,i){var r=this;return new Promise((function(n,a){r._loadFile(e,(function(e){n(e)}),void 0,t,i,(function(e,t){a(t)}))}))},r._uniqueIdCounter=0,r.FOGMODE_NONE=0,r.FOGMODE_EXP=1,r.FOGMODE_EXP2=2,r.FOGMODE_LINEAR=3,r.MinDeltaTime=1,r.MaxDeltaTime=1e3,r.DragMovementThreshold=10,r.LongPressDelay=500,r.DoubleClickDelay=300,r.ExclusiveDoubleClickMode=!1,r}(e.AbstractScene);e.Scene=r}(s||(s={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(e.AbstractScene);e.KeepAssets=t;var i=function(i){function r(e){var t=i.call(this)||this;return t.scene=e,t}return a(r,i),r.prototype.addAllToScene=function(){var e=this;this.cameras.forEach((function(t){e.scene.addCamera(t)})),this.lights.forEach((function(t){e.scene.addLight(t)})),this.meshes.forEach((function(t){e.scene.addMesh(t)})),this.skeletons.forEach((function(t){e.scene.addSkeleton(t)})),this.animations.forEach((function(t){e.scene.addAnimation(t)})),this.animationGroups.forEach((function(t){e.scene.addAnimationGroup(t)})),this.multiMaterials.forEach((function(t){e.scene.addMultiMaterial(t)})),this.materials.forEach((function(t){e.scene.addMaterial(t)})),this.morphTargetManagers.forEach((function(t){e.scene.addMorphTargetManager(t)})),this.geometries.forEach((function(t){e.scene.addGeometry(t)})),this.transformNodes.forEach((function(t){e.scene.addTransformNode(t)})),this.actionManagers.forEach((function(t){e.scene.addActionManager(t)})),this.textures.forEach((function(t){e.scene.addTexture(t)}));for(var t=0,i=this.scene._serializableComponents;t<i.length;t++){i[__uv.$wrap((t))].addFromContainer(this.scene)}},r.prototype.removeAllFromScene=function(){var e=this;this.cameras.forEach((function(t){e.scene.removeCamera(t)})),this.lights.forEach((function(t){e.scene.removeLight(t)})),this.meshes.forEach((function(t){e.scene.removeMesh(t)})),this.skeletons.forEach((function(t){e.scene.removeSkeleton(t)})),this.animations.forEach((function(t){e.scene.removeAnimation(t)})),this.animationGroups.forEach((function(t){e.scene.removeAnimationGroup(t)})),this.multiMaterials.forEach((function(t){e.scene.removeMultiMaterial(t)})),this.materials.forEach((function(t){e.scene.removeMaterial(t)})),this.morphTargetManagers.forEach((function(t){e.scene.removeMorphTargetManager(t)})),this.geometries.forEach((function(t){e.scene.removeGeometry(t)})),this.transformNodes.forEach((function(t){e.scene.removeTransformNode(t)})),this.actionManagers.forEach((function(t){e.scene.removeActionManager(t)})),this.textures.forEach((function(t){e.scene.removeTexture(t)}));for(var t=0,i=this.scene._serializableComponents;t<i.length;t++){i[__uv.$wrap((t))].removeFromContainer(this.scene)}},r.prototype._moveAssets=function(e,t,i){if(e)for(var r=0,n=e;r<n.length;r++){var a=n[__uv.$wrap((r))],o=!0;if(i)for(var s=0,l=i;s<l.length;s++){if(a===l[__uv.$wrap((s))]){o=!1;break}}o&&t.push(a)}},r.prototype.moveAllFromScene=function(e){for(var i in void 0===e&&(e=new t),this)this.hasOwnProperty(i)&&(this[__uv.$wrap((i))]=this[__uv.$wrap((i))]||[],this._moveAssets(this.scene[__uv.$wrap((i))],this[__uv.$wrap((i))],e[__uv.$wrap((i))]));this.removeAllFromScene()},r.prototype.createRootMesh=function(){var t=new e.Mesh("assetContainerRootMesh",this.scene);return this.meshes.forEach((function(e){e.__uv$setSource(__uv).__uv$parent||t.addChild(e)})),this.meshes.unshift(t),t},r}(e.AbstractScene);e.AssetContainer=i}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a,o,s){void 0===n&&(n=0),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),t instanceof e.Mesh?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=r,this._instanced=o,this._data=i,this.byteStride=s?n:n*Float32Array.BYTES_PER_ELEMENT,a||this.create()}return t.prototype.createVertexBuffer=function(t,i,r,n,a,o){void 0===o&&(o=!1);var s=o?i:i*Float32Array.BYTES_PER_ELEMENT,l=n?o?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new e.VertexBuffer(this._engine,this,t,this._updatable,!0,l,void 0===a?this._instanced:a,s,r,void 0,void 0,!0)},t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},t.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},t.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},t.prototype.update=function(e){this.create(e)},t.prototype.updateDirectly=function(e,t,i,r){void 0===r&&(r=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,r?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},t}();e.Buffer=t}(s||(s={})),function(e){var t=function(){function t(i,r,n,a,o,s,l,c,u,h,d,p){if(void 0===d&&(d=!1),void 0===p&&(p=!1),r instanceof e.Buffer?(this._buffer=r,this._ownsBuffer=!1):(this._buffer=new e.Buffer(i,r,a,s,o,l,p),this._ownsBuffer=!0),this._kind=n,null==h){var m=this.getData();this.type=t.FLOAT,m instanceof Int8Array?this.type=t.BYTE:m instanceof Uint8Array?this.type=t.UNSIGNED_BYTE:m instanceof Int16Array?this.type=t.SHORT:m instanceof Uint16Array?this.type=t.UNSIGNED_SHORT:m instanceof Int32Array?this.type=t.INT:m instanceof Uint32Array&&(this.type=t.UNSIGNED_INT)}else this.type=h;var _=t.GetTypeByteLength(this.type);p?(this._size=u||(s?s/_:t.DeduceStride(n)),this.byteStride=s||this._buffer.byteStride||this._size*_,this.byteOffset=c||0):(this._size=u||s||t.DeduceStride(n),this.byteStride=s?s*_:this._buffer.byteStride||this._size*_,this.byteOffset=(c||0)*_),this.normalized=d,this._instanced=void 0!==l&&l,this._instanceDivisor=l?1:0}return Object.defineProperty(t.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},t.prototype.getKind=function(){return this._kind},t.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},t.prototype.getData=function(){return this._buffer.getData()},t.prototype.getBuffer=function(){return this._buffer.getBuffer()},t.prototype.getStrideSize=function(){return this.byteStride/t.GetTypeByteLength(this.type)},t.prototype.getOffset=function(){return this.byteOffset/t.GetTypeByteLength(this.type)},t.prototype.getSize=function(){return this._size},t.prototype.getIsInstanced=function(){return this._instanced},t.prototype.getInstanceDivisor=function(){return this._instanceDivisor},t.prototype.create=function(e){this._buffer.create(e)},t.prototype.update=function(e){this._buffer.update(e)},t.prototype.updateDirectly=function(e,t,i){void 0===i&&(i=!1),this._buffer.updateDirectly(e,t,void 0,i)},t.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},t.prototype.forEach=function(e,i){t.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,i)},t.DeduceStride=function(e){switch(e){case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:return 2;case t.NormalKind:case t.PositionKind:return 3;case t.ColorKind:case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:case t.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},t.GetTypeByteLength=function(e){switch(e){case t.BYTE:case t.UNSIGNED_BYTE:return 1;case t.SHORT:case t.UNSIGNED_SHORT:return 2;case t.INT:case t.FLOAT:return 4;default:throw new Error("Invalid type '"+e+"'")}},t.ForEach=function(e,i,r,n,a,o,s,l){if(e instanceof Array)for(var c=i/4,u=r/4,h=0;h<o;h+=n){for(var d=0;d<n;d++)l(e[__uv.$wrap((c+d))],h+d);c+=u}else{var p=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),m=t.GetTypeByteLength(a);for(h=0;h<o;h+=n){var _=i;for(d=0;d<n;d++){l(t._GetFloatValue(p,a,_,s),h+d),_+=m}i+=r}}},t._GetFloatValue=function(e,i,r,n){switch(i){case t.BYTE:var a=e.getInt8(r);return n&&(a=Math.max(a/127,-1)),a;case t.UNSIGNED_BYTE:a=e.getUint8(r);return n&&(a/=255),a;case t.SHORT:a=e.getInt16(r,!0);return n&&(a=Math.max(a/16383,-1)),a;case t.UNSIGNED_SHORT:a=e.getUint16(r,!0);return n&&(a/=65535),a;case t.FLOAT:return e.getFloat32(r,!0);default:throw new Error("Invalid component type "+i)}},t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.PositionKind="position",t.NormalKind="normal",t.TangentKind="tangent",t.UVKind="uv",t.UV2Kind="uv2",t.UV3Kind="uv3",t.UV4Kind="uv4",t.UV5Kind="uv5",t.UV6Kind="uv6",t.ColorKind="color",t.MatricesIndicesKind="matricesIndices",t.MatricesWeightsKind="matricesWeights",t.MatricesIndicesExtraKind="matricesIndicesExtra",t.MatricesWeightsExtraKind="matricesWeightsExtra",t}();e.VertexBuffer=t}(s||(s={})),function(e){var t=function(){this.previous=null,this.next=null};e.DummyInternalTextureTracker=t}(s||(s={})),function(e){var t=function(){function t(i,r){this.onLoadedObservable=new e.Observable,this.previous=null,this.next=null,this._initialSlot=-1,this._designatedSlot=-1,this._dataSource=t.DATASOURCE_UNKNOWN,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._isRGBD=!1,this._references=1,this._engine=i,this._dataSource=r,this._webGLTexture=i._createTexture()}return t.prototype.getEngine=function(){return this._engine},Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),t.prototype.incrementReferences=function(){this._references++},t.prototype.updateSize=function(e,t,i){void 0===i&&(i=1),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i},t.prototype._rebuild=function(){var i,r=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this._dataSource){case t.DATASOURCE_TEMP:return;case t.DATASOURCE_URL:return void(i=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){r.isReady=!0}),null,this._buffer,void 0,this.format))._swapAndDie(this);case t.DATASOURCE_RAW:return(i=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_RAW3D:return(i=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_DYNAMIC:return void(i=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this);case t.DATASOURCE_RENDERTARGET:var n=new e.RenderTargetCreationOptions;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)i=this._engine.createRenderTargetCubeTexture(this.width,n);else{var a={width:this.width,height:this.height};i=this._engine.createRenderTargetTexture(a,n)}return i._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_DEPTHTEXTURE:var o={bilinearFiltering:this.samplingMode!==e.Texture.BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube};return(i=this._engine.createDepthStencilTexture({width:this.width,height:this.height},o))._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_CUBE:return void(i=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){r.isReady=!0}),null,this.format,this._extension))._swapAndDie(this);case t.DATASOURCE_CUBERAW:return(i=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_CUBERAW_RGBD:return i=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),e.RawCubeTexture._UpdateRGBDAsync(i,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then((function(){r.isReady=!0})),void i._swapAndDie(this);case t.DATASOURCE_CUBEPREFILTERED:return void((i=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(r),r.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},t.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow);var t=this._engine.getLoadedTexturesCache(),i=t.indexOf(this);-1!==i&&t.splice(i,1)},t.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null,this.previous=null,this.next=null))},t.DATASOURCE_UNKNOWN=0,t.DATASOURCE_URL=1,t.DATASOURCE_TEMP=2,t.DATASOURCE_RAW=3,t.DATASOURCE_DYNAMIC=4,t.DATASOURCE_RENDERTARGET=5,t.DATASOURCE_MULTIRENDERTARGET=6,t.DATASOURCE_CUBE=7,t.DATASOURCE_CUBERAW=8,t.DATASOURCE_CUBEPREFILTERED=9,t.DATASOURCE_RAW3D=10,t.DATASOURCE_DEPTHTEXTURE=11,t.DATASOURCE_CUBERAW_RGBD=12,t}();e.InternalTexture=t}(s||(s={})),function(e){var t=function(){function t(i){this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=e.Texture.EXPLICIT_MODE,this.wrapU=e.Texture.WRAP_ADDRESSMODE,this.wrapV=e.Texture.WRAP_ADDRESSMODE,this.wrapR=e.Texture.WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.isCube=!1,this.is3D=!1,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new e.Observable,this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._cachedSize=e.Size.Zero(),this._scene=i||e.Engine.LastCreatedScene,this._scene&&(this._scene.textures.push(this),this._scene.onNewTextureAddedObservable.notifyObservers(this)),this._uid=null}return Object.defineProperty(t.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._scene&&this._scene.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag|e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(t){this._coordinatesMode!==t&&(this._coordinatesMode=t,this._scene&&this._scene.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=e.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.name},t.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getTextureMatrix=function(){return e.Matrix.IdentityReadOnly},t.prototype.getReflectionTextureMatrix=function(){return e.Matrix.IdentityReadOnly},t.prototype.getInternalTexture=function(){return this._texture},t.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},t.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},t.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new e.Size(this._texture._size,this._texture._size):new e.Size(this._texture.baseWidth,this._texture.baseHeight):e.Size.Zero()},t.prototype.scale=function(e){},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._getFromCache=function(e,t,i){if(!this._scene)return null;for(var r=this._scene.getEngine().getLoadedTexturesCache(),n=0;n<r.length;n++){var a=r[__uv.$wrap((n))];if(a.url===e&&a.generateMipMaps===!t&&(!i||i===a.samplingMode))return a.incrementReferences(),a}return null},t.prototype._rebuild=function(){},t.prototype.delayLoad=function(){},t.prototype.clone=function(){return null},Object.defineProperty(t.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:e.Engine.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:e.Engine.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),t.prototype.readPixels=function(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=null),!this._texture)return null;var r=this.getSize(),n=r.width,a=r.height,o=this.getScene();if(!o)return null;var s=o.getEngine();return 0!=t&&(n/=Math.pow(2,t),a/=Math.pow(2,t),n=Math.round(n),a=Math.round(a)),this._texture.isCube?s._readTexturePixels(this._texture,n,a,e,t,i):s._readTexturePixels(this._texture,n,a,-1,t,i)},t.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(t.prototype,"sphericalPolynomial",{get:function(){return this._texture&&e.CubeMapToSphericalPolynomialTools&&this.isReady()?(this._texture._sphericalPolynomial||(this._texture._sphericalPolynomial=e.CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this)),this._texture._sphericalPolynomial):null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},t.prototype.serialize=function(){if(!this.name)return null;var t=e.SerializationHelper.Serialize(this);return e.Animation.AppendSerializedAnimations(this,t),t},t.WhenAllReady=function(e,t){var i=e.length;if(0!==i)for(var r,n,a=function(){if((r=e[__uv.$wrap((o))]).isReady())0==--i&&t();else{n=r.onLoadObservable;var a=function(){n.removeCallback(a),0==--i&&t()};n.add(a)}},o=0;o<e.length;o++)a();else t()},t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,n([e.serialize()],t.prototype,"name",void 0),n([e.serialize("hasAlpha")],t.prototype,"_hasAlpha",void 0),n([e.serialize()],t.prototype,"getAlphaFromRGB",void 0),n([e.serialize()],t.prototype,"level",void 0),n([e.serialize()],t.prototype,"coordinatesIndex",void 0),n([e.serialize("coordinatesMode")],t.prototype,"_coordinatesMode",void 0),n([e.serialize()],t.prototype,"wrapU",void 0),n([e.serialize()],t.prototype,"wrapV",void 0),n([e.serialize()],t.prototype,"wrapR",void 0),n([e.serialize()],t.prototype,"anisotropicFilteringLevel",void 0),n([e.serialize()],t.prototype,"isCube",void 0),n([e.serialize()],t.prototype,"is3D",void 0),n([e.serialize()],t.prototype,"gammaSpace",void 0),n([e.serialize()],t.prototype,"invertZ",void 0),n([e.serialize()],t.prototype,"lodLevelInAlpha",void 0),n([e.serialize()],t.prototype,"lodGenerationOffset",null),n([e.serialize()],t.prototype,"lodGenerationScale",null),n([e.serialize()],t.prototype,"isRenderTarget",void 0),t}();e.BaseTexture=t}(s||(s={})),function(e){var t=function(t){function i(r,n,a,o,s,l,c,u,h,d){void 0===a&&(a=!1),void 0===o&&(o=!0),void 0===s&&(s=i.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=!1);var p=t.call(this,n)||this;if(p.uOffset=0,p.vOffset=0,p.uScale=1,p.vScale=1,p.uAng=0,p.vAng=0,p.wAng=0,p.uRotationCenter=.5,p.vRotationCenter=.5,p.wRotationCenter=.5,p.onLoadObservable=new e.Observable,p._isBlocking=!0,p.name=r||"",p.url=r,p._noMipmap=a,p._invertY=o,p._samplingMode=s,p._buffer=u,p._deleteBuffer=h,d&&(p._format=d),!(n=p.getScene()))return p;n.getEngine().onBeforeTextureInitObservable.notifyObservers(p);var m=function(){p.onLoadObservable.hasObservers()&&p.onLoadObservable.notifyObservers(p),l&&l(),!p.isBlocking&&n&&n.resetCachedMaterial()};return p.url?(p._texture=p._getFromCache(p.url,a,s),p._texture?p._texture.isReady?e.Tools.SetImmediate((function(){return m()})):p._texture.onLoadedObservable.add(m):n.useDelayedTextureLoading?(p.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,p._delayedOnLoad=m,p._delayedOnError=c):(p._texture=n.getEngine().createTexture(p.url,a,o,n,p._samplingMode,m,c,p._buffer,void 0,p._format),h&&delete p._buffer),p):(p._delayedOnLoad=m,p._delayedOnError=c,p)}return a(i,t),Object.defineProperty(i.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"samplingMode",{get:function(){return this._samplingMode},enumerable:!0,configurable:!0}),i.prototype.updateURL=function(t,i){if(void 0===i&&(i=null),this.url)throw new Error("URL is already set");this.url=t,this._buffer=i,this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,this.delayLoad()},i.prototype.delayLoad=function(){if(this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED){var t=this.getScene();t&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture?this._delayedOnLoad&&(this._texture.isReady?e.Tools.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=t.getEngine().createTexture(this.url,this._noMipmap,this._invertY,t,this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},i.prototype.updateSamplingMode=function(e){if(this._texture){var t=this.getScene();t&&(this._samplingMode=e,t.getEngine().updateTextureSamplingMode(e,this._texture))}},i.prototype._prepareRowForTextureGeneration=function(t,i,r,n){t*=this.uScale,i*=this.vScale,t-=this.uRotationCenter*this.uScale,i-=this.vRotationCenter*this.vScale,r-=this.wRotationCenter,e.Vector3.TransformCoordinatesFromFloatsToRef(t,i,r,this._rowGenerationMatrix,n),n.x+=this.uRotationCenter*this.uScale+this.uOffset,n.y+=this.vRotationCenter*this.vScale+this.vOffset,n.z+=this.wRotationCenter},i.prototype.getTextureMatrix=function(){var t=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero(),this._rowGenerationMatrix=new e.Matrix,this._t0=e.Vector3.Zero(),this._t1=e.Vector3.Zero(),this._t2=e.Vector3.Zero()),e.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[__uv.$wrap((0))]=this._t1.x,this._cachedTextureMatrix.m[__uv.$wrap((1))]=this._t1.y,this._cachedTextureMatrix.m[__uv.$wrap((2))]=this._t1.z,this._cachedTextureMatrix.m[__uv.$wrap((4))]=this._t2.x,this._cachedTextureMatrix.m[__uv.$wrap((5))]=this._t2.y,this._cachedTextureMatrix.m[__uv.$wrap((6))]=this._t2.z,this._cachedTextureMatrix.m[__uv.$wrap((8))]=this._t0.x,this._cachedTextureMatrix.m[__uv.$wrap((9))]=this._t0.y,this._cachedTextureMatrix.m[__uv.$wrap((10))]=this._t0.z;var i=this.getScene();return i?(i.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag,(function(e){return e.hasTexture(t)})),this._cachedTextureMatrix):this._cachedTextureMatrix},i.prototype.getReflectionTextureMatrix=function(){var t=this,r=this.getScene();if(!r)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==i.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===r.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=e.Matrix.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case i.PLANAR_MODE:e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[__uv.$wrap((0))]=this.uScale,this._cachedTextureMatrix[__uv.$wrap((5))]=this.vScale,this._cachedTextureMatrix[__uv.$wrap((12))]=this.uOffset,this._cachedTextureMatrix[__uv.$wrap((13))]=this.vOffset;break;case i.PROJECTION_MODE:e.Matrix.IdentityToRef(this._projectionModeMatrix),this._projectionModeMatrix.m[__uv.$wrap((0))]=.5,this._projectionModeMatrix.m[__uv.$wrap((5))]=-.5,this._projectionModeMatrix.m[__uv.$wrap((10))]=0,this._projectionModeMatrix.m[__uv.$wrap((12))]=.5,this._projectionModeMatrix.m[__uv.$wrap((13))]=.5,this._projectionModeMatrix.m[__uv.$wrap((14))]=1,this._projectionModeMatrix.m[__uv.$wrap((15))]=1;var n=r.getProjectionMatrix();this._cachedProjectionMatrixId=n.updateFlag,n.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:e.Matrix.IdentityToRef(this._cachedTextureMatrix)}return r.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag,(function(e){return-1!==e.getActiveTextures().indexOf(t)})),this._cachedTextureMatrix},i.prototype.clone=function(){var t=this;return e.SerializationHelper.Clone((function(){return new i(t._texture?t._texture.url:null,t.getScene(),t._noMipmap,t._invertY,t._samplingMode)}),this)},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return"string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)&&(e.base64String=this._buffer,e.name=e.name.replace("data:","")),e.invertY=this._invertY,e.samplingMode=this.samplingMode,e},i.prototype.getClassName=function(){return"Texture"},i.prototype.dispose=function(){t.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},i.Parse=function(t,r,n){if(t.customType){var a=e.Tools.Instantiate(t.customType).Parse(t,r,n);return t.samplingMode&&a.updateSamplingMode&&a._samplingMode&&a._samplingMode!==t.samplingMode&&a.updateSamplingMode(t.samplingMode),a}if(t.isCube)return e.CubeTexture.Parse(t,r,n);if(!t.name&&!t.isRenderTarget)return null;var o=e.SerializationHelper.Parse((function(){var a,o=!0;if(t.noMipmap&&(o=!1),t.mirrorPlane){var s=new e.MirrorTexture(t.name,t.renderTargetSize,r,o);return s._waitingRenderList=t.renderList,s.mirrorPlane=e.Plane.FromArray(t.mirrorPlane),s}if(t.isRenderTarget){var l=new e.RenderTargetTexture(t.name,t.renderTargetSize,r,o);return l._waitingRenderList=t.renderList,l}if(t.base64String)a=i.CreateFromBase64String(t.base64String,t.name,r,!o);else{var c=n+t.name;i.UseSerializedUrlIfAny&&t.url&&(c=t.url),a=new i(c,r,!o,t.invertY)}return a}),t,r);if(t.samplingMode){var s=t.samplingMode;o._samplingMode!==s&&o.updateSamplingMode(s)}if(t.animations)for(var l=0;l<t.animations.length;l++){var c=t.animations[__uv.$wrap((l))];o.animations.push(e.Animation.Parse(c))}return o},i.CreateFromBase64String=function(t,r,n,a,o,s,l,c,u){return void 0===s&&(s=i.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=e.Engine.TEXTUREFORMAT_RGBA),new i("data:"+r,n,a,o,s,l,c,t,!1,u)},i.LoadFromDataString=function(t,r,n,a,o,s,l,c,u,h){return void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=!0),void 0===l&&(l=i.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=e.Engine.TEXTUREFORMAT_RGBA),"data:"!==t.substr(0,5)&&(t="data:"+t),new i(t,n,o,s,l,c,u,r,a,h)},i.NEAREST_SAMPLINGMODE=e.Engine.TEXTURE_NEAREST_SAMPLINGMODE,i.NEAREST_NEAREST_MIPLINEAR=e.Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR,i.BILINEAR_SAMPLINGMODE=e.Engine.TEXTURE_BILINEAR_SAMPLINGMODE,i.LINEAR_LINEAR_MIPNEAREST=e.Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST,i.TRILINEAR_SAMPLINGMODE=e.Engine.TEXTURE_TRILINEAR_SAMPLINGMODE,i.LINEAR_LINEAR_MIPLINEAR=e.Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR,i.NEAREST_NEAREST_MIPNEAREST=e.Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST,i.NEAREST_LINEAR_MIPNEAREST=e.Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST,i.NEAREST_LINEAR_MIPLINEAR=e.Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR,i.NEAREST_LINEAR=e.Engine.TEXTURE_NEAREST_LINEAR,i.NEAREST_NEAREST=e.Engine.TEXTURE_NEAREST_NEAREST,i.LINEAR_NEAREST_MIPNEAREST=e.Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST,i.LINEAR_NEAREST_MIPLINEAR=e.Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR,i.LINEAR_LINEAR=e.Engine.TEXTURE_LINEAR_LINEAR,i.LINEAR_NEAREST=e.Engine.TEXTURE_LINEAR_NEAREST,i.EXPLICIT_MODE=e.Engine.TEXTURE_EXPLICIT_MODE,i.SPHERICAL_MODE=e.Engine.TEXTURE_SPHERICAL_MODE,i.PLANAR_MODE=e.Engine.TEXTURE_PLANAR_MODE,i.CUBIC_MODE=e.Engine.TEXTURE_CUBIC_MODE,i.PROJECTION_MODE=e.Engine.TEXTURE_PROJECTION_MODE,i.SKYBOX_MODE=e.Engine.TEXTURE_SKYBOX_MODE,i.INVCUBIC_MODE=e.Engine.TEXTURE_INVCUBIC_MODE,i.EQUIRECTANGULAR_MODE=e.Engine.TEXTURE_EQUIRECTANGULAR_MODE,i.FIXED_EQUIRECTANGULAR_MODE=e.Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,i.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=e.Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,i.CLAMP_ADDRESSMODE=e.Engine.TEXTURE_CLAMP_ADDRESSMODE,i.WRAP_ADDRESSMODE=e.Engine.TEXTURE_WRAP_ADDRESSMODE,i.MIRROR_ADDRESSMODE=e.Engine.TEXTURE_MIRROR_ADDRESSMODE,i.UseSerializedUrlIfAny=!1,n([e.serialize()],i.prototype,"url",void 0),n([e.serialize()],i.prototype,"uOffset",void 0),n([e.serialize()],i.prototype,"vOffset",void 0),n([e.serialize()],i.prototype,"uScale",void 0),n([e.serialize()],i.prototype,"vScale",void 0),n([e.serialize()],i.prototype,"uAng",void 0),n([e.serialize()],i.prototype,"vAng",void 0),n([e.serialize()],i.prototype,"wAng",void 0),n([e.serialize()],i.prototype,"uRotationCenter",void 0),n([e.serialize()],i.prototype,"vRotationCenter",void 0),n([e.serialize()],i.prototype,"wRotationCenter",void 0),n([e.serialize()],i.prototype,"isBlocking",null),i}(e.BaseTexture);e.Texture=t}(s||(s={})),function(e){var t=function(){};e._CreationDataStorage=t;var i=function(){this.visibleInstances={},this.renderIdForInstances=new Array,this.batchCache=new r,this.instancesBufferSize=2048},r=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array};e._InstancesBatch=r;var n=function(t){function r(n,a,o,s,l,c){void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=!0);var u=t.call(this,n,a)||this;if(u.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,u.instances=new Array,u._LODLevels=new Array,u._instanceDataStorage=new i,u._originalBuilderSideOrientation=r.DEFAULTSIDE,u.overrideMaterialSideOrientation=null,u._areNormalsFrozen=!1,u._source=null,a=u.getScene(),s){if(s._geometry&&s._geometry.applyToMesh(u),e.Tools.DeepCopy(s,u,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw"],["_poseMatrix"]),u._source=s,u._originalBuilderSideOrientation=s._originalBuilderSideOrientation,u._creationDataStorage=s._creationDataStorage,u._source._ranges){var h=u._source._ranges;for(var n in h)h.hasOwnProperty(n)&&h[__uv.$wrap((n))]&&u.createAnimationRange(n,h[__uv.$wrap((n))].from,h[__uv.$wrap((n))].to)}var d;if(s.metadata&&s.metadata.clone?u.metadata=s.metadata.clone():u.metadata=s.metadata,e.Tags&&e.Tags.HasTags(s)&&e.Tags.AddTagsTo(u,e.Tags.GetTags(s,!0)),u.__uv$setSource(__uv).__uv$parent=s.__uv$setSource(__uv).__uv$parent,u.setPivotMatrix(s.getPivotMatrix()),u.id=n+"."+s.id,u.material=s.material,!l)for(var p=s.getDescendants(!0),m=0;m<p.length;m++){var _=p[__uv.$wrap((m))];_.clone&&_.clone(n+"."+_.name,u)}var f=u.getScene().getPhysicsEngine();if(c&&f){var g=f.getImpostorForPhysicsObject(s);g&&(u.physicsImpostor=g.clone(u))}for(d=0;d<a.particleSystems.length;d++){var y=a.particleSystems[__uv.$wrap((d))];y.emitter===s&&y.clone(y.name,u)}u.refreshBoundingInfo(),u.computeWorldMatrix(!0)}return null!==o&&(u.__uv$setSource(__uv).__uv$parent=o),u}return a(r,t),Object.defineProperty(r.prototype,"onBeforeRenderObservable",{get:function(){return this._onBeforeRenderObservable||(this._onBeforeRenderObservable=new e.Observable),this._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onAfterRenderObservable",{get:function(){return this._onAfterRenderObservable||(this._onAfterRenderObservable=new e.Observable),this._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBeforeDrawObservable",{get:function(){return this._onBeforeDrawObservable||(this._onBeforeDrawObservable=new e.Observable),this._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"morphTargetManager",{get:function(){return this._morphTargetManager},set:function(e){this._morphTargetManager!==e&&(this._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"Mesh"},r.prototype.toString=function(i){var r=t.prototype.toString.call(this,i);if(r+=", n vertices: "+this.getTotalVertices(),r+=", parent: "+(this._waitingParentId?this._waitingParentId:this.__uv$setSource(__uv).__uv$parent?this.__uv$setSource(__uv).__uv$parent.name:"NONE"),this.animations)for(var n=0;n<this.animations.length;n++)r+=", animation[0]: "+this.animations[__uv.$wrap((n))].toString(i);if(i)if(this._geometry){var a=this.getIndices(),o=this.getVerticesData(e.VertexBuffer.PositionKind);o&&a&&(r+=", flat shading: "+(o.length/3===a.length?"YES":"NO"))}else r+=", flat shading: UNKNOWN";return r},r.prototype._unBindEffect=function(){t.prototype._unBindEffect.call(this);for(var e=0,i=this.instances;e<i.length;e++){i[__uv.$wrap((e))]._unBindEffect()}},Object.defineProperty(r.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),r.prototype.getLODLevels=function(){return this._LODLevels},r.prototype._sortLODLevels=function(){this._LODLevels.sort((function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0}))},r.prototype.addLODLevel=function(t,i){if(i&&i._masterMesh)return e.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var r=new e.MeshLODLevel(t,i);return this._LODLevels.push(r),i&&(i._masterMesh=this),this._sortLODLevels(),this},r.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var i=this._LODLevels[__uv.$wrap((t))];if(i.distance===e)return i.mesh}return null},r.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[__uv.$wrap((t))].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},r.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var i;t?i=t:i=this.getBoundingInfo().boundingSphere;var r=i.centerWorld.subtract(e.globalPosition).length();if(this._LODLevels[__uv.$wrap((this._LODLevels.length-1))].distance>r)return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this._LODLevels[__uv.$wrap((this._LODLevels.length-1))].mesh),this;for(var n=0;n<this._LODLevels.length;n++){var a=this._LODLevels[__uv.$wrap((n))];if(a.distance<r)return a.mesh&&(a.mesh._preActivate(),a.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(r,this,a.mesh),a.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this},Object.defineProperty(r.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),r.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},r.prototype.getVerticesData=function(e,t,i){return this._geometry?this._geometry.getVerticesData(e,t,i):null},r.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},r.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},r.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},r.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach((function(t,i,r){e.push(t)})),e}return this._geometry.getVerticesDataKinds()},r.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},r.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(r.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),r.prototype.isReady=function(i,r){if(void 0===i&&(i=!1),void 0===r&&(r=!1),this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING)return!1;if(!t.prototype.isReady.call(this,i))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!i)return!0;var n=this.getEngine(),a=this.getScene(),o=r||n.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var s=this.material||a.defaultMaterial;if(s)if(s.storeEffectOnSubMeshes)for(var l=0,c=this.subMeshes;l<c.length;l++){var u=(f=c[__uv.$wrap((l))]).getMaterial();if(u)if(u.storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(this,f,o))return!1}else if(!u.isReady(this,o))return!1}else if(!s.isReady(this,o))return!1;for(var h=0,d=this._lightSources;h<d.length;h++){var p=d[__uv.$wrap((h))].getShadowGenerator();if(p)for(var m=0,_=this.subMeshes;m<_.length;m++){var f=_[__uv.$wrap((m))];if(!p.isReady(f,o))return!1}}for(var g=0,y=this._LODLevels;g<y.length;g++){var v=y[__uv.$wrap((g))];if(v.mesh&&!v.mesh.isReady(o))return!1}return!0},Object.defineProperty(r.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),r.prototype.freezeNormals=function(){return this._areNormalsFrozen=!0,this},r.prototype.unfreezeNormals=function(){return this._areNormalsFrozen=!1,this},Object.defineProperty(r.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),r.prototype._preActivate=function(){var e=this.getScene().getRenderId();return this._preActivateId===e||(this._preActivateId=e,this._instanceDataStorage.visibleInstances=null),this},r.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},r.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={},this._instanceDataStorage.visibleInstances.defaultRenderId=t,this._instanceDataStorage.visibleInstances.selfDefaultRenderId=this._renderId),this._instanceDataStorage.visibleInstances[__uv.$wrap((t))]||(this._instanceDataStorage.visibleInstances[__uv.$wrap((t))]=new Array),this._instanceDataStorage.visibleInstances[__uv.$wrap((t))].push(e),this},r.prototype.refreshBoundingInfo=function(){return this._refreshBoundingInfo(!1)},r.prototype._refreshBoundingInfo=function(t){if(this._boundingInfo&&this._boundingInfo.isLocked)return this;var i=this._getPositionData(t);if(i){var r=this.geometry?this.geometry.boundingBias:null,n=e.Tools.ExtractMinAndMax(i,0,this.getTotalVertices(),r);this._boundingInfo=new e.BoundingInfo(n.minimum,n.maximum)}if(this.subMeshes)for(var a=0;a<this.subMeshes.length;a++)this.subMeshes[__uv.$wrap((a))].refreshBoundingInfo();return this._updateBoundingInfo(),this},r.prototype._getPositionData=function(t){var i=this.getVerticesData(e.VertexBuffer.PositionKind);if(i&&t&&this.skeleton){i=e.Tools.Slice(i);var r=this.getVerticesData(e.VertexBuffer.MatricesIndicesKind),n=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind);if(n&&r)for(var a=this.numBoneInfluencers>4,o=a?this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind):null,s=a?this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this),c=e.Tmp.Vector3[__uv.$wrap((0))],u=e.Tmp.Matrix[__uv.$wrap((0))],h=e.Tmp.Matrix[__uv.$wrap((1))],d=0,p=0;p<i.length;p+=3,d+=4){var m,_;for(u.reset(),m=0;m<4;m++)(_=n[__uv.$wrap((d+m))])>0&&(e.Matrix.FromFloat32ArrayToRefScaled(l,Math.floor(16*r[__uv.$wrap((d+m))]),_,h),u.addToSelf(h));if(a)for(m=0;m<4;m++)(_=s[__uv.$wrap((d+m))])>0&&(e.Matrix.FromFloat32ArrayToRefScaled(l,Math.floor(16*o[__uv.$wrap((d+m))]),_,h),u.addToSelf(h));e.Vector3.TransformCoordinatesFromFloatsToRef(i[__uv.$wrap((p))],i[__uv.$wrap((p+1))],i[__uv.$wrap((p+2))],u,c),c.toArray(i,p)}}return i},r.prototype._createGlobalSubMesh=function(t){var i=this.getTotalVertices();if(!i||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var r=this.getIndices();if(!r)return null;var n=r.length,a=!1;if(t)a=!0;else for(var o=0,s=this.subMeshes;o<s.length;o++){var l=s[__uv.$wrap((o))];if(l.indexStart+l.indexCount>=n){a=!0;break}if(l.verticesStart+l.verticesCount>=i){a=!0;break}}if(!a)return this.subMeshes[__uv.$wrap((0))]}return this.releaseSubMeshes(),new e.SubMesh(0,0,i,0,this.getTotalIndices(),this)},r.prototype.subdivide=function(t){if(!(t<1)){for(var i=this.getTotalIndices(),r=i/t|0,n=0;r%3!=0;)r++;this.releaseSubMeshes();for(var a=0;a<t&&!(n>=i);a++)e.SubMesh.CreateFromIndices(0,n,Math.min(r,i-n),this),n+=r;this.synchronizeInstances()}},r.prototype.setVerticesData=function(t,i,r,n){if(void 0===r&&(r=!1),this._geometry)this._geometry.setVerticesData(t,i,r,n);else{var a=new e.VertexData;a.set(i,t);var o=this.getScene();new e.Geometry(e.Geometry.RandomId(),o,a,r,this)}return this},r.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},r.prototype.setVerticesBuffer=function(t){return this._geometry||(this._geometry=e.Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(t),this},r.prototype.updateVerticesData=function(e,t,i,r){return this._geometry?(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this},r.prototype.updateMeshPositions=function(t,i){void 0===i&&(i=!0);var r=this.getVerticesData(e.VertexBuffer.PositionKind);if(!r)return this;if(t(r),this.updateVerticesData(e.VertexBuffer.PositionKind,r,!1,!1),i){var n=this.getIndices(),a=this.getVerticesData(e.VertexBuffer.NormalKind);if(!a)return this;e.VertexData.ComputeNormals(r,n,a),this.updateVerticesData(e.VertexBuffer.NormalKind,a,!1,!1)}return this},r.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var t=this._geometry,i=this._geometry.copy(e.Geometry.RandomId());return t.releaseForMesh(this,!0),i.applyToMesh(this),this},r.prototype.setIndices=function(t,i,r){if(void 0===i&&(i=null),void 0===r&&(r=!1),this._geometry)this._geometry.setIndices(t,i,r);else{var n=new e.VertexData;n.indices=t;var a=this.getScene();new e.Geometry(e.Geometry.RandomId(),a,n,r,this)}return this},r.prototype.updateIndices=function(e,t){return this._geometry?(this._geometry.updateIndices(e,t),this):this},r.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},r.prototype._bind=function(t,i,r){if(!this._geometry)return this;var n,a=this.getScene().getEngine();if(this._unIndexed)n=null;else switch(r){case e.Material.PointFillMode:n=null;break;case e.Material.WireFrameFillMode:n=t._getLinesIndexBuffer(this.getIndices(),a);break;default:case e.Material.TriangleFillMode:n=this._unIndexed?null:this._geometry.getIndexBuffer()}return this._geometry._bind(i,n),this},r.prototype._draw=function(t,i,r,n){if(void 0===n&&(n=!1),!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeDrawObservable&&this._onBeforeDrawObservable.notifyObservers(this);var a=this.getScene(),o=a.getEngine();if(this._unIndexed||i==e.Material.PointFillMode?o.drawArraysType(i,t.verticesStart,t.verticesCount,r):i==e.Material.WireFrameFillMode?o.drawElementsType(i,0,t._linesIndexCount,r):o.drawElementsType(i,t.indexStart,t.indexCount,r),a._isAlternateRenderingEnabled&&!n){var s=t.effect||this._effectiveMaterial.getEffect();if(!s||!a.activeCamera)return this;a._switchToAlternateCameraConfiguration(!0),this._effectiveMaterial.bindView(s),this._effectiveMaterial.bindViewProjection(s),o.setViewport(a.activeCamera._alternateCamera.viewport),this._draw(t,i,r,!0),o.setViewport(a.activeCamera.viewport),a._switchToAlternateCameraConfiguration(!1),this._effectiveMaterial.bindView(s),this._effectiveMaterial.bindViewProjection(s)}return this},r.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},r.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},r.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},r.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},r.prototype._getInstancesRenderList=function(e){var t=this.getScene(),i=this._instanceDataStorage.batchCache;if(i.mustReturn=!1,i.renderSelf[__uv.$wrap((e))]=this.isEnabled()&&this.isVisible,i.visibleInstances[__uv.$wrap((e))]=null,this._instanceDataStorage.visibleInstances){var r=this._instanceDataStorage.visibleInstances,n=t.getRenderId(),a=t._isInIntermediateRendering()?r.intermediateDefaultRenderId:r.defaultRenderId;i.visibleInstances[__uv.$wrap((e))]=r[__uv.$wrap((n))];var o=this._renderId;!i.visibleInstances[__uv.$wrap((e))]&&a&&(i.visibleInstances[__uv.$wrap((e))]=r[__uv.$wrap((a))],n=Math.max(a,n),o=Math.max(r.selfDefaultRenderId,n));var s=i.visibleInstances[__uv.$wrap((e))];if(s&&s.length){if(this._instanceDataStorage.renderIdForInstances[__uv.$wrap((e))]===n)return i.mustReturn=!0,i;n!==o&&(i.renderSelf[__uv.$wrap((e))]=!1)}this._instanceDataStorage.renderIdForInstances[__uv.$wrap((e))]=n}return i},r.prototype._renderWithInstances=function(t,i,r,n,a){var o=r.visibleInstances[__uv.$wrap((t._id))];if(!o)return this;for(var s=16*(o.length+1)*4,l=this._instanceDataStorage,c=l.instancesBufferSize,u=l.instancesBuffer;l.instancesBufferSize<s;)l.instancesBufferSize*=2;l.instancesData&&c==l.instancesBufferSize||(l.instancesData=new Float32Array(l.instancesBufferSize/4));var h=0,d=0,p=this.getWorldMatrix();if(r.renderSelf[__uv.$wrap((t._id))]&&(p.copyToArray(l.instancesData,h),h+=16,d++),o)for(var m=0;m<o.length;m++){o[__uv.$wrap((m))].getWorldMatrix().copyToArray(l.instancesData,h),h+=16,d++}return u&&c==l.instancesBufferSize?u.updateDirectly(l.instancesData,0,d):(u&&u.dispose(),u=new e.Buffer(a,l.instancesData,!0,16,!1,!0),l.instancesBuffer=u,this.setVerticesBuffer(u.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(u.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(u.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(u.createVertexBuffer("world3",12,4))),this._bind(t,n,i),this._draw(t,i,d),a.unbindInstanceAttributes(),this},r.prototype._processRendering=function(e,t,i,r,n,a,o){var s=this.getScene().getEngine();if(n)this._renderWithInstances(e,i,r,t,s);else{r.renderSelf[__uv.$wrap((e._id))]&&(a&&a(!1,this.getWorldMatrix(),o),this._draw(e,i,this._instanceDataStorage.overridenInstanceCount));var l=r.visibleInstances[__uv.$wrap((e._id))];if(l)for(var c=0;c<l.length;c++){var u=l[__uv.$wrap((c))].getWorldMatrix();a&&a(!0,u,o),this._draw(e,i)}}return this},r.prototype.render=function(t,i){if(this._checkOcclusionQuery())return this;var r=this.getScene(),n=this._getInstancesRenderList(t._id);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeRenderObservable&&this._onBeforeRenderObservable.notifyObservers(this);var a,o=r.getEngine(),s=o.getCaps().instancedArrays&&null!==n.visibleInstances[__uv.$wrap((t._id))]&&void 0!==n.visibleInstances[__uv.$wrap((t._id))],l=t.getMaterial();if(!l)return this;if(this._effectiveMaterial=l,this._effectiveMaterial.storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,t,s))return this}else if(!this._effectiveMaterial.isReady(this,s))return this;i&&o.setAlphaMode(this._effectiveMaterial.alphaMode);for(var c=0,u=r._beforeRenderingMeshStage;c<u.length;c++){u[__uv.$wrap((c))].action(this,t,n)}if(!(a=this._effectiveMaterial.storeEffectOnSubMeshes?t.effect:this._effectiveMaterial.getEffect()))return this;var h=this.overrideMaterialSideOrientation;null==h&&(h=this._effectiveMaterial.sideOrientation,this._getWorldMatrixDeterminant()<0&&(h=h===e.Material.ClockWiseSideOrientation?e.Material.CounterClockWiseSideOrientation:e.Material.ClockWiseSideOrientation));var d=this._effectiveMaterial._preBind(a,h);this._effectiveMaterial.forceDepthWrite&&o.setDepthWrite(!0);var p=r.forcePointsCloud?e.Material.PointFillMode:r.forceWireframe?e.Material.WireFrameFillMode:this._effectiveMaterial.fillMode;s||this._bind(t,a,p);var m=this.getWorldMatrix();this._effectiveMaterial.storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(m,this,t):this._effectiveMaterial.bind(m,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(o.setState(!0,this._effectiveMaterial.zOffset,!1,!d),this._processRendering(t,a,p,n,s,this._onBeforeDraw,this._effectiveMaterial),o.setState(!0,this._effectiveMaterial.zOffset,!1,d)),this._processRendering(t,a,p,n,s,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var _=0,f=r._afterRenderingMeshStage;_<f.length;_++){f[__uv.$wrap((_))].action(this,t,n)}return this._onAfterRenderObservable&&this._onAfterRenderObservable.notifyObservers(this),this},r.prototype._onBeforeDraw=function(e,t,i){e&&i&&i.bindOnlyWorldMatrix(t)},r.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},r.prototype.normalizeSkinFourWeights=function(){for(var t=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind),i=t.length,r=0;r<i;r+=4){var n=t[__uv.$wrap((r))]+t[__uv.$wrap((r+1))]+t[__uv.$wrap((r+2))]+t[__uv.$wrap((r+3))];if(0===n)t[__uv.$wrap((r))]=1;else{var a=1/n;t[__uv.$wrap((r))]*=a,t[__uv.$wrap((r+1))]*=a,t[__uv.$wrap((r+2))]*=a,t[__uv.$wrap((r+3))]*=a}}this.setVerticesData(e.VertexBuffer.MatricesWeightsKind,t)},r.prototype.normalizeSkinWeightsAndExtra=function(){for(var t=this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind),i=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind),r=i.length,n=0;n<r;n+=4){var a=i[__uv.$wrap((n))]+i[__uv.$wrap((n+1))]+i[__uv.$wrap((n+2))]+i[__uv.$wrap((n+3))];if(0===(a+=t[__uv.$wrap((n))]+t[__uv.$wrap((n+1))]+t[__uv.$wrap((n+2))]+t[__uv.$wrap((n+3))]))i[__uv.$wrap((n))]=1;else{var o=1/a;i[__uv.$wrap((n))]*=o,i[__uv.$wrap((n+1))]*=o,i[__uv.$wrap((n+2))]*=o,i[__uv.$wrap((n+3))]*=o,t[__uv.$wrap((n))]*=o,t[__uv.$wrap((n+1))]*=o,t[__uv.$wrap((n+2))]*=o,t[__uv.$wrap((n+3))]*=o}}this.setVerticesData(e.VertexBuffer.MatricesWeightsKind,i),this.setVerticesData(e.VertexBuffer.MatricesWeightsKind,t)},r.prototype.validateSkinning=function(){var t=this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind),i=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind);if(null===i||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var r=i.length,n=0,a=0,o=0,s=0,l=null===t?4:8,c=new Array,u=0;u<=l;u++)c[__uv.$wrap((u))]=0;for(u=0;u<r;u+=4){for(var h=i[__uv.$wrap((u))],d=h,p=0===d?0:1,m=1;m<l;m++){var _=m<4?i[__uv.$wrap((u+m))]:t[__uv.$wrap((u+m-4))];_>h&&n++,0!==_&&p++,d+=_,h=_}if(c[__uv.$wrap((p))]++,p>o&&(o=p),0===d)a++;else{var f=1/d,g=0;for(m=0;m<l;m++)g+=m<4?Math.abs(i[__uv.$wrap((u+m))]-i[__uv.$wrap((u+m))]*f):Math.abs(t[__uv.$wrap((u+m-4))]-t[__uv.$wrap((u+m-4))]*f);g>.001&&s++}}var y=this.skeleton.bones.length,v=this.getVerticesData(e.VertexBuffer.MatricesIndicesKind),b=this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind),x=0;for(u=0;u<r;u++)for(m=0;m<l;m++){var S=m<4?v[__uv.$wrap((m))]:b[__uv.$wrap((m-4))];(S>=y||S<0)&&x++}return{skinned:!0,valid:0===a&&0===s&&0===x,report:"Number of Weights = "+r/4+"\nMaximum influences = "+o+"\nMissing Weights = "+a+"\nNot Sorted = "+n+"\nNot Normalized = "+s+"\nWeightCounts = ["+c+"]\nNumber of bones = "+y+"\nBad Bone Indices = "+x}},r.prototype._checkDelayState=function(){var t=this.getScene();return this._geometry?this._geometry.load(t):this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,this._queueLoad(t)),this},r.prototype._queueLoad=function(t){var i=this;t._addPendingData(this);var r=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return e.Tools.LoadFile(this.delayLoadingFile,(function(r){r instanceof ArrayBuffer?i._delayLoadingFunction(r,i):i._delayLoadingFunction(JSON.parse(r),i),i.instances.forEach((function(e){e._syncSubMeshes()})),i.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,t._removePendingData(i)}),(function(){}),t.database,r),this},r.prototype.isInFrustum=function(i){return this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING&&(!!t.prototype.isInFrustum.call(this,i)&&(this._checkDelayState(),!0))},r.prototype.setMaterialByID=function(e){var t,i=this.getScene().materials;for(t=i.length-1;t>-1;t--)if(i[__uv.$wrap((t))].id===e)return this.material=i[__uv.$wrap((t))],this;var r=this.getScene().multiMaterials;for(t=r.length-1;t>-1;t--)if(r[__uv.$wrap((t))].id===e)return this.material=r[__uv.$wrap((t))],this;return this},r.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},r.prototype.bakeTransformIntoVertices=function(t){if(!this.isVerticesDataPresent(e.VertexBuffer.PositionKind))return this;var i=this.subMeshes.splice(0);this._resetPointsArrayCache();var r,n=this.getVerticesData(e.VertexBuffer.PositionKind),a=new Array;for(r=0;r<n.length;r+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(n,r),t).toArray(a,r);if(this.setVerticesData(e.VertexBuffer.PositionKind,a,this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)){for(n=this.getVerticesData(e.VertexBuffer.NormalKind),a=[],r=0;r<n.length;r+=3)e.Vector3.TransformNormal(e.Vector3.FromArray(n,r),t).normalize().toArray(a,r);this.setVerticesData(e.VertexBuffer.NormalKind,a,this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable())}return t.m[__uv.$wrap((0))]*t.m[__uv.$wrap((5))]*t.m[__uv.$wrap((10))]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=i,this},r.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=e.Quaternion.Identity()),this._worldMatrix=e.Matrix.Identity(),this},Object.defineProperty(r.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),r.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},r.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},r.prototype.clone=function(e,t,i,n){return void 0===e&&(e=""),void 0===n&&(n=!0),new r(e,this.getScene(),t,this,i,n)},r.prototype.dispose=function(e,i){var r=this;for(void 0===i&&(i=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0),this._onBeforeDrawObservable&&this._onBeforeDrawObservable.clear(),this._onBeforeRenderObservable&&this._onBeforeRenderObservable.clear(),this._onAfterRenderObservable&&this._onAfterRenderObservable.clear(),this.getScene().meshes.forEach((function(e){var t=e;t._source&&t._source===r&&(t._source=null)})),this._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[__uv.$wrap((0))].dispose();t.prototype.dispose.call(this,e,i)},r.prototype.applyDisplacementMap=function(t,i,r,n,a,o,s){var l=this;void 0===s&&(s=!1);var c=this.getScene();return e.Tools.LoadImage(t,(function(e){var t=document.createElement("canvas"),c=t.getContext("2d"),u=e.width,h=e.height;t.width=u,t.height=h,c.drawImage(e,0,0);var d=c.getImageData(0,0,u,h).data;l.applyDisplacementMapFromBuffer(d,u,h,i,r,a,o,s),n&&n(l)}),(function(){}),c.database),this},r.prototype.applyDisplacementMapFromBuffer=function(t,i,r,n,a,o,s,l){if(void 0===l&&(l=!1),!this.isVerticesDataPresent(e.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(e.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(e.VertexBuffer.UVKind))return e.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var c=this.getVerticesData(e.VertexBuffer.PositionKind,!0,!0),u=this.getVerticesData(e.VertexBuffer.NormalKind),h=this.getVerticesData(e.VertexBuffer.UVKind),d=e.Vector3.Zero(),p=e.Vector3.Zero(),m=e.Vector2.Zero();o=o||e.Vector2.Zero(),s=s||new e.Vector2(1,1);for(var _=0;_<c.length;_+=3){e.Vector3.FromArrayToRef(c,_,d),e.Vector3.FromArrayToRef(u,_,p),e.Vector2.FromArrayToRef(h,_/3*2,m);var f=4*((Math.abs(m.x*s.x+o.x)*i%i|0)+(Math.abs(m.y*s.y+o.y)*r%r|0)*i),g=.3*(t[__uv.$wrap((f))]/255)+.59*(t[__uv.$wrap((f+1))]/255)+.11*(t[__uv.$wrap((f+2))]/255);p.normalize(),p.scaleInPlace(n+(a-n)*g),(d=d.add(p)).toArray(c,_)}return e.VertexData.ComputeNormals(c,this.getIndices(),u),l?(this.setVerticesData(e.VertexBuffer.PositionKind,c),this.setVerticesData(e.VertexBuffer.NormalKind,u)):(this.updateVerticesData(e.VertexBuffer.PositionKind,c),this.updateVerticesData(e.VertexBuffer.NormalKind,u)),this},r.prototype.convertToFlatShadedMesh=function(){var t,i,r=this.getVerticesDataKinds(),n={},a={},o={},s=!1;for(t=0;t<r.length;t++){i=r[__uv.$wrap((t))];var l=this.getVertexBuffer(i);i!==e.VertexBuffer.NormalKind?(n[__uv.$wrap((i))]=l,a[__uv.$wrap((i))]=n[__uv.$wrap((i))].getData(),o[__uv.$wrap((i))]=[]):(s=l.isUpdatable(),r.splice(t,1),t--)}var c,u=this.subMeshes.slice(0),h=this.getIndices(),d=this.getTotalIndices();for(c=0;c<d;c++){var p=h[__uv.$wrap((c))];for(t=0;t<r.length;t++)for(var m=n[__uv.$wrap((i=r[__uv.$wrap((t))]))].getStrideSize(),_=0;_<m;_++)o[__uv.$wrap((i))].push(a[__uv.$wrap((i))][__uv.$wrap((p*m+_))])}var f=[],g=o[__uv.$wrap((e.VertexBuffer.PositionKind))];for(c=0;c<d;c+=3){h[__uv.$wrap((c))]=c,h[__uv.$wrap((c+1))]=c+1,h[__uv.$wrap((c+2))]=c+2;for(var y=e.Vector3.FromArray(g,3*c),v=e.Vector3.FromArray(g,3*(c+1)),b=e.Vector3.FromArray(g,3*(c+2)),x=y.subtract(v),S=b.subtract(v),T=e.Vector3.Normalize(e.Vector3.Cross(x,S)),E=0;E<3;E++)f.push(T.x),f.push(T.y),f.push(T.z)}for(this.setIndices(h),this.setVerticesData(e.VertexBuffer.NormalKind,f,s),t=0;t<r.length;t++)i=r[__uv.$wrap((t))],this.setVerticesData(i,o[__uv.$wrap((i))],n[__uv.$wrap((i))].isUpdatable());this.releaseSubMeshes();for(var P=0;P<u.length;P++){var A=u[__uv.$wrap((P))];e.SubMesh.AddToMesh(A.materialIndex,A.indexStart,A.indexCount,A.indexStart,A.indexCount,this)}return this.synchronizeInstances(),this},r.prototype.convertToUnIndexedMesh=function(){var t,i,r=this.getVerticesDataKinds(),n={},a={},o={};for(t=0;t<r.length;t++){i=r[__uv.$wrap((t))];var s=this.getVertexBuffer(i);n[__uv.$wrap((i))]=s,a[__uv.$wrap((i))]=n[__uv.$wrap((i))].getData(),o[__uv.$wrap((i))]=[]}var l,c=this.subMeshes.slice(0),u=this.getIndices(),h=this.getTotalIndices();for(l=0;l<h;l++){var d=u[__uv.$wrap((l))];for(t=0;t<r.length;t++)for(var p=n[__uv.$wrap((i=r[__uv.$wrap((t))]))].getStrideSize(),m=0;m<p;m++)o[__uv.$wrap((i))].push(a[__uv.$wrap((i))][__uv.$wrap((d*p+m))])}for(l=0;l<h;l+=3)u[__uv.$wrap((l))]=l,u[__uv.$wrap((l+1))]=l+1,u[__uv.$wrap((l+2))]=l+2;for(this.setIndices(u),t=0;t<r.length;t++)i=r[__uv.$wrap((t))],this.setVerticesData(i,o[__uv.$wrap((i))],n[__uv.$wrap((i))].isUpdatable());this.releaseSubMeshes();for(var _=0;_<c.length;_++){var f=c[__uv.$wrap((_))];e.SubMesh.AddToMesh(f.materialIndex,f.indexStart,f.indexCount,f.indexStart,f.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},r.prototype.flipFaces=function(t){void 0===t&&(t=!1);var i,r,n=e.VertexData.ExtractFromMesh(this);if(t&&this.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&n.normals)for(i=0;i<n.normals.length;i++)n.normals[__uv.$wrap((i))]*=-1;if(n.indices)for(i=0;i<n.indices.length;i+=3)r=n.indices[__uv.$wrap((i+1))],n.indices[__uv.$wrap((i+1))]=n.indices[__uv.$wrap((i+2))],n.indices[__uv.$wrap((i+2))]=r;return n.applyToMesh(this),this},r.prototype.createInstance=function(t){return new e.InstancedMesh(t,this)},r.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[__uv.$wrap((e))]._syncSubMeshes()}return this},r.prototype.optimizeIndices=function(t){var i=this,r=this.getIndices(),n=this.getVerticesData(e.VertexBuffer.PositionKind);if(!n||!r)return this;for(var a=new Array,o=0;o<n.length;o+=3)a.push(e.Vector3.FromArray(n,o));var s=new Array;return e.AsyncLoop.SyncAsyncForLoop(a.length,40,(function(e){for(var t=a.length-1-e,i=a[__uv.$wrap((t))],r=0;r<t;++r){var n=a[__uv.$wrap((r))];if(i.equals(n)){s[__uv.$wrap((t))]=r;break}}}),(function(){for(var e=0;e<r.length;++e)r[__uv.$wrap((e))]=s[__uv.$wrap((r[__uv.$wrap((e))]))]||r[__uv.$wrap((e))];var n=i.subMeshes.slice(0);i.setIndices(r),i.subMeshes=n,t&&t(i)})),this},r.prototype.serialize=function(t){t.name=this.name,t.id=this.id,t.type=this.getClassName(),e.Tags&&e.Tags.HasTags(this)&&(t.tags=e.Tags.GetTags(this)),t.position=this.position.asArray(),this.rotationQuaternion?t.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(t.rotation=this.rotation.asArray()),t.scaling=this.scaling.asArray(),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(!1),t.isVisible=this.isVisible,t.infiniteDistance=this.infiniteDistance,t.pickable=this.isPickable,t.receiveShadows=this.receiveShadows,t.billboardMode=this.billboardMode,t.visibility=this.visibility,t.checkCollisions=this.checkCollisions,t.isBlocker=this.isBlocker,this.__uv$setSource(__uv).__uv$parent&&(t.parentId=this.__uv$setSource(__uv).__uv$parent.id),t.isUnIndexed=this.isUnIndexed;var i=this._geometry;if(i){var r=i.id;t.geometryId=r,t.subMeshes=[];for(var n=0;n<this.subMeshes.length;n++){var a=this.subMeshes[__uv.$wrap((n))];t.subMeshes.push({materialIndex:a.materialIndex,verticesStart:a.verticesStart,verticesCount:a.verticesCount,indexStart:a.indexStart,indexCount:a.indexCount})}}this.material?t.materialId=this.material.id:this.material=null,this.morphTargetManager&&(t.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(t.skeletonId=this.skeleton.id);var o=this.getPhysicsImpostor();o&&(t.physicsMass=o.getParam("mass"),t.physicsFriction=o.getParam("friction"),t.physicsRestitution=o.getParam("mass"),t.physicsImpostor=o.type),this.metadata&&(t.metadata=this.metadata),t.instances=[];for(var s=0;s<this.instances.length;s++){var l=this.instances[__uv.$wrap((s))];if(!l.doNotSerialize){var c={name:l.name,id:l.id,position:l.position.asArray(),scaling:l.scaling.asArray()};l.__uv$setSource(__uv).__uv$parent&&(c.parentId=l.__uv$setSource(__uv).__uv$parent.id),l.rotationQuaternion?c.rotationQuaternion=l.rotationQuaternion.asArray():l.rotation&&(c.rotation=l.rotation.asArray()),t.instances.push(c),e.Animation.AppendSerializedAnimations(l,c),c.ranges=l.serializeAnimationRanges()}}e.Animation.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.layerMask=this.layerMask,t.alphaIndex=this.alphaIndex,t.hasVertexAlpha=this.hasVertexAlpha,t.overlayAlpha=this.overlayAlpha,t.overlayColor=this.overlayColor.asArray(),t.renderOverlay=this.renderOverlay,t.applyFog=this.applyFog,this.actionManager&&(t.actions=this.actionManager.serialize(this.name))},r.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var t=this._morphTargetManager;if(t&&t.vertexCount){if(t.vertexCount!==this.getTotalVertices())return e.Tools.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var i=0;i<t.numInfluencers;i++){var r=t.getActiveTarget(i),n=r.getPositions();if(!n)return void e.Tools.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(e.VertexBuffer.PositionKind+i,n,!1,3);var a=r.getNormals();a&&this.geometry.setVerticesData(e.VertexBuffer.NormalKind+i,a,!1,3);var o=r.getTangents();o&&this.geometry.setVerticesData(e.VertexBuffer.TangentKind+i,o,!1,3)}}else for(i=0;this.geometry.isVerticesDataPresent(e.VertexBuffer.PositionKind+i);)this.geometry.removeVerticesData(e.VertexBuffer.PositionKind+i),this.geometry.isVerticesDataPresent(e.VertexBuffer.NormalKind+i)&&this.geometry.removeVerticesData(e.VertexBuffer.NormalKind+i),this.geometry.isVerticesDataPresent(e.VertexBuffer.TangentKind+i)&&this.geometry.removeVerticesData(e.VertexBuffer.TangentKind+i),i++}},r.Parse=function(t,i,n){var a;if((a=t.type&&"GroundMesh"===t.type?e.GroundMesh.Parse(t,i):new r(t.name,i)).id=t.id,e.Tags&&e.Tags.AddTagsTo(a,t.tags),a.position=e.Vector3.FromArray(t.position),void 0!==t.metadata&&(a.metadata=t.metadata),t.rotationQuaternion?a.rotationQuaternion=e.Quaternion.FromArray(t.rotationQuaternion):t.rotation&&(a.rotation=e.Vector3.FromArray(t.rotation)),a.scaling=e.Vector3.FromArray(t.scaling),t.localMatrix?a.setPreTransformMatrix(e.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),a.isVisible=t.isVisible,a.infiniteDistance=t.infiniteDistance,a.showBoundingBox=t.showBoundingBox,a.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(a.applyFog=t.applyFog),void 0!==t.pickable&&(a.isPickable=t.pickable),void 0!==t.alphaIndex&&(a.alphaIndex=t.alphaIndex),a.receiveShadows=t.receiveShadows,a.billboardMode=t.billboardMode,void 0!==t.visibility&&(a.visibility=t.visibility),a.checkCollisions=t.checkCollisions,void 0!==t.isBlocker&&(a.isBlocker=t.isBlocker),a._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(a._waitingFreezeWorldMatrix=t.freezeWorldMatrix),t.parentId&&(a._waitingParentId=t.parentId),void 0!==t.actions&&(a._waitingActions=t.actions),void 0!==t.overlayAlpha&&(a.overlayAlpha=t.overlayAlpha),void 0!==t.overlayColor&&(a.overlayColor=e.Color3.FromArray(t.overlayColor)),void 0!==t.renderOverlay&&(a.renderOverlay=t.renderOverlay),a.isUnIndexed=!!t.isUnIndexed,a.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(a.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,a.delayLoadingFile=n+t.delayLoadingFile,a._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(a._binaryInfo=t._binaryInfo),a._delayInfo=[],t.hasUVs&&a._delayInfo.push(e.VertexBuffer.UVKind),t.hasUVs2&&a._delayInfo.push(e.VertexBuffer.UV2Kind),t.hasUVs3&&a._delayInfo.push(e.VertexBuffer.UV3Kind),t.hasUVs4&&a._delayInfo.push(e.VertexBuffer.UV4Kind),t.hasUVs5&&a._delayInfo.push(e.VertexBuffer.UV5Kind),t.hasUVs6&&a._delayInfo.push(e.VertexBuffer.UV6Kind),t.hasColors&&a._delayInfo.push(e.VertexBuffer.ColorKind),t.hasMatricesIndices&&a._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&a._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),a._delayLoadingFunction=e.Geometry._ImportGeometry,e.SceneLoader.ForceFullSceneLoadingForIncremental&&a._checkDelayState()):e.Geometry._ImportGeometry(t,a),t.materialId?a.setMaterialByID(t.materialId):a.material=null,t.morphTargetManagerId>-1&&(a.morphTargetManager=i.getMorphTargetManagerById(t.morphTargetManagerId)),t.skeletonId>-1&&(a.skeleton=i.getLastSkeletonByID(t.skeletonId),t.numBoneInfluencers&&(a.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(var o=0;o<t.animations.length;o++){var s=t.animations[__uv.$wrap((o))];a.animations.push(e.Animation.Parse(s))}e.Node.ParseAnimationRanges(a,t,i)}if(t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?a.layerMask=Math.abs(parseInt(t.layerMask)):a.layerMask=268435455,t.physicsImpostor&&(a.physicsImpostor=new e.PhysicsImpostor(a,t.physicsImpostor,{mass:t.physicsMass,friction:t.physicsFriction,restitution:t.physicsRestitution},i)),t.instances)for(var l=0;l<t.instances.length;l++){var c=t.instances[__uv.$wrap((l))],u=a.createInstance(c.name);if(c.id&&(u.id=c.id),e.Tags&&(c.tags?e.Tags.AddTagsTo(u,c.tags):e.Tags.AddTagsTo(u,t.tags)),u.position=e.Vector3.FromArray(c.position),c.parentId&&(u._waitingParentId=c.parentId),c.rotationQuaternion?u.rotationQuaternion=e.Quaternion.FromArray(c.rotationQuaternion):c.rotation&&(u.rotation=e.Vector3.FromArray(c.rotation)),u.scaling=e.Vector3.FromArray(c.scaling),null!=c.checkCollisions&&null!=c.checkCollisions&&(u.checkCollisions=c.checkCollisions),null!=c.pickable&&null!=c.pickable&&(u.isPickable=c.pickable),null!=c.showBoundingBox&&null!=c.showBoundingBox&&(u.showBoundingBox=c.showBoundingBox),null!=c.showSubMeshesBoundingBox&&null!=c.showSubMeshesBoundingBox&&(u.showSubMeshesBoundingBox=c.showSubMeshesBoundingBox),null!=c.alphaIndex&&null!=c.showSubMeshesBoundingBox&&(u.alphaIndex=c.alphaIndex),c.physicsImpostor&&(u.physicsImpostor=new e.PhysicsImpostor(u,c.physicsImpostor,{mass:c.physicsMass,friction:c.physicsFriction,restitution:c.physicsRestitution},i)),c.animations){for(o=0;o<c.animations.length;o++)s=c.animations[__uv.$wrap((o))],u.animations.push(e.Animation.Parse(s));e.Node.ParseAnimationRanges(u,c,i),c.autoAnimate&&i.beginAnimation(u,c.autoAnimateFrom,c.autoAnimateTo,c.autoAnimateLoop,c.autoAnimateSpeed||1)}}return a},r.CreateRibbon=function(t,i,r,n,a,o,s,l,c){return void 0===r&&(r=!1),void 0===s&&(s=!1),e.MeshBuilder.CreateRibbon(t,{pathArray:i,closeArray:r,closePath:n,offset:a,updatable:s,sideOrientation:l,instance:c},o)},r.CreateDisc=function(t,i,r,n,a,o){void 0===n&&(n=null);var s={radius:i,tessellation:r,sideOrientation:o,updatable:a};return e.MeshBuilder.CreateDisc(t,s,n)},r.CreateBox=function(t,i,r,n,a){void 0===r&&(r=null);var o={size:i,sideOrientation:a,updatable:n};return e.MeshBuilder.CreateBox(t,o,r)},r.CreateSphere=function(t,i,r,n,a,o){var s={segments:i,diameterX:r,diameterY:r,diameterZ:r,sideOrientation:o,updatable:a};return e.MeshBuilder.CreateSphere(t,s,n)},r.CreateCylinder=function(t,i,n,a,o,s,l,c,u){void 0!==l&&l instanceof e.Scene||(void 0!==l&&(u=c||r.DEFAULTSIDE,c=l),l=s,s=1);var h={height:i,diameterTop:n,diameterBottom:a,tessellation:o,subdivisions:s,sideOrientation:u,updatable:c};return e.MeshBuilder.CreateCylinder(t,h,l)},r.CreateTorus=function(t,i,r,n,a,o,s){var l={diameter:i,thickness:r,tessellation:n,sideOrientation:s,updatable:o};return e.MeshBuilder.CreateTorus(t,l,a)},r.CreateTorusKnot=function(t,i,r,n,a,o,s,l,c,u){var h={radius:i,tube:r,radialSegments:n,tubularSegments:a,p:o,q:s,sideOrientation:u,updatable:c};return e.MeshBuilder.CreateTorusKnot(t,h,l)},r.CreateLines=function(t,i,r,n,a){void 0===r&&(r=null),void 0===n&&(n=!1),void 0===a&&(a=null);var o={points:i,updatable:n,instance:a};return e.MeshBuilder.CreateLines(t,o,r)},r.CreateDashedLines=function(t,i,r,n,a,o,s,l){void 0===o&&(o=null);var c={points:i,dashSize:r,gapSize:n,dashNb:a,updatable:s,instance:l};return e.MeshBuilder.CreateDashedLines(t,c,o)},r.CreatePolygon=function(t,i,r,n,a,o){var s={shape:i,holes:n,updatable:a,sideOrientation:o};return e.MeshBuilder.CreatePolygon(t,s,r)},r.ExtrudePolygon=function(t,i,r,n,a,o,s){var l={shape:i,holes:a,depth:r,updatable:o,sideOrientation:s};return e.MeshBuilder.ExtrudePolygon(t,l,n)},r.ExtrudeShape=function(t,i,n,a,o,s,l,c,u,h){void 0===l&&(l=null);var d={shape:i,path:n,scale:a,rotation:o,cap:0===s?0:s||r.NO_CAP,sideOrientation:u,instance:h,updatable:c};return e.MeshBuilder.ExtrudeShape(t,d,l)},r.ExtrudeShapeCustom=function(t,i,n,a,o,s,l,c,u,h,d,p){var m={shape:i,path:n,scaleFunction:a,rotationFunction:o,ribbonCloseArray:s,ribbonClosePath:l,cap:0===c?0:c||r.NO_CAP,sideOrientation:d,instance:p,updatable:h};return e.MeshBuilder.ExtrudeShapeCustom(t,m,u)},r.CreateLathe=function(t,i,r,n,a,o,s){var l={shape:i,radius:r,tessellation:n,sideOrientation:s,updatable:o};return e.MeshBuilder.CreateLathe(t,l,a)},r.CreatePlane=function(t,i,r,n,a){var o={size:i,width:i,height:i,sideOrientation:a,updatable:n};return e.MeshBuilder.CreatePlane(t,o,r)},r.CreateGround=function(t,i,r,n,a,o){var s={width:i,height:r,subdivisions:n,updatable:o};return e.MeshBuilder.CreateGround(t,s,a)},r.CreateTiledGround=function(t,i,r,n,a,o,s,l,c){var u={xmin:i,zmin:r,xmax:n,zmax:a,subdivisions:o,precision:s,updatable:c};return e.MeshBuilder.CreateTiledGround(t,u,l)},r.CreateGroundFromHeightMap=function(t,i,r,n,a,o,s,l,c,u,h){var d={width:r,height:n,subdivisions:a,minHeight:o,maxHeight:s,updatable:c,onReady:u,alphaFilter:h};return e.MeshBuilder.CreateGroundFromHeightMap(t,i,d,l)},r.CreateTube=function(t,i,r,n,a,o,s,l,c,u){var h={path:i,radius:r,tessellation:n,radiusFunction:a,arc:1,cap:o,updatable:l,sideOrientation:c,instance:u};return e.MeshBuilder.CreateTube(t,h,s)},r.CreatePolyhedron=function(t,i,r){return e.MeshBuilder.CreatePolyhedron(t,i,r)},r.CreateIcoSphere=function(t,i,r){return e.MeshBuilder.CreateIcoSphere(t,i,r)},r.CreateDecal=function(t,i,r,n,a,o){var s={position:r,normal:n,size:a,angle:o};return e.MeshBuilder.CreateDecal(t,i,s)},r.prototype.setPositionsForCPUSkinning=function(){if(!this._sourcePositions){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return this._sourcePositions;this._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(e.VertexBuffer.PositionKind)||this.setVerticesData(e.VertexBuffer.PositionKind,t,!0)}return this._sourcePositions},r.prototype.setNormalsForCPUSkinning=function(){if(!this._sourceNormals){var t=this.getVerticesData(e.VertexBuffer.NormalKind);if(!t)return this._sourceNormals;this._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(e.VertexBuffer.NormalKind)||this.setVerticesData(e.VertexBuffer.NormalKind,t,!0)}return this._sourceNormals},r.prototype.applySkeleton=function(t){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(e.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind))return this;if(!this._sourcePositions){var i=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=i}this._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(e.VertexBuffer.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var n=this.getVerticesData(e.VertexBuffer.NormalKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));var a=this.getVerticesData(e.VertexBuffer.MatricesIndicesKind),o=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind);if(!o||!a)return this;for(var s,l=this.numBoneInfluencers>4,c=l?this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind):null,u=l?this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind):null,h=t.getTransformMatrices(this),d=e.Vector3.Zero(),p=new e.Matrix,m=new e.Matrix,_=0,f=0;f<r.length;f+=3,_+=4){var g;for(s=0;s<4;s++)(g=o[__uv.$wrap((_+s))])>0&&(e.Matrix.FromFloat32ArrayToRefScaled(h,Math.floor(16*a[__uv.$wrap((_+s))]),g,m),p.addToSelf(m));if(l)for(s=0;s<4;s++)(g=u[__uv.$wrap((_+s))])>0&&(e.Matrix.FromFloat32ArrayToRefScaled(h,Math.floor(16*c[__uv.$wrap((_+s))]),g,m),p.addToSelf(m));e.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[__uv.$wrap((f))],this._sourcePositions[__uv.$wrap((f+1))],this._sourcePositions[__uv.$wrap((f+2))],p,d),d.toArray(r,f),e.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[__uv.$wrap((f))],this._sourceNormals[__uv.$wrap((f+1))],this._sourceNormals[__uv.$wrap((f+2))],p,d),d.toArray(n,f),p.reset()}return this.updateVerticesData(e.VertexBuffer.PositionKind,r),this.updateVerticesData(e.VertexBuffer.NormalKind,n),this},r.MinMax=function(t){var i=null,r=null;return t.forEach((function(e,t,n){var a=e.getBoundingInfo().boundingBox;i&&r?(i.minimizeInPlace(a.minimumWorld),r.maximizeInPlace(a.maximumWorld)):(i=a.minimumWorld,r=a.maximumWorld)})),i&&r?{min:i,max:r}:{min:e.Vector3.Zero(),max:e.Vector3.Zero()}},r.Center=function(t){var i=t instanceof Array?r.MinMax(t):t;return e.Vector3.Center(i.min,i.max)},r.MergeMeshes=function(t,i,n,a,o){var s;if(void 0===i&&(i=!0),!n){var l=0;for(s=0;s<t.length;s++)if(t[__uv.$wrap((s))]&&(l+=t[__uv.$wrap((s))].getTotalVertices())>65536)return e.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var c,u=null,h=new Array,d=null;for(s=0;s<t.length;s++)if(t[__uv.$wrap((s))]){var p=t[__uv.$wrap((s))].computeWorldMatrix(!0);(c=e.VertexData.ExtractFromMesh(t[__uv.$wrap((s))],!0,!0)).transform(p),u?u.merge(c,n):(u=c,d=t[__uv.$wrap((s))]),o&&h.push(t[__uv.$wrap((s))].getTotalIndices())}if(d=d,a||(a=new r(d.name+"_merged",d.getScene())),u.applyToMesh(a),a.material=d.material,a.checkCollisions=d.checkCollisions,i)for(s=0;s<t.length;s++)t[__uv.$wrap((s))]&&t[__uv.$wrap((s))].dispose();if(o){a.releaseSubMeshes(),s=0;for(var m=0;s<h.length;)e.SubMesh.CreateFromIndices(0,m,h[__uv.$wrap((s))],a),m+=h[__uv.$wrap((s))],s++}return a},r.FRONTSIDE=0,r.BACKSIDE=1,r.DOUBLESIDE=2,r.DEFAULTSIDE=0,r.NO_CAP=0,r.CAP_START=1,r.CAP_END=2,r.CAP_ALL=3,r}(e.AbstractMesh);e.Mesh=n}(s||(s={})),function(e){var t=function(){function e(){}return Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},e}();e.BaseSubMesh=t;var i=function(t){function i(e,i,r,n,a,o,s,l){void 0===l&&(l=!0);var c=t.call(this)||this;return c.materialIndex=e,c.verticesStart=i,c.verticesCount=r,c.indexStart=n,c.indexCount=a,c._renderId=0,c._mesh=o,c._renderingMesh=s||o,o.subMeshes.push(c),c._trianglePlanes=[],c._id=o.subMeshes.length-1,l&&(c.refreshBoundingInfo(),o.computeWorldMatrix(!0)),c}return a(i,t),i.AddToMesh=function(e,t,r,n,a,o,s,l){return void 0===l&&(l=!0),new i(e,t,r,n,a,o,s,l)},Object.defineProperty(i.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),i.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},i.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},i.prototype.getMesh=function(){return this._mesh},i.prototype.getRenderingMesh=function(){return this._renderingMesh},i.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},i.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;var t=this._renderingMesh.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var i,r=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===r.length){var n=this._renderingMesh.getBoundingInfo();i={minimum:n.minimum.clone(),maximum:n.maximum.clone()}}else i=e.Tools.ExtractMinAndMaxIndexed(t,r,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum),this},i.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},i.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t.update(e),this},i.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},i.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},i.prototype.render=function(e){return this._renderingMesh.render(this,e),this},i.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var i=[],r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)i.push(e[__uv.$wrap((r))],e[__uv.$wrap((r+1))],e[__uv.$wrap((r+1))],e[__uv.$wrap((r+2))],e[__uv.$wrap((r+2))],e[__uv.$wrap((r))]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer},i.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},i.prototype.intersects=function(t,i,r,n){var a=this.getMaterial();if(!a)return null;switch(a.fillMode){case e.Material.PointListDrawMode:case e.Material.LineListDrawMode:case e.Material.LineLoopDrawMode:case e.Material.LineStripDrawMode:case e.Material.TriangleFanDrawMode:case e.Material.TriangleStripDrawMode:return null}if(e.LinesMesh){var o=this._mesh instanceof e.InstancedMesh?this._mesh.sourceMesh:this._mesh;if(o instanceof e.LinesMesh){var s=o;return this._intersectLines(t,i,r,s.intersectionThreshold,n)}}return this._intersectTriangles(t,i,r,n)},i.prototype._intersectLines=function(t,i,r,n,a){for(var o=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){var l=i[__uv.$wrap((r[__uv.$wrap((s))]))],c=i[__uv.$wrap((r[__uv.$wrap((s+1))]))],u=t.intersectionSegment(l,c,n);if(!(u<0)&&((a||!o||u<o.distance)&&(o=new e.IntersectionInfo(null,null,u),a)))break}return o},i.prototype._intersectTriangles=function(e,t,i,r){for(var n=null,a=this.indexStart;a<this.indexStart+this.indexCount;a+=3){var o=t[__uv.$wrap((i[__uv.$wrap((a))]))],s=t[__uv.$wrap((i[__uv.$wrap((a+1))]))],l=t[__uv.$wrap((i[__uv.$wrap((a+2))]))],c=e.intersectsTriangle(o,s,l);if(c){if(c.distance<0)continue;if((r||!n||c.distance<n.distance)&&((n=c).faceId=a/3,r))break}}return n},i.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},i.prototype.clone=function(t,r){var n=new i(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,r,!1);if(!this.IsGlobal){var a=this.getBoundingInfo();if(!a)return n;n._boundingInfo=new e.BoundingInfo(a.minimum,a.maximum)}return n},i.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},i.CreateFromIndices=function(e,t,r,n,a){for(var o=Number.MAX_VALUE,s=-Number.MAX_VALUE,l=(a=a||n).getIndices(),c=t;c<t+r;c++){var u=l[__uv.$wrap((c))];u<o&&(o=u),u>s&&(s=u)}return new i(e,o,s-o+1,t,r,n,a)},i}(t);e.SubMesh=i}(s||(s={}));o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[__uv.$wrap((i))])Object.prototype.hasOwnProperty.call(t,n)&&(e[__uv.$wrap((n))]=t[__uv.$wrap((n))]);return e}).apply(this,arguments)};!function(e){var t=function(){function e(){this._isDirty=!0,this._areLightsDirty=!0,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(){this._areLightsDirty=!0,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var i=t[__uv.$wrap((e))];"_"!==i[__uv.$wrap((0))]&&this._keys.push(i)}},e.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var i=this._keys[__uv.$wrap((t))];if(this[__uv.$wrap((i))]!==e[__uv.$wrap((i))])return!1}return!0},e.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var i=this._keys[__uv.$wrap((t))];e[__uv.$wrap((i))]=this[__uv.$wrap((i))]}},e.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[__uv.$wrap((e))];switch(typeof this[__uv.$wrap((t))]){case"number":this[__uv.$wrap((t))]=0;break;case"string":this[__uv.$wrap((t))]="";break;default:this[__uv.$wrap((t))]=!1}}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var i=this._keys[__uv.$wrap((t))],r=this[__uv.$wrap((i))];switch(typeof r){case"number":case"string":e+="#define "+i+" "+r+"\n";break;default:r&&(e+="#define "+i+"\n")}}return e},e}();e.MaterialDefines=t;var i=function(){function t(i,r,n){this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.doNotSerialize=!1,this.storeEffectOnSubMeshes=!1,this.onDisposeObservable=new e.Observable,this._alphaMode=e.Engine.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._wasPreviouslyReady=!1,this._fillMode=t.TriangleFillMode,this.name=i,this.id=i||e.Tools.RandomId(),this._scene=r||e.Engine.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=t.ClockWiseSideOrientation:this.sideOrientation=t.CounterClockWiseSideOrientation,this._uniformBuffer=new e.UniformBuffer(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,n||(this._scene.materials.push(this),this._scene.onNewMaterialAddedObservable.notifyObservers(this))}return Object.defineProperty(t,"TriangleFillMode",{get:function(){return t._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WireFrameFillMode",{get:function(){return t._WireFrameFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointFillMode",{get:function(){return t._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointListDrawMode",{get:function(){return t._PointListDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LineListDrawMode",{get:function(){return t._LineListDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LineLoopDrawMode",{get:function(){return t._LineLoopDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LineStripDrawMode",{get:function(){return t._LineStripDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TriangleStripDrawMode",{get:function(){return t._TriangleStripDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TriangleFanDrawMode",{get:function(){return t._TriangleFanDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ClockWiseSideOrientation",{get:function(){return t._ClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CounterClockWiseSideOrientation",{get:function(){return t._CounterClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alpha=e,this.markAsDirty(t.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(t.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new e.Observable),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new e.Observable),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(t.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(t.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wireframe",{get:function(){switch(this._fillMode){case t.WireFrameFillMode:case t.LineListDrawMode:case t.LineLoopDrawMode:case t.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(e){this.fillMode=e?t.WireFrameFillMode:t.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case t.PointFillMode:case t.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(e){this.fillMode=e?t.PointFillMode:t.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(t.MiscDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){return"Name: "+this.name},t.prototype.getClassName=function(){return"Material"},Object.defineProperty(t.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),t.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},t.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},t.prototype.isReady=function(e,t){return!0},t.prototype.isReadyForSubMesh=function(e,t,i){return!1},t.prototype.getEffect=function(){return this._effect},t.prototype.getScene=function(){return this._scene},t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.markDirty=function(){this._wasPreviouslyReady=!1},t.prototype._preBind=function(e,i){void 0===i&&(i=null);var r=this._scene.getEngine(),n=(null==i?this.sideOrientation:i)===t.ClockWiseSideOrientation;return r.enableEffect(e||this._effect),r.setState(this.backFaceCulling,this.zOffset,!1,n),n},t.prototype.bind=function(e,t){},t.prototype.bindForSubMesh=function(e,t,i){},t.prototype.bindOnlyWorldMatrix=function(e){},t.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},t.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},t.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},t.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},t.prototype._afterBind=function(e){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}},t.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.disableDepthWrite)&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},t.prototype.getActiveTextures=function(){return[]},t.prototype.hasTexture=function(e){return!1},t.prototype.clone=function(e){return null},t.prototype.getBindedMeshes=function(){for(var e=new Array,t=0;t<this._scene.meshes.length;t++){var i=this._scene.meshes[__uv.$wrap((t))];i.material===this&&e.push(i)}return e},t.prototype.forceCompilation=function(t,i,r){var n=this,a=o({clipPlane:!1},r),s=new e.BaseSubMesh,l=this.getScene(),c=function(){if(n._scene&&n._scene.getEngine()){s._materialDefines&&(s._materialDefines._renderId=-1);var r=l.clipPlane;a.clipPlane&&(l.clipPlane=new e.Plane(0,0,0,1)),n.storeEffectOnSubMeshes?n.isReadyForSubMesh(t,s)?i&&i(n):setTimeout(c,16):n.isReady(t)?i&&i(n):setTimeout(c,16),a.clipPlane&&(l.clipPlane=r)}};c()},t.prototype.forceCompilationAsync=function(e,t){var i=this;return new Promise((function(r){i.forceCompilation(e,(function(){r()}),t)}))},t.prototype.markAsDirty=function(e){e&t.TextureDirtyFlag&&this._markAllSubMeshesAsTexturesDirty(),e&t.LightDirtyFlag&&this._markAllSubMeshesAsLightsDirty(),e&t.FresnelDirtyFlag&&this._markAllSubMeshesAsFresnelDirty(),e&t.AttributesDirtyFlag&&this._markAllSubMeshesAsAttributesDirty(),e&t.MiscDirtyFlag&&this._markAllSubMeshesAsMiscDirty(),this.getScene().resetCachedMaterial()},t.prototype._markAllSubMeshesAsDirty=function(e){for(var t=0,i=this.getScene().meshes;t<i.length;t++){var r=i[__uv.$wrap((t))];if(r.subMeshes)for(var n=0,a=r.subMeshes;n<a.length;n++){var o=a[__uv.$wrap((n))];o.getMaterial()===this&&(o._materialDefines&&e(o._materialDefines))}}},t.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty((function(e){return e.markAsImageProcessingDirty()}))},t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty((function(e){return e.markAsTexturesDirty()}))},t.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty((function(e){return e.markAsFresnelDirty()}))},t.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty((function(e){e.markAsFresnelDirty(),e.markAsMiscDirty()}))},t.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty((function(e){return e.markAsLightDirty()}))},t.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty((function(e){return e.markAsAttributesDirty()}))},t.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty((function(e){return e.markAsMiscDirty()}))},t.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty((function(e){e.markAsTexturesDirty(),e.markAsMiscDirty()}))},t.prototype.dispose=function(e,t){this.getScene().stopAnimation(this),this.getScene().freeProcessedMaterials();var i=this._scene.materials.indexOf(this);for(i>=0&&this._scene.materials.splice(i,1),this._scene.onMaterialRemovedObservable.notifyObservers(this),i=0;i<this._scene.meshes.length;i++){var r=this._scene.meshes[__uv.$wrap((i))];if(r.material===this&&(r.material=null,r.geometry)){var n=r.geometry;if(this.storeEffectOnSubMeshes)for(var a=0,o=r.subMeshes;a<o.length;a++){var s=o[__uv.$wrap((a))];n._releaseVertexArrayObject(s._materialEffect),e&&s._materialEffect&&this._scene.getEngine()._releaseEffect(s._materialEffect)}else n._releaseVertexArrayObject(this._effect)}}this._uniformBuffer.dispose(),e&&this._effect&&(this.storeEffectOnSubMeshes||this._scene.getEngine()._releaseEffect(this._effect),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},t.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},t.ParseMultiMaterial=function(t,i){var r=new e.MultiMaterial(t.name,i);r.id=t.id,e.Tags&&e.Tags.AddTagsTo(r,t.tags);for(var n=0;n<t.materials.length;n++){var a=t.materials[__uv.$wrap((n))];a?r.subMaterials.push(i.getMaterialByID(a)):r.subMaterials.push(null)}return r},t.Parse=function(t,i,r){return t.customType&&"BABYLON.StandardMaterial"!==t.customType?"BABYLON.PBRMaterial"!==t.customType||!t.overloadedAlbedo||(t.customType="BABYLON.LegacyPBRMaterial",e.LegacyPBRMaterial)?e.Tools.Instantiate(t.customType).Parse(t,i,r):void e.Tools.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."):e.StandardMaterial.Parse(t,i,r)},t._TriangleFillMode=0,t._WireFrameFillMode=1,t._PointFillMode=2,t._PointListDrawMode=3,t._LineListDrawMode=4,t._LineLoopDrawMode=5,t._LineStripDrawMode=6,t._TriangleStripDrawMode=7,t._TriangleFanDrawMode=8,t._ClockWiseSideOrientation=0,t._CounterClockWiseSideOrientation=1,t.TextureDirtyFlag=1,t.LightDirtyFlag=2,t.FresnelDirtyFlag=4,t.AttributesDirtyFlag=8,t.MiscDirtyFlag=16,t.AllDirtyFlag=31,n([e.serialize()],t.prototype,"id",void 0),n([e.serialize()],t.prototype,"uniqueId",void 0),n([e.serialize()],t.prototype,"name",void 0),n([e.serialize()],t.prototype,"checkReadyOnEveryCall",void 0),n([e.serialize()],t.prototype,"checkReadyOnlyOnce",void 0),n([e.serialize()],t.prototype,"state",void 0),n([e.serialize("alpha")],t.prototype,"_alpha",void 0),n([e.serialize("backFaceCulling")],t.prototype,"_backFaceCulling",void 0),n([e.serialize()],t.prototype,"sideOrientation",void 0),n([e.serialize("alphaMode")],t.prototype,"_alphaMode",void 0),n([e.serialize()],t.prototype,"_needDepthPrePass",void 0),n([e.serialize()],t.prototype,"disableDepthWrite",void 0),n([e.serialize()],t.prototype,"forceDepthWrite",void 0),n([e.serialize()],t.prototype,"separateCullingPass",void 0),n([e.serialize("fogEnabled")],t.prototype,"_fogEnabled",void 0),n([e.serialize()],t.prototype,"pointSize",void 0),n([e.serialize()],t.prototype,"zOffset",void 0),n([e.serialize()],t.prototype,"wireframe",null),n([e.serialize()],t.prototype,"pointsCloud",null),n([e.serialize()],t.prototype,"fillMode",null),t}();e.Material=i}(s||(s={})),function(e){var t=function(){function t(e,t,i){this._engine=e,this._noUBO=!e.supportsUniformBuffers,this._dynamic=i,this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(t.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),t.prototype.isDynamic=function(){return void 0!==this._dynamic},t.prototype.getData=function(){return this._bufferData},t.prototype.getBuffer=function(){return this._buffer},t.prototype._fillAlignment=function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var i=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var r=this._uniformLocationPointer-i,n=0;n<r;n++)this._data.push(0)}},t.prototype.addUniform=function(e,t){if(!this._noUBO&&void 0===this._uniformLocations[__uv.$wrap((e))]){var i;if(t instanceof Array)t=(i=t).length;else{t=t,i=[];for(var r=0;r<t;r++)i.push(0)}this._fillAlignment(t),this._uniformSizes[__uv.$wrap((e))]=t,this._uniformLocations[__uv.$wrap((e))]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(r=0;r<t;r++)this._data.push(i[__uv.$wrap((r))]);this._needSync=!0}},t.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},t.prototype.addFloat2=function(e,t,i){var r=[t,i];this.addUniform(e,r)},t.prototype.addFloat3=function(e,t,i,r){var n=[t,i,r];this.addUniform(e,n)},t.prototype.addColor3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},t.prototype.addColor4=function(e,t,i){var r=new Array;t.toArray(r),r.push(i),this.addUniform(e,r)},t.prototype.addVector3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},t.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},t.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},t.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},t.prototype._rebuild=function(){this._noUBO||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},t.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},t.prototype.updateUniform=function(t,i,r){var n=this._uniformLocations[__uv.$wrap((t))];if(void 0===n){if(this._buffer)return void e.Tools.Error("Cannot add an uniform after UBO has been created.");this.addUniform(t,r),n=this._uniformLocations[__uv.$wrap((t))]}if(this._buffer||this.create(),this._dynamic)for(o=0;o<r;o++)this._bufferData[__uv.$wrap((n+o))]=i[__uv.$wrap((o))];else{for(var a=!1,o=0;o<r;o++)this._bufferData[__uv.$wrap((n+o))]!==i[__uv.$wrap((o))]&&(a=!0,this._bufferData[__uv.$wrap((n+o))]=i[__uv.$wrap((o))]);this._needSync=this._needSync||a}},t.prototype._updateMatrix3x3ForUniform=function(e,i){for(var r=0;r<3;r++)t._tempBuffer[__uv.$wrap((4*r))]=i[__uv.$wrap((3*r))],t._tempBuffer[__uv.$wrap((4*r+1))]=i[__uv.$wrap((3*r+1))],t._tempBuffer[__uv.$wrap((4*r+2))]=i[__uv.$wrap((3*r+2))],t._tempBuffer[__uv.$wrap((4*r+3))]=0;this.updateUniform(e,t._tempBuffer,12)},t.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},t.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},t.prototype._updateMatrix2x2ForUniform=function(e,i){for(var r=0;r<2;r++)t._tempBuffer[__uv.$wrap((4*r))]=i[__uv.$wrap((2*r))],t._tempBuffer[__uv.$wrap((4*r+1))]=i[__uv.$wrap((2*r+1))],t._tempBuffer[__uv.$wrap((4*r+2))]=0,t._tempBuffer[__uv.$wrap((4*r+3))]=0;this.updateUniform(e,t._tempBuffer,8)},t.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},t.prototype._updateFloatForUniform=function(e,i){t._tempBuffer[__uv.$wrap((0))]=i,this.updateUniform(e,t._tempBuffer,1)},t.prototype._updateFloat2ForEffect=function(e,t,i,r){void 0===r&&(r=""),this._currentEffect.setFloat2(e+r,t,i)},t.prototype._updateFloat2ForUniform=function(e,i,r,n){void 0===n&&(n=""),t._tempBuffer[__uv.$wrap((0))]=i,t._tempBuffer[__uv.$wrap((1))]=r,this.updateUniform(e,t._tempBuffer,2)},t.prototype._updateFloat3ForEffect=function(e,t,i,r,n){void 0===n&&(n=""),this._currentEffect.setFloat3(e+n,t,i,r)},t.prototype._updateFloat3ForUniform=function(e,i,r,n,a){void 0===a&&(a=""),t._tempBuffer[__uv.$wrap((0))]=i,t._tempBuffer[__uv.$wrap((1))]=r,t._tempBuffer[__uv.$wrap((2))]=n,this.updateUniform(e,t._tempBuffer,3)},t.prototype._updateFloat4ForEffect=function(e,t,i,r,n,a){void 0===a&&(a=""),this._currentEffect.setFloat4(e+a,t,i,r,n)},t.prototype._updateFloat4ForUniform=function(e,i,r,n,a,o){void 0===o&&(o=""),t._tempBuffer[__uv.$wrap((0))]=i,t._tempBuffer[__uv.$wrap((1))]=r,t._tempBuffer[__uv.$wrap((2))]=n,t._tempBuffer[__uv.$wrap((3))]=a,this.updateUniform(e,t._tempBuffer,4)},t.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},t.prototype._updateMatrixForUniform=function(e,t){this.updateUniform(e,t.toArray(),16)},t.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},t.prototype._updateVector3ForUniform=function(e,i){i.toArray(t._tempBuffer),this.updateUniform(e,t._tempBuffer,3)},t.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},t.prototype._updateVector4ForUniform=function(e,i){i.toArray(t._tempBuffer),this.updateUniform(e,t._tempBuffer,4)},t.prototype._updateColor3ForEffect=function(e,t,i){void 0===i&&(i=""),this._currentEffect.setColor3(e+i,t)},t.prototype._updateColor3ForUniform=function(e,i,r){void 0===r&&(r=""),i.toArray(t._tempBuffer),this.updateUniform(e,t._tempBuffer,3)},t.prototype._updateColor4ForEffect=function(e,t,i,r){void 0===r&&(r=""),this._currentEffect.setColor4(e+r,t,i)},t.prototype._updateColor4ForUniform=function(e,i,r,n){void 0===n&&(n=""),i.toArray(t._tempBuffer),t._tempBuffer[__uv.$wrap((3))]=r,this.updateUniform(e,t._tempBuffer,4)},t.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},t.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},t.prototype.bindToEffect=function(e,t){this._currentEffect=e,!this._noUBO&&this._buffer&&e.bindUniformBuffer(this._buffer,t)},t.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers.indexOf(this);-1!==e&&this._engine._uniformBuffers.splice(e,1),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},t._MAX_UNIFORM_SIZE=256,t._tempBuffer=new Float32Array(t._MAX_UNIFORM_SIZE),t}();e.UniformBuffer=t}(s||(s={})),function(e){var t=function(){function t(){}return t.prototype.set=function(t,i){switch(i){case e.VertexBuffer.PositionKind:this.positions=t;break;case e.VertexBuffer.NormalKind:this.normals=t;break;case e.VertexBuffer.TangentKind:this.tangents=t;break;case e.VertexBuffer.UVKind:this.uvs=t;break;case e.VertexBuffer.UV2Kind:this.uvs2=t;break;case e.VertexBuffer.UV3Kind:this.uvs3=t;break;case e.VertexBuffer.UV4Kind:this.uvs4=t;break;case e.VertexBuffer.UV5Kind:this.uvs5=t;break;case e.VertexBuffer.UV6Kind:this.uvs6=t;break;case e.VertexBuffer.ColorKind:this.colors=t;break;case e.VertexBuffer.MatricesIndicesKind:this.matricesIndices=t;break;case e.VertexBuffer.MatricesWeightsKind:this.matricesWeights=t;break;case e.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case e.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}},t.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},t.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},t.prototype.updateMesh=function(e,t,i){return this._update(e),this},t.prototype.updateGeometry=function(e,t,i){return this._update(e),this},t.prototype._applyTo=function(t,i){return void 0===i&&(i=!1),this.positions&&t.setVerticesData(e.VertexBuffer.PositionKind,this.positions,i),this.normals&&t.setVerticesData(e.VertexBuffer.NormalKind,this.normals,i),this.tangents&&t.setVerticesData(e.VertexBuffer.TangentKind,this.tangents,i),this.uvs&&t.setVerticesData(e.VertexBuffer.UVKind,this.uvs,i),this.uvs2&&t.setVerticesData(e.VertexBuffer.UV2Kind,this.uvs2,i),this.uvs3&&t.setVerticesData(e.VertexBuffer.UV3Kind,this.uvs3,i),this.uvs4&&t.setVerticesData(e.VertexBuffer.UV4Kind,this.uvs4,i),this.uvs5&&t.setVerticesData(e.VertexBuffer.UV5Kind,this.uvs5,i),this.uvs6&&t.setVerticesData(e.VertexBuffer.UV6Kind,this.uvs6,i),this.colors&&t.setVerticesData(e.VertexBuffer.ColorKind,this.colors,i),this.matricesIndices&&t.setVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i),this.matricesWeights&&t.setVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i),this.matricesIndicesExtra&&t.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),this.matricesWeightsExtra&&t.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),this.indices?t.setIndices(this.indices,null,i):t.setIndices([],null),this},t.prototype._update=function(t,i,r){return this.positions&&t.updateVerticesData(e.VertexBuffer.PositionKind,this.positions,i,r),this.normals&&t.updateVerticesData(e.VertexBuffer.NormalKind,this.normals,i,r),this.tangents&&t.updateVerticesData(e.VertexBuffer.TangentKind,this.tangents,i,r),this.uvs&&t.updateVerticesData(e.VertexBuffer.UVKind,this.uvs,i,r),this.uvs2&&t.updateVerticesData(e.VertexBuffer.UV2Kind,this.uvs2,i,r),this.uvs3&&t.updateVerticesData(e.VertexBuffer.UV3Kind,this.uvs3,i,r),this.uvs4&&t.updateVerticesData(e.VertexBuffer.UV4Kind,this.uvs4,i,r),this.uvs5&&t.updateVerticesData(e.VertexBuffer.UV5Kind,this.uvs5,i,r),this.uvs6&&t.updateVerticesData(e.VertexBuffer.UV6Kind,this.uvs6,i,r),this.colors&&t.updateVerticesData(e.VertexBuffer.ColorKind,this.colors,i,r),this.matricesIndices&&t.updateVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i,r),this.matricesWeights&&t.updateVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i,r),this.matricesIndicesExtra&&t.updateVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,r),this.matricesWeightsExtra&&t.updateVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,r),this.indices&&t.setIndices(this.indices,null),this},t.prototype.transform=function(t){var i,r=t.m[__uv.$wrap((0))]*t.m[__uv.$wrap((5))]*t.m[__uv.$wrap((10))]<0,n=e.Vector3.Zero();if(this.positions){var a=e.Vector3.Zero();for(i=0;i<this.positions.length;i+=3)e.Vector3.FromArrayToRef(this.positions,i,a),e.Vector3.TransformCoordinatesToRef(a,t,n),this.positions[__uv.$wrap((i))]=n.x,this.positions[__uv.$wrap((i+1))]=n.y,this.positions[__uv.$wrap((i+2))]=n.z}if(this.normals){var o=e.Vector3.Zero();for(i=0;i<this.normals.length;i+=3)e.Vector3.FromArrayToRef(this.normals,i,o),e.Vector3.TransformNormalToRef(o,t,n),this.normals[__uv.$wrap((i))]=n.x,this.normals[__uv.$wrap((i+1))]=n.y,this.normals[__uv.$wrap((i+2))]=n.z}if(this.tangents){var s=e.Vector4.Zero(),l=e.Vector4.Zero();for(i=0;i<this.tangents.length;i+=4)e.Vector4.FromArrayToRef(this.tangents,i,s),e.Vector4.TransformNormalToRef(s,t,l),this.tangents[__uv.$wrap((i))]=l.x,this.tangents[__uv.$wrap((i+1))]=l.y,this.tangents[__uv.$wrap((i+2))]=l.z,this.tangents[__uv.$wrap((i+3))]=l.w}if(r&&this.indices)for(i=0;i<this.indices.length;i+=3){var c=this.indices[__uv.$wrap((i+1))];this.indices[__uv.$wrap((i+1))]=this.indices[__uv.$wrap((i+2))],this.indices[__uv.$wrap((i+2))]=c}return this},t.prototype.merge=function(e,t){if(void 0===t&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var i=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var r=this.indices.length+e.indices.length,n=t||this.indices instanceof Uint32Array?new Uint32Array(r):new Uint16Array(r);n.set(this.indices);for(var a=this.indices.length,o=0;o<e.indices.length;o++)n[__uv.$wrap((a+o))]=e.indices[__uv.$wrap((o))]+i;this.indices=n}else for(o=0;o<e.indices.length;o++)this.indices.push(e.indices[__uv.$wrap((o))]+i)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},t.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var i=t.length+e.length,r=e instanceof Float32Array,n=t instanceof Float32Array;if(r){var a=new Float32Array(i);return a.set(e),a.set(t,e.length),a}if(n){var o=e.slice(0),s=0;for(i=t.length;s<i;s++)o.push(t[__uv.$wrap((s))]);return o}return e.concat(t)},t.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var t=function(t,i){var r=e.VertexBuffer.DeduceStride(t);if(i.length%r!=0)throw new Error("The "+t+"s array count must be a multiple of "+r);return i.length/r},i=t(e.VertexBuffer.PositionKind,this.positions),r=function(e,r){var n=t(e,r);if(n!==i)throw new Error("The "+e+"s element count ("+n+") does not match the positions count ("+i+")")};this.normals&&r(e.VertexBuffer.NormalKind,this.normals),this.tangents&&r(e.VertexBuffer.TangentKind,this.tangents),this.uvs&&r(e.VertexBuffer.UVKind,this.uvs),this.uvs2&&r(e.VertexBuffer.UV2Kind,this.uvs2),this.uvs3&&r(e.VertexBuffer.UV3Kind,this.uvs3),this.uvs4&&r(e.VertexBuffer.UV4Kind,this.uvs4),this.uvs5&&r(e.VertexBuffer.UV5Kind,this.uvs5),this.uvs6&&r(e.VertexBuffer.UV6Kind,this.uvs6),this.colors&&r(e.VertexBuffer.ColorKind,this.colors),this.matricesIndices&&r(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&r(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&r(e.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&r(e.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra)},t.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},t.ExtractFromMesh=function(e,i,r){return t._ExtractFrom(e,i,r)},t.ExtractFromGeometry=function(e,i,r){return t._ExtractFrom(e,i,r)},t._ExtractFrom=function(i,r,n){var a=new t;return i.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(a.positions=i.getVerticesData(e.VertexBuffer.PositionKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(a.normals=i.getVerticesData(e.VertexBuffer.NormalKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.TangentKind)&&(a.tangents=i.getVerticesData(e.VertexBuffer.TangentKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(a.uvs=i.getVerticesData(e.VertexBuffer.UVKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(a.uvs2=i.getVerticesData(e.VertexBuffer.UV2Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV3Kind)&&(a.uvs3=i.getVerticesData(e.VertexBuffer.UV3Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV4Kind)&&(a.uvs4=i.getVerticesData(e.VertexBuffer.UV4Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV5Kind)&&(a.uvs5=i.getVerticesData(e.VertexBuffer.UV5Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV6Kind)&&(a.uvs6=i.getVerticesData(e.VertexBuffer.UV6Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(a.colors=i.getVerticesData(e.VertexBuffer.ColorKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(a.matricesIndices=i.getVerticesData(e.VertexBuffer.MatricesIndicesKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(a.matricesWeights=i.getVerticesData(e.VertexBuffer.MatricesWeightsKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesExtraKind)&&(a.matricesIndicesExtra=i.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsExtraKind)&&(a.matricesWeightsExtra=i.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,r,n)),a.indices=i.getIndices(r,n),a},t.CreateRibbon=function(i){var r=i.pathArray,n=i.closeArray||!1,a=i.closePath||!1,o=i.invertUV||!1,s=Math.floor(r[__uv.$wrap((0))].length/2),l=i.offset||s;l=l>s?s:Math.floor(l);var c,u,h,d,p=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,m=i.uvs,_=i.colors,f=[],g=[],y=[],v=[],b=[],x=[],S=[],T=[],E=[],P=[];if(r.length<2){var A=[],M=[];for(h=0;h<r[__uv.$wrap((0))].length-l;h++)A.push(r[__uv.$wrap((0))][__uv.$wrap((h))]),M.push(r[__uv.$wrap((0))][__uv.$wrap((h+l))]);r=[A,M]}var C,R,w,I,O,D=0,k=a?1:0;for(c=r[__uv.$wrap((0))].length,u=0;u<r.length;u++){for(S[__uv.$wrap((u))]=0,b[__uv.$wrap((u))]=[0],c=c<(R=(C=r[__uv.$wrap((u))]).length)?c:R,d=0;d<R;)f.push(C[__uv.$wrap((d))].x,C[__uv.$wrap((d))].y,C[__uv.$wrap((d))].z),d>0&&(w=C[__uv.$wrap((d))].subtract(C[__uv.$wrap((d-1))]).length()+S[__uv.$wrap((u))],b[__uv.$wrap((u))].push(w),S[__uv.$wrap((u))]=w),d++;a&&(d--,f.push(C[__uv.$wrap((0))].x,C[__uv.$wrap((0))].y,C[__uv.$wrap((0))].z),w=C[__uv.$wrap((d))].subtract(C[__uv.$wrap((0))]).length()+S[__uv.$wrap((u))],b[__uv.$wrap((u))].push(w),S[__uv.$wrap((u))]=w),E[__uv.$wrap((u))]=R+k,P[__uv.$wrap((u))]=D,D+=R+k}var B,F,L=null,N=null;for(h=0;h<c+k;h++){for(T[__uv.$wrap((h))]=0,x[__uv.$wrap((h))]=[0],u=0;u<r.length-1;u++)I=r[__uv.$wrap((u))],O=r[__uv.$wrap((u+1))],h===c?(L=I[__uv.$wrap((0))],N=O[__uv.$wrap((0))]):(L=I[__uv.$wrap((h))],N=O[__uv.$wrap((h))]),w=N.subtract(L).length()+T[__uv.$wrap((h))],x[__uv.$wrap((h))].push(w),T[__uv.$wrap((h))]=w;n&&N&&L&&(I=r[__uv.$wrap((u))],O=r[__uv.$wrap((0))],h===c&&(N=O[__uv.$wrap((0))]),w=N.subtract(L).length()+T[__uv.$wrap((h))],T[__uv.$wrap((h))]=w)}if(m)for(u=0;u<m.length;u++)v.push(m[__uv.$wrap((u))].x,m[__uv.$wrap((u))].y);else for(u=0;u<r.length;u++)for(h=0;h<c+k;h++)B=0!=S[__uv.$wrap((u))]?b[__uv.$wrap((u))][__uv.$wrap((h))]/S[__uv.$wrap((u))]:0,F=0!=T[__uv.$wrap((h))]?x[__uv.$wrap((h))][__uv.$wrap((u))]/T[__uv.$wrap((h))]:0,o?v.push(F,B):v.push(B,F);for(var V=0,G=E[__uv.$wrap((u=0))]-1,U=E[__uv.$wrap((u+1))]-1,z=G<U?G:U,H=P[__uv.$wrap((1))]-P[__uv.$wrap((0))],W=n?E.length:E.length-1;V<=z&&u<W;)g.push(V,V+H,V+1),g.push(V+H+1,V+1,V+H),(V+=1)===z&&(++u===E.length-1?(H=P[__uv.$wrap((0))]-P[__uv.$wrap((u))],G=E[__uv.$wrap((u))]-1,U=E[__uv.$wrap((0))]-1):(H=P[__uv.$wrap((u+1))]-P[__uv.$wrap((u))],G=E[__uv.$wrap((u))]-1,U=E[__uv.$wrap((u+1))]-1),V=P[__uv.$wrap((u))],z=G<U?G+V:U+V);if(t.ComputeNormals(f,g,y),a){var j=0,X=0;for(u=0;u<r.length;u++)j=3*P[__uv.$wrap((u))],X=u+1<r.length?3*(P[__uv.$wrap((u+1))]-1):y.length-3,y[__uv.$wrap((j))]=.5*(y[__uv.$wrap((j))]+y[__uv.$wrap((X))]),y[__uv.$wrap((j+1))]=.5*(y[__uv.$wrap((j+1))]+y[__uv.$wrap((X+1))]),y[__uv.$wrap((j+2))]=.5*(y[__uv.$wrap((j+2))]+y[__uv.$wrap((X+2))]),y[__uv.$wrap((X))]=y[__uv.$wrap((j))],y[__uv.$wrap((X+1))]=y[__uv.$wrap((j+1))],y[__uv.$wrap((X+2))]=y[__uv.$wrap((j+2))]}t._ComputeSides(p,f,g,y,v,i.frontUVs,i.backUVs);var Y=null;if(_){Y=new Float32Array(4*_.length);for(var K=0;K<_.length;K++)Y[__uv.$wrap((4*K))]=_[__uv.$wrap((K))].r,Y[__uv.$wrap((4*K+1))]=_[__uv.$wrap((K))].g,Y[__uv.$wrap((4*K+2))]=_[__uv.$wrap((K))].b,Y[__uv.$wrap((4*K+3))]=_[__uv.$wrap((K))].a}var Q=new t,Z=new Float32Array(f),q=new Float32Array(y),J=new Float32Array(v);return Q.indices=g,Q.positions=Z,Q.normals=q,Q.uvs=J,Y&&Q.set(Y,e.VertexBuffer.ColorKind),a&&(Q._idx=P),Q},t.CreateBox=function(i){for(var r=[new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,-1,0)],n=[],a=[],o=[],s=[],l=i.width||i.size||1,c=i.height||i.size||1,u=i.depth||i.size||1,h=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,d=i.faceUV||new Array(6),p=i.faceColors,m=[],_=0;_<6;_++)void 0===d[__uv.$wrap((_))]&&(d[__uv.$wrap((_))]=new e.Vector4(0,0,1,1)),p&&void 0===p[__uv.$wrap((_))]&&(p[__uv.$wrap((_))]=new e.Color4(1,1,1,1));for(var f=new e.Vector3(l/2,c/2,u/2),g=0;g<r.length;g++){var y=r[__uv.$wrap((g))],v=new e.Vector3(y.y,y.z,y.x),b=e.Vector3.Cross(y,v),x=a.length/3;n.push(x),n.push(x+1),n.push(x+2),n.push(x),n.push(x+2),n.push(x+3);var S=y.subtract(v).subtract(b).multiply(f);a.push(S.x,S.y,S.z),o.push(y.x,y.y,y.z),s.push(d[__uv.$wrap((g))].z,d[__uv.$wrap((g))].w),p&&m.push(p[__uv.$wrap((g))].r,p[__uv.$wrap((g))].g,p[__uv.$wrap((g))].b,p[__uv.$wrap((g))].a),S=y.subtract(v).add(b).multiply(f),a.push(S.x,S.y,S.z),o.push(y.x,y.y,y.z),s.push(d[__uv.$wrap((g))].x,d[__uv.$wrap((g))].w),p&&m.push(p[__uv.$wrap((g))].r,p[__uv.$wrap((g))].g,p[__uv.$wrap((g))].b,p[__uv.$wrap((g))].a),S=y.add(v).add(b).multiply(f),a.push(S.x,S.y,S.z),o.push(y.x,y.y,y.z),s.push(d[__uv.$wrap((g))].x,d[__uv.$wrap((g))].y),p&&m.push(p[__uv.$wrap((g))].r,p[__uv.$wrap((g))].g,p[__uv.$wrap((g))].b,p[__uv.$wrap((g))].a),S=y.add(v).subtract(b).multiply(f),a.push(S.x,S.y,S.z),o.push(y.x,y.y,y.z),s.push(d[__uv.$wrap((g))].z,d[__uv.$wrap((g))].y),p&&m.push(p[__uv.$wrap((g))].r,p[__uv.$wrap((g))].g,p[__uv.$wrap((g))].b,p[__uv.$wrap((g))].a)}t._ComputeSides(h,a,n,o,s,i.frontUVs,i.backUVs);var T=new t;if(T.indices=n,T.positions=a,T.normals=o,T.uvs=s,p){var E=h===e.Mesh.DOUBLESIDE?m.concat(m):m;T.colors=E}return T},t.CreateSphere=function(i){for(var r=i.segments||32,n=i.diameterX||i.diameter||1,a=i.diameterY||i.diameter||1,o=i.diameterZ||i.diameter||1,s=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,l=i.slice&&i.slice<=0?1:i.slice||1,c=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,u=new e.Vector3(n/2,a/2,o/2),h=2+r,d=2*h,p=[],m=[],_=[],f=[],g=0;g<=h;g++){for(var y=g/h,v=y*Math.PI*l,b=0;b<=d;b++){var x=b/d,S=x*Math.PI*2*s,T=e.Matrix.RotationZ(-v),E=e.Matrix.RotationY(S),P=e.Vector3.TransformCoordinates(e.Vector3.Up(),T),A=e.Vector3.TransformCoordinates(P,E),M=A.multiply(u),C=A.divide(u).normalize();m.push(M.x,M.y,M.z),_.push(C.x,C.y,C.z),f.push(x,y)}if(g>0)for(var R=m.length/3,w=R-2*(d+1);w+d+2<R;w++)p.push(w),p.push(w+1),p.push(w+d+1),p.push(w+d+1),p.push(w+1),p.push(w+d+2)}t._ComputeSides(c,m,p,_,f,i.frontUVs,i.backUVs);var I=new t;return I.indices=p,I.positions=m,I.normals=_,I.uvs=f,I},t.CreateCylinder=function(i){var r,n=i.height||2,a=0===i.diameterTop?0:i.diameterTop||i.diameter||1,o=0===i.diameterBottom?0:i.diameterBottom||i.diameter||1,s=i.tessellation||24,l=i.subdivisions||1,c=!!i.hasRings,u=!!i.enclose,h=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,d=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,p=i.faceUV||new Array(3),m=i.faceColors,_=2+(1+(1!==h&&u?2:0))*(c?l:1);for(r=0;r<_;r++)m&&void 0===m[__uv.$wrap((r))]&&(m[__uv.$wrap((r))]=new e.Color4(1,1,1,1));for(r=0;r<_;r++)p&&void 0===p[__uv.$wrap((r))]&&(p[__uv.$wrap((r))]=new e.Vector4(0,0,1,1));var f,g,y,v,b,x,S=new Array,T=new Array,E=new Array,P=new Array,A=new Array,M=2*Math.PI*h/s,C=(o-a)/2/n,R=e.Vector3.Zero(),w=e.Vector3.Zero(),I=e.Vector3.Zero(),O=e.Vector3.Zero(),D=e.Vector3.Zero(),k=e.Axis.Y,B=1,F=1,L=0,N=0;for(v=0;v<=l;v++)for(y=((g=v/l)*(a-o)+o)/2,B=c&&0!==v&&v!==l?2:1,x=0;x<B;x++){for(c&&(F+=x),u&&(F+=2*x),b=0;b<=s;b++)f=b*M,R.x=Math.cos(-f)*y,R.y=-n/2+g*n,R.z=Math.sin(-f)*y,0===a&&v===l?(w.x=E[__uv.$wrap((E.length-3*(s+1)))],w.y=E[__uv.$wrap((E.length-3*(s+1)+1))],w.z=E[__uv.$wrap((E.length-3*(s+1)+2))]):(w.x=R.x,w.z=R.z,w.y=Math.sqrt(w.x*w.x+w.z*w.z)*C,w.normalize()),0===b&&(I.copyFrom(R),O.copyFrom(w)),T.push(R.x,R.y,R.z),E.push(w.x,w.y,w.z),N=c?L!==F?p[__uv.$wrap((F))].y:p[__uv.$wrap((F))].w:p[__uv.$wrap((F))].y+(p[__uv.$wrap((F))].w-p[__uv.$wrap((F))].y)*g,P.push(p[__uv.$wrap((F))].x+(p[__uv.$wrap((F))].z-p[__uv.$wrap((F))].x)*b/s,N),m&&A.push(m[__uv.$wrap((F))].r,m[__uv.$wrap((F))].g,m[__uv.$wrap((F))].b,m[__uv.$wrap((F))].a);1!==h&&u&&(T.push(R.x,R.y,R.z),T.push(0,R.y,0),T.push(0,R.y,0),T.push(I.x,I.y,I.z),e.Vector3.CrossToRef(k,w,D),D.normalize(),E.push(D.x,D.y,D.z,D.x,D.y,D.z),e.Vector3.CrossToRef(O,k,D),D.normalize(),E.push(D.x,D.y,D.z,D.x,D.y,D.z),N=c?L!==F?p[__uv.$wrap((F+1))].y:p[__uv.$wrap((F+1))].w:p[__uv.$wrap((F+1))].y+(p[__uv.$wrap((F+1))].w-p[__uv.$wrap((F+1))].y)*g,P.push(p[__uv.$wrap((F+1))].x,N),P.push(p[__uv.$wrap((F+1))].z,N),N=c?L!==F?p[__uv.$wrap((F+2))].y:p[__uv.$wrap((F+2))].w:p[__uv.$wrap((F+2))].y+(p[__uv.$wrap((F+2))].w-p[__uv.$wrap((F+2))].y)*g,P.push(p[__uv.$wrap((F+2))].x,N),P.push(p[__uv.$wrap((F+2))].z,N),m&&(A.push(m[__uv.$wrap((F+1))].r,m[__uv.$wrap((F+1))].g,m[__uv.$wrap((F+1))].b,m[__uv.$wrap((F+1))].a),A.push(m[__uv.$wrap((F+1))].r,m[__uv.$wrap((F+1))].g,m[__uv.$wrap((F+1))].b,m[__uv.$wrap((F+1))].a),A.push(m[__uv.$wrap((F+2))].r,m[__uv.$wrap((F+2))].g,m[__uv.$wrap((F+2))].b,m[__uv.$wrap((F+2))].a),A.push(m[__uv.$wrap((F+2))].r,m[__uv.$wrap((F+2))].g,m[__uv.$wrap((F+2))].b,m[__uv.$wrap((F+2))].a))),L!==F&&(L=F)}var V=1!==h&&u?s+4:s;for(v=0,F=0;F<l;F++){var G=0,U=0,z=0,H=0;for(b=0;b<s;b++)G=v*(V+1)+b,U=(v+1)*(V+1)+b,z=v*(V+1)+(b+1),H=(v+1)*(V+1)+(b+1),S.push(G,U,z),S.push(H,z,U);1!==h&&u&&(S.push(G+2,U+2,z+2),S.push(H+2,z+2,U+2),S.push(G+4,U+4,z+4),S.push(H+4,z+4,U+4)),v=c?v+2:v+1}var W=function(t){var i=t?a/2:o/2;if(0!==i){var r,l,c,u=t?p[__uv.$wrap((_-1))]:p[__uv.$wrap((0))],d=null;m&&(d=t?m[__uv.$wrap((_-1))]:m[__uv.$wrap((0))]);var f=T.length/3,g=t?n/2:-n/2,y=new e.Vector3(0,g,0);T.push(y.x,y.y,y.z),E.push(0,t?1:-1,0),P.push(u.x+.5*(u.z-u.x),u.y+.5*(u.w-u.y)),d&&A.push(d.r,d.g,d.b,d.a);var v=new e.Vector2(.5,.5);for(c=0;c<=s;c++){r=2*Math.PI*c*h/s;var b=Math.cos(-r),x=Math.sin(-r);l=new e.Vector3(b*i,g,x*i);var M=new e.Vector2(b*v.x+.5,x*v.y+.5);T.push(l.x,l.y,l.z),E.push(0,t?1:-1,0),P.push(u.x+(u.z-u.x)*M.x,u.y+(u.w-u.y)*M.y),d&&A.push(d.r,d.g,d.b,d.a)}for(c=0;c<s;c++)t?(S.push(f),S.push(f+(c+2)),S.push(f+(c+1))):(S.push(f),S.push(f+(c+1)),S.push(f+(c+2)))}};W(!1),W(!0),t._ComputeSides(d,T,S,E,P,i.frontUVs,i.backUVs);var j=new t;return j.indices=S,j.positions=T,j.normals=E,j.uvs=P,m&&(j.colors=A),j},t.CreateTorus=function(i){for(var r=[],n=[],a=[],o=[],s=i.diameter||1,l=i.thickness||.5,c=i.tessellation||16,u=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,h=c+1,d=0;d<=c;d++)for(var p=d/c,m=d*Math.PI*2/c-Math.PI/2,_=e.Matrix.Translation(s/2,0,0).multiply(e.Matrix.RotationY(m)),f=0;f<=c;f++){var g=1-f/c,y=f*Math.PI*2/c+Math.PI,v=Math.cos(y),b=Math.sin(y),x=new e.Vector3(v,b,0),S=x.scale(l/2),T=new e.Vector2(p,g);S=e.Vector3.TransformCoordinates(S,_),x=e.Vector3.TransformNormal(x,_),n.push(S.x,S.y,S.z),a.push(x.x,x.y,x.z),o.push(T.x,T.y);var E=(d+1)%h,P=(f+1)%h;r.push(d*h+f),r.push(d*h+P),r.push(E*h+f),r.push(d*h+P),r.push(E*h+P),r.push(E*h+f)}t._ComputeSides(u,n,r,a,o,i.frontUVs,i.backUVs);var A=new t;return A.indices=r,A.positions=n,A.normals=a,A.uvs=o,A},t.CreateLineSystem=function(e){for(var i=[],r=[],n=e.lines,a=e.colors,o=[],s=0,l=0;l<n.length;l++)for(var c=n[__uv.$wrap((l))],u=0;u<c.length;u++){if(r.push(c[__uv.$wrap((u))].x,c[__uv.$wrap((u))].y,c[__uv.$wrap((u))].z),a){var h=a[__uv.$wrap((l))];o.push(h[__uv.$wrap((u))].r,h[__uv.$wrap((u))].g,h[__uv.$wrap((u))].b,h[__uv.$wrap((u))].a)}u>0&&(i.push(s-1),i.push(s)),s++}var d=new t;return d.indices=i,d.positions=r,a&&(d.colors=o),d},t.CreateDashedLines=function(i){var r,n,a=i.dashSize||3,o=i.gapSize||1,s=i.dashNb||200,l=i.points,c=new Array,u=new Array,h=e.Vector3.Zero(),d=0,p=0,m=0,_=0,f=0;for(f=0;f<l.length-1;f++)l[__uv.$wrap((f+1))].subtractToRef(l[__uv.$wrap((f))],h),d+=h.length();for(n=a*(r=d/s)/(a+o),f=0;f<l.length-1;f++){l[__uv.$wrap((f+1))].subtractToRef(l[__uv.$wrap((f))],h),p=Math.floor(h.length()/r),h.normalize();for(var g=0;g<p;g++)m=r*g,c.push(l[__uv.$wrap((f))].x+m*h.x,l[__uv.$wrap((f))].y+m*h.y,l[__uv.$wrap((f))].z+m*h.z),c.push(l[__uv.$wrap((f))].x+(m+n)*h.x,l[__uv.$wrap((f))].y+(m+n)*h.y,l[__uv.$wrap((f))].z+(m+n)*h.z),u.push(_,_+1),_+=2}var y=new t;return y.positions=c,y.indices=u,y},t.CreateGround=function(i){var r,n,a=[],o=[],s=[],l=[],c=i.width||1,u=i.height||1,h=i.subdivisionsX||i.subdivisions||1,d=i.subdivisionsY||i.subdivisions||1;for(r=0;r<=d;r++)for(n=0;n<=h;n++){var p=new e.Vector3(n*c/h-c/2,0,(d-r)*u/d-u/2),m=new e.Vector3(0,1,0);o.push(p.x,p.y,p.z),s.push(m.x,m.y,m.z),l.push(n/h,1-r/d)}for(r=0;r<d;r++)for(n=0;n<h;n++)a.push(n+1+(r+1)*(h+1)),a.push(n+1+r*(h+1)),a.push(n+r*(h+1)),a.push(n+(r+1)*(h+1)),a.push(n+1+(r+1)*(h+1)),a.push(n+r*(h+1));var _=new t;return _.indices=a,_.positions=o,_.normals=s,_.uvs=l,_},t.CreateTiledGround=function(i){var r,n,a,o,s=void 0!==i.xmin&&null!==i.xmin?i.xmin:-1,l=void 0!==i.zmin&&null!==i.zmin?i.zmin:-1,c=void 0!==i.xmax&&null!==i.xmax?i.xmax:1,u=void 0!==i.zmax&&null!==i.zmax?i.zmax:1,h=i.subdivisions||{w:1,h:1},d=i.precision||{w:1,h:1},p=new Array,m=new Array,_=new Array,f=new Array;h.h=h.h<1?1:h.h,h.w=h.w<1?1:h.w,d.w=d.w<1?1:d.w,d.h=d.h<1?1:d.h;var g=(c-s)/h.w,y=(u-l)/h.h;function v(t,i,a,o){var s=m.length/3,l=d.w+1;for(r=0;r<d.h;r++)for(n=0;n<d.w;n++){var c=[s+n+r*l,s+(n+1)+r*l,s+(n+1)+(r+1)*l,s+n+(r+1)*l];p.push(c[__uv.$wrap((1))]),p.push(c[__uv.$wrap((2))]),p.push(c[__uv.$wrap((3))]),p.push(c[__uv.$wrap((0))]),p.push(c[__uv.$wrap((1))]),p.push(c[__uv.$wrap((3))])}var u=e.Vector3.Zero(),h=new e.Vector3(0,1,0);for(r=0;r<=d.h;r++)for(u.z=r*(o-i)/d.h+i,n=0;n<=d.w;n++)u.x=n*(a-t)/d.w+t,u.y=0,m.push(u.x,u.y,u.z),_.push(h.x,h.y,h.z),f.push(n/d.w,r/d.h)}for(a=0;a<h.h;a++)for(o=0;o<h.w;o++)v(s+o*g,l+a*y,s+(o+1)*g,l+(a+1)*y);var b=new t;return b.indices=p,b.positions=m,b.normals=_,b.uvs=f,b},t.CreateGroundFromHeightMap=function(i){var r,n,a=[],o=[],s=[],l=[],c=i.colorFilter||new e.Color3(.3,.59,.11),u=i.alphaFilter||0;for(r=0;r<=i.subdivisions;r++)for(n=0;n<=i.subdivisions;n++){var h=new e.Vector3(n*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-r)*i.height/i.subdivisions-i.height/2),d=4*(((h.x+i.width/2)/i.width*(i.bufferWidth-1)|0)+((1-(h.z+i.height/2)/i.height)*(i.bufferHeight-1)|0)*i.bufferWidth),p=i.buffer[__uv.$wrap((d))]/255,m=i.buffer[__uv.$wrap((d+1))]/255,_=i.buffer[__uv.$wrap((d+2))]/255,f=i.buffer[__uv.$wrap((d+3))]/255,g=p*c.r+m*c.g+_*c.b;h.y=f>=u?i.minHeight+(i.maxHeight-i.minHeight)*g:i.minHeight-e.Epsilon,o.push(h.x,h.y,h.z),s.push(0,0,0),l.push(n/i.subdivisions,1-r/i.subdivisions)}for(r=0;r<i.subdivisions;r++)for(n=0;n<i.subdivisions;n++){var y=n+1+(r+1)*(i.subdivisions+1),v=n+1+r*(i.subdivisions+1),b=n+r*(i.subdivisions+1),x=n+(r+1)*(i.subdivisions+1),S=o[__uv.$wrap((3*y+1))]>=i.minHeight,T=o[__uv.$wrap((3*v+1))]>=i.minHeight,E=o[__uv.$wrap((3*b+1))]>=i.minHeight;S&&T&&E&&(a.push(y),a.push(v),a.push(b)),o[__uv.$wrap((3*x+1))]>=i.minHeight&&S&&E&&(a.push(x),a.push(y),a.push(b))}t.ComputeNormals(o,a,s);var P=new t;return P.indices=a,P.positions=o,P.normals=s,P.uvs=l,P},t.CreatePlane=function(i){var r=[],n=[],a=[],o=[],s=i.width||i.size||1,l=i.height||i.size||1,c=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,u=s/2,h=l/2;n.push(-u,-h,0),a.push(0,0,-1),o.push(0,0),n.push(u,-h,0),a.push(0,0,-1),o.push(1,0),n.push(u,h,0),a.push(0,0,-1),o.push(1,1),n.push(-u,h,0),a.push(0,0,-1),o.push(0,1),r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),t._ComputeSides(c,n,r,a,o,i.frontUVs,i.backUVs);var d=new t;return d.indices=r,d.positions=n,d.normals=a,d.uvs=o,d},t.CreateDisc=function(i){var r=new Array,n=new Array,a=new Array,o=new Array,s=i.radius||.5,l=i.tessellation||64,c=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,u=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE;r.push(0,0,0),o.push(.5,.5);for(var h=2*Math.PI*c,d=h/l,p=0;p<h;p+=d){var m=Math.cos(p),_=Math.sin(p),f=(m+1)/2,g=(1-_)/2;r.push(s*m,s*_,0),o.push(f,g)}1===c&&(r.push(r[__uv.$wrap((3))],r[__uv.$wrap((4))],r[__uv.$wrap((5))]),o.push(o[__uv.$wrap((2))],o[__uv.$wrap((3))]));for(var y=r.length/3,v=1;v<y-1;v++)n.push(v+1,0,v);t.ComputeNormals(r,n,a),t._ComputeSides(u,r,n,a,o,i.frontUVs,i.backUVs);var b=new t;return b.indices=n,b.positions=r,b.normals=a,b.uvs=o,b},t.CreatePolygon=function(i,r,n,a,o,s){for(var l=n||new Array(3),c=a,u=[],h=0;h<3;h++)void 0===l[__uv.$wrap((h))]&&(l[__uv.$wrap((h))]=new e.Vector4(0,0,1,1)),c&&void 0===c[__uv.$wrap((h))]&&(c[__uv.$wrap((h))]=new e.Color4(1,1,1,1));for(var d=i.getVerticesData(e.VertexBuffer.PositionKind),p=i.getVerticesData(e.VertexBuffer.NormalKind),m=i.getVerticesData(e.VertexBuffer.UVKind),_=i.getIndices(),f=0,g=0,y=0;y<p.length;y+=3)Math.abs(p[__uv.$wrap((y+1))])<.001&&(g=1),Math.abs(p[__uv.$wrap((y+1))]-1)<.001&&(g=0),Math.abs(p[__uv.$wrap((y+1))]+1)<.001&&(g=2),m[__uv.$wrap((2*(f=y/3)))]=(1-m[__uv.$wrap((2*f))])*l[__uv.$wrap((g))].x+m[__uv.$wrap((2*f))]*l[__uv.$wrap((g))].z,m[__uv.$wrap((2*f+1))]=(1-m[__uv.$wrap((2*f+1))])*l[__uv.$wrap((g))].y+m[__uv.$wrap((2*f+1))]*l[__uv.$wrap((g))].w,c&&u.push(c[__uv.$wrap((g))].r,c[__uv.$wrap((g))].g,c[__uv.$wrap((g))].b,c[__uv.$wrap((g))].a);t._ComputeSides(r,d,_,p,m,o,s);var v=new t;if(v.indices=_,v.positions=d,v.normals=p,v.uvs=m,c){var b=r===e.Mesh.DOUBLESIDE?u.concat(u):u;v.colors=b}return v},t.CreateIcoSphere=function(i){var r,n=i.sideOrientation||e.Mesh.DEFAULTSIDE,a=i.radius||1,o=void 0===i.flat||i.flat,s=i.subdivisions||4,l=i.radiusX||a,c=i.radiusY||a,u=i.radiusZ||a,h=(1+Math.sqrt(5))/2,d=[-1,h,-0,1,h,0,-1,-h,0,1,-h,0,0,-1,-h,0,1,-h,0,-1,h,0,1,h,h,0,1,h,0,-1,-h,0,1,-h,0,-1],p=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],m=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],_=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],f=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],g=new Array,y=new Array,v=new Array,b=new Array,x=0,S=new Array(3),T=new Array(3);for(r=0;r<3;r++)S[__uv.$wrap((r))]=e.Vector3.Zero(),T[__uv.$wrap((r))]=e.Vector2.Zero();for(var E=0;E<20;E++){for(r=0;r<3;r++){var P=p[__uv.$wrap((3*E+r))];S[__uv.$wrap((r))].copyFromFloats(d[__uv.$wrap((3*m[__uv.$wrap((P))]))],d[__uv.$wrap((3*m[__uv.$wrap((P))]+1))],d[__uv.$wrap((3*m[__uv.$wrap((P))]+2))]),S[__uv.$wrap((r))].normalize().scaleInPlace(a),T[__uv.$wrap((r))].copyFromFloats(_[__uv.$wrap((2*P))]*(138/1024)+60/1024+f[__uv.$wrap((E))]*(-40/1024),_[__uv.$wrap((2*P+1))]*(239/1024)+26/1024+f[__uv.$wrap((E))]*(20/1024))}for(var A=function(t,i,r,n){var a,h=e.Vector3.Lerp(S[__uv.$wrap((0))],S[__uv.$wrap((2))],i/s),d=e.Vector3.Lerp(S[__uv.$wrap((1))],S[__uv.$wrap((2))],i/s),p=s===i?S[__uv.$wrap((2))]:e.Vector3.Lerp(h,d,t/(s-i));if(p.normalize(),o){var m=e.Vector3.Lerp(S[__uv.$wrap((0))],S[__uv.$wrap((2))],n/s),_=e.Vector3.Lerp(S[__uv.$wrap((1))],S[__uv.$wrap((2))],n/s);a=e.Vector3.Lerp(m,_,r/(s-n))}else a=new e.Vector3(p.x,p.y,p.z);a.x/=l,a.y/=c,a.z/=u,a.normalize();var f=e.Vector2.Lerp(T[__uv.$wrap((0))],T[__uv.$wrap((2))],i/s),E=e.Vector2.Lerp(T[__uv.$wrap((1))],T[__uv.$wrap((2))],i/s),P=s===i?T[__uv.$wrap((2))]:e.Vector2.Lerp(f,E,t/(s-i));y.push(p.x*l,p.y*c,p.z*u),v.push(a.x,a.y,a.z),b.push(P.x,P.y),g.push(x),x++},M=0;M<s;M++)for(var C=0;C+M<s;C++)A(C,M,C+1/3,M+1/3),A(C+1,M,C+1/3,M+1/3),A(C,M+1,C+1/3,M+1/3),C+M+1<s&&(A(C+1,M,C+2/3,M+2/3),A(C+1,M+1,C+2/3,M+2/3),A(C,M+1,C+2/3,M+2/3))}t._ComputeSides(n,y,g,v,b,i.frontUVs,i.backUVs);var R=new t;return R.indices=g,R.positions=y,R.normals=v,R.uvs=b,R},t.CreatePolyhedron=function(i){var r=[];r[__uv.$wrap((0))]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},r[__uv.$wrap((1))]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},r[__uv.$wrap((2))]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},r[__uv.$wrap((3))]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},r[__uv.$wrap((4))]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},r[__uv.$wrap((5))]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},r[__uv.$wrap((6))]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},r[__uv.$wrap((7))]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},r[__uv.$wrap((8))]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},r[__uv.$wrap((9))]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},r[__uv.$wrap((10))]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},r[__uv.$wrap((11))]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},r[__uv.$wrap((12))]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},r[__uv.$wrap((13))]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},r[__uv.$wrap((14))]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var n,a,o,s,l,c,u=i.type&&(i.type<0||i.type>=r.length)?0:i.type||0,h=i.size,d=i.sizeX||h||1,p=i.sizeY||h||1,m=i.sizeZ||h||1,_=i.custom||r[__uv.$wrap((u))],f=_.face.length,g=i.faceUV||new Array(f),y=i.faceColors,v=void 0===i.flat||i.flat,b=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,x=new Array,S=new Array,T=new Array,E=new Array,P=new Array,A=0,M=0,C=new Array,R=0,w=0;if(v)for(w=0;w<f;w++)y&&void 0===y[__uv.$wrap((w))]&&(y[__uv.$wrap((w))]=new e.Color4(1,1,1,1)),g&&void 0===g[__uv.$wrap((w))]&&(g[__uv.$wrap((w))]=new e.Vector4(0,0,1,1));if(v)for(w=0;w<f;w++){var I=_.face[__uv.$wrap((w))].length;for(o=2*Math.PI/I,s=.5*Math.tan(o/2),l=.5,R=0;R<I;R++)x.push(_.vertex[__uv.$wrap((_.face[__uv.$wrap((w))][__uv.$wrap((R))]))][__uv.$wrap((0))]*d,_.vertex[__uv.$wrap((_.face[__uv.$wrap((w))][__uv.$wrap((R))]))][__uv.$wrap((1))]*p,_.vertex[__uv.$wrap((_.face[__uv.$wrap((w))][__uv.$wrap((R))]))][__uv.$wrap((2))]*m),C.push(A),A++,n=g[__uv.$wrap((w))].x+(g[__uv.$wrap((w))].z-g[__uv.$wrap((w))].x)*(.5+s),a=g[__uv.$wrap((w))].y+(g[__uv.$wrap((w))].w-g[__uv.$wrap((w))].y)*(l-.5),E.push(n,a),c=s*Math.cos(o)-l*Math.sin(o),l=s*Math.sin(o)+l*Math.cos(o),s=c,y&&P.push(y[__uv.$wrap((w))].r,y[__uv.$wrap((w))].g,y[__uv.$wrap((w))].b,y[__uv.$wrap((w))].a);for(R=0;R<I-2;R++)S.push(C[__uv.$wrap((0+M))],C[__uv.$wrap((R+2+M))],C[__uv.$wrap((R+1+M))]);M+=I}else{for(R=0;R<_.vertex.length;R++)x.push(_.vertex[__uv.$wrap((R))][__uv.$wrap((0))]*d,_.vertex[__uv.$wrap((R))][__uv.$wrap((1))]*p,_.vertex[__uv.$wrap((R))][__uv.$wrap((2))]*m),E.push(0,0);for(w=0;w<f;w++)for(R=0;R<_.face[__uv.$wrap((w))].length-2;R++)S.push(_.face[__uv.$wrap((w))][__uv.$wrap((0))],_.face[__uv.$wrap((w))][__uv.$wrap((R+2))],_.face[__uv.$wrap((w))][__uv.$wrap((R+1))])}t.ComputeNormals(x,S,T),t._ComputeSides(b,x,S,T,E,i.frontUVs,i.backUVs);var O=new t;return O.positions=x,O.indices=S,O.normals=T,O.uvs=E,y&&v&&(O.colors=P),O},t.CreateTorusKnot=function(i){var r,n,a=new Array,o=new Array,s=new Array,l=new Array,c=i.radius||2,u=i.tube||.5,h=i.radialSegments||32,d=i.tubularSegments||32,p=i.p||2,m=i.q||3,_=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,f=function(t){var i=Math.cos(t),r=Math.sin(t),n=m/p*t,a=Math.cos(n),o=c*(2+a)*.5*i,s=c*(2+a)*r*.5,l=c*Math.sin(n)*.5;return new e.Vector3(o,s,l)};for(r=0;r<=h;r++){var g=r%h/h*2*p*Math.PI,y=f(g),v=f(g+.01),b=v.subtract(y),x=v.add(y),S=e.Vector3.Cross(b,x);for(x=e.Vector3.Cross(S,b),S.normalize(),x.normalize(),n=0;n<d;n++){var T=n%d/d*2*Math.PI,E=-u*Math.cos(T),P=u*Math.sin(T);o.push(y.x+E*x.x+P*S.x),o.push(y.y+E*x.y+P*S.y),o.push(y.z+E*x.z+P*S.z),l.push(r/h),l.push(n/d)}}for(r=0;r<h;r++)for(n=0;n<d;n++){var A=(n+1)%d,M=r*d+n,C=(r+1)*d+n,R=(r+1)*d+A,w=r*d+A;a.push(w),a.push(C),a.push(M),a.push(w),a.push(R),a.push(C)}t.ComputeNormals(o,a,s),t._ComputeSides(_,o,a,s,l,i.frontUVs,i.backUVs);var I=new t;return I.indices=a,I.positions=o,I.normals=s,I.uvs=l,I},t.ComputeNormals=function(t,i,r,n){var a=0,o=0,s=0,l=0,c=0,u=0,h=0,d=0,p=0,m=0,_=0,f=0,g=0,y=0,v=0,b=0,x=0,S=0,T=0,E=0,P=!1,A=!1,M=!1,C=!1,R=1,w=0,I=null;if(n&&(P=!!n.facetNormals,A=!!n.facetPositions,M=!!n.facetPartitioning,R=!0===n.useRightHandedSystem?-1:1,w=n.ratio||0,C=!!n.depthSort,I=n.distanceTo,C)){void 0===I&&(I=e.Vector3.Zero());var O=n.depthSortedFacets}var D=0,k=0,B=0,F=0;if(M&&n&&n.bbSize){var L=0,N=0,V=0,G=0,U=0,z=0,H=0,W=0,j=0,X=0,Y=0,K=0,Q=0,Z=0,q=0,J=0,$=n.bbSize.x>n.bbSize.y?n.bbSize.x:n.bbSize.y;$=$>n.bbSize.z?$:n.bbSize.z,D=n.subDiv.X*w/n.bbSize.x,k=n.subDiv.Y*w/n.bbSize.y,B=n.subDiv.Z*w/n.bbSize.z,F=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0}for(a=0;a<t.length;a++)r[__uv.$wrap((a))]=0;var ee=i.length/3|0;for(a=0;a<ee;a++){if(g=(f=3*i[__uv.$wrap((3*a))])+1,y=f+2,b=(v=3*i[__uv.$wrap((3*a+1))])+1,x=v+2,T=(S=3*i[__uv.$wrap((3*a+2))])+1,E=S+2,o=t[__uv.$wrap((f))]-t[__uv.$wrap((v))],s=t[__uv.$wrap((g))]-t[__uv.$wrap((b))],l=t[__uv.$wrap((y))]-t[__uv.$wrap((x))],c=t[__uv.$wrap((S))]-t[__uv.$wrap((v))],u=t[__uv.$wrap((T))]-t[__uv.$wrap((b))],d=R*(s*(h=t[__uv.$wrap((E))]-t[__uv.$wrap((x))])-l*u),p=R*(l*c-o*h),m=R*(o*u-s*c),d/=_=0===(_=Math.sqrt(d*d+p*p+m*m))?1:_,p/=_,m/=_,P&&n&&(n.facetNormals[__uv.$wrap((a))].x=d,n.facetNormals[__uv.$wrap((a))].y=p,n.facetNormals[__uv.$wrap((a))].z=m),A&&n&&(n.facetPositions[__uv.$wrap((a))].x=(t[__uv.$wrap((f))]+t[__uv.$wrap((v))]+t[__uv.$wrap((S))])/3,n.facetPositions[__uv.$wrap((a))].y=(t[__uv.$wrap((g))]+t[__uv.$wrap((b))]+t[__uv.$wrap((T))])/3,n.facetPositions[__uv.$wrap((a))].z=(t[__uv.$wrap((y))]+t[__uv.$wrap((x))]+t[__uv.$wrap((E))])/3),M&&n&&(L=Math.floor((n.facetPositions[__uv.$wrap((a))].x-n.bInfo.minimum.x*w)*D),N=Math.floor((n.facetPositions[__uv.$wrap((a))].y-n.bInfo.minimum.y*w)*k),V=Math.floor((n.facetPositions[__uv.$wrap((a))].z-n.bInfo.minimum.z*w)*B),G=Math.floor((t[__uv.$wrap((f))]-n.bInfo.minimum.x*w)*D),U=Math.floor((t[__uv.$wrap((g))]-n.bInfo.minimum.y*w)*k),z=Math.floor((t[__uv.$wrap((y))]-n.bInfo.minimum.z*w)*B),H=Math.floor((t[__uv.$wrap((v))]-n.bInfo.minimum.x*w)*D),W=Math.floor((t[__uv.$wrap((b))]-n.bInfo.minimum.y*w)*k),j=Math.floor((t[__uv.$wrap((x))]-n.bInfo.minimum.z*w)*B),X=Math.floor((t[__uv.$wrap((S))]-n.bInfo.minimum.x*w)*D),Y=Math.floor((t[__uv.$wrap((T))]-n.bInfo.minimum.y*w)*k),K=Math.floor((t[__uv.$wrap((E))]-n.bInfo.minimum.z*w)*B),Z=G+n.subDiv.max*U+F*z,q=H+n.subDiv.max*W+F*j,J=X+n.subDiv.max*Y+F*K,Q=L+n.subDiv.max*N+F*V,n.facetPartitioning[__uv.$wrap((Q))]=n.facetPartitioning[__uv.$wrap((Q))]?n.facetPartitioning[__uv.$wrap((Q))]:new Array,n.facetPartitioning[__uv.$wrap((Z))]=n.facetPartitioning[__uv.$wrap((Z))]?n.facetPartitioning[__uv.$wrap((Z))]:new Array,n.facetPartitioning[__uv.$wrap((q))]=n.facetPartitioning[__uv.$wrap((q))]?n.facetPartitioning[__uv.$wrap((q))]:new Array,n.facetPartitioning[__uv.$wrap((J))]=n.facetPartitioning[__uv.$wrap((J))]?n.facetPartitioning[__uv.$wrap((J))]:new Array,n.facetPartitioning[__uv.$wrap((Z))].push(a),q!=Z&&n.facetPartitioning[__uv.$wrap((q))].push(a),J!=q&&J!=Z&&n.facetPartitioning[__uv.$wrap((J))].push(a),Q!=Z&&Q!=q&&Q!=J&&n.facetPartitioning[__uv.$wrap((Q))].push(a)),C&&n&&n.facetPositions){var te=O[__uv.$wrap((a))];te.ind=3*a,te.sqDistance=e.Vector3.DistanceSquared(n.facetPositions[__uv.$wrap((a))],I)}r[__uv.$wrap((f))]+=d,r[__uv.$wrap((g))]+=p,r[__uv.$wrap((y))]+=m,r[__uv.$wrap((v))]+=d,r[__uv.$wrap((b))]+=p,r[__uv.$wrap((x))]+=m,r[__uv.$wrap((S))]+=d,r[__uv.$wrap((T))]+=p,r[__uv.$wrap((E))]+=m}for(a=0;a<r.length/3;a++)d=r[__uv.$wrap((3*a))],p=r[__uv.$wrap((3*a+1))],m=r[__uv.$wrap((3*a+2))],d/=_=0===(_=Math.sqrt(d*d+p*p+m*m))?1:_,p/=_,m/=_,r[__uv.$wrap((3*a))]=d,r[__uv.$wrap((3*a+1))]=p,r[__uv.$wrap((3*a+2))]=m},t._ComputeSides=function(t,i,r,n,a,o,s){var l,c,u=r.length,h=n.length;switch(t=t||e.Mesh.DEFAULTSIDE){case e.Mesh.FRONTSIDE:break;case e.Mesh.BACKSIDE:var d;for(l=0;l<u;l+=3)d=r[__uv.$wrap((l))],r[__uv.$wrap((l))]=r[__uv.$wrap((l+2))],r[__uv.$wrap((l+2))]=d;for(c=0;c<h;c++)n[__uv.$wrap((c))]=-n[__uv.$wrap((c))];break;case e.Mesh.DOUBLESIDE:for(var p=i.length,m=p/3,_=0;_<p;_++)i[__uv.$wrap((p+_))]=i[__uv.$wrap((_))];for(l=0;l<u;l+=3)r[__uv.$wrap((l+u))]=r[__uv.$wrap((l+2))]+m,r[__uv.$wrap((l+1+u))]=r[__uv.$wrap((l+1))]+m,r[__uv.$wrap((l+2+u))]=r[__uv.$wrap((l))]+m;for(c=0;c<h;c++)n[__uv.$wrap((h+c))]=-n[__uv.$wrap((c))];var f=a.length,g=0;for(g=0;g<f;g++)a[__uv.$wrap((g+f))]=a[__uv.$wrap((g))];for(o=o||new e.Vector4(0,0,1,1),s=s||new e.Vector4(0,0,1,1),g=0,l=0;l<f/2;l++)a[__uv.$wrap((g))]=o.x+(o.z-o.x)*a[__uv.$wrap((g))],a[__uv.$wrap((g+1))]=o.y+(o.w-o.y)*a[__uv.$wrap((g+1))],a[__uv.$wrap((g+f))]=s.x+(s.z-s.x)*a[__uv.$wrap((g+f))],a[__uv.$wrap((g+f+1))]=s.y+(s.w-s.y)*a[__uv.$wrap((g+f+1))],g+=2}},t.ImportVertexData=function(i,r){var n=new t,a=i.positions;a&&n.set(a,e.VertexBuffer.PositionKind);var o=i.normals;o&&n.set(o,e.VertexBuffer.NormalKind);var s=i.tangents;s&&n.set(s,e.VertexBuffer.TangentKind);var l=i.uvs;l&&n.set(l,e.VertexBuffer.UVKind);var c=i.uv2s;c&&n.set(c,e.VertexBuffer.UV2Kind);var u=i.uv3s;u&&n.set(u,e.VertexBuffer.UV3Kind);var h=i.uv4s;h&&n.set(h,e.VertexBuffer.UV4Kind);var d=i.uv5s;d&&n.set(d,e.VertexBuffer.UV5Kind);var p=i.uv6s;p&&n.set(p,e.VertexBuffer.UV6Kind);var m=i.colors;m&&n.set(e.Color4.CheckColors4(m,a.length/3),e.VertexBuffer.ColorKind);var _=i.matricesIndices;_&&n.set(_,e.VertexBuffer.MatricesIndicesKind);var f=i.matricesWeights;f&&n.set(f,e.VertexBuffer.MatricesWeightsKind);var g=i.indices;g&&(n.indices=g),r.setAllVerticesData(n,i.updatable)},t}();e.VertexData=t}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a){void 0===n&&(n=!1),void 0===a&&(a=null),this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,this._vertexBuffers={},this._indices=[],this._updatable=n,r?this.setAllVerticesData(r,n):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),a&&("LinesMesh"===a.getClassName()&&(this.boundingBias=new e.Vector2(0,a.intersectionThreshold),this._updateExtend()),this.applyToMesh(a),a.computeWorldMatrix(!0))}return Object.defineProperty(t.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){if(this._boundingBias){if(this._boundingBias.equals(e))return;this._boundingBias.copyFrom(e)}else this._boundingBias=e.clone();this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),t.CreateGeometryForMesh=function(e){var i=new t(t.RandomId(),e.getScene());return i.applyToMesh(e),i},Object.defineProperty(t.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},Object.defineProperty(t.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[__uv.$wrap((e))].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers){this._vertexBuffers[__uv.$wrap((e))]._rebuild()}},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,r,n){void 0===r&&(r=!1);var a=new e.VertexBuffer(this._engine,i,t,r,0===this._meshes.length,n);this.setVerticesBuffer(a)},t.prototype.removeVerticesData=function(e){this._vertexBuffers[__uv.$wrap((e))]&&(this._vertexBuffers[__uv.$wrap((e))].dispose(),delete this._vertexBuffers[__uv.$wrap((e))])},t.prototype.setVerticesBuffer=function(t,i){void 0===i&&(i=null);var r=t.getKind();if(this._vertexBuffers[__uv.$wrap((r))]&&this._vertexBuffers[__uv.$wrap((r))].dispose(),this._vertexBuffers[__uv.$wrap((r))]=t,r===e.VertexBuffer.PositionKind){var n=t.getData();null!=i?this._totalVertices=i:null!=n&&(this._totalVertices=n.length/(t.byteStride/4)),this._updateExtend(n),this._resetPointsArrayCache();for(var a=this._meshes,o=a.length,s=0;s<o;s++){var l=a[__uv.$wrap((s))];l._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),l._createGlobalSubMesh(!1),l.computeWorldMatrix(!0)}}this.notifyUpdate(r),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},t.prototype.updateVerticesDataDirectly=function(e,t,i,r){void 0===r&&(r=!1);var n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,i,r),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,r){void 0===r&&(r=!1);var n=this.getVertexBuffer(t);n&&(n.update(i),t===e.VertexBuffer.PositionKind&&this._updateBoundingInfo(r,i),this.notifyUpdate(t))},t.prototype._updateBoundingInfo=function(t,i){t&&this._updateExtend(i);var r=this._meshes,n=r.length;this._resetPointsArrayCache();for(var a=0;a<n;a++){var o=r[__uv.$wrap((a))];if(t){o._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var s=0;s<o.subMeshes.length;s++){o.subMeshes[__uv.$wrap((s))].refreshBoundingInfo()}}}},t.prototype._bind=function(e,t){if(e){void 0===t&&(t=this._indexBuffer);var i=this.getVertexBuffers();i&&(t==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[__uv.$wrap((e.key))]||(this._vertexArrayObjects[__uv.$wrap((e.key))]=this._engine.recordVertexArrayObject(i,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[__uv.$wrap((e.key))],t)):this._engine.bindBuffers(i,t,e))}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(t,i,r){var n=this.getVertexBuffer(t);if(!n)return null;var a=n.getData();if(!a)return null;var o=n.getSize()*e.VertexBuffer.GetTypeByteLength(n.type),s=this._totalVertices*n.getSize();if(n.type!==e.VertexBuffer.FLOAT||n.byteStride!==o){var l=new Array(s);return n.forEach(s,(function(e,t){l[__uv.$wrap((t))]=e})),l}if(!(a instanceof Array||a instanceof Float32Array)||0!==n.byteOffset||a.length!==s){if(a instanceof Array){var c=n.byteOffset/4;return e.Tools.Slice(a,c,c+s)}if(a instanceof ArrayBuffer)return new Float32Array(a,n.byteOffset,s);c=a.byteOffset+n.byteOffset;if(r||i&&1!==this._meshes.length){var u=new Float32Array(s),h=new Float32Array(a.buffer,c,s);return u.set(h),u}return new Float32Array(a.buffer,c,Math.min(s,a.buffer.byteLength/4))}return r||i&&1!==this._meshes.length?e.Tools.Slice(a):a},t.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[__uv.$wrap((e))];return!!t&&t.isUpdatable()},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[__uv.$wrap((e))]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[__uv.$wrap((e))]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},t.prototype.updateIndices=function(e,t){this._indexBuffer&&(this._indexBufferIsUpdatable?this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t):this.setIndices(e,null,!0))},t.prototype.setIndices=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i)),null!=t&&(this._totalVertices=t);for(var r=this._meshes,n=r.length,a=0;a<n;a++)r[__uv.$wrap((a))]._createGlobalSubMesh(!0);this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e,t){if(!this.isReady())return null;var i=this._indices;if(t||e&&1!==this._meshes.length){for(var r=i.length,n=[],a=0;a<r;a++)n.push(i[__uv.$wrap((a))]);return n}return i},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[__uv.$wrap((e.key))]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[__uv.$wrap((e.key))]),delete this._vertexArrayObjects[__uv.$wrap((e.key))])},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);-1!==r&&(i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose())},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype._updateExtend=function(t){void 0===t&&(t=null),t||(t=this.getVerticesData(e.VertexBuffer.PositionKind)),this._extend=e.Tools.ExtractMinAndMax(t,0,this._totalVertices,this.boundingBias,3)},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var r in this._vertexBuffers){1===i&&this._vertexBuffers[__uv.$wrap((r))].create();var n=this._vertexBuffers[__uv.$wrap((r))].getBuffer();n&&(n.references=i),r===e.VertexBuffer.PositionKind&&(this._extend||this._updateExtend(),t._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(!1),t._updateBoundingInfo())}1===i&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i),t._syncGeometryWithMorphTargetManager()},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,i=this._meshes;t<i.length;t++){i[__uv.$wrap((t))]._markSubMeshesAsAttributesDirty()}},t.prototype.load=function(t,i){this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING&&(this.isReady()?i&&i():(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,this._queueLoad(t,i)))},t.prototype._queueLoad=function(t,i){var r=this;this.delayLoadingFile&&(t._addPendingData(this),t._loadFile(this.delayLoadingFile,(function(n){if(r._delayLoadingFunction){r._delayLoadingFunction(JSON.parse(n),r),r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var a=r._meshes,o=a.length,s=0;s<o;s++)r._applyToMesh(a[__uv.$wrap((s))]);i&&i()}}),void 0,!0))},t.prototype.toLeftHanded=function(){var t=this.getIndices(!1);if(null!=t&&t.length>0){for(var i=0;i<t.length;i+=3){var r=t[__uv.$wrap((i+0))];t[__uv.$wrap((i+0))]=t[__uv.$wrap((i+2))],t[__uv.$wrap((i+2))]=r}this.setIndices(t)}var n=this.getVerticesData(e.VertexBuffer.PositionKind,!1);if(null!=n&&n.length>0){for(i=0;i<n.length;i+=3)n[__uv.$wrap((i+2))]=-n[__uv.$wrap((i+2))];this.setVerticesData(e.VertexBuffer.PositionKind,n,!1)}var a=this.getVerticesData(e.VertexBuffer.NormalKind,!1);if(null!=a&&a.length>0){for(i=0;i<a.length;i+=3)a[__uv.$wrap((i+2))]=-a[__uv.$wrap((i+2))];this.setVerticesData(e.VertexBuffer.NormalKind,a,!1)}},t.prototype._resetPointsArrayCache=function(){this._positions=null},t.prototype._generatePointsArray=function(){if(this._positions)return!0;var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t||0===t.length)return!1;this._positions=[];for(var i=0;i<t.length;i+=3)this._positions.push(e.Vector3.FromArray(t,i));return!0},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[__uv.$wrap((e))]);this._vertexArrayObjects={}}},t.prototype.dispose=function(){var t,i=this._meshes,r=i.length;for(t=0;t<r;t++)this.releaseForMesh(i[__uv.$wrap((t))]);for(var n in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[__uv.$wrap((n))].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var r=new e.VertexData;r.indices=[];var n=this.getIndices();if(n)for(var a=0;a<n.length;a++)r.indices.push(n[__uv.$wrap((a))]);var o,s=!1,l=!1;for(o in this._vertexBuffers){var c=this.getVerticesData(o);if(c instanceof Float32Array?r.set(new Float32Array(c),o):r.set(c.slice(0),o),!l){var u=this.getVertexBuffer(o);u&&(l=!(s=u.isUpdatable()))}}var h=new t(i,this._scene,r,s);for(o in h.delayLoadState=this.delayLoadState,h.delayLoadingFile=this.delayLoadingFile,h._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)h._delayInfo=h._delayInfo||[],h._delayInfo.push(o);return h._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),h},t.prototype.serialize=function(){var t={};return t.id=this.id,t.updatable=this._updatable,e.Tags&&e.Tags.HasTags(this)&&(t.tags=e.Tags.GetTags(this)),t},t.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},t.prototype.serializeVerticeData=function(){var t=this.serialize();return this.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(t.positions=this.toNumberArray(this.getVerticesData(e.VertexBuffer.PositionKind)),this.isVertexBufferUpdatable(e.VertexBuffer.PositionKind)&&(t.positions._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(t.normals=this.toNumberArray(this.getVerticesData(e.VertexBuffer.NormalKind)),this.isVertexBufferUpdatable(e.VertexBuffer.NormalKind)&&(t.normals._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.TangentKind)&&(t.tangets=this.toNumberArray(this.getVerticesData(e.VertexBuffer.TangentKind)),this.isVertexBufferUpdatable(e.VertexBuffer.TangentKind)&&(t.tangets._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(t.uvs=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UVKind)),this.isVertexBufferUpdatable(e.VertexBuffer.UVKind)&&(t.uvs._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(t.uv2s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV2Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV2Kind)&&(t.uv2s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV3Kind)&&(t.uv3s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV3Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV3Kind)&&(t.uv3s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV4Kind)&&(t.uv4s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV4Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV4Kind)&&(t.uv4s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV5Kind)&&(t.uv5s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV5Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV5Kind)&&(t.uv5s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV6Kind)&&(t.uv6s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV6Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV6Kind)&&(t.uv6s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(t.colors=this.toNumberArray(this.getVerticesData(e.VertexBuffer.ColorKind)),this.isVertexBufferUpdatable(e.VertexBuffer.ColorKind)&&(t.colors._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(t.matricesIndices=this.toNumberArray(this.getVerticesData(e.VertexBuffer.MatricesIndicesKind)),t.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(e.VertexBuffer.MatricesIndicesKind)&&(t.matricesIndices._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(t.matricesWeights=this.toNumberArray(this.getVerticesData(e.VertexBuffer.MatricesWeightsKind)),this.isVertexBufferUpdatable(e.VertexBuffer.MatricesWeightsKind)&&(t.matricesWeights._updatable=!0)),t.indices=this.toNumberArray(this.getIndices()),t},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return e.Tools.RandomId()},t._ImportGeometry=function(i,r){var n=r.getScene(),a=i.geometryId;if(a){var o=n.getGeometryByID(a);o&&o.applyToMesh(r)}else if(i instanceof ArrayBuffer){var s=r._binaryInfo;if(s.positionsAttrDesc&&s.positionsAttrDesc.count>0){var l=new Float32Array(i,s.positionsAttrDesc.offset,s.positionsAttrDesc.count);r.setVerticesData(e.VertexBuffer.PositionKind,l,!1)}if(s.normalsAttrDesc&&s.normalsAttrDesc.count>0){var c=new Float32Array(i,s.normalsAttrDesc.offset,s.normalsAttrDesc.count);r.setVerticesData(e.VertexBuffer.NormalKind,c,!1)}if(s.tangetsAttrDesc&&s.tangetsAttrDesc.count>0){var u=new Float32Array(i,s.tangetsAttrDesc.offset,s.tangetsAttrDesc.count);r.setVerticesData(e.VertexBuffer.TangentKind,u,!1)}if(s.uvsAttrDesc&&s.uvsAttrDesc.count>0){var h=new Float32Array(i,s.uvsAttrDesc.offset,s.uvsAttrDesc.count);r.setVerticesData(e.VertexBuffer.UVKind,h,!1)}if(s.uvs2AttrDesc&&s.uvs2AttrDesc.count>0){var d=new Float32Array(i,s.uvs2AttrDesc.offset,s.uvs2AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV2Kind,d,!1)}if(s.uvs3AttrDesc&&s.uvs3AttrDesc.count>0){var p=new Float32Array(i,s.uvs3AttrDesc.offset,s.uvs3AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV3Kind,p,!1)}if(s.uvs4AttrDesc&&s.uvs4AttrDesc.count>0){var m=new Float32Array(i,s.uvs4AttrDesc.offset,s.uvs4AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV4Kind,m,!1)}if(s.uvs5AttrDesc&&s.uvs5AttrDesc.count>0){var _=new Float32Array(i,s.uvs5AttrDesc.offset,s.uvs5AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV5Kind,_,!1)}if(s.uvs6AttrDesc&&s.uvs6AttrDesc.count>0){var f=new Float32Array(i,s.uvs6AttrDesc.offset,s.uvs6AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV6Kind,f,!1)}if(s.colorsAttrDesc&&s.colorsAttrDesc.count>0){var g=new Float32Array(i,s.colorsAttrDesc.offset,s.colorsAttrDesc.count);r.setVerticesData(e.VertexBuffer.ColorKind,g,!1,s.colorsAttrDesc.stride)}if(s.matricesIndicesAttrDesc&&s.matricesIndicesAttrDesc.count>0){for(var y=new Int32Array(i,s.matricesIndicesAttrDesc.offset,s.matricesIndicesAttrDesc.count),v=[],b=0;b<y.length;b++){var x=y[__uv.$wrap((b))];v.push(255&x),v.push((65280&x)>>8),v.push((16711680&x)>>16),v.push(x>>24)}r.setVerticesData(e.VertexBuffer.MatricesIndicesKind,v,!1)}if(s.matricesWeightsAttrDesc&&s.matricesWeightsAttrDesc.count>0){var S=new Float32Array(i,s.matricesWeightsAttrDesc.offset,s.matricesWeightsAttrDesc.count);r.setVerticesData(e.VertexBuffer.MatricesWeightsKind,S,!1)}if(s.indicesAttrDesc&&s.indicesAttrDesc.count>0){var T=new Int32Array(i,s.indicesAttrDesc.offset,s.indicesAttrDesc.count);r.setIndices(T,null)}if(s.subMeshesAttrDesc&&s.subMeshesAttrDesc.count>0){var E=new Int32Array(i,s.subMeshesAttrDesc.offset,5*s.subMeshesAttrDesc.count);r.subMeshes=[];for(b=0;b<s.subMeshesAttrDesc.count;b++){var P=E[__uv.$wrap((5*b+0))],A=E[__uv.$wrap((5*b+1))],M=E[__uv.$wrap((5*b+2))],C=E[__uv.$wrap((5*b+3))],R=E[__uv.$wrap((5*b+4))];e.SubMesh.AddToMesh(P,A,M,C,R,r)}}}else if(i.positions&&i.normals&&i.indices){if(r.setVerticesData(e.VertexBuffer.PositionKind,i.positions,i.positions._updatable),r.setVerticesData(e.VertexBuffer.NormalKind,i.normals,i.normals._updatable),i.tangents&&r.setVerticesData(e.VertexBuffer.TangentKind,i.tangents,i.tangents._updatable),i.uvs&&r.setVerticesData(e.VertexBuffer.UVKind,i.uvs,i.uvs._updatable),i.uvs2&&r.setVerticesData(e.VertexBuffer.UV2Kind,i.uvs2,i.uvs2._updatable),i.uvs3&&r.setVerticesData(e.VertexBuffer.UV3Kind,i.uvs3,i.uvs3._updatable),i.uvs4&&r.setVerticesData(e.VertexBuffer.UV4Kind,i.uvs4,i.uvs4._updatable),i.uvs5&&r.setVerticesData(e.VertexBuffer.UV5Kind,i.uvs5,i.uvs5._updatable),i.uvs6&&r.setVerticesData(e.VertexBuffer.UV6Kind,i.uvs6,i.uvs6._updatable),i.colors&&r.setVerticesData(e.VertexBuffer.ColorKind,e.Color4.CheckColors4(i.colors,i.positions.length/3),i.colors._updatable),i.matricesIndices)if(i.matricesIndices._isExpanded)delete i.matricesIndices._isExpanded,r.setVerticesData(e.VertexBuffer.MatricesIndicesKind,i.matricesIndices,i.matricesIndices._updatable);else{for(v=[],b=0;b<i.matricesIndices.length;b++){var w=i.matricesIndices[__uv.$wrap((b))];v.push(255&w),v.push((65280&w)>>8),v.push((16711680&w)>>16),v.push(w>>24)}r.setVerticesData(e.VertexBuffer.MatricesIndicesKind,v,i.matricesIndices._updatable)}if(i.matricesIndicesExtra)if(i.matricesIndicesExtra._isExpanded)delete i.matricesIndices._isExpanded,r.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,i.matricesIndicesExtra,i.matricesIndicesExtra._updatable);else{for(v=[],b=0;b<i.matricesIndicesExtra.length;b++){w=i.matricesIndicesExtra[__uv.$wrap((b))];v.push(255&w),v.push((65280&w)>>8),v.push((16711680&w)>>16),v.push(w>>24)}r.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,v,i.matricesIndicesExtra._updatable)}i.matricesWeights&&(t._CleanMatricesWeights(i,r),r.setVerticesData(e.VertexBuffer.MatricesWeightsKind,i.matricesWeights,i.matricesWeights._updatable)),i.matricesWeightsExtra&&r.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,i.matricesWeightsExtra,i.matricesWeights._updatable),r.setIndices(i.indices,null)}if(i.subMeshes){r.subMeshes=[];for(var I=0;I<i.subMeshes.length;I++){var O=i.subMeshes[__uv.$wrap((I))];e.SubMesh.AddToMesh(O.materialIndex,O.verticesStart,O.verticesCount,O.indexStart,O.indexCount,r)}}r._shouldGenerateFlatShading&&(r.convertToFlatShadedMesh(),delete r._shouldGenerateFlatShading),r.computeWorldMatrix(!0),n.onMeshImportedObservable.notifyObservers(r)},t._CleanMatricesWeights=function(t,i){if(e.SceneLoader.CleanBoneMatrixWeights){var r=0;if(t.skeletonId>-1){var n=i.getScene().getLastSkeletonByID(t.skeletonId);if(n){r=n.bones.length;for(var a=i.getVerticesData(e.VertexBuffer.MatricesIndicesKind),o=i.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind),s=t.matricesWeights,l=t.matricesWeightsExtra,c=t.numBoneInfluencer,u=s.length,h=0;h<u;h+=4){for(var d=0,p=-1,m=0;m<4;m++){d+=_=s[__uv.$wrap((h+m))],_<.001&&p<0&&(p=m)}if(l)for(m=0;m<4;m++){var _;d+=_=l[__uv.$wrap((h+m))],_<.001&&p<0&&(p=m+4)}if((p<0||p>c-1)&&(p=c-1),d>.001){var f=1/d;for(m=0;m<4;m++)s[__uv.$wrap((h+m))]*=f;if(l)for(m=0;m<4;m++)l[__uv.$wrap((h+m))]*=f}else p>=4?(l[__uv.$wrap((h+p-4))]=1-d,o[__uv.$wrap((h+p-4))]=r):(s[__uv.$wrap((h+p))]=1-d,a[__uv.$wrap((h+p))]=r)}i.setVerticesData(e.VertexBuffer.MatricesIndicesKind,a),t.matricesWeightsExtra&&i.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,o)}}}},t.Parse=function(i,r,n){if(r.getGeometryByID(i.id))return null;var a=new t(i.id,r,void 0,i.updatable);return e.Tags&&e.Tags.AddTagsTo(a,i.tags),i.delayLoadingFile?(a.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,a.delayLoadingFile=n+i.delayLoadingFile,a._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(i.boundingBoxMinimum),e.Vector3.FromArray(i.boundingBoxMaximum)),a._delayInfo=[],i.hasUVs&&a._delayInfo.push(e.VertexBuffer.UVKind),i.hasUVs2&&a._delayInfo.push(e.VertexBuffer.UV2Kind),i.hasUVs3&&a._delayInfo.push(e.VertexBuffer.UV3Kind),i.hasUVs4&&a._delayInfo.push(e.VertexBuffer.UV4Kind),i.hasUVs5&&a._delayInfo.push(e.VertexBuffer.UV5Kind),i.hasUVs6&&a._delayInfo.push(e.VertexBuffer.UV6Kind),i.hasColors&&a._delayInfo.push(e.VertexBuffer.ColorKind),i.hasMatricesIndices&&a._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),i.hasMatricesWeights&&a._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),a._delayLoadingFunction=e.VertexData.ImportVertexData):e.VertexData.ImportVertexData(i,a),r.pushGeometry(a,!0),a},t}();e.Geometry=t;var i=function(e){function t(t,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=null);var a=e.call(this,t,i,void 0,!1,n)||this;return a._canBeRegenerated=r,a._beingRegenerated=!0,a.regenerate(),a._beingRegenerated=!1,a}return a(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,r){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},t.prototype.copy=function(e){throw new Error("Must be overriden in sub-classes.")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.canBeRegenerated=this.canBeRegenerated(),t},t}(t);e._PrimitiveGeometry=i;var r=function(t){function i(i,r,n,a,o,s,l,c,u){void 0===u&&(u=e.Mesh.DEFAULTSIDE);var h=t.call(this,i,r,l,c)||this;return h.pathArray=n,h.closeArray=a,h.closePath=o,h.offset=s,h.side=u,h}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),void 0,this.side)},i}(i);e.RibbonGeometry=r;var n=function(t){function i(i,r,n,a,o,s){void 0===o&&(o=null),void 0===s&&(s=e.Mesh.DEFAULTSIDE);var l=t.call(this,i,r,a,o)||this;return l.size=n,l.side=s,l}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),void 0,this.side)},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.size=this.size,e},i.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var n=new i(t.id,r,t.size,t.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},i}(i);e.BoxGeometry=n;var o=function(t){function i(i,r,n,a,o,s,l){void 0===s&&(s=null),void 0===l&&(l=e.Mesh.DEFAULTSIDE);var c=t.call(this,i,r,o,s)||this;return c.segments=n,c.diameter=a,c.side=l,c}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.segments=this.segments,e.diameter=this.diameter,e},i.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var n=new i(t.id,r,t.segments,t.diameter,t.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},i}(i);e.SphereGeometry=o;var s=function(t){function i(i,r,n,a,o,s,l){void 0===s&&(s=null),void 0===l&&(l=e.Mesh.DEFAULTSIDE);var c=t.call(this,i,r,o,s)||this;return c.radius=n,c.tessellation=a,c.side=l,c}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(i);e.DiscGeometry=s;var l=function(t){function i(i,r,n,a,o,s,l,c,u,h){void 0===l&&(l=1),void 0===u&&(u=null),void 0===h&&(h=e.Mesh.DEFAULTSIDE);var d=t.call(this,i,r,c,u)||this;return d.height=n,d.diameterTop=a,d.diameterBottom=o,d.tessellation=s,d.subdivisions=l,d.side=h,d}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.height=this.height,e.diameterTop=this.diameterTop,e.diameterBottom=this.diameterBottom,e.tessellation=this.tessellation,e},i.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var n=new i(t.id,r,t.height,t.diameterTop,t.diameterBottom,t.tessellation,t.subdivisions,t.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},i}(i);e.CylinderGeometry=l;var c=function(t){function i(i,r,n,a,o,s,l,c){void 0===l&&(l=null),void 0===c&&(c=e.Mesh.DEFAULTSIDE);var u=t.call(this,i,r,s,l)||this;return u.diameter=n,u.thickness=a,u.tessellation=o,u.side=c,u}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.diameter=this.diameter,e.thickness=this.thickness,e.tessellation=this.tessellation,e},i.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var n=new i(t.id,r,t.diameter,t.thickness,t.tessellation,t.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},i}(i);e.TorusGeometry=c;var u=function(t){function i(e,i,r,n,a,o,s){void 0===s&&(s=null);var l=t.call(this,e,i,o,s)||this;return l.width=r,l.height=n,l.subdivisions=a,l}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.width=this.width,e.height=this.height,e.subdivisions=this.subdivisions,e},i.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var n=new i(t.id,r,t.width,t.height,t.subdivisions,t.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},i}(i);e.GroundGeometry=u;var h=function(t){function i(e,i,r,n,a,o,s,l,c,u){void 0===u&&(u=null);var h=t.call(this,e,i,c,u)||this;return h.xmin=r,h.zmin=n,h.xmax=a,h.zmax=o,h.subdivisions=s,h.precision=l,h}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(i);e.TiledGroundGeometry=h;var d=function(t){function i(i,r,n,a,o,s){void 0===o&&(o=null),void 0===s&&(s=e.Mesh.DEFAULTSIDE);var l=t.call(this,i,r,a,o)||this;return l.size=n,l.side=s,l}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane({size:this.size,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.size=this.size,e},i.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var n=new i(t.id,r,t.size,t.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},i}(i);e.PlaneGeometry=d;var p=function(t){function i(i,r,n,a,o,s,l,c,u,h,d){void 0===h&&(h=null),void 0===d&&(d=e.Mesh.DEFAULTSIDE);var p=t.call(this,i,r,u,h)||this;return p.radius=n,p.tube=a,p.radialSegments=o,p.tubularSegments=s,p.p=l,p.q=c,p.side=d,p}return a(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.radius=this.radius,e.tube=this.tube,e.radialSegments=this.radialSegments,e.tubularSegments=this.tubularSegments,e.p=this.p,e.q=this.q,e},i.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var n=new i(t.id,r,t.radius,t.tube,t.radialSegments,t.tubularSegments,t.p,t.q,t.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,t.tags),r.pushGeometry(n,!0),n},i}(i);e.TorusKnotGeometry=p}(s||(s={})),function(e){var t=function(){function t(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new i(e)}return t.prototype.sampleFrame=function(t){if(void 0===t&&(t=e.Tools.Now),this._enabled){if(null!=this._lastFrameTimeMs){var i=t-this._lastFrameTimeMs;this._rollingFrameTime.add(i)}this._lastFrameTimeMs=t}},Object.defineProperty(t.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),t.prototype.enable=function(){this._enabled=!0},t.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},t}();e.PerformanceMonitor=t;var i=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var i=this._samples[__uv.$wrap((this._pos))];t=i-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(i-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[__uv.$wrap((this._pos))]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[__uv.$wrap((this._wrapPosition(t-e)))]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}();e.RollingAverage=i}(s||(s={})),function(e){var t=function(){function t(){}return t.BindEyePosition=function(e,t){t._forcedViewPosition?e.setVector3("vEyePosition",t._forcedViewPosition):e.setVector3("vEyePosition",t._mirroredCameraPosition?t._mirroredCameraPosition:t.activeCamera.globalPosition)},t.PrepareDefinesForMergedUV=function(e,t,i){t._needUVs=!0,t[__uv.$wrap((i))]=!0,e.getTextureMatrix().isIdentity(!0)?(t[__uv.$wrap((i+"DIRECTUV"))]=e.coordinatesIndex+1,0===e.coordinatesIndex?t.MAINUV1=!0:t.MAINUV2=!0):t[__uv.$wrap((i+"DIRECTUV"))]=0},t.BindTextureMatrix=function(e,t,i){var r=e.getTextureMatrix();r.isIdentity(!0)||t.updateMatrix(i+"Matrix",r)},t.PrepareDefinesForMisc=function(t,i,r,n,a,o,s){s._areMiscDirty&&(s.LOGARITHMICDEPTH=r,s.POINTSIZE=n,s.FOG=i.fogEnabled&&t.applyFog&&i.fogMode!==e.Scene.FOGMODE_NONE&&a,s.NONUNIFORMSCALING=t.nonUniformScaling,s.ALPHATEST=o)},t.PrepareDefinesForFrameBoundValues=function(e,t,i,r,n){void 0===n&&(n=null);var a,o,s,l,c=!1;a=null==n?void 0!==e.clipPlane&&null!==e.clipPlane:n,o=null==n?void 0!==e.clipPlane2&&null!==e.clipPlane2:n,s=null==n?void 0!==e.clipPlane3&&null!==e.clipPlane3:n,l=null==n?void 0!==e.clipPlane4&&null!==e.clipPlane4:n,i.CLIPPLANE!==a&&(i.CLIPPLANE=a,c=!0),i.CLIPPLANE2!==o&&(i.CLIPPLANE2=o,c=!0),i.CLIPPLANE3!==s&&(i.CLIPPLANE3=s,c=!0),i.CLIPPLANE4!==l&&(i.CLIPPLANE4=l,c=!0),i.DEPTHPREPASS!==!t.getColorWrite()&&(i.DEPTHPREPASS=!i.DEPTHPREPASS,c=!0),i.INSTANCES!==r&&(i.INSTANCES=r,c=!0),c&&i.markAsUnprocessed()},t.PrepareDefinesForAttributes=function(t,i,r,n,a,o){if(void 0===a&&(a=!1),void 0===o&&(o=!0),!i._areAttributesDirty&&i._needNormals===i._normals&&i._needUVs===i._uvs)return!1;if(i._normals=i._needNormals,i._uvs=i._needUVs,i.NORMAL=i._needNormals&&t.isVerticesDataPresent(e.VertexBuffer.NormalKind),i._needNormals&&t.isVerticesDataPresent(e.VertexBuffer.TangentKind)&&(i.TANGENT=!0),i._needUVs?(i.UV1=t.isVerticesDataPresent(e.VertexBuffer.UVKind),i.UV2=t.isVerticesDataPresent(e.VertexBuffer.UV2Kind)):(i.UV1=!1,i.UV2=!1),r){var s=t.useVertexColors&&t.isVerticesDataPresent(e.VertexBuffer.ColorKind);i.VERTEXCOLOR=s,i.VERTEXALPHA=t.hasVertexAlpha&&s&&o}if(n&&(t.useBones&&t.computeBonesUsingShaders&&t.skeleton?(i.NUM_BONE_INFLUENCERS=t.numBoneInfluencers,i.BonesPerMesh=t.skeleton.bones.length+1):(i.NUM_BONE_INFLUENCERS=0,i.BonesPerMesh=0)),a){var l=t.morphTargetManager;l?(i.MORPHTARGETS_TANGENT=l.supportsTangents&&i.TANGENT,i.MORPHTARGETS_NORMAL=l.supportsNormals&&i.NORMAL,i.MORPHTARGETS=l.numInfluencers>0,i.NUM_MORPH_INFLUENCERS=l.numInfluencers):(i.MORPHTARGETS_TANGENT=!1,i.MORPHTARGETS_NORMAL=!1,i.MORPHTARGETS=!1,i.NUM_MORPH_INFLUENCERS=0)}return!0},t.PrepareDefinesForLights=function(t,i,r,n,a,o){if(void 0===a&&(a=4),void 0===o&&(o=!1),!r._areLightsDirty)return r._needNormals;var s=0,l=!1,c=!1,u=!1,h=!1,d=!1;if(t.lightsEnabled&&!o)for(var p=0,m=i._lightSources;p<m.length;p++){var _=m[__uv.$wrap((p))];switch(l=!0,void 0===r[__uv.$wrap(("LIGHT"+s))]&&(c=!0),r[__uv.$wrap(("LIGHT"+s))]=!0,r[__uv.$wrap(("SPOTLIGHT"+s))]=!1,r[__uv.$wrap(("HEMILIGHT"+s))]=!1,r[__uv.$wrap(("POINTLIGHT"+s))]=!1,r[__uv.$wrap(("DIRLIGHT"+s))]=!1,_.prepareLightSpecificDefines(r,s),r[__uv.$wrap(("LIGHT_FALLOFF_PHYSICAL"+s))]=!1,r[__uv.$wrap(("LIGHT_FALLOFF_GLTF"+s))]=!1,r[__uv.$wrap(("LIGHT_FALLOFF_STANDARD"+s))]=!1,_.falloffType){case e.Light.FALLOFF_GLTF:r[__uv.$wrap(("LIGHT_FALLOFF_GLTF"+s))]=!0;break;case e.Light.FALLOFF_PHYSICAL:r[__uv.$wrap(("LIGHT_FALLOFF_PHYSICAL"+s))]=!0;break;case e.Light.FALLOFF_STANDARD:r[__uv.$wrap(("LIGHT_FALLOFF_STANDARD"+s))]=!0}if(n&&!_.specular.equalsFloats(0,0,0)&&(d=!0),r[__uv.$wrap(("SHADOW"+s))]=!1,r[__uv.$wrap(("SHADOWPCF"+s))]=!1,r[__uv.$wrap(("SHADOWPCSS"+s))]=!1,r[__uv.$wrap(("SHADOWPOISSON"+s))]=!1,r[__uv.$wrap(("SHADOWESM"+s))]=!1,r[__uv.$wrap(("SHADOWCUBE"+s))]=!1,r[__uv.$wrap(("SHADOWLOWQUALITY"+s))]=!1,r[__uv.$wrap(("SHADOWMEDIUMQUALITY"+s))]=!1,i&&i.receiveShadows&&t.shadowsEnabled&&_.shadowEnabled){var f=_.getShadowGenerator();if(f){var g=f.getShadowMap();g&&g.renderList&&g.renderList.length>0&&(h=!0,f.prepareDefines(r,s))}}if(_.lightmapMode!=e.Light.LIGHTMAP_DEFAULT?(u=!0,r[__uv.$wrap(("LIGHTMAPEXCLUDED"+s))]=!0,r[__uv.$wrap(("LIGHTMAPNOSPECULAR"+s))]=_.lightmapMode==e.Light.LIGHTMAP_SHADOWSONLY):(r[__uv.$wrap(("LIGHTMAPEXCLUDED"+s))]=!1,r[__uv.$wrap(("LIGHTMAPNOSPECULAR"+s))]=!1),++s===a)break}r.SPECULARTERM=d,r.SHADOWS=h;for(var y=s;y<a;y++)void 0!==r[__uv.$wrap(("LIGHT"+y))]&&(r[__uv.$wrap(("LIGHT"+y))]=!1,r[__uv.$wrap(("HEMILIGHT"+s))]=!1,r[__uv.$wrap(("POINTLIGHT"+s))]=!1,r[__uv.$wrap(("DIRLIGHT"+s))]=!1,r[__uv.$wrap(("SPOTLIGHT"+s))]=!1,r[__uv.$wrap(("SHADOW"+s))]=!1);var v=t.getEngine().getCaps();return void 0===r.SHADOWFLOAT&&(c=!0),r.SHADOWFLOAT=h&&(v.textureFloatRender&&v.textureFloatLinearFiltering||v.textureHalfFloatRender&&v.textureHalfFloatLinearFiltering),r.LIGHTMAPEXCLUDED=u,c&&r.rebuild(),l},t.PrepareUniformsAndSamplersList=function(e,t,i,r){var n;void 0===r&&(r=4);var a=null;if(e.uniformsNames){var o=e;n=o.uniformsNames,a=o.uniformBuffersNames,t=o.samplers,i=o.defines,r=o.maxSimultaneousLights}else n=e,t||(t=[]);for(var s=0;s<r&&i[__uv.$wrap(("LIGHT"+s))];s++)n.push("vLightData"+s,"vLightDiffuse"+s,"vLightSpecular"+s,"vLightDirection"+s,"vLightFalloff"+s,"vLightGround"+s,"lightMatrix"+s,"shadowsInfo"+s,"depthValues"+s),a&&a.push("Light"+s),t.push("shadowSampler"+s),t.push("depthSampler"+s),i[__uv.$wrap(("PROJECTEDLIGHTTEXTURE"+s))]&&(t.push("projectionLightSampler"+s),n.push("textureProjectionMatrix"+s));i.NUM_MORPH_INFLUENCERS&&n.push("morphTargetInfluences")},t.HandleFallbacksForShadows=function(e,t,i,r){void 0===i&&(i=4),void 0===r&&(r=0);for(var n=0,a=0;a<i&&e[__uv.$wrap(("LIGHT"+a))];a++)a>0&&(n=r+a,t.addFallback(n,"LIGHT"+a)),e.SHADOWS||(e[__uv.$wrap(("SHADOW"+a))]&&t.addFallback(r,"SHADOW"+a),e[__uv.$wrap(("SHADOWPCF"+a))]&&t.addFallback(r,"SHADOWPCF"+a),e[__uv.$wrap(("SHADOWPCSS"+a))]&&t.addFallback(r,"SHADOWPCSS"+a),e[__uv.$wrap(("SHADOWPOISSON"+a))]&&t.addFallback(r,"SHADOWPOISSON"+a),e[__uv.$wrap(("SHADOWESM"+a))]&&t.addFallback(r,"SHADOWESM"+a));return n++},t.PrepareAttributesForMorphTargets=function(t,i,r){var n=r.NUM_MORPH_INFLUENCERS;if(n>0&&e.Engine.LastCreatedEngine)for(var a=e.Engine.LastCreatedEngine.getCaps().maxVertexAttribs,o=i.morphTargetManager,s=o&&o.supportsNormals&&r.NORMAL,l=o&&o.supportsTangents&&r.TANGENT,c=0;c<n;c++)t.push(e.VertexBuffer.PositionKind+c),s&&t.push(e.VertexBuffer.NormalKind+c),l&&t.push(e.VertexBuffer.TangentKind+c),t.length>a&&e.Tools.Error("Cannot add more vertex attributes for mesh "+i.name)},t.PrepareAttributesForBones=function(t,i,r,n){r.NUM_BONE_INFLUENCERS>0&&(n.addCPUSkinningFallback(0,i),t.push(e.VertexBuffer.MatricesIndicesKind),t.push(e.VertexBuffer.MatricesWeightsKind),r.NUM_BONE_INFLUENCERS>4&&(t.push(e.VertexBuffer.MatricesIndicesExtraKind),t.push(e.VertexBuffer.MatricesWeightsExtraKind)))},t.PrepareAttributesForInstances=function(e,t){t.INSTANCES&&(e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"))},t.BindLightShadow=function(e,t,i,r,n){if(e.shadowEnabled&&i.receiveShadows){var a=e.getShadowGenerator();a&&a.bindShadowLight(r,n)}},t.BindLightProperties=function(e,t,i){e.transferToEffect(t,i+"")},t.BindLights=function(i,r,n,a,o,s){void 0===o&&(o=4),void 0===s&&(s=!1);for(var l=Math.min(r._lightSources.length,o),c=0;c<l;c++){var u=r._lightSources[__uv.$wrap((c))],h=c.toString(),d=u.getScaledIntensity();u._uniformBuffer.bindToEffect(n,"Light"+c),t.BindLightProperties(u,n,c),u.diffuse.scaleToRef(d,e.Tmp.Color3[__uv.$wrap((0))]),u._uniformBuffer.updateColor4("vLightDiffuse",e.Tmp.Color3[__uv.$wrap((0))],s?u.radius:u.range,h),a.SPECULARTERM&&(u.specular.scaleToRef(d,e.Tmp.Color3[__uv.$wrap((1))]),u._uniformBuffer.updateColor3("vLightSpecular",e.Tmp.Color3[__uv.$wrap((1))],h)),i.shadowsEnabled&&this.BindLightShadow(u,i,r,h,n),u._uniformBuffer.update()}},t.BindFogParameters=function(t,i,r,n){void 0===n&&(n=!1),t.fogEnabled&&i.applyFog&&t.fogMode!==e.Scene.FOGMODE_NONE&&(r.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),n?(t.fogColor.toLinearSpaceToRef(this._tempFogColor),r.setColor3("vFogColor",this._tempFogColor)):r.setColor3("vFogColor",t.fogColor))},t.BindBonesParameters=function(e,t){if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){var i=e.skeleton.getTransformMatrices(e);i&&t.setMatrices("mBones",i)}},t.BindMorphTargetParameters=function(e,t){var i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)},t.BindLogDepth=function(e,t,i){e.LOGARITHMICDEPTH&&t.setFloat("logarithmicDepthConstant",2/(Math.log(i.activeCamera.maxZ+1)/Math.LN2))},t.BindClipPlane=function(e,t){if(t.clipPlane){var i=t.clipPlane;e.setFloat4("vClipPlane",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane2){i=t.clipPlane2;e.setFloat4("vClipPlane2",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane3){i=t.clipPlane3;e.setFloat4("vClipPlane3",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane4){i=t.clipPlane4;e.setFloat4("vClipPlane4",i.normal.x,i.normal.y,i.normal.z,i.d)}},t._tempFogColor=e.Color3.Black(),t}();e.MaterialHelper=t}(s||(s={})),function(e){var t=function(t){function i(i,r){var n=t.call(this,i,r)||this;return n._normalMatrix=new e.Matrix,n.storeEffectOnSubMeshes=!0,n}return a(i,t),i.prototype.getEffect=function(){return this._activeEffect},i.prototype.isReady=function(e,t){return!!e&&(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[__uv.$wrap((0))],t))},i.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},i.prototype.bindOnlyNormalMatrix=function(e){this._activeEffect.setMatrix("normalMatrix",e)},i.prototype.bind=function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[__uv.$wrap((0))])},i.prototype._afterBind=function(e,i){void 0===i&&(i=null),t.prototype._afterBind.call(this,e),this.getScene()._cachedEffect=i},i.prototype._mustRebind=function(e,t,i){return void 0===i&&(i=1),e.isCachedMaterialInvalid(this,t,i)},i}(e.Material);e.PushMaterial=t}(s||(s={})),function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.MAINUV1=!1,t.MAINUV2=!1,t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.OPACITY=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.REFLECTION=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.SPECULAR=!1,t.SPECULARDIRECTUV=0,t.BUMP=!1,t.BUMPDIRECTUV=0,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.SPECULAROVERALPHA=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHAFROMDIFFUSE=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.DIFFUSEFRESNEL=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONFRESNEL=!1,t.REFRACTIONFRESNEL=!1,t.EMISSIVEFRESNEL=!1,t.FRESNEL=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.GLOSSINESS=!1,t.ROUGHNESS=!1,t.EMISSIVEASILLUMINATION=!1,t.LINKEMISSIVEWITHDIFFUSE=!1,t.REFLECTIONFRESNELFROMSPECULAR=!1,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.OBJECTSPACE_NORMALMAP=!1,t.USELIGHTMAPASSHADOWMAP=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.LOGARITHMICDEPTH=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFLECTIONOVERALPHA=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.NONUNIFORMSCALING=!1,t.PREMULTIPLYALPHA=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.IS_REFLECTION_LINEAR=!1,t.IS_REFRACTION_LINEAR=!1,t.EXPOSURE=!1,t.rebuild(),t}return a(t,e),t.prototype.setReflectionMode=function(e){for(var t=0,i=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<i.length;t++){var r=i[__uv.$wrap((t))];this[__uv.$wrap((r))]=r===e}},t}(e.MaterialDefines);e.StandardMaterialDefines=t;var i=function(i){function r(t,n){var a=i.call(this,t,n)||this;return a.ambientColor=new e.Color3(0,0,0),a.diffuseColor=new e.Color3(1,1,1),a.specularColor=new e.Color3(1,1,1),a.emissiveColor=new e.Color3(0,0,0),a.specularPower=64,a._useAlphaFromDiffuseTexture=!1,a._useEmissiveAsIllumination=!1,a._linkEmissiveWithDiffuse=!1,a._useSpecularOverAlpha=!1,a._useReflectionOverAlpha=!1,a._disableLighting=!1,a._useObjectSpaceNormalMap=!1,a._useParallax=!1,a._useParallaxOcclusion=!1,a.parallaxScaleBias=.05,a._roughness=0,a.indexOfRefraction=.98,a.invertRefractionY=!0,a.alphaCutOff=.4,a._useLightmapAsShadowmap=!1,a._useReflectionFresnelFromSpecular=!1,a._useGlossinessFromSpecularMapAlpha=!1,a._maxSimultaneousLights=4,a._invertNormalMapX=!1,a._invertNormalMapY=!1,a._twoSidedLighting=!1,a._renderTargets=new e.SmartArray(16),a._worldViewProjectionMatrix=e.Matrix.Zero(),a._globalAmbientColor=new e.Color3(0,0,0),a._attachImageProcessingConfiguration(null),a.getRenderTargetTextures=function(){return a._renderTargets.reset(),r.ReflectionTextureEnabled&&a._reflectionTexture&&a._reflectionTexture.isRenderTarget&&a._renderTargets.push(a._reflectionTexture),r.RefractionTextureEnabled&&a._refractionTexture&&a._refractionTexture.isRenderTarget&&a._renderTargets.push(a._refractionTexture),a._renderTargets},a}return a(r,i),Object.defineProperty(r.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),r.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(e){t._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(r.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasRenderTargetTextures",{get:function(){return!!(r.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(r.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(r.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),r.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},r.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},r.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},r.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},r.prototype.isReadyForSubMesh=function(i,n,a){if(void 0===a&&(a=!1),n.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new t);var o=this.getScene(),s=n._materialDefines;if(!this.checkReadyOnEveryCall&&n.effect&&s._renderId===o.getRenderId())return!0;var l=o.getEngine();if(s._needNormals=e.MaterialHelper.PrepareDefinesForLights(o,i,s,!0,this._maxSimultaneousLights,this._disableLighting),s._areTexturesDirty){if(s._needUVs=!1,s.MAINUV1=!1,s.MAINUV2=!1,o.texturesEnabled){if(this._diffuseTexture&&r.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,s,"DIFFUSE")}else s.DIFFUSE=!1;if(this._ambientTexture&&r.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,s,"AMBIENT")}else s.AMBIENT=!1;if(this._opacityTexture&&r.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,s,"OPACITY"),s.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else s.OPACITY=!1;if(this._reflectionTexture&&r.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(s._needNormals=!0,s.REFLECTION=!0,s.ROUGHNESS=this._roughness>0,s.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,s.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===e.Texture.INVCUBIC_MODE,s.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case e.Texture.EXPLICIT_MODE:s.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case e.Texture.PLANAR_MODE:s.setReflectionMode("REFLECTIONMAP_PLANAR");break;case e.Texture.PROJECTION_MODE:s.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case e.Texture.SKYBOX_MODE:s.setReflectionMode("REFLECTIONMAP_SKYBOX"),s.REFLECTIONMAP_SKYBOX_TRANSFORMED=!this._reflectionTexture.getReflectionTextureMatrix().isIdentity();break;case e.Texture.SPHERICAL_MODE:s.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case e.Texture.EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case e.Texture.FIXED_EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:s.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:default:s.setReflectionMode("REFLECTIONMAP_CUBIC")}s.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else s.REFLECTION=!1;if(this._emissiveTexture&&r.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,s,"EMISSIVE")}else s.EMISSIVE=!1;if(this._lightmapTexture&&r.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,s,"LIGHTMAP"),s.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else s.LIGHTMAP=!1;if(this._specularTexture&&r.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture,s,"SPECULAR"),s.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else s.SPECULAR=!1;if(o.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&r.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,s,"BUMP"),s.PARALLAX=this._useParallax,s.PARALLAXOCCLUSION=this._useParallaxOcclusion,s.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else s.BUMP=!1;if(this._refractionTexture&&r.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;s._needUVs=!0,s.REFRACTION=!0,s.REFRACTIONMAP_3D=this._refractionTexture.isCube}else s.REFRACTION=!1;s.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else s.DIFFUSE=!1,s.AMBIENT=!1,s.OPACITY=!1,s.REFLECTION=!1,s.EMISSIVE=!1,s.LIGHTMAP=!1,s.BUMP=!1,s.REFRACTION=!1;s.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),s.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,s.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,s.SPECULAROVERALPHA=this._useSpecularOverAlpha,s.PREMULTIPLYALPHA=this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF}if(s._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(s),s.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,s.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(s._areFresnelDirty&&(r.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(s.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,s.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,s.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,s.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,s.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,s.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,s._needNormals=!0,s.FRESNEL=!0):s.FRESNEL=!1),e.MaterialHelper.PrepareDefinesForMisc(i,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(i),s),e.MaterialHelper.PrepareDefinesForAttributes(i,s,!0,!0,!0),e.MaterialHelper.PrepareDefinesForFrameBoundValues(o,l,s,a),s.isDirty){s.markAsProcessed(),o.resetCachedMaterial();var c=new e.EffectFallbacks;s.REFLECTION&&c.addFallback(0,"REFLECTION"),s.SPECULAR&&c.addFallback(0,"SPECULAR"),s.BUMP&&c.addFallback(0,"BUMP"),s.PARALLAX&&c.addFallback(1,"PARALLAX"),s.PARALLAXOCCLUSION&&c.addFallback(0,"PARALLAXOCCLUSION"),s.SPECULAROVERALPHA&&c.addFallback(0,"SPECULAROVERALPHA"),s.FOG&&c.addFallback(1,"FOG"),s.POINTSIZE&&c.addFallback(0,"POINTSIZE"),s.LOGARITHMICDEPTH&&c.addFallback(0,"LOGARITHMICDEPTH"),e.MaterialHelper.HandleFallbacksForShadows(s,c,this._maxSimultaneousLights),s.SPECULARTERM&&c.addFallback(0,"SPECULARTERM"),s.DIFFUSEFRESNEL&&c.addFallback(1,"DIFFUSEFRESNEL"),s.OPACITYFRESNEL&&c.addFallback(2,"OPACITYFRESNEL"),s.REFLECTIONFRESNEL&&c.addFallback(3,"REFLECTIONFRESNEL"),s.EMISSIVEFRESNEL&&c.addFallback(4,"EMISSIVEFRESNEL"),s.FRESNEL&&c.addFallback(4,"FRESNEL");var u=[e.VertexBuffer.PositionKind];s.NORMAL&&u.push(e.VertexBuffer.NormalKind),s.UV1&&u.push(e.VertexBuffer.UVKind),s.UV2&&u.push(e.VertexBuffer.UV2Kind),s.VERTEXCOLOR&&u.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(u,i,s,c),e.MaterialHelper.PrepareAttributesForInstances(u,s),e.MaterialHelper.PrepareAttributesForMorphTargets(u,i,s);var h="default",d=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff"],p=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler"],m=["Material","Scene"];e.ImageProcessingConfiguration&&(e.ImageProcessingConfiguration.PrepareUniforms(d,s),e.ImageProcessingConfiguration.PrepareSamplers(p,s)),e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:m,samplers:p,defines:s,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(h=this.customShaderNameResolve(h,d,m,p,s));var _=s.toString();n.setEffect(o.getEngine().createEffect(h,{attributes:u,uniformsNames:d,uniformBuffersNames:m,samplers:p,defines:_,fallbacks:c,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:s.NUM_MORPH_INFLUENCERS}},l),s),this.buildUniformLayout()}return!(!n.effect||!n.effect.isReady())&&(s._renderId=o.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("diffuseLeftColor",4),this._uniformBuffer.addUniform("diffuseRightColor",4),this._uniformBuffer.addUniform("opacityParts",4),this._uniformBuffer.addUniform("reflectionLeftColor",4),this._uniformBuffer.addUniform("reflectionRightColor",4),this._uniformBuffer.addUniform("refractionLeftColor",4),this._uniformBuffer.addUniform("refractionRightColor",4),this._uniformBuffer.addUniform("emissiveLeftColor",4),this._uniformBuffer.addUniform("emissiveRightColor",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",2),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vReflectionPosition",3),this._uniformBuffer.addUniform("vReflectionSize",3),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vSpecularInfos",2),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("specularMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vSpecularColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("vDiffuseColor",4),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},r.prototype.unbind=function(){if(this._activeEffect){var e=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),e=!0),e&&this._markAllSubMeshesAsTexturesDirty()}i.prototype.unbind.call(this)},r.prototype.bindForSubMesh=function(t,i,n){var a=this.getScene(),o=n._materialDefines;if(o){var s=n.effect;if(s){this._activeEffect=s,this.bindOnlyWorldMatrix(t),o.OBJECTSPACE_NORMALMAP&&(t.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var l=this._mustRebind(a,s,i.visibility);if(e.MaterialHelper.BindBonesParameters(i,s),l){if(this._uniformBuffer.bindToEffect(s,"Material"),this.bindViewProjection(s),!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(r.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._uniformBuffer.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._uniformBuffer.updateColor4("opacityParts",new e.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._uniformBuffer.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._uniformBuffer.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._uniformBuffer.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),a.texturesEnabled){if(this._diffuseTexture&&r.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),e.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse"),this._diffuseTexture.hasAlpha&&s.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&r.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),e.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&r.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),e.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),this._reflectionTexture&&r.ReflectionTextureEnabled&&(this._uniformBuffer.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),this._uniformBuffer.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var c=this._reflectionTexture;this._uniformBuffer.updateVector3("vReflectionPosition",c.boundingBoxPosition),this._uniformBuffer.updateVector3("vReflectionSize",c.boundingBoxSize)}if(this._emissiveTexture&&r.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),e.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&r.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),e.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),this._specularTexture&&r.SpecularTextureEnabled&&(this._uniformBuffer.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),e.MaterialHelper.BindTextureMatrix(this._specularTexture,this._uniformBuffer,"specular")),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&r.BumpTextureEnabled&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),e.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),a._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&r.RefractionTextureEnabled){var u=1;this._refractionTexture.isCube||(this._uniformBuffer.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(u=this._refractionTexture.depth)),this._uniformBuffer.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,u,this.invertRefractionY?-1:1)}}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),o.SPECULARTERM&&this._uniformBuffer.updateColor4("vSpecularColor",this.specularColor,this.specularPower),this._uniformBuffer.updateColor3("vEmissiveColor",this.emissiveColor),this._uniformBuffer.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility)}if(a.texturesEnabled&&(this._diffuseTexture&&r.DiffuseTextureEnabled&&s.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&r.AmbientTextureEnabled&&s.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&r.OpacityTextureEnabled&&s.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&r.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?s.setTexture("reflectionCubeSampler",this._reflectionTexture):s.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&r.EmissiveTextureEnabled&&s.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&r.LightmapTextureEnabled&&s.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&r.SpecularTextureEnabled&&s.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&r.BumpTextureEnabled&&s.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&r.RefractionTextureEnabled)){u=1;this._refractionTexture.isCube?s.setTexture("refractionCubeSampler",this._refractionTexture):s.setTexture("refraction2DSampler",this._refractionTexture)}e.MaterialHelper.BindClipPlane(s,a),a.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),e.MaterialHelper.BindEyePosition(s,a),s.setColor3("vAmbientColor",this._globalAmbientColor)}!l&&this.isFrozen||(a.lightsEnabled&&!this._disableLighting&&e.MaterialHelper.BindLights(a,i,s,o,this._maxSimultaneousLights),(a.fogEnabled&&i.applyFog&&a.fogMode!==e.Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(s),e.MaterialHelper.BindFogParameters(a,i,s),o.NUM_MORPH_INFLUENCERS&&e.MaterialHelper.BindMorphTargetParameters(i,s),e.MaterialHelper.BindLogDepth(o,s,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(i,this._activeEffect)}}},r.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))},r.prototype.dispose=function(e,t){t&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e,t)},r.prototype.clone=function(t,i){var n=this,a=e.SerializationHelper.Clone((function(){return new r(t,i||n.getScene())}),this);return a.name=t,a.id=t,a},r.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},r.Parse=function(t,i,n){return e.SerializationHelper.Parse((function(){return new r(t.name,i)}),t,i,n)},Object.defineProperty(r,"DiffuseTextureEnabled",{get:function(){return r._DiffuseTextureEnabled},set:function(t){r._DiffuseTextureEnabled!==t&&(r._DiffuseTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"AmbientTextureEnabled",{get:function(){return r._AmbientTextureEnabled},set:function(t){r._AmbientTextureEnabled!==t&&(r._AmbientTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"OpacityTextureEnabled",{get:function(){return r._OpacityTextureEnabled},set:function(t){r._OpacityTextureEnabled!==t&&(r._OpacityTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ReflectionTextureEnabled",{get:function(){return r._ReflectionTextureEnabled},set:function(t){r._ReflectionTextureEnabled!==t&&(r._ReflectionTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"EmissiveTextureEnabled",{get:function(){return r._EmissiveTextureEnabled},set:function(t){r._EmissiveTextureEnabled!==t&&(r._EmissiveTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"SpecularTextureEnabled",{get:function(){return r._SpecularTextureEnabled},set:function(t){r._SpecularTextureEnabled!==t&&(r._SpecularTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BumpTextureEnabled",{get:function(){return r._BumpTextureEnabled},set:function(t){r._BumpTextureEnabled!==t&&(r._BumpTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"LightmapTextureEnabled",{get:function(){return r._LightmapTextureEnabled},set:function(t){r._LightmapTextureEnabled!==t&&(r._LightmapTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"RefractionTextureEnabled",{get:function(){return r._RefractionTextureEnabled},set:function(t){r._RefractionTextureEnabled!==t&&(r._RefractionTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ColorGradingTextureEnabled",{get:function(){return r._ColorGradingTextureEnabled},set:function(t){r._ColorGradingTextureEnabled!==t&&(r._ColorGradingTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"FresnelEnabled",{get:function(){return r._FresnelEnabled},set:function(t){r._FresnelEnabled!==t&&(r._FresnelEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.FresnelDirtyFlag))},enumerable:!0,configurable:!0}),r._DiffuseTextureEnabled=!0,r._AmbientTextureEnabled=!0,r._OpacityTextureEnabled=!0,r._ReflectionTextureEnabled=!0,r._EmissiveTextureEnabled=!0,r._SpecularTextureEnabled=!0,r._BumpTextureEnabled=!0,r._LightmapTextureEnabled=!0,r._RefractionTextureEnabled=!0,r._ColorGradingTextureEnabled=!0,r._FresnelEnabled=!0,n([e.serializeAsTexture("diffuseTexture")],r.prototype,"_diffuseTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"diffuseTexture",void 0),n([e.serializeAsTexture("ambientTexture")],r.prototype,"_ambientTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTexture",void 0),n([e.serializeAsTexture("opacityTexture")],r.prototype,"_opacityTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"opacityTexture",void 0),n([e.serializeAsTexture("reflectionTexture")],r.prototype,"_reflectionTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionTexture",void 0),n([e.serializeAsTexture("emissiveTexture")],r.prototype,"_emissiveTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveTexture",void 0),n([e.serializeAsTexture("specularTexture")],r.prototype,"_specularTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"specularTexture",void 0),n([e.serializeAsTexture("bumpTexture")],r.prototype,"_bumpTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture",void 0),n([e.serializeAsTexture("lightmapTexture")],r.prototype,"_lightmapTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"lightmapTexture",void 0),n([e.serializeAsTexture("refractionTexture")],r.prototype,"_refractionTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"refractionTexture",void 0),n([e.serializeAsColor3("ambient")],r.prototype,"ambientColor",void 0),n([e.serializeAsColor3("diffuse")],r.prototype,"diffuseColor",void 0),n([e.serializeAsColor3("specular")],r.prototype,"specularColor",void 0),n([e.serializeAsColor3("emissive")],r.prototype,"emissiveColor",void 0),n([e.serialize()],r.prototype,"specularPower",void 0),n([e.serialize("useAlphaFromDiffuseTexture")],r.prototype,"_useAlphaFromDiffuseTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAlphaFromDiffuseTexture",void 0),n([e.serialize("useEmissiveAsIllumination")],r.prototype,"_useEmissiveAsIllumination",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useEmissiveAsIllumination",void 0),n([e.serialize("linkEmissiveWithDiffuse")],r.prototype,"_linkEmissiveWithDiffuse",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"linkEmissiveWithDiffuse",void 0),n([e.serialize("useSpecularOverAlpha")],r.prototype,"_useSpecularOverAlpha",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useSpecularOverAlpha",void 0),n([e.serialize("useReflectionOverAlpha")],r.prototype,"_useReflectionOverAlpha",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useReflectionOverAlpha",void 0),n([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),n([e.serialize("useObjectSpaceNormalMap")],r.prototype,"_useObjectSpaceNormalMap",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useObjectSpaceNormalMap",void 0),n([e.serialize("useParallax")],r.prototype,"_useParallax",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallax",void 0),n([e.serialize("useParallaxOcclusion")],r.prototype,"_useParallaxOcclusion",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallaxOcclusion",void 0),n([e.serialize()],r.prototype,"parallaxScaleBias",void 0),n([e.serialize("roughness")],r.prototype,"_roughness",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"roughness",void 0),n([e.serialize()],r.prototype,"indexOfRefraction",void 0),n([e.serialize()],r.prototype,"invertRefractionY",void 0),n([e.serialize()],r.prototype,"alphaCutOff",void 0),n([e.serialize("useLightmapAsShadowmap")],r.prototype,"_useLightmapAsShadowmap",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLightmapAsShadowmap",void 0),n([e.serializeAsFresnelParameters("diffuseFresnelParameters")],r.prototype,"_diffuseFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"diffuseFresnelParameters",void 0),n([e.serializeAsFresnelParameters("opacityFresnelParameters")],r.prototype,"_opacityFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelAndMiscDirty")],r.prototype,"opacityFresnelParameters",void 0),n([e.serializeAsFresnelParameters("reflectionFresnelParameters")],r.prototype,"_reflectionFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"reflectionFresnelParameters",void 0),n([e.serializeAsFresnelParameters("refractionFresnelParameters")],r.prototype,"_refractionFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"refractionFresnelParameters",void 0),n([e.serializeAsFresnelParameters("emissiveFresnelParameters")],r.prototype,"_emissiveFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"emissiveFresnelParameters",void 0),n([e.serialize("useReflectionFresnelFromSpecular")],r.prototype,"_useReflectionFresnelFromSpecular",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"useReflectionFresnelFromSpecular",void 0),n([e.serialize("useGlossinessFromSpecularMapAlpha")],r.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useGlossinessFromSpecularMapAlpha",void 0),n([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),n([e.serialize("invertNormalMapX")],r.prototype,"_invertNormalMapX",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapX",void 0),n([e.serialize("invertNormalMapY")],r.prototype,"_invertNormalMapY",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapY",void 0),n([e.serialize("twoSidedLighting")],r.prototype,"_twoSidedLighting",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"twoSidedLighting",void 0),n([e.serialize()],r.prototype,"useLogarithmicDepth",null),r}(e.PushMaterial);e.StandardMaterial=i}(s||(s={})),function(e){var t=function(){function t(){this.x=e.Vector3.Zero(),this.y=e.Vector3.Zero(),this.z=e.Vector3.Zero(),this.xx=e.Vector3.Zero(),this.yy=e.Vector3.Zero(),this.zz=e.Vector3.Zero(),this.xy=e.Vector3.Zero(),this.yz=e.Vector3.Zero(),this.zx=e.Vector3.Zero()}return t.prototype.addAmbient=function(t){var i=new e.Vector3(t.r,t.g,t.b);this.xx=this.xx.add(i),this.yy=this.yy.add(i),this.zz=this.zz.add(i)},t.prototype.scale=function(e){this.x=this.x.scale(e),this.y=this.y.scale(e),this.z=this.z.scale(e),this.xx=this.xx.scale(e),this.yy=this.yy.scale(e),this.zz=this.zz.scale(e),this.yz=this.yz.scale(e),this.zx=this.zx.scale(e),this.xy=this.xy.scale(e)},t.FromHarmonics=function(e){var i=new t;return i.x=e.l11.scale(1.02333),i.y=e.l1_1.scale(1.02333),i.z=e.l10.scale(1.02333),i.xx=e.l00.scale(.886277).subtract(e.l20.scale(.247708)).add(e.lL22.scale(.429043)),i.yy=e.l00.scale(.886277).subtract(e.l20.scale(.247708)).subtract(e.lL22.scale(.429043)),i.zz=e.l00.scale(.886277).add(e.l20.scale(.495417)),i.yz=e.l2_1.scale(.858086),i.zx=e.l21.scale(.858086),i.xy=e.l2_2.scale(.858086),i.scale(1/Math.PI),i},t.FromArray=function(i){var r=new t;return e.Vector3.FromArrayToRef(i[__uv.$wrap((0))],0,r.x),e.Vector3.FromArrayToRef(i[__uv.$wrap((1))],0,r.y),e.Vector3.FromArrayToRef(i[__uv.$wrap((2))],0,r.z),e.Vector3.FromArrayToRef(i[__uv.$wrap((3))],0,r.xx),e.Vector3.FromArrayToRef(i[__uv.$wrap((4))],0,r.yy),e.Vector3.FromArrayToRef(i[__uv.$wrap((5))],0,r.zz),e.Vector3.FromArrayToRef(i[__uv.$wrap((6))],0,r.yz),e.Vector3.FromArrayToRef(i[__uv.$wrap((7))],0,r.zx),e.Vector3.FromArrayToRef(i[__uv.$wrap((8))],0,r.xy),r},t}();e.SphericalPolynomial=t;var i=function(){function t(){this.l00=e.Vector3.Zero(),this.l1_1=e.Vector3.Zero(),this.l10=e.Vector3.Zero(),this.l11=e.Vector3.Zero(),this.l2_2=e.Vector3.Zero(),this.l2_1=e.Vector3.Zero(),this.l20=e.Vector3.Zero(),this.l21=e.Vector3.Zero(),this.lL22=e.Vector3.Zero()}return t.prototype.addLight=function(t,i,r){var n=new e.Vector3(i.r,i.g,i.b).scale(r);this.l00=this.l00.add(n.scale(.282095)),this.l1_1=this.l1_1.add(n.scale(.488603*t.y)),this.l10=this.l10.add(n.scale(.488603*t.z)),this.l11=this.l11.add(n.scale(.488603*t.x)),this.l2_2=this.l2_2.add(n.scale(1.092548*t.x*t.y)),this.l2_1=this.l2_1.add(n.scale(1.092548*t.y*t.z)),this.l21=this.l21.add(n.scale(1.092548*t.x*t.z)),this.l20=this.l20.add(n.scale(.315392*(3*t.z*t.z-1))),this.lL22=this.lL22.add(n.scale(.546274*(t.x*t.x-t.y*t.y)))},t.prototype.scale=function(e){this.l00=this.l00.scale(e),this.l1_1=this.l1_1.scale(e),this.l10=this.l10.scale(e),this.l11=this.l11.scale(e),this.l2_2=this.l2_2.scale(e),this.l2_1=this.l2_1.scale(e),this.l20=this.l20.scale(e),this.l21=this.l21.scale(e),this.lL22=this.lL22.scale(e)},t.prototype.convertIncidentRadianceToIrradiance=function(){this.l00=this.l00.scale(3.141593),this.l1_1=this.l1_1.scale(2.094395),this.l10=this.l10.scale(2.094395),this.l11=this.l11.scale(2.094395),this.l2_2=this.l2_2.scale(.785398),this.l2_1=this.l2_1.scale(.785398),this.l20=this.l20.scale(.785398),this.l21=this.l21.scale(.785398),this.lL22=this.lL22.scale(.785398)},t.prototype.convertIrradianceToLambertianRadiance=function(){this.scale(1/Math.PI)},t.FromPolynomial=function(e){var i=new t;return i.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),i.l1_1=e.y.scale(.977204),i.l10=e.z.scale(.977204),i.l11=e.x.scale(.977204),i.l2_2=e.xy.scale(1.16538),i.l2_1=e.yz.scale(1.16538),i.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),i.l21=e.zx.scale(1.16538),i.lL22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),i.scale(Math.PI),i},t.FromArray=function(i){var r=new t;return e.Vector3.FromArrayToRef(i[__uv.$wrap((0))],0,r.l00),e.Vector3.FromArrayToRef(i[__uv.$wrap((1))],0,r.l1_1),e.Vector3.FromArrayToRef(i[__uv.$wrap((2))],0,r.l10),e.Vector3.FromArrayToRef(i[__uv.$wrap((3))],0,r.l11),e.Vector3.FromArrayToRef(i[__uv.$wrap((4))],0,r.l2_2),e.Vector3.FromArrayToRef(i[__uv.$wrap((5))],0,r.l2_1),e.Vector3.FromArrayToRef(i[__uv.$wrap((6))],0,r.l20),e.Vector3.FromArrayToRef(i[__uv.$wrap((7))],0,r.l21),e.Vector3.FromArrayToRef(i[__uv.$wrap((8))],0,r.lL22),r},t}();e.SphericalHarmonics=i}(s||(s={})),function(e){var t=function(e,t,i,r){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=r},i=function(){function i(){}return i.ConvertCubeMapTextureToSphericalPolynomial=function(t){if(!t.isCube)return null;var i,r,n=t.getSize().width,a=t.readPixels(0),o=t.readPixels(1);t.isRenderTarget?(i=t.readPixels(3),r=t.readPixels(2)):(i=t.readPixels(2),r=t.readPixels(3));var s=t.readPixels(4),l=t.readPixels(5),c=t.gammaSpace,u=e.Engine.TEXTUREFORMAT_RGBA,h=e.Engine.TEXTURETYPE_UNSIGNED_INT;t.textureType&&t.textureType!==e.Engine.TEXTURETYPE_UNSIGNED_INT&&(h=e.Engine.TEXTURETYPE_FLOAT);var d={size:n,right:a,left:o,up:i,down:r,front:s,back:l,format:u,type:h,gammaSpace:c};return this.ConvertCubeMapToSphericalPolynomial(d)},i.ConvertCubeMapToSphericalPolynomial=function(t){for(var i=new e.SphericalHarmonics,r=0,n=2/t.size,a=n,o=.5*n-1,s=0;s<6;s++)for(var l=this.FileFaces[__uv.$wrap((s))],c=t[__uv.$wrap((l.name))],u=o,h=t.format===e.Engine.TEXTUREFORMAT_RGBA?4:3,d=0;d<t.size;d++){for(var p=o,m=0;m<t.size;m++){var _=l.worldAxisForFileX.scale(p).add(l.worldAxisForFileY.scale(u)).add(l.worldAxisForNormal);_.normalize();var f=Math.pow(1+p*p+u*u,-1.5),g=c[__uv.$wrap((d*t.size*h+m*h+0))],y=c[__uv.$wrap((d*t.size*h+m*h+1))],v=c[__uv.$wrap((d*t.size*h+m*h+2))];t.type===e.Engine.TEXTURETYPE_UNSIGNED_INT&&(g/=255,y/=255,v/=255),t.gammaSpace&&(g=Math.pow(e.Scalar.Clamp(g),e.ToLinearSpace),y=Math.pow(e.Scalar.Clamp(y),e.ToLinearSpace),v=Math.pow(e.Scalar.Clamp(v),e.ToLinearSpace));var b=new e.Color3(g,y,v);i.addLight(_,b,f),r+=f,p+=n}u+=a}var x=6*(4*Math.PI)/6/r;return i.scale(x),i.convertIncidentRadianceToIrradiance(),i.convertIrradianceToLambertianRadiance(),e.SphericalPolynomial.FromHarmonics(i)},i.FileFaces=[new t("right",new e.Vector3(1,0,0),new e.Vector3(0,0,-1),new e.Vector3(0,-1,0)),new t("left",new e.Vector3(-1,0,0),new e.Vector3(0,0,1),new e.Vector3(0,-1,0)),new t("up",new e.Vector3(0,1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,1)),new t("down",new e.Vector3(0,-1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,-1)),new t("front",new e.Vector3(0,0,1),new e.Vector3(1,0,0),new e.Vector3(0,-1,0)),new t("back",new e.Vector3(0,0,-1),new e.Vector3(-1,0,0),new e.Vector3(0,-1,0))],i}();e.CubeMapToSphericalPolynomialTools=i}(s||(s={})),function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.PBR=!0,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.ALBEDO=!1,t.ALBEDODIRECTUV=0,t.VERTEXCOLOR=!1,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.AMBIENTINGRAYSCALE=!1,t.OPACITY=!1,t.VERTEXALPHA=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHABLEND=!1,t.ALPHAFROMALBEDO=!1,t.ALPHATESTVALUE="0.5",t.SPECULAROVERALPHA=!1,t.RADIANCEOVERALPHA=!1,t.ALPHAFRESNEL=!1,t.LINEARALPHAFRESNEL=!1,t.PREMULTIPLYALPHA=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITY=!1,t.REFLECTIVITYDIRECTUV=0,t.SPECULARTERM=!1,t.MICROSURFACEFROMREFLECTIVITYMAP=!1,t.MICROSURFACEAUTOMATIC=!1,t.LODBASEDMICROSFURACE=!1,t.MICROSURFACEMAP=!1,t.MICROSURFACEMAPDIRECTUV=0,t.METALLICWORKFLOW=!1,t.ROUGHNESSSTOREINMETALMAPALPHA=!1,t.ROUGHNESSSTOREINMETALMAPGREEN=!1,t.METALLNESSSTOREINMETALMAPBLUE=!1,t.AOSTOREINMETALMAPRED=!1,t.ENVIRONMENTBRDF=!1,t.NORMAL=!1,t.TANGENT=!1,t.BUMP=!1,t.BUMPDIRECTUV=0,t.OBJECTSPACE_NORMALMAP=!1,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.NORMALXYSCALE=!0,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.USELIGHTMAPASSHADOWMAP=!1,t.GAMMALIGHTMAP=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.RADIANCEOCCLUSION=!1,t.HORIZONOCCLUSION=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFRACTIONMAP_OPPOSITEZ=!1,t.LODINREFRACTIONALPHA=!1,t.GAMMAREFRACTION=!1,t.RGBDREFRACTION=!1,t.LINKREFRACTIONTOTRANSPARENCY=!1,t.INSTANCES=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.NONUNIFORMSCALING=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.POINTSIZE=!1,t.FOG=!1,t.LOGARITHMICDEPTH=!1,t.FORCENORMALFORWARD=!1,t.SPECULARAA=!1,t.UNLIT=!1,t.rebuild(),t}return a(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},t}(e.MaterialDefines),i=function(i){function r(t,n){var a=i.call(this,t,n)||this;return a._directIntensity=1,a._emissiveIntensity=1,a._environmentIntensity=1,a._specularIntensity=1,a._lightingInfos=new e.Vector4(a._directIntensity,a._emissiveIntensity,a._environmentIntensity,a._specularIntensity),a._disableBumpMap=!1,a._ambientTextureStrength=1,a._ambientTextureImpactOnAnalyticalLights=e.PBRMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,a._ambientColor=new e.Color3(0,0,0),a._albedoColor=new e.Color3(1,1,1),a._reflectivityColor=new e.Color3(1,1,1),a._reflectionColor=new e.Color3(1,1,1),a._emissiveColor=new e.Color3(0,0,0),a._microSurface=.9,a._indexOfRefraction=.66,a._invertRefractionY=!1,a._linkRefractionWithTransparency=!1,a._useLightmapAsShadowmap=!1,a._useHorizonOcclusion=!0,a._useRadianceOcclusion=!0,a._useAlphaFromAlbedoTexture=!1,a._useSpecularOverAlpha=!0,a._useMicroSurfaceFromReflectivityMapAlpha=!1,a._useRoughnessFromMetallicTextureAlpha=!0,a._useRoughnessFromMetallicTextureGreen=!1,a._useMetallnessFromMetallicTextureBlue=!1,a._useAmbientOcclusionFromMetallicTextureRed=!1,a._useAmbientInGrayScale=!1,a._useAutoMicroSurfaceFromReflectivityMap=!1,a._lightFalloff=r.LIGHTFALLOFF_PHYSICAL,a._useRadianceOverAlpha=!0,a._useObjectSpaceNormalMap=!1,a._useParallax=!1,a._useParallaxOcclusion=!1,a._parallaxScaleBias=.05,a._disableLighting=!1,a._maxSimultaneousLights=4,a._invertNormalMapX=!1,a._invertNormalMapY=!1,a._twoSidedLighting=!1,a._alphaCutOff=.4,a._forceAlphaTest=!1,a._useAlphaFresnel=!1,a._useLinearAlphaFresnel=!1,a._transparencyMode=null,a._environmentBRDFTexture=null,a._forceIrradianceInFragment=!1,a._forceNormalForward=!1,a._enableSpecularAntiAliasing=!1,a._renderTargets=new e.SmartArray(16),a._globalAmbientColor=new e.Color3(0,0,0),a._unlit=!1,a._attachImageProcessingConfiguration(null),a.getRenderTargetTextures=function(){return a._renderTargets.reset(),e.StandardMaterial.ReflectionTextureEnabled&&a._reflectionTexture&&a._reflectionTexture.isRenderTarget&&a._renderTargets.push(a._reflectionTexture),e.StandardMaterial.RefractionTextureEnabled&&a._refractionTexture&&a._refractionTexture.isRenderTarget&&a._renderTargets.push(a._refractionTexture),a._renderTargets},a._environmentBRDFTexture=e.TextureTools.GetEnvironmentBRDFTexture(n),a}return a(r,i),r.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(e){t._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(r.prototype,"hasRenderTargetTextures",{get:function(){return!!(e.StandardMaterial.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(e.StandardMaterial.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(r.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"_disableAlphaBlending",{get:function(){return this._linkRefractionWithTransparency||this._transparencyMode===e.PBRMaterial.PBRMATERIAL_OPAQUE||this._transparencyMode===e.PBRMaterial.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),r.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},r.prototype.needAlphaBlendingForMesh=function(e){return!this._disableAlphaBlending&&i.prototype.needAlphaBlendingForMesh.call(this,e)},r.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this._linkRefractionWithTransparency&&(null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===e.PBRMaterial.PBRMATERIAL_ALPHATEST))},r.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==e.PBRMaterial.PBRMATERIAL_OPAQUE},r.prototype.getAlphaTestTexture=function(){return this._albedoTexture},r.prototype.isReadyForSubMesh=function(i,r,n){if(r.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;r._materialDefines||(r._materialDefines=new t);var a=r._materialDefines;if(!this.checkReadyOnEveryCall&&r.effect&&a._renderId===this.getScene().getRenderId())return!0;var o=this.getScene(),s=o.getEngine();if(a._areTexturesDirty&&o.texturesEnabled){if(this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&e.StandardMaterial.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&e.StandardMaterial.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var l=this._getReflectionTexture();if(l&&e.StandardMaterial.ReflectionTextureEnabled&&!l.isReadyOrNotBlocking())return!1;if(this._lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(e.StandardMaterial.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(s.getCaps().standardDerivatives&&this._bumpTexture&&e.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;var c=this._getRefractionTexture();if(c&&e.StandardMaterial.RefractionTextureEnabled&&!c.isReadyOrNotBlocking())return!1;if(this._environmentBRDFTexture&&e.StandardMaterial.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(a._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;s.getCaps().standardDerivatives||i.isVerticesDataPresent(e.VertexBuffer.NormalKind)||(i.createNormals(!0),e.Tools.Warn("PBRMaterial: Normals have been created for the mesh: "+i.name));var u=this._prepareEffect(i,a,this.onCompiled,this.onError,n);return u&&(o.resetCachedMaterial(),r.setEffect(u,a),this.buildUniformLayout()),!(!r.effect||!r.effect.isReady())&&(a._renderId=o.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},r.prototype._prepareEffect=function(t,i,r,n,a,o){if(void 0===r&&(r=null),void 0===n&&(n=null),void 0===a&&(a=null),void 0===o&&(o=null),this._prepareDefines(t,i,a,o),!i.isDirty)return null;i.markAsProcessed();var s=this.getScene().getEngine(),l=new e.EffectFallbacks,c=0;i.USESPHERICALINVERTEX&&l.addFallback(c++,"USESPHERICALINVERTEX"),i.FOG&&l.addFallback(c,"FOG"),i.SPECULARAA&&l.addFallback(c,"SPECULARAA"),i.POINTSIZE&&l.addFallback(c,"POINTSIZE"),i.LOGARITHMICDEPTH&&l.addFallback(c,"LOGARITHMICDEPTH"),i.PARALLAX&&l.addFallback(c,"PARALLAX"),i.PARALLAXOCCLUSION&&l.addFallback(c++,"PARALLAXOCCLUSION"),i.ENVIRONMENTBRDF&&l.addFallback(c++,"ENVIRONMENTBRDF"),i.TANGENT&&l.addFallback(c++,"TANGENT"),i.BUMP&&l.addFallback(c++,"BUMP"),c=e.MaterialHelper.HandleFallbacksForShadows(i,l,this._maxSimultaneousLights,c++),i.SPECULARTERM&&l.addFallback(c++,"SPECULARTERM"),i.USESPHERICALFROMREFLECTIONMAP&&l.addFallback(c++,"USESPHERICALFROMREFLECTIONMAP"),i.LIGHTMAP&&l.addFallback(c++,"LIGHTMAP"),i.NORMAL&&l.addFallback(c++,"NORMAL"),i.AMBIENT&&l.addFallback(c++,"AMBIENT"),i.EMISSIVE&&l.addFallback(c++,"EMISSIVE"),i.VERTEXCOLOR&&l.addFallback(c++,"VERTEXCOLOR"),i.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(c++,t),i.MORPHTARGETS&&l.addFallback(c++,"MORPHTARGETS");var u=[e.VertexBuffer.PositionKind];i.NORMAL&&u.push(e.VertexBuffer.NormalKind),i.TANGENT&&u.push(e.VertexBuffer.TangentKind),i.UV1&&u.push(e.VertexBuffer.UVKind),i.UV2&&u.push(e.VertexBuffer.UV2Kind),i.VERTEXCOLOR&&u.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(u,t,i,l),e.MaterialHelper.PrepareAttributesForInstances(u,i),e.MaterialHelper.PrepareAttributesForMorphTargets(u,t,i);var h=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX","vSphericalYY","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vReflectionMicrosurfaceInfos","vRefractionMicrosurfaceInfos","vTangentSpaceParams"],d=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","microSurfaceSampler","environmentBrdfSampler"],p=["Material","Scene"];e.ImageProcessingConfiguration&&(e.ImageProcessingConfiguration.PrepareUniforms(h,i),e.ImageProcessingConfiguration.PrepareSamplers(d,i)),e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:h,uniformBuffersNames:p,samplers:d,defines:i,maxSimultaneousLights:this._maxSimultaneousLights});var m=i.toString();return s.createEffect("pbr",{attributes:u,uniformsNames:h,uniformBuffersNames:p,samplers:d,defines:m,fallbacks:l,onCompiled:r,onError:n,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:i.NUM_MORPH_INFLUENCERS}},s)},r.prototype._prepareDefines=function(t,i,n,a){void 0===n&&(n=null),void 0===a&&(a=null);var o=this.getScene(),s=o.getEngine();if(e.MaterialHelper.PrepareDefinesForLights(o,t,i,!0,this._maxSimultaneousLights,this._disableLighting),i._needNormals=!0,i.METALLICWORKFLOW=this.isMetallicWorkflow(),i._areTexturesDirty){if(i._needUVs=!1,o.texturesEnabled){o.getEngine().getCaps().textureLOD&&(i.LODBASEDMICROSFURACE=!0),this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled?e.MaterialHelper.PrepareDefinesForMergedUV(this._albedoTexture,i,"ALBEDO"):i.ALBEDO=!1,this._ambientTexture&&e.StandardMaterial.AmbientTextureEnabled?(e.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,i,"AMBIENT"),i.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):i.AMBIENT=!1,this._opacityTexture&&e.StandardMaterial.OpacityTextureEnabled?(e.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,i,"OPACITY"),i.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):i.OPACITY=!1;var l=this._getReflectionTexture();if(l&&e.StandardMaterial.ReflectionTextureEnabled){switch(i.REFLECTION=!0,i.GAMMAREFLECTION=l.gammaSpace,i.RGBDREFLECTION=l.isRGBD,i.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!l.invertZ:l.invertZ,i.LODINREFLECTIONALPHA=l.lodLevelInAlpha,l.coordinatesMode===e.Texture.INVCUBIC_MODE&&(i.INVERTCUBICMAP=!0),i.REFLECTIONMAP_3D=l.isCube,l.coordinatesMode){case e.Texture.EXPLICIT_MODE:i.REFLECTIONMAP_EXPLICIT=!0;break;case e.Texture.PLANAR_MODE:i.REFLECTIONMAP_PLANAR=!0;break;case e.Texture.PROJECTION_MODE:i.REFLECTIONMAP_PROJECTION=!0;break;case e.Texture.SKYBOX_MODE:i.REFLECTIONMAP_SKYBOX=!0;break;case e.Texture.SPHERICAL_MODE:i.REFLECTIONMAP_SPHERICAL=!0;break;case e.Texture.EQUIRECTANGULAR_MODE:i.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MODE:i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:default:i.REFLECTIONMAP_CUBIC=!0,i.USE_LOCAL_REFLECTIONMAP_CUBIC=!!l.boundingBoxSize}l.coordinatesMode!==e.Texture.SKYBOX_MODE?l.sphericalPolynomial&&(i.USESPHERICALFROMREFLECTIONMAP=!0,this._forceIrradianceInFragment||o.getEngine().getCaps().maxVaryingVectors<=8?i.USESPHERICALINVERTEX=!1:i.USESPHERICALINVERTEX=!0):i.REFLECTIONMAP_SKYBOX_TRANSFORMED=!l.getReflectionTextureMatrix().isIdentity()}else i.REFLECTION=!1,i.REFLECTIONMAP_3D=!1,i.REFLECTIONMAP_SPHERICAL=!1,i.REFLECTIONMAP_PLANAR=!1,i.REFLECTIONMAP_CUBIC=!1,i.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,i.REFLECTIONMAP_PROJECTION=!1,i.REFLECTIONMAP_SKYBOX=!1,i.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,i.REFLECTIONMAP_EXPLICIT=!1,i.REFLECTIONMAP_EQUIRECTANGULAR=!1,i.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,i.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,i.INVERTCUBICMAP=!1,i.USESPHERICALFROMREFLECTIONMAP=!1,i.USESPHERICALINVERTEX=!1,i.REFLECTIONMAP_OPPOSITEZ=!1,i.LODINREFLECTIONALPHA=!1,i.GAMMAREFLECTION=!1,i.RGBDREFLECTION=!1;this._lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled?(e.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,i,"LIGHTMAP"),i.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,i.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace):i.LIGHTMAP=!1,this._emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled?e.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,i,"EMISSIVE"):i.EMISSIVE=!1,e.StandardMaterial.SpecularTextureEnabled?(this._metallicTexture?(e.MaterialHelper.PrepareDefinesForMergedUV(this._metallicTexture,i,"REFLECTIVITY"),i.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,i.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,i.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,i.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(e.MaterialHelper.PrepareDefinesForMergedUV(this._reflectivityTexture,i,"REFLECTIVITY"),i.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,i.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):i.REFLECTIVITY=!1,this._microSurfaceTexture?e.MaterialHelper.PrepareDefinesForMergedUV(this._microSurfaceTexture,i,"MICROSURFACEMAP"):i.MICROSURFACEMAP=!1):(i.REFLECTIVITY=!1,i.MICROSURFACEMAP=!1),o.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&e.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap?(e.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,i,"BUMP"),this._useParallax&&this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled?(i.PARALLAX=!0,i.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):i.PARALLAX=!1,i.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):i.BUMP=!1;var c=this._getRefractionTexture();c&&e.StandardMaterial.RefractionTextureEnabled?(i.REFRACTION=!0,i.REFRACTIONMAP_3D=c.isCube,i.GAMMAREFRACTION=c.gammaSpace,i.RGBDREFRACTION=c.isRGBD,i.REFRACTIONMAP_OPPOSITEZ=c.invertZ,i.LODINREFRACTIONALPHA=c.lodLevelInAlpha,this._linkRefractionWithTransparency&&(i.LINKREFRACTIONTOTRANSPARENCY=!0)):i.REFRACTION=!1,this._environmentBRDFTexture&&e.StandardMaterial.ReflectionTextureEnabled?i.ENVIRONMENTBRDF=!0:i.ENVIRONMENTBRDF=!1,this._shouldUseAlphaFromAlbedoTexture()?i.ALPHAFROMALBEDO=!0:i.ALPHAFROMALBEDO=!1}i.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===r.LIGHTFALLOFF_STANDARD?(i.USEPHYSICALLIGHTFALLOFF=!1,i.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===r.LIGHTFALLOFF_GLTF?(i.USEPHYSICALLIGHTFALLOFF=!1,i.USEGLTFLIGHTFALLOFF=!0):(i.USEPHYSICALLIGHTFALLOFF=!0,i.USEGLTFLIGHTFALLOFF=!1),i.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?i.TWOSIDEDLIGHTING=!0:i.TWOSIDEDLIGHTING=!1,i.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),i.PREMULTIPLYALPHA=this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,i.ALPHABLEND=this.needAlphaBlendingForMesh(t),i.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,i.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel,i.SPECULARAA=o.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}i._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(i),i.FORCENORMALFORWARD=this._forceNormalForward,i.RADIANCEOCCLUSION=this._useRadianceOcclusion,i.HORIZONOCCLUSION=this._useHorizonOcclusion,i._areMiscDirty&&(e.MaterialHelper.PrepareDefinesForMisc(t,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(t)||this._forceAlphaTest,i),i.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!t.isVerticesDataPresent(e.VertexBuffer.NormalKind)),e.MaterialHelper.PrepareDefinesForFrameBoundValues(o,s,i,!!n,a),e.MaterialHelper.PrepareDefinesForAttributes(t,i,!0,!0,!0,this._transparencyMode!==e.PBRMaterial.PBRMATERIAL_OPAQUE)},r.prototype.forceCompilation=function(e,i,r){var n=this,a=o({clipPlane:!1},r),s=new t,l=this._prepareEffect(e,s,void 0,void 0,void 0,a.clipPlane);l.isReady()?i&&i(this):l.onCompileObservable.add((function(){i&&i(n)}))},r.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vAlbedoInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",4),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vReflectivityInfos",3),this._uniformBuffer.addUniform("vMicroSurfaceSamplerInfos",2),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vReflectionPosition",3),this._uniformBuffer.addUniform("vReflectionSize",3),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("albedoMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("reflectivityMatrix",16),this._uniformBuffer.addUniform("microSurfaceSamplerMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionColor",3),this._uniformBuffer.addUniform("vAlbedoColor",4),this._uniformBuffer.addUniform("vLightingIntensity",4),this._uniformBuffer.addUniform("vRefractionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectivityColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},r.prototype.unbind=function(){this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._uniformBuffer.setTexture("refractionSampler",null),i.prototype.unbind.call(this)},r.prototype.bindForSubMesh=function(t,i,n){var a=this.getScene(),o=n._materialDefines;if(o){var s=n.effect;if(s){this._activeEffect=s,this.bindOnlyWorldMatrix(t),o.OBJECTSPACE_NORMALMAP&&(t.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var l=this._mustRebind(a,s,i.visibility);e.MaterialHelper.BindBonesParameters(i,this._activeEffect);var c=null;if(l){this._uniformBuffer.bindToEffect(s,"Material"),this.bindViewProjection(s),c=this._getReflectionTexture();var u=this._getRefractionTexture();if(!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(a.texturesEnabled){if(this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),e.MaterialHelper.BindTextureMatrix(this._albedoTexture,this._uniformBuffer,"albedo")),this._ambientTexture&&e.StandardMaterial.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),e.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&e.StandardMaterial.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),e.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),c&&e.StandardMaterial.ReflectionTextureEnabled){if(this._uniformBuffer.updateMatrix("reflectionMatrix",c.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",c.level,0),c.boundingBoxSize){var h=c;this._uniformBuffer.updateVector3("vReflectionPosition",h.boundingBoxPosition),this._uniformBuffer.updateVector3("vReflectionSize",h.boundingBoxSize)}var d=c.sphericalPolynomial;o.USESPHERICALFROMREFLECTIONMAP&&d&&(this._activeEffect.setFloat3("vSphericalX",d.x.x,d.x.y,d.x.z),this._activeEffect.setFloat3("vSphericalY",d.y.x,d.y.y,d.y.z),this._activeEffect.setFloat3("vSphericalZ",d.z.x,d.z.y,d.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",d.xx.x-d.zz.x,d.xx.y-d.zz.y,d.xx.z-d.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",d.yy.x-d.zz.x,d.yy.y-d.zz.y,d.yy.z-d.zz.z),this._activeEffect.setFloat3("vSphericalZZ",d.zz.x,d.zz.y,d.zz.z),this._activeEffect.setFloat3("vSphericalXY",d.xy.x,d.xy.y,d.xy.z),this._activeEffect.setFloat3("vSphericalYZ",d.yz.x,d.yz.y,d.yz.z),this._activeEffect.setFloat3("vSphericalZX",d.zx.x,d.zx.y,d.zx.z)),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",c.getSize().width,c.lodGenerationScale,c.lodGenerationOffset)}if(this._emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),e.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),e.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),e.StandardMaterial.SpecularTextureEnabled&&(this._metallicTexture?(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),e.MaterialHelper.BindTextureMatrix(this._metallicTexture,this._uniformBuffer,"reflectivity")):this._reflectivityTexture&&(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),e.MaterialHelper.BindTextureMatrix(this._reflectivityTexture,this._uniformBuffer,"reflectivity")),this._microSurfaceTexture&&(this._uniformBuffer.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),e.MaterialHelper.BindTextureMatrix(this._microSurfaceTexture,this._uniformBuffer,"microSurfaceSampler"))),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&e.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),e.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),a._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),u&&e.StandardMaterial.RefractionTextureEnabled){this._uniformBuffer.updateMatrix("refractionMatrix",u.getReflectionTextureMatrix());var p=1;u.isCube||u.depth&&(p=u.depth),this._uniformBuffer.updateFloat4("vRefractionInfos",u.level,this._indexOfRefraction,p,this._invertRefractionY?-1:1),this._uniformBuffer.updateFloat3("vRefractionMicrosurfaceInfos",u.getSize().width,u.lodGenerationScale,u.lodGenerationOffset)}}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),o.METALLICWORKFLOW?(e.PBRMaterial._scaledReflectivity.r=void 0===this._metallic||null===this._metallic?1:this._metallic,e.PBRMaterial._scaledReflectivity.g=void 0===this._roughness||null===this._roughness?1:this._roughness,this._uniformBuffer.updateColor4("vReflectivityColor",e.PBRMaterial._scaledReflectivity,0)):this._uniformBuffer.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface),this._uniformBuffer.updateColor3("vEmissiveColor",this._emissiveColor),this._uniformBuffer.updateColor3("vReflectionColor",this._reflectionColor),this._uniformBuffer.updateColor4("vAlbedoColor",this._albedoColor,this.alpha*i.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity,this._lightingInfos.w=this._specularIntensity,this._uniformBuffer.updateVector4("vLightingIntensity",this._lightingInfos)}a.texturesEnabled&&(this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&e.StandardMaterial.AmbientTextureEnabled&&this._uniformBuffer.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&e.StandardMaterial.OpacityTextureEnabled&&this._uniformBuffer.setTexture("opacitySampler",this._opacityTexture),c&&e.StandardMaterial.ReflectionTextureEnabled&&(o.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("reflectionSampler",c):(this._uniformBuffer.setTexture("reflectionSampler",c._lodTextureMid||c),this._uniformBuffer.setTexture("reflectionSamplerLow",c._lodTextureLow||c),this._uniformBuffer.setTexture("reflectionSamplerHigh",c._lodTextureHigh||c))),o.ENVIRONMENTBRDF&&this._uniformBuffer.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),u&&e.StandardMaterial.RefractionTextureEnabled&&(o.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("refractionSampler",u):(this._uniformBuffer.setTexture("refractionSampler",u._lodTextureMid||u),this._uniformBuffer.setTexture("refractionSamplerLow",u._lodTextureLow||u),this._uniformBuffer.setTexture("refractionSamplerHigh",u._lodTextureHigh||u))),this._emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled&&this._uniformBuffer.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled&&this._uniformBuffer.setTexture("lightmapSampler",this._lightmapTexture),e.StandardMaterial.SpecularTextureEnabled&&(this._metallicTexture?this._uniformBuffer.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&this._uniformBuffer.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&this._uniformBuffer.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&e.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&this._uniformBuffer.setTexture("bumpSampler",this._bumpTexture)),e.MaterialHelper.BindClipPlane(this._activeEffect,a),a.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var m=a._forcedViewPosition?a._forcedViewPosition:a._mirroredCameraPosition?a._mirroredCameraPosition:a.activeCamera.globalPosition,_=a.useRightHandedSystem===(null!=a._mirroredCameraPosition);s.setFloat4("vEyePosition",m.x,m.y,m.z,_?-1:1),s.setColor3("vAmbientColor",this._globalAmbientColor)}!l&&this.isFrozen||(a.lightsEnabled&&!this._disableLighting&&e.MaterialHelper.BindLights(a,i,this._activeEffect,o,this._maxSimultaneousLights,this._lightFalloff!==r.LIGHTFALLOFF_STANDARD),(a.fogEnabled&&i.applyFog&&a.fogMode!==e.Scene.FOGMODE_NONE||c)&&this.bindView(s),e.MaterialHelper.BindFogParameters(a,i,this._activeEffect,!0),o.NUM_MORPH_INFLUENCERS&&e.MaterialHelper.BindMorphTargetParameters(i,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),e.MaterialHelper.BindLogDepth(o,this._activeEffect,a)),this._uniformBuffer.update(),this._afterBind(i,this._activeEffect)}}},r.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},r.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},r.prototype._getRefractionTexture=function(){return this._refractionTexture?this._refractionTexture:this._linkRefractionWithTransparency?this.getScene().environmentTexture:null},r.prototype.dispose=function(e,t){t&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene()._environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e,t)},r.LIGHTFALLOFF_PHYSICAL=0,r.LIGHTFALLOFF_GLTF=1,r.LIGHTFALLOFF_STANDARD=2,r._scaledReflectivity=new e.Color3,n([e.serializeAsImageProcessingConfiguration()],r.prototype,"_imageProcessingConfiguration",void 0),n([e.serialize()],r.prototype,"useLogarithmicDepth",null),n([e.serialize()],r.prototype,"transparencyMode",null),r}(e.PushMaterial);e.PBRBaseMaterial=i}(s||(s={})),function(e){var t=function(t){function i(i,r){var n=t.call(this,i,r)||this;return n.maxSimultaneousLights=4,n.disableLighting=!1,n.invertNormalMapX=!1,n.invertNormalMapY=!1,n.emissiveColor=new e.Color3(0,0,0),n.occlusionStrength=1,n.useLightmapAsShadowmap=!1,n._useAlphaFromAlbedoTexture=!0,n._useAmbientInGrayScale=!0,n}return a(i,t),Object.defineProperty(i.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(e){this._twoSidedLighting!==e&&(this._twoSidedLighting=e,this.backFaceCulling=!e,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this.environmentTexture&&e.push(this.environmentTexture),this.normalTexture&&e.push(this.normalTexture),this.emissiveTexture&&e.push(this.emissiveTexture),this.occlusionTexture&&e.push(this.occlusionTexture),this.lightmapTexture&&e.push(this.lightmapTexture),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||this.lightmapTexture===e},i.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],i.prototype,"environmentTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],i.prototype,"normalTexture",void 0),n([e.serializeAsColor3("emissive"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveColor",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],i.prototype,"occlusionStrength",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],i.prototype,"occlusionTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],i.prototype,"alphaCutOff",void 0),n([e.serialize()],i.prototype,"doubleSided",null),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],i.prototype,"lightmapTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),i}(e.PBRBaseMaterial);e.PBRBaseSimpleMaterial=t}(s||(s={})),function(e){var t=function(t){function i(r,n){var a=t.call(this,r,n)||this;return a.directIntensity=1,a.emissiveIntensity=1,a.environmentIntensity=1,a.specularIntensity=1,a.disableBumpMap=!1,a.ambientTextureStrength=1,a.ambientTextureImpactOnAnalyticalLights=i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,a.ambientColor=new e.Color3(0,0,0),a.albedoColor=new e.Color3(1,1,1),a.reflectivityColor=new e.Color3(1,1,1),a.reflectionColor=new e.Color3(1,1,1),a.emissiveColor=new e.Color3(0,0,0),a.microSurface=1,a.indexOfRefraction=.66,a.invertRefractionY=!1,a.linkRefractionWithTransparency=!1,a.useLightmapAsShadowmap=!1,a.useAlphaFromAlbedoTexture=!1,a.forceAlphaTest=!1,a.alphaCutOff=.4,a.useSpecularOverAlpha=!0,a.useMicroSurfaceFromReflectivityMapAlpha=!1,a.useRoughnessFromMetallicTextureAlpha=!0,a.useRoughnessFromMetallicTextureGreen=!1,a.useMetallnessFromMetallicTextureBlue=!1,a.useAmbientOcclusionFromMetallicTextureRed=!1,a.useAmbientInGrayScale=!1,a.useAutoMicroSurfaceFromReflectivityMap=!1,a.useRadianceOverAlpha=!0,a.useObjectSpaceNormalMap=!1,a.useParallax=!1,a.useParallaxOcclusion=!1,a.parallaxScaleBias=.05,a.disableLighting=!1,a.forceIrradianceInFragment=!1,a.maxSimultaneousLights=4,a.invertNormalMapX=!1,a.invertNormalMapY=!1,a.twoSidedLighting=!1,a.useAlphaFresnel=!1,a.useLinearAlphaFresnel=!1,a.environmentBRDFTexture=null,a.forceNormalForward=!1,a.enableSpecularAntiAliasing=!1,a.useHorizonOcclusion=!0,a.useRadianceOcclusion=!0,a.unlit=!1,a._environmentBRDFTexture=e.TextureTools.GetEnvironmentBRDFTexture(n),a}return a(i,t),Object.defineProperty(i.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===e.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL},set:function(t){t!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=t?e.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL:e.PBRBaseMaterial.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===e.PBRBaseMaterial.LIGHTFALLOFF_GLTF},set:function(t){t!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=t?e.PBRBaseMaterial.LIGHTFALLOFF_GLTF:e.PBRBaseMaterial.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"PBRMaterial"},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||(this._albedoTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._reflectivityTexture===e||(this._metallicTexture===e||(this._microSurfaceTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e)))))))))},i.prototype.clone=function(t){var r=this,n=e.SerializationHelper.Clone((function(){return new i(t,r.getScene())}),this);return n.id=t,n.name=t,n},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.PBRMaterial",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse((function(){return new i(t.name,r)}),t,r,n)},i.PBRMATERIAL_OPAQUE=0,i.PBRMATERIAL_ALPHATEST=1,i.PBRMATERIAL_ALPHABLEND=2,i.PBRMATERIAL_ALPHATESTANDBLEND=3,i.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=1,n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"directIntensity",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveIntensity",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"environmentIntensity",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"specularIntensity",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"disableBumpMap",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTextureStrength",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"opacityTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectivityTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallicTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallic",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"microSurfaceTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],i.prototype,"lightmapTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionTexture",void 0),n([e.serializeAsColor3("ambient"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientColor",void 0),n([e.serializeAsColor3("albedo"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoColor",void 0),n([e.serializeAsColor3("reflectivity"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectivityColor",void 0),n([e.serializeAsColor3("reflection"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionColor",void 0),n([e.serializeAsColor3("emissive"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveColor",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"microSurface",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertRefractionY",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkRefractionWithTransparency",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"useAlphaFromAlbedoTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"forceAlphaTest",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"alphaCutOff",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useSpecularOverAlpha",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMetallicTextureGreen",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useMetallnessFromMetallicTextureBlue",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAmbientInGrayScale",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),n([e.serialize()],i.prototype,"usePhysicalLightFalloff",null),n([e.serialize()],i.prototype,"useGLTFLightFalloff",null),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRadianceOverAlpha",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useObjectSpaceNormalMap",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallax",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallaxOcclusion",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"parallaxScaleBias",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"forceIrradianceInFragment",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"twoSidedLighting",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAlphaFresnel",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLinearAlphaFresnel",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"environmentBRDFTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"forceNormalForward",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"enableSpecularAntiAliasing",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useHorizonOcclusion",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRadianceOcclusion",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsMiscDirty")],i.prototype,"unlit",void 0),i}(e.PBRBaseMaterial);e.PBRMaterial=t}(s||(s={})),function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r._useRoughnessFromMetallicTextureAlpha=!1,r._useRoughnessFromMetallicTextureGreen=!0,r._useMetallnessFromMetallicTextureBlue=!0,r.metallic=1,r.roughness=1,r}return a(i,t),i.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this.baseTexture&&e.push(this.baseTexture),this.metallicRoughnessTexture&&e.push(this.metallicRoughnessTexture),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||(this.baseTexture===e||this.metallicRoughnessTexture===e)},i.prototype.clone=function(t){var r=this,n=e.SerializationHelper.Clone((function(){return new i(t,r.getScene())}),this);return n.id=t,n.name=t,n},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.PBRMetallicRoughnessMaterial",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse((function(){return new i(t.name,r)}),t,r,n)},n([e.serializeAsColor3(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoColor")],i.prototype,"baseColor",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],i.prototype,"baseTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"metallic",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],i.prototype,"metallicRoughnessTexture",void 0),i}(e.PBRBaseSimpleMaterial);e.PBRMetallicRoughnessMaterial=t}(s||(s={})),function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r._useMicroSurfaceFromReflectivityMapAlpha=!0,r}return a(i,t),i.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this.diffuseTexture&&e.push(this.diffuseTexture),this.specularGlossinessTexture&&e.push(this.specularGlossinessTexture),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||(this.diffuseTexture===e||this.specularGlossinessTexture===e)},i.prototype.clone=function(t){var r=this,n=e.SerializationHelper.Clone((function(){return new i(t,r.getScene())}),this);return n.id=t,n.name=t,n},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.PBRSpecularGlossinessMaterial",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse((function(){return new i(t.name,r)}),t,r,n)},n([e.serializeAsColor3("diffuse"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoColor")],i.prototype,"diffuseColor",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],i.prototype,"diffuseTexture",void 0),n([e.serializeAsColor3("specular"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],i.prototype,"specularColor",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_microSurface")],i.prototype,"glossiness",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],i.prototype,"specularGlossinessTexture",void 0),i}(e.PBRBaseSimpleMaterial);e.PBRSpecularGlossinessMaterial=t}(s||(s={})),function(e){e.CameraInputTypes={};var t=function(){function t(e){this.attached={},this.camera=e,this.checkInputs=function(){}}return t.prototype.add=function(t){var i=t.getSimpleName();this.attached[__uv.$wrap((i))]?e.Tools.Warn("camera input of type "+i+" already exists on camera"):(this.attached[__uv.$wrap((i))]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedElement&&t.attachControl(this.attachedElement))},t.prototype.remove=function(e){for(var t in this.attached){var i=this.attached[__uv.$wrap((t))];i===e&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[__uv.$wrap((t))],this.rebuildInputCheck())}},t.prototype.removeByType=function(e){for(var t in this.attached){var i=this.attached[__uv.$wrap((t))];i.getClassName()===e&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[__uv.$wrap((t))],this.rebuildInputCheck())}},t.prototype._addCheckInputs=function(e){var t=this.checkInputs;return function(){t(),e()}},t.prototype.attachInput=function(e){this.attachedElement&&e.attachControl(this.attachedElement,this.noPreventDefault)},t.prototype.attachElement=function(t,i){if(void 0===i&&(i=!1),!this.attachedElement)for(var r in i=!e.Camera.ForceAttachControlToAlwaysPreventDefault&&i,this.attachedElement=t,this.noPreventDefault=i,this.attached)this.attached[__uv.$wrap((r))].attachControl(t,i)},t.prototype.detachElement=function(e,t){if(void 0===t&&(t=!1),this.attachedElement===e){for(var i in this.attached)this.attached[__uv.$wrap((i))].detachControl(e),t&&(this.attached[__uv.$wrap((i))].camera=null);this.attachedElement=null}},t.prototype.rebuildInputCheck=function(){for(var e in this.checkInputs=function(){},this.attached){var t=this.attached[__uv.$wrap((e))];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}},t.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},t.prototype.serialize=function(t){var i={};for(var r in this.attached){var n=this.attached[__uv.$wrap((r))],a=e.SerializationHelper.Serialize(n);i[__uv.$wrap((n.getClassName()))]=a}t.inputsmgr=i},t.prototype.parse=function(t){var i=t.inputsmgr;if(i)for(var r in this.clear(),i){if(o=e.CameraInputTypes[__uv.$wrap((r))]){var n=i[__uv.$wrap((r))],a=e.SerializationHelper.Parse((function(){return new o}),n,null);this.add(a)}}else for(var r in this.attached){var o;if(o=e.CameraInputTypes[__uv.$wrap((this.attached[__uv.$wrap((r))].getClassName()))]){a=e.SerializationHelper.Parse((function(){return new o}),t,null);this.remove(this.attached[__uv.$wrap((r))]),this.add(a)}}},t}();e.CameraInputsManager=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){void 0===a&&(a=!0);var o=t.call(this,i,r,n,a)||this;return o.cameraDirection=new e.Vector3(0,0,0),o.cameraRotation=new e.Vector2(0,0),o.rotation=new e.Vector3(0,0,0),o.speed=2,o.noRotationConstraint=!1,o.lockedTarget=null,o._currentTarget=e.Vector3.Zero(),o._viewMatrix=e.Matrix.Zero(),o._camMatrix=e.Matrix.Zero(),o._cameraTransformMatrix=e.Matrix.Zero(),o._cameraRotationMatrix=e.Matrix.Zero(),o._referencePoint=new e.Vector3(0,0,1),o._transformedReferencePoint=e.Vector3.Zero(),o._globalCurrentTarget=e.Vector3.Zero(),o._globalCurrentUpVector=e.Vector3.Zero(),o._defaultUp=e.Vector3.Up(),o._cachedRotationZ=0,o._cachedQuaternionRotationZ=0,o}return a(i,t),i.prototype.getFrontPosition=function(e){this.getWorldMatrix();var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)},i.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},i.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),t.prototype.storeState.call(this)},i.prototype._restoreStateValues=function(){return!!t.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new e.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},i.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},i.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},i.prototype.setTarget=function(t){this.upVector.normalize(),this.position.z===t.z&&(this.position.z+=e.Epsilon),e.Matrix.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[__uv.$wrap((6))]/this._camMatrix.m[__uv.$wrap((10))]);var i=t.subtract(this.position);i.x>=0?this.rotation.y=-Math.atan(i.z/i.x)+Math.PI/2:this.rotation.y=-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&e.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},i.prototype.getTarget=function(){return this._currentTarget},i.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){if(this.__uv$setSource(__uv).__uv$parent)return this.__uv$setSource(__uv).__uv$parent.getWorldMatrix().invertToRef(e.Tmp.Matrix[__uv.$wrap((0))]),e.Vector3.TransformNormalToRef(this.cameraDirection,e.Tmp.Matrix[__uv.$wrap((0))],e.Tmp.Vector3[__uv.$wrap((0))]),void this.position.addInPlace(e.Tmp.Vector3[__uv.$wrap((0))]);this.position.addInPlace(this.cameraDirection)},i.prototype._checkInputs=function(){var i=this._decideIfNeedsToMove(),r=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),r){if(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion)this.rotation.lengthSquared()&&e.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion);if(!this.noRotationConstraint){var n=Math.PI/2*.95;this.rotation.x>n&&(this.rotation.x=n),this.rotation.x<-n&&(this.rotation.x=-n)}}i&&(Math.abs(this.cameraDirection.x)<this.speed*e.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*e.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*e.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),r&&(Math.abs(this.cameraRotation.x)<this.speed*e.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*e.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),t.prototype._checkInputs.call(this)},i.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},i.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return e.Vector3.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},i.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},i.prototype._computeViewMatrix=function(t,i,r){if(this.__uv$setSource(__uv).__uv$parent){var n=this.__uv$setSource(__uv).__uv$parent.getWorldMatrix();e.Vector3.TransformCoordinatesToRef(t,n,this._globalPosition),e.Vector3.TransformCoordinatesToRef(i,n,this._globalCurrentTarget),e.Vector3.TransformNormalToRef(r,n,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._globalCurrentTarget.copyFrom(i),this._globalCurrentUpVector.copyFrom(r);this.getScene().useRightHandedSystem?e.Matrix.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):e.Matrix.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},i.prototype.createRigCamera=function(t,r){if(this.cameraRigMode!==e.Camera.RIG_MODE_NONE){var n=new i(t,this.position.clone(),this.getScene());return this.cameraRigMode!==e.Camera.RIG_MODE_VR&&this.cameraRigMode!==e.Camera.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new e.Quaternion),n._cameraRigParams={},n.rotationQuaternion=new e.Quaternion),n}return null},i.prototype._updateRigCameras=function(){var i=this._rigCameras[__uv.$wrap((0))],r=this._rigCameras[__uv.$wrap((1))];switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var n=this.cameraRigMode===e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,a=this.cameraRigMode===e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*n,i.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*a,r.position),i.setTarget(this.getTarget()),r.setTarget(this.getTarget());break;case e.Camera.RIG_MODE_VR:i.rotationQuaternion?(i.rotationQuaternion.copyFrom(this.rotationQuaternion),r.rotationQuaternion.copyFrom(this.rotationQuaternion)):(i.rotation.copyFrom(this.rotation),r.rotation.copyFrom(this.rotation)),i.position.copyFrom(this.position),r.position.copyFrom(this.position)}t.prototype._updateRigCameras.call(this)},i.prototype._getRigCamPosition=function(t,i){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new e.Matrix);var r=this.getTarget();e.Matrix.Translation(-r.x,-r.y,-r.z).multiplyToRef(e.Matrix.RotationY(t),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(e.Matrix.Translation(r.x,r.y,r.z)),e.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,i)},i.prototype.getClassName=function(){return"TargetCamera"},n([e.serializeAsVector3()],i.prototype,"rotation",void 0),n([e.serialize()],i.prototype,"speed",void 0),n([e.serializeAsMeshReference("lockedTargetId")],i.prototype,"lockedTarget",void 0),i}(e.Camera);e.TargetCamera=t}(s||(s={})),function(e){var t=function(){function t(e){void 0===e&&(e=!0),this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null}return t.prototype.attachControl=function(t,i){var r=this,n=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(a,o){var s=a.event;if(!n.isInVRExclusivePointerMode&&(r.touchEnabled||"touch"!==s.pointerType)&&(a.type===e.PointerEventTypes.POINTERMOVE||-1!==r.buttons.indexOf(s.button))){var l=s.srcElement||s.target;if(a.type===e.PointerEventTypes.POINTERDOWN&&l){try{l.setPointerCapture(s.pointerId)}catch(e){}r.previousPosition={x:s.clientX,y:s.clientY},i||(s.preventDefault(),t.focus())}else if(a.type===e.PointerEventTypes.POINTERUP&&l){try{l.releasePointerCapture(s.pointerId)}catch(e){}r.previousPosition=null,i||s.preventDefault()}else if(a.type===e.PointerEventTypes.POINTERMOVE){if(!r.previousPosition||n.isPointerLock)return;var c=s.clientX-r.previousPosition.x;r.camera.getScene().useRightHandedSystem&&(c*=-1),r.camera.__uv$setSource(__uv).__uv$parent&&r.camera.__uv$setSource(__uv).__uv$parent._getWorldMatrixDeterminant()<0&&(c*=-1),r.camera.cameraRotation.y+=c/r.angularSensibility;var u=s.clientY-r.previousPosition.y;r.camera.cameraRotation.x+=u/r.angularSensibility,r.previousPosition={x:s.clientX,y:s.clientY},i||s.preventDefault()}}}),this._onMouseMove=function(e){if(n.isPointerLock&&!n.isInVRExclusivePointerMode){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0;r.camera.getScene().useRightHandedSystem&&(t*=-1),r.camera.__uv$setSource(__uv).__uv$parent&&r.camera.__uv$setSource(__uv).__uv$parent._getWorldMatrixDeterminant()<0&&(t*=-1),r.camera.cameraRotation.y+=t/r.angularSensibility;var a=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;r.camera.cameraRotation.x+=a/r.angularSensibility,r.previousPosition=null,i||e.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE),t.addEventListener("mousemove",this._onMouseMove,!1)},t.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&e.removeEventListener("mousemove",this._onMouseMove),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},t.prototype.getClassName=function(){return"FreeCameraMouseInput"},t.prototype.getSimpleName=function(){return"mouse"},n([e.serialize()],t.prototype,"buttons",void 0),n([e.serialize()],t.prototype,"angularSensibility",void 0),t}();e.FreeCameraMouseInput=t,e.CameraInputTypes.FreeCameraMouseInput=t}(s||(s={})),function(e){var t=function(){function t(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return t.prototype.attachControl=function(t,i){var r=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){r._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(t){var n,a=t.event;t.type===e.KeyboardEventTypes.KEYDOWN?-1===r.keysUp.indexOf(a.keyCode)&&-1===r.keysDown.indexOf(a.keyCode)&&-1===r.keysLeft.indexOf(a.keyCode)&&-1===r.keysRight.indexOf(a.keyCode)||(-1===(n=r._keys.indexOf(a.keyCode))&&r._keys.push(a.keyCode),i||a.preventDefault()):-1===r.keysUp.indexOf(a.keyCode)&&-1===r.keysDown.indexOf(a.keyCode)&&-1===r.keysLeft.indexOf(a.keyCode)&&-1===r.keysRight.indexOf(a.keyCode)||((n=r._keys.indexOf(a.keyCode))>=0&&r._keys.splice(n,1),i||a.preventDefault())})))},t.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,i=0;i<this._keys.length;i++){var r=this._keys[__uv.$wrap((i))],n=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(r)?t._localDirection.copyFromFloats(-n,0,0):-1!==this.keysUp.indexOf(r)?t._localDirection.copyFromFloats(0,0,n):-1!==this.keysRight.indexOf(r)?t._localDirection.copyFromFloats(n,0,0):-1!==this.keysDown.indexOf(r)&&t._localDirection.copyFromFloats(0,0,-n),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),e.Vector3.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},t.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},t.prototype._onLostFocus=function(e){this._keys=[]},t.prototype.getSimpleName=function(){return"keyboard"},n([e.serialize()],t.prototype,"keysUp",void 0),n([e.serialize()],t.prototype,"keysDown",void 0),n([e.serialize()],t.prototype,"keysLeft",void 0),n([e.serialize()],t.prototype,"keysRight",void 0),t}();e.FreeCameraKeyboardMoveInput=t,e.CameraInputTypes.FreeCameraKeyboardMoveInput=t}(s||(s={})),function(e){var t=function(t){function i(e){return t.call(this,e)||this}return a(i,t),i.prototype.addKeyboard=function(){return this.add(new e.FreeCameraKeyboardMoveInput),this},i.prototype.addMouse=function(t){return void 0===t&&(t=!0),this.add(new e.FreeCameraMouseInput(t)),this},i.prototype.addDeviceOrientation=function(){return this.add(new e.FreeCameraDeviceOrientationInput),this},i.prototype.addTouch=function(){return this.add(new e.FreeCameraTouchInput),this},i.prototype.addVirtualJoystick=function(){return this.add(new e.FreeCameraVirtualJoystickInput),this},i}(e.CameraInputsManager);e.FreeCameraInputsManager=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("FreeCamera",(function(t,i){return function(){return new e.UniversalCamera(t,e.Vector3.Zero(),i)}}));var t=function(t){function i(i,r,n,a){void 0===a&&(a=!0);var o=t.call(this,i,r,n,a)||this;return o.ellipsoid=new e.Vector3(.5,1,.5),o.ellipsoidOffset=new e.Vector3(0,0,0),o.checkCollisions=!1,o.applyGravity=!1,o._needMoveForGravity=!1,o._oldPosition=e.Vector3.Zero(),o._diffPosition=e.Vector3.Zero(),o._newPosition=e.Vector3.Zero(),o._collisionMask=-1,o._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider._radius);var n;n=i,o._newPosition.copyFrom(n),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o._diffPosition.length()>e.Engine.CollisionsEpsilon&&(o.position.addInPlace(o._diffPosition),o.onCollide&&r&&o.onCollide(r))},o.inputs=new e.FreeCameraInputsManager(o),o.inputs.addKeyboard().addMouse(),o}return a(i,t),Object.defineProperty(i.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),i.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},i.prototype.detachControl=function(t){this.inputs.detachElement(t),this.cameraDirection=new e.Vector3(0,0,0),this.cameraRotation=new e.Vector2(0,0)},Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),i.prototype._collideWithWorld=function(t){(this.__uv$setSource(__uv).__uv$parent?e.Vector3.TransformCoordinates(this.position,this.__uv$setSource(__uv).__uv$parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset),this._collider||(this._collider=new e.Collider),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var i=t;this.applyGravity&&(i=t.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,i,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},i.prototype._checkInputs=function(){this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero()),this.inputs.checkInputs(),t.prototype._checkInputs.call(this)},i.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):t.prototype._updatePosition.call(this)},i.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},i.prototype.getClassName=function(){return"FreeCamera"},n([e.serializeAsVector3()],i.prototype,"ellipsoid",void 0),n([e.serializeAsVector3()],i.prototype,"ellipsoidOffset",void 0),n([e.serialize()],i.prototype,"checkCollisions",void 0),n([e.serialize()],i.prototype,"applyGravity",void 0),i}(e.TargetCamera);e.FreeCamera=t}(s||(s={})),function(e){var t=function(){function t(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return t.prototype.attachControl=function(t,i){var r=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){r._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(t){var n,a=t.event;t.type===e.KeyboardEventTypes.KEYDOWN?(r._ctrlPressed=a.ctrlKey,r._altPressed=a.altKey,(-1!==r.keysUp.indexOf(a.keyCode)||-1!==r.keysDown.indexOf(a.keyCode)||-1!==r.keysLeft.indexOf(a.keyCode)||-1!==r.keysRight.indexOf(a.keyCode)||-1!==r.keysReset.indexOf(a.keyCode))&&(-1===(n=r._keys.indexOf(a.keyCode))&&r._keys.push(a.keyCode),a.preventDefault&&(i||a.preventDefault()))):-1===r.keysUp.indexOf(a.keyCode)&&-1===r.keysDown.indexOf(a.keyCode)&&-1===r.keysLeft.indexOf(a.keyCode)&&-1===r.keysRight.indexOf(a.keyCode)&&-1===r.keysReset.indexOf(a.keyCode)||((n=r._keys.indexOf(a.keyCode))>=0&&r._keys.splice(n,1),a.preventDefault&&(i||a.preventDefault()))})))},t.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[__uv.$wrap((t))];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}},t.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},t.prototype.getSimpleName=function(){return"keyboard"},n([e.serialize()],t.prototype,"keysUp",void 0),n([e.serialize()],t.prototype,"keysDown",void 0),n([e.serialize()],t.prototype,"keysLeft",void 0),n([e.serialize()],t.prototype,"keysRight",void 0),n([e.serialize()],t.prototype,"keysReset",void 0),n([e.serialize()],t.prototype,"panningSensibility",void 0),n([e.serialize()],t.prototype,"zoomingSensibility",void 0),n([e.serialize()],t.prototype,"useAltToZoom",void 0),n([e.serialize()],t.prototype,"angularSpeed",void 0),t}();e.ArcRotateCameraKeyboardMoveInput=t,e.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=t}(s||(s={})),function(e){var t=function(){function t(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return t.prototype.attachControl=function(t,i){var r=this;this._wheel=function(t,n){if(t.type===e.PointerEventTypes.POINTERWHEEL){var a=t.event,o=0;if(a.wheelDelta)if(r.wheelDeltaPercentage){var s=.01*a.wheelDelta*r.wheelDeltaPercentage*r.camera.radius;o=a.wheelDelta>0?s/(1+r.wheelDeltaPercentage):s*(1+r.wheelDeltaPercentage)}else o=a.wheelDelta/(40*r.wheelPrecision);else a.detail&&(o=-a.detail/r.wheelPrecision);o&&(r.camera.inertialRadiusOffset+=o),a.preventDefault&&(i||a.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,e.PointerEventTypes.POINTERWHEEL)},t.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},t.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},t.prototype.getSimpleName=function(){return"mousewheel"},n([e.serialize()],t.prototype,"wheelPrecision",void 0),n([e.serialize()],t.prototype,"wheelDeltaPercentage",void 0),t}();e.ArcRotateCameraMouseWheelInput=t,e.CameraInputTypes.ArcRotateCameraMouseWheelInput=t}(s||(s={})),function(e){var t=function(){function t(){this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1}return t.prototype.attachControl=function(t,i){var r,n=this,a=this.camera.getEngine(),o=null,s=null,l=0,c=0,u=0,h={x:0,y:0,isPaning:!1,isPinching:!1};this._pointerInput=function(d,p){var m=d.event,_="touch"===d.event.pointerType;if(!a.isInVRExclusivePointerMode&&(d.type===e.PointerEventTypes.POINTERMOVE||-1!==n.buttons.indexOf(m.button))){var f=m.srcElement||m.target;if(d.type===e.PointerEventTypes.POINTERDOWN&&f){try{f.setPointerCapture(m.pointerId)}catch(e){}n._isPanClick=m.button===n.camera._panningMouseButton,r={x:m.clientX,y:m.clientY,pointerId:m.pointerId,type:m.pointerType},null===o?o=r:null===s&&(s=r),i||(m.preventDefault(),t.focus())}else if(d.type===e.PointerEventTypes.POINTERDOUBLETAP)n.camera.useInputToRestoreState&&n.camera.restoreState();else if(d.type===e.PointerEventTypes.POINTERUP&&f){try{f.releasePointerCapture(m.pointerId)}catch(e){}r=null,l=0,h.isPaning=!1,h.isPinching=!1,u=0,c=0,_||(s=null),a._badOS?o=s=null:s&&o&&o.pointerId==m.pointerId?(o=s,s=null,r={x:o.x,y:o.y,pointerId:o.pointerId,type:m.pointerType}):o&&s&&s.pointerId==m.pointerId?(s=null,r={x:o.x,y:o.y,pointerId:o.pointerId,type:m.pointerType}):o=s=null,i||m.preventDefault()}else if(d.type===e.PointerEventTypes.POINTERMOVE)if(i||m.preventDefault(),o&&null===s&&r){if(0!==n.panningSensibility&&(m.ctrlKey&&n.camera._useCtrlForPanning||n._isPanClick))n.camera.inertialPanningX+=-(m.clientX-r.x)/n.panningSensibility,n.camera.inertialPanningY+=(m.clientY-r.y)/n.panningSensibility;else{var g=m.clientX-r.x,y=m.clientY-r.y;n.camera.inertialAlphaOffset-=g/n.angularSensibilityX,n.camera.inertialBetaOffset-=y/n.angularSensibilityY}r.x=m.clientX,r.y=m.clientY}else if(o&&s){var v=o.pointerId===m.pointerId?o:s;v.x=m.clientX,v.y=m.clientY;var b=n.pinchInwards?1:-1,x=o.x-s.x,S=o.y-s.y,T=x*x+S*S,E=Math.sqrt(T);if(0===l)return c=E,l=T,h.x=(o.x+s.x)/2,void(h.y=(o.y+s.y)/2);if(n.multiTouchPanAndZoom){if(n.pinchDeltaPercentage?n.camera.inertialRadiusOffset+=.001*(T-l)*n.camera.radius*n.pinchDeltaPercentage:n.camera.inertialRadiusOffset+=(T-l)/(n.pinchPrecision*((n.angularSensibilityX+n.angularSensibilityY)/2)*b),0!==n.panningSensibility){var P=(o.x+s.x)/2,A=(o.y+s.y)/2,M=P-h.x,C=A-h.y;h.x=P,h.y=A,n.camera.inertialPanningX+=-M/n.panningSensibility,n.camera.inertialPanningY+=C/n.panningSensibility}}else{if(u++,h.isPinching||u<20&&Math.abs(E-c)>n.camera.pinchToPanMaxDistance)n.pinchDeltaPercentage?n.camera.inertialRadiusOffset+=.001*(T-l)*n.camera.radius*n.pinchDeltaPercentage:n.camera.inertialRadiusOffset+=(T-l)/(n.pinchPrecision*((n.angularSensibilityX+n.angularSensibilityY)/2)*b),h.isPaning=!1,h.isPinching=!0;else if(r&&r.pointerId===v.pointerId&&0!==n.panningSensibility&&n.multiTouchPanning){if(!h.isPaning)return h.isPaning=!0,h.isPinching=!1,h.x=v.x,void(h.y=v.y);n.camera.inertialPanningX+=-(v.x-h.x)/n.panningSensibility,n.camera.inertialPanningY+=(v.y-h.y)/n.panningSensibility}r&&r.pointerId===m.pointerId&&(h.x=v.x,h.y=v.y)}l=T}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE|e.PointerEventTypes.POINTERDOUBLETAP),this._onContextMenu=function(e){e.preventDefault()},this.camera._useCtrlForPanning||t.addEventListener("contextmenu",this._onContextMenu,!1),this._onLostFocus=function(){o=s=null,l=0,h.isPaning=!1,h.isPinching=!1,u=0,r=null,c=0},this._onMouseMove=function(e){if(a.isPointerLock){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;n.camera.inertialAlphaOffset-=t/n.angularSensibilityX,n.camera.inertialBetaOffset-=r/n.angularSensibilityY,i||e.preventDefault()}},this._onGestureStart=function(e){void 0!==window.MSGesture&&(n._MSGestureHandler||(n._MSGestureHandler=new MSGesture,n._MSGestureHandler.target=t),n._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(e){n.camera.radius*=e.scale,e.preventDefault&&(i||(e.stopPropagation(),e.preventDefault()))},t.addEventListener("mousemove",this._onMouseMove,!1),t.addEventListener("MSPointerDown",this._onGestureStart,!1),t.addEventListener("MSGestureChange",this._onGesture,!1),e.Tools.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},t.prototype.detachControl=function(t){this._onLostFocus&&e.Tools.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),t&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._onContextMenu&&t.removeEventListener("contextmenu",this._onContextMenu),this._onMouseMove&&t.removeEventListener("mousemove",this._onMouseMove),this._onGestureStart&&t.removeEventListener("MSPointerDown",this._onGestureStart),this._onGesture&&t.removeEventListener("MSGestureChange",this._onGesture),this._isPanClick=!1,this.pinchInwards=!0,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null)},t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.getSimpleName=function(){return"pointers"},n([e.serialize()],t.prototype,"buttons",void 0),n([e.serialize()],t.prototype,"angularSensibilityX",void 0),n([e.serialize()],t.prototype,"angularSensibilityY",void 0),n([e.serialize()],t.prototype,"pinchPrecision",void 0),n([e.serialize()],t.prototype,"pinchDeltaPercentage",void 0),n([e.serialize()],t.prototype,"panningSensibility",void 0),n([e.serialize()],t.prototype,"multiTouchPanning",void 0),n([e.serialize()],t.prototype,"multiTouchPanAndZoom",void 0),t}();e.ArcRotateCameraPointersInput=t,e.CameraInputTypes.ArcRotateCameraPointersInput=t}(s||(s={})),function(e){var t=function(t){function i(e){return t.call(this,e)||this}return a(i,t),i.prototype.addMouseWheel=function(){return this.add(new e.ArcRotateCameraMouseWheelInput),this},i.prototype.addPointers=function(){return this.add(new e.ArcRotateCameraPointersInput),this},i.prototype.addKeyboard=function(){return this.add(new e.ArcRotateCameraKeyboardMoveInput),this},i.prototype.addVRDeviceOrientation=function(){return this.add(new e.ArcRotateCameraVRDeviceOrientationInput),this},i}(e.CameraInputsManager);e.ArcRotateCameraInputsManager=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("ArcRotateCamera",(function(i,r){return function(){return new t(i,0,0,1,e.Vector3.Zero(),r)}}));var t=function(t){function i(i,r,n,a,o,s,l){void 0===l&&(l=!0);var c=t.call(this,i,e.Vector3.Zero(),s,l)||this;return c.inertialAlphaOffset=0,c.inertialBetaOffset=0,c.inertialRadiusOffset=0,c.lowerAlphaLimit=null,c.upperAlphaLimit=null,c.lowerBetaLimit=.01,c.upperBetaLimit=Math.PI,c.lowerRadiusLimit=null,c.upperRadiusLimit=null,c.inertialPanningX=0,c.inertialPanningY=0,c.pinchToPanMaxDistance=20,c.panningDistanceLimit=null,c.panningOriginTarget=e.Vector3.Zero(),c.panningInertia=.9,c.zoomOnFactor=1,c.targetScreenOffset=e.Vector2.Zero(),c.allowUpsideDown=!0,c.useInputToRestoreState=!0,c._viewMatrix=new e.Matrix,c.panningAxis=new e.Vector3(1,1,0),c.onMeshTargetChangedObservable=new e.Observable,c.checkCollisions=!1,c.collisionRadius=new e.Vector3(.5,.5,.5),c._previousPosition=e.Vector3.Zero(),c._collisionVelocity=e.Vector3.Zero(),c._newPosition=e.Vector3.Zero(),c._computationVector=e.Vector3.Zero(),c._onCollisionPositionChange=function(e,t,i){void 0===i&&(i=null),c.getScene().workerCollisions&&c.checkCollisions&&t.multiplyInPlace(c._collider._radius),i?(c.setPosition(t),c.onCollide&&c.onCollide(i)):c._previousPosition.copyFrom(c.position);var r=Math.cos(c.alpha),n=Math.sin(c.alpha),a=Math.cos(c.beta),o=Math.sin(c.beta);0===o&&(o=1e-4);var s=c._getTargetPosition();c._computationVector.copyFromFloats(c.radius*r*o,c.radius*a,c.radius*n*o),s.addToRef(c._computationVector,c._newPosition),c.position.copyFrom(c._newPosition);var l=c.upVector;c.allowUpsideDown&&c.beta<0&&(l=(l=l.clone()).negate()),c._computeViewMatrix(c.position,s,l),c._viewMatrix.m[__uv.$wrap((12))]+=c.targetScreenOffset.x,c._viewMatrix.m[__uv.$wrap((13))]+=c.targetScreenOffset.y,c._collisionTriggered=!1},c._target=e.Vector3.Zero(),o&&c.setTarget(o),c.alpha=r,c.beta=n,c.radius=a,c.getViewMatrix(),c.inputs=new e.ArcRotateCameraInputsManager(c),c.inputs.addKeyboard().addMouseWheel().addPointers(),c}return a(i,t),Object.defineProperty(i.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new e.BouncingBehavior,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new e.FramingBehavior,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new e.AutoRotationBehavior,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache._target=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=e.Vector2.Zero()},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},i.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var t=this._getLockedTargetPosition();return t||this._target},i.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),t.prototype.storeState.call(this)},i.prototype._restoreStateValues=function(){return!!t.prototype._restoreStateValues.call(this)&&(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},i.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},i.prototype.attachControl=function(e,t,i,r){var n=this;void 0===i&&(i=!0),void 0===r&&(r=2),this._useCtrlForPanning=i,this._panningMouseButton=r,this.inputs.attachElement(e,t),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0,n.inertialPanningX=0,n.inertialPanningY=0}},i.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},i.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var i=this.inertialAlphaOffset;this.beta<=0&&(i*=-1),this.getScene().useRightHandedSystem&&(i*=-1),this.__uv$setSource(__uv).__uv$parent&&this.__uv$setSource(__uv).__uv$parent._getWorldMatrixDeterminant()<0&&(i*=-1),this.alpha+=i,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*e.Epsilon&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){if(this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),e.Vector3.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*e.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*e.Epsilon&&(this.inertialPanningY=0)}this._checkLimits(),t.prototype._checkInputs.call(this)}},i.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},i.prototype.rebuildAnglesAndRadius=function(){this.position.subtractToRef(this._getTargetPosition(),this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},i.prototype.setPosition=function(e){this.position.equals(e)||(this.position.copyFrom(e),this.rebuildAnglesAndRadius())},i.prototype.setTarget=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),e.getBoundingInfo)this._targetBoundingCenter=t?e.getBoundingInfo().boundingBox.centerWorld.clone():null,this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var r=e,n=this._getTargetPosition();if(n&&!i&&n.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},i.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),i=Math.sin(this.alpha),r=Math.cos(this.beta),n=Math.sin(this.beta);0===n&&(n=1e-4);var a=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*n,this.radius*r,this.radius*i*n),a.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider||(this._collider=new e.Collider),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var o=this.upVector;this.allowUpsideDown&&n<0&&(o=(o=o.clone()).negate()),this._computeViewMatrix(this.position,a,o),this._viewMatrix.m[__uv.$wrap((12))]+=this.targetScreenOffset.x,this._viewMatrix.m[__uv.$wrap((13))]+=this.targetScreenOffset.y}return this._currentTarget=a,this._viewMatrix},i.prototype.zoomOn=function(t,i){void 0===i&&(i=!1),t=t||this.getScene().meshes;var r=e.Mesh.MinMax(t),n=e.Vector3.Distance(r.min,r.max);this.radius=n*this.zoomOnFactor,this.focusOn({min:r.min,max:r.max,distance:n},i)},i.prototype.focusOn=function(t,i){var r,n;if(void 0===i&&(i=!1),void 0===t.min){var a=t||this.getScene().meshes;r=e.Mesh.MinMax(a),n=e.Vector3.Distance(r.min,r.max)}else{r=t,n=t.distance}this._target=e.Mesh.Center(r),i||(this.maxZ=2*n)},i.prototype.createRigCamera=function(t,r){var n=0;switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(0===r?1:-1);break;case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(0===r?-1:1)}var a=new i(t,this.alpha+n,this.beta,this.radius,this._target,this.getScene());return a._cameraRigParams={},a},i.prototype._updateRigCameras=function(){var i=this._rigCameras[__uv.$wrap((0))],r=this._rigCameras[__uv.$wrap((1))];switch(i.beta=r.beta=this.beta,i.radius=r.radius=this.radius,this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}t.prototype._updateRigCameras.call(this)},i.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},i.prototype.getClassName=function(){return"ArcRotateCamera"},n([e.serialize()],i.prototype,"alpha",void 0),n([e.serialize()],i.prototype,"beta",void 0),n([e.serialize()],i.prototype,"radius",void 0),n([e.serializeAsVector3("target")],i.prototype,"_target",void 0),n([e.serialize()],i.prototype,"inertialAlphaOffset",void 0),n([e.serialize()],i.prototype,"inertialBetaOffset",void 0),n([e.serialize()],i.prototype,"inertialRadiusOffset",void 0),n([e.serialize()],i.prototype,"lowerAlphaLimit",void 0),n([e.serialize()],i.prototype,"upperAlphaLimit",void 0),n([e.serialize()],i.prototype,"lowerBetaLimit",void 0),n([e.serialize()],i.prototype,"upperBetaLimit",void 0),n([e.serialize()],i.prototype,"lowerRadiusLimit",void 0),n([e.serialize()],i.prototype,"upperRadiusLimit",void 0),n([e.serialize()],i.prototype,"inertialPanningX",void 0),n([e.serialize()],i.prototype,"inertialPanningY",void 0),n([e.serialize()],i.prototype,"pinchToPanMaxDistance",void 0),n([e.serialize()],i.prototype,"panningDistanceLimit",void 0),n([e.serializeAsVector3()],i.prototype,"panningOriginTarget",void 0),n([e.serialize()],i.prototype,"panningInertia",void 0),n([e.serialize()],i.prototype,"zoomOnFactor",void 0),n([e.serialize()],i.prototype,"targetScreenOffset",void 0),n([e.serialize()],i.prototype,"allowUpsideDown",void 0),n([e.serialize()],i.prototype,"useInputToRestoreState",void 0),i}(e.TargetCamera);e.ArcRotateCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("Light_Type_3",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(t){function i(i,r,n){var a=t.call(this,i,n)||this;return a.groundColor=new e.Color3(0,0,0),a.direction=r||e.Vector3.Up(),a}return a(i,t),i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.getClassName=function(){return"HemisphericLight"},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(e.Vector3.Zero())),this.direction},i.prototype.getShadowGenerator=function(){return null},i.prototype.transferToEffect=function(t,i){var r=e.Vector3.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",r.x,r.y,r.z,0,i),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),i),this},i.prototype.computeWorldMatrix=function(t,i){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},i.prototype.getTypeID=function(){return e.Light.LIGHTTYPEID_HEMISPHERICLIGHT},i.prototype.prepareLightSpecificDefines=function(e,t){e[__uv.$wrap(("HEMILIGHT"+t))]=!0},n([e.serializeAsColor3()],i.prototype,"groundColor",void 0),n([e.serializeAsVector3()],i.prototype,"direction",void 0),i}(e.Light);e.HemisphericLight=t}(s||(s={})),function(e){var t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._needProjectionMatrixCompute=!0,e}return a(i,t),i.prototype._setPosition=function(e){this._position=e},Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!0,configurable:!0}),i.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),i.prototype.computeTransformedInformation=function(){return!(!this.__uv$setSource(__uv).__uv$parent||!this.__uv$setSource(__uv).__uv$parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.__uv$setSource(__uv).__uv$parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=e.Vector3.Zero()),e.Vector3.TransformNormalToRef(this.direction,this.__uv$setSource(__uv).__uv$parent.getWorldMatrix(),this.transformedDirection)),!0)},i.prototype.getDepthScale=function(){return 50},i.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.getRotation=function(){this.direction.normalize();var t=e.Vector3.Cross(this.direction,e.Axis.Y),i=e.Vector3.Cross(t,this.direction);return e.Vector3.RotationFromAxis(t,i,this.direction)},i.prototype.needCube=function(){return!1},i.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},i.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.position=e.Vector3.Zero()},i.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},i.prototype.computeWorldMatrix=function(t){return!t&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.__uv$setSource(__uv).__uv$parent&&this.__uv$setSource(__uv).__uv$parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.__uv$setSource(__uv).__uv$parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix)},i.prototype.getDepthMinZ=function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ},i.prototype.getDepthMaxZ=function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ},i.prototype.setShadowProjectionMatrix=function(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this},n([e.serializeAsVector3()],i.prototype,"position",null),n([e.serializeAsVector3()],i.prototype,"direction",null),n([e.serialize()],i.prototype,"shadowMinZ",null),n([e.serialize()],i.prototype,"shadowMaxZ",null),i}(e.Light);e.ShadowLight=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("Light_Type_0",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(t){function i(e,i,r){var n=t.call(this,e,r)||this;return n._shadowAngle=Math.PI/2,n.position=i,n}return a(i,t),Object.defineProperty(i.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"PointLight"},i.prototype.getTypeID=function(){return e.Light.LIGHTTYPEID_POINTLIGHT},i.prototype.needCube=function(){return!this.direction},i.prototype.getShadowDirection=function(i){if(this.direction)return t.prototype.getShadowDirection.call(this,i);switch(i){case 0:return new e.Vector3(1,0,0);case 1:return new e.Vector3(-1,0,0);case 2:return new e.Vector3(0,-1,0);case 3:return new e.Vector3(0,1,0);case 4:return new e.Vector3(0,0,1);case 5:return new e.Vector3(0,0,-1)}return e.Vector3.Zero()},i.prototype._setDefaultShadowProjectionMatrix=function(t,i,r){var n=this.getScene().activeCamera;n&&e.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(n),this.getDepthMaxZ(n),t)},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this},i.prototype.prepareLightSpecificDefines=function(e,t){e[__uv.$wrap(("POINTLIGHT"+t))]=!0},n([e.serialize()],i.prototype,"shadowAngle",null),i}(e.ShadowLight);e.PointLight=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("Light_Type_1",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(t){function i(e,i,r){var n=t.call(this,e,r)||this;return n._shadowFrustumSize=0,n._shadowOrthoScale=.1,n.autoUpdateExtends=!0,n._orthoLeft=Number.MAX_VALUE,n._orthoRight=Number.MIN_VALUE,n._orthoTop=Number.MIN_VALUE,n._orthoBottom=Number.MAX_VALUE,n.position=i.scale(-1),n.direction=i,n}return a(i,t),Object.defineProperty(i.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"DirectionalLight"},i.prototype.getTypeID=function(){return e.Light.LIGHTTYPEID_DIRECTIONALLIGHT},i.prototype._setDefaultShadowProjectionMatrix=function(e,t,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e,t):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,i)},i.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(t,i){var r=this.getScene().activeCamera;r&&e.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,t)},i.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(t,i,r){var n=this.getScene().activeCamera;if(n){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var a=e.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var o=0;o<r.length;o++){var s=r[__uv.$wrap((o))];if(s)for(var l=s.getBoundingInfo().boundingBox,c=0;c<l.vectorsWorld.length;c++)e.Vector3.TransformCoordinatesToRef(l.vectorsWorld[__uv.$wrap((c))],i,a),a.x<this._orthoLeft&&(this._orthoLeft=a.x),a.y<this._orthoBottom&&(this._orthoBottom=a.y),a.x>this._orthoRight&&(this._orthoRight=a.x),a.y>this._orthoTop&&(this._orthoTop=a.y)}}var u=this._orthoRight-this._orthoLeft,h=this._orthoTop-this._orthoBottom;e.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-u*this.shadowOrthoScale,this._orthoRight+u*this.shadowOrthoScale,this._orthoBottom-h*this.shadowOrthoScale,this._orthoTop+h*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:n.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,t)}},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)},i.prototype.getDepthMinZ=function(e){return 1},i.prototype.getDepthMaxZ=function(e){return 1},i.prototype.prepareLightSpecificDefines=function(e,t){e[__uv.$wrap(("DIRLIGHT"+t))]=!0},n([e.serialize()],i.prototype,"shadowFrustumSize",null),n([e.serialize()],i.prototype,"shadowOrthoScale",null),n([e.serialize()],i.prototype,"autoUpdateExtends",void 0),i}(e.ShadowLight);e.DirectionalLight=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("Light_Type_2",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),e.Vector3.Zero(),0,0,r)}}));var t=function(t){function i(i,r,n,a,o,s){var l=t.call(this,i,s)||this;return l._innerAngle=0,l._projectionTextureMatrix=e.Matrix.Zero(),l._projectionTextureLightNear=1e-6,l._projectionTextureLightFar=1e3,l._projectionTextureUpDirection=e.Vector3.Up(),l._projectionTextureViewLightDirty=!0,l._projectionTextureProjectionLightDirty=!0,l._projectionTextureDirty=!0,l._projectionTextureViewTargetVector=e.Vector3.Zero(),l._projectionTextureViewLightMatrix=e.Matrix.Zero(),l._projectionTextureProjectionLightMatrix=e.Matrix.Zero(),l._projectionTextureScalingMatrix=e.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),l.position=r,l.direction=n,l.angle=a,l.exponent=o,l}return a(i,t),Object.defineProperty(i.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(e){this._innerAngle=e,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(e){this._projectionTexture=e,this._projectionTextureDirty=!0},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"SpotLight"},i.prototype.getTypeID=function(){return e.Light.LIGHTTYPEID_SPOTLIGHT},i.prototype._setDirection=function(e){t.prototype._setDirection.call(this,e),this._projectionTextureViewLightDirty=!0},i.prototype._setPosition=function(e){t.prototype._setPosition.call(this,e),this._projectionTextureViewLightDirty=!0},i.prototype._setDefaultShadowProjectionMatrix=function(t,i,r){var n=this.getScene().activeCamera;if(n){this._shadowAngleScale=this._shadowAngleScale||1;var a=this._shadowAngleScale*this._angle;e.Matrix.PerspectiveFovLHToRef(a,1,this.getDepthMinZ(n),this.getDepthMaxZ(n),t)}},i.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),e.Matrix.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},i.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var t=this.projectionTextureLightFar,i=this.projectionTextureLightNear,r=t/(t-i),n=-r*i,a=1/Math.tan(this._angle/2);e.Matrix.FromValuesToRef(a/1,0,0,0,0,a,0,0,0,0,r,1,0,0,n,0,this._projectionTextureProjectionLightMatrix)},i.prototype._computeProjectionTextureMatrix=function(){this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},i.prototype.transferToEffect=function(t,i){var r;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,i),r=e.Vector3.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,i),r=e.Vector3.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",r.x,r.y,r.z,this._cosHalfAngle,i),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,i),this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),t.setMatrix("textureProjectionMatrix"+i,this._projectionTextureMatrix),t.setTexture("projectionLightSampler"+i,this.projectionTexture)),this},i.prototype.dispose=function(){t.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},i.prototype.prepareLightSpecificDefines=function(e,t){e[__uv.$wrap(("SPOTLIGHT"+t))]=!0,e[__uv.$wrap(("PROJECTEDLIGHTTEXTURE"+t))]=!!this.projectionTexture},n([e.serialize()],i.prototype,"angle",null),n([e.serialize()],i.prototype,"innerAngle",null),n([e.serialize()],i.prototype,"shadowAngleScale",null),n([e.serialize()],i.prototype,"exponent",void 0),n([e.serialize()],i.prototype,"projectionTextureLightNear",null),n([e.serialize()],i.prototype,"projectionTextureLightFar",null),n([e.serialize()],i.prototype,"projectionTextureUpDirection",null),n([e.serializeAsTexture("projectedLightTexture")],i.prototype,"_projectionTexture",void 0),i}(e.ShadowLight);e.SpotLight=t}(s||(s={})),function(e){var t=function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=e.Animation.ANIMATIONLOOPMODE_CYCLE};e.AnimationPropertiesOverride=t}(s||(s={})),function(e){var t=function(){function e(e,t,i){this.name=e,this.from=t,this.to=i}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}();e.AnimationRange=t;var i=function(){function e(e,t,i){this.frame=e,this.action=t,this.onlyOnce=i,this.isDone=!1}return e.prototype._clone=function(){return new e(this.frame,this.action,this.onlyOnce)},e}();e.AnimationEvent=i;var r,n=function(){function t(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new e.Vector3(t.x,0,t.y)},t.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},t.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},t.prototype.move=function(e){if(Math.abs(e)>1)throw"step size should be less than 1.";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach((function(t){return t(e)})),this},t.prototype.onchange=function(e){return this._onchange.push(e),this},t}();e.PathCursor=n,function(e){e[__uv.$wrap((e.STEP=1))]="STEP"}(r=e.AnimationKeyInterpolation||(e.AnimationKeyInterpolation={}));var a=function(){function i(e,t,r,n,a,o){this.name=e,this.targetProperty=t,this.framePerSecond=r,this.dataType=n,this.loopMode=a,this.enableBlending=o,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=n,this.loopMode=void 0===a?i.ANIMATIONLOOPMODE_CYCLE:a}return i._PrepareAnimation=function(t,r,n,a,o,s,l,c){var u=void 0;if(!isNaN(parseFloat(o))&&isFinite(o)?u=i.ANIMATIONTYPE_FLOAT:o instanceof e.Quaternion?u=i.ANIMATIONTYPE_QUATERNION:o instanceof e.Vector3?u=i.ANIMATIONTYPE_VECTOR3:o instanceof e.Vector2?u=i.ANIMATIONTYPE_VECTOR2:o instanceof e.Color3?u=i.ANIMATIONTYPE_COLOR3:o instanceof e.Size&&(u=i.ANIMATIONTYPE_SIZE),null==u)return null;var h=new i(t,r,n,u,l),d=[{frame:0,value:o},{frame:a,value:s}];return h.setKeys(d),void 0!==c&&h.setEasingFunction(c),h},i.CreateAnimation=function(e,t,r,n){var a=new i(e+"Animation",e,r,t,i.ANIMATIONLOOPMODE_CONSTANT);return a.setEasingFunction(n),a},i.CreateAndStartAnimation=function(e,t,r,n,a,o,s,l,c,u){var h=i._PrepareAnimation(e,r,n,a,o,s,l,c);return h?t.getScene().beginDirectAnimation(t,[h],0,a,1===h.loopMode,1,u):null},i.CreateAndStartHierarchyAnimation=function(e,t,r,n,a,o,s,l,c,u,h){var d=i._PrepareAnimation(e,n,a,o,s,l,c,u);return d?t.getScene().beginDirectHierarchyAnimation(t,r,[d],0,o,1===d.loopMode,1,h):null},i.CreateMergeAndStartAnimation=function(e,t,r,n,a,o,s,l,c,u){var h=i._PrepareAnimation(e,r,n,a,o,s,l,c);return h?(t.animations.push(h),t.getScene().beginAnimation(t,0,a,1===h.loopMode,1,u)):null},i.TransitionTo=function(e,t,i,r,n,a,o,s){if(void 0===s&&(s=null),o<=0)return i[__uv.$wrap((e))]=t,s&&s(),null;var l=n*(o/1e3);a.setKeys([{frame:0,value:i[__uv.$wrap((e))].clone?i[__uv.$wrap((e))].clone():i[__uv.$wrap((e))]},{frame:l,value:t}]),i.animations||(i.animations=[]),i.animations.push(a);var c=r.beginAnimation(i,0,l,!1);return c.onAnimationEnd=s,c},Object.defineProperty(i.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++){if(!t[__uv.$wrap((e))].isStopped)return!0}return!1},enumerable:!0,configurable:!0}),i.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][__uv.$wrap((this.dataType))],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var r in this._ranges)i&&(t+=", ",i=!1),t+=r;t+="}"}return t},i.prototype.addEvent=function(e){this._events.push(e)},i.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[__uv.$wrap((t))].frame===e&&(this._events.splice(t,1),t--)},i.prototype.getEvents=function(){return this._events},i.prototype.createRange=function(e,i,r){this._ranges[__uv.$wrap((e))]||(this._ranges[__uv.$wrap((e))]=new t(e,i,r))},i.prototype.deleteRange=function(e,t){void 0===t&&(t=!0);var i=this._ranges[__uv.$wrap((e))];if(i){if(t)for(var r=i.from,n=i.to,a=this._keys.length-1;a>=0;a--)this._keys[__uv.$wrap((a))].frame>=r&&this._keys[__uv.$wrap((a))].frame<=n&&this._keys.splice(a,1);this._ranges[__uv.$wrap((e))]=null}},i.prototype.getRange=function(e){return this._ranges[__uv.$wrap((e))]},i.prototype.getKeys=function(){return this._keys},i.prototype.getHighestFrame=function(){for(var e=0,t=0,i=this._keys.length;t<i;t++)e<this._keys[__uv.$wrap((t))].frame&&(e=this._keys[__uv.$wrap((t))].frame);return e},i.prototype.getEasingFunction=function(){return this._easingFunction},i.prototype.setEasingFunction=function(e){this._easingFunction=e},i.prototype.floatInterpolateFunction=function(t,i,r){return e.Scalar.Lerp(t,i,r)},i.prototype.floatInterpolateFunctionWithTangents=function(t,i,r,n,a){return e.Scalar.Hermite(t,i,r,n,a)},i.prototype.quaternionInterpolateFunction=function(t,i,r){return e.Quaternion.Slerp(t,i,r)},i.prototype.quaternionInterpolateFunctionWithTangents=function(t,i,r,n,a){return e.Quaternion.Hermite(t,i,r,n,a).normalize()},i.prototype.vector3InterpolateFunction=function(t,i,r){return e.Vector3.Lerp(t,i,r)},i.prototype.vector3InterpolateFunctionWithTangents=function(t,i,r,n,a){return e.Vector3.Hermite(t,i,r,n,a)},i.prototype.vector2InterpolateFunction=function(t,i,r){return e.Vector2.Lerp(t,i,r)},i.prototype.vector2InterpolateFunctionWithTangents=function(t,i,r,n,a){return e.Vector2.Hermite(t,i,r,n,a)},i.prototype.sizeInterpolateFunction=function(t,i,r){return e.Size.Lerp(t,i,r)},i.prototype.color3InterpolateFunction=function(t,i,r){return e.Color3.Lerp(t,i,r)},i.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},i.prototype._interpolate=function(e,t,n,a,o,s){if(a===i.ANIMATIONLOOPMODE_CONSTANT&&t>0)return s.clone?s.clone():s;var l=this.getKeys(),c=Math.max(0,Math.min(l.length-1,Math.floor(l.length*(e-l[__uv.$wrap((0))].frame)/(l[__uv.$wrap((l.length-1))].frame-l[__uv.$wrap((0))].frame))-1));if(l[__uv.$wrap((c))].frame>=e)for(;c-1>=0&&l[__uv.$wrap((c))].frame>=e;)c--;for(var u=c;u<l.length;u++){var h=l[__uv.$wrap((u+1))];if(h.frame>=e){var d=l[__uv.$wrap((u))],p=this._getKeyValue(d.value);if(d.interpolation===r.STEP)return p;var m=this._getKeyValue(h.value),_=void 0!==d.outTangent&&void 0!==h.inTangent,f=h.frame-d.frame,g=(e-d.frame)/f,y=this.getEasingFunction();switch(null!=y&&(g=y.ease(g)),this.dataType){case i.ANIMATIONTYPE_FLOAT:var v=_?this.floatInterpolateFunctionWithTangents(p,d.outTangent*f,m,h.inTangent*f,g):this.floatInterpolateFunction(p,m,g);switch(a){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return v;case i.ANIMATIONLOOPMODE_RELATIVE:return o*t+v}break;case i.ANIMATIONTYPE_QUATERNION:var b=_?this.quaternionInterpolateFunctionWithTangents(p,d.outTangent.scale(f),m,h.inTangent.scale(f),g):this.quaternionInterpolateFunction(p,m,g);switch(a){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return b;case i.ANIMATIONLOOPMODE_RELATIVE:return b.addInPlace(o.scale(t))}return b;case i.ANIMATIONTYPE_VECTOR3:var x=_?this.vector3InterpolateFunctionWithTangents(p,d.outTangent.scale(f),m,h.inTangent.scale(f),g):this.vector3InterpolateFunction(p,m,g);switch(a){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return x;case i.ANIMATIONLOOPMODE_RELATIVE:return x.add(o.scale(t))}case i.ANIMATIONTYPE_VECTOR2:var S=_?this.vector2InterpolateFunctionWithTangents(p,d.outTangent.scale(f),m,h.inTangent.scale(f),g):this.vector2InterpolateFunction(p,m,g);switch(a){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return S;case i.ANIMATIONLOOPMODE_RELATIVE:return S.add(o.scale(t))}case i.ANIMATIONTYPE_SIZE:switch(a){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(p,m,g);case i.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(p,m,g).add(o.scale(t))}case i.ANIMATIONTYPE_COLOR3:switch(a){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(p,m,g);case i.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(p,m,g).add(o.scale(t))}case i.ANIMATIONTYPE_MATRIX:switch(a){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:if(i.AllowMatricesInterpolation)return this.matrixInterpolateFunction(p,m,g,n);case i.ANIMATIONLOOPMODE_RELATIVE:return p}}break}}return this._getKeyValue(l[__uv.$wrap((l.length-1))].value)},i.prototype.matrixInterpolateFunction=function(t,r,n,a){return i.AllowMatrixDecomposeForInterpolation?a?(e.Matrix.DecomposeLerpToRef(t,r,n,a),a):e.Matrix.DecomposeLerp(t,r,n):a?(e.Matrix.LerpToRef(t,r,n,a),a):e.Matrix.Lerp(t,r,n)},i.prototype.clone=function(){var e=new i(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges)for(var t in e._ranges={},this._ranges){var r=this._ranges[__uv.$wrap((t))];r&&(e._ranges[__uv.$wrap((t))]=r.clone())}return e},i.prototype.setKeys=function(e){this._keys=e.slice(0)},i.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var t=this.dataType;e.keys=[];for(var r=this.getKeys(),n=0;n<r.length;n++){var a=r[__uv.$wrap((n))],o={};switch(o.frame=a.frame,t){case i.ANIMATIONTYPE_FLOAT:o.values=[a.value];break;case i.ANIMATIONTYPE_QUATERNION:case i.ANIMATIONTYPE_MATRIX:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:o.values=a.value.asArray()}e.keys.push(o)}for(var s in e.ranges=[],this._ranges){var l=this._ranges[__uv.$wrap((s))];if(l){var c={};c.name=s,c.from=l.from,c.to=l.to,e.ranges.push(c)}}return e},Object.defineProperty(i,"ANIMATIONTYPE_FLOAT",{get:function(){return i._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_VECTOR3",{get:function(){return i._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_VECTOR2",{get:function(){return i._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_SIZE",{get:function(){return i._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_QUATERNION",{get:function(){return i._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_MATRIX",{get:function(){return i._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_COLOR3",{get:function(){return i._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return i._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return i._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return i._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),i._UniversalLerp=function(e,t,i){var r=e.constructor;return r.Lerp?r.Lerp(e,t,i):r.Slerp?r.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t},i.Parse=function(t){var r,n,a=new i(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),o=t.dataType,s=[];for(t.enableBlending&&(a.enableBlending=t.enableBlending),t.blendingSpeed&&(a.blendingSpeed=t.blendingSpeed),n=0;n<t.keys.length;n++){var l,c,u=t.keys[__uv.$wrap((n))];switch(o){case i.ANIMATIONTYPE_FLOAT:r=u.values[__uv.$wrap((0))],u.values.length>=1&&(l=u.values[__uv.$wrap((1))]),u.values.length>=2&&(c=u.values[__uv.$wrap((2))]);break;case i.ANIMATIONTYPE_QUATERNION:if(r=e.Quaternion.FromArray(u.values),u.values.length>=8){var h=e.Quaternion.FromArray(u.values.slice(4,8));h.equals(e.Quaternion.Zero())||(l=h)}if(u.values.length>=12){var d=e.Quaternion.FromArray(u.values.slice(8,12));d.equals(e.Quaternion.Zero())||(c=d)}break;case i.ANIMATIONTYPE_MATRIX:r=e.Matrix.FromArray(u.values);break;case i.ANIMATIONTYPE_COLOR3:r=e.Color3.FromArray(u.values);break;case i.ANIMATIONTYPE_VECTOR3:default:r=e.Vector3.FromArray(u.values)}var p={};p.frame=u.frame,p.value=r,null!=l&&(p.inTangent=l),null!=c&&(p.outTangent=c),s.push(p)}if(a.setKeys(s),t.ranges)for(n=0;n<t.ranges.length;n++)r=t.ranges[__uv.$wrap((n))],a.createRange(r.name,r.from,r.to);return a},i.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var r=e.animations[__uv.$wrap((i))];t.animations.push(r.serialize())}}},i.AllowMatricesInterpolation=!1,i.AllowMatrixDecomposeForInterpolation=!0,i._ANIMATIONTYPE_FLOAT=0,i._ANIMATIONTYPE_VECTOR3=1,i._ANIMATIONTYPE_QUATERNION=2,i._ANIMATIONTYPE_MATRIX=3,i._ANIMATIONTYPE_COLOR3=4,i._ANIMATIONTYPE_VECTOR2=5,i._ANIMATIONTYPE_SIZE=6,i._ANIMATIONLOOPMODE_RELATIVE=0,i._ANIMATIONLOOPMODE_CYCLE=1,i._ANIMATIONLOOPMODE_CONSTANT=2,i}();e.Animation=a}(s||(s={})),function(e){var t=function(){};e.TargetedAnimation=t;var i=function(){function t(t,i){void 0===i&&(i=null),this.name=t,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this.onAnimationEndObservable=new e.Observable,this.onAnimationGroupEndObservable=new e.Observable,this.onAnimationGroupPauseObservable=new e.Observable,this._scene=i||e.Engine.LastCreatedScene,this._scene.animationGroups.push(this)}return Object.defineProperty(t.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){if(this._speedRatio!==e){this._speedRatio=e;for(var t=0;t<this._animatables.length;t++){this._animatables[__uv.$wrap((t))].speedRatio=this._speedRatio}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animatables",{get:function(){return this._animatables},enumerable:!0,configurable:!0}),t.prototype.addTargetedAnimation=function(e,t){var i={animation:e,target:t},r=e.getKeys();return this._from>r[__uv.$wrap((0))].frame&&(this._from=r[__uv.$wrap((0))].frame),this._to<r[__uv.$wrap((r.length-1))].frame&&(this._to=r[__uv.$wrap((r.length-1))].frame),this._targetedAnimations.push(i),i},t.prototype.normalize=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),null==e&&(e=this._from),null==t&&(t=this._to);for(var i=0;i<this._targetedAnimations.length;i++){var r=this._targetedAnimations[__uv.$wrap((i))].animation.getKeys(),n=r[__uv.$wrap((0))],a=r[__uv.$wrap((r.length-1))];if(n.frame>e){var o={frame:e,value:n.value,inTangent:n.inTangent,outTangent:n.outTangent,interpolation:n.interpolation};r.splice(0,0,o)}if(a.frame<t){o={frame:t,value:a.value,inTangent:a.outTangent,outTangent:a.outTangent,interpolation:a.interpolation};r.push(o)}}return this._from=e,this._to=t,this},t.prototype.start=function(e,t,i,r){var n=this;if(void 0===e&&(e=!1),void 0===t&&(t=1),this._isStarted||0===this._targetedAnimations.length)return this;for(var a=function(a){var s=o._scene.beginDirectAnimation(a.target,[a.animation],void 0!==i?i:o._from,void 0!==r?r:o._to,e,t);s.onAnimationEnd=function(){n.onAnimationEndObservable.notifyObservers(a),n._checkAnimationGroupEnded(s)},o._animatables.push(s)},o=this,s=0,l=this._targetedAnimations;s<l.length;s++){a(l[__uv.$wrap((s))])}return this._speedRatio=t,this._isStarted=!0,this},t.prototype.pause=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++){this._animatables[__uv.$wrap((e))].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},t.prototype.play=function(e){if(this.isStarted&&this._animatables.length===this._targetedAnimations.length){if(void 0!==e)for(var t=0;t<this._animatables.length;t++){this._animatables[__uv.$wrap((t))].loopAnimation=e}this.restart()}else this.stop(),this.start(e,this._speedRatio);return this},t.prototype.reset=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++){this._animatables[__uv.$wrap((e))].reset()}return this},t.prototype.restart=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++){this._animatables[__uv.$wrap((e))].restart()}return this},t.prototype.stop=function(){if(!this._isStarted)return this;for(var e=this._animatables.slice(),t=0;t<e.length;t++)e[__uv.$wrap((t))].stop();return this._isStarted=!1,this},t.prototype.setWeightForAllAnimatables=function(e){for(var t=0;t<this._animatables.length;t++){this._animatables[__uv.$wrap((t))].weight=e}return this},t.prototype.syncAllAnimationsWith=function(e){for(var t=0;t<this._animatables.length;t++){this._animatables[__uv.$wrap((t))].syncWith(e)}return this},t.prototype.goToFrame=function(e){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++){this._animatables[__uv.$wrap((t))].goToFrame(e)}return this},t.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var e=this._scene.animationGroups.indexOf(this);e>-1&&this._scene.animationGroups.splice(e,1)},t.prototype._checkAnimationGroupEnded=function(e){var t=this._animatables.indexOf(e);t>-1&&this._animatables.splice(t,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},t.Parse=function(t,i){for(var r=new e.AnimationGroup(t.name,i),n=0;n<t.targetedAnimations.length;n++){var a=t.targetedAnimations[__uv.$wrap((n))],o=e.Animation.Parse(a.animation),s=a.targetId,l=i.getNodeByID(s);null!=l&&r.addTargetedAnimation(o,l)}return null!==t.from&&null!==t.from&&r.normalize(t.from,t.to),r},t.prototype.getClassName=function(){return"AnimationGroup"},t.prototype.toString=function(e){var t="Name: "+this.name;return t+=", type: "+this.getClassName(),e&&(t+=", from: "+this._from,t+=", to: "+this._to,t+=", isStarted: "+this._isStarted,t+=", speedRatio: "+this._speedRatio,t+=", targetedAnimations length: "+this._targetedAnimations.length,t+=", animatables length: "+this._animatables),t},t}();e.AnimationGroup=i}(s||(s={})),function(e){var t=Object.freeze(new e.Quaternion(0,0,0,0)),i=Object.freeze(e.Vector3.Zero()),r=Object.freeze(e.Vector2.Zero()),n=Object.freeze(e.Size.Zero()),a=Object.freeze(e.Color3.Black()),o=function(){function o(e,t,i,r){var n=this;this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._animation=t,this._target=e,this._scene=i,this._host=r,t._runtimeAnimations.push(this);var a=t.getEvents();a&&a.length>0&&a.forEach((function(e){n._events.push(e._clone())}))}return Object.defineProperty(o.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"weight",{get:function(){return this._weight},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"target",{get:function(){return this._activeTarget},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),o.prototype.reset=function(e){if(void 0===e&&(e=!1),e)if(this._target instanceof Array)for(var t=0,i=0,r=this._target;i<r.length;i++){var n=r[__uv.$wrap((i))];void 0!==this._originalValue[__uv.$wrap((t))]&&this._setValue(n,this._originalValue[__uv.$wrap((t))],-1),t++}else void 0!==this._originalValue[__uv.$wrap((0))]&&this._setValue(this._target,this._originalValue[__uv.$wrap((0))],-1);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,this._originalValue=new Array;for(t=0;t<this._events.length;t++)this._events[__uv.$wrap((t))].isDone=!1},o.prototype.isStopped=function(){return this._stopped},o.prototype.dispose=function(){var e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)},o.prototype._interpolate=function(t,i,r,n,a){return this._currentFrame=t,this._animation.dataType!==e.Animation.ANIMATIONTYPE_MATRIX||this._workValue||(this._workValue=e.Matrix.Zero()),this._animation._interpolate(t,i,this._workValue,r,n,a)},o.prototype.setValue=function(e,t){if(void 0===t&&(t=1),this._target instanceof Array)for(var i=0,r=0,n=this._target;r<n.length;r++){var a=n[__uv.$wrap((r))];this._setValue(a,e,t,i),i++}else this._setValue(this._target,e,t)},o.prototype._setValue=function(t,i,r,n){var a,o;void 0===n&&(n=0);var s=this._animation.targetPropertyPath;if(s.length>1){for(var l=t[__uv.$wrap((s[__uv.$wrap((0))]))],c=1;c<s.length-1;c++)l=l[__uv.$wrap((s[__uv.$wrap((c))]))];a=s[__uv.$wrap((s.length-1))],o=l}else a=s[__uv.$wrap((0))],o=t;if(this._targetPath=a,this._activeTarget=o,this._weight=r,void 0===this._originalValue[__uv.$wrap((n))]){var u=void 0;(u=o.getRestPose&&"_matrix"===a?o.getRestPose():o[__uv.$wrap((a))])&&u.clone?this._originalValue[__uv.$wrap((n))]=u.clone():this._originalValue[__uv.$wrap((n))]=u}if((t&&t.animationPropertiesOverride?t.animationPropertiesOverride.enableBlending:this._animation.enableBlending)&&this._blendingFactor<=1){if(!this._originalBlendValue)(u=o[__uv.$wrap((a))]).clone?this._originalBlendValue=u.clone():this._originalBlendValue=u;this._originalBlendValue.m?e.Animation.AllowMatrixDecomposeForInterpolation?this._currentValue?e.Matrix.DecomposeLerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=e.Matrix.DecomposeLerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue?e.Matrix.LerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=e.Matrix.Lerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue=e.Animation._UniversalLerp(this._originalBlendValue,i,this._blendingFactor);var h=t&&t.animationPropertiesOverride?t.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=h}else this._currentValue=i;-1!==r?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[__uv.$wrap((n))]):o[__uv.$wrap((a))]=this._currentValue,t.markAsDirty&&t.markAsDirty(this._animation.targetProperty)},o.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},o.prototype.goToFrame=function(e){var t=this._animation.getKeys();e<t[__uv.$wrap((0))].frame?e=t[__uv.$wrap((0))].frame:e>t[__uv.$wrap((t.length-1))].frame&&(e=t[__uv.$wrap((t.length-1))].frame);var i=this._interpolate(e,0,this._getCorrectLoopMode());this.setValue(i,-1)},o.prototype._prepareForSpeedRatioChange=function(e){var t=this._previousDelay*(this._animation.framePerSecond*e)/1e3;this._ratioOffset=this._previousRatio-t},o.prototype.animate=function(o,s,l,c,u,h){void 0===h&&(h=-1);var d=this._animation.targetPropertyPath;if(!d||d.length<1)return this._stopped=!0,!1;var p=!0,m=this._animation.getKeys();if(0!==m[__uv.$wrap((0))].frame){var _={frame:0,value:m[__uv.$wrap((0))].value};m.splice(0,0,_)}else if(1===m.length){_={frame:.001,value:m[__uv.$wrap((0))].value};m.push(_)}(s<m[__uv.$wrap((0))].frame||s>m[__uv.$wrap((m.length-1))].frame)&&(s=m[__uv.$wrap((0))].frame),(l<m[__uv.$wrap((0))].frame||l>m[__uv.$wrap((m.length-1))].frame)&&(l=m[__uv.$wrap((m.length-1))].frame),s===l&&(s>m[__uv.$wrap((0))].frame?s--:l<m[__uv.$wrap((m.length-1))].frame&&l++);var f,g=l-s,y=o*(this._animation.framePerSecond*u)/1e3+this._ratioOffset,v=0;if(this._previousDelay=o,this._previousRatio=y,(l>s&&y>=g||s>l&&y<=g)&&!c)p=!1,v=this._animation._getKeyValue(m[__uv.$wrap((m.length-1))].value);else if(this._getCorrectLoopMode()!==e.Animation.ANIMATIONLOOPMODE_CYCLE){var b=l.toString()+s.toString();if(!this._offsetsCache[__uv.$wrap((b))]){var x=this._interpolate(s,0,e.Animation.ANIMATIONLOOPMODE_CYCLE),S=this._interpolate(l,0,e.Animation.ANIMATIONLOOPMODE_CYCLE);switch(this._animation.dataType){case e.Animation.ANIMATIONTYPE_FLOAT:this._offsetsCache[__uv.$wrap((b))]=S-x;break;case e.Animation.ANIMATIONTYPE_QUATERNION:this._offsetsCache[__uv.$wrap((b))]=S.subtract(x);break;case e.Animation.ANIMATIONTYPE_VECTOR3:this._offsetsCache[__uv.$wrap((b))]=S.subtract(x);case e.Animation.ANIMATIONTYPE_VECTOR2:this._offsetsCache[__uv.$wrap((b))]=S.subtract(x);case e.Animation.ANIMATIONTYPE_SIZE:this._offsetsCache[__uv.$wrap((b))]=S.subtract(x);case e.Animation.ANIMATIONTYPE_COLOR3:this._offsetsCache[__uv.$wrap((b))]=S.subtract(x)}this._highLimitsCache[__uv.$wrap((b))]=S}v=this._highLimitsCache[__uv.$wrap((b))],f=this._offsetsCache[__uv.$wrap((b))]}if(void 0===f)switch(this._animation.dataType){case e.Animation.ANIMATIONTYPE_FLOAT:f=0;break;case e.Animation.ANIMATIONTYPE_QUATERNION:f=t;break;case e.Animation.ANIMATIONTYPE_VECTOR3:f=i;break;case e.Animation.ANIMATIONTYPE_VECTOR2:f=r;break;case e.Animation.ANIMATIONTYPE_SIZE:f=n;break;case e.Animation.ANIMATIONTYPE_COLOR3:f=a}var T=y/g>>0,E=p?s+y%g:l;if(this._host&&this._host.syncRoot){var P=this._host.syncRoot;E=s+(l-s)*((P.masterFrame-P.fromFrame)/(P.toFrame-P.fromFrame))}var A=this._events;if(g>0&&this.currentFrame>E||g<0&&this.currentFrame<E)for(var M=0;M<A.length;M++)A[__uv.$wrap((M))].onlyOnce||(A[__uv.$wrap((M))].isDone=!1);var C=this._interpolate(E,T,this._getCorrectLoopMode(),f,v);this.setValue(C,h);for(M=0;M<A.length;M++)if(g>0&&E>=A[__uv.$wrap((M))].frame&&A[__uv.$wrap((M))].frame>=s||g<0&&E<=A[__uv.$wrap((M))].frame&&A[__uv.$wrap((M))].frame<=s){var R=A[__uv.$wrap((M))];R.isDone||(R.onlyOnce&&(A.splice(M,1),M--),R.isDone=!0,R.action(E))}return p||(this._stopped=!0),p},o}();e.RuntimeAnimation=o}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a,o,s,l){void 0===r&&(r=0),void 0===n&&(n=100),void 0===a&&(a=!1),void 0===o&&(o=1),this.target=i,this.fromFrame=r,this.toFrame=n,this.loopAnimation=a,this.onAnimationEnd=s,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new e.Observable,this._scene=t,l&&this.appendAnimations(i,l),this._speedRatio=o,t._activeAnimatables.push(this)}return Object.defineProperty(t.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"masterFrame",{get:function(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[__uv.$wrap((0))].currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this._weight},set:function(e){this._weight=-1!==e?Math.min(Math.max(e,0),1):-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){for(var t=0;t<this._runtimeAnimations.length;t++){this._runtimeAnimations[__uv.$wrap((t))]._prepareForSpeedRatioChange(e)}this._speedRatio=e},enumerable:!0,configurable:!0}),t.prototype.syncWith=function(e){if(this._syncRoot=e,e){var t=this._scene._activeAnimatables.indexOf(this);t>-1&&(this._scene._activeAnimatables.splice(t,1),this._scene._activeAnimatables.push(this))}return this},t.prototype.getAnimations=function(){return this._runtimeAnimations},t.prototype.appendAnimations=function(t,i){for(var r=0;r<i.length;r++){var n=i[__uv.$wrap((r))];this._runtimeAnimations.push(new e.RuntimeAnimation(t,n,this._scene,this))}},t.prototype.getAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,i=0;i<t.length;i++)if(t[__uv.$wrap((i))].animation.targetProperty===e)return t[__uv.$wrap((i))].animation;return null},t.prototype.getRuntimeAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,i=0;i<t.length;i++)if(t[__uv.$wrap((i))].animation.targetProperty===e)return t[__uv.$wrap((i))];return null},t.prototype.reset=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[__uv.$wrap((t))].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},t.prototype.enableBlending=function(e){for(var t=this._runtimeAnimations,i=0;i<t.length;i++)t[__uv.$wrap((i))].animation.enableBlending=!0,t[__uv.$wrap((i))].animation.blendingSpeed=e},t.prototype.disableBlending=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[__uv.$wrap((t))].animation.enableBlending=!1},t.prototype.goToFrame=function(e){var t=this._runtimeAnimations;if(t[__uv.$wrap((0))]){var i=t[__uv.$wrap((0))].animation.framePerSecond,r=1e3*(e-t[__uv.$wrap((0))].currentFrame)/(i*this.speedRatio);null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=r}for(var n=0;n<t.length;n++)t[__uv.$wrap((n))].goToFrame(e)},t.prototype.pause=function(){this._paused||(this._paused=!0)},t.prototype.restart=function(){this._paused=!1},t.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},t.prototype.stop=function(e,t){if(e||t){var i=this._scene._activeAnimatables.indexOf(this);if(i>-1){for(var r=(a=this._runtimeAnimations).length-1;r>=0;r--){var n=a[__uv.$wrap((r))];e&&n.animation.name!=e||(t&&!t(n.target)||(n.dispose(),a.splice(r,1)))}0==a.length&&(this._scene._activeAnimatables.splice(i,1),this._raiseOnAnimationEnd())}}else{if((r=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(r,1);var a=this._runtimeAnimations;for(r=0;r<a.length;r++)a[__uv.$wrap((r))].dispose();this._raiseOnAnimationEnd()}}},t.prototype.waitAsync=function(){var e=this;return new Promise((function(t,i){e.onAnimationEndObservable.add((function(){t(e)}),void 0,void 0,e,!0)}))},t.prototype._animate=function(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),0===this._weight)return!0;var t,i=!1,r=this._runtimeAnimations;for(t=0;t<r.length;t++){var n=r[__uv.$wrap((t))].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);i=i||n}if(this.animationStarted=i,!i){if(this.disposeOnEnd)for(t=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(t,1),t=0;t<r.length;t++)r[__uv.$wrap((t))].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationEndObservable.clear())}return i},t}();e.Animatable=t}(s||(s={})),function(e){var t=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return e.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(e){throw new Error("You must implement this method")},e.prototype.ease=function(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},e.EASINGMODE_EASEIN=0,e.EASINGMODE_EASEOUT=1,e.EASINGMODE_EASEINOUT=2,e}();e.EasingFunction=t;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}(t);e.CircleEase=i;var r=function(e){function t(t){void 0===t&&(t=1);var i=e.call(this)||this;return i.amplitude=t,i}return a(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)},t}(t);e.BackEase=r;var n=function(e){function t(t,i){void 0===t&&(t=3),void 0===i&&(i=2);var r=e.call(this)||this;return r.bounces=t,r.bounciness=i,r}return a(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.bounces),i=this.bounciness;i<=1&&(i=1.001);var r=Math.pow(i,t),n=1-i,a=(1-r)/n+.5*r,o=e*a,s=Math.log(-o*(1-i)+1)/Math.log(i),l=Math.floor(s),c=l+1,u=(1-Math.pow(i,l))/(n*a),h=.5*(u+(1-Math.pow(i,c))/(n*a)),d=e-h,p=h-u;return-Math.pow(1/i,t-l)/(p*p)*(d-p)*(d+p)},t}(t);e.BounceEase=n;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.easeInCore=function(e){return e*e*e},t}(t);e.CubicEase=o;var s=function(e){function t(t,i){void 0===t&&(t=3),void 0===i&&(i=3);var r=e.call(this)||this;return r.oscillations=t,r.springiness=i,r}return a(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.oscillations),i=Math.max(0,this.springiness);return(0==i?e:(Math.exp(i*e)-1)/(Math.exp(i)-1))*Math.sin((6.283185307179586*t+1.5707963267948966)*e)},t}(t);e.ElasticEase=s;var l=function(e){function t(t){void 0===t&&(t=2);var i=e.call(this)||this;return i.exponent=t,i}return a(t,e),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}(t);e.ExponentialEase=l;var c=function(e){function t(t){void 0===t&&(t=2);var i=e.call(this)||this;return i.power=t,i}return a(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.power);return Math.pow(e,t)},t}(t);e.PowerEase=c;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.easeInCore=function(e){return e*e},t}(t);e.QuadraticEase=u;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.easeInCore=function(e){return e*e*e*e},t}(t);e.QuarticEase=h;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}(t);e.QuinticEase=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}(t);e.SineEase=p;var m=function(t){function i(e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1);var a=t.call(this)||this;return a.x1=e,a.y1=i,a.x2=r,a.y2=n,a}return a(i,t),i.prototype.easeInCore=function(t){return e.BezierCurve.Interpolate(t,this.x1,this.y1,this.x2,this.y2)},i}(t);e.BezierCurveEase=m}(s||(s={})),function(e){var t=function(){function e(e){this._actionManager=e}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e.prototype.serialize=function(){},e.prototype._serialize=function(e){return{type:2,children:[],name:e.name,properties:e.properties}},e}();e.Condition=t;var i=function(t){function i(e,r,n,a,o){void 0===o&&(o=i.IsEqual);var s=t.call(this,e)||this;return s.propertyPath=n,s.value=a,s.operator=o,s._target=r,s._effectiveTarget=s._getEffectiveTarget(r,s.propertyPath),s._property=s._getProperty(s.propertyPath),s}return a(i,t),Object.defineProperty(i,"IsEqual",{get:function(){return i._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsDifferent",{get:function(){return i._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsGreater",{get:function(){return i._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsLesser",{get:function(){return i._IsLesser},enumerable:!0,configurable:!0}),i.prototype.isValid=function(){switch(this.operator){case i.IsGreater:return this._effectiveTarget[__uv.$wrap((this._property))]>this.value;case i.IsLesser:return this._effectiveTarget[__uv.$wrap((this._property))]<this.value;case i.IsEqual:case i.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[__uv.$wrap((this._property))]):this.value===this._effectiveTarget[__uv.$wrap((this._property))],this.operator===i.IsEqual?e:!e}return!1},i.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)},{name:"operator",value:i.GetOperatorName(this.operator)}]})},i.GetOperatorName=function(e){switch(e){case i._IsEqual:return"IsEqual";case i._IsDifferent:return"IsDifferent";case i._IsGreater:return"IsGreater";case i._IsLesser:return"IsLesser";default:return""}},i._IsEqual=0,i._IsDifferent=1,i._IsGreater=2,i._IsLesser=3,i}(t);e.ValueCondition=i;var r=function(e){function t(t,i){var r=e.call(this,t)||this;return r.predicate=i,r}return a(t,e),t.prototype.isValid=function(){return this.predicate()},t}(t);e.PredicateCondition=r;var n=function(t){function i(e,i,r){var n=t.call(this,e)||this;return n.value=r,n._target=i,n}return a(i,t),i.prototype.isValid=function(){return this._target.state===this.value},i.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[e.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},i}(t);e.StateCondition=n}(s||(s={})),function(e){var t=function(){function t(t,i){this.triggerOptions=t,this.onBeforeExecuteObservable=new e.Observable,t.parameter?(this.trigger=t.trigger,this._triggerParameter=t.parameter):t.trigger?this.trigger=t.trigger:this.trigger=t,this._nextActiveAction=this,this._condition=i}return t.prototype._prepare=function(){},t.prototype.getTriggerParameter=function(){return this._triggerParameter},t.prototype._executeCurrent=function(e){if(this._nextActiveAction._condition){var t=this._nextActiveAction._condition,i=this._actionManager.getScene().getRenderId();if(t._evaluationId===i){if(!t._currentResult)return}else{if(t._evaluationId=i,!t.isValid())return void(t._currentResult=!1);t._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(e),this.skipToNextActiveAction()},t.prototype.execute=function(e){},t.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},t.prototype.then=function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},t.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},t.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},t.prototype.serialize=function(e){},t.prototype._serialize=function(e,t){var i={type:1,children:[],name:e.name,properties:e.properties||[]};if(this._child&&this._child.serialize(i),this._condition){var r=this._condition.serialize();return r.children.push(i),t&&t.children.push(r),r}return t&&t.children.push(i),i},t._SerializeValueAsString=function(t){return"number"==typeof t?t.toString():"boolean"==typeof t?t?"true":"false":t instanceof e.Vector2?t.x+", "+t.y:t instanceof e.Vector3?t.x+", "+t.y+", "+t.z:t instanceof e.Color3?t.r+", "+t.g+", "+t.b:t instanceof e.Color4?t.r+", "+t.g+", "+t.b+", "+t.a:t},t._GetTargetProperty=function(t){return{name:"target",targetType:t instanceof e.Mesh?"MeshProperties":t instanceof e.Light?"LightProperties":t instanceof e.Camera?"CameraProperties":"SceneProperties",value:t instanceof e.Scene?"Scene":t.name}},t}();e.Action=t}(s||(s={})),function(e){var t=function(){function e(e,t,i,r,n,a){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=r,this.sourceEvent=n,this.additionalData=a}return e.CreateNew=function(t,i,r){var n=t.getScene();return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,i,r)},e.CreateNewFromSprite=function(t,i,r,n){return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer,r,n)},e.CreateNewFromScene=function(t,i){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)},e.CreateNewFromPrimitive=function(t,i,r,n){return new e(t,i.x,i.y,null,r,n)},e}();e.ActionEvent=t;var i=function(){function t(t){this.actions=new Array,this.hoverCursor="",this._scene=t||e.Engine.LastCreatedScene,t.actionManagers.push(this)}return t.prototype.dispose=function(){for(var e=this._scene.actionManagers.indexOf(this),i=0;i<this.actions.length;i++){var r=this.actions[__uv.$wrap((i))];t.Triggers[__uv.$wrap((r.trigger))]--,0===t.Triggers[__uv.$wrap((r.trigger))]&&delete t.Triggers[__uv.$wrap((r.trigger))]}e>-1&&this._scene.actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var t=0;t<this.actions.length;t++){var i=this.actions[__uv.$wrap((t))];if(e.indexOf(i.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTriggers2=function(e,t){for(var i=0;i<this.actions.length;i++){var r=this.actions[__uv.$wrap((i))];if(e==r.trigger||t==r.trigger)return!0}return!1},t.prototype.hasSpecificTrigger=function(e,t){for(var i=0;i<this.actions.length;i++){var r=this.actions[__uv.$wrap((i))];if(r.trigger===e){if(!t)return!0;if(t(r.getTriggerParameter()))return!0}}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var i=this.actions[__uv.$wrap((e))];if(i.trigger>=t.OnPickTrigger&&i.trigger<=t.OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var i=this.actions[__uv.$wrap((e))];if(i.trigger>=t.OnPickTrigger&&i.trigger<=t.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HasTriggers",{get:function(){for(var e in t.Triggers)if(t.Triggers.hasOwnProperty(e))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HasPickTriggers",{get:function(){for(var e in t.Triggers)if(t.Triggers.hasOwnProperty(e)){var i=parseInt(e);if(i>=t.OnPickTrigger&&i<=t.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),t.HasSpecificTrigger=function(e){for(var i in t.Triggers){if(t.Triggers.hasOwnProperty(i))if(parseInt(i)===e)return!0}return!1},t.prototype.registerAction=function(i){return i.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(e.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(i),t.Triggers[__uv.$wrap((i.trigger))]?t.Triggers[__uv.$wrap((i.trigger))]++:t.Triggers[__uv.$wrap((i.trigger))]=1,i._actionManager=this,i._prepare(),i)},t.prototype.unregisterAction=function(e){var i=this.actions.indexOf(e);return-1!==i&&(this.actions.splice(i,1),t.Triggers[__uv.$wrap((e.trigger))]-=1,0===t.Triggers[__uv.$wrap((e.trigger))]&&delete t.Triggers[__uv.$wrap((e.trigger))],delete e._actionManager,!0)},t.prototype.processTrigger=function(e,i){for(var r=0;r<this.actions.length;r++){var n=this.actions[__uv.$wrap((r))];if(n.trigger===e){if(i&&(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger)){var a=n.getTriggerParameter();if(a&&a!==i.sourceEvent.keyCode){if(!a.toLowerCase)continue;var o=a.toLowerCase();if(o!==i.sourceEvent.key){var s=i.sourceEvent.charCode?i.sourceEvent.charCode:i.sourceEvent.keyCode;if(String.fromCharCode(s).toLowerCase()!==o)continue}}}n._executeCurrent(i)}}},t.prototype._getEffectiveTarget=function(e,t){for(var i=t.split("."),r=0;r<i.length-1;r++)e=e[__uv.$wrap((i[__uv.$wrap((r))]))];return e},t.prototype._getProperty=function(e){var t=e.split(".");return t[__uv.$wrap((t.length-1))]},t.prototype.serialize=function(i){for(var r={children:new Array,name:i,type:3,properties:new Array},n=0;n<this.actions.length;n++){var a={type:0,children:new Array,name:t.GetTriggerName(this.actions[__uv.$wrap((n))].trigger),properties:new Array},o=this.actions[__uv.$wrap((n))].triggerOptions;if(o&&"number"!=typeof o)if(o.parameter instanceof e.Node)a.properties.push(e.Action._GetTargetProperty(o.parameter));else{var s={};e.Tools.DeepCopy(o.parameter,s,["mesh"]),o.parameter&&o.parameter.mesh&&(s._meshId=o.parameter.mesh.id),a.properties.push({name:"parameter",targetType:null,value:s})}this.actions[__uv.$wrap((n))].serialize(a),r.children.push(a)}return r},t.Parse=function(i,r,n){var a=new t(n);null===r?n.actionManager=a:r.actionManager=a;for(var o=function(t,i,r,n){if(null===n){var a=parseFloat(i);return"true"===i||"false"===i?"true"===i:isNaN(a)?i:a}for(var o=n.split("."),s=i.split(","),l=0;l<o.length;l++)r=r[__uv.$wrap((o[__uv.$wrap((l))]))];if("boolean"==typeof r)return"true"===s[__uv.$wrap((0))];if("string"==typeof r)return s[__uv.$wrap((0))];var c=new Array;for(l=0;l<s.length;l++)c.push(parseFloat(s[__uv.$wrap((l))]));return r instanceof e.Vector3?e.Vector3.FromArray(c):r instanceof e.Vector4?e.Vector4.FromArray(c):r instanceof e.Color3?e.Color3.FromArray(c):r instanceof e.Color4?e.Color4.FromArray(c):parseFloat(s[__uv.$wrap((0))])},s=function(i,r,l,c,u){if(void 0===u&&(u=null),!i.detached){var h=new Array,d=null,p=null,m=i.combine&&i.combine.length>0;if(2===i.type?h.push(a):h.push(r),m){for(var _=new Array,f=0;f<i.combine.length;f++)s(i.combine[__uv.$wrap((f))],t.NothingTrigger,l,c,_);h.push(_)}else for(var g=0;g<i.properties.length;g++){var y=i.properties[__uv.$wrap((g))].value,v=i.properties[__uv.$wrap((g))].name,b=i.properties[__uv.$wrap((g))].targetType;"target"===v?y=d=null!==b&&"SceneProperties"===b?n:n.getNodeByName(y):"parent"===v?y=n.getNodeByName(y):"sound"===v?n.getSoundByName&&(y=n.getSoundByName(y)):"propertyPath"!==v?y=2===i.type&&"operator"===v?e.ValueCondition[__uv.$wrap((y))]:o(0,y,d,"value"===v?p:null):p=y,h.push(y)}if(null===u?h.push(l):h.push(null),"InterpolateValueAction"===i.name){var x=h[__uv.$wrap((h.length-2))];h[__uv.$wrap((h.length-1))]=x,h[__uv.$wrap((h.length-2))]=l}var S=function(t,i){var r=Object.create(e.Tools.Instantiate("BABYLON."+t).prototype);return r.constructor.apply(r,i),r}(i.name,h);if(S instanceof e.Condition&&null!==l){var T=new e.DoNothingAction(r,l);c?c.then(T):a.registerAction(T),c=T}null===u?S instanceof e.Condition?(l=S,S=c):(l=null,c?c.then(S):a.registerAction(S)):u.push(S);for(g=0;g<i.children.length;g++)s(i.children[__uv.$wrap((g))],r,l,S,null)}},l=0;l<i.children.length;l++){var c,u=i.children[__uv.$wrap((l))];if(u.properties.length>0){var h=u.properties[__uv.$wrap((0))].value,d=null===u.properties[__uv.$wrap((0))].targetType?h:n.getMeshByName(h);d._meshId&&(d.mesh=n.getMeshByID(d._meshId)),c={trigger:t[__uv.$wrap((u.name))],parameter:d}}else c=t[__uv.$wrap((u.name))];for(var p=0;p<u.children.length;p++)u.detached||s(u.children[__uv.$wrap((p))],c,null,null)}},t.GetTriggerName=function(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t.NothingTrigger=0,t.OnPickTrigger=1,t.OnLeftPickTrigger=2,t.OnRightPickTrigger=3,t.OnCenterPickTrigger=4,t.OnPickDownTrigger=5,t.OnDoublePickTrigger=6,t.OnPickUpTrigger=7,t.OnPickOutTrigger=16,t.OnLongPressTrigger=8,t.OnPointerOverTrigger=9,t.OnPointerOutTrigger=10,t.OnEveryFrameTrigger=11,t.OnIntersectionEnterTrigger=12,t.OnIntersectionExitTrigger=13,t.OnKeyDownTrigger=14,t.OnKeyUpTrigger=15,t.Triggers={},t}();e.ActionManager=i}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c){void 0===o&&(o=1e3);var u=t.call(this,i,s)||this;return u.duration=1e3,u.onInterpolationDoneObservable=new e.Observable,u.propertyPath=n,u.value=a,u.duration=o,u.stopOtherAnimations=l,u.onInterpolationDone=c,u._target=u._effectiveTarget=r,u}return a(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){var t,i=this,r=this._actionManager.getScene(),n=[{frame:0,value:this._effectiveTarget[__uv.$wrap((this._property))]},{frame:100,value:this.value}];if("number"==typeof this.value)t=e.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");t=e.Animation.ANIMATIONTYPE_QUATERNION}var a=new e.Animation("InterpolateValueAction",this._property,1e3/this.duration*100,t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);a.setKeys(n),this.stopOtherAnimations&&r.stopAnimation(this._effectiveTarget);r.beginDirectAnimation(this._effectiveTarget,[a],0,100,!1,1,(function(){i.onInterpolationDoneObservable.notifyObservers(i),i.onInterpolationDone&&i.onInterpolationDone()}))},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)},{name:"duration",value:e.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:e.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},i)},i}(e.Action);e.InterpolateValueAction=t}(s||(s={})),function(e){var t=function(t){function i(e,i,r,n){var a=t.call(this,e,n)||this;return a.propertyPath=r,a._target=a._effectiveTarget=i,a}return a(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){this._effectiveTarget[__uv.$wrap((this._property))]=!this._effectiveTarget[__uv.$wrap((this._property))]},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},i)},i}(e.Action);e.SwitchBooleanAction=t;var i=function(t){function i(e,i,r,n){var a=t.call(this,e,n)||this;return a.value=r,a._target=i,a}return a(i,t),i.prototype.execute=function(){this._target.state=this.value},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetStateAction",properties:[e.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},i)},i}(e.Action);e.SetStateAction=i;var r=function(t){function i(e,i,r,n,a){var o=t.call(this,e,a)||this;return o.propertyPath=r,o.value=n,o._target=o._effectiveTarget=i,o}return a(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){this._effectiveTarget[__uv.$wrap((this._property))]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)}]},i)},i}(e.Action);e.SetValueAction=r;var n=function(t){function i(e,i,r,n,a){var o=t.call(this,e,a)||this;return o.propertyPath=r,o.value=n,o._target=o._effectiveTarget=i,o}return a(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[__uv.$wrap((this._property))]&&e.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},i.prototype.execute=function(){this._effectiveTarget[__uv.$wrap((this._property))]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)}]},i)},i}(e.Action);e.IncrementValueAction=n;var o=function(t){function i(e,i,r,n,a,o){var s=t.call(this,e,o)||this;return s.from=r,s.to=n,s.loop=a,s._target=i,s}return a(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[e.Action._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:e.Action._SerializeValueAsString(this.loop)||!1}]},i)},i}(e.Action);e.PlayAnimationAction=o;var s=function(t){function i(e,i,r){var n=t.call(this,e,r)||this;return n._target=i,n}return a(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[e.Action._GetTargetProperty(this._target)]},i)},i}(e.Action);e.StopAnimationAction=s;var l=function(t){function i(i,r){return void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,r)||this}return a(i,t),i.prototype.execute=function(){},i.prototype.serialize=function(e){return t.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},e)},i}(e.Action);e.DoNothingAction=l;var c=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.children=i,n}return a(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[__uv.$wrap((e))]._actionManager=this._actionManager,this.children[__uv.$wrap((e))]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[__uv.$wrap((t))].execute(e)},t.prototype.serialize=function(t){for(var i=e.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},t),r=0;r<this.children.length;r++)i.combine.push(this.children[__uv.$wrap((r))].serialize(null));return i},t}(e.Action);e.CombineAction=c;var u=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.func=i,n}return a(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=u;var h=function(t){function i(e,i,r,n){var a=t.call(this,e,n)||this;return a._target=i,a._parent=r,a}return a(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.__uv$setSource(__uv).__uv$parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.__uv$setSource(__uv).__uv$parent=this._parent}},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetParentAction",properties:[e.Action._GetTargetProperty(this._target),e.Action._GetTargetProperty(this._parent)]},i)},i}(e.Action);e.SetParentAction=h}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a,o,s){if(void 0===o&&(o=.01),void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new e.Observable,this._vertexBuffers={},a._getComponent(e.SceneComponentConstants.NAME_SPRITE)||a._addComponent(new e.SpriteSceneComponent(a)),this._capacity=r,this._spriteTexture=new e.Texture(i,a,!0,!1,s),this._spriteTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,n.width&&n.height)this.cellWidth=n.width,this.cellHeight=n.height;else{if(void 0===n)return;this.cellWidth=n,this.cellHeight=n}this._epsilon=o,this._scene=a,this._scene.spriteManagers.push(this);for(var l=[],c=0,u=0;u<r;u++)l.push(c),l.push(c+1),l.push(c+2),l.push(c),l.push(c+2),l.push(c+3),c+=4;this._indexBuffer=a.getEngine().createIndexBuffer(l),this._vertexData=new Float32Array(16*r*4),this._buffer=new e.Buffer(a.getEngine(),this._vertexData,!0,16);var h=this._buffer.createVertexBuffer(e.VertexBuffer.PositionKind,0,4),d=this._buffer.createVertexBuffer("options",4,4),p=this._buffer.createVertexBuffer("cellInfo",8,4),m=this._buffer.createVertexBuffer(e.VertexBuffer.ColorKind,12,4);this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=h,this._vertexBuffers.options=d,this._vertexBuffers.cellInfo=p,this._vertexBuffers[__uv.$wrap((e.VertexBuffer.ColorKind))]=m,this._effectBase=this._scene.getEngine().createEffect("sprites",[e.VertexBuffer.PositionKind,"options","cellInfo",e.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[e.VertexBuffer.PositionKind,"options","cellInfo",e.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._spriteTexture},set:function(e){this._spriteTexture=e},enumerable:!0,configurable:!0}),t.prototype._appendSpriteVertex=function(e,t,i,r,n){var a=16*e;0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),this._vertexData[__uv.$wrap((a))]=t.position.x,this._vertexData[__uv.$wrap((a+1))]=t.position.y,this._vertexData[__uv.$wrap((a+2))]=t.position.z,this._vertexData[__uv.$wrap((a+3))]=t.angle,this._vertexData[__uv.$wrap((a+4))]=t.width,this._vertexData[__uv.$wrap((a+5))]=t.height,this._vertexData[__uv.$wrap((a+6))]=i,this._vertexData[__uv.$wrap((a+7))]=r,this._vertexData[__uv.$wrap((a+8))]=t.invertU?1:0,this._vertexData[__uv.$wrap((a+9))]=t.invertV?1:0;var o=t.cellIndex/n>>0;this._vertexData[__uv.$wrap((a+10))]=t.cellIndex-o*n,this._vertexData[__uv.$wrap((a+11))]=o,this._vertexData[__uv.$wrap((a+12))]=t.color.r,this._vertexData[__uv.$wrap((a+13))]=t.color.g,this._vertexData[__uv.$wrap((a+14))]=t.color.b,this._vertexData[__uv.$wrap((a+15))]=t.color.a},t.prototype.intersects=function(t,i,r,n){for(var a=Math.min(this._capacity,this.sprites.length),o=e.Vector3.Zero(),s=e.Vector3.Zero(),l=Number.MAX_VALUE,c=null,u=e.Vector3.Zero(),h=i.getViewMatrix(),d=0;d<a;d++){var p=this.sprites[__uv.$wrap((d))];if(p){if(r){if(!r(p))continue}else if(!p.isPickable)continue;if(e.Vector3.TransformCoordinatesToRef(p.position,h,u),o.copyFromFloats(u.x-p.width/2,u.y-p.height/2,u.z),s.copyFromFloats(u.x+p.width/2,u.y+p.height/2,u.z),t.intersectsBoxMinMax(o,s)){var m=e.Vector3.Distance(u,t.origin);if(l>m&&(l=m,c=p,n))break}}}if(c){var _=new e.PickingInfo;return _.hit=!0,_.pickedSprite=c,_.distance=l,_}return null},t.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var t=this._scene.getEngine(),i=this._spriteTexture.getBaseSize(),r=t.getDeltaTime(),n=Math.min(this._capacity,this.sprites.length),a=i.width/this.cellWidth,o=0,s=0;s<n;s++){var l=this.sprites[__uv.$wrap((s))];l&&l.isVisible&&(l._animate(r),this._appendSpriteVertex(o++,l,0,0,a),this._appendSpriteVertex(o++,l,1,0,a),this._appendSpriteVertex(o++,l,1,1,a),this._appendSpriteVertex(o++,l,0,1,a))}this._buffer.update(this._vertexData);var c=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(c=this._effectFog),t.enableEffect(c);var u=this._scene.getViewMatrix();c.setTexture("diffuseSampler",this._spriteTexture),c.setMatrix("view",u),c.setMatrix("projection",this._scene.getProjectionMatrix()),c.setFloat2("textureInfos",this.cellWidth/i.width,this.cellHeight/i.height),this._scene.fogEnabled&&this._scene.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(c.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),c.setColor3("vFogColor",this._scene.fogColor)),t.bindBuffers(this._vertexBuffers,this._indexBuffer,c),this.blendMode==e.Engine.ALPHA_ADD?(t.setAlphaMode(e.Engine.ALPHA_ADD),t.drawElementsType(e.Material.TriangleFillMode,0,o/4*6),t.setAlphaMode(e.Engine.ALPHA_DISABLE)):(this.noAlphaTest||(t.setDepthFunctionToLessOrEqual(),c.setBool("alphaTest",!0),t.setColorWrite(!1),t.drawElementsType(e.Material.TriangleFillMode,0,o/4*6),t.setColorWrite(!0),c.setBool("alphaTest",!1)),t.setAlphaMode(e.Engine.ALPHA_COMBINE),t.drawElementsType(e.Material.TriangleFillMode,0,o/4*6),t.setAlphaMode(e.Engine.ALPHA_DISABLE))}},t.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t}();e.SpriteManager=t}(s||(s={})),function(e){var t=function(){function t(t,i){this.name=t,this.color=new e.Color4(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this.isVisible=!0,this._manager=i,this._manager.sprites.push(this),this.position=e.Vector3.Zero()}return Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!0,configurable:!0}),t.prototype.playAnimation=function(e,t,i,r,n){this._fromIndex=e,this._toIndex=t,this._loopAnimation=i,this._delay=r,this._animationStarted=!0,this._direction=e<t?1:-1,this.cellIndex=e,this._time=0,this._onAnimationEnd=n},t.prototype.stopAnimation=function(){this._animationStarted=!1},t.prototype._animate=function(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex>this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},t.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[__uv.$wrap((e))]==this&&this._manager.sprites.splice(e,1)},t}();e.Sprite=t}(s||(s={})),function(e){e.Scene.prototype._internalPickSprites=function(t,i,r,n){if(!e.PickingInfo)return null;var a=null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}if(this.spriteManagers.length>0)for(var o=0;o<this.spriteManagers.length;o++){var s=this.spriteManagers[__uv.$wrap((o))];if(s.isPickable){var l=s.intersects(t,n,i,r);if(l&&l.hit&&(r||null==a||!(l.distance>=a.distance))&&(a=l,r))break}}return a||new e.PickingInfo},e.Scene.prototype.pickSprite=function(e,t,i,r,n){return this.createPickingRayInCameraSpaceToRef(e,t,this._tempSpritePickingRay,n),this._internalPickSprites(this._tempSpritePickingRay,i,r,n)},e.Scene.prototype.pickSpriteWithRay=function(t,i,r,n){if(!this._tempSpritePickingRay)return null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}return e.Ray.TransformToRef(t,n.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,i,r,n)},e.Scene.prototype.setPointerOverSprite=function(t){this._pointerOverSprite!==t&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=t,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},e.Scene.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_SPRITE,this.scene=t,this.scene.spriteManagers=new Array,this.scene._tempSpritePickingRay=e.Ray?e.Ray.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new e.Observable,this.scene.onAfterSpritesRenderingObservable=new e.Observable,this._spritePredicate=function(e){return!!e.actionManager&&(e.isPickable&&e.actionManager.hasPointerTriggers)}}return t.prototype.register=function(){this.scene._pointerMoveStage.registerStep(e.SceneComponentConstants.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(e.SceneComponentConstants.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(e.SceneComponentConstants.STEP_POINTERUP_SPRITE,this,this._pointerUp)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var e=this.scene.spriteManagers;e.length;)e[__uv.$wrap((0))].dispose()},t.prototype._pickSpriteButKeepRay=function(e,t,i,r,n){var a=this.scene.pickSprite(t,i,this._spritePredicate,r,n);return a&&(a.ray=e?e.ray:null),a},t.prototype._pointerMove=function(e,t,i,r,n){var a=this.scene;return r?a.setPointerOverSprite(null):(i=this._pickSpriteButKeepRay(i,e,t,!1,a.cameraToUseForPointers||void 0))&&i.hit&&i.pickedSprite?(a.setPointerOverSprite(i.pickedSprite),a._pointerOverSprite&&a._pointerOverSprite.actionManager&&a._pointerOverSprite.actionManager.hoverCursor?n.style.cursor=a._pointerOverSprite.actionManager.hoverCursor:n.style.cursor=a.hoverCursor):a.setPointerOverSprite(null),i},t.prototype._pointerDown=function(t,i,r,n){var a=this.scene;if(a._pickedDownSprite=null,a.spriteManagers.length>0&&(r=a.pickSprite(t,i,this._spritePredicate,!1,a.cameraToUseForPointers||void 0))&&r.hit&&r.pickedSprite&&r.pickedSprite.actionManager){switch(a._pickedDownSprite=r.pickedSprite,n.button){case 0:r.pickedSprite.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNewFromSprite(r.pickedSprite,a,n));break;case 1:r.pickedSprite.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNewFromSprite(r.pickedSprite,a,n));break;case 2:r.pickedSprite.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNewFromSprite(r.pickedSprite,a,n))}r.pickedSprite.actionManager&&r.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickDownTrigger,e.ActionEvent.CreateNewFromSprite(r.pickedSprite,a,n))}return r},t.prototype._pointerUp=function(t,i,r,n){var a=this.scene;if(a.spriteManagers.length>0){var o=a.pickSprite(t,i,this._spritePredicate,!1,a.cameraToUseForPointers||void 0);o&&(o.hit&&o.pickedSprite&&o.pickedSprite.actionManager&&(o.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNewFromSprite(o.pickedSprite,a,n)),o.pickedSprite.actionManager&&(this.scene._isPointerSwiping()||o.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNewFromSprite(o.pickedSprite,a,n)))),a._pickedDownSprite&&a._pickedDownSprite.actionManager&&a._pickedDownSprite!==o.pickedSprite&&a._pickedDownSprite.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger,e.ActionEvent.CreateNewFromSprite(a._pickedDownSprite,a,n)))}return r},t}();e.SpriteSceneComponent=t}(s||(s={})),function(e){var t=function(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0};e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return t.prototype.getNormal=function(t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var r,n=this.pickedMesh.getIndices();if(!n)return null;if(i){var a=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),o=e.Vector3.FromArray(a,3*n[__uv.$wrap((3*this.faceId))]),s=e.Vector3.FromArray(a,3*n[__uv.$wrap((3*this.faceId+1))]),l=e.Vector3.FromArray(a,3*n[__uv.$wrap((3*this.faceId+2))]);o=o.scale(this.bu),s=s.scale(this.bv),l=l.scale(1-this.bu-this.bv),r=new e.Vector3(o.x+s.x+l.x,o.y+s.y+l.y,o.z+s.z+l.z)}else{var c=this.pickedMesh.getVerticesData(e.VertexBuffer.PositionKind),u=e.Vector3.FromArray(c,3*n[__uv.$wrap((3*this.faceId))]),h=e.Vector3.FromArray(c,3*n[__uv.$wrap((3*this.faceId+1))]),d=e.Vector3.FromArray(c,3*n[__uv.$wrap((3*this.faceId+2))]),p=u.subtract(h),m=d.subtract(h);r=e.Vector3.Cross(p,m)}if(t){var _=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(e.Tmp.Matrix[__uv.$wrap((0))].copyFrom(_),(_=e.Tmp.Matrix[__uv.$wrap((0))]).setTranslationFromFloats(0,0,0),_.invert(),_.transposeToRef(e.Tmp.Matrix[__uv.$wrap((1))]),_=e.Tmp.Matrix[__uv.$wrap((1))]),r=e.Vector3.TransformNormal(r,_)}return r.normalize(),r},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices();if(!t)return null;var i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind);if(!i)return null;var r=e.Vector2.FromArray(i,2*t[__uv.$wrap((3*this.faceId))]),n=e.Vector2.FromArray(i,2*t[__uv.$wrap((3*this.faceId+1))]),a=e.Vector2.FromArray(i,2*t[__uv.$wrap((3*this.faceId+2))]);return r=r.scale(1-this.bu-this.bv),n=n.scale(this.bu),a=a.scale(this.bv),new e.Vector2(r.x+n.x+a.x,r.y+n.y+a.y)},t}();e.PickingInfo=i}(s||(s={})),function(e){var t=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i,r,n,a,o=0,s=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else if(i=1/this.direction.x,r=(e.x-this.origin.x)*i,(n=(t.x-this.origin.x)*i)===-1/0&&(n=1/0),r>n&&(a=r,r=n,n=a),(o=Math.max(r,o))>(s=Math.min(n,s)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(i=1/this.direction.y,r=(e.y-this.origin.y)*i,(n=(t.y-this.origin.y)*i)===-1/0&&(n=1/0),r>n&&(a=r,r=n,n=a),(o=Math.max(r,o))>(s=Math.min(n,s)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(i=1/this.direction.z,r=(e.z-this.origin.z)*i,(n=(t.z-this.origin.z)*i)===-1/0&&(n=1/0),r>n&&(a=r,r=n,n=a),(o=Math.max(r,o))>(s=Math.min(n,s)))return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=t*t+i*i+r*r,a=e.radius*e.radius;if(n<=a)return!0;var o=t*this.direction.x+i*this.direction.y+r*this.direction.z;return!(o<0)&&n-o*o<=a},t.prototype.intersectsTriangle=function(t,i,r){this._edge1||(this._edge1=e.Vector3.Zero(),this._edge2=e.Vector3.Zero(),this._pvec=e.Vector3.Zero(),this._tvec=e.Vector3.Zero(),this._qvec=e.Vector3.Zero()),i.subtractToRef(t,this._edge1),r.subtractToRef(t,this._edge2),e.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);var n=e.Vector3.Dot(this._edge1,this._pvec);if(0===n)return null;var a=1/n;this.origin.subtractToRef(t,this._tvec);var o=e.Vector3.Dot(this._tvec,this._pvec)*a;if(o<0||o>1)return null;e.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);var s=e.Vector3.Dot(this.direction,this._qvec)*a;if(s<0||o+s>1)return null;var l=e.Vector3.Dot(this._edge2,this._qvec)*a;return l>this.length?null:new e.IntersectionInfo(o,s,l)},t.prototype.intersectsPlane=function(t){var i,r=e.Vector3.Dot(t.normal,this.direction);if(Math.abs(r)<9.99999997475243e-7)return null;var n=e.Vector3.Dot(t.normal,this.origin);return(i=(-t.d-n)/r)<0?i<-9.99999997475243e-7?null:0:i},t.prototype.intersectsMesh=function(i,r){var n=e.Tmp.Matrix[__uv.$wrap((0))];return i.getWorldMatrix().invertToRef(n),this._tmpRay?t.TransformToRef(this,n,this._tmpRay):this._tmpRay=t.Transform(this,n),i.intersects(this._tmpRay,r)},t.prototype.intersectsMeshes=function(e,t,i){i?i.length=0:i=[];for(var r=0;r<e.length;r++){var n=this.intersectsMesh(e[__uv.$wrap((r))],t);n.hit&&i.push(n)}return i.sort(this._comparePickingInfo),i},t.prototype._comparePickingInfo=function(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0},t.prototype.intersectionSegment=function(i,r,n){var a,o,s,l,c=this.origin.add(this.direction.multiplyByFloats(t.rayl,t.rayl,t.rayl)),u=r.subtract(i),h=c.subtract(this.origin),d=i.subtract(this.origin),p=e.Vector3.Dot(u,u),m=e.Vector3.Dot(u,h),_=e.Vector3.Dot(h,h),f=e.Vector3.Dot(u,d),g=e.Vector3.Dot(h,d),y=p*_-m*m,v=y,b=y;y<t.smallnum?(o=0,v=1,l=g,b=_):(l=p*g-m*f,(o=m*g-_*f)<0?(o=0,l=g,b=_):o>v&&(o=v,l=g+m,b=_)),l<0?(l=0,-f<0?o=0:-f>p?o=v:(o=-f,v=p)):l>b&&(l=b,-f+m<0?o=0:-f+m>p?o=v:(o=-f+m,v=p)),a=Math.abs(o)<t.smallnum?0:o/v,s=Math.abs(l)<t.smallnum?0:l/b;var x=h.multiplyByFloats(s,s,s),S=d.add(u.multiplyByFloats(a,a,a)).subtract(x);return s>0&&s<=this.length&&S.lengthSquared()<n*n?x.length():-1},t.prototype.update=function(t,i,r,n,a,o,s){return e.Vector3.UnprojectFloatsToRef(t,i,0,r,n,a,o,s,this.origin),e.Vector3.UnprojectFloatsToRef(t,i,1,r,n,a,o,s,e.Tmp.Vector3[__uv.$wrap((0))]),e.Tmp.Vector3[__uv.$wrap((0))].subtractToRef(this.origin,this.direction),this.direction.normalize(),this},t.Zero=function(){return new t(e.Vector3.Zero(),e.Vector3.Zero())},t.CreateNew=function(e,i,r,n,a,o,s){return t.Zero().update(e,i,r,n,a,o,s)},t.CreateNewFromTo=function(i,r,n){void 0===n&&(n=e.Matrix.Identity());var a=r.subtract(i),o=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);return a.normalize(),t.Transform(new t(i,a,o),n)},t.Transform=function(i,r){var n=new t(new e.Vector3(0,0,0),new e.Vector3(0,0,0));return t.TransformToRef(i,r,n),n},t.TransformToRef=function(t,i,r){e.Vector3.TransformCoordinatesToRef(t.origin,i,r.origin),e.Vector3.TransformNormalToRef(t.direction,i,r.direction),r.length=t.length;var n=r.direction,a=n.length();if(0!==a&&1!==a){var o=1/a;n.x*=o,n.y*=o,n.z*=o,r.length*=a}},t.smallnum=1e-8,t.rayl=1e9,t}();e.Ray=t}(s||(s={})),function(e){var t,i=(t={root:0,found:!1},function(e,i,r,n){t.root=0,t.found=!1;var a=i*i-4*e*r;if(a<0)return t;var o=Math.sqrt(a),s=(-i-o)/(2*e),l=(-i+o)/(2*e);if(s>l){var c=l;l=s,s=c}return s>0&&s<n?(t.root=s,t.found=!0,t):l>0&&l<n?(t.root=l,t.found=!0,t):t}),r=function(){function t(){this._collisionPoint=e.Vector3.Zero(),this._planeIntersectionPoint=e.Vector3.Zero(),this._tempVector=e.Vector3.Zero(),this._tempVector2=e.Vector3.Zero(),this._tempVector3=e.Vector3.Zero(),this._tempVector4=e.Vector3.Zero(),this._edge=e.Vector3.Zero(),this._baseToVertex=e.Vector3.Zero(),this._destinationPoint=e.Vector3.Zero(),this._slidePlaneNormal=e.Vector3.Zero(),this._displacementVector=e.Vector3.Zero(),this._radius=e.Vector3.One(),this._retry=0,this._basePointWorld=e.Vector3.Zero(),this._velocityWorld=e.Vector3.Zero(),this._normalizedVelocity=e.Vector3.Zero(),this._collisionMask=-1}return Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),t.prototype._initialize=function(t,i,r){this._velocity=i,e.Vector3.NormalizeToRef(i,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),i.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=r,this.collisionFound=!1},t.prototype._checkPointInTriangle=function(t,i,r,n,a){i.subtractToRef(t,this._tempVector),r.subtractToRef(t,this._tempVector2),e.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var o=e.Vector3.Dot(this._tempVector4,a);return!(o<0)&&(n.subtractToRef(t,this._tempVector3),e.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((o=e.Vector3.Dot(this._tempVector4,a))<0)&&(e.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(o=e.Vector3.Dot(this._tempVector4,a))>=0))},t.prototype._canDoCollision=function(t,i,r,n){var a=e.Vector3.Distance(this._basePointWorld,t),o=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(a>this._velocityWorldLength+o+i)&&!!function(e,t,i,r){return!(e.x>i.x+r)&&(!(i.x-r>t.x)&&(!(e.y>i.y+r)&&(!(i.y-r>t.y)&&(!(e.z>i.z+r)&&!(i.z-r>t.z)))))}(r,n,this._basePointWorld,this._velocityWorldLength+o)},t.prototype._testTriangle=function(t,r,n,a,o,s){var l,c=!1;r||(r=[]),r[__uv.$wrap((t))]||(r[__uv.$wrap((t))]=new e.Plane(0,0,0,0),r[__uv.$wrap((t))].copyFromPoints(n,a,o));var u=r[__uv.$wrap((t))];if(s||u.isFrontFacingTo(this._normalizedVelocity,0)){var h=u.signedDistanceTo(this._basePoint),d=e.Vector3.Dot(u.normal,this._velocity);if(0==d){if(Math.abs(h)>=1)return;c=!0,l=0}else{var p=(1-h)/d;if((l=(-1-h)/d)>p){var m=p;p=l,l=m}if(l>1||p<0)return;l<0&&(l=0),l>1&&(l=1)}this._collisionPoint.copyFromFloats(0,0,0);var _=!1,f=1;if(c||(this._basePoint.subtractToRef(u.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(l,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,a,o,u.normal)&&(_=!0,f=l,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!_){var g=this._velocity.lengthSquared(),y=g;this._basePoint.subtractToRef(n,this._tempVector);var v=2*e.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,x=i(y,v,b,f);x.found&&(f=x.root,_=!0,this._collisionPoint.copyFrom(n)),this._basePoint.subtractToRef(a,this._tempVector),v=2*e.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,(x=i(y,v,b,f)).found&&(f=x.root,_=!0,this._collisionPoint.copyFrom(a)),this._basePoint.subtractToRef(o,this._tempVector),v=2*e.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,(x=i(y,v,b,f)).found&&(f=x.root,_=!0,this._collisionPoint.copyFrom(o)),a.subtractToRef(n,this._edge),n.subtractToRef(this._basePoint,this._baseToVertex);var S=this._edge.lengthSquared(),T=e.Vector3.Dot(this._edge,this._velocity),E=e.Vector3.Dot(this._edge,this._baseToVertex);if(y=S*-g+T*T,v=S*(2*e.Vector3.Dot(this._velocity,this._baseToVertex))-2*T*E,b=S*(1-this._baseToVertex.lengthSquared())+E*E,(x=i(y,v,b,f)).found){var P=(T*x.root-E)/S;P>=0&&P<=1&&(f=x.root,_=!0,this._edge.scaleInPlace(P),n.addToRef(this._edge,this._collisionPoint))}o.subtractToRef(a,this._edge),a.subtractToRef(this._basePoint,this._baseToVertex),S=this._edge.lengthSquared(),T=e.Vector3.Dot(this._edge,this._velocity),E=e.Vector3.Dot(this._edge,this._baseToVertex),y=S*-g+T*T,v=S*(2*e.Vector3.Dot(this._velocity,this._baseToVertex))-2*T*E,b=S*(1-this._baseToVertex.lengthSquared())+E*E,(x=i(y,v,b,f)).found&&(P=(T*x.root-E)/S)>=0&&P<=1&&(f=x.root,_=!0,this._edge.scaleInPlace(P),a.addToRef(this._edge,this._collisionPoint)),n.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex),S=this._edge.lengthSquared(),T=e.Vector3.Dot(this._edge,this._velocity),E=e.Vector3.Dot(this._edge,this._baseToVertex),y=S*-g+T*T,v=S*(2*e.Vector3.Dot(this._velocity,this._baseToVertex))-2*T*E,b=S*(1-this._baseToVertex.lengthSquared())+E*E,(x=i(y,v,b,f)).found&&(P=(T*x.root-E)/S)>=0&&P<=1&&(f=x.root,_=!0,this._edge.scaleInPlace(P),o.addToRef(this._edge,this._collisionPoint))}if(_){var A=f*this._velocity.length();(!this.collisionFound||A<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=A,this.collisionFound=!0)}}},t.prototype._collide=function(e,t,i,r,n,a,o){for(var s=r;s<n;s+=3){var l=t[__uv.$wrap((i[__uv.$wrap((s))]-a))],c=t[__uv.$wrap((i[__uv.$wrap((s+1))]-a))],u=t[__uv.$wrap((i[__uv.$wrap((s+2))]-a))];this._testTriangle(s,e,u,c,l,o)}},t.prototype._getResponse=function(t,i){t.addToRef(i,this._destinationPoint),i.scaleInPlace(this._nearestDistance/i.length()),this._basePoint.addToRef(i,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(e.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,i)},t}();e.Collider=r}(s||(s={})),function(e){var t,i;e.CollisionWorker="",function(e){e[__uv.$wrap((e.INIT=0))]="INIT",e[__uv.$wrap((e.UPDATE=1))]="UPDATE",e[__uv.$wrap((e.COLLIDE=2))]="COLLIDE"}(t=e.WorkerTaskType||(e.WorkerTaskType={})),function(e){e[__uv.$wrap((e.SUCCESS=0))]="SUCCESS",e[__uv.$wrap((e.UNKNOWN_ERROR=1))]="UNKNOWN_ERROR"}(i=e.WorkerReplyType||(e.WorkerReplyType={}));var r=function(){function r(){var n=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){n._addUpdateMeshesList[__uv.$wrap((e.uniqueId))]=r.SerializeMesh(e)},this.onGeometryUpdated=function(e){n._addUpdateGeometriesList[__uv.$wrap((e.id))]=r.SerializeGeometry(e)},this._afterRender=function(){if(n._init&&!(0==n._toRemoveGeometryArray.length&&0==n._toRemoveMeshesArray.length&&0==Object.keys(n._addUpdateGeometriesList).length&&0==Object.keys(n._addUpdateMeshesList).length||n._runningUpdated>4)){++n._runningUpdated;var e={updatedMeshes:n._addUpdateMeshesList,updatedGeometries:n._addUpdateGeometriesList,removedGeometries:n._toRemoveGeometryArray,removedMeshes:n._toRemoveMeshesArray},i={payload:e,taskType:t.UPDATE},r=[];for(var a in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(a)&&(r.push(i.payload.updatedGeometries[__uv.$wrap((a))].indices.buffer),r.push(i.payload.updatedGeometries[__uv.$wrap((a))].normals.buffer),r.push(i.payload.updatedGeometries[__uv.$wrap((a))].positions.buffer));n._worker.__uv$setSource(__uv).postMessage(i,r),n._addUpdateMeshesList={},n._addUpdateGeometriesList={},n._toRemoveGeometryArray=[],n._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(r){var a=r.data;if(a.error==i.SUCCESS)switch(a.taskType){case t.INIT:n._init=!0,n._scene.meshes.forEach((function(e){n.onMeshAdded(e)})),n._scene.getGeometries().forEach((function(e){n.onGeometryAdded(e)}));break;case t.UPDATE:n._runningUpdated--;break;case t.COLLIDE:var o=a.payload;if(!n._collisionsCallbackArray[__uv.$wrap((o.collisionId))])return;var s=n._collisionsCallbackArray[__uv.$wrap((o.collisionId))];if(s){var l=n._scene.getMeshByUniqueID(o.collidedMeshUniqueId);l&&s(o.collisionId,e.Vector3.FromArray(o.newPosition),l)}n._collisionsCallbackArray[__uv.$wrap((o.collisionId))]=null}else e.Tools.Warn("error returned from worker!")},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return r.prototype.getNewPosition=function(e,i,r,n,a,o,s){if(this._init&&!this._collisionsCallbackArray[__uv.$wrap((s))]&&!this._collisionsCallbackArray[__uv.$wrap((s+1e5))]){e.divideToRef(r._radius,this._scaledPosition),i.divideToRef(r._radius,this._scaledVelocity),this._collisionsCallbackArray[__uv.$wrap((s))]=o;var l={payload:{collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:r._radius.asArray()},collisionId:s,excludedMeshUniqueId:a?a.uniqueId:null,maximumRetry:n},taskType:t.COLLIDE};this._worker.__uv$setSource(__uv).postMessage(l)}},r.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var r=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(r),this._worker.onmessage=this._onMessageFromWorker;var n={payload:{},taskType:t.INIT};this._worker.__uv$setSource(__uv).postMessage(n)},r.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},r.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},r.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},r.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},r.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},r.SerializeMesh=function(t){var i=[];t.subMeshes&&(i=t.subMeshes.map((function(e,t){var i=e.getBoundingInfo();return{position:t,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:i.boundingSphere.centerWorld.asArray(),sphereRadius:i.boundingSphere.radiusWorld,boxMinimum:i.boundingBox.minimumWorld.asArray(),boxMaximum:i.boundingBox.maximumWorld.asArray()}})));var r=null;if(t instanceof e.Mesh)r=(n=t.geometry)?n.id:null;else if(t instanceof e.InstancedMesh){var n;r=(n=t.sourceMesh&&t.sourceMesh.geometry)?n.id:null}var a=t.getBoundingInfo();return{uniqueId:t.uniqueId,id:t.id,name:t.name,geometryId:r,sphereCenter:a.boundingSphere.centerWorld.asArray(),sphereRadius:a.boundingSphere.radiusWorld,boxMinimum:a.boundingBox.minimumWorld.asArray(),boxMaximum:a.boundingBox.maximumWorld.asArray(),worldMatrixFromCache:t.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:t.checkCollisions}},r.SerializeGeometry=function(t){return{id:t.id,positions:new Float32Array(t.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(t.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Uint32Array(t.getIndices()||[])}},r}();e.CollisionCoordinatorWorker=r;var n=function(){function t(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return t.prototype.getNewPosition=function(e,t,i,r,n,a,o){e.divideToRef(i._radius,this._scaledPosition),t.divideToRef(i._radius,this._scaledVelocity),i.collidedMesh=null,i._retry=0,i._initialVelocity=this._scaledVelocity,i._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,r,this._finalPosition,n),this._finalPosition.multiplyInPlace(i._radius),a(o,this._finalPosition,i.collidedMesh)},t.prototype.init=function(e){this._scene=e},t.prototype.destroy=function(){},t.prototype.onMeshAdded=function(e){},t.prototype.onMeshUpdated=function(e){},t.prototype.onMeshRemoved=function(e){},t.prototype.onGeometryAdded=function(e){},t.prototype.onGeometryUpdated=function(e){},t.prototype.onGeometryDeleted=function(e){},t.prototype._collideWithWorld=function(t,i,r,n,a,o){void 0===o&&(o=null);var s=10*e.Engine.CollisionsEpsilon;if(r._retry>=n)a.copyFrom(t);else{var l=o?o.collisionMask:r.collisionMask;r._initialize(t,i,s);for(var c=0;c<this._scene.meshes.length;c++){var u=this._scene.meshes[__uv.$wrap((c))];u.isEnabled()&&u.checkCollisions&&u.subMeshes&&u!==o&&0!=(l&u.collisionGroup)&&u._checkCollision(r)}r.collisionFound?(0===i.x&&0===i.y&&0===i.z||r._getResponse(t,i),i.length()<=s?a.copyFrom(t):(r._retry++,this._collideWithWorld(t,i,r,n,a,o))):t.addToRef(i,a)}},t}();e.CollisionCoordinatorLegacy=n}(s||(s={})),function(e){var t=function(){function t(i){this.particleSystem=i,this.position=e.Vector3.Zero(),this.direction=e.Vector3.Zero(),this.color=new e.Color4(0,0,0,0),this.colorStep=new e.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new e.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new e.Color4(0,0,0,0),this._currentColor2=new e.Color4(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=t._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return t.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},t.prototype.updateCellIndex=function(){var t=this.age,i=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===i?(i=1,t=this._randomCellOffset):t+=this._randomCellOffset);var r=this._initialEndSpriteCellID-this._initialStartSpriteCellID,n=e.Scalar.Clamp(t*i%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+n*r|0},t.prototype._inheritParticleInfoToSubEmitter=function(t){if(t.particleSystem.emitter.position){var i=t.particleSystem.emitter;i.position.copyFrom(this.position),t.inheritDirection&&(i.position.subtractToRef(this.direction,e.Tmp.Vector3[__uv.$wrap((0))]),i.lookAt(e.Tmp.Vector3[__uv.$wrap((0))],0,Math.PI/2))}else{t.particleSystem.emitter.copyFrom(this.position)}this.direction.scaleToRef(t.inheritedVelocityAmount/2,e.Tmp.Vector3[__uv.$wrap((0))]),t.particleSystem._inheritedVelocityOffset.copyFrom(e.Tmp.Vector3[__uv.$wrap((0))])},t.prototype._inheritParticleInfoToSubEmitters=function(){var e=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((function(t){e._inheritParticleInfoToSubEmitter(t)}))},t.prototype._reset=function(){this.age=0,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},t.prototype.copyTo=function(e){e.position.copyFrom(this.position),this._initialDirection?e._initialDirection?e._initialDirection.copyFrom(this._initialDirection):e._initialDirection=this._initialDirection.clone():e._initialDirection=null,e.direction.copyFrom(this.direction),e.color.copyFrom(this.color),e.colorStep.copyFrom(this.colorStep),e.lifeTime=this.lifeTime,e.age=this.age,e._randomCellOffset=this._randomCellOffset,e.size=this.size,e.scale.copyFrom(this.scale),e.angle=this.angle,e.angularSpeed=this.angularSpeed,e.particleSystem=this.particleSystem,e.cellIndex=this.cellIndex,e.id=this.id,e._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(e._currentColorGradient=this._currentColorGradient,e._currentColor1.copyFrom(this._currentColor1),e._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(e._currentSizeGradient=this._currentSizeGradient,e._currentSize1=this._currentSize1,e._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(e._currentAngularSpeedGradient=this._currentAngularSpeedGradient,e._currentAngularSpeed1=this._currentAngularSpeed1,e._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(e._currentVelocityGradient=this._currentVelocityGradient,e._currentVelocity1=this._currentVelocity1,e._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(e._currentLimitVelocityGradient=this._currentLimitVelocityGradient,e._currentLimitVelocity1=this._currentLimitVelocity1,e._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(e._currentDragGradient=this._currentDragGradient,e._currentDrag1=this._currentDrag1,e._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(e._initialStartSpriteCellID=this._initialStartSpriteCellID,e._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&e.remapData.copyFrom(this.remapData),this._randomNoiseCoordinates1&&(e._randomNoiseCoordinates1?(e._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),e._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(e._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),e._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},t._Count=0,t}();e.Particle=t}(s||(s={})),function(e){var t=function(){function t(t){this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new e.Vector3(10,10,10),this.onAnimationEnd=null,this.blendMode=e.ParticleSystem.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new e.Vector2(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.gravity=e.Vector3.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new e.Color4(1,1,1,1),this.color2=new e.Color4(1,1,1,1),this.colorDead=new e.Color4(0,0,0,1),this.textureMask=new e.Color4(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=e.ParticleSystem.BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new e.ImageProcessingConfigurationDefines,this.id=t,this.name=t}return Object.defineProperty(t.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},t.prototype.getDragGradients=function(){return this._dragGradients},t.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},t.prototype.getColorGradients=function(){return this._colorGradients},t.prototype.getSizeGradients=function(){return this._sizeGradients},t.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},t.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},t.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},t.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},t.prototype.getVelocityGradients=function(){return this._velocityGradients},t.prototype.getStartSizeGradients=function(){return this._startSizeGradients},t.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(t.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:e.Vector3.Zero()},set:function(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:e.Vector3.Zero()},set:function(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:e.Vector3.Zero()},set:function(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:e.Vector3.Zero()},set:function(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e)},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration=e||this._scene.imageProcessingConfiguration)},t.prototype._reset=function(){},t.prototype._removeGradientAndTexture=function(e,t,i){if(!t)return this;for(var r=0,n=0,a=t;n<a.length;n++){if(a[__uv.$wrap((n))].gradient===e){t.splice(r,1);break}r++}return i&&i.dispose(),this},t.prototype.createPointEmitter=function(t,i){var r=new e.PointParticleEmitter;return r.direction1=t,r.direction2=i,this.particleEmitterType=r,r},t.prototype.createHemisphericEmitter=function(t,i){void 0===t&&(t=1),void 0===i&&(i=1);var r=new e.HemisphericParticleEmitter(t,i);return this.particleEmitterType=r,r},t.prototype.createSphereEmitter=function(t,i){void 0===t&&(t=1),void 0===i&&(i=1);var r=new e.SphereParticleEmitter(t,i);return this.particleEmitterType=r,r},t.prototype.createDirectedSphereEmitter=function(t,i,r){void 0===t&&(t=1),void 0===i&&(i=new e.Vector3(0,1,0)),void 0===r&&(r=new e.Vector3(0,1,0));var n=new e.SphereDirectedParticleEmitter(t,i,r);return this.particleEmitterType=n,n},t.prototype.createCylinderEmitter=function(t,i,r,n){void 0===t&&(t=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=0);var a=new e.CylinderParticleEmitter(t,i,r,n);return this.particleEmitterType=a,a},t.prototype.createDirectedCylinderEmitter=function(t,i,r,n,a){void 0===t&&(t=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=new e.Vector3(0,1,0)),void 0===a&&(a=new e.Vector3(0,1,0));var o=new e.CylinderDirectedParticleEmitter(t,i,r,n,a);return this.particleEmitterType=o,o},t.prototype.createConeEmitter=function(t,i){void 0===t&&(t=1),void 0===i&&(i=Math.PI/4);var r=new e.ConeParticleEmitter(t,i);return this.particleEmitterType=r,r},t.prototype.createBoxEmitter=function(t,i,r,n){var a=new e.BoxParticleEmitter;return this.particleEmitterType=a,this.direction1=t,this.direction2=i,this.minEmitBox=r,this.maxEmitBox=n,a},t.BLENDMODE_ONEONE=0,t.BLENDMODE_STANDARD=1,t.BLENDMODE_ADD=2,t.BLENDMODE_MULTIPLY=3,t.BLENDMODE_MULTIPLYADD=4,t}();e.BaseParticleSystem=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s){void 0===a&&(a=null),void 0===o&&(o=!1),void 0===s&&(s=.01);var l=t.call(this,i)||this;return l._inheritedVelocityOffset=new e.Vector3,l.onDisposeObservable=new e.Observable,l._particles=new Array,l._stockParticles=new Array,l._newPartsExcess=0,l._vertexBuffers={},l._scaledColorStep=new e.Color4(0,0,0,0),l._colorDiff=new e.Color4(0,0,0,0),l._scaledDirection=e.Vector3.Zero(),l._scaledGravity=e.Vector3.Zero(),l._currentRenderId=-1,l._useInstancing=!1,l._started=!1,l._stopped=!1,l._actualFrame=0,l._currentEmitRate1=0,l._currentEmitRate2=0,l._currentStartSize1=0,l._currentStartSize2=0,l._rawTextureWidth=256,l._useRampGradients=!1,l._disposeEmitterOnDispose=!1,l.recycleParticle=function(e){var t=l._particles.pop();t!==e&&t.copyTo(e),l._stockParticles.push(t)},l._createParticle=function(){var t;if(0!==l._stockParticles.length?(t=l._stockParticles.pop())._reset():t=new e.Particle(l),l._subEmitters&&l._subEmitters.length>0){var i=l._subEmitters[__uv.$wrap((Math.floor(Math.random()*l._subEmitters.length)))];t._attachedSubEmitters=[],i.forEach((function(i){if(i.type===e.SubEmitterType.ATTACHED){var r=i.clone();t._attachedSubEmitters.push(r),r.particleSystem.start()}}))}return t},l._emitFromParticle=function(t){if(l._subEmitters&&0!==l._subEmitters.length){var i=Math.floor(Math.random()*l._subEmitters.length);l._subEmitters[__uv.$wrap((i))].forEach((function(i){if(i.type===e.SubEmitterType.END){var r=i.clone();t._inheritParticleInfoToSubEmitter(r),r.particleSystem._rootParticleSystem=l,l.activeSubSystems.push(r.particleSystem),r.particleSystem.start()}}))}},l._capacity=r,l._epsilon=s,l._isAnimationSheetEnabled=o,l._scene=n||e.Engine.LastCreatedScene,l._attachImageProcessingConfiguration(null),l._customEffect=a,l._scene.particleSystems.push(l),l._useInstancing=l._scene.getEngine().getCaps().instancedArrays,l._createIndexBuffer(),l._createVertexBuffers(),l.particleEmitterType=new e.BoxParticleEmitter,l.updateFunction=function(t){var i=null,r=null;l.noiseTexture&&(i=l.noiseTexture.getSize(),r=l.noiseTexture.getContent());for(var n,a=function(){n=t[__uv.$wrap((o))];var a=l._scaledUpdateSpeed,s=n.age;if(n.age+=a,n.age>n.lifeTime){var c=n.age-s;a=(n.lifeTime-s)*a/c,n.age=n.lifeTime}var u=n.age/n.lifeTime;l._colorGradients&&l._colorGradients.length>0?e.Tools.GetCurrentGradient(u,l._colorGradients,(function(t,i,r){t!==n._currentColorGradient&&(n._currentColor1.copyFrom(n._currentColor2),i.getColorToRef(n._currentColor2),n._currentColorGradient=t),e.Color4.LerpToRef(n._currentColor1,n._currentColor2,r,n.color)})):(n.colorStep.scaleToRef(a,l._scaledColorStep),n.color.addInPlace(l._scaledColorStep),n.color.a<0&&(n.color.a=0)),l._angularSpeedGradients&&l._angularSpeedGradients.length>0&&e.Tools.GetCurrentGradient(u,l._angularSpeedGradients,(function(t,i,r){t!==n._currentAngularSpeedGradient&&(n._currentAngularSpeed1=n._currentAngularSpeed2,n._currentAngularSpeed2=i.getFactor(),n._currentAngularSpeedGradient=t),n.angularSpeed=e.Scalar.Lerp(n._currentAngularSpeed1,n._currentAngularSpeed2,r)})),n.angle+=n.angularSpeed*a;var h=a;if(l._velocityGradients&&l._velocityGradients.length>0&&e.Tools.GetCurrentGradient(u,l._velocityGradients,(function(t,i,r){t!==n._currentVelocityGradient&&(n._currentVelocity1=n._currentVelocity2,n._currentVelocity2=i.getFactor(),n._currentVelocityGradient=t),h*=e.Scalar.Lerp(n._currentVelocity1,n._currentVelocity2,r)})),n.direction.scaleToRef(h,l._scaledDirection),l._limitVelocityGradients&&l._limitVelocityGradients.length>0&&e.Tools.GetCurrentGradient(u,l._limitVelocityGradients,(function(t,i,r){t!==n._currentLimitVelocityGradient&&(n._currentLimitVelocity1=n._currentLimitVelocity2,n._currentLimitVelocity2=i.getFactor(),n._currentLimitVelocityGradient=t);var a=e.Scalar.Lerp(n._currentLimitVelocity1,n._currentLimitVelocity2,r);n.direction.length()>a&&n.direction.scaleInPlace(l.limitVelocityDamping)})),l._dragGradients&&l._dragGradients.length>0&&e.Tools.GetCurrentGradient(u,l._dragGradients,(function(t,i,r){t!==n._currentDragGradient&&(n._currentDrag1=n._currentDrag2,n._currentDrag2=i.getFactor(),n._currentDragGradient=t);var a=e.Scalar.Lerp(n._currentDrag1,n._currentDrag2,r);l._scaledDirection.scaleInPlace(1-a)})),n.position.addInPlace(l._scaledDirection),r&&i){var d=l._fetchR(n._randomNoiseCoordinates1.x,n._randomNoiseCoordinates1.y,i.width,i.height,r),p=l._fetchR(n._randomNoiseCoordinates1.z,n._randomNoiseCoordinates2.x,i.width,i.height,r),m=l._fetchR(n._randomNoiseCoordinates2.y,n._randomNoiseCoordinates2.z,i.width,i.height,r),_=e.Tmp.Vector3[__uv.$wrap((0))],f=e.Tmp.Vector3[__uv.$wrap((1))];_.copyFromFloats((2*d-1)*l.noiseStrength.x,(2*p-1)*l.noiseStrength.y,(2*m-1)*l.noiseStrength.z),_.scaleToRef(a,f),n.direction.addInPlace(f)}if(l.gravity.scaleToRef(a,l._scaledGravity),n.direction.addInPlace(l._scaledGravity),l._sizeGradients&&l._sizeGradients.length>0&&e.Tools.GetCurrentGradient(u,l._sizeGradients,(function(t,i,r){t!==n._currentSizeGradient&&(n._currentSize1=n._currentSize2,n._currentSize2=i.getFactor(),n._currentSizeGradient=t),n.size=e.Scalar.Lerp(n._currentSize1,n._currentSize2,r)})),l._useRampGradients&&(l._colorRemapGradients&&l._colorRemapGradients.length>0&&e.Tools.GetCurrentGradient(u,l._colorRemapGradients,(function(t,i,r){var a=e.Scalar.Lerp(t.factor1,i.factor1,r),o=e.Scalar.Lerp(t.factor2,i.factor2,r);n.remapData.x=a,n.remapData.y=o-a})),l._alphaRemapGradients&&l._alphaRemapGradients.length>0&&e.Tools.GetCurrentGradient(u,l._alphaRemapGradients,(function(t,i,r){var a=e.Scalar.Lerp(t.factor1,i.factor1,r),o=e.Scalar.Lerp(t.factor2,i.factor2,r);n.remapData.z=a,n.remapData.w=o-a}))),l._isAnimationSheetEnabled&&n.updateCellIndex(),n._inheritParticleInfoToSubEmitters(),n.age>=n.lifeTime)return l._emitFromParticle(n),n._attachedSubEmitters&&(n._attachedSubEmitters.forEach((function(e){e.particleSystem.disposeOnStop=!0,e.particleSystem.stop()})),n._attachedSubEmitters=null),l.recycleParticle(n),o--,"continue"},o=0;o<t.length;o++)a()},l}return a(i,t),Object.defineProperty(i.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"particles",{get:function(){return this._particles},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"ParticleSystem"},i.prototype._addFactorGradient=function(t,i,r,n){var a=new e.FactorGradient;a.gradient=i,a.factor1=r,a.factor2=n,t.push(a),t.sort((function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}))},i.prototype._removeFactorGradient=function(e,t){if(e)for(var i=0,r=0,n=e;r<n.length;r++){if(n[__uv.$wrap((r))].gradient===t){e.splice(i,1);break}i++}},i.prototype.addLifeTimeGradient=function(e,t,i){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,t,i),this},i.prototype.removeLifeTimeGradient=function(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this},i.prototype.addSizeGradient=function(e,t,i){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,t,i),this},i.prototype.removeSizeGradient=function(e){return this._removeFactorGradient(this._sizeGradients,e),this},i.prototype.addColorRemapGradient=function(e,t,i){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,t,i),this},i.prototype.removeColorRemapGradient=function(e){return this._removeFactorGradient(this._colorRemapGradients,e),this},i.prototype.addAlphaRemapGradient=function(e,t,i){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,t,i),this},i.prototype.removeAlphaRemapGradient=function(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this},i.prototype.addAngularSpeedGradient=function(e,t,i){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,t,i),this},i.prototype.removeAngularSpeedGradient=function(e){return this._removeFactorGradient(this._angularSpeedGradients,e),this},i.prototype.addVelocityGradient=function(e,t,i){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,t,i),this},i.prototype.removeVelocityGradient=function(e){return this._removeFactorGradient(this._velocityGradients,e),this},i.prototype.addLimitVelocityGradient=function(e,t,i){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,t,i),this},i.prototype.removeLimitVelocityGradient=function(e){return this._removeFactorGradient(this._limitVelocityGradients,e),this},i.prototype.addDragGradient=function(e,t,i){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,t,i),this},i.prototype.removeDragGradient=function(e){return this._removeFactorGradient(this._dragGradients,e),this},i.prototype.addEmitRateGradient=function(e,t,i){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,t,i),this},i.prototype.removeEmitRateGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},i.prototype.addStartSizeGradient=function(e,t,i){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,t,i),this},i.prototype.removeStartSizeGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},i.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture){for(var t=new Uint8Array(4*this._rawTextureWidth),i=e.Tmp.Color3[__uv.$wrap((0))],r=0;r<this._rawTextureWidth;r++){var n=r/this._rawTextureWidth;e.Tools.GetCurrentGradient(n,this._rampGradients,(function(n,a,o){e.Color3.LerpToRef(n.color,a.color,o,i),t[__uv.$wrap((4*r))]=255*i.r,t[__uv.$wrap((4*r+1))]=255*i.g,t[__uv.$wrap((4*r+2))]=255*i.b,t[__uv.$wrap((4*r+3))]=255}))}this._rampGradientsTexture=e.RawTexture.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,e.Texture.NEAREST_SAMPLINGMODE)}},i.prototype.getRampGradients=function(){return this._rampGradients},i.prototype.addRampGradient=function(t,i){this._rampGradients||(this._rampGradients=[]);var r=new e.Color3Gradient;return r.gradient=t,r.color=i,this._rampGradients.push(r),this._rampGradients.sort((function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0})),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture(),this},i.prototype.removeRampGradient=function(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},i.prototype.addColorGradient=function(t,i,r){this._colorGradients||(this._colorGradients=[]);var n=new e.ColorGradient;return n.gradient=t,n.color1=i,n.color2=r,this._colorGradients.push(n),this._colorGradients.sort((function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0})),this},i.prototype.removeColorGradient=function(e){if(!this._colorGradients)return this;for(var t=0,i=0,r=this._colorGradients;i<r.length;i++){if(r[__uv.$wrap((i))].gradient===e){this._colorGradients.splice(t,1);break}t++}return this},i.prototype._fetchR=function(e,t,i,r,n){return n[__uv.$wrap((4*(((e=.5*Math.abs(e)+.5)*i%i|0)+((t=.5*Math.abs(t)+.5)*r%r|0)*i)))]/255},i.prototype._reset=function(){this._resetEffect()},i.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._createVertexBuffers()},i.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==i.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var t=this._scene.getEngine();this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new e.Buffer(t,this._vertexData,!0,this._vertexBufferSize);var r=0,n=this._vertexBuffer.createVertexBuffer(e.VertexBuffer.PositionKind,r,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=n,r+=3;var a=this._vertexBuffer.createVertexBuffer(e.VertexBuffer.ColorKind,r,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[__uv.$wrap((e.VertexBuffer.ColorKind))]=a,r+=4;var o=this._vertexBuffer.createVertexBuffer("angle",r,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=o,r+=1;var s,l=this._vertexBuffer.createVertexBuffer("size",r,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=l,r+=2,this._isAnimationSheetEnabled){var c=this._vertexBuffer.createVertexBuffer("cellIndex",r,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=c,r+=1}if(!this._isBillboardBased||this.billboardMode===i.BILLBOARDMODE_STRETCHED){var u=this._vertexBuffer.createVertexBuffer("direction",r,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=u,r+=3}if(this._useRampGradients){var h=this._vertexBuffer.createVertexBuffer("remapData",r,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=h,r+=4}if(this._useInstancing){var d=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new e.Buffer(t,d,!1,2),s=this._spriteBuffer.createVertexBuffer("offset",0,2)}else s=this._vertexBuffer.createVertexBuffer("offset",r,2,this._vertexBufferSize,this._useInstancing),r+=2;this._vertexBuffers.offset=s},i.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var e=[],t=0,i=0;i<this._capacity;i++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}},i.prototype.getCapacity=function(){return this._capacity},i.prototype.isAlive=function(){return this._alive},i.prototype.isStarted=function(){return this._started},i.prototype._prepareSubEmitterInternalArray=function(){var t=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((function(r){r instanceof i?t._subEmitters.push([new e.SubEmitter(r)]):r instanceof e.SubEmitter?t._subEmitters.push([r]):r instanceof Array&&t._subEmitters.push(r)}))},i.prototype.start=function(t){var i=this;if(void 0===t&&(t=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(t)setTimeout((function(){i.start(0)}),t);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[__uv.$wrap((0))],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[__uv.$wrap((1))].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[__uv.$wrap((0))],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[__uv.$wrap((1))].getFactor())),this.preWarmCycles){this.emitter instanceof e.AbstractMesh&&this.emitter.computeWorldMatrix(!0);var r=this.noiseTexture;if(r&&r.onGeneratedObservable)r.onGeneratedObservable.addOnce((function(){setTimeout((function(){for(var e=0;e<i.preWarmCycles;e++)i.animate(!0),r.render()}))}));else for(var n=0;n<this.preWarmCycles;n++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},i.prototype.stop=function(e){void 0===e&&(e=!0),this._stopped=!0,e&&this._stopSubEmitters()},i.prototype.reset=function(){this._stockParticles=[],this._particles=[]},i.prototype._appendParticleVertex=function(e,t,r,n){var a=e*this._vertexBufferSize;this._vertexData[__uv.$wrap((a++))]=t.position.x,this._vertexData[__uv.$wrap((a++))]=t.position.y,this._vertexData[__uv.$wrap((a++))]=t.position.z,this._vertexData[__uv.$wrap((a++))]=t.color.r,this._vertexData[__uv.$wrap((a++))]=t.color.g,this._vertexData[__uv.$wrap((a++))]=t.color.b,this._vertexData[__uv.$wrap((a++))]=t.color.a,this._vertexData[__uv.$wrap((a++))]=t.angle,this._vertexData[__uv.$wrap((a++))]=t.scale.x*t.size,this._vertexData[__uv.$wrap((a++))]=t.scale.y*t.size,this._isAnimationSheetEnabled&&(this._vertexData[__uv.$wrap((a++))]=t.cellIndex),this._isBillboardBased?this.billboardMode===i.BILLBOARDMODE_STRETCHED&&(this._vertexData[__uv.$wrap((a++))]=t.direction.x,this._vertexData[__uv.$wrap((a++))]=t.direction.y,this._vertexData[__uv.$wrap((a++))]=t.direction.z):t._initialDirection?(this._vertexData[__uv.$wrap((a++))]=t._initialDirection.x,this._vertexData[__uv.$wrap((a++))]=t._initialDirection.y,this._vertexData[__uv.$wrap((a++))]=t._initialDirection.z):(this._vertexData[__uv.$wrap((a++))]=t.direction.x,this._vertexData[__uv.$wrap((a++))]=t.direction.y,this._vertexData[__uv.$wrap((a++))]=t.direction.z),this._useRampGradients&&(this._vertexData[__uv.$wrap((a++))]=t.remapData.x,this._vertexData[__uv.$wrap((a++))]=t.remapData.y,this._vertexData[__uv.$wrap((a++))]=t.remapData.z,this._vertexData[__uv.$wrap((a++))]=t.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),0===n?n=this._epsilon:1===n&&(n=1-this._epsilon)),this._vertexData[__uv.$wrap((a++))]=r,this._vertexData[__uv.$wrap((a++))]=n)},i.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach((function(e){e.stop(!0)})),this.activeSubSystems=new Array)},i.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var e=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==e&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}},i.prototype._update=function(t){var i,r=this;if(this._alive=this._particles.length>0,this.emitter.position){var n=this.emitter;this._emitterWorldMatrix=n.getWorldMatrix()}else{var a=this.emitter;this._emitterWorldMatrix=e.Matrix.Translation(a.x,a.y,a.z)}this.updateFunction(this._particles);for(var o,s=function(){if(l._particles.length===l._capacity)return"break";i=l._createParticle(),l._particles.push(i);var t=e.Scalar.RandomRange(l.minEmitPower,l.maxEmitPower);if(l.startPositionFunction?l.startPositionFunction(l._emitterWorldMatrix,i.position,i):l.particleEmitterType.startPositionFunction(l._emitterWorldMatrix,i.position,i),l.startDirectionFunction?l.startDirectionFunction(l._emitterWorldMatrix,i.direction,i):l.particleEmitterType.startDirectionFunction(l._emitterWorldMatrix,i.direction,i),0===t?i._initialDirection?i._initialDirection.copyFrom(i.direction):i._initialDirection=i.direction.clone():i._initialDirection=null,i.direction.scaleInPlace(t),l.targetStopDuration&&l._lifeTimeGradients&&l._lifeTimeGradients.length>0){var n=e.Scalar.Clamp(l._actualFrame/l.targetStopDuration);e.Tools.GetCurrentGradient(n,l._lifeTimeGradients,(function(t,r,a){var o=t,s=r,l=o.getFactor(),c=s.getFactor(),u=(n-o.gradient)/(s.gradient-o.gradient);i.lifeTime=e.Scalar.Lerp(l,c,u)}))}else i.lifeTime=e.Scalar.RandomRange(l.minLifeTime,l.maxLifeTime);if(l._sizeGradients&&0!==l._sizeGradients.length?(i._currentSizeGradient=l._sizeGradients[__uv.$wrap((0))],i._currentSize1=i._currentSizeGradient.getFactor(),i.size=i._currentSize1,l._sizeGradients.length>1?i._currentSize2=l._sizeGradients[__uv.$wrap((1))].getFactor():i._currentSize2=i._currentSize1):i.size=e.Scalar.RandomRange(l.minSize,l.maxSize),i.scale.copyFromFloats(e.Scalar.RandomRange(l.minScaleX,l.maxScaleX),e.Scalar.RandomRange(l.minScaleY,l.maxScaleY)),l._startSizeGradients&&l._startSizeGradients[__uv.$wrap((0))]&&l.targetStopDuration){var a=l._actualFrame/l.targetStopDuration;e.Tools.GetCurrentGradient(a,l._startSizeGradients,(function(t,n,a){t!==r._currentStartSizeGradient&&(r._currentStartSize1=r._currentStartSize2,r._currentStartSize2=n.getFactor(),r._currentStartSizeGradient=t);var o=e.Scalar.Lerp(r._currentStartSize1,r._currentStartSize2,a);i.scale.scaleInPlace(o)}))}l._angularSpeedGradients&&0!==l._angularSpeedGradients.length?(i._currentAngularSpeedGradient=l._angularSpeedGradients[__uv.$wrap((0))],i.angularSpeed=i._currentAngularSpeedGradient.getFactor(),i._currentAngularSpeed1=i.angularSpeed,l._angularSpeedGradients.length>1?i._currentAngularSpeed2=l._angularSpeedGradients[__uv.$wrap((1))].getFactor():i._currentAngularSpeed2=i._currentAngularSpeed1):i.angularSpeed=e.Scalar.RandomRange(l.minAngularSpeed,l.maxAngularSpeed),i.angle=e.Scalar.RandomRange(l.minInitialRotation,l.maxInitialRotation),l._velocityGradients&&l._velocityGradients.length>0&&(i._currentVelocityGradient=l._velocityGradients[__uv.$wrap((0))],i._currentVelocity1=i._currentVelocityGradient.getFactor(),l._velocityGradients.length>1?i._currentVelocity2=l._velocityGradients[__uv.$wrap((1))].getFactor():i._currentVelocity2=i._currentVelocity1),l._limitVelocityGradients&&l._limitVelocityGradients.length>0&&(i._currentLimitVelocityGradient=l._limitVelocityGradients[__uv.$wrap((0))],i._currentLimitVelocity1=i._currentLimitVelocityGradient.getFactor(),l._limitVelocityGradients.length>1?i._currentLimitVelocity2=l._limitVelocityGradients[__uv.$wrap((1))].getFactor():i._currentLimitVelocity2=i._currentLimitVelocity1),l._dragGradients&&l._dragGradients.length>0&&(i._currentDragGradient=l._dragGradients[__uv.$wrap((0))],i._currentDrag1=i._currentDragGradient.getFactor(),l._dragGradients.length>1?i._currentDrag2=l._dragGradients[__uv.$wrap((1))].getFactor():i._currentDrag2=i._currentDrag1),l._colorGradients&&0!==l._colorGradients.length?(i._currentColorGradient=l._colorGradients[__uv.$wrap((0))],i._currentColorGradient.getColorToRef(i.color),i._currentColor1.copyFrom(i.color),l._colorGradients.length>1?l._colorGradients[__uv.$wrap((1))].getColorToRef(i._currentColor2):i._currentColor2.copyFrom(i.color)):(o=e.Scalar.RandomRange(0,1),e.Color4.LerpToRef(l.color1,l.color2,o,i.color),l.colorDead.subtractToRef(i.color,l._colorDiff),l._colorDiff.scaleToRef(1/i.lifeTime,i.colorStep)),l._isAnimationSheetEnabled&&(i._initialStartSpriteCellID=l.startSpriteCellID,i._initialEndSpriteCellID=l.endSpriteCellID),i.direction.addInPlace(l._inheritedVelocityOffset),l._useRampGradients&&(i.remapData=new e.Vector4(0,1,0,1)),l.noiseTexture&&(i._randomNoiseCoordinates1?(i._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),i._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(i._randomNoiseCoordinates1=new e.Vector3(Math.random(),Math.random(),Math.random()),i._randomNoiseCoordinates2=new e.Vector3(Math.random(),Math.random(),Math.random()))),i._inheritParticleInfoToSubEmitters()},l=this,c=0;c<t;c++){if("break"===s())break}},i._GetAttributeNamesOrOptions=function(t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!1);var n=[e.VertexBuffer.PositionKind,e.VertexBuffer.ColorKind,"angle","offset","size"];return t&&n.push("cellIndex"),i||n.push("direction"),r&&n.push("remapData"),n},i._GetEffectCreationOptions=function(e){void 0===e&&(e=!1);var t=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","textureMask","translationPivot","eyePosition"];return e&&t.push("particlesInfos"),t},i.prototype._getEffect=function(t){if(this._customEffect)return this._customEffect;var r=[];if(this._scene.clipPlane&&r.push("#define CLIPPLANE"),this._scene.clipPlane2&&r.push("#define CLIPPLANE2"),this._scene.clipPlane3&&r.push("#define CLIPPLANE3"),this._scene.clipPlane4&&r.push("#define CLIPPLANE4"),this._isAnimationSheetEnabled&&r.push("#define ANIMATESHEET"),t===i.BLENDMODE_MULTIPLY&&r.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&r.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(r.push("#define BILLBOARD"),this.billboardMode){case i.BILLBOARDMODE_Y:r.push("#define BILLBOARDY");break;case i.BILLBOARDMODE_STRETCHED:r.push("#define BILLBOARDSTRETCHED");break;case i.BILLBOARDMODE_ALL:}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),r.push(this._imageProcessingConfigurationDefines.toString()));var n=r.join("\n");if(this._cachedDefines!==n){this._cachedDefines=n;var a=i._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==i.BILLBOARDMODE_STRETCHED,this._useRampGradients),o=i._GetEffectCreationOptions(this._isAnimationSheetEnabled),s=["diffuseSampler","rampSampler"];e.ImageProcessingConfiguration&&(e.ImageProcessingConfiguration.PrepareUniforms(o,this._imageProcessingConfigurationDefines),e.ImageProcessingConfiguration.PrepareSamplers(s,this._imageProcessingConfigurationDefines)),this._effect=this._scene.getEngine().createEffect("particles",a,o,s,n)}return this._effect},i.prototype.animate=function(t){var i=this;if(void 0===t&&(t=!1),this._started){if(!t){if(!this.isReady())return;if(this._currentRenderId===this._scene.getRenderId())return;this._currentRenderId=this._scene.getRenderId()}var r;if(this._scaledUpdateSpeed=this.updateSpeed*(t?this.preWarmStepOffset:this._scene.getAnimationRatio()),this.manualEmitCount>-1)r=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var n=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var a=this._actualFrame/this.targetStopDuration;e.Tools.GetCurrentGradient(a,this._emitRateGradients,(function(t,r,a){t!==i._currentEmitRateGradient&&(i._currentEmitRate1=i._currentEmitRate2,i._currentEmitRate2=r.getFactor(),i._currentEmitRateGradient=t),n=e.Scalar.Lerp(i._currentEmitRate1,i._currentEmitRate2,a)}))}r=n*this._scaledUpdateSpeed>>0,this._newPartsExcess+=n*this._scaledUpdateSpeed-r}if(this._newPartsExcess>1&&(r+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?r=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(r),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),!t){for(var o=0,s=0;s<this._particles.length;s++){var l=this._particles[__uv.$wrap((s))];this._appendParticleVertices(o,l),o+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},i.prototype._appendParticleVertices=function(e,t){this._appendParticleVertex(e++,t,0,0),this._useInstancing||(this._appendParticleVertex(e++,t,1,0),this._appendParticleVertex(e++,t,1,1),this._appendParticleVertex(e++,t,0,1))},i.prototype.rebuild=function(){this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild()},i.prototype.isReady=function(){if(!(this.emitter&&this._imageProcessingConfiguration.isReady()&&this.particleTexture&&this.particleTexture.isReady()))return!1;if(this.blendMode!==i.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else{if(!this._getEffect(i.BLENDMODE_MULTIPLY).isReady())return!1;if(!this._getEffect(i.BLENDMODE_ADD).isReady())return!1}return!0},i.prototype._render=function(t){var r=this._getEffect(t),n=this._scene.getEngine();n.enableEffect(r);var a=this._scene.getViewMatrix();if(r.setTexture("diffuseSampler",this.particleTexture),r.setMatrix("view",a),r.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var o=this.particleTexture.getBaseSize();r.setFloat3("particlesInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,o.width/this.spriteCellWidth)}if(r.setVector2("translationPivot",this.translationPivot),r.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased){var s=this._scene.activeCamera;r.setVector3("eyePosition",s.globalPosition)}if(this._rampGradientsTexture&&r.setTexture("rampSampler",this._rampGradientsTexture),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var l=a.clone();l.invert(),r.setMatrix("invView",l),e.MaterialHelper.BindClipPlane(r,this._scene)}switch(n.bindBuffers(this._vertexBuffers,this._indexBuffer,r),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(r),t){case i.BLENDMODE_ADD:n.setAlphaMode(e.Engine.ALPHA_ADD);break;case i.BLENDMODE_ONEONE:n.setAlphaMode(e.Engine.ALPHA_ONEONE);break;case i.BLENDMODE_STANDARD:n.setAlphaMode(e.Engine.ALPHA_COMBINE);break;case i.BLENDMODE_MULTIPLY:n.setAlphaMode(e.Engine.ALPHA_MULTIPLY)}return this._useInstancing?n.drawArraysType(e.Material.TriangleFanDrawMode,0,4,this._particles.length):n.drawElementsType(e.Material.TriangleFillMode,0,6*this._particles.length),this._particles.length},i.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var t=this._scene.getEngine();t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0);var r=0;return this.blendMode===i.BLENDMODE_MULTIPLYADD&&(r=this._render(i.BLENDMODE_MULTIPLY)+this._render(i.BLENDMODE_ADD)),r=this._render(this.blendMode),t.unbindInstanceAttributes(),t.setAlphaMode(e.Engine.ALPHA_DISABLE),r},i.prototype.dispose=function(e){if(void 0===e&&(e=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var t=0;t<this._subEmitters.length;t++)for(var i=0,r=this._subEmitters[__uv.$wrap((t))];i<r.length;i++){r[__uv.$wrap((i))].dispose()}this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),(t=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(t,1),this._scene._activeParticleSystems.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.reset()},i.prototype.clone=function(t,r){var n=null,a=null;if(null!=this.customShader){var o=(a=this.customShader).shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"";n=this._scene.getEngine().createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,o)}else this._customEffect&&(n=this._customEffect);var s=new i(t,this._capacity,this._scene,n);return s.customShader=a,e.Tools.DeepCopy(this,s,["particles","customShader","noiseTexture"]),void 0===r&&(r=this.emitter),s.noiseTexture=this.noiseTexture,s.emitter=r,this.particleTexture&&(s.particleTexture=new e.Texture(this.particleTexture.url,this._scene)),this._colorGradients&&this._colorGradients.forEach((function(e){s.addColorGradient(e.gradient,e.color1,e.color2)})),this._dragGradients&&this._dragGradients.forEach((function(e){s.addDragGradient(e.gradient,e.factor1,e.factor2)})),this._angularSpeedGradients&&this._angularSpeedGradients.forEach((function(e){s.addAngularSpeedGradient(e.gradient,e.factor1,e.factor2)})),this._emitRateGradients&&this._emitRateGradients.forEach((function(e){s.addEmitRateGradient(e.gradient,e.factor1,e.factor2)})),this._lifeTimeGradients&&this._lifeTimeGradients.forEach((function(e){s.addLifeTimeGradient(e.gradient,e.factor1,e.factor2)})),this._limitVelocityGradients&&this._limitVelocityGradients.forEach((function(e){s.addLimitVelocityGradient(e.gradient,e.factor1,e.factor2)})),this._sizeGradients&&this._sizeGradients.forEach((function(e){s.addSizeGradient(e.gradient,e.factor1,e.factor2)})),this._startSizeGradients&&this._startSizeGradients.forEach((function(e){s.addStartSizeGradient(e.gradient,e.factor1,e.factor2)})),this._velocityGradients&&this._velocityGradients.forEach((function(e){s.addVelocityGradient(e.gradient,e.factor1,e.factor2)})),this._rampGradients&&this._rampGradients.forEach((function(e){s.addRampGradient(e.gradient,e.color)})),this._colorRemapGradients&&this._colorRemapGradients.forEach((function(e){s.addColorRemapGradient(e.gradient,e.factor1,e.factor2)})),this._alphaRemapGradients&&this._alphaRemapGradients.forEach((function(e){s.addAlphaRemapGradient(e.gradient,e.factor1,e.factor2)})),this.preventAutoStart||s.start(),s},i.prototype.serialize=function(){var e={};if(i._Serialize(e,this),e.textureMask=this.textureMask.asArray(),e.customShader=this.customShader,e.preventAutoStart=this.preventAutoStart,this.subEmitters){e.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var t=0,r=this._subEmitters;t<r.length;t++){for(var n=[],a=0,o=r[__uv.$wrap((t))];a<o.length;a++){var s=o[__uv.$wrap((a))];n.push(s.serialize())}e.subEmitters.push(n)}}return e},i._Serialize=function(t,i){if(t.name=i.name,t.id=i.id,t.capacity=i.getCapacity(),i.emitter.position){var r=i.emitter;t.emitterId=r.id}else{var n=i.emitter;t.emitter=n.asArray()}i.particleEmitterType&&(t.particleEmitterType=i.particleEmitterType.serialize()),i.particleTexture&&(t.textureName=i.particleTexture.name,t.invertY=i.particleTexture._invertY),e.Animation.AppendSerializedAnimations(i,t),t.beginAnimationOnStart=i.beginAnimationOnStart,t.beginAnimationFrom=i.beginAnimationFrom,t.beginAnimationTo=i.beginAnimationTo,t.beginAnimationLoop=i.beginAnimationLoop,t.startDelay=i.startDelay,t.renderingGroupId=i.renderingGroupId,t.isBillboardBased=i.isBillboardBased,t.billboardMode=i.billboardMode,t.minAngularSpeed=i.minAngularSpeed,t.maxAngularSpeed=i.maxAngularSpeed,t.minSize=i.minSize,t.maxSize=i.maxSize,t.minScaleX=i.minScaleX,t.maxScaleX=i.maxScaleX,t.minScaleY=i.minScaleY,t.maxScaleY=i.maxScaleY,t.minEmitPower=i.minEmitPower,t.maxEmitPower=i.maxEmitPower,t.minLifeTime=i.minLifeTime,t.maxLifeTime=i.maxLifeTime,t.emitRate=i.emitRate,t.gravity=i.gravity.asArray(),t.noiseStrength=i.noiseStrength.asArray(),t.color1=i.color1.asArray(),t.color2=i.color2.asArray(),t.colorDead=i.colorDead.asArray(),t.updateSpeed=i.updateSpeed,t.targetStopDuration=i.targetStopDuration,t.blendMode=i.blendMode,t.preWarmCycles=i.preWarmCycles,t.preWarmStepOffset=i.preWarmStepOffset,t.minInitialRotation=i.minInitialRotation,t.maxInitialRotation=i.maxInitialRotation,t.startSpriteCellID=i.startSpriteCellID,t.endSpriteCellID=i.endSpriteCellID,t.spriteCellChangeSpeed=i.spriteCellChangeSpeed,t.spriteCellWidth=i.spriteCellWidth,t.spriteCellHeight=i.spriteCellHeight,t.spriteRandomStartCell=i.spriteRandomStartCell,t.isAnimationSheetEnabled=i.isAnimationSheetEnabled;var a=i.getColorGradients();if(a){t.colorGradients=[];for(var o=0,s=a;o<s.length;o++){var l=s[__uv.$wrap((o))],c={gradient:l.gradient,color1:l.color1.asArray()};l.color2&&(c.color2=l.color2.asArray()),t.colorGradients.push(c)}}var u=i.getRampGradients();if(u){t.rampGradients=[];for(var h=0,d=u;h<d.length;h++){var p=d[__uv.$wrap((h))];c={gradient:p.gradient,color:p.color.asArray()};t.rampGradients.push(c)}t.useRampGradients=i.useRampGradients}var m=i.getColorRemapGradients();if(m){t.colorRemapGradients=[];for(var _=0,f=m;_<f.length;_++){var g=f[__uv.$wrap((_))];c={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2&&(c.factor2=g.factor2),t.colorRemapGradients.push(c)}}var y=i.getAlphaRemapGradients();if(y){t.alphaRemapGradients=[];for(var v=0,b=y;v<b.length;v++){var x=b[__uv.$wrap((v))];c={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2&&(c.factor2=x.factor2),t.alphaRemapGradients.push(c)}}var S=i.getSizeGradients();if(S){t.sizeGradients=[];for(var T=0,E=S;T<E.length;T++){var P=E[__uv.$wrap((T))];c={gradient:P.gradient,factor1:P.factor1};void 0!==P.factor2&&(c.factor2=P.factor2),t.sizeGradients.push(c)}}var A=i.getAngularSpeedGradients();if(A){t.angularSpeedGradients=[];for(var M=0,C=A;M<C.length;M++){var R=C[__uv.$wrap((M))];c={gradient:R.gradient,factor1:R.factor1};void 0!==R.factor2&&(c.factor2=R.factor2),t.angularSpeedGradients.push(c)}}var w=i.getVelocityGradients();if(w){t.velocityGradients=[];for(var I=0,O=w;I<O.length;I++){var D=O[__uv.$wrap((I))];c={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2&&(c.factor2=D.factor2),t.velocityGradients.push(c)}}var k=i.getDragGradients();if(k){t.dragyGradients=[];for(var B=0,F=k;B<F.length;B++){var L=F[__uv.$wrap((B))];c={gradient:L.gradient,factor1:L.factor1};void 0!==L.factor2&&(c.factor2=L.factor2),t.dragGradients.push(c)}}var N=i.getEmitRateGradients();if(N){t.emitRateGradients=[];for(var V=0,G=N;V<G.length;V++){var U=G[__uv.$wrap((V))];c={gradient:U.gradient,factor1:U.factor1};void 0!==U.factor2&&(c.factor2=U.factor2),t.emitRateGradients.push(c)}}var z=i.getStartSizeGradients();if(z){t.startSizeGradients=[];for(var H=0,W=z;H<W.length;H++){var j=W[__uv.$wrap((H))];c={gradient:j.gradient,factor1:j.factor1};void 0!==j.factor2&&(c.factor2=j.factor2),t.startSizeGradients.push(c)}}var X=i.getLifeTimeGradients();if(X){t.lifeTimeGradients=[];for(var Y=0,K=X;Y<K.length;Y++){var Q=K[__uv.$wrap((Y))];c={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2&&(c.factor2=Q.factor2),t.lifeTimeGradients.push(c)}}var Z=i.getLimitVelocityGradients();if(Z){t.limitVelocityGradients=[];for(var q=0,J=Z;q<J.length;q++){var $=J[__uv.$wrap((q))];c={gradient:$.gradient,factor1:$.factor1};void 0!==$.factor2&&(c.factor2=$.factor2),t.limitVelocityGradients.push(c)}t.limitVelocityDamping=i.limitVelocityDamping}i.noiseTexture&&(t.noiseTexture=i.noiseTexture.serialize())},i._Parse=function(t,i,r,n){if(t.textureName&&(i.particleTexture=new e.Texture(n+t.textureName,r,!1,void 0===t.invertY||t.invertY),i.particleTexture.name=t.textureName),t.emitterId||0===t.emitterId||void 0!==t.emitter?t.emitterId?i.emitter=r.getLastMeshByID(t.emitterId):i.emitter=e.Vector3.FromArray(t.emitter):i.emitter=e.Vector3.Zero(),void 0!==t.renderingGroupId&&(i.renderingGroupId=t.renderingGroupId),void 0!==t.isBillboardBased&&(i.isBillboardBased=t.isBillboardBased),void 0!==t.billboardMode&&(i.billboardMode=t.billboardMode),t.animations){for(var a=0;a<t.animations.length;a++){var o=t.animations[__uv.$wrap((a))];i.animations.push(e.Animation.Parse(o))}i.beginAnimationOnStart=t.beginAnimationOnStart,i.beginAnimationFrom=t.beginAnimationFrom,i.beginAnimationTo=t.beginAnimationTo,i.beginAnimationLoop=t.beginAnimationLoop}if(t.autoAnimate&&r.beginAnimation(i,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),i.startDelay=0|t.startDelay,i.minAngularSpeed=t.minAngularSpeed,i.maxAngularSpeed=t.maxAngularSpeed,i.minSize=t.minSize,i.maxSize=t.maxSize,t.minScaleX&&(i.minScaleX=t.minScaleX,i.maxScaleX=t.maxScaleX,i.minScaleY=t.minScaleY,i.maxScaleY=t.maxScaleY),void 0!==t.preWarmCycles&&(i.preWarmCycles=t.preWarmCycles,i.preWarmStepOffset=t.preWarmStepOffset),void 0!==t.minInitialRotation&&(i.minInitialRotation=t.minInitialRotation,i.maxInitialRotation=t.maxInitialRotation),i.minLifeTime=t.minLifeTime,i.maxLifeTime=t.maxLifeTime,i.minEmitPower=t.minEmitPower,i.maxEmitPower=t.maxEmitPower,i.emitRate=t.emitRate,i.gravity=e.Vector3.FromArray(t.gravity),t.noiseStrength&&(i.noiseStrength=e.Vector3.FromArray(t.noiseStrength)),i.color1=e.Color4.FromArray(t.color1),i.color2=e.Color4.FromArray(t.color2),i.colorDead=e.Color4.FromArray(t.colorDead),i.updateSpeed=t.updateSpeed,i.targetStopDuration=t.targetStopDuration,i.blendMode=t.blendMode,t.colorGradients)for(var s=0,l=t.colorGradients;s<l.length;s++){var c=l[__uv.$wrap((s))];i.addColorGradient(c.gradient,e.Color4.FromArray(c.color1),c.color2?e.Color4.FromArray(c.color2):void 0)}if(t.rampGradients){for(var u=0,h=t.rampGradients;u<h.length;u++){var d=h[__uv.$wrap((u))];i.addRampGradient(d.gradient,e.Color3.FromArray(d.color))}i.useRampGradients=t.useRampGradients}if(t.colorRemapGradients)for(var p=0,m=t.colorRemapGradients;p<m.length;p++){var _=m[__uv.$wrap((p))];i.addColorRemapGradient(_.gradient,void 0!==_.factor1?_.factor1:_.factor,_.factor2)}if(t.alphaRemapGradients)for(var f=0,g=t.alphaRemapGradients;f<g.length;f++){var y=g[__uv.$wrap((f))];i.addAlphaRemapGradient(y.gradient,void 0!==y.factor1?y.factor1:y.factor,y.factor2)}if(t.sizeGradients)for(var v=0,b=t.sizeGradients;v<b.length;v++){var x=b[__uv.$wrap((v))];i.addSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2)}if(t.sizeGradients)for(var S=0,T=t.sizeGradients;S<T.length;S++){x=T[__uv.$wrap((S))];i.addSizeGradient(x.gradient,void 0!==x.factor1?x.factor1:x.factor,x.factor2)}if(t.angularSpeedGradients)for(var E=0,P=t.angularSpeedGradients;E<P.length;E++){var A=P[__uv.$wrap((E))];i.addAngularSpeedGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2)}if(t.velocityGradients)for(var M=0,C=t.velocityGradients;M<C.length;M++){var R=C[__uv.$wrap((M))];i.addVelocityGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2)}if(t.dragGradients)for(var w=0,I=t.dragGradients;w<I.length;w++){var O=I[__uv.$wrap((w))];i.addDragGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2)}if(t.emitRateGradients)for(var D=0,k=t.emitRateGradients;D<k.length;D++){var B=k[__uv.$wrap((D))];i.addEmitRateGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2)}if(t.startSizeGradients)for(var F=0,L=t.startSizeGradients;F<L.length;F++){var N=L[__uv.$wrap((F))];i.addStartSizeGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2)}if(t.lifeTimeGradients)for(var V=0,G=t.lifeTimeGradients;V<G.length;V++){var U=G[__uv.$wrap((V))];i.addLifeTimeGradient(U.gradient,void 0!==U.factor1?U.factor1:U.factor,U.factor2)}if(t.limitVelocityGradients){for(var z=0,H=t.limitVelocityGradients;z<H.length;z++){var W=H[__uv.$wrap((z))];i.addLimitVelocityGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2)}i.limitVelocityDamping=t.limitVelocityDamping}var j;if(t.noiseTexture&&(i.noiseTexture=e.ProceduralTexture.Parse(t.noiseTexture,r,n)),t.particleEmitterType){switch(t.particleEmitterType.type){case"SphereParticleEmitter":j=new e.SphereParticleEmitter;break;case"SphereDirectedParticleEmitter":j=new e.SphereDirectedParticleEmitter;break;case"ConeEmitter":case"ConeParticleEmitter":j=new e.ConeParticleEmitter;break;case"CylinderParticleEmitter":j=new e.CylinderParticleEmitter;break;case"HemisphericParticleEmitter":j=new e.HemisphericParticleEmitter;break;case"BoxEmitter":case"BoxParticleEmitter":default:j=new e.BoxParticleEmitter}j.parse(t.particleEmitterType)}else(j=new e.BoxParticleEmitter).parse(t);i.particleEmitterType=j,i.startSpriteCellID=t.startSpriteCellID,i.endSpriteCellID=t.endSpriteCellID,i.spriteCellWidth=t.spriteCellWidth,i.spriteCellHeight=t.spriteCellHeight,i.spriteCellChangeSpeed=t.spriteCellChangeSpeed,i.spriteRandomStartCell=t.spriteRandomStartCell},i.Parse=function(t,r,n,a){void 0===a&&(a=!1);var o=t.name,s=null,l=null;if(t.customShader){var c=(l=t.customShader).shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";s=r.getEngine().createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,c)}var u=new i(o,t.capacity,r,s,t.isAnimationSheetEnabled);if(u.customShader=l,t.id&&(u.id=t.id),t.subEmitters){u.subEmitters=[];for(var h=0,d=t.subEmitters;h<d.length;h++){for(var p=[],m=0,_=d[__uv.$wrap((h))];m<_.length;m++){var f=_[__uv.$wrap((m))];p.push(e.SubEmitter.Parse(f,r,n))}u.subEmitters.push(p)}}return i._Parse(t,u,r,n),u.textureMask=e.Color4.FromArray(t.textureMask),t.preventAutoStart&&(u.preventAutoStart=t.preventAutoStart),a||u.preventAutoStart||u.start(),u},i.BILLBOARDMODE_Y=2,i.BILLBOARDMODE_ALL=7,i.BILLBOARDMODE_STRETCHED=8,i}(e.BaseParticleSystem);e.ParticleSystem=t}(s||(s={})),function(e){var t=function(){function t(){this.direction1=new e.Vector3(0,1,0),this.direction2=new e.Vector3(0,1,0),this.minEmitBox=new e.Vector3(-.5,-.5,-.5),this.maxEmitBox=new e.Vector3(.5,.5,.5)}return t.prototype.startDirectionFunction=function(t,i,r){var n=e.Scalar.RandomRange(this.direction1.x,this.direction2.x),a=e.Scalar.RandomRange(this.direction1.y,this.direction2.y),o=e.Scalar.RandomRange(this.direction1.z,this.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(n,a,o,t,i)},t.prototype.startPositionFunction=function(t,i,r){var n=e.Scalar.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),a=e.Scalar.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),o=e.Scalar.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);e.Vector3.TransformCoordinatesFromFloatsToRef(n,a,o,t,i)},t.prototype.clone=function(){var i=new t;return e.Tools.DeepCopy(this,i),i},t.prototype.applyToShader=function(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2),e.setVector3("minEmitBox",this.minEmitBox),e.setVector3("maxEmitBox",this.maxEmitBox)},t.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},t.prototype.getClassName=function(){return"BoxParticleEmitter"},t.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e.minEmitBox=this.minEmitBox.asArray(),e.maxEmitBox=this.maxEmitBox.asArray(),e},t.prototype.parse=function(t){e.Vector3.FromArrayToRef(t.direction1,0,this.direction1),e.Vector3.FromArrayToRef(t.direction2,0,this.direction2),e.Vector3.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),e.Vector3.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)},t}();e.BoxParticleEmitter=t}(s||(s={})),function(e){var t=function(){function t(e,t,i,r){void 0===e&&(e=1),void 0===t&&(t=1),void 0===i&&(i=1),void 0===r&&(r=0),this.radius=e,this.height=t,this.radiusRange=i,this.directionRandomizer=r}return t.prototype.startDirectionFunction=function(t,i,r){var n=r.position.subtract(t.getTranslation()).normalize(),a=e.Scalar.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),o=Math.atan2(n.x,n.z);o+=e.Scalar.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,n.y=a,n.x=Math.sin(o),n.z=Math.cos(o),n.normalize(),e.Vector3.TransformNormalFromFloatsToRef(n.x,n.y,n.z,t,i)},t.prototype.startPositionFunction=function(t,i,r){var n=e.Scalar.RandomRange(-this.height/2,this.height/2),a=e.Scalar.RandomRange(0,2*Math.PI),o=e.Scalar.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),s=Math.sqrt(o)*this.radius,l=s*Math.cos(a),c=s*Math.sin(a);e.Vector3.TransformCoordinatesFromFloatsToRef(l,n,c,t,i)},t.prototype.clone=function(){var i=new t(this.radius,this.directionRandomizer);return e.Tools.DeepCopy(this,i),i},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},t.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},t.prototype.getClassName=function(){return"CylinderParticleEmitter"},t.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.height=this.height,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},t.prototype.parse=function(e){this.radius=e.radius,this.height=e.height,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},t}();e.CylinderParticleEmitter=t;var i=function(t){function i(i,r,n,a,o){void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=1),void 0===a&&(a=new e.Vector3(0,1,0)),void 0===o&&(o=new e.Vector3(0,1,0));var s=t.call(this,i,r,n)||this;return s.direction1=a,s.direction2=o,s}return a(i,t),i.prototype.startDirectionFunction=function(t,i,r){var n=e.Scalar.RandomRange(this.direction1.x,this.direction2.x),a=e.Scalar.RandomRange(this.direction1.y,this.direction2.y),o=e.Scalar.RandomRange(this.direction1.z,this.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(n,a,o,t,i)},i.prototype.clone=function(){var t=new i(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return e.Tools.DeepCopy(this,t),t},i.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"},i.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},i.prototype.parse=function(e){t.prototype.parse.call(this,e),this.direction1.copyFrom(e.direction1),this.direction2.copyFrom(e.direction2)},i}(t);e.CylinderDirectedParticleEmitter=i}(s||(s={})),function(e){var t=function(){function t(e,t,i){void 0===e&&(e=1),void 0===t&&(t=Math.PI),void 0===i&&(i=0),this.directionRandomizer=i,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=t,this.radius=e}return Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._buildHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._buildHeight()},enumerable:!0,configurable:!0}),t.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},t.prototype.startDirectionFunction=function(t,i,r){if(1===Math.abs(Math.cos(this._angle)))e.Vector3.TransformNormalFromFloatsToRef(0,1,0,t,i);else{var n=r.position.subtract(t.getTranslation()).normalize(),a=e.Scalar.RandomRange(0,this.directionRandomizer),o=e.Scalar.RandomRange(0,this.directionRandomizer),s=e.Scalar.RandomRange(0,this.directionRandomizer);n.x+=a,n.y+=o,n.z+=s,n.normalize(),e.Vector3.TransformNormalFromFloatsToRef(n.x,n.y,n.z,t,i)}},t.prototype.startPositionFunction=function(t,i,r){var n,a=e.Scalar.RandomRange(0,2*Math.PI);n=this.emitFromSpawnPointOnly?1e-4:1-(n=e.Scalar.RandomRange(0,this.heightRange))*n;var o=this._radius-e.Scalar.RandomRange(0,this._radius*this.radiusRange),s=(o*=n)*Math.sin(a),l=o*Math.cos(a),c=n*this._height;e.Vector3.TransformCoordinatesFromFloatsToRef(s,c,l,t,i)},t.prototype.clone=function(){var i=new t(this._radius,this._angle,this.directionRandomizer);return e.Tools.DeepCopy(this,i),i},t.prototype.applyToShader=function(e){e.setFloat2("radius",this._radius,this.radiusRange),e.setFloat("coneAngle",this._angle),e.setFloat2("height",this._height,this.heightRange),e.setFloat("directionRandomizer",this.directionRandomizer)},t.prototype.getEffectDefines=function(){var e="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(e+="\n#define CONEEMITTERSPAWNPOINT"),e},t.prototype.getClassName=function(){return"ConeParticleEmitter"},t.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this._radius,e.angle=this._angle,e.directionRandomizer=this.directionRandomizer,e},t.prototype.parse=function(e){this.radius=e.radius,this.angle=e.angle,this.directionRandomizer=e.directionRandomizer},t}();e.ConeParticleEmitter=t}(s||(s={})),function(e){var t=function(){function t(e,t,i){void 0===e&&(e=1),void 0===t&&(t=1),void 0===i&&(i=0),this.radius=e,this.radiusRange=t,this.directionRandomizer=i}return t.prototype.startDirectionFunction=function(t,i,r){var n=r.position.subtract(t.getTranslation()).normalize(),a=e.Scalar.RandomRange(0,this.directionRandomizer),o=e.Scalar.RandomRange(0,this.directionRandomizer),s=e.Scalar.RandomRange(0,this.directionRandomizer);n.x+=a,n.y+=o,n.z+=s,n.normalize(),e.Vector3.TransformNormalFromFloatsToRef(n.x,n.y,n.z,t,i)},t.prototype.startPositionFunction=function(t,i,r){var n=this.radius-e.Scalar.RandomRange(0,this.radius*this.radiusRange),a=e.Scalar.RandomRange(0,1),o=e.Scalar.RandomRange(0,2*Math.PI),s=Math.acos(2*a-1),l=n*Math.cos(o)*Math.sin(s),c=n*Math.cos(s),u=n*Math.sin(o)*Math.sin(s);e.Vector3.TransformCoordinatesFromFloatsToRef(l,c,u,t,i)},t.prototype.clone=function(){var i=new t(this.radius,this.directionRandomizer);return e.Tools.DeepCopy(this,i),i},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},t.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},t.prototype.getClassName=function(){return"SphereParticleEmitter"},t.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},t.prototype.parse=function(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},t}();e.SphereParticleEmitter=t;var i=function(t){function i(i,r,n){void 0===i&&(i=1),void 0===r&&(r=new e.Vector3(0,1,0)),void 0===n&&(n=new e.Vector3(0,1,0));var a=t.call(this,i)||this;return a.direction1=r,a.direction2=n,a}return a(i,t),i.prototype.startDirectionFunction=function(t,i,r){var n=e.Scalar.RandomRange(this.direction1.x,this.direction2.x),a=e.Scalar.RandomRange(this.direction1.y,this.direction2.y),o=e.Scalar.RandomRange(this.direction1.z,this.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(n,a,o,t,i)},i.prototype.clone=function(){var t=new i(this.radius,this.direction1,this.direction2);return e.Tools.DeepCopy(this,t),t},i.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"},i.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},i.prototype.parse=function(e){t.prototype.parse.call(this,e),this.direction1.copyFrom(e.direction1),this.direction2.copyFrom(e.direction2)},i}(t);e.SphereDirectedParticleEmitter=i}(s||(s={})),function(e){var t=function(){function t(e,t,i){void 0===e&&(e=1),void 0===t&&(t=1),void 0===i&&(i=0),this.radius=e,this.radiusRange=t,this.directionRandomizer=i}return t.prototype.startDirectionFunction=function(t,i,r){var n=r.position.subtract(t.getTranslation()).normalize(),a=e.Scalar.RandomRange(0,this.directionRandomizer),o=e.Scalar.RandomRange(0,this.directionRandomizer),s=e.Scalar.RandomRange(0,this.directionRandomizer);n.x+=a,n.y+=o,n.z+=s,n.normalize(),e.Vector3.TransformNormalFromFloatsToRef(n.x,n.y,n.z,t,i)},t.prototype.startPositionFunction=function(t,i,r){var n=this.radius-e.Scalar.RandomRange(0,this.radius*this.radiusRange),a=e.Scalar.RandomRange(0,1),o=e.Scalar.RandomRange(0,2*Math.PI),s=Math.acos(2*a-1),l=n*Math.cos(o)*Math.sin(s),c=n*Math.cos(s),u=n*Math.sin(o)*Math.sin(s);e.Vector3.TransformCoordinatesFromFloatsToRef(l,Math.abs(c),u,t,i)},t.prototype.clone=function(){var i=new t(this.radius,this.directionRandomizer);return e.Tools.DeepCopy(this,i),i},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},t.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},t.prototype.getClassName=function(){return"HemisphericParticleEmitter"},t.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},t.prototype.parse=function(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},t}();e.HemisphericParticleEmitter=t}(s||(s={})),function(e){var t=function(){function t(){this.direction1=new e.Vector3(0,1,0),this.direction2=new e.Vector3(0,1,0)}return t.prototype.startDirectionFunction=function(t,i,r){var n=e.Scalar.RandomRange(this.direction1.x,this.direction2.x),a=e.Scalar.RandomRange(this.direction1.y,this.direction2.y),o=e.Scalar.RandomRange(this.direction1.z,this.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(n,a,o,t,i)},t.prototype.startPositionFunction=function(t,i,r){e.Vector3.TransformCoordinatesFromFloatsToRef(0,0,0,t,i)},t.prototype.clone=function(){var i=new t;return e.Tools.DeepCopy(this,i),i},t.prototype.applyToShader=function(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},t.prototype.getClassName=function(){return"PointParticleEmitter"},t.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},t.prototype.parse=function(t){e.Vector3.FromArrayToRef(t.direction1,0,this.direction1),e.Vector3.FromArrayToRef(t.direction2,0,this.direction2)},t}();e.PointParticleEmitter=t}(s||(s={})),function(e){e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_PARTICLESYSTEM,(function(t,i,r,n){var a=e.AbstractScene.GetIndividualParser(e.SceneComponentConstants.NAME_PARTICLESYSTEM);if(a&&void 0!==t.particleSystems&&null!==t.particleSystems)for(var o=0,s=t.particleSystems.length;o<s;o++){var l=t.particleSystems[__uv.$wrap((o))];r.particleSystems.push(a(l,i,n))}})),e.AbstractScene.AddIndividualParser(e.SceneComponentConstants.NAME_PARTICLESYSTEM,(function(t,i,r){return t.activeParticleCount?e.GPUParticleSystem.Parse(t,i,r):e.ParticleSystem.Parse(t,i,r)})),e.Engine.prototype.createEffectForParticles=function(t,i,r,n,a,o,s){void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===n&&(n="");var l=e.ParticleSystem._GetAttributeNamesOrOptions(),c=e.ParticleSystem._GetEffectCreationOptions();return-1===n.indexOf(" BILLBOARD")&&(n+="\n#define BILLBOARD\n"),-1===r.indexOf("diffuseSampler")&&r.push("diffuseSampler"),this.createEffect({vertex:"particles",fragmentElement:t},l,c.concat(i),r,n,a,o,s)},e.Mesh.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var i=this.getScene().particleSystems[__uv.$wrap((t))];i.emitter===this&&e.push(i)}return e},e.Mesh.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var i=0;i<this.getScene().particleSystems.length;i++){var r=this.getScene().particleSystems[__uv.$wrap((i))],n=r.emitter;n.position&&-1!==t.indexOf(n)&&e.push(r)}return e}}(s||(s={})),function(e){var t;!function(e){e[__uv.$wrap((e.ATTACHED=0))]="ATTACHED",e[__uv.$wrap((e.END=1))]="END"}(t=e.SubEmitterType||(e.SubEmitterType={}));var i=function(){function i(i){this.particleSystem=i,this.type=t.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,i.emitter&&i.emitter.dispose||(i.emitter=new e.AbstractMesh("SubemitterSystemEmitter",i.getScene())),i.onDisposeObservable.add((function(){i.emitter&&i.emitter.dispose&&i.emitter.dispose()}))}return i.prototype.clone=function(){var t=this.particleSystem.emitter;t?t instanceof e.Vector3?t=t.clone():t instanceof e.AbstractMesh&&((t=new e.Mesh("",t.getScene())).isVisible=!1):t=new e.Vector3;var r=new i(this.particleSystem.clone("",t));return r.type=this.type,r.inheritDirection=this.inheritDirection,r.inheritedVelocityAmount=this.inheritedVelocityAmount,r.particleSystem._disposeEmitterOnDispose=!0,r.particleSystem.disposeOnStop=!0,r},i.prototype.serialize=function(){var e={};return e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem=this.particleSystem.serialize(),e},i.Parse=function(t,r,n){var a=t.particleSystem,o=new i(e.ParticleSystem.Parse(a,r,n));return o.type=t.type,o.inheritDirection=t.inheritDirection,o.inheritedVelocityAmount=t.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o},i.prototype.dispose=function(){this.particleSystem.dispose()},i}();e.SubEmitter=i}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){void 0===a&&(a={});var s=t.call(this,i,r)||this;return s._textures={},s._textureArrays={},s._floats={},s._ints={},s._floatsArrays={},s._colors3={},s._colors3Arrays={},s._colors4={},s._vectors2={},s._vectors3={},s._vectors4={},s._matrices={},s._matrices3x3={},s._matrices2x2={},s._vectors2Arrays={},s._vectors3Arrays={},s._cachedWorldViewMatrix=new e.Matrix,s._shaderPath=n,s._options=o({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},a),s}return a(i,t),i.prototype.getClassName=function(){return"ShaderMaterial"},i.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},i.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},i.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},i.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[__uv.$wrap((e))]=t,this},i.prototype.setTextureArray=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[__uv.$wrap((e))]=t,this},i.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[__uv.$wrap((e))]=t,this},i.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[__uv.$wrap((e))]=t,this},i.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[__uv.$wrap((e))]=t,this},i.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[__uv.$wrap((e))]=t,this},i.prototype.setColor3Array=function(e,t){return this._checkUniform(e),this._colors3Arrays[__uv.$wrap((e))]=t.reduce((function(e,t){return t.toArray(e,e.length),e}),[]),this},i.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[__uv.$wrap((e))]=t,this},i.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[__uv.$wrap((e))]=t,this},i.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[__uv.$wrap((e))]=t,this},i.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[__uv.$wrap((e))]=t,this},i.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[__uv.$wrap((e))]=t,this},i.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[__uv.$wrap((e))]=t,this},i.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[__uv.$wrap((e))]=t,this},i.prototype.setArray2=function(e,t){return this._checkUniform(e),this._vectors2Arrays[__uv.$wrap((e))]=t,this},i.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[__uv.$wrap((e))]=t,this},i.prototype._checkCache=function(e,t,i){return!t||(this._effect&&this._effect.defines.indexOf("#define INSTANCES"),!1)},i.prototype.isReady=function(t,i){var r=this.getScene(),n=r.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===r.getRenderId()&&this._checkCache(r,t,i))return!0;for(var a=[],o=[],s=new e.EffectFallbacks,l=0;l<this._options.defines.length;l++)a.push(this._options.defines[__uv.$wrap((l))]);for(l=0;l<this._options.attributes.length;l++)o.push(this._options.attributes[__uv.$wrap((l))]);for(var c in t&&t.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(o.push(e.VertexBuffer.ColorKind),a.push("#define VERTEXCOLOR")),i&&(a.push("#define INSTANCES"),e.MaterialHelper.PrepareAttributesForInstances(o,a)),t&&t.useBones&&t.computeBonesUsingShaders&&t.skeleton?(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),t.numBoneInfluencers>4&&(o.push(e.VertexBuffer.MatricesIndicesExtraKind),o.push(e.VertexBuffer.MatricesWeightsExtraKind)),a.push("#define NUM_BONE_INFLUENCERS "+t.numBoneInfluencers),a.push("#define BonesPerMesh "+(t.skeleton.bones.length+1)),s.addCPUSkinningFallback(0,t),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones")):a.push("#define NUM_BONE_INFLUENCERS 0"),this._textures)if(!this._textures[__uv.$wrap((c))].isReady())return!1;t&&this._shouldTurnAlphaTestOn(t)&&a.push("#define ALPHATEST");var u=this._effect,h=a.join("\n");return this._effect=n.createEffect(this._shaderPath,{attributes:o,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:h,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError},n),!!this._effect.isReady()&&(u!==this._effect&&r.resetCachedMaterial(),this._renderId=r.getRenderId(),!0)},i.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",e.multiply(t.getTransformMatrix())))},i.prototype.bind=function(t,i){if(this.bindOnlyWorldMatrix(t),this._effect&&this.getScene().getCachedMaterial()!==this){var r;for(r in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._effect),this._textures)this._effect.setTexture(r,this._textures[__uv.$wrap((r))]);for(r in this._textureArrays)this._effect.setTextureArray(r,this._textureArrays[__uv.$wrap((r))]);for(r in this._ints)this._effect.setInt(r,this._ints[__uv.$wrap((r))]);for(r in this._floats)this._effect.setFloat(r,this._floats[__uv.$wrap((r))]);for(r in this._floatsArrays)this._effect.setArray(r,this._floatsArrays[__uv.$wrap((r))]);for(r in this._colors3)this._effect.setColor3(r,this._colors3[__uv.$wrap((r))]);for(r in this._colors3Arrays)this._effect.setArray3(r,this._colors3Arrays[__uv.$wrap((r))]);for(r in this._colors4){var n=this._colors4[__uv.$wrap((r))];this._effect.setFloat4(r,n.r,n.g,n.b,n.a)}for(r in this._vectors2)this._effect.setVector2(r,this._vectors2[__uv.$wrap((r))]);for(r in this._vectors3)this._effect.setVector3(r,this._vectors3[__uv.$wrap((r))]);for(r in this._vectors4)this._effect.setVector4(r,this._vectors4[__uv.$wrap((r))]);for(r in this._matrices)this._effect.setMatrix(r,this._matrices[__uv.$wrap((r))]);for(r in this._matrices3x3)this._effect.setMatrix3x3(r,this._matrices3x3[__uv.$wrap((r))]);for(r in this._matrices2x2)this._effect.setMatrix2x2(r,this._matrices2x2[__uv.$wrap((r))]);for(r in this._vectors2Arrays)this._effect.setArray2(r,this._vectors2Arrays[__uv.$wrap((r))]);for(r in this._vectors3Arrays)this._effect.setArray3(r,this._vectors3Arrays[__uv.$wrap((r))])}this._afterBind(i)},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);for(var i in this._textures)e.push(this._textures[__uv.$wrap((i))]);for(var i in this._textureArrays)for(var r=this._textureArrays[__uv.$wrap((i))],n=0;n<r.length;n++)e.push(r[__uv.$wrap((n))]);return e},i.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;for(var i in this._textures)if(this._textures[__uv.$wrap((i))]===e)return!0;for(var i in this._textureArrays)for(var r=this._textureArrays[__uv.$wrap((i))],n=0;n<r.length;n++)if(r[__uv.$wrap((n))]===e)return!0;return!1},i.prototype.clone=function(e,t){return new i(e,t||this.getScene(),this._shaderPath,this._options)},i.prototype.dispose=function(e,i){if(i){var r;for(r in this._textures)this._textures[__uv.$wrap((r))].dispose();for(r in this._textureArrays)for(var n=this._textureArrays[__uv.$wrap((r))],a=0;a<n.length;a++)n[__uv.$wrap((a))].dispose()}this._textures={},t.prototype.dispose.call(this,e,i)},i.prototype.serialize=function(){var t,i=e.SerializationHelper.Serialize(this);for(t in i.customType="BABYLON.ShaderMaterial",i.options=this._options,i.shaderPath=this._shaderPath,i.textures={},this._textures)i.textures[__uv.$wrap((t))]=this._textures[__uv.$wrap((t))].serialize();for(t in i.textureArrays={},this._textureArrays){i.textureArrays[__uv.$wrap((t))]=[];for(var r=this._textureArrays[__uv.$wrap((t))],n=0;n<r.length;n++)i.textureArrays[__uv.$wrap((t))].push(r[__uv.$wrap((n))].serialize())}for(t in i.floats={},this._floats)i.floats[__uv.$wrap((t))]=this._floats[__uv.$wrap((t))];for(t in i.FloatArrays={},this._floatsArrays)i.FloatArrays[__uv.$wrap((t))]=this._floatsArrays[__uv.$wrap((t))];for(t in i.colors3={},this._colors3)i.colors3[__uv.$wrap((t))]=this._colors3[__uv.$wrap((t))].asArray();for(t in i.colors3Arrays={},this._colors3Arrays)i.colors3Arrays[__uv.$wrap((t))]=this._colors3Arrays[__uv.$wrap((t))];for(t in i.colors4={},this._colors4)i.colors4[__uv.$wrap((t))]=this._colors4[__uv.$wrap((t))].asArray();for(t in i.vectors2={},this._vectors2)i.vectors2[__uv.$wrap((t))]=this._vectors2[__uv.$wrap((t))].asArray();for(t in i.vectors3={},this._vectors3)i.vectors3[__uv.$wrap((t))]=this._vectors3[__uv.$wrap((t))].asArray();for(t in i.vectors4={},this._vectors4)i.vectors4[__uv.$wrap((t))]=this._vectors4[__uv.$wrap((t))].asArray();for(t in i.matrices={},this._matrices)i.matrices[__uv.$wrap((t))]=this._matrices[__uv.$wrap((t))].asArray();for(t in i.matrices3x3={},this._matrices3x3)i.matrices3x3[__uv.$wrap((t))]=this._matrices3x3[__uv.$wrap((t))];for(t in i.matrices2x2={},this._matrices2x2)i.matrices2x2[__uv.$wrap((t))]=this._matrices2x2[__uv.$wrap((t))];for(t in i.vectors2Arrays={},this._vectors2Arrays)i.vectors2Arrays[__uv.$wrap((t))]=this._vectors2Arrays[__uv.$wrap((t))];for(t in i.vectors3Arrays={},this._vectors3Arrays)i.vectors3Arrays[__uv.$wrap((t))]=this._vectors3Arrays[__uv.$wrap((t))];return i},i.Parse=function(t,r,n){var a,o=e.SerializationHelper.Parse((function(){return new i(t.name,r,t.shaderPath,t.options)}),t,r,n);for(a in t.textures)o.setTexture(a,e.Texture.Parse(t.textures[__uv.$wrap((a))],r,n));for(a in t.textureArrays){for(var s=t.textureArrays[__uv.$wrap((a))],l=new Array,c=0;c<s.length;c++)l.push(e.Texture.Parse(s[__uv.$wrap((c))],r,n));o.setTextureArray(a,l)}for(a in t.floats)o.setFloat(a,t.floats[__uv.$wrap((a))]);for(a in t.floatsArrays)o.setFloats(a,t.floatsArrays[__uv.$wrap((a))]);for(a in t.colors3)o.setColor3(a,e.Color3.FromArray(t.colors3[__uv.$wrap((a))]));for(a in t.colors3Arrays){var u=t.colors3Arrays[__uv.$wrap((a))].reduce((function(e,t,i){return i%3==0?e.push([t]):e[__uv.$wrap((e.length-1))].push(t),e}),[]).map((function(t){return e.Color3.FromArray(t)}));o.setColor3Array(a,u)}for(a in t.colors4)o.setColor4(a,e.Color4.FromArray(t.colors4[__uv.$wrap((a))]));for(a in t.vectors2)o.setVector2(a,e.Vector2.FromArray(t.vectors2[__uv.$wrap((a))]));for(a in t.vectors3)o.setVector3(a,e.Vector3.FromArray(t.vectors3[__uv.$wrap((a))]));for(a in t.vectors4)o.setVector4(a,e.Vector4.FromArray(t.vectors4[__uv.$wrap((a))]));for(a in t.matrices)o.setMatrix(a,e.Matrix.FromArray(t.matrices[__uv.$wrap((a))]));for(a in t.matrices3x3)o.setMatrix3x3(a,t.matrices3x3[__uv.$wrap((a))]);for(a in t.matrices2x2)o.setMatrix2x2(a,t.matrices2x2[__uv.$wrap((a))]);for(a in t.vectors2Arrays)o.setArray2(a,t.vectors2Arrays[__uv.$wrap((a))]);for(a in t.vectors3Arrays)o.setArray3(a,t.vectors3Arrays[__uv.$wrap((a))]);return o},i}(e.Material);e.ShaderMaterial=t}(s||(s={})),function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.generateOctree=!1,r}return a(i,t),i.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(i.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)},i.prototype.getHeightAtCoordinates=function(t,i){var r=this.getWorldMatrix(),n=e.Tmp.Matrix[__uv.$wrap((5))];r.invertToRef(n);var a=e.Tmp.Vector3[__uv.$wrap((8))];if(e.Vector3.TransformCoordinatesFromFloatsToRef(t,0,i,n,a),t=a.x,i=a.z,t<this._minX||t>this._maxX||i<this._minZ||i>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var o=this._getFacetAt(t,i),s=-(o.x*t+o.z*i+o.w)/o.y;return e.Vector3.TransformCoordinatesFromFloatsToRef(0,s,0,r,a),a.y},i.prototype.getNormalAtCoordinates=function(t,i){var r=new e.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(t,i,r),r},i.prototype.getNormalAtCoordinatesToRef=function(t,i,r){var n=this.getWorldMatrix(),a=e.Tmp.Matrix[__uv.$wrap((5))];n.invertToRef(a);var o=e.Tmp.Vector3[__uv.$wrap((8))];if(e.Vector3.TransformCoordinatesFromFloatsToRef(t,0,i,a,o),t=o.x,i=o.z,t<this._minX||t>this._maxX||i<this._minZ||i>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var s=this._getFacetAt(t,i);return e.Vector3.TransformNormalFromFloatsToRef(s.x,s.y,s.z,n,r),this},i.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},i.prototype._getFacetAt=function(e,t){var i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[__uv.$wrap((r*this._subdivisionsX+i))];return t<n.slope.x*e+n.slope.y?n.facet1:n.facet2},i.prototype._initHeightQuads=function(){var t=this._subdivisionsX,i=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<i;r++)for(var n=0;n<t;n++){var a={slope:e.Vector2.Zero(),facet1:new e.Vector4(0,0,0,0),facet2:new e.Vector4(0,0,0,0)};this._heightQuads[__uv.$wrap((r*t+n))]=a}return this},i.prototype._computeHeightQuads=function(){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return this;for(var i=e.Tmp.Vector3[__uv.$wrap((3))],r=e.Tmp.Vector3[__uv.$wrap((2))],n=e.Tmp.Vector3[__uv.$wrap((1))],a=e.Tmp.Vector3[__uv.$wrap((0))],o=e.Tmp.Vector3[__uv.$wrap((4))],s=e.Tmp.Vector3[__uv.$wrap((5))],l=e.Tmp.Vector3[__uv.$wrap((6))],c=e.Tmp.Vector3[__uv.$wrap((7))],u=e.Tmp.Vector3[__uv.$wrap((8))],h=0,d=0,p=0,m=0,_=0,f=0,g=0,y=this._subdivisionsX,v=this._subdivisionsY,b=0;b<v;b++)for(var x=0;x<y;x++){h=3*x,d=b*(y+1)*3,p=(b+1)*(y+1)*3,i.x=t[__uv.$wrap((d+h))],i.y=t[__uv.$wrap((d+h+1))],i.z=t[__uv.$wrap((d+h+2))],r.x=t[__uv.$wrap((d+h+3))],r.y=t[__uv.$wrap((d+h+4))],r.z=t[__uv.$wrap((d+h+5))],n.x=t[__uv.$wrap((p+h))],n.y=t[__uv.$wrap((p+h+1))],n.z=t[__uv.$wrap((p+h+2))],a.x=t[__uv.$wrap((p+h+3))],a.y=t[__uv.$wrap((p+h+4))],a.z=t[__uv.$wrap((p+h+5))],m=(a.z-i.z)/(a.x-i.x),_=i.z-m*i.x,r.subtractToRef(i,o),n.subtractToRef(i,s),a.subtractToRef(i,l),e.Vector3.CrossToRef(l,s,c),e.Vector3.CrossToRef(o,l,u),c.normalize(),u.normalize(),f=-(c.x*i.x+c.y*i.y+c.z*i.z),g=-(u.x*r.x+u.y*r.y+u.z*r.z);var S=this._heightQuads[__uv.$wrap((b*y+x))];S.slope.copyFromFloats(m,_),S.facet1.copyFromFloats(c.x,c.y,c.z,f),S.facet2.copyFromFloats(u.x,u.y,u.z,g)}return this},i.prototype.serialize=function(e){t.prototype.serialize.call(this,e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height},i.Parse=function(e,t){var r=new i(e.name,t);return r._subdivisionsX=e.subdivisionsX||1,r._subdivisionsY=e.subdivisionsY||1,r._minX=e.minX,r._maxX=e.maxX,r._minZ=e.minZ,r._maxZ=e.maxZ,r._width=e.width,r._height=e.height,r},i}(e.Mesh);e.GroundMesh=t}(s||(s={})),function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i.getScene())||this;return i.instances.push(r),r._sourceMesh=i,r.position.copyFrom(i.position),r.rotation.copyFrom(i.rotation),r.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(r.rotationQuaternion=i.rotationQuaternion.clone()),r.infiniteDistance=i.infiniteDistance,r.setPivotMatrix(i.getPivotMatrix()),r.refreshBoundingInfo(),r._syncSubMeshes(),r}return a(i,t),i.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(t){this._sourceMesh&&t!==this._sourceMesh.renderingGroupId&&e.Tools.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(i.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),i.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},i.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},i.prototype.setVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,r),this.sourceMesh},i.prototype.updateVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,r),this.sourceMesh},i.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},i.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),i.prototype.refreshBoundingInfo=function(){var t=this._sourceMesh.getBoundingInfo();return this._boundingInfo=new e.BoundingInfo(t.minimum.clone(),t.maximum.clone()),this._updateBoundingInfo(),this},i.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},i.prototype._activate=function(e){return this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e),this},i.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},i.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[__uv.$wrap((e))].clone(this,this._sourceMesh);return this},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype.clone=function(t,i,r){var n=this._sourceMesh.createInstance(t);if(e.Tools.DeepCopy(this,n,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),i&&(n.__uv$setSource(__uv).__uv$parent=i),!r)for(var a=0;a<this.getScene().meshes.length;a++){var o=this.getScene().meshes[__uv.$wrap((a))];o.__uv$setSource(__uv).__uv$parent===this&&o.clone(o.name,n)}return n.computeWorldMatrix(!0),n},i.prototype.dispose=function(e,i){void 0===i&&(i=!1);var r=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(r,1),t.prototype.dispose.call(this,e,i)},i}(e.AbstractMesh);e.InstancedMesh=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l){void 0===r&&(r=null),void 0===n&&(n=null);var c=t.call(this,i,r,n,a,o)||this;c.useVertexColor=s,c.useVertexAlpha=l,c.color=new e.Color3(1,1,1),c.alpha=1,a&&(c.color=a.color.clone(),c.alpha=a.alpha,c.useVertexColor=a.useVertexColor,c.useVertexAlpha=a.useVertexAlpha),c._intersectionThreshold=.1;var u={attributes:[e.VertexBuffer.PositionKind,"world0","world1","world2","world3"],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===l&&(u.needAlphaBlending=!1),s?(u.defines.push("#define VERTEXCOLOR"),u.attributes.push(e.VertexBuffer.ColorKind)):u.uniforms.push("color"),c._colorShader=new e.ShaderMaterial("colorShader",c.getScene(),"color",u),c}return a(i,t),Object.defineProperty(i.prototype,"intersectionThreshold",{get:function(){return this._intersectionThreshold},set:function(t){this._intersectionThreshold!==t&&(this._intersectionThreshold=t,this.geometry&&(this.geometry.boundingBias=new e.Vector2(0,t)))},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(i.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype._bind=function(e,t,i){return this._geometry?(this._geometry._bind(this._colorShader.getEffect()),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),this):this},i.prototype._draw=function(t,i,r){return this._geometry&&this._geometry.getVertexBuffers()&&(this._unIndexed||this._geometry.getIndexBuffer())?(this.getScene().getEngine().drawElementsType(e.Material.LineListDrawMode,t.indexStart,t.indexCount,r),this):this},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i.prototype.clone=function(e,t,r){return new i(e,this.getScene(),t,this,r)},i}(e.Mesh);e.LinesMesh=t}(s||(s={})),function(e){var t=function(){function e(){this._count=0,this._data={}}return e.prototype.copyFrom=function(e){var t=this;this.clear(),e.forEach((function(e,i){return t.add(e,i)}))},e.prototype.get=function(e){var t=this._data[__uv.$wrap((e))];if(void 0!==t)return t},e.prototype.getOrAddWithFactory=function(e,t){var i=this.get(e);return void 0!==i||(i=t(e))&&this.add(e,i),i},e.prototype.getOrAdd=function(e,t){var i=this.get(e);return void 0!==i?i:(this.add(e,t),t)},e.prototype.contains=function(e){return void 0!==this._data[__uv.$wrap((e))]},e.prototype.add=function(e,t){return void 0===this._data[__uv.$wrap((e))]&&(this._data[__uv.$wrap((e))]=t,++this._count,!0)},e.prototype.set=function(e,t){return void 0!==this._data[__uv.$wrap((e))]&&(this._data[__uv.$wrap((e))]=t,!0)},e.prototype.getAndRemove=function(e){var t=this.get(e);return void 0!==t?(delete this._data[__uv.$wrap((e))],--this._count,t):null},e.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[__uv.$wrap((e))],--this._count,!0)},e.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e){for(var t in this._data){e(t,this._data[__uv.$wrap((t))])}},e.prototype.first=function(e){for(var t in this._data){var i=e(t,this._data[__uv.$wrap((t))]);if(i)return i}return null},e}();e.StringDictionary=t}(s||(s={})),function(e){!function(t){var i=function(){function t(t,i,r,n,a){void 0===n&&(n=!0),void 0===a&&(a=1),this.skeleton=t,this.mesh=i,this.autoUpdateBonesMatrices=n,this.renderingGroupId=a,this.color=e.Color3.White(),this._debugLines=new Array,this._isEnabled=!1,this._scene=r,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,e?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),t.prototype._getBonePosition=function(t,i,r,n,a,o){void 0===n&&(n=0),void 0===a&&(a=0),void 0===o&&(o=0);var s=e.Tmp.Matrix[__uv.$wrap((0))],l=i.getParent();if(s.copyFrom(i.getLocalMatrix()),0!==n||0!==a||0!==o){var c=e.Tmp.Matrix[__uv.$wrap((1))];e.Matrix.IdentityToRef(c),c.m[__uv.$wrap((12))]=n,c.m[__uv.$wrap((13))]=a,c.m[__uv.$wrap((14))]=o,c.multiplyToRef(s,s)}l&&s.multiplyToRef(l.getAbsoluteTransform(),s),s.multiplyToRef(r,s),t.x=s.m[__uv.$wrap((12))],t.y=s.m[__uv.$wrap((13))],t.z=s.m[__uv.$wrap((14))]},t.prototype._getLinesForBonesWithLength=function(t,i){for(var r=t.length,n=this.mesh.position,a=0;a<r;a++){var o=t[__uv.$wrap((a))],s=this._debugLines[__uv.$wrap((a))];s||(s=[e.Vector3.Zero(),e.Vector3.Zero()],this._debugLines[__uv.$wrap((a))]=s),this._getBonePosition(s[__uv.$wrap((0))],o,i),this._getBonePosition(s[__uv.$wrap((1))],o,i,0,o.length,0),s[__uv.$wrap((0))].subtractInPlace(n),s[__uv.$wrap((1))].subtractInPlace(n)}},t.prototype._getLinesForBonesNoLength=function(t,i){for(var r=t.length,n=0,a=this.mesh.position,o=r-1;o>=0;o--){var s=t[__uv.$wrap((o))],l=s.getParent();if(l){var c=this._debugLines[__uv.$wrap((n))];c||(c=[e.Vector3.Zero(),e.Vector3.Zero()],this._debugLines[__uv.$wrap((n))]=c),s.getAbsolutePositionToRef(this.mesh,c[__uv.$wrap((0))]),l.getAbsolutePositionToRef(this.mesh,c[__uv.$wrap((1))]),c[__uv.$wrap((0))].subtractInPlace(a),c[__uv.$wrap((1))].subtractInPlace(a),n++}}},t.prototype.update=function(){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms(),void 0===this.skeleton.bones[__uv.$wrap((0))].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix()),this._debugMesh?e.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=e.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color},t.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null)},t}();t.SkeletonViewer=i}(e.Debug||(e.Debug={}))}(s||(s={})),function(e){!function(t){var i=function(){function t(t,i){void 0===i&&(i=1),this._xline=[e.Vector3.Zero(),e.Vector3.Zero()],this._yline=[e.Vector3.Zero(),e.Vector3.Zero()],this._zline=[e.Vector3.Zero(),e.Vector3.Zero()],this.scaleLines=1,this.scaleLines=i,this._xmesh=e.Mesh.CreateLines("xline",this._xline,t,!0),this._ymesh=e.Mesh.CreateLines("yline",this._yline,t,!0),this._zmesh=e.Mesh.CreateLines("zline",this._zline,t,!0),this._xmesh.renderingGroupId=2,this._ymesh.renderingGroupId=2,this._zmesh.renderingGroupId=2,this._xmesh.material.checkReadyOnlyOnce=!0,this._xmesh.color=new e.Color3(1,0,0),this._ymesh.material.checkReadyOnlyOnce=!0,this._ymesh.color=new e.Color3(0,1,0),this._zmesh.material.checkReadyOnlyOnce=!0,this._zmesh.color=new e.Color3(0,0,1),this.scene=t}return t.prototype.update=function(t,i,r,n){var a=this.scaleLines;this._xmesh&&this._xmesh.position.copyFrom(t),this._ymesh&&this._ymesh.position.copyFrom(t),this._zmesh&&this._zmesh.position.copyFrom(t);var o=this._xline[__uv.$wrap((1))];o.x=i.x*a,o.y=i.y*a,o.z=i.z*a,e.Mesh.CreateLines("",this._xline,null,!1,this._xmesh),(o=this._yline[__uv.$wrap((1))]).x=r.x*a,o.y=r.y*a,o.z=r.z*a,e.Mesh.CreateLines("",this._yline,null,!1,this._ymesh),(o=this._zline[__uv.$wrap((1))]).x=n.x*a,o.y=n.y*a,o.z=n.z*a,e.Mesh.CreateLines("",this._zline,null,!1,this._zmesh)},t.prototype.dispose=function(){this._xmesh&&this._xmesh.dispose(),this._ymesh&&this._ymesh.dispose(),this._zmesh&&this._zmesh.dispose(),this._xmesh=null,this._ymesh=null,this._zmesh=null,this.scene=null},t}();t.AxesViewer=i}(e.Debug||(e.Debug={}))}(s||(s={})),function(e){!function(t){var i=function(t){function i(i,r,n,a){void 0===a&&(a=1);var o=t.call(this,i,a)||this;return o.pos=e.Vector3.Zero(),o.xaxis=e.Vector3.Zero(),o.yaxis=e.Vector3.Zero(),o.zaxis=e.Vector3.Zero(),o.mesh=n,o.bone=r,o}return a(i,t),i.prototype.update=function(){if(this.mesh&&this.bone){var i=this.bone;i.getAbsolutePositionToRef(this.mesh,this.pos),i.getDirectionToRef(e.Axis.X,this.mesh,this.xaxis),i.getDirectionToRef(e.Axis.Y,this.mesh,this.yaxis),i.getDirectionToRef(e.Axis.Z,this.mesh,this.zaxis),t.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},i.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,t.prototype.dispose.call(this))},i}(t.AxesViewer);t.BoneAxesViewer=i}(e.Debug||(e.Debug={}))}(s||(s={})),function(e){var t=function(){function t(e){this.ray=e}return t.CreateAndShow=function(e,i,r){var n=new t(e);return n.show(i,r),n},t.prototype.show=function(t,i){if(!this._renderFunction&&this.ray){var r=this.ray;this._renderFunction=this._render.bind(this),this._scene=t,this._renderPoints=[r.origin,r.origin.add(r.direction.scale(r.length))],this._renderLine=e.Mesh.CreateLines("ray",this._renderPoints,t,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}i&&this._renderLine&&this._renderLine.color.copyFrom(i)},t.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},t.prototype._render=function(){var t=this.ray;if(t){var i=this._renderPoints[__uv.$wrap((1))],r=Math.min(t.length,1e6);i.copyFrom(t.direction),i.scaleInPlace(r),i.addInPlace(t.origin),e.Mesh.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},t.prototype.attachToMesh=function(t,i,r,n){this._attachedToMesh=t;var a=this.ray;a&&(a.direction||(a.direction=e.Vector3.Zero()),a.origin||(a.origin=e.Vector3.Zero()),n&&(a.length=n),r||(r=e.Vector3.Zero()),i||(i=new e.Vector3(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(i),this._meshSpaceOrigin.copyFrom(r)):(this._meshSpaceDirection=i.clone(),this._meshSpaceOrigin=r.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},t.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},t.prototype._updateToMesh=function(){var t=this.ray;this._attachedToMesh&&t&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,t.direction),e.Vector3.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),t.origin)))},t.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},t}();e.RayHelper=t}(s||(s={})),function(e){Object.defineProperty(e.Scene.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new t(this)),this._debugLayer},enumerable:!0,configurable:!0});var t=function(){function t(t){var i=this;this.BJSINSPECTOR="undefined"!=typeof INSPECTOR?INSPECTOR:void 0,this.onPropertyChangedObservable=new e.Observable,this._scene=t,this._scene.onDisposeObservable.add((function(){i._scene._debugLayer&&i._scene._debugLayer.hide()}))}return t.prototype._createInspector=function(e){void 0===e&&(e={});var t=e.popup||!1,i=e.initialTab||0,r=e.parentElement||null;this._inspector||(this.BJSINSPECTOR=this.BJSINSPECTOR||"undefined"!=typeof INSPECTOR?INSPECTOR:void 0,this._inspector=new this.BJSINSPECTOR.Inspector(this._scene,t,i,r,e.newColors))},t.prototype.isVisible=function(){return!!this._inspector},t.prototype.hide=function(){if(this._inspector){try{this._inspector.dispose()}catch(e){}this.onPropertyChangedObservable.clear(),this._inspector=null}},t.prototype.show=function(i){void 0===i&&(i={}),void 0===this.BJSINSPECTOR?e.Tools.LoadScript(t.InspectorURL,this._createInspector.bind(this,i)):this._createInspector(i)},t.prototype.getActiveTab=function(){return this._inspector?this._inspector.getActiveTabIndex():-1},t.InspectorURL="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js",t}();e.DebugLayer=t}(s||(s={})),function(e){!function(t){var i=function(){function t(t){this._impostors=[],this._meshes=[],this._numMeshes=0,this._scene=t||e.Engine.LastCreatedScene;var i=this._scene.getPhysicsEngine();i&&(this._physicsEnginePlugin=i.getPhysicsPlugin())}return t.prototype._updateDebugMeshes=function(){for(var e=this._physicsEnginePlugin,t=0;t<this._numMeshes;t++){var i=this._impostors[__uv.$wrap((t))];if(i)if(i.isDisposed)this.hideImpostor(this._impostors[__uv.$wrap((t--))]);else{var r=this._meshes[__uv.$wrap((t))];r&&e&&e.syncMeshWithImpostor(r,i)}}},t.prototype.showImpostor=function(e){if(this._scene){for(var t=0;t<this._numMeshes;t++)if(this._impostors[__uv.$wrap((t))]==e)return;var i=this._getDebugMesh(e,this._scene);i&&(this._impostors[__uv.$wrap((this._numMeshes))]=e,this._meshes[__uv.$wrap((this._numMeshes))]=i,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++)}},t.prototype.hideImpostor=function(e){if(e&&this._scene){for(var t=!1,i=0;i<this._numMeshes;i++)if(this._impostors[__uv.$wrap((i))]==e){var r=this._meshes[__uv.$wrap((i))];if(!r)continue;this._scene.removeMesh(r),r.dispose(),this._numMeshes--,this._numMeshes>0?(this._meshes[__uv.$wrap((i))]=this._meshes[__uv.$wrap((this._numMeshes))],this._impostors[__uv.$wrap((i))]=this._impostors[__uv.$wrap((this._numMeshes))],this._meshes[__uv.$wrap((this._numMeshes))]=null,this._impostors[__uv.$wrap((this._numMeshes))]=null):(this._meshes[__uv.$wrap((0))]=null,this._impostors[__uv.$wrap((0))]=null),t=!0;break}t&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},t.prototype._getDebugMaterial=function(t){return this._debugMaterial||(this._debugMaterial=new e.StandardMaterial("",t),this._debugMaterial.wireframe=!0),this._debugMaterial},t.prototype._getDebugBoxMesh=function(t){return this._debugBoxMesh||(this._debugBoxMesh=e.MeshBuilder.CreateBox("physicsBodyBoxViewMesh",{size:1},t),this._debugBoxMesh.renderingGroupId=1,this._debugBoxMesh.rotationQuaternion=e.Quaternion.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(t),t.removeMesh(this._debugBoxMesh)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},t.prototype._getDebugSphereMesh=function(t){return this._debugSphereMesh||(this._debugSphereMesh=e.MeshBuilder.CreateSphere("physicsBodySphereViewMesh",{diameter:1},t),this._debugSphereMesh.renderingGroupId=1,this._debugSphereMesh.rotationQuaternion=e.Quaternion.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(t),t.removeMesh(this._debugSphereMesh)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},t.prototype._getDebugMesh=function(t,i){var r=null;if(t.type==e.PhysicsImpostor.BoxImpostor)r=this._getDebugBoxMesh(i),t.getBoxSizeToRef(r.scaling);else if(t.type==e.PhysicsImpostor.SphereImpostor){r=this._getDebugSphereMesh(i);var n=t.getRadius();r.scaling.x=2*n,r.scaling.y=2*n,r.scaling.z=2*n}return r},t.prototype.dispose=function(){for(var e=0;e<this._numMeshes;e++)this.hideImpostor(this._impostors[__uv.$wrap((e))]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null},t}();t.PhysicsViewer=i}(e.Debug||(e.Debug={}))}(s||(s={})),function(e){Object.defineProperty(e.Scene.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(e){this._forceShowBoundingBoxes=e,e&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),e.Scene.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new t(this)),this._boundingBoxRenderer},Object.defineProperty(e.AbstractMesh.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(e){this._showBoundingBox=e,e&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_BOUNDINGBOXRENDERER,this.frontColor=new e.Color3(1,1,1),this.backColor=new e.Color3(.1,.1,.1),this.showBackLines=!0,this.renderList=new e.SmartArray(32),this._vertexBuffers={},this.scene=t,t._addComponent(this)}return t.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(e.SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._activeMeshStage.registerStep(e.SceneComponentConstants.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER,this,this._activeMesh),this.scene._evaluateSubMeshStage.registerStep(e.SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},t.prototype._evaluateSubMesh=function(e,t){if(e.showSubMeshesBoundingBox){var i=t.getBoundingInfo();null!=i&&(i.boundingBox._tag=e.renderingGroupId,this.renderList.push(i.boundingBox))}},t.prototype._activeMesh=function(e,t){if(e.showBoundingBox||this.scene.forceShowBoundingBoxes){var i=e.getBoundingInfo();i.boundingBox._tag=t.renderingGroupId,this.renderList.push(i.boundingBox)}},t.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new e.ShaderMaterial("colorShader",this.scene,"color",{attributes:[e.VertexBuffer.PositionKind],uniforms:["world","viewProjection","color"]});var t=this.scene.getEngine(),i=e.VertexData.CreateBox({size:1});this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=new e.VertexBuffer(t,i.positions,e.VertexBuffer.PositionKind,!1),this._createIndexBuffer()}},t.prototype._createIndexBuffer=function(){var e=this.scene.getEngine();this._indexBuffer=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},t.prototype.rebuild=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&t._rebuild(),this._createIndexBuffer()},t.prototype.reset=function(){this.renderList.reset()},t.prototype.render=function(t){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var i=this.scene.getEngine();i.setDepthWrite(!1),this._colorShader._preBind();for(var r=0;r<this.renderList.length;r++){var n=this.renderList.data[__uv.$wrap((r))];if(n._tag===t){var a=n.minimum,o=n.maximum.subtract(a),s=a.add(o.scale(.5)),l=e.Matrix.Scaling(o.x,o.y,o.z).multiply(e.Matrix.Translation(s.x,s.y,s.z)).multiply(n.getWorldMatrix());i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(i.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(l),i.drawElementsType(e.Material.LineListDrawMode,0,24)),i.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(l),i.drawElementsType(e.Material.LineListDrawMode,0,24)}}this._colorShader.unbind(),i.setDepthFunctionToLessOrEqual(),i.setDepthWrite(!0)}},t.prototype.renderOcclusionBoundingBox=function(t){if(this._prepareRessources(),this._colorShader.isReady()&&t._boundingInfo){var i=this.scene.getEngine();i.setDepthWrite(!1),i.setColorWrite(!1),this._colorShader._preBind();var r=t._boundingInfo.boundingBox,n=r.minimum,a=r.maximum.subtract(n),o=n.add(a.scale(.5)),s=e.Matrix.Scaling(a.x,a.y,a.z).multiply(e.Matrix.Translation(o.x,o.y,o.z)).multiply(r.getWorldMatrix());i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),i.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(s),i.drawElementsType(e.Material.LineListDrawMode,0,24),this._colorShader.unbind(),i.setDepthFunctionToLessOrEqual(),i.setDepthWrite(!0),i.setColorWrite(!0)}},t.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&(t.dispose(),this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer)}},t}();e.BoundingBoxRenderer=t}(s||(s={})),function(e){e.Engine.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},e.Engine.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},e.Engine.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},e.Engine.prototype.beginTransformFeedback=function(e){void 0===e&&(e=!0),this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},e.Engine.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},e.Engine.prototype.setTranformFeedbackVaryings=function(e,t){this._gl.transformFeedbackVaryings(e,t,this._gl.INTERLEAVED_ATTRIBS)},e.Engine.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e)}}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){void 0===a&&(a=!1);var s=t.call(this,i)||this;s.layerMask=268435455,s._accumulatedCount=0,s._targetIndex=0,s._currentRenderId=-1,s._started=!1,s._stopped=!1,s._timeDelta=0,s._attributesStrideSize=21,s._actualFrame=0,s._rawTextureWidth=256,s.onDisposeObservable=new e.Observable,s.forceDepthWrite=!1,s._preWarmDone=!1,s._scene=n||e.Engine.LastCreatedScene,s._attachImageProcessingConfiguration(null),s._engine=s._scene.getEngine(),r.randomTextureSize||delete r.randomTextureSize;var l=o({capacity:5e4,randomTextureSize:s._engine.getCaps().maxTextureSize},r),c=r;isFinite(c)&&(l.capacity=c),s._capacity=l.capacity,s._activeCount=l.capacity,s._currentActiveCount=0,s._isAnimationSheetEnabled=a,s._scene.particleSystems.push(s),s._updateEffectOptions={attributes:["position","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},s.particleEmitterType=new e.BoxParticleEmitter;for(var u=Math.min(s._engine.getCaps().maxTextureSize,l.randomTextureSize),h=[],d=0;d<u;++d)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());s._randomTexture=new e.RawTexture(new Float32Array(h),u,1,e.Engine.TEXTUREFORMAT_RGBA,s._scene,!1,!1,e.Texture.NEAREST_SAMPLINGMODE,e.Engine.TEXTURETYPE_FLOAT),s._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,s._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE,h=[];for(d=0;d<u;++d)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());return s._randomTexture2=new e.RawTexture(new Float32Array(h),u,1,e.Engine.TEXTUREFORMAT_RGBA,s._scene,!1,!1,e.Texture.NEAREST_SAMPLINGMODE,e.Engine.TEXTURETYPE_FLOAT),s._randomTexture2.wrapU=e.Texture.WRAP_ADDRESSMODE,s._randomTexture2.wrapV=e.Texture.WRAP_ADDRESSMODE,s._randomTextureSize=u,s}return a(i,t),Object.defineProperty(i,"IsSupported",{get:function(){return!!e.Engine.LastCreatedEngine&&e.Engine.LastCreatedEngine.webGLVersion>1},enumerable:!0,configurable:!0}),i.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(i.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(e){this._activeCount=Math.min(e,this._capacity)},enumerable:!0,configurable:!0}),i.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&this._imageProcessingConfiguration.isReady()&&this._renderEffect.isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},i.prototype.isStarted=function(){return this._started},i.prototype.start=function(e){var t=this;if(void 0===e&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";e?setTimeout((function(){t.start(0)}),e):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},i.prototype.stop=function(){this._stopped=!0},i.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},i.prototype.getClassName=function(){return"GPUParticleSystem"},i.prototype._removeGradientAndTexture=function(e,i,r){return t.prototype._removeGradientAndTexture.call(this,e,i,r),this._releaseBuffers(),this},i.prototype.addColorGradient=function(t,i,r){this._colorGradients||(this._colorGradients=[]);var n=new e.ColorGradient;return n.gradient=t,n.color1=i,this._colorGradients.push(n),this._colorGradients.sort((function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0})),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._releaseBuffers(),this},i.prototype.removeColorGradient=function(e){return this._removeGradientAndTexture(e,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},i.prototype._addFactorGradient=function(t,i,r){var n=new e.FactorGradient;n.gradient=i,n.factor1=r,t.push(n),t.sort((function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0})),this._releaseBuffers()},i.prototype.addSizeGradient=function(e,t){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,t),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._releaseBuffers(),this},i.prototype.removeSizeGradient=function(e){return this._removeGradientAndTexture(e,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},i.prototype.addAngularSpeedGradient=function(e,t){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,t),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._releaseBuffers(),this},i.prototype.removeAngularSpeedGradient=function(e){return this._removeGradientAndTexture(e,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},i.prototype.addVelocityGradient=function(e,t){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,t),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._releaseBuffers(),this},i.prototype.removeVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},i.prototype.addLimitVelocityGradient=function(e,t){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,t),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._releaseBuffers(),this},i.prototype.removeLimitVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},i.prototype.addDragGradient=function(e,t){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,t),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._releaseBuffers(),this},i.prototype.removeDragGradient=function(e){return this._removeGradientAndTexture(e,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},i.prototype.addEmitRateGradient=function(e,t,i){return this},i.prototype.removeEmitRateGradient=function(e){return this},i.prototype.addStartSizeGradient=function(e,t,i){return this},i.prototype.removeStartSizeGradient=function(e){return this},i.prototype.addColorRemapGradient=function(e,t,i){return this},i.prototype.removeColorRemapGradient=function(e){return this},i.prototype.addAlphaRemapGradient=function(e,t,i){return this},i.prototype.removeAlphaRemapGradient=function(e){return this},i.prototype.addRampGradient=function(e,t){return this},i.prototype.removeRampGradient=function(e){return this},i.prototype.getRampGradients=function(){return null},Object.defineProperty(i.prototype,"useRampGradients",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0}),i.prototype.addLifeTimeGradient=function(e,t,i){return this},i.prototype.removeLifeTimeGradient=function(e){return this},i.prototype._reset=function(){this._releaseBuffers()},i.prototype._createUpdateVAO=function(e){var t={};t.position=e.createVertexBuffer("position",0,3),t.age=e.createVertexBuffer("age",3,1),t.life=e.createVertexBuffer("life",4,1),t.seed=e.createVertexBuffer("seed",5,4),t.size=e.createVertexBuffer("size",9,3);var i=12;this._colorGradientsTexture||(t.color=e.createVertexBuffer("color",i,4),i+=4),t.direction=e.createVertexBuffer("direction",i,3),i+=3,this._isBillboardBased||(t.initialDirection=e.createVertexBuffer("initialDirection",i,3),i+=3),this._angularSpeedGradientsTexture?(t.angle=e.createVertexBuffer("angle",i,1),i+=1):(t.angle=e.createVertexBuffer("angle",i,2),i+=2),this._isAnimationSheetEnabled&&(t.cellIndex=e.createVertexBuffer("cellIndex",i,1),i+=1,this.spriteRandomStartCell&&(t.cellStartOffset=e.createVertexBuffer("cellStartOffset",i,1),i+=1)),this.noiseTexture&&(t.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",i,3),i+=3,t.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",i,3),i+=3);var r=this._engine.recordVertexArrayObject(t,null,this._updateEffect);return this._engine.bindArrayBuffer(null),r},i.prototype._createRenderVAO=function(t,i){var r={};r.position=t.createVertexBuffer("position",0,3,this._attributesStrideSize,!0),r.age=t.createVertexBuffer("age",3,1,this._attributesStrideSize,!0),r.life=t.createVertexBuffer("life",4,1,this._attributesStrideSize,!0),r.size=t.createVertexBuffer("size",9,3,this._attributesStrideSize,!0);var n=12;this._colorGradientsTexture||(r.color=t.createVertexBuffer("color",n,4,this._attributesStrideSize,!0),n+=4),this.billboardMode===e.ParticleSystem.BILLBOARDMODE_STRETCHED&&(r.direction=t.createVertexBuffer("direction",n,3,this._attributesStrideSize,!0)),n+=3,this._isBillboardBased||(r.initialDirection=t.createVertexBuffer("initialDirection",n,3,this._attributesStrideSize,!0),n+=3),r.angle=t.createVertexBuffer("angle",n,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?n++:n+=2,this._isAnimationSheetEnabled&&(r.cellIndex=t.createVertexBuffer("cellIndex",n,1,this._attributesStrideSize,!0),n+=1,this.spriteRandomStartCell&&(r.cellStartOffset=t.createVertexBuffer("cellStartOffset",n,1,this._attributesStrideSize,!0),n+=1)),this.noiseTexture&&(r.noiseCoordinates1=t.createVertexBuffer("noiseCoordinates1",n,3,this._attributesStrideSize,!0),n+=3,r.noiseCoordinates2=t.createVertexBuffer("noiseCoordinates2",n,3,this._attributesStrideSize,!0),n+=3),r.offset=i.createVertexBuffer("offset",0,2),r.uv=i.createVertexBuffer("uv",2,2);var a=this._engine.recordVertexArrayObject(r,null,this._renderEffect);return this._engine.bindArrayBuffer(null),a},i.prototype._initialize=function(t){if(void 0===t&&(t=!1),!this._buffer0||t){var i=this._scene.getEngine(),r=new Array;this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var n=0;n<this._capacity;n++)r.push(0),r.push(0),r.push(0),r.push(0),r.push(0),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(0),r.push(0),r.push(0),this._colorGradientsTexture||(r.push(0),r.push(0),r.push(0),r.push(0)),r.push(0),r.push(0),r.push(0),this.isBillboardBased||(r.push(0),r.push(0),r.push(0)),r.push(0),this._angularSpeedGradientsTexture||r.push(0),this._isAnimationSheetEnabled&&(r.push(0),this.spriteRandomStartCell&&r.push(0)),this.noiseTexture&&(r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()),r.push(Math.random()));var a=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new e.Buffer(i,r,!1,this._attributesStrideSize),this._buffer1=new e.Buffer(i,r,!1,this._attributesStrideSize),this._spriteBuffer=new e.Buffer(i,a,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},i.prototype._recreateUpdateEffect=function(){var t=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(t+="\n#define BILLBOARD"),this._colorGradientsTexture&&(t+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(t+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(t+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(t+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(t+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(t+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(t+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(t+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(t+="\n#define NOISE"),this._updateEffect&&this._updateEffectOptions.defines===t||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition","outAge","outLife","outSeed","outSize"],this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=t,this._updateEffect=new e.Effect("gpuUpdateParticles",this._updateEffectOptions,this._scene.getEngine()))},i.prototype._recreateRenderEffect=function(){var t="";if(this._scene.clipPlane&&(t="\n#define CLIPPLANE"),this._scene.clipPlane2&&(t="\n#define CLIPPLANE2"),this._scene.clipPlane3&&(t="\n#define CLIPPLANE3"),this._scene.clipPlane4&&(t="\n#define CLIPPLANE4"),this.blendMode===e.ParticleSystem.BLENDMODE_MULTIPLY&&(t="\n#define BLENDMULTIPLYMODE"),this._isBillboardBased)switch(t+="\n#define BILLBOARD",this.billboardMode){case e.ParticleSystem.BILLBOARDMODE_Y:t+="\n#define BILLBOARDY";break;case e.ParticleSystem.BILLBOARDMODE_STRETCHED:t+="\n#define BILLBOARDSTRETCHED";break;case e.ParticleSystem.BILLBOARDMODE_ALL:}if(this._colorGradientsTexture&&(t+="\n#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&(t+="\n#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t+="\n"+this._imageProcessingConfigurationDefines.toString()),!this._renderEffect||this._renderEffect.defines!==t){var i=["view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","sheetInfos","translationPivot","eyePosition"],r=["textureSampler","colorGradientSampler"];e.ImageProcessingConfiguration&&(e.ImageProcessingConfiguration.PrepareUniforms(i,this._imageProcessingConfigurationDefines),e.ImageProcessingConfiguration.PrepareSamplers(r,this._imageProcessingConfigurationDefines)),this._renderEffect=new e.Effect("gpuRenderParticles",["position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"],i,r,this._scene.getEngine(),t)}},i.prototype.animate=function(e){void 0===e&&(e=!1),this._timeDelta=this.updateSpeed*(e?this.preWarmStepOffset:this._scene.getAnimationRatio()),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},i.prototype._createFactorGradientTexture=function(t,i){var r=this[__uv.$wrap((i))];if(t&&t.length&&!r){for(var n=new Float32Array(this._rawTextureWidth),a=0;a<this._rawTextureWidth;a++){var o=a/this._rawTextureWidth;e.Tools.GetCurrentGradient(o,t,(function(t,i,r){n[__uv.$wrap((a))]=e.Scalar.Lerp(t.factor1,i.factor1,r)}))}this[__uv.$wrap((i))]=e.RawTexture.CreateRTexture(n,this._rawTextureWidth,1,this._scene,!1,!1,e.Texture.NEAREST_SAMPLINGMODE)}},i.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},i.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},i.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},i.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},i.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},i.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var t=new Uint8Array(4*this._rawTextureWidth),i=e.Tmp.Color4[__uv.$wrap((0))],r=0;r<this._rawTextureWidth;r++){var n=r/this._rawTextureWidth;e.Tools.GetCurrentGradient(n,this._colorGradients,(function(n,a,o){e.Color4.LerpToRef(n.color1,a.color1,o,i),t[__uv.$wrap((4*r))]=255*i.r,t[__uv.$wrap((4*r+1))]=255*i.g,t[__uv.$wrap((4*r+2))]=255*i.b,t[__uv.$wrap((4*r+3))]=255*i.a}))}this._colorGradientsTexture=e.RawTexture.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,e.Texture.NEAREST_SAMPLINGMODE)}},i.prototype.render=function(t){if(void 0===t&&(t=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady())return 0;if(!t){if(!this._preWarmDone&&this.preWarmCycles){for(var i=0;i<this.preWarmCycles;i++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId())return 0;this._currentRenderId=this._scene.getRenderId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var r=0|this._accumulatedCount;this._accumulatedCount-=r,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+r)}if(!this._currentActiveCount)return 0;var n;if(this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position){n=this.emitter.getWorldMatrix()}else{var a=this.emitter;n=e.Matrix.Translation(a.x,a.y,a.z)}if(this._updateEffect.setMatrix("emitterWM",n),this._engine.bindVertexArrayObject(this._updateVAO[__uv.$wrap((this._targetIndex))],null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(!0),this._engine.drawArraysType(e.Material.PointListDrawMode,0,this._currentActiveCount),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),!t){this._engine.enableEffect(this._renderEffect);var o=this._scene.getViewMatrix();if(this._renderEffect.setMatrix("view",o),this._renderEffect.setMatrix("projection",this._scene.getProjectionMatrix()),this._renderEffect.setTexture("textureSampler",this.particleTexture),this._renderEffect.setVector2("translationPivot",this.translationPivot),this._colorGradientsTexture?this._renderEffect.setTexture("colorGradientSampler",this._colorGradientsTexture):this._renderEffect.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var s=this.particleTexture.getBaseSize();this._renderEffect.setFloat3("sheetInfos",this.spriteCellWidth/s.width,this.spriteCellHeight/s.height,s.width/this.spriteCellWidth)}if(this._isBillboardBased){var l=this._scene.activeCamera;this._renderEffect.setVector3("eyePosition",l.globalPosition)}if(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var c=o.clone();c.invert(),this._renderEffect.setMatrix("invView",c),e.MaterialHelper.BindClipPlane(this._renderEffect,this._scene)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._renderEffect),this.blendMode){case e.ParticleSystem.BLENDMODE_ADD:this._engine.setAlphaMode(e.Engine.ALPHA_ADD);break;case e.ParticleSystem.BLENDMODE_ONEONE:this._engine.setAlphaMode(e.Engine.ALPHA_ONEONE);break;case e.ParticleSystem.BLENDMODE_STANDARD:this._engine.setAlphaMode(e.Engine.ALPHA_COMBINE);break;case e.ParticleSystem.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(e.Engine.ALPHA_MULTIPLY)}this.forceDepthWrite&&this._engine.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[__uv.$wrap((this._targetIndex))],null),this._engine.drawArraysType(e.Material.TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(e.Engine.ALPHA_DISABLE)}this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var u=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=u,this._currentActiveCount},i.prototype.rebuild=function(){this._initialize(!0)},i.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},i.prototype._releaseVAOs=function(){if(this._updateVAO){for(var e=0;e<this._updateVAO.length;e++)this._engine.releaseVertexArrayObject(this._updateVAO[__uv.$wrap((e))]);this._updateVAO=[];for(e=0;e<this._renderVAO.length;e++)this._engine.releaseVertexArrayObject(this._renderVAO[__uv.$wrap((e))]);this._renderVAO=[]}},i.prototype.dispose=function(e){void 0===e&&(e=!0);var t=this._scene.particleSystems.indexOf(this);t>-1&&this._scene.particleSystems.splice(t,1),this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},i.prototype.clone=function(t,r){var n=new i(t,{capacity:this._capacity,randomTextureSize:this._randomTextureSize},this._scene);return e.Tools.DeepCopy(this,n),void 0===r&&(r=this.emitter),n.emitter=r,this.particleTexture&&(n.particleTexture=new e.Texture(this.particleTexture.url,this._scene)),n},i.prototype.serialize=function(){var t={};return e.ParticleSystem._Serialize(t,this),t.activeParticleCount=this.activeParticleCount,t},i.Parse=function(t,r,n,a){void 0===a&&(a=!1);var o=new i(t.name,{capacity:t.capacity,randomTextureSize:t.randomTextureSize},r);return t.activeParticleCount&&(o.activeParticleCount=t.activeParticleCount),e.ParticleSystem._Parse(t,o,r,n),t.preventAutoStart&&(o.preventAutoStart=t.preventAutoStart),a||o.preventAutoStart||o.start(),o},i}(e.BaseParticleSystem);e.GPUParticleSystem=t}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a,o,s,l){void 0===l&&(l=null),this.idx=0,this.color=new e.Color4(1,1,1,1),this.position=e.Vector3.Zero(),this.rotation=e.Vector3.Zero(),this.scaling=e.Vector3.One(),this.uvs=new e.Vector4(0,0,1,1),this.velocity=e.Vector3.Zero(),this.pivot=e.Vector3.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=e.Vector3.Zero(),this.idx=t,this._pos=i,this._ind=r,this._model=n,this.shapeId=a,this.idxInShape=o,this._sps=s,l&&(this._modelBoundingInfo=l,this._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum))}return Object.defineProperty(t.prototype,"scale",{get:function(){return this.scaling},set:function(e){this.scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(e){this.rotationQuaternion=e},enumerable:!0,configurable:!0}),t.prototype.intersectsMesh=function(t){return!(!this._boundingInfo||!t._boundingInfo)&&(this._sps._bSphereOnly?e.BoundingSphere.Intersects(this._boundingInfo.boundingSphere,t._boundingInfo.boundingSphere):this._boundingInfo.intersects(t._boundingInfo,!1))},t}();e.SolidParticle=t;var i=function(e,t,i,r,n,a){this._indicesLength=0,this.shapeID=e,this._shape=t,this._indicesLength=i,this._shapeUV=r,this._positionFunction=n,this._vertexFunction=a};e.ModelShape=i;var r=function(){this.ind=0,this.indicesLength=0,this.sqDistance=0};e.DepthSortedParticle=r}(s||(s={})),function(e){var t=function(){function t(t,i,r){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!0,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._shapeCounter=0,this._copy=new e.SolidParticle(0,0,0,null,0,0,this),this._color=new e.Color4(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._cam_axisZ=e.Vector3.Zero(),this._cam_axisY=e.Vector3.Zero(),this._cam_axisX=e.Vector3.Zero(),this._axisZ=e.Axis.Z,this._camDir=e.Vector3.Zero(),this._camInvertedPosition=e.Vector3.Zero(),this._rotMatrix=new e.Matrix,this._invertMatrix=new e.Matrix,this._rotated=e.Vector3.Zero(),this._quaternion=new e.Quaternion,this._vertex=e.Vector3.Zero(),this._normal=e.Vector3.Zero(),this._yaw=0,this._pitch=0,this._roll=0,this._halfroll=0,this._halfpitch=0,this._halfyaw=0,this._sinRoll=0,this._cosRoll=0,this._sinPitch=0,this._cosPitch=0,this._sinYaw=0,this._cosYaw=0,this._mustUnrotateFixedNormals=!1,this._minimum=e.Vector3.Zero(),this._maximum=e.Vector3.Zero(),this._minBbox=e.Vector3.Zero(),this._maxBbox=e.Vector3.Zero(),this._particlesIntersect=!1,this._depthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},this._needs32Bits=!1,this._pivotBackTranslation=e.Vector3.Zero(),this._scaledPivot=e.Vector3.Zero(),this._particleHasParent=!1,this.name=t,this._scene=i||e.Engine.LastCreatedScene,this._camera=i.activeCamera,this._pickable=!!r&&r.isPickable,this._depthSort=!!r&&r.enableDepthSort,this._particlesIntersect=!!r&&r.particleIntersection,this._bSphereOnly=!!r&&r.boundingSphereOnly,this._bSphereRadiusFactor=r&&r.bSphereRadiusFactor?r.bSphereRadiusFactor:1,r&&void 0!==r.updatable?this._updatable=r.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),this._depthSort&&(this.depthSortedParticles=[])}return t.prototype.buildMesh=function(){if(0===this.nbParticles){var t=e.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(t,1),t.dispose()}this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),this.recomputeNormals&&e.VertexData.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var i=new e.VertexData;i.indices=this._depthSort?this._indices:this._indices32,i.set(this._positions32,e.VertexBuffer.PositionKind),i.set(this._normals32,e.VertexBuffer.NormalKind),this._uvs32.length>0&&i.set(this._uvs32,e.VertexBuffer.UVKind),this._colors32.length>0&&i.set(this._colors32,e.VertexBuffer.ColorKind);var r=new e.Mesh(this.name,this._scene);return i.applyToMesh(r,this._updatable),this.mesh=r,this.mesh.isPickable=this._pickable,this._depthSort||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),r},t.prototype.digest=function(t,i){var r=i&&i.facetNb||1,n=i&&i.number||0,a=i&&i.delta||0,o=t.getVerticesData(e.VertexBuffer.PositionKind),s=t.getIndices(),l=t.getVerticesData(e.VertexBuffer.UVKind),c=t.getVerticesData(e.VertexBuffer.ColorKind),u=t.getVerticesData(e.VertexBuffer.NormalKind),h=0,d=s.length/3;n?(n=n>d?d:n,r=Math.round(d/n),a=0):r=r>d?d:r;for(var p=[],m=[],_=[],f=[],g=e.Vector3.Zero(),y=r;h<d;){h>d-(r=y+Math.floor((1+a)*Math.random()))&&(r=d-h),p.length=0,m.length=0,_.length=0,f.length=0;for(var v=0,b=3*h;b<3*(h+r);b++){m.push(v);var x=s[__uv.$wrap((b))];p.push(o[__uv.$wrap((3*x))],o[__uv.$wrap((3*x+1))],o[__uv.$wrap((3*x+2))]),l&&_.push(l[__uv.$wrap((2*x))],l[__uv.$wrap((2*x+1))]),c&&f.push(c[__uv.$wrap((4*x))],c[__uv.$wrap((4*x+1))],c[__uv.$wrap((4*x+2))],c[__uv.$wrap((4*x+3))]),v++}var S,T,E=this.nbParticles,P=this._posToShape(p),A=this._uvsToShapeUV(_);for(S=0;S<P.length;S++)g.addInPlace(P[__uv.$wrap((S))]);for(g.scaleInPlace(1/P.length),S=0;S<P.length;S++)P[__uv.$wrap((S))].subtractInPlace(g);this._particlesIntersect&&(T=new e.BoundingInfo(g,g));var M=new e.ModelShape(this._shapeCounter,P,3*r,A,null,null),C=this._positions.length,R=this._indices.length;this._meshBuilder(this._index,P,this._positions,m,this._indices,_,this._uvs,f,this._colors,u,this._normals,E,0,null),this._addParticle(E,C,R,M,this._shapeCounter,0,T),this.particles[__uv.$wrap((this.nbParticles))].position.addInPlace(g),this._index+=P.length,E++,this.nbParticles++,this._shapeCounter++,h+=r}return this},t.prototype._unrotateFixedNormals=function(){for(var t=0,i=0,r=0;r<this.particles.length;r++){this._particle=this.particles[__uv.$wrap((r))],this._shape=this._particle._model._shape,this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._rotMatrix.invertToRef(this._invertMatrix);for(var n=0;n<this._shape.length;n++)i=t+3*n,e.Vector3.TransformNormalFromFloatsToRef(this._normals32[__uv.$wrap((i))],this._normals32[__uv.$wrap((i+1))],this._normals32[__uv.$wrap((i+2))],this._invertMatrix,this._normal),this._fixedNormal32[__uv.$wrap((i))]=this._normal.x,this._fixedNormal32[__uv.$wrap((i+1))]=this._normal.y,this._fixedNormal32[__uv.$wrap((i+2))]=this._normal.z;t=i+3}},t.prototype._resetCopy=function(){this._copy.position.x=0,this._copy.position.y=0,this._copy.position.z=0,this._copy.rotation.x=0,this._copy.rotation.y=0,this._copy.rotation.z=0,this._copy.rotationQuaternion=null,this._copy.scaling.x=1,this._copy.scaling.y=1,this._copy.scaling.z=1,this._copy.uvs.x=0,this._copy.uvs.y=0,this._copy.uvs.z=1,this._copy.uvs.w=1,this._copy.color=null,this._copy.translateFromPivot=!1},t.prototype._meshBuilder=function(t,i,r,n,a,o,s,l,c,u,h,d,p,m){var _,f=0,g=0,y=0;for(this._resetCopy(),m&&m.positionFunction&&(m.positionFunction(this._copy,d,p),this._mustUnrotateFixedNormals=!0),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._scaledPivot.x=this._copy.pivot.x*this._copy.scaling.x,this._scaledPivot.y=this._copy.pivot.y*this._copy.scaling.y,this._scaledPivot.z=this._copy.pivot.z*this._copy.scaling.z,this._copy.translateFromPivot?this._pivotBackTranslation.copyFromFloats(0,0,0):this._pivotBackTranslation.copyFrom(this._scaledPivot),_=0;_<i.length;_++)this._vertex.x=i[__uv.$wrap((_))].x,this._vertex.y=i[__uv.$wrap((_))].y,this._vertex.z=i[__uv.$wrap((_))].z,m&&m.vertexFunction&&m.vertexFunction(this._copy,this._vertex,_),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,this._vertex.x-=this._scaledPivot.x,this._vertex.y-=this._scaledPivot.y,this._vertex.z-=this._scaledPivot.z,e.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._rotated.addInPlace(this._pivotBackTranslation),r.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),o&&(s.push((this._copy.uvs.z-this._copy.uvs.x)*o[__uv.$wrap((f))]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*o[__uv.$wrap((f+1))]+this._copy.uvs.y),f+=2),this._copy.color?this._color=this._copy.color:l&&void 0!==l[__uv.$wrap((g))]?(this._color.r=l[__uv.$wrap((g))],this._color.g=l[__uv.$wrap((g+1))],this._color.b=l[__uv.$wrap((g+2))],this._color.a=l[__uv.$wrap((g+3))]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),c.push(this._color.r,this._color.g,this._color.b,this._color.a),g+=4,!this.recomputeNormals&&u&&(this._normal.x=u[__uv.$wrap((y))],this._normal.y=u[__uv.$wrap((y+1))],this._normal.z=u[__uv.$wrap((y+2))],e.Vector3.TransformNormalToRef(this._normal,this._rotMatrix,this._normal),h.push(this._normal.x,this._normal.y,this._normal.z),y+=3);for(_=0;_<n.length;_++){var v=t+n[__uv.$wrap((_))];a.push(v),v>65535&&(this._needs32Bits=!0)}if(this._pickable){var b=n.length/3;for(_=0;_<b;_++)this.pickedParticles.push({idx:d,faceId:_})}return this._depthSort&&this.depthSortedParticles.push(new e.DepthSortedParticle),this._copy},t.prototype._posToShape=function(t){for(var i=[],r=0;r<t.length;r+=3)i.push(new e.Vector3(t[__uv.$wrap((r))],t[__uv.$wrap((r+1))],t[__uv.$wrap((r+2))]));return i},t.prototype._uvsToShapeUV=function(e){var t=[];if(e)for(var i=0;i<e.length;i++)t.push(e[__uv.$wrap((i))]);return t},t.prototype._addParticle=function(t,i,r,n,a,o,s){void 0===s&&(s=null);var l=new e.SolidParticle(t,i,r,n,a,o,this,s);return this.particles.push(l),l},t.prototype.addShape=function(t,i,r){var n,a=t.getVerticesData(e.VertexBuffer.PositionKind),o=t.getIndices(),s=t.getVerticesData(e.VertexBuffer.UVKind),l=t.getVerticesData(e.VertexBuffer.ColorKind),c=t.getVerticesData(e.VertexBuffer.NormalKind);this._particlesIntersect&&(n=t.getBoundingInfo());for(var u,h,d=this._posToShape(a),p=this._uvsToShapeUV(s),m=r?r.positionFunction:null,_=r?r.vertexFunction:null,f=new e.ModelShape(this._shapeCounter,d,o.length,p,m,_),g=this.nbParticles,y=0;y<i;y++){var v=this._positions.length,b=this._indices.length;h=this._meshBuilder(this._index,d,this._positions,o,this._indices,s,this._uvs,l,this._colors,c,this._normals,g,y,r),this._updatable&&((u=this._addParticle(g,v,b,f,this._shapeCounter,y,n)).position.copyFrom(h.position),u.rotation.copyFrom(h.rotation),h.rotationQuaternion&&u.rotationQuaternion&&u.rotationQuaternion.copyFrom(h.rotationQuaternion),h.color&&u.color&&u.color.copyFrom(h.color),u.scaling.copyFrom(h.scaling),u.uvs.copyFrom(h.uvs)),this._index+=d.length,g++}return this.nbParticles+=i,this._shapeCounter++,this._shapeCounter-1},t.prototype._rebuildParticle=function(t){this._resetCopy(),t._model._positionFunction&&t._model._positionFunction(this._copy,t.idx,t.idxInShape),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._scaledPivot.x=this._particle.pivot.x*this._particle.scaling.x,this._scaledPivot.y=this._particle.pivot.y*this._particle.scaling.y,this._scaledPivot.z=this._particle.pivot.z*this._particle.scaling.z,this._copy.translateFromPivot?this._pivotBackTranslation.copyFromFloats(0,0,0):this._pivotBackTranslation.copyFrom(this._scaledPivot),this._shape=t._model._shape;for(var i=0;i<this._shape.length;i++)this._vertex.x=this._shape[__uv.$wrap((i))].x,this._vertex.y=this._shape[__uv.$wrap((i))].y,this._vertex.z=this._shape[__uv.$wrap((i))].z,t._model._vertexFunction&&t._model._vertexFunction(this._copy,this._vertex,i),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,this._vertex.x-=this._scaledPivot.x,this._vertex.y-=this._scaledPivot.y,this._vertex.z-=this._scaledPivot.z,e.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._rotated.addInPlace(this._pivotBackTranslation),this._positions32[__uv.$wrap((t._pos+3*i))]=this._copy.position.x+this._rotated.x,this._positions32[__uv.$wrap((t._pos+3*i+1))]=this._copy.position.y+this._rotated.y,this._positions32[__uv.$wrap((t._pos+3*i+2))]=this._copy.position.z+this._rotated.z;t.position.x=0,t.position.y=0,t.position.z=0,t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,t.rotationQuaternion=null,t.scaling.x=1,t.scaling.y=1,t.scaling.z=1,t.uvs.x=0,t.uvs.y=0,t.uvs.z=1,t.uvs.w=1,t.pivot.x=0,t.pivot.y=0,t.pivot.z=0,t.translateFromPivot=!1,t.parentId=null},t.prototype.rebuildMesh=function(){for(var t=0;t<this.particles.length;t++)this._rebuildParticle(this.particles[__uv.$wrap((t))]);return this.mesh.updateVerticesData(e.VertexBuffer.PositionKind,this._positions32,!1,!1),this},t.prototype.setParticles=function(t,i,r){if(void 0===t&&(t=0),void 0===i&&(i=this.nbParticles-1),void 0===r&&(r=!0),!this._updatable)return this;if(this.beforeUpdateParticles(t,i,r),this._cam_axisX.x=1,this._cam_axisX.y=0,this._cam_axisX.z=0,this._cam_axisY.x=0,this._cam_axisY.y=1,this._cam_axisY.z=0,this._cam_axisZ.x=0,this._cam_axisZ.y=0,this._cam_axisZ.z=1,(this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(this._invertMatrix)),this.billboard){this._camera.getDirectionToRef(this._axisZ,this._camDir),e.Vector3.TransformNormalToRef(this._camDir,this._invertMatrix,this._cam_axisZ),this._cam_axisZ.normalize();var n=this._camera.getViewMatrix(!0);e.Vector3.TransformNormalFromFloatsToRef(n.m[__uv.$wrap((1))],n.m[__uv.$wrap((5))],n.m[__uv.$wrap((9))],this._invertMatrix,this._cam_axisY),e.Vector3.CrossToRef(this._cam_axisY,this._cam_axisZ,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize()}this._depthSort&&e.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._camInvertedPosition),e.Matrix.IdentityToRef(this._rotMatrix);var a=0,o=0,s=0,l=0,c=0,u=0,h=0;this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),i=i>=this.nbParticles?this.nbParticles-1:i,this._computeBoundingBox&&(0==t&&i==this.nbParticles-1?(e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum)):this.mesh._boundingInfo&&(this._minimum.copyFrom(this.mesh._boundingInfo.boundingBox.minimum),this._maximum.copyFrom(this.mesh._boundingInfo.boundingBox.maximum)));var d=(o=this.particles[__uv.$wrap((t))]._pos)/3|0;l=4*d,u=2*d;for(var p=t;p<=i;p++){if(this._particle=this.particles[__uv.$wrap((p))],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._depthSort&&this._depthSortParticles){var m=this.depthSortedParticles[__uv.$wrap((p))];m.ind=this._particle._ind,m.indicesLength=this._particle._model._indicesLength,m.sqDistance=e.Vector3.DistanceSquared(this._particle.position,this._camInvertedPosition)}if(!this._particle.alive||this._particle._stillInvisible&&!this._particle.isVisible)o+=3*(h=this._shape.length),l+=4*h,u+=2*h;else{if(this._particle.isVisible)for(this._particle._stillInvisible=!1,this._particleHasParent=null!==this._particle.parentId,this._scaledPivot.x=this._particle.pivot.x*this._particle.scaling.x,this._scaledPivot.y=this._particle.pivot.y*this._particle.scaling.y,this._scaledPivot.z=this._particle.pivot.z*this._particle.scaling.z,this.billboard&&(this._particle.rotation.x=0,this._particle.rotation.y=0),(this._computeParticleRotation||this.billboard)&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix()),this._particleHasParent?(this._parent=this.particles[__uv.$wrap((this._particle.parentId))],this._rotated.x=this._particle.position.x*this._parent._rotationMatrix[__uv.$wrap((0))]+this._particle.position.y*this._parent._rotationMatrix[__uv.$wrap((3))]+this._particle.position.z*this._parent._rotationMatrix[__uv.$wrap((6))],this._rotated.y=this._particle.position.x*this._parent._rotationMatrix[__uv.$wrap((1))]+this._particle.position.y*this._parent._rotationMatrix[__uv.$wrap((4))]+this._particle.position.z*this._parent._rotationMatrix[__uv.$wrap((7))],this._rotated.z=this._particle.position.x*this._parent._rotationMatrix[__uv.$wrap((2))]+this._particle.position.y*this._parent._rotationMatrix[__uv.$wrap((5))]+this._particle.position.z*this._parent._rotationMatrix[__uv.$wrap((8))],this._particle._globalPosition.x=this._parent._globalPosition.x+this._rotated.x,this._particle._globalPosition.y=this._parent._globalPosition.y+this._rotated.y,this._particle._globalPosition.z=this._parent._globalPosition.z+this._rotated.z,(this._computeParticleRotation||this.billboard)&&(this._particle._rotationMatrix[__uv.$wrap((0))]=this._rotMatrix.m[__uv.$wrap((0))]*this._parent._rotationMatrix[__uv.$wrap((0))]+this._rotMatrix.m[__uv.$wrap((1))]*this._parent._rotationMatrix[__uv.$wrap((3))]+this._rotMatrix.m[__uv.$wrap((2))]*this._parent._rotationMatrix[__uv.$wrap((6))],this._particle._rotationMatrix[__uv.$wrap((1))]=this._rotMatrix.m[__uv.$wrap((0))]*this._parent._rotationMatrix[__uv.$wrap((1))]+this._rotMatrix.m[__uv.$wrap((1))]*this._parent._rotationMatrix[__uv.$wrap((4))]+this._rotMatrix.m[__uv.$wrap((2))]*this._parent._rotationMatrix[__uv.$wrap((7))],this._particle._rotationMatrix[__uv.$wrap((2))]=this._rotMatrix.m[__uv.$wrap((0))]*this._parent._rotationMatrix[__uv.$wrap((2))]+this._rotMatrix.m[__uv.$wrap((1))]*this._parent._rotationMatrix[__uv.$wrap((5))]+this._rotMatrix.m[__uv.$wrap((2))]*this._parent._rotationMatrix[__uv.$wrap((8))],this._particle._rotationMatrix[__uv.$wrap((3))]=this._rotMatrix.m[__uv.$wrap((4))]*this._parent._rotationMatrix[__uv.$wrap((0))]+this._rotMatrix.m[__uv.$wrap((5))]*this._parent._rotationMatrix[__uv.$wrap((3))]+this._rotMatrix.m[__uv.$wrap((6))]*this._parent._rotationMatrix[__uv.$wrap((6))],this._particle._rotationMatrix[__uv.$wrap((4))]=this._rotMatrix.m[__uv.$wrap((4))]*this._parent._rotationMatrix[__uv.$wrap((1))]+this._rotMatrix.m[__uv.$wrap((5))]*this._parent._rotationMatrix[__uv.$wrap((4))]+this._rotMatrix.m[__uv.$wrap((6))]*this._parent._rotationMatrix[__uv.$wrap((7))],this._particle._rotationMatrix[__uv.$wrap((5))]=this._rotMatrix.m[__uv.$wrap((4))]*this._parent._rotationMatrix[__uv.$wrap((2))]+this._rotMatrix.m[__uv.$wrap((5))]*this._parent._rotationMatrix[__uv.$wrap((5))]+this._rotMatrix.m[__uv.$wrap((6))]*this._parent._rotationMatrix[__uv.$wrap((8))],this._particle._rotationMatrix[__uv.$wrap((6))]=this._rotMatrix.m[__uv.$wrap((8))]*this._parent._rotationMatrix[__uv.$wrap((0))]+this._rotMatrix.m[__uv.$wrap((9))]*this._parent._rotationMatrix[__uv.$wrap((3))]+this._rotMatrix.m[__uv.$wrap((10))]*this._parent._rotationMatrix[__uv.$wrap((6))],this._particle._rotationMatrix[__uv.$wrap((7))]=this._rotMatrix.m[__uv.$wrap((8))]*this._parent._rotationMatrix[__uv.$wrap((1))]+this._rotMatrix.m[__uv.$wrap((9))]*this._parent._rotationMatrix[__uv.$wrap((4))]+this._rotMatrix.m[__uv.$wrap((10))]*this._parent._rotationMatrix[__uv.$wrap((7))],this._particle._rotationMatrix[__uv.$wrap((8))]=this._rotMatrix.m[__uv.$wrap((8))]*this._parent._rotationMatrix[__uv.$wrap((2))]+this._rotMatrix.m[__uv.$wrap((9))]*this._parent._rotationMatrix[__uv.$wrap((5))]+this._rotMatrix.m[__uv.$wrap((10))]*this._parent._rotationMatrix[__uv.$wrap((8))])):(this._particle._globalPosition.x=this._particle.position.x,this._particle._globalPosition.y=this._particle.position.y,this._particle._globalPosition.z=this._particle.position.z,(this._computeParticleRotation||this.billboard)&&(this._particle._rotationMatrix[__uv.$wrap((0))]=this._rotMatrix.m[__uv.$wrap((0))],this._particle._rotationMatrix[__uv.$wrap((1))]=this._rotMatrix.m[__uv.$wrap((1))],this._particle._rotationMatrix[__uv.$wrap((2))]=this._rotMatrix.m[__uv.$wrap((2))],this._particle._rotationMatrix[__uv.$wrap((3))]=this._rotMatrix.m[__uv.$wrap((4))],this._particle._rotationMatrix[__uv.$wrap((4))]=this._rotMatrix.m[__uv.$wrap((5))],this._particle._rotationMatrix[__uv.$wrap((5))]=this._rotMatrix.m[__uv.$wrap((6))],this._particle._rotationMatrix[__uv.$wrap((6))]=this._rotMatrix.m[__uv.$wrap((8))],this._particle._rotationMatrix[__uv.$wrap((7))]=this._rotMatrix.m[__uv.$wrap((9))],this._particle._rotationMatrix[__uv.$wrap((8))]=this._rotMatrix.m[__uv.$wrap((10))])),this._particle.translateFromPivot?(this._pivotBackTranslation.x=0,this._pivotBackTranslation.y=0,this._pivotBackTranslation.z=0):(this._pivotBackTranslation.x=this._scaledPivot.x,this._pivotBackTranslation.y=this._scaledPivot.y,this._pivotBackTranslation.z=this._scaledPivot.z),h=0;h<this._shape.length;h++)a=o+3*h,s=l+4*h,c=u+2*h,this._vertex.x=this._shape[__uv.$wrap((h))].x,this._vertex.y=this._shape[__uv.$wrap((h))].y,this._vertex.z=this._shape[__uv.$wrap((h))].z,this._computeParticleVertex&&this.updateParticleVertex(this._particle,this._vertex,h),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._vertex.x-=this._scaledPivot.x,this._vertex.y-=this._scaledPivot.y,this._vertex.z-=this._scaledPivot.z,this._rotated.x=this._vertex.x*this._particle._rotationMatrix[__uv.$wrap((0))]+this._vertex.y*this._particle._rotationMatrix[__uv.$wrap((3))]+this._vertex.z*this._particle._rotationMatrix[__uv.$wrap((6))],this._rotated.y=this._vertex.x*this._particle._rotationMatrix[__uv.$wrap((1))]+this._vertex.y*this._particle._rotationMatrix[__uv.$wrap((4))]+this._vertex.z*this._particle._rotationMatrix[__uv.$wrap((7))],this._rotated.z=this._vertex.x*this._particle._rotationMatrix[__uv.$wrap((2))]+this._vertex.y*this._particle._rotationMatrix[__uv.$wrap((5))]+this._vertex.z*this._particle._rotationMatrix[__uv.$wrap((8))],this._rotated.x+=this._pivotBackTranslation.x,this._rotated.y+=this._pivotBackTranslation.y,this._rotated.z+=this._pivotBackTranslation.z,this._positions32[__uv.$wrap((a))]=this._particle._globalPosition.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[__uv.$wrap((a+1))]=this._particle._globalPosition.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[__uv.$wrap((a+2))]=this._particle._globalPosition.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[__uv.$wrap((a))]<this._minimum.x&&(this._minimum.x=this._positions32[__uv.$wrap((a))]),this._positions32[__uv.$wrap((a))]>this._maximum.x&&(this._maximum.x=this._positions32[__uv.$wrap((a))]),this._positions32[__uv.$wrap((a+1))]<this._minimum.y&&(this._minimum.y=this._positions32[__uv.$wrap((a+1))]),this._positions32[__uv.$wrap((a+1))]>this._maximum.y&&(this._maximum.y=this._positions32[__uv.$wrap((a+1))]),this._positions32[__uv.$wrap((a+2))]<this._minimum.z&&(this._minimum.z=this._positions32[__uv.$wrap((a+2))]),this._positions32[__uv.$wrap((a+2))]>this._maximum.z&&(this._maximum.z=this._positions32[__uv.$wrap((a+2))])),this._computeParticleVertex||(this._normal.x=this._fixedNormal32[__uv.$wrap((a))],this._normal.y=this._fixedNormal32[__uv.$wrap((a+1))],this._normal.z=this._fixedNormal32[__uv.$wrap((a+2))],this._rotated.x=this._normal.x*this._particle._rotationMatrix[__uv.$wrap((0))]+this._normal.y*this._particle._rotationMatrix[__uv.$wrap((3))]+this._normal.z*this._particle._rotationMatrix[__uv.$wrap((6))],this._rotated.y=this._normal.x*this._particle._rotationMatrix[__uv.$wrap((1))]+this._normal.y*this._particle._rotationMatrix[__uv.$wrap((4))]+this._normal.z*this._particle._rotationMatrix[__uv.$wrap((7))],this._rotated.z=this._normal.x*this._particle._rotationMatrix[__uv.$wrap((2))]+this._normal.y*this._particle._rotationMatrix[__uv.$wrap((5))]+this._normal.z*this._particle._rotationMatrix[__uv.$wrap((8))],this._normals32[__uv.$wrap((a))]=this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[__uv.$wrap((a+1))]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[__uv.$wrap((a+2))]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&this._particle.color&&(this._colors32[__uv.$wrap((s))]=this._particle.color.r,this._colors32[__uv.$wrap((s+1))]=this._particle.color.g,this._colors32[__uv.$wrap((s+2))]=this._particle.color.b,this._colors32[__uv.$wrap((s+3))]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[__uv.$wrap((c))]=this._shapeUV[__uv.$wrap((2*h))]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[__uv.$wrap((c+1))]=this._shapeUV[__uv.$wrap((2*h+1))]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);else for(this._particle._stillInvisible=!0,h=0;h<this._shape.length;h++)a=o+3*h,s=l+4*h,c=u+2*h,this._positions32[__uv.$wrap((a))]=0,this._positions32[__uv.$wrap((a+1))]=0,this._positions32[__uv.$wrap((a+2))]=0,this._normals32[__uv.$wrap((a))]=0,this._normals32[__uv.$wrap((a+1))]=0,this._normals32[__uv.$wrap((a+2))]=0,this._computeParticleColor&&this._particle.color&&(this._colors32[__uv.$wrap((s))]=this._particle.color.r,this._colors32[__uv.$wrap((s+1))]=this._particle.color.g,this._colors32[__uv.$wrap((s+2))]=this._particle.color.b,this._colors32[__uv.$wrap((s+3))]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[__uv.$wrap((c))]=this._shapeUV[__uv.$wrap((2*h))]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[__uv.$wrap((c+1))]=this._shapeUV[__uv.$wrap((2*h+1))]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);if(this._particlesIntersect){var _=this._particle._boundingInfo,f=_.boundingBox,g=_.boundingSphere;if(!this._bSphereOnly){for(var y=0;y<f.vectors.length;y++)this._vertex.x=this._particle._modelBoundingInfo.boundingBox.vectors[__uv.$wrap((y))].x*this._particle.scaling.x,this._vertex.y=this._particle._modelBoundingInfo.boundingBox.vectors[__uv.$wrap((y))].y*this._particle.scaling.y,this._vertex.z=this._particle._modelBoundingInfo.boundingBox.vectors[__uv.$wrap((y))].z*this._particle.scaling.z,this._rotated.x=this._vertex.x*this._particle._rotationMatrix[__uv.$wrap((0))]+this._vertex.y*this._particle._rotationMatrix[__uv.$wrap((3))]+this._vertex.z*this._particle._rotationMatrix[__uv.$wrap((6))],this._rotated.y=this._vertex.x*this._particle._rotationMatrix[__uv.$wrap((1))]+this._vertex.y*this._particle._rotationMatrix[__uv.$wrap((4))]+this._vertex.z*this._particle._rotationMatrix[__uv.$wrap((7))],this._rotated.z=this._vertex.x*this._particle._rotationMatrix[__uv.$wrap((2))]+this._vertex.y*this._particle._rotationMatrix[__uv.$wrap((5))]+this._vertex.z*this._particle._rotationMatrix[__uv.$wrap((8))],f.vectors[__uv.$wrap((y))].x=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,f.vectors[__uv.$wrap((y))].y=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,f.vectors[__uv.$wrap((y))].z=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z;f._update(this.mesh._worldMatrix)}this._minBbox.x=this._particle._modelBoundingInfo.minimum.x*this._particle.scaling.x,this._minBbox.y=this._particle._modelBoundingInfo.minimum.y*this._particle.scaling.y,this._minBbox.z=this._particle._modelBoundingInfo.minimum.z*this._particle.scaling.z,this._maxBbox.x=this._particle._modelBoundingInfo.maximum.x*this._particle.scaling.x,this._maxBbox.y=this._particle._modelBoundingInfo.maximum.y*this._particle.scaling.y,this._maxBbox.z=this._particle._modelBoundingInfo.maximum.z*this._particle.scaling.z,g.center.x=this._particle._globalPosition.x+.5*(this._minBbox.x+this._maxBbox.x),g.center.y=this._particle._globalPosition.y+.5*(this._minBbox.y+this._maxBbox.y),g.center.z=this._particle._globalPosition.z+.5*(this._minBbox.z+this._maxBbox.z),g.radius=.5*this._bSphereRadiusFactor*Math.sqrt((this._maxBbox.x-this._minBbox.x)*(this._maxBbox.x-this._minBbox.x)+(this._maxBbox.y-this._minBbox.y)*(this._maxBbox.y-this._minBbox.y)+(this._maxBbox.z-this._minBbox.z)*(this._maxBbox.z-this._minBbox.z)),g._update(this.mesh._worldMatrix)}o=a+3,l=s+4,u=c+2}}if(r){if(this._computeParticleColor&&this.mesh.updateVerticesData(e.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(e.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(e.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen||this.mesh.isFacetDataEnabled){if(this._computeParticleVertex||this.mesh.isFacetDataEnabled){var v=this.mesh.isFacetDataEnabled?this.mesh.getFacetDataParameters():null;e.VertexData.ComputeNormals(this._positions32,this._indices32,this._normals32,v);for(var b=0;b<this._normals32.length;b++)this._fixedNormal32[__uv.$wrap((b))]=this._normals32[__uv.$wrap((b))]}this.mesh.areNormalsFrozen||this.mesh.updateVerticesData(e.VertexBuffer.NormalKind,this._normals32,!1,!1)}if(this._depthSort&&this._depthSortParticles){this.depthSortedParticles.sort(this._depthSortFunction);var x=this.depthSortedParticles.length,S=0,T=0,E=0,P=0;for(S=0;S<x;S++){T=this.depthSortedParticles[__uv.$wrap((S))].indicesLength,E=this.depthSortedParticles[__uv.$wrap((S))].ind;for(b=0;b<T;b++)this._indices32[__uv.$wrap((P))]=this._indices[__uv.$wrap((E+b))],P++}this.mesh.updateIndices(this._indices32)}}return this._computeBoundingBox&&(this.mesh._boundingInfo=new e.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix)),this.afterUpdateParticles(t,i,r),this},t.prototype._quaternionRotationYPR=function(){this._halfroll=.5*this._roll,this._halfpitch=.5*this._pitch,this._halfyaw=.5*this._yaw,this._sinRoll=Math.sin(this._halfroll),this._cosRoll=Math.cos(this._halfroll),this._sinPitch=Math.sin(this._halfpitch),this._cosPitch=Math.cos(this._halfpitch),this._sinYaw=Math.sin(this._halfyaw),this._cosYaw=Math.cos(this._halfyaw),this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll,this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll,this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll,this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll},t.prototype._quaternionToRotationMatrix=function(){this._rotMatrix.m[__uv.$wrap((0))]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z),this._rotMatrix.m[__uv.$wrap((1))]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w),this._rotMatrix.m[__uv.$wrap((2))]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w),this._rotMatrix.m[__uv.$wrap((3))]=0,this._rotMatrix.m[__uv.$wrap((4))]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w),this._rotMatrix.m[__uv.$wrap((5))]=1-2*(this._quaternion.z*this._quaternion.z+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[__uv.$wrap((6))]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w),this._rotMatrix.m[__uv.$wrap((7))]=0,this._rotMatrix.m[__uv.$wrap((8))]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w),this._rotMatrix.m[__uv.$wrap((9))]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w),this._rotMatrix.m[__uv.$wrap((10))]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[__uv.$wrap((11))]=0,this._rotMatrix.m[__uv.$wrap((12))]=0,this._rotMatrix.m[__uv.$wrap((13))]=0,this._rotMatrix.m[__uv.$wrap((14))]=0,this._rotMatrix.m[__uv.$wrap((15))]=1},t.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},t.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},t.prototype.setVisibilityBox=function(t){var i=t/2;this.mesh._boundingInfo=new e.BoundingInfo(new e.Vector3(-i,-i,-i),new e.Vector3(i,i,i))},Object.defineProperty(t.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(e){this._isVisibilityBoxLocked=e,this.mesh.getBoundingInfo().isLocked=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(e){this._computeParticleRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(e){this._computeParticleColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(e){this._computeParticleTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(e){this._computeParticleVertex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(e){this._computeBoundingBox=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(e){this._depthSortParticles=e},enumerable:!0,configurable:!0}),t.prototype.initParticles=function(){},t.prototype.recycleParticle=function(e){return e},t.prototype.updateParticle=function(e){return e},t.prototype.updateParticleVertex=function(e,t,i){return t},t.prototype.beforeUpdateParticles=function(e,t,i){},t.prototype.afterUpdateParticles=function(e,t,i){},t}();e.SolidParticleSystem=t}(s||(s={})),function(e){var t=function(){function t(){}return t.updateSideOrientation=function(t){return t==e.Mesh.DOUBLESIDE?e.Mesh.DOUBLESIDE:null==t?e.Mesh.FRONTSIDE:t},t.CreateBox=function(i,r,n){void 0===n&&(n=null);var a=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateBox(r).applyToMesh(a,r.updatable),a},t.CreateSphere=function(i,r,n){var a=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateSphere(r).applyToMesh(a,r.updatable),a},t.CreateDisc=function(i,r,n){void 0===n&&(n=null);var a=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateDisc(r).applyToMesh(a,r.updatable),a},t.CreateIcoSphere=function(i,r,n){var a=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateIcoSphere(r).applyToMesh(a,r.updatable),a},t.CreateRibbon=function(i,r,n){void 0===n&&(n=null);var a=r.pathArray,o=r.closeArray,s=r.closePath,l=t.updateSideOrientation(r.sideOrientation),c=r.instance,u=r.updatable;if(c){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,e.Tmp.Vector3[__uv.$wrap((0))]),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,e.Tmp.Vector3[__uv.$wrap((1))]);var h=c.getVerticesData(e.VertexBuffer.PositionKind);if(function(t){for(var i=a[__uv.$wrap((0))].length,r=c,n=0,o=r._originalBuilderSideOrientation===e.Mesh.DOUBLESIDE?2:1,s=1;s<=o;s++)for(var l=0;l<a.length;l++){var u=a[__uv.$wrap((l))],h=u.length;i=i<h?i:h;for(var d=0;d<i;)t[__uv.$wrap((n))]=u[__uv.$wrap((d))].x,t[__uv.$wrap((n+1))]=u[__uv.$wrap((d))].y,t[__uv.$wrap((n+2))]=u[__uv.$wrap((d))].z,u[__uv.$wrap((d))].x<e.Tmp.Vector3[__uv.$wrap((0))].x&&(e.Tmp.Vector3[__uv.$wrap((0))].x=u[__uv.$wrap((d))].x),u[__uv.$wrap((d))].x>e.Tmp.Vector3[__uv.$wrap((1))].x&&(e.Tmp.Vector3[__uv.$wrap((1))].x=u[__uv.$wrap((d))].x),u[__uv.$wrap((d))].y<e.Tmp.Vector3[__uv.$wrap((0))].y&&(e.Tmp.Vector3[__uv.$wrap((0))].y=u[__uv.$wrap((d))].y),u[__uv.$wrap((d))].y>e.Tmp.Vector3[__uv.$wrap((1))].y&&(e.Tmp.Vector3[__uv.$wrap((1))].y=u[__uv.$wrap((d))].y),u[__uv.$wrap((d))].z<e.Tmp.Vector3[__uv.$wrap((0))].z&&(e.Tmp.Vector3[__uv.$wrap((0))].z=u[__uv.$wrap((d))].z),u[__uv.$wrap((d))].z>e.Tmp.Vector3[__uv.$wrap((1))].z&&(e.Tmp.Vector3[__uv.$wrap((1))].z=u[__uv.$wrap((d))].z),d++,n+=3;r._creationDataStorage&&r._creationDataStorage.closePath&&(t[__uv.$wrap((n))]=u[__uv.$wrap((0))].x,t[__uv.$wrap((n+1))]=u[__uv.$wrap((0))].y,t[__uv.$wrap((n+2))]=u[__uv.$wrap((0))].z,n+=3)}}(h),c._boundingInfo=new e.BoundingInfo(e.Tmp.Vector3[__uv.$wrap((2))],e.Tmp.Vector3[__uv.$wrap((3))]),c._boundingInfo.update(c._worldMatrix),c.updateVerticesData(e.VertexBuffer.PositionKind,h,!1,!1),r.colors){for(var d=c.getVerticesData(e.VertexBuffer.ColorKind),p=0;p<r.colors.length;p++)d[__uv.$wrap((4*p))]=r.colors[__uv.$wrap((p))].r,d[__uv.$wrap((4*p+1))]=r.colors[__uv.$wrap((p))].g,d[__uv.$wrap((4*p+2))]=r.colors[__uv.$wrap((p))].b,d[__uv.$wrap((4*p+3))]=r.colors[__uv.$wrap((p))].a;c.updateVerticesData(e.VertexBuffer.ColorKind,d,!1,!1)}if(r.uvs){for(var m=c.getVerticesData(e.VertexBuffer.UVKind),_=0;_<r.uvs.length;_++)m[__uv.$wrap((2*_))]=r.uvs[__uv.$wrap((_))].x,m[__uv.$wrap((2*_+1))]=r.uvs[__uv.$wrap((_))].y;c.updateVerticesData(e.VertexBuffer.UVKind,m,!1,!1)}if(!c.areNormalsFrozen||c.isFacetDataEnabled){var f=c.getIndices(),g=c.getVerticesData(e.VertexBuffer.NormalKind),y=c.isFacetDataEnabled?c.getFacetDataParameters():null;if(e.VertexData.ComputeNormals(h,f,g,y),c._creationDataStorage&&c._creationDataStorage.closePath)for(var v=0,b=0,x=0;x<a.length;x++)v=3*c._creationDataStorage.idx[__uv.$wrap((x))],b=x+1<a.length?3*(c._creationDataStorage.idx[__uv.$wrap((x+1))]-1):g.length-3,g[__uv.$wrap((v))]=.5*(g[__uv.$wrap((v))]+g[__uv.$wrap((b))]),g[__uv.$wrap((v+1))]=.5*(g[__uv.$wrap((v+1))]+g[__uv.$wrap((b+1))]),g[__uv.$wrap((v+2))]=.5*(g[__uv.$wrap((v+2))]+g[__uv.$wrap((b+2))]),g[__uv.$wrap((b))]=g[__uv.$wrap((v))],g[__uv.$wrap((b+1))]=g[__uv.$wrap((v+1))],g[__uv.$wrap((b+2))]=g[__uv.$wrap((v+2))];c.areNormalsFrozen||c.updateVerticesData(e.VertexBuffer.NormalKind,g,!1,!1)}return c}var S=new e.Mesh(i,n);S._originalBuilderSideOrientation=l,S._creationDataStorage=new e._CreationDataStorage;var T=e.VertexData.CreateRibbon(r);return s&&(S._creationDataStorage.idx=T._idx),S._creationDataStorage.closePath=s,S._creationDataStorage.closeArray=o,T.applyToMesh(S,u),S},t.CreateCylinder=function(i,r,n){var a=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateCylinder(r).applyToMesh(a,r.updatable),a},t.CreateTorus=function(i,r,n){var a=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateTorus(r).applyToMesh(a,r.updatable),a},t.CreateTorusKnot=function(i,r,n){var a=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateTorusKnot(r).applyToMesh(a,r.updatable),a},t.CreateLineSystem=function(t,i,r){var n=i.instance,a=i.lines,o=i.colors;if(n){var s,l,c=n.getVerticesData(e.VertexBuffer.PositionKind);o&&(s=n.getVerticesData(e.VertexBuffer.ColorKind));for(var u=0,h=0,d=0;d<a.length;d++)for(var p=a[__uv.$wrap((d))],m=0;m<p.length;m++)c[__uv.$wrap((u))]=p[__uv.$wrap((m))].x,c[__uv.$wrap((u+1))]=p[__uv.$wrap((m))].y,c[__uv.$wrap((u+2))]=p[__uv.$wrap((m))].z,o&&s&&(l=o[__uv.$wrap((d))],s[__uv.$wrap((h))]=l[__uv.$wrap((m))].r,s[__uv.$wrap((h+1))]=l[__uv.$wrap((m))].g,s[__uv.$wrap((h+2))]=l[__uv.$wrap((m))].b,s[__uv.$wrap((h+3))]=l[__uv.$wrap((m))].a,h+=4),u+=3;return n.updateVerticesData(e.VertexBuffer.PositionKind,c,!1,!1),o&&s&&n.updateVerticesData(e.VertexBuffer.ColorKind,s,!1,!1),n}var _=!!o,f=new e.LinesMesh(t,r,null,void 0,void 0,_,i.useVertexAlpha);return e.VertexData.CreateLineSystem(i).applyToMesh(f,i.updatable),f},t.CreateLines=function(e,i,r){void 0===r&&(r=null);var n=i.colors?[i.colors]:null;return t.CreateLineSystem(e,{lines:[i.points],updatable:i.updatable,instance:i.instance,colors:n,useVertexAlpha:i.useVertexAlpha},r)},t.CreateDashedLines=function(t,i,r){void 0===r&&(r=null);var n=i.points,a=i.instance,o=i.gapSize||1,s=i.dashSize||3;if(a){return a.updateMeshPositions((function(t){var i,r,o=e.Vector3.Zero(),s=t.length/6,l=0,c=0,u=0,h=0,d=0,p=0;for(d=0;d<n.length-1;d++)n[__uv.$wrap((d+1))].subtractToRef(n[__uv.$wrap((d))],o),l+=o.length();i=l/s;var m=a._creationDataStorage.dashSize;for(r=m*i/(m+a._creationDataStorage.gapSize),d=0;d<n.length-1;d++)for(n[__uv.$wrap((d+1))].subtractToRef(n[__uv.$wrap((d))],o),c=Math.floor(o.length()/i),o.normalize(),p=0;p<c&&h<t.length;)u=i*p,t[__uv.$wrap((h))]=n[__uv.$wrap((d))].x+u*o.x,t[__uv.$wrap((h+1))]=n[__uv.$wrap((d))].y+u*o.y,t[__uv.$wrap((h+2))]=n[__uv.$wrap((d))].z+u*o.z,t[__uv.$wrap((h+3))]=n[__uv.$wrap((d))].x+(u+r)*o.x,t[__uv.$wrap((h+4))]=n[__uv.$wrap((d))].y+(u+r)*o.y,t[__uv.$wrap((h+5))]=n[__uv.$wrap((d))].z+(u+r)*o.z,h+=6,p++;for(;h<t.length;)t[__uv.$wrap((h))]=n[__uv.$wrap((d))].x,t[__uv.$wrap((h+1))]=n[__uv.$wrap((d))].y,t[__uv.$wrap((h+2))]=n[__uv.$wrap((d))].z,h+=3}),!1),a}var l=new e.LinesMesh(t,r);return e.VertexData.CreateDashedLines(i).applyToMesh(l,i.updatable),l._creationDataStorage=new e._CreationDataStorage,l._creationDataStorage.dashSize=s,l._creationDataStorage.gapSize=o,l},t.ExtrudeShape=function(i,r,n){void 0===n&&(n=null);var a=r.path,o=r.shape,s=r.scale||1,l=r.rotation||0,c=0===r.cap?0:r.cap||e.Mesh.NO_CAP,u=r.updatable,h=t.updateSideOrientation(r.sideOrientation),d=r.instance||null,p=r.invertUV||!1;return t._ExtrudeShapeGeneric(i,o,a,s,l,null,null,!1,!1,c,!1,n,!!u,h,d,p,r.frontUVs||null,r.backUVs||null)},t.ExtrudeShapeCustom=function(i,r,n){var a=r.path,o=r.shape,s=r.scaleFunction||function(){return 1},l=r.rotationFunction||function(){return 0},c=r.ribbonCloseArray||!1,u=r.ribbonClosePath||!1,h=0===r.cap?0:r.cap||e.Mesh.NO_CAP,d=r.updatable,p=t.updateSideOrientation(r.sideOrientation),m=r.instance,_=r.invertUV||!1;return t._ExtrudeShapeGeneric(i,o,a,null,null,s,l,c,u,h,!0,n,!!d,p,m||null,_,r.frontUVs||null,r.backUVs||null)},t.CreateLathe=function(i,r,n){var a,o=r.arc?r.arc<=0||r.arc>1?1:r.arc:1,s=void 0===r.closed||r.closed,l=r.shape,c=r.radius||1,u=r.tessellation||64,h=r.clip||0,d=r.updatable,p=t.updateSideOrientation(r.sideOrientation),m=r.cap||e.Mesh.NO_CAP,_=2*Math.PI,f=new Array,g=r.invertUV||!1,y=0,v=0,b=_/u*o,x=new Array;for(y=0;y<=u-h;y++){x=[];for(m!=e.Mesh.CAP_START&&m!=e.Mesh.CAP_ALL||(x.push(new e.Vector3(0,l[__uv.$wrap((0))].y,0)),x.push(new e.Vector3(Math.cos(y*b)*l[__uv.$wrap((0))].x*c,l[__uv.$wrap((0))].y,Math.sin(y*b)*l[__uv.$wrap((0))].x*c))),v=0;v<l.length;v++)a=new e.Vector3(Math.cos(y*b)*l[__uv.$wrap((v))].x*c,l[__uv.$wrap((v))].y,Math.sin(y*b)*l[__uv.$wrap((v))].x*c),x.push(a);m!=e.Mesh.CAP_END&&m!=e.Mesh.CAP_ALL||(x.push(new e.Vector3(Math.cos(y*b)*l[__uv.$wrap((l.length-1))].x*c,l[__uv.$wrap((l.length-1))].y,Math.sin(y*b)*l[__uv.$wrap((l.length-1))].x*c)),x.push(new e.Vector3(0,l[__uv.$wrap((l.length-1))].y,0))),f.push(x)}return t.CreateRibbon(i,{pathArray:f,closeArray:s,sideOrientation:p,updatable:d,invertUV:g,frontUVs:r.frontUVs,backUVs:r.backUVs},n)},t.CreatePlane=function(i,r,n){var a=new e.Mesh(i,n);if(r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreatePlane(r).applyToMesh(a,r.updatable),r.sourcePlane){a.translate(r.sourcePlane.normal,r.sourcePlane.d);var o=Math.acos(e.Vector3.Dot(r.sourcePlane.normal,e.Axis.Z)),s=e.Vector3.Cross(e.Axis.Z,r.sourcePlane.normal);s.lengthSquared()>e.Epsilon&&a.rotate(s,o)}return a},t.CreateGround=function(t,i,r){var n=new e.GroundMesh(t,r);return n._setReady(!1),n._subdivisionsX=i.subdivisionsX||i.subdivisions||1,n._subdivisionsY=i.subdivisionsY||i.subdivisions||1,n._width=i.width||1,n._height=i.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,e.VertexData.CreateGround(i).applyToMesh(n,i.updatable),n._setReady(!0),n},t.CreateTiledGround=function(t,i,r){var n=new e.Mesh(t,r);return e.VertexData.CreateTiledGround(i).applyToMesh(n,i.updatable),n},t.CreateGroundFromHeightMap=function(t,i,r,n){var a=r.width||10,o=r.height||10,s=r.subdivisions||1,l=r.minHeight||0,c=r.maxHeight||1,u=r.colorFilter||new e.Color3(.3,.59,.11),h=r.alphaFilter||0,d=r.updatable,p=r.onReady,m=new e.GroundMesh(t,n);m._subdivisionsX=s,m._subdivisionsY=s,m._width=a,m._height=o,m._maxX=m._width/2,m._maxZ=m._height/2,m._minX=-m._maxX,m._minZ=-m._maxZ,m._setReady(!1);return e.Tools.LoadImage(i,(function(t){var i=document.createElement("canvas"),r=i.getContext("2d");if(!r)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!n.isDisposed){var _=t.width,f=t.height;i.width=_,i.height=f,r.drawImage(t,0,0);var g=r.getImageData(0,0,_,f).data;e.VertexData.CreateGroundFromHeightMap({width:a,height:o,subdivisions:s,minHeight:l,maxHeight:c,colorFilter:u,buffer:g,bufferWidth:_,bufferHeight:f,alphaFilter:h}).applyToMesh(m,d),p&&p(m),m._setReady(!0)}}),(function(){}),n.database),m},t.CreatePolygon=function(i,r,n){r.sideOrientation=t.updateSideOrientation(r.sideOrientation);for(var a=r.shape,o=r.holes||[],s=r.depth||0,l=[],c=[],u=0;u<a.length;u++)l[__uv.$wrap((u))]=new e.Vector2(a[__uv.$wrap((u))].x,a[__uv.$wrap((u))].z);l[__uv.$wrap((0))].equalsWithEpsilon(l[__uv.$wrap((l.length-1))],1e-8)&&l.pop();for(var h=new e.PolygonMeshBuilder(i,l,n),d=0;d<o.length;d++){c=[];for(var p=0;p<o[__uv.$wrap((d))].length;p++)c.push(new e.Vector2(o[__uv.$wrap((d))][__uv.$wrap((p))].x,o[__uv.$wrap((d))][__uv.$wrap((p))].z));h.addHole(c)}var m=h.build(r.updatable,s);return m._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreatePolygon(m,r.sideOrientation,r.faceUV,r.faceColors,r.frontUVs,r.backUVs).applyToMesh(m,r.updatable),m},t.ExtrudePolygon=function(e,i,r){return t.CreatePolygon(e,i,r)},t.CreateTube=function(i,r,n){var a=r.path,o=r.instance,s=1;void 0!==r.radius?s=r.radius:o&&(s=o._creationDataStorage.radius);var l=r.tessellation||64,c=r.radiusFunction||null,u=r.cap||e.Mesh.NO_CAP,h=r.invertUV||!1,d=r.updatable,p=t.updateSideOrientation(r.sideOrientation);r.arc=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1;var m,_,f=function(t,i,r,n,a,o,s,l){for(var c,u,h,d,p=i.getTangents(),m=i.getNormals(),_=i.getDistances(),f=2*Math.PI/a*l,g=o||function(){return n},y=e.Tmp.Matrix[__uv.$wrap((0))],v=s===e.Mesh.NO_CAP||s===e.Mesh.CAP_END?0:2,b=0;b<t.length;b++){u=g(b,_[__uv.$wrap((b))]),c=Array(),h=m[__uv.$wrap((b))];for(var x=0;x<a;x++)e.Matrix.RotationAxisToRef(p[__uv.$wrap((b))],f*x,y),d=c[__uv.$wrap((x))]?c[__uv.$wrap((x))]:e.Vector3.Zero(),e.Vector3.TransformCoordinatesToRef(h,y,d),d.scaleInPlace(u).addInPlace(t[__uv.$wrap((b))]),c[__uv.$wrap((x))]=d;r[__uv.$wrap((v))]=c,v++}var S=function(e,i){for(var r=Array(),n=0;n<e;n++)r.push(t[__uv.$wrap((i))]);return r};switch(s){case e.Mesh.NO_CAP:break;case e.Mesh.CAP_START:r[__uv.$wrap((0))]=S(a,0),r[__uv.$wrap((1))]=r[__uv.$wrap((2))].slice(0);break;case e.Mesh.CAP_END:r[__uv.$wrap((v))]=r[__uv.$wrap((v-1))].slice(0),r[__uv.$wrap((v+1))]=S(a,t.length-1);break;case e.Mesh.CAP_ALL:r[__uv.$wrap((0))]=S(a,0),r[__uv.$wrap((1))]=r[__uv.$wrap((2))].slice(0),r[__uv.$wrap((v))]=r[__uv.$wrap((v-1))].slice(0),r[__uv.$wrap((v+1))]=S(a,t.length-1)}return r};if(o){var g=o._creationDataStorage,y=r.arc||g.arc;return _=f(a,m=g.path3D.update(a),g.pathArray,s,g.tessellation,c,g.cap,y),o=t.CreateRibbon("",{pathArray:_,instance:o}),g.path3D=m,g.pathArray=_,g.arc=y,g.radius=s,o}_=f(a,m=new e.Path3D(a),new Array,s,l,c,u=u<0||u>3?0:u,r.arc);var v=t.CreateRibbon(i,{pathArray:_,closePath:!0,closeArray:!1,updatable:d,sideOrientation:p,invertUV:h,frontUVs:r.frontUVs,backUVs:r.backUVs},n);return v._creationDataStorage.pathArray=_,v._creationDataStorage.path3D=m,v._creationDataStorage.tessellation=l,v._creationDataStorage.cap=u,v._creationDataStorage.arc=r.arc,v._creationDataStorage.radius=s,v},t.CreatePolyhedron=function(i,r,n){var a=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),a._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreatePolyhedron(r).applyToMesh(a,r.updatable),a},t.CreateDecal=function(t,i,r){var n=i.getIndices(),a=i.getVerticesData(e.VertexBuffer.PositionKind),o=i.getVerticesData(e.VertexBuffer.NormalKind),s=r.position||e.Vector3.Zero(),l=r.normal||e.Vector3.Up(),c=r.size||e.Vector3.One(),u=r.angle||0;if(!l){var h=new e.Vector3(0,0,1),d=i.getScene().activeCamera,p=e.Vector3.TransformCoordinates(h,d.getWorldMatrix());l=d.globalPosition.subtract(p)}var m=-Math.atan2(l.z,l.x)-Math.PI/2,_=Math.sqrt(l.x*l.x+l.z*l.z),f=Math.atan2(l.y,_),g=e.Matrix.RotationYawPitchRoll(m,f,u).multiply(e.Matrix.Translation(s.x,s.y,s.z)),y=e.Matrix.Invert(g),v=i.getWorldMatrix().multiply(y),b=new e.VertexData;b.indices=[],b.positions=[],b.normals=[],b.uvs=[];for(var x=0,S=function(t){var i=new e.PositionNormalVertex;if(!n||!a||!o)return i;var r=n[__uv.$wrap((t))];return i.position=new e.Vector3(a[__uv.$wrap((3*r))],a[__uv.$wrap((3*r+1))],a[__uv.$wrap((3*r+2))]),i.position=e.Vector3.TransformCoordinates(i.position,v),i.normal=new e.Vector3(o[__uv.$wrap((3*r))],o[__uv.$wrap((3*r+1))],o[__uv.$wrap((3*r+2))]),i.normal=e.Vector3.TransformNormal(i.normal,v),i},T=function(t,i){if(0===t.length)return t;for(var r=.5*Math.abs(e.Vector3.Dot(c,i)),n=function(t,n){var a=e.Vector3.GetClipFactor(t.position,n.position,i,r);return new e.PositionNormalVertex(e.Vector3.Lerp(t.position,n.position,a),e.Vector3.Lerp(t.normal,n.normal,a))},a=new Array,o=0;o<t.length;o+=3){var s,l,u,h=null,d=null,p=null,m=null;switch(((s=e.Vector3.Dot(t[__uv.$wrap((o))].position,i)-r>0)?1:0)+((l=e.Vector3.Dot(t[__uv.$wrap((o+1))].position,i)-r>0)?1:0)+((u=e.Vector3.Dot(t[__uv.$wrap((o+2))].position,i)-r>0)?1:0)){case 0:a.push(t[__uv.$wrap((o))]),a.push(t[__uv.$wrap((o+1))]),a.push(t[__uv.$wrap((o+2))]);break;case 1:if(s&&(h=t[__uv.$wrap((o+1))],d=t[__uv.$wrap((o+2))],p=n(t[__uv.$wrap((o))],h),m=n(t[__uv.$wrap((o))],d)),l){h=t[__uv.$wrap((o))],d=t[__uv.$wrap((o+2))],p=n(t[__uv.$wrap((o+1))],h),m=n(t[__uv.$wrap((o+1))],d),a.push(p),a.push(d.clone()),a.push(h.clone()),a.push(d.clone()),a.push(p.clone()),a.push(m);break}u&&(h=t[__uv.$wrap((o))],d=t[__uv.$wrap((o+1))],p=n(t[__uv.$wrap((o+2))],h),m=n(t[__uv.$wrap((o+2))],d)),h&&d&&p&&m&&(a.push(h.clone()),a.push(d.clone()),a.push(p),a.push(m),a.push(p.clone()),a.push(d.clone()));break;case 2:s||(d=n(h=t[__uv.$wrap((o))].clone(),t[__uv.$wrap((o+1))]),p=n(h,t[__uv.$wrap((o+2))]),a.push(h),a.push(d),a.push(p)),l||(d=n(h=t[__uv.$wrap((o+1))].clone(),t[__uv.$wrap((o+2))]),p=n(h,t[__uv.$wrap((o))]),a.push(h),a.push(d),a.push(p)),u||(d=n(h=t[__uv.$wrap((o+2))].clone(),t[__uv.$wrap((o))]),p=n(h,t[__uv.$wrap((o+1))]),a.push(h),a.push(d),a.push(p))}}return a},E=0;E<n.length;E+=3){var P=new Array;if(P.push(S(E)),P.push(S(E+1)),P.push(S(E+2)),P=T(P,new e.Vector3(1,0,0)),P=T(P,new e.Vector3(-1,0,0)),P=T(P,new e.Vector3(0,1,0)),P=T(P,new e.Vector3(0,-1,0)),P=T(P,new e.Vector3(0,0,1)),0!==(P=T(P,new e.Vector3(0,0,-1))).length)for(var A=0;A<P.length;A++){var M=P[__uv.$wrap((A))];b.indices.push(x),M.position.toArray(b.positions,3*x),M.normal.toArray(b.normals,3*x),b.uvs.push(.5+M.position.x/c.x),b.uvs.push(.5+M.position.y/c.y),x++}}var C=new e.Mesh(t,i.getScene());return b.applyToMesh(C),C.position=s.clone(),C.rotation=new e.Vector3(f,m,u),C},t._ExtrudeShapeGeneric=function(i,r,n,a,o,s,l,c,u,h,d,p,m,_,f,g,y,v){var b,x,S=function(t,i,r,n,a,o,s,l,c,u){for(var h=r.getTangents(),d=r.getNormals(),p=r.getBinormals(),m=r.getDistances(),_=0,f=u&&l?l:function(){return null!==o?o:0},g=u&&s?s:function(){return null!==a?a:1},y=c===e.Mesh.NO_CAP||c===e.Mesh.CAP_END?0:2,v=e.Tmp.Matrix[__uv.$wrap((0))],b=0;b<i.length;b++){for(var x=new Array,S=f(b,m[__uv.$wrap((b))]),T=g(b,m[__uv.$wrap((b))]),E=0;E<t.length;E++){e.Matrix.RotationAxisToRef(h[__uv.$wrap((b))],_,v);var P=h[__uv.$wrap((b))].scale(t[__uv.$wrap((E))].z).add(d[__uv.$wrap((b))].scale(t[__uv.$wrap((E))].x)).add(p[__uv.$wrap((b))].scale(t[__uv.$wrap((E))].y)),A=x[__uv.$wrap((E))]?x[__uv.$wrap((E))]:e.Vector3.Zero();e.Vector3.TransformCoordinatesToRef(P,v,A),A.scaleInPlace(T).addInPlace(i[__uv.$wrap((b))]),x[__uv.$wrap((E))]=A}n[__uv.$wrap((y))]=x,_+=S,y++}var M=function(t){var i,r=Array(),n=e.Vector3.Zero();for(i=0;i<t.length;i++)n.addInPlace(t[__uv.$wrap((i))]);for(n.scaleInPlace(1/t.length),i=0;i<t.length;i++)r.push(n);return r};switch(c){case e.Mesh.NO_CAP:break;case e.Mesh.CAP_START:n[__uv.$wrap((0))]=M(n[__uv.$wrap((2))]),n[__uv.$wrap((1))]=n[__uv.$wrap((2))];break;case e.Mesh.CAP_END:n[__uv.$wrap((y))]=n[__uv.$wrap((y-1))],n[__uv.$wrap((y+1))]=M(n[__uv.$wrap((y-1))]);break;case e.Mesh.CAP_ALL:n[__uv.$wrap((0))]=M(n[__uv.$wrap((2))]),n[__uv.$wrap((1))]=n[__uv.$wrap((2))],n[__uv.$wrap((y))]=n[__uv.$wrap((y-1))],n[__uv.$wrap((y+1))]=M(n[__uv.$wrap((y-1))])}return n};if(f){var T=f._creationDataStorage;return b=T.path3D.update(n),x=S(r,n,T.path3D,T.pathArray,a,o,s,l,T.cap,d),f=e.Mesh.CreateRibbon("",x,!1,!1,0,p||void 0,!1,0,f)}x=S(r,n,b=new e.Path3D(n),new Array,a,o,s,l,h=h<0||h>3?0:h,d);var E=t.CreateRibbon(i,{pathArray:x,closeArray:c,closePath:u,updatable:m,sideOrientation:_,invertUV:g,frontUVs:y||void 0,backUVs:v||void 0},p);return E._creationDataStorage.pathArray=x,E._creationDataStorage.path3D=b,E._creationDataStorage.cap=h,E},t}();e.MeshBuilder=t}(s||(s={})),function(e){var t=function(){function t(){}return Object.defineProperty(t,"DecoderAvailable",{get:function(){if("undefined"!=typeof DracoDecoderModule)return!0;var e=t.Configuration.decoder;if(e){if(e.wasmUrl&&e.wasmBinaryUrl&&"object"==typeof WebAssembly)return!0;if(e.fallbackUrl)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.decodeMeshAsync=function(i,r){var n=i instanceof ArrayBuffer?new Uint8Array(i):i;return t._GetDecoderModule().then((function(t){var i=t.module,a=new e.VertexData,o=new i.DecoderBuffer;o.Init(n,n.byteLength);var s,l,c=new i.Decoder;try{var u=c.GetEncodedGeometryType(o);switch(u){case i.TRIANGULAR_MESH:s=new i.Mesh,l=c.DecodeBufferToMesh(o,s);break;case i.POINT_CLOUD:s=new i.PointCloud,l=c.DecodeBufferToPointCloud(o,s);break;default:throw new Error("Invalid geometry type "+u)}if(!l.ok()||!s.ptr)throw new Error(l.error_msg());var h=s.num_points();if(u===i.TRIANGULAR_MESH){var d=s.num_faces(),p=new i.DracoInt32Array;try{for(var m=new Uint32Array(3*d),_=0;_<d;_++){c.GetFaceFromMesh(s,_,p);var f=3*_;m[__uv.$wrap((f+0))]=p.GetValue(0),m[__uv.$wrap((f+1))]=p.GetValue(1),m[__uv.$wrap((f+2))]=p.GetValue(2)}a.indices=m}finally{i.destroy(p)}}for(var g in r){var y=r[__uv.$wrap((g))],v=c.GetAttributeByUniqueId(s,y),b=new i.DracoFloat32Array;try{c.GetAttributeFloatForAllPoints(s,v,b);var x=new Float32Array(h*v.num_components());for(_=0;_<x.length;_++)x[__uv.$wrap((_))]=b.GetValue(_);a.set(x,g)}finally{i.destroy(b)}}}finally{s&&i.destroy(s),i.destroy(c),i.destroy(o)}return a}))},t._GetDecoderModule=function(){if(!t._DecoderModulePromise){var e=null,i={};if("undefined"!=typeof DracoDecoderModule)e=Promise.resolve();else{var r=t.Configuration.decoder;r&&(r.wasmUrl&&r.wasmBinaryUrl&&"object"==typeof WebAssembly?e=Promise.all([t._LoadScriptAsync(r.wasmUrl),t._LoadFileAsync(r.wasmBinaryUrl).then((function(e){i.wasmBinary=e}))]):r.fallbackUrl&&(e=t._LoadScriptAsync(r.fallbackUrl)))}if(!e)throw new Error("Draco decoder module is not available");t._DecoderModulePromise=e.then((function(){return new Promise((function(e){i.onModuleLoaded=function(t){e({module:t})},DracoDecoderModule(i)}))}))}return t._DecoderModulePromise},t._LoadScriptAsync=function(t){return new Promise((function(i,r){e.Tools.LoadScript(t,(function(){i()}),(function(e){r(new Error(e))}))}))},t._LoadFileAsync=function(t){return new Promise((function(i,r){e.Tools.LoadFile(t,(function(e){i(e)}),void 0,void 0,!0,(function(e,t){r(t)}))}))},t.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},t}();e.DracoCompression=t}(s||(s={})),function(e){e.Engine.AudioEngineFactory=function(e){return new t(e)};var t=function(){function t(t){void 0===t&&(t=null);var i=this;this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new e.Observable,this.onAudioLockedObservable=new e.Observable,this._tryToRun=!1,this._onResize=function(){i._moveButtonToTopLeft()},void 0===window.AudioContext&&void 0===window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var r=document.createElement("audio");this._hostElement=t;try{r&&r.canPlayType&&r.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch(e){}try{r&&r.canPlayType&&r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}return Object.defineProperty(t.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype.lock=function(){this._triggerSuspendedState()},t.prototype.unlock=function(){this._triggerRunningState()},t.prototype._resumeAudioContext=function(){var e;return this._audioContext.resume&&(e=this._audioContext.resume()),e||Promise.resolve()},t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(t){this.canUseWebAudio=!1,e.Tools.Error("Web Audio: "+t.message)}},t.prototype._triggerRunningState=function(){var e=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((function(){e._tryToRun=!1,e._muteButton&&e._hideMuteButton()})).catch((function(){e._tryToRun=!1,e.unlocked=!1})),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))},t.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},t.prototype._displayMuteButton=function(){var e=this;if(!this.useCustomUnlockedButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var t=document.createElement("style");t.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E);  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")),document.getElementsByTagName("head")[__uv.$wrap((0))].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(function(){e._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(function(){e._triggerRunningState()}),!0),window.addEventListener("resize",this._onResize)}},t.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.__uv$setSource(__uv).__uv$top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},t.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a){void 0===n&&(n=null);var o=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.onEndedObservable=new e.Observable,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,this._scene=r;var s=r._getComponent(e.SceneComponentConstants.NAME_AUDIO);if(s||(s=new e.AudioSceneComponent(r),r._addComponent(s)),this._readyToPlayCallback=n,this._customAttenuationFunction=function(e,t,i,r,n){return t<i?e*(1-t/i):0},a&&(this.autoplay=a.autoplay||!1,this.loop=a.loop||!1,void 0!==a.volume&&(this._volume=a.volume),this.spatialSound=a.spatialSound||!1,this.maxDistance=a.maxDistance||100,this.useCustomAttenuation=a.useCustomAttenuation||!1,this.rolloffFactor=a.rolloffFactor||1,this.refDistance=a.refDistance||1,this.distanceModel=a.distanceModel||"linear",this._playbackRate=a.playbackRate||1,this._streaming=a.streaming||!1),e.Engine.audioEngine.canUseWebAudio&&e.Engine.audioEngine.audioContext){this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var l=!0;if(i)try{"string"==typeof i?this._urlType="String":i instanceof ArrayBuffer?this._urlType="ArrayBuffer":i instanceof MediaStream?this._urlType="MediaStream":Array.isArray(i)&&(this._urlType="Array");var c=[],u=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=e.Engine.audioEngine.audioContext.createMediaElementSource(i),this.autoplay&&this.play(),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":i.byteLength>0&&(u=!0,this._soundLoaded(i));break;case"String":c.push(i);case"Array":0===c.length&&(c=i);for(var h=0;h<c.length;h++){var d=c[__uv.$wrap((h))];if(-1!==d.indexOf(".mp3",d.length-4)&&e.Engine.audioEngine.isMP3supported&&(u=!0),-1!==d.indexOf(".ogg",d.length-4)&&e.Engine.audioEngine.isOGGsupported&&(u=!0),-1!==d.indexOf(".wav",d.length-4)&&(u=!0),-1!==d.indexOf("blob:")&&(u=!0),u){this._streaming?(this._htmlAudioElement=new Audio(d),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,e.Tools.SetCorsBehavior(d,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(function(){o._isReadyToPlay=!0,o.autoplay&&o.play(),o._readyToPlayCallback&&o._readyToPlayCallback()})),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(d,(function(e){o._soundLoaded(e)}),void 0,!0,!0,(function(t){t&&e.Tools.Error("XHR "+t.status+" error on: "+d+"."),e.Tools.Error("Sound creation aborted."),o._scene.mainSoundTrack.RemoveSound(o)}));break}}break;default:l=!1}l?u||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout((function(){o._readyToPlayCallback&&o._readyToPlayCallback()}),1e3)):e.Tools.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(t){e.Tools.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.RemoveSound(this)}}else this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error("Web Audio is not supported by your browser."),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout((function(){o._readyToPlayCallback&&o._readyToPlayCallback()}),1e3)}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks&&this._scene.soundTracks[__uv.$wrap((this.soundTrackId))].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype.isReady=function(){return this._isReadyToPlay},t.prototype._soundLoaded=function(t){var i=this;e.Engine.audioEngine.audioContext&&e.Engine.audioEngine.audioContext.decodeAudioData(t,(function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()}),(function(t){e.Tools.Error("Error while decoding audio data for: "+i.name+" / Error: "+t)}))},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&e.Engine.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)},t.prototype.setDirectionalCone=function(t,i,r){i<t?e.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=r,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play()))},Object.defineProperty(t.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!=this._coneInnerAngle){if(this._coneOuterAngle<t)return void e.Tools.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!=this._coneOuterAngle){if(t<this._coneInnerAngle)return void e.Tools.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!0,configurable:!0}),t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){if(this._connectedMesh&&this._soundPanner){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)}},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t,i){var r=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&e.Engine.audioEngine.audioContext)try{this._startOffset<0&&(t=-this._startOffset,this._startOffset=0);var n=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=e.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){r._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){var a=function(){if(e.Engine.audioEngine.unlocked){var t=r._htmlAudioElement.play();void 0!==t&&t.catch((function(t){e.Engine.audioEngine.lock(),e.Engine.audioEngine.onAudioUnlockedObservable.addOnce((function(){a()}))}))}else e.Engine.audioEngine.onAudioUnlockedObservable.addOnce((function(){a()}))};a()}}else this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){r._onended()},this._soundSource.buffer&&this._soundSource.start(n,this.isPaused?this._startOffset%this._soundSource.buffer.duration:i||0);this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(t){e.Tools.Error("Error while trying to play audio: "+this.name+", "+t.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},t.prototype.stop=function(t){if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect();else if(e.Engine.audioEngine.audioContext&&this._soundSource){var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this._soundSource.onended=function(){},this.isPaused||(this._startOffset=0)}this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():e.Engine.audioEngine.audioContext&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime))},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&this._soundGain&&(i&&e.Engine.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,e.Engine.audioEngine.audioContext.currentTime+i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype.detachFromMesh=function(){this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){if(t.getBoundingInfo){var i=t;if(this._positionInEmitterSpace)i.worldMatrixFromCache.invertToRef(e.Tmp.Matrix[__uv.$wrap((0))]),this.setPosition(e.Tmp.Matrix[__uv.$wrap((0))].getTranslation());else{var r=i.getBoundingInfo();this.setPosition(r.boundingSphere.centerWorld)}e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},t.prototype.clone=function(){var e=this;if(this._streaming)return null;var i=function(){e._isReadyToPlay?(n._audioBuffer=e.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play()):window.setTimeout(i,300)},r={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},n=new t(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,r);return this.useCustomAttenuation&&n.setAttenuationFunction(this._customAttenuationFunction),n.setPosition(this._position),n.setPlaybackRate(this._playbackRate),i(),n},t.prototype.getAudioBuffer=function(){return this._audioBuffer},t.prototype.serialize=function(){var e={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedMesh&&(e.connectedMeshId=this._connectedMesh.id),e.position=this._position.asArray(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.asArray(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e},t.Parse=function(i,r,n,a){var o,s=i.name;o=i.url?n+i.url:n+s;var l,c={autoplay:i.autoplay,loop:i.loop,volume:i.volume,spatialSound:i.spatialSound,maxDistance:i.maxDistance,rolloffFactor:i.rolloffFactor,refDistance:i.refDistance,distanceModel:i.distanceModel,playbackRate:i.playbackRate};if(a){var u=function(){a._isReadyToPlay?(l._audioBuffer=a.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play()):window.setTimeout(u,300)};l=new t(s,new ArrayBuffer(0),r,null,c),u()}else l=new t(s,o,r,(function(){r._removePendingData(l)}),c),r._addPendingData(l);if(i.position){var h=e.Vector3.FromArray(i.position);l.setPosition(h)}if(i.isDirectional&&(l.setDirectionalCone(i.coneInnerAngle||360,i.coneOuterAngle||360,i.coneOuterGain||0),i.localDirectionToMesh)){var d=e.Vector3.FromArray(i.localDirectionToMesh);l.setLocalDirectionToMesh(d)}if(i.connectedMeshId){var p=r.getMeshByID(i.connectedMeshId);p&&l.attachToMesh(p)}return l},t}();e.Sound=t}(s||(s={})),function(e){var t=function(){function t(e,t){void 0===t&&(t={}),this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=e,this.soundCollection=new Array,this._options=t,!this._isMainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype._initializeSoundTrackAudioGraph=function(){e.Engine.audioEngine.canUseWebAudio&&e.Engine.audioEngine.audioContext&&(this._outputAudioNode=e.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(e.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},t.prototype.dispose=function(){if(e.Engine.audioEngine&&e.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[__uv.$wrap((0))].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){this._isInitialized||this._initializeSoundTrackAudioGraph(),e.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks&&this._scene.soundTracks[__uv.$wrap((t.soundTrackId))].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(t){e.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[__uv.$wrap((t))].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[__uv.$wrap((t))].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,e.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,e.Engine.audioEngine.masterGain))},t}();e.SoundTrack=t}(s||(s={})),function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.__uv$setSource(__uv).__uv$top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var r=t[__uv.$wrap((i))]/this.BARGRAPHAMPLITUDE,n=this.DEBUGCANVASSIZE.height*r,a=this.DEBUGCANVASSIZE.height-n-1,o=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),s=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+s+", 100%, 50%)",this._debugCanvasContext.fillRect(i*o,a,o,n)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(s||(s={})),function(e){var t=function(){function t(e,t,i){var r=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==i.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=i;for(var n=0,a=0,o=i;a<o.length;a++){n+=o[__uv.$wrap((a))]}for(var s=n>0?1/n:0,l=0;l<this._weights.length;l++)this._weights[__uv.$wrap((l))]*=s;this._sounds=t;for(var c=0,u=this._sounds;c<u.length;c++){u[__uv.$wrap((c))].onEndedObservable.add((function(){r._onended()}))}}return Object.defineProperty(t.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void e.Tools.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(var i=0,r=this._sounds;i<r.length;i++){r[__uv.$wrap((i))].directionalConeInnerAngle=t}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void e.Tools.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(var i=0,r=this._sounds;i<r.length;i++){r[__uv.$wrap((i))].directionalConeOuterAngle=t}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){if(e!==this._volume)for(var t=0,i=this._sounds;t<i.length;t++){i[__uv.$wrap((t))].setVolume(e)}},enumerable:!0,configurable:!0}),t.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[__uv.$wrap((this._currentIndex))].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},t.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[__uv.$wrap((this._currentIndex))].pause()},t.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[__uv.$wrap((this._currentIndex))].stop()},t.prototype.play=function(e){if(!this.isPaused){this.stop();for(var t=Math.random(),i=0,r=0;r<this._weights.length;r++)if(t<=(i+=this._weights[__uv.$wrap((r))])){this._currentIndex=r;break}}var n=this._sounds[__uv.$wrap((this._currentIndex))];n.isReady()?n.play(0,this.isPaused?void 0:e):n.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},t}();e.WeightedSound=t}(s||(s={})),function(e){e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_AUDIO,(function(t,i,r,n){var a,o=[];if(r.sounds=r.sounds||[],void 0!==t.sounds&&null!==t.sounds)for(var s=0,l=t.sounds.length;s<l;s++){var c=t.sounds[__uv.$wrap((s))];e.Engine.audioEngine.canUseWebAudio?(c.url||(c.url=c.name),o[__uv.$wrap((c.url))]?r.sounds.push(e.Sound.Parse(c,i,n,o[__uv.$wrap((c.url))])):(a=e.Sound.Parse(c,i,n),o[__uv.$wrap((c.url))]=a,r.sounds.push(a))):r.sounds.push(new e.Sound(c.name,null,i))}o=[]})),Object.defineProperty(e.Scene.prototype,"mainSoundTrack",{get:function(){var i=this._getComponent(e.SceneComponentConstants.NAME_AUDIO);return i||(i=new t(this),this._addComponent(i)),this._mainSoundTrack||(this._mainSoundTrack=new e.SoundTrack(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),e.Scene.prototype.getSoundByName=function(e){var t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[__uv.$wrap((t))].name===e)return this.mainSoundTrack.soundCollection[__uv.$wrap((t))];if(this.soundTracks)for(var i=0;i<this.soundTracks.length;i++)for(t=0;t<this.soundTracks[__uv.$wrap((i))].soundCollection.length;t++)if(this.soundTracks[__uv.$wrap((i))].soundCollection[__uv.$wrap((t))].name===e)return this.soundTracks[__uv.$wrap((i))].soundCollection[__uv.$wrap((t))];return null},Object.defineProperty(e.Scene.prototype,"audioEnabled",{get:function(){var i=this._getComponent(e.SceneComponentConstants.NAME_AUDIO);return i||(i=new t(this),this._addComponent(i)),i.audioEnabled},set:function(i){var r=this._getComponent(e.SceneComponentConstants.NAME_AUDIO);r||(r=new t(this),this._addComponent(r)),i?r.enableAudio():r.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(e.Scene.prototype,"headphone",{get:function(){var i=this._getComponent(e.SceneComponentConstants.NAME_AUDIO);return i||(i=new t(this),this._addComponent(i)),i.headphone},set:function(i){var r=this._getComponent(e.SceneComponentConstants.NAME_AUDIO);r||(r=new t(this),this._addComponent(r)),i?r.switchAudioModeForHeadphones():r.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0});var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.scene=t,t.soundTracks=new Array,t.sounds=new Array}return Object.defineProperty(t.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headphone",{get:function(){return this._headphone},enumerable:!0,configurable:!0}),t.prototype.register=function(){this.scene._afterRenderStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},t.prototype.rebuild=function(){},t.prototype.serialize=function(e){if(e.sounds=[],this.scene.soundTracks)for(var t=0;t<this.scene.soundTracks.length;t++)for(var i=this.scene.soundTracks[__uv.$wrap((t))],r=0;r<i.soundCollection.length;r++)e.sounds.push(i.soundCollection[__uv.$wrap((r))].serialize())},t.prototype.addFromContainer=function(e){var t=this;e.sounds&&e.sounds.forEach((function(e){e.play(),e.autoplay=!0,t.scene.mainSoundTrack.AddSound(e)}))},t.prototype.removeFromContainer=function(e){var t=this;e.sounds&&e.sounds.forEach((function(e){e.stop(),e.autoplay=!1,t.scene.mainSoundTrack.RemoveSound(e)}))},t.prototype.dispose=function(){var e=this.scene;if(e._mainSoundTrack&&e.mainSoundTrack.dispose(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[__uv.$wrap((t))].dispose()},t.prototype.disableAudio=function(){var e,t=this.scene;for(this._audioEnabled=!1,e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[__uv.$wrap((e))].pause();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(var i=0;i<t.soundTracks[__uv.$wrap((e))].soundCollection.length;i++)t.soundTracks[__uv.$wrap((e))].soundCollection[__uv.$wrap((i))].pause()},t.prototype.enableAudio=function(){var e,t=this.scene;for(this._audioEnabled=!0,e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[__uv.$wrap((e))].isPaused&&t.mainSoundTrack.soundCollection[__uv.$wrap((e))].play();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(var i=0;i<t.soundTracks[__uv.$wrap((e))].soundCollection.length;i++)t.soundTracks[__uv.$wrap((e))].soundCollection[__uv.$wrap((i))].isPaused&&t.soundTracks[__uv.$wrap((e))].soundCollection[__uv.$wrap((i))].play()},t.prototype.switchAudioModeForHeadphones=function(){var e=this.scene;if(this._headphone=!0,e.mainSoundTrack.switchPanningModelToHRTF(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[__uv.$wrap((t))].switchPanningModelToHRTF()},t.prototype.switchAudioModeForNormalSpeakers=function(){var e=this.scene;if(this._headphone=!1,e.mainSoundTrack.switchPanningModelToEqualPower(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[__uv.$wrap((t))].switchPanningModelToEqualPower()},t.prototype._afterRender=function(){var t=this.scene;if(this._audioEnabled&&t._mainSoundTrack&&t.soundTracks&&(0!==t._mainSoundTrack.soundCollection.length||1!==t.soundTracks.length)){var i,r=e.Engine.audioEngine;if((i=t.activeCameras.length>0?t.activeCameras[__uv.$wrap((0))]:t.activeCamera)&&r.audioContext){var n=null!=r.audioContext.listener.positionX;n?(r.audioContext.listener.positionX.value=i.globalPosition.x,r.audioContext.listener.positionY.value=i.globalPosition.y,r.audioContext.listener.positionZ.value=i.globalPosition.z):r.audioContext.listener.setPosition(i.globalPosition.x,i.globalPosition.y,i.globalPosition.z),i.rigCameras&&i.rigCameras.length>0&&(i=i.rigCameras[__uv.$wrap((0))]);var a,o=e.Matrix.Invert(i.getViewMatrix()),s=e.Vector3.TransformNormal(new e.Vector3(0,0,-1),o);for(s.normalize(),isNaN(s.x)||isNaN(s.y)||isNaN(s.z)||(n?(r.audioContext.listener.forwardX.value=s.x,r.audioContext.listener.forwardY.value=s.y,r.audioContext.listener.forwardZ.value=s.z):r.audioContext.listener.setOrientation(s.x,s.y,s.z,0,1,0)),a=0;a<t.mainSoundTrack.soundCollection.length;a++){var l=t.mainSoundTrack.soundCollection[__uv.$wrap((a))];l.useCustomAttenuation&&l.updateDistanceFromListener()}if(t.soundTracks)for(a=0;a<t.soundTracks.length;a++)for(var c=0;c<t.soundTracks[__uv.$wrap((a))].soundCollection.length;c++)(l=t.soundTracks[__uv.$wrap((a))].soundCollection[__uv.$wrap((c))]).useCustomAttenuation&&l.updateDistanceFromListener()}}},t}();e.AudioSceneComponent=t}(s||(s={})),function(e){var t=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n._sound=i,n}return a(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(e.Action);e.PlaySoundAction=t;var i=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n._sound=i,n}return a(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(e.Action);e.StopSoundAction=i}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u,h,d,p,m){void 0===n&&(n=null),void 0===a&&(a=!1),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=e.Engine.TEXTUREFORMAT_RGBA),void 0===u&&(u=!1),void 0===h&&(h=null),void 0===d&&(d=!1),void 0===p&&(p=.8),void 0===m&&(m=0);var _=t.call(this,r)||this;if(_.boundingBoxPosition=e.Vector3.Zero(),_._rotationY=0,_._prefiltered=!1,_.name=i,_.url=i,_._noMipmap=a,_.hasAlpha=!1,_._format=c,_.isCube=!0,_._textureMatrix=e.Matrix.Identity(),_._createPolynomials=d,_.coordinatesMode=e.Texture.CUBIC_MODE,!i&&!o)return _;var f=i.lastIndexOf("."),g=h||(f>-1?i.substring(f).toLowerCase():""),y=".dds"===g,v=".env"===g;if(v?(_.gammaSpace=!1,_._prefiltered=!1):(_._prefiltered=u,u&&(_.gammaSpace=!1)),_._texture=_._getFromCache(i,a),!o&&(v||y||n||(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),o=[],n))for(var b=0;b<n.length;b++)o.push(i+n[__uv.$wrap((b))]);return _._files=o,_._texture?s&&(_._texture.isReady?e.Tools.SetImmediate((function(){return s()})):_._texture.onLoadedObservable.add(s)):r.useDelayedTextureLoading?_.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:_._texture=u?r.getEngine().createPrefilteredCubeTexture(i,r,p,m,s,l,c,h,_._createPolynomials):r.getEngine().createCubeTexture(i,r,o,a,s,l,_._format,h,!1,p,m),_}return a(i,t),Object.defineProperty(i.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(t){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(t)){this._boundingBoxSize=t;var i=this.getScene();i&&i.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rotationY},set:function(t){this._rotationY=t,this.setReflectionTextureMatrix(e.Matrix.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),i.CreateFromImages=function(e,t,r){var n="";return e.forEach((function(e){return n+=e})),new i(n,t,null,r,e)},i.CreateFromPrefilteredData=function(e,t,r,n){return void 0===r&&(r=null),void 0===n&&(n=!0),new i(e,t,null,!1,null,null,null,void 0,!0,r,n)},i.prototype.delayLoad=function(){if(this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED){var t=this.getScene();t&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=t.getEngine().createPrefilteredCubeTexture(this.url,t,this.lodGenerationScale,this.lodGenerationOffset,void 0,void 0,this._format,void 0,this._createPolynomials):this._texture=t.getEngine().createCubeTexture(this.url,t,this._files,this._noMipmap,void 0,void 0,this._format)))}},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i.prototype.setReflectionTextureMatrix=function(e){this._textureMatrix=e},i.Parse=function(t,r,n){var a=e.SerializationHelper.Parse((function(){var e=!1;return t.prefiltered&&(e=t.prefiltered),new i(n+t.name,r,t.extensions,!1,null,null,null,void 0,e)}),t,r);if(t.boundingBoxPosition&&(a.boundingBoxPosition=e.Vector3.FromArray(t.boundingBoxPosition)),t.boundingBoxSize&&(a.boundingBoxSize=e.Vector3.FromArray(t.boundingBoxSize)),t.animations)for(var o=0;o<t.animations.length;o++){var s=t.animations[__uv.$wrap((o))];a.animations.push(e.Animation.Parse(s))}return a},i.prototype.clone=function(){var t=this;return e.SerializationHelper.Clone((function(){var e=t.getScene();return e?new i(t.url,e,t._extensions,t._noMipmap,t._files):t}),this)},n([e.serialize("rotationY")],i.prototype,"rotationY",null),i}(e.BaseTexture);e.CubeTexture=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u){void 0===a&&(a=e.Engine.TEXTUREFORMAT_RGBA),void 0===o&&(o=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===s&&(s=!1),void 0===l&&(l=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null);var h=t.call(this,"",i)||this;return h._texture=i.getEngine().createRawCubeTexture(r,n,a,o,s,l,c,u),h}return a(i,t),i.prototype.update=function(e,t,i,r,n,a){void 0===n&&(n=null),void 0===a&&(a=0),this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,i,r,n)},i.prototype.updateRGBDAsync=function(e,t,r,n){return void 0===t&&(t=null),void 0===r&&(r=.8),void 0===n&&(n=0),i._UpdateRGBDAsync(this._texture,e,t,r,n)},i.prototype.clone=function(){var t=this;return e.SerializationHelper.Clone((function(){var r=t.getScene(),n=t._texture,a=new i(r,n._bufferViewArray,n.width,n.format,n.type,n.generateMipMaps,n.invertY,n.samplingMode,n._compression);return n.dataSource===e.InternalTexture.DATASOURCE_CUBERAW_RGBD&&a.updateRGBDAsync(n._bufferViewArrayArray,n._sphericalPolynomial,n._lodGenerationScale,n._lodGenerationOffset),a}),this)},i._UpdateRGBDAsync=function(t,i,r,n,a){return t._dataSource=e.InternalTexture.DATASOURCE_CUBERAW_RGBD,t._bufferViewArrayArray=i,t._lodGenerationScale=n,t._lodGenerationOffset=a,t._sphericalPolynomial=r,e.EnvironmentTextureTools.UploadLevelsAsync(t,i).then((function(){t.isReady=!0}))},i}(e.CubeTexture);e.RawCubeTexture=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u,h,d,p){void 0===o&&(o=!0),void 0===s&&(s=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=!0),void 0===h&&(h=!1),void 0===d&&(d=!1),void 0===p&&(p=e.Engine.TEXTUREFORMAT_RGBA);var m=t.call(this,null,n,!a)||this;return m.isCube=l,m.renderParticles=!0,m.renderSprites=!1,m.coordinatesMode=e.Texture.PROJECTION_MODE,m.ignoreCameraViewport=!1,m.onBeforeBindObservable=new e.Observable,m.onAfterUnbindObservable=new e.Observable,m.onBeforeRenderObservable=new e.Observable,m.onAfterRenderObservable=new e.Observable,m.onClearObservable=new e.Observable,m._currentRefreshId=-1,m._refreshRate=1,m._samples=1,m.boundingBoxPosition=e.Vector3.Zero(),(n=m.getScene())?(m.renderList=new Array,m._engine=n.getEngine(),m.name=i,m.isRenderTarget=!0,m._initialSizeParameter=r,m._processSizeParameter(r),m._resizeObserver=m.getScene().getEngine().onResizeObservable.add((function(){})),m._generateMipMaps=!!a,m._doNotChangeAspectRatio=o,m._renderingManager=new e.RenderingManager(n),m._renderingManager._useSceneAutoClearSetup=!0,d||(m._renderTargetOptions={generateMipMaps:a,type:s,format:p,samplingMode:c,generateDepthBuffer:u,generateStencilBuffer:h},c===e.Texture.NEAREST_SAMPLINGMODE&&(m.wrapU=e.Texture.CLAMP_ADDRESSMODE,m.wrapV=e.Texture.CLAMP_ADDRESSMODE),l?(m._texture=n.getEngine().createRenderTargetCubeTexture(m.getRenderSize(),m._renderTargetOptions),m.coordinatesMode=e.Texture.INVCUBIC_MODE,m._textureMatrix=e.Matrix.Identity()):m._texture=n.getEngine().createRenderTargetTexture(m._size,m._renderTargetOptions)),m):m}return a(i,t),Object.defineProperty(i.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),i.prototype._hookArray=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[__uv.$wrap((n))]=arguments[__uv.$wrap((n))];var a=0===e.length,o=i.apply(e,r);return a&&t.getScene().meshes.forEach((function(e){e._markSubMeshesAsLightDirty()})),o};var r=e.splice;e.splice=function(i,n){var a=r.apply(e,[i,n]);return 0===e.length&&t.getScene().meshes.forEach((function(e){e._markSubMeshesAsLightDirty()})),a}},Object.defineProperty(i.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),i.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(i.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(t){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(t)){this._boundingBoxSize=t;var i=this.getScene();i&&i.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)}},enumerable:!0,configurable:!0}),i.prototype.createDepthStencilTexture=function(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=!0),void 0===i&&(i=!1),this.getScene()){var r=this.getScene().getEngine();this.depthStencilTexture=r.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:i,isCube:this.isCube}),r.setFrameBufferDepthStencilTexture(this)}},i.prototype._processSizeParameter=function(e){e.ratio?(this._sizeRatio=e.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=e},Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var t=this.getScene();t&&(this._samples=t.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!0,configurable:!0}),i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),i.prototype.addPostProcess=function(t){if(!this._postProcessManager){var i=this.getScene();if(!i)return;this._postProcessManager=new e.PostProcessManager(i),this._postProcesses=new Array}this._postProcesses.push(t),this._postProcesses[__uv.$wrap((0))].autoClear=!1},i.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,i=this._postProcesses;t<i.length;t++){i[__uv.$wrap((t))].dispose()}this._postProcesses=[]}},i.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[__uv.$wrap((0))].autoClear=!1))}},i.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},i.prototype.getRenderSize=function(){return this.getRenderWidth()},i.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},i.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},Object.defineProperty(i.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype.scale=function(e){var t=this.getRenderSize()*e;this.resize(t)},i.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:t.prototype.getReflectionTextureMatrix.call(this)},i.prototype.resize=function(e){this.releaseInternalTexture();var t=this.getScene();t&&(this._processSizeParameter(e),this.isCube?this._texture=t.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._texture=t.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions))},i.prototype.render=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),s=this.getScene()){var i,r=s.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var n=0;n<this._waitingRenderList.length;n++){var a=this._waitingRenderList[__uv.$wrap((n))],o=s.getMeshByID(a);o&&this.renderList.push(o)}delete this._waitingRenderList}if(this.renderListPredicate){var s;if(this.renderList?this.renderList.splice(0):this.renderList=[],!(s=this.getScene()))return;var l=s.meshes;for(n=0;n<l.length;n++){var c=l[__uv.$wrap((n))];this.renderListPredicate(c)&&this.renderList.push(c)}}this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(i=this.activeCamera,r.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==s.activeCamera&&s.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(i=s.activeCamera)&&r.setViewport(i.viewport,this.getRenderWidth(),this.getRenderHeight()),this._renderingManager.reset();for(var u=this.renderList?this.renderList:s.getActiveMeshes().data,h=this.renderList?this.renderList.length:s.getActiveMeshes().length,d=s.getRenderId(),p=0;p<h;p++){if(c=u[__uv.$wrap((p))]){if(!c.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}c._preActivateForIntermediateRendering(d);var m=void 0;if(m=!(this.renderList||!i)&&0==(c.layerMask&i.layerMask),c.isEnabled()&&c.isVisible&&c.subMeshes&&!m){c._activate(d);for(var _=0;_<c.subMeshes.length;_++){var f=c.subMeshes[__uv.$wrap((_))];s._activeIndices.addCount(f.indexCount,!1),this._renderingManager.dispatch(f,c)}}}}for(var g=0;g<s.particleSystems.length;g++){var y=s.particleSystems[__uv.$wrap((g))],v=y.emitter;y.isStarted()&&v&&v.position&&v.isEnabled()&&(u.indexOf(v)>=0&&this._renderingManager.dispatchParticles(y))}if(this.isCube)for(var b=0;b<6;b++)this.renderToTarget(b,u,h,e,t),s.incrementRenderId(),s.resetCachedMaterial();else this.renderToTarget(0,u,h,e,t);this.onAfterUnbindObservable.notifyObservers(this),s.activeCamera&&(this.activeCamera&&this.activeCamera!==s.activeCamera&&s.setTransformMatrix(s.activeCamera.getViewMatrix(),s.activeCamera.getProjectionMatrix(!0)),r.setViewport(s.activeCamera.viewport)),s.resetCachedMaterial()}},i.prototype._bestReflectionRenderTargetDimension=function(t,i){var r=t*i,n=e.Tools.NearestPOT(r+16384/(128+r));return Math.min(e.Tools.FloorPOT(t),n)},i.prototype.unbindFrameBuffer=function(e,t){var i=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,(function(){i.onAfterRenderObservable.notifyObservers(t)}))},i.prototype.renderToTarget=function(t,i,r,n,a){var o=this.getScene();if(o){var s=o.getEngine();this._texture&&(this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&o.postProcessManager._prepareFrame(this._texture)||this._texture&&s.bindFramebuffer(this._texture,this.isCube?t:void 0,void 0,void 0,this.ignoreCameraViewport,this.depthStencilTexture?this.depthStencilTexture:void 0),this.onBeforeRenderObservable.notifyObservers(t),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(s):s.clear(this.clearColor||o.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||o.updateTransformMatrix(!0),this._renderingManager.render(this.customRenderFunction,i,this.renderParticles,this.renderSprites),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,t,this._postProcesses,this.ignoreCameraViewport):n&&o.postProcessManager._finalizeFrame(!1,this._texture,t),this._doNotChangeAspectRatio||o.updateTransformMatrix(!0),a&&e.Tools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),s),this.isCube&&5!==t?this.onAfterRenderObservable.notifyObservers(t):(this.isCube&&5===t&&s.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(s,t)))}},i.prototype.setRenderingOrder=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,i,r)},i.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var i=0;i<this.renderList.length;i++)e.renderList.push(this.renderList[__uv.$wrap((i))].id);return e},i.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),t=this.getScene();e&&t&&t.getEngine()._releaseFramebufferObjects(e)},i.prototype.dispose=function(){this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var e=this.getScene();if(e){var i=e.customRenderTargets.indexOf(this);i>=0&&e.customRenderTargets.splice(i,1);for(var r=0,n=e.cameras;r<n.length;r++){var a=n[__uv.$wrap((r))];(i=a.customRenderTargets.indexOf(this))>=0&&a.customRenderTargets.splice(i,1)}t.prototype.dispose.call(this)}},i.prototype._rebuild=function(){this.refreshRate===i.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=i.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},i.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},i.REFRESHRATE_RENDER_ONCE=0,i.REFRESHRATE_RENDER_ONEVERYFRAME=1,i.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,i}(e.Texture);e.RenderTargetTexture=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o){var s=this,l=!(!o||!o.generateMipMaps)&&o.generateMipMaps,c=!(!o||!o.generateDepthTexture)&&o.generateDepthTexture,u=!o||void 0===o.doNotChangeAspectRatio||o.doNotChangeAspectRatio;if((s=t.call(this,i,r,a,l,u)||this)._engine=a.getEngine(),s.isSupported){for(var h=[],d=[],p=0;p<n;p++)o&&o.types&&void 0!==o.types[__uv.$wrap((p))]?h.push(o.types[__uv.$wrap((p))]):h.push(o&&o.defaultType?o.defaultType:e.Engine.TEXTURETYPE_UNSIGNED_INT),o&&o.samplingModes&&void 0!==o.samplingModes[__uv.$wrap((p))]?d.push(o.samplingModes[__uv.$wrap((p))]):d.push(e.Texture.BILINEAR_SAMPLINGMODE);var m=!o||void 0===o.generateDepthBuffer||o.generateDepthBuffer,_=!(!o||void 0===o.generateStencilBuffer)&&o.generateStencilBuffer;return s._size=r,s._multiRenderTargetOptions={samplingModes:d,generateMipMaps:l,generateDepthBuffer:m,generateStencilBuffer:_,generateDepthTexture:c,types:h,textureCount:n},s._createInternalTextures(),s._createTextures(),s}s.dispose()}return a(i,t),Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"depthTexture",{get:function(){return this._textures[__uv.$wrap((this._textures.length-1))]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wrapU",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[__uv.$wrap((t))].wrapU=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wrapV",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[__uv.$wrap((t))].wrapV=e},enumerable:!0,configurable:!0}),i.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var e=0;e<this._internalTextures.length;e++){this._textures[__uv.$wrap((e))]._texture=this._internalTextures[__uv.$wrap((e))]}this._texture=this._internalTextures[__uv.$wrap((0))]},i.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},i.prototype._createTextures=function(){this._textures=[];for(var t=0;t<this._internalTextures.length;t++){var i=new e.Texture(null,this.getScene());i._texture=this._internalTextures[__uv.$wrap((t))],this._textures.push(i)}this._texture=this._internalTextures[__uv.$wrap((0))]},Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures,e))},enumerable:!0,configurable:!0}),i.prototype.resize=function(e){this.releaseInternalTextures(),this._internalTextures=this._engine.createMultipleRenderTarget(e,this._multiRenderTargetOptions),this._createInternalTextures()},i.prototype.unbindFrameBuffer=function(e,t){var i=this;e.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,(function(){i.onAfterRenderObservable.notifyObservers(t)}))},i.prototype.dispose=function(){this.releaseInternalTextures(),t.prototype.dispose.call(this)},i.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var e=this._internalTextures.length-1;e>=0;e--)void 0!==this._internalTextures[__uv.$wrap((e))]&&(this._internalTextures[__uv.$wrap((e))].dispose(),this._internalTextures.splice(e,1))},i}(e.RenderTargetTexture);e.MultiRenderTarget=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l){void 0===o&&(o=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===s&&(s=e.Texture.BILINEAR_SAMPLINGMODE),void 0===l&&(l=!0);var c=t.call(this,i,r,n,a,!0,o,!1,s,l)||this;return c.scene=n,c.mirrorPlane=new e.Plane(0,1,0,1),c._transformMatrix=e.Matrix.Zero(),c._mirrorMatrix=e.Matrix.Zero(),c._adaptiveBlurKernel=0,c._blurKernelX=0,c._blurKernelY=0,c._blurRatio=1,c.ignoreCameraViewport=!0,c._updateGammaSpace(),c._imageProcessingConfigChangeObserver=n.imageProcessingConfiguration.onUpdateParameters.add((function(){c._updateGammaSpace})),c.onBeforeRenderObservable.add((function(){e.Matrix.ReflectionToRef(c.mirrorPlane,c._mirrorMatrix),c._savedViewMatrix=n.getViewMatrix(),c._mirrorMatrix.multiplyToRef(c._savedViewMatrix,c._transformMatrix),n.setTransformMatrix(c._transformMatrix,n.getProjectionMatrix()),n.clipPlane=c.mirrorPlane,n.getEngine().cullBackFaces=!1,n._mirroredCameraPosition=e.Vector3.TransformCoordinates(n.activeCamera.globalPosition,c._mirrorMatrix)})),c.onAfterRenderObservable.add((function(){n.setTransformMatrix(c._savedViewMatrix,n.getProjectionMatrix()),n.getEngine().cullBackFaces=!0,n._mirroredCameraPosition=null,delete n.clipPlane})),c}return a(i,t),Object.defineProperty(i.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"adaptiveBlurKernel",{set:function(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blurKernel",{set:function(e){this.blurKernelX=e,this.blurKernelY=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),i.prototype._autoComputeBlurKernel=function(){var e=this.getScene().getEngine(),t=this.getRenderWidth()/e.getRenderWidth(),i=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*t,this.blurKernelY=this._adaptiveBlurKernel*i},i.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},i.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},i.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var t=this.getScene().getEngine(),i=t.getCaps().textureFloatRender?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_HALF_FLOAT;this._blurX=new e.BlurPostProcess("horizontal blur",new e.Vector2(1,0),this._blurKernelX,this._blurRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,t,!1,i),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new e.BlurPostProcess("vertical blur",new e.Vector2(0,1),this._blurKernelY,this._blurRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,t,!1,i),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},i.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),r=new i(this.name,t.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);return e.mirrorPlane=this.mirrorPlane.asArray(),e},i.prototype.dispose=function(){t.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},i}(e.RenderTargetTexture);e.MirrorTexture=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){var o=t.call(this,i,r,n,a,!0)||this;return o.refractionPlane=new e.Plane(0,1,0,1),o.depth=2,o.onBeforeRenderObservable.add((function(){n.clipPlane=o.refractionPlane})),o.onAfterRenderObservable.add((function(){delete n.clipPlane})),o}return a(i,t),i.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),r=new i(this.name,t.width,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.refractionPlane=this.refractionPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r.depth=this.depth,r},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);return e.mirrorPlane=this.refractionPlane.asArray(),e.depth=this.depth,e},i}(e.RenderTargetTexture);e.RefractionTexture=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s){void 0===n&&(n=null),void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=e.Engine.TEXTUREFORMAT_RGBA);var l=t.call(this,null,n,!a,void 0,o,void 0,void 0,void 0,void 0,s)||this;l.name=i,l._engine=l.getScene().getEngine(),l.wrapU=e.Texture.CLAMP_ADDRESSMODE,l.wrapV=e.Texture.CLAMP_ADDRESSMODE,l._generateMipMaps=a,r.getContext?(l._canvas=r,l._texture=l._engine.createDynamicTexture(r.width,r.height,a,o)):(l._canvas=document.createElement("canvas"),r.width||0===r.width?l._texture=l._engine.createDynamicTexture(r.width,r.height,a,o):l._texture=l._engine.createDynamicTexture(r,r,a,o));var c=l.getSize();return l._canvas.width=c.width,l._canvas.height=c.height,l._context=l._canvas.getContext("2d"),l}return a(i,t),Object.defineProperty(i.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype._recreate=function(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(e.width,e.height,this._generateMipMaps,this._samplingMode)},i.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)},i.prototype.scaleTo=function(e,t){var i=this.getSize();i.width=e,i.height=t,this._recreate(i)},i.prototype.getContext=function(){return this._context},i.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},i.prototype.update=function(e,t){void 0===t&&(t=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0)},i.prototype.drawText=function(e,t,i,r,n,a,o,s){void 0===s&&(s=!0);var l=this.getSize();if(a&&(this._context.fillStyle=a,this._context.fillRect(0,0,l.width,l.height)),this._context.font=r,null==t){var c=this._context.measureText(e);t=(l.width-c.width)/2}if(null==i){var u=parseInt(r.replace(/\D/g,""));i=l.height/2+u/3.65}this._context.fillStyle=n,this._context.fillText(e,t,i),s&&this.update(o)},i.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),r=new i(this.name,t,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.wrapU=this.wrapU,r.wrapV=this.wrapV,r},i.prototype.serialize=function(){var i=this.getScene();i&&!i.isReady()&&e.Tools.Warn("The scene must be ready before serializing the dynamic texture");var r=t.prototype.serialize.call(this);return r.base64String=this._canvas.toDataURL(),r.invertY=this._invertY,r.samplingMode=this.samplingMode,r},i.prototype._rebuild=function(){this.update()},i}(e.Texture);e.DynamicTexture=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l){void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===l&&(l={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var c=t.call(this,null,n,!a,o)||this;return c._onUserActionRequestedObservable=null,c._stillImageCaptured=!1,c._poster=!1,c._createInternalTexture=function(){if(null!=c._texture){if(!c._poster)return;c._texture.dispose(),c._poster=!1}if(!c._engine.needPOTTextures||e.Tools.IsExponentOfTwo(c.video.videoWidth)&&e.Tools.IsExponentOfTwo(c.video.videoHeight)?(c.wrapU=e.Texture.WRAP_ADDRESSMODE,c.wrapV=e.Texture.WRAP_ADDRESSMODE):(c.wrapU=e.Texture.CLAMP_ADDRESSMODE,c.wrapV=e.Texture.CLAMP_ADDRESSMODE,c._generateMipMaps=!1),c._texture=c._engine.createDynamicTexture(c.video.videoWidth,c.video.videoHeight,c._generateMipMaps,c._samplingMode),c.video.autoplay)c._texture.isReady=!0,c._updateInternalTexture(),c.onLoadObservable.hasObservers()&&c.onLoadObservable.notifyObservers(c);else{var t=c.video.onplaying,i=!1;c.video.onplaying=function(){c.video.onplaying=t,c._texture.isReady=!0,c._updateInternalTexture(),i||c.video.pause(),c.onLoadObservable.hasObservers()&&c.onLoadObservable.notifyObservers(c)};var r=c.video.play();r?r.then((function(){})).catch((function(){i=!0,c._onUserActionRequestedObservable&&c._onUserActionRequestedObservable.hasObservers()&&c._onUserActionRequestedObservable.notifyObservers(c)})):(c.video.onplaying=t,c._texture.isReady=!0,c._updateInternalTexture(),c.onLoadObservable.hasObservers()&&c.onLoadObservable.notifyObservers(c))}},c.reset=function(){null!=c._texture&&(c._poster||(c._texture.dispose(),c._texture=null))},c._updateInternalTexture=function(e){null!=c._texture&&c._texture.isReady&&(c.video.readyState<c.video.HAVE_CURRENT_DATA||c._engine.updateVideoTexture(c._texture,c.video,c._invertY))},c._engine=c.getScene().getEngine(),c._generateMipMaps=a,c._samplingMode=s,c.autoUpdateTexture=l.autoUpdateTexture,c.name=i||c._getName(r),c.video=c._getVideo(r),l.poster&&(c.video.poster=l.poster),void 0!==l.autoPlay&&(c.video.autoplay=l.autoPlay),void 0!==l.loop&&(c.video.loop=l.loop),c.video.setAttribute("playsinline",""),c.video.addEventListener("canplay",c._createInternalTexture),c.video.addEventListener("paused",c._updateInternalTexture),c.video.addEventListener("seeked",c._updateInternalTexture),c.video.addEventListener("emptied",c.reset),c.video.readyState>=c.video.HAVE_CURRENT_DATA&&c._createInternalTexture(),l.poster&&(c._texture=c._engine.createTexture(l.poster,!1,!0,n),c._poster=!0),c}return a(i,t),Object.defineProperty(i.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new e.Observable),this._onUserActionRequestedObservable},enumerable:!0,configurable:!0}),i.prototype._getName=function(e){return e instanceof HTMLVideoElement?e.currentSrc:"object"==typeof e?e.toString():e},i.prototype._getVideo=function(t){if(t instanceof HTMLVideoElement)return e.Tools.SetCorsBehavior(t.currentSrc,t),t;var i=document.createElement("video");return"string"==typeof t?(e.Tools.SetCorsBehavior(t,i),i.src=t):(e.Tools.SetCorsBehavior(t[__uv.$wrap((0))],i),t.forEach((function(e){var t=document.createElement("source");t.src=e,i.appendChild(t)}))),i},i.prototype._rebuild=function(){this.update()},i.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},i.prototype.updateTexture=function(e){e&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},i.prototype.updateURL=function(e){this.video.src=e},i.prototype.dispose=function(){t.prototype.dispose.call(this),this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener("canplay",this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},i.CreateFromWebCam=function(t,r,n){var a,o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.setAttribute("playsinline",""),n&&n.deviceId&&(a={exact:n.deviceId}),window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:n}).then((function(e){void 0!==o.mozSrcObject?o.mozSrcObject=e:o.srcObject=e;var n=function(){r&&r(new i("video",o,t,!0,!0)),o.removeEventListener("playing",n)};o.addEventListener("playing",n),o.play()})).catch((function(t){e.Tools.Error(t.name)})):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:a,width:{min:n&&n.minWidth||256,max:n&&n.maxWidth||640},height:{min:n&&n.minHeight||256,max:n&&n.maxHeight||480}}},(function(e){void 0!==o.mozSrcObject?o.mozSrcObject=e:o.src=window.URL&&window.URL.createObjectURL(e)||e,o.play(),r&&r(new i("video",o,t,!0,!0))}),(function(t){e.Tools.Error(t.name)})))},i}(e.Texture);e.VideoTexture=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u){void 0===s&&(s=!0),void 0===l&&(l=!1),void 0===c&&(c=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=e.Engine.TEXTURETYPE_UNSIGNED_INT);var h=t.call(this,null,o,!s,l)||this;return h.format=a,h._engine=o.getEngine(),h._texture=o.getEngine().createRawTexture(i,r,n,a,s,l,c,null,u),h.wrapU=e.Texture.CLAMP_ADDRESSMODE,h.wrapV=e.Texture.CLAMP_ADDRESSMODE,h}return a(i,t),i.prototype.update=function(e){this._engine.updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,void 0,this._texture.type)},i.CreateLuminanceTexture=function(t,r,n,a,o,s,l){return void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE,a,o,s,l)},i.CreateLuminanceAlphaTexture=function(t,r,n,a,o,s,l){return void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,a,o,s,l)},i.CreateAlphaTexture=function(t,r,n,a,o,s,l){return void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_ALPHA,a,o,s,l)},i.CreateRGBTexture=function(t,r,n,a,o,s,l,c){return void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGB,a,o,s,l,c)},i.CreateRGBATexture=function(t,r,n,a,o,s,l,c){return void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGBA,a,o,s,l,c)},i.CreateRTexture=function(t,r,n,a,o,s,l,c){return void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=e.Engine.TEXTURETYPE_FLOAT),new i(t,r,n,e.Engine.TEXTUREFORMAT_R,a,o,s,l,c)},i}(e.Texture);e.RawTexture=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u,h){void 0===l&&(l=!0),void 0===c&&(c=!1),void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=e.Engine.TEXTURETYPE_UNSIGNED_INT);var d=t.call(this,null,s,!l,c)||this;return d.format=o,d._engine=s.getEngine(),d._texture=s.getEngine().createRawTexture3D(i,r,n,a,o,l,c,u,void 0,h),d.is3D=!0,d}return a(i,t),i.prototype.update=function(e){this._texture&&this._engine.updateRawTexture3D(this._texture,e,this._texture.format,this._texture.invertY,void 0,this._texture.type)},i}(e.Texture);e.RawTexture3D=t}(s||(s={})),function(e){var t=function(){function t(e){this._vertexBuffers={},this._scene=e}return t.prototype._prepareBuffers=function(){if(!this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=new e.VertexBuffer(this._scene.getEngine(),t,e.VertexBuffer.PositionKind,!1,!1,2),this._buildIndexBuffer()}},t.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},t.prototype._rebuild=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&(t._rebuild(),this._buildIndexBuffer())},t.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i=this._scene.activeCamera;return!!i&&(!(!(t=t||i._postProcesses.filter((function(e){return null!=e})))||0===t.length||!this._scene.postProcessesEnabled)&&(t[__uv.$wrap((0))].activate(i,e,null!=t),!0))},t.prototype.directRender=function(t,i,r,n,a){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=0),void 0===a&&(a=0);for(var o=this._scene.getEngine(),s=0;s<t.length;s++){s<t.length-1?t[__uv.$wrap((s+1))].activate(this._scene.activeCamera,i):i?o.bindFramebuffer(i,n,void 0,void 0,r,void 0,a):o.restoreDefaultFramebuffer();var l=t[__uv.$wrap((s))],c=l.apply();c&&(l.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,c),o.drawElementsType(e.Material.TriangleFillMode,0,6),l.onAfterRenderObservable.notifyObservers(c))}o.setDepthBuffer(!0),o.setDepthWrite(!0)},t.prototype._finalizeFrame=function(t,i,r,n,a){void 0===a&&(a=!1);var o=this._scene.activeCamera;if(o&&0!==(n=n||o._postProcesses.filter((function(e){return null!=e}))).length&&this._scene.postProcessesEnabled){for(var s=this._scene.getEngine(),l=0,c=n.length;l<c;l++){var u=n[__uv.$wrap((l))];if(l<c-1?u._outputTexture=n[__uv.$wrap((l+1))].activate(o,i):i?(s.bindFramebuffer(i,r,void 0,void 0,a),u._outputTexture=i):(s.restoreDefaultFramebuffer(),u._outputTexture=null),t)break;var h=u.apply();h&&(u.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),s.bindBuffers(this._vertexBuffers,this._indexBuffer,h),s.drawElementsType(e.Material.TriangleFillMode,0,6),u.onAfterRenderObservable.notifyObservers(h))}s.setDepthBuffer(!0),s.setDepthWrite(!0),s.setAlphaMode(e.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&(t.dispose(),this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},t}();e.PostProcessManager=t}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a,o,s,l,c,u,h,d,p,m){void 0===s&&(s=e.Texture.NEAREST_SAMPLINGMODE),void 0===u&&(u=null),void 0===h&&(h=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===d&&(d="postprocess"),void 0===m&&(m=!1),this.name=t,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=e.Engine.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=e.Engine.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new e.SmartArray(2),this._currentRenderTextureInd=0,this._scaleRatio=new e.Vector2(1,1),this._texelSize=e.Vector2.Zero(),this.onActivateObservable=new e.Observable,this.onSizeChangedObservable=new e.Observable,this.onApplyObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,null!=o?(this._camera=o,this._scene=o.getScene(),o.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this)):l&&(this._engine=l,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=s||e.Texture.NEAREST_SAMPLINGMODE,this._reusable=c||!1,this._textureType=h,this._samplers=n||[],this._samplers.push("textureSampler"),this._fragmentUrl=i,this._vertexUrl=d,this._parameters=r||[],this._parameters.push("scale"),this._indexParameters=p,m||this.updateEffect(u)}return Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){var t=this;this._samples=e,this._textures.forEach((function(e){e.samples!==t._samples&&t._engine.updateRenderTargetTextureSampleCount(e,t._samples)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputTexture",{get:function(){return this._textures.data[__uv.$wrap((this._currentRenderTextureInd))]},set:function(e){this._forcedOutputTexture=e},enumerable:!0,configurable:!0}),t.prototype.getCamera=function(){return this._camera},Object.defineProperty(t.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),t.prototype.getEngine=function(){return this._engine},t.prototype.getEffect=function(){return this._effect},t.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},t.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new e.SmartArray(2)),this._shareOutputWithPostProcess=null},t.prototype.updateEffect=function(e,t,i,r,n,a){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],t||this._parameters,i||this._samplers,null!==e?e:"",void 0,n,a,r||this._indexParameters)},t.prototype.isReusable=function(){return this._reusable},t.prototype.markTextureDirty=function(){this.width=-1},t.prototype.activate=function(t,i,r){var n=this;void 0===i&&(i=null);var a=(t=t||this._camera).getScene(),o=a.getEngine(),s=o.getCaps().maxTextureSize,l=(i?i.width:this._engine.getRenderWidth(!0))*this._options|0,c=(i?i.height:this._engine.getRenderHeight(!0))*this._options|0,u=t.__uv$setSource(__uv).__uv$parent;!u||u.leftCamera!=t&&u.rightCamera!=t||(l/=2);var h,d=this._options.width||l,p=this._options.height||c;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var m=o.currentViewport;m&&(d*=m.width,p*=m.height)}if((this.renderTargetSamplingMode===e.Texture.TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(d=o.needPOTTextures?e.Tools.GetExponentOfTwo(d,s,this.scaleMode):d),this._options.height||(p=o.needPOTTextures?e.Tools.GetExponentOfTwo(p,s,this.scaleMode):p)),this.width!==d||this.height!==p){if(this._textures.length>0){for(var _=0;_<this._textures.length;_++)this._engine._releaseTexture(this._textures.data[__uv.$wrap((_))]);this._textures.reset()}this.width=d,this.height=p;var f={width:this.width,height:this.height},g={generateMipMaps:!1,generateDepthBuffer:r||0===t._postProcesses.indexOf(this),generateStencilBuffer:(r||0===t._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(f,g)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(f,g)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach((function(e){e.samples!==n.samples&&n._engine.updateRenderTargetTextureSampleCount(e,n.samples)}))}return this._shareOutputWithPostProcess?h=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(h=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):h=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(l/d,c/p),this._engine.bindFramebuffer(h,0,l,c,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(h,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(t),this.autoClear&&this.alphaMode===e.Engine.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:a.clearColor,a._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),h},Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),t.prototype.isReady=function(){return this._effect&&this._effect.isReady()},t.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",e),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var e},t.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var e=0;e<this._textures.length;e++)this._engine._releaseTexture(this._textures.data[__uv.$wrap((e))]);this._textures.dispose()}},t.prototype.dispose=function(e){if(e=e||this._camera,this._disposeTextures(),this._scene){var t=this._scene.postProcesses.indexOf(this);-1!==t&&this._scene.postProcesses.splice(t,1)}else{var i=this._engine.postProcesses.indexOf(this);-1!==i&&this._engine.postProcesses.splice(i,1)}if(e){if(e.detachPostProcess(this),0===e._postProcesses.indexOf(this)&&e._postProcesses.length>0){var r=this._camera._getFirstPostProcess();r&&r.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},t}();e.PostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c){return void 0===n&&(n=null),void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=!1),t.call(this,i,"pass",null,null,r,n,a,o,s,void 0,l,void 0,null,c)||this}return a(i,t),i}(e.PostProcess);e.PassPostProcess=t}(s||(s={}));o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[__uv.$wrap((i))])Object.prototype.hasOwnProperty.call(t,n)&&(e[__uv.$wrap((n))]=t[__uv.$wrap((n))]);return e}).apply(this,arguments)};!function(e){var t=function(){function t(i,r,n){this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=t.FILTER_NONE,this._filteringQuality=t.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=e.Vector3.Zero(),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._cachedPosition=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=e.Matrix.Identity(),this._mapSize=i,this._light=r,this._scene=r.getScene(),r._shadowGenerator=this;var a=this._scene._getComponent(e.SceneComponentConstants.NAME_SHADOWGENERATOR);a||(a=new e.ShadowGeneratorSceneComponent(this._scene),this._scene._addComponent(a));var o=this._scene.getEngine().getCaps();n?o.textureFloatRender&&o.textureFloatLinearFiltering?this._textureType=e.Engine.TEXTURETYPE_FLOAT:o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?this._textureType=e.Engine.TEXTURETYPE_HALF_FLOAT:this._textureType=e.Engine.TEXTURETYPE_UNSIGNED_INT:o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?this._textureType=e.Engine.TEXTURETYPE_HALF_FLOAT:o.textureFloatRender&&o.textureFloatLinearFiltering?this._textureType=e.Engine.TEXTURETYPE_FLOAT:this._textureType=e.Engine.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(t.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalBias",{get:function(){return this._normalBias},set:function(e){this._normalBias=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurScale",{get:function(){return this._blurScale},set:function(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(e){this._depthScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(e){if(this._light.needCube()){if(e===t.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(e===t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(e===t.FILTER_PCF||e===t.FILTER_PCSS)return void(this.usePoissonSampling=!0)}e!==t.FILTER_PCF&&e!==t.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==e&&(this._filter=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePoissonSampling",{get:function(){return this.filter===t.FILTER_POISSONSAMPLING},set:function(e){(e||this.filter===t.FILTER_POISSONSAMPLING)&&(this.filter=e?t.FILTER_POISSONSAMPLING:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVarianceShadowMap",{get:function(){return e.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),this.useExponentialShadowMap},set:function(t){e.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),this.useExponentialShadowMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBlurVarianceShadowMap",{get:function(){return e.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),this.useBlurExponentialShadowMap},set:function(t){e.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),this.useBlurExponentialShadowMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useExponentialShadowMap",{get:function(){return this.filter===t.FILTER_EXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===t.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=e?t.FILTER_EXPONENTIALSHADOWMAP:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===t.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===t.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=e?t.FILTER_BLUREXPONENTIALSHADOWMAP:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===t.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===t.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?t.FILTER_CLOSEEXPONENTIALSHADOWMAP:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===t.FILTER_PCF},set:function(e){(e||this.filter===t.FILTER_PCF)&&(this.filter=e?t.FILTER_PCF:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(e){this._filteringQuality=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useContactHardeningShadow",{get:function(){return this.filter===t.FILTER_PCSS},set:function(e){(e||this.filter===t.FILTER_PCSS)&&(this.filter=e?t.FILTER_PCSS:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(e){this._contactHardeningLightSizeUVRatio=e},enumerable:!0,configurable:!0}),t.prototype.getDarkness=function(){return this._darkness},t.prototype.setDarkness=function(e){return this._darkness=e>=1?1:e<=0?0:e,this},t.prototype.setTransparencyShadow=function(e){return this._transparencyShadow=e,this},t.prototype.getShadowMap=function(){return this._shadowMap},t.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},t.prototype.addShadowCaster=function(e,t){var i;return void 0===t&&(t=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(e),t&&(i=this._shadowMap.renderList).push.apply(i,e.getChildMeshes()),this):this},t.prototype.removeShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var i=this._shadowMap.renderList.indexOf(e);if(-1!==i&&this._shadowMap.renderList.splice(i,1),t)for(var r=0,n=e.getChildren();r<n.length;r++){var a=n[__uv.$wrap((r))];this.removeShadowCaster(a)}return this},t.prototype.getLight=function(){return this._light},t.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},t.prototype._initializeShadowMap=function(){var i=this,r=this._scene.getEngine();r.webGLVersion>1?(this._shadowMap=new e.RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(e.Engine.LESS,!0)):this._shadowMap=new e.RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add((function(e){i._currentFaceIndex=e,i._filter===t.FILTER_PCF&&r.setColorWrite(!1)})),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add((function(){if(i._filter===t.FILTER_PCF&&r.setColorWrite(!0),i.useBlurExponentialShadowMap||i.useBlurCloseExponentialShadowMap){var e=i.getShadowMapForRendering();e&&i._scene.postProcessManager.directRender(i._blurPostProcesses,e.getInternalTexture(),!0)}}));var n=new e.Color4(0,0,0,0),a=new e.Color4(1,1,1,1);this._shadowMap.onClearObservable.add((function(e){i._filter===t.FILTER_PCF?e.clear(a,!1,!0,!1):i.useExponentialShadowMap||i.useBlurExponentialShadowMap?e.clear(n,!0,!0,!1):e.clear(a,!0,!0,!1)}))},t.prototype._initializeBlurRTTAndPostProcesses=function(){var t=this,i=this._scene.getEngine(),r=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new e.RenderTargetTexture(this._light.name+"_shadowMap2",r,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new e.BlurPostProcess(this._light.name+"KernelBlurX",new e.Vector2(1,0),this.blurKernel,1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._textureType),this._kernelBlurXPostprocess.width=r,this._kernelBlurXPostprocess.height=r,this._kernelBlurXPostprocess.onApplyObservable.add((function(e){e.setTexture("textureSampler",t._shadowMap)})),this._kernelBlurYPostprocess=new e.BlurPostProcess(this._light.name+"KernelBlurY",new e.Vector2(0,1),this.blurKernel,1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===e.Engine.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new e.PostProcess(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add((function(e){e.setFloat2("screenSize",r,r),e.setTexture("textureSampler",t._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},t.prototype._renderForShadowMap=function(e,t,i,r){var n,a=this._scene.getEngine();if(r.length){for(a.setColorWrite(!1),n=0;n<r.length;n++)this._renderSubMeshForShadowMap(r.data[__uv.$wrap((n))]);a.setColorWrite(!0)}for(n=0;n<e.length;n++)this._renderSubMeshForShadowMap(e.data[__uv.$wrap((n))]);for(n=0;n<t.length;n++)this._renderSubMeshForShadowMap(t.data[__uv.$wrap((n))]);if(this._transparencyShadow)for(n=0;n<i.length;n++)this._renderSubMeshForShadowMap(i.data[__uv.$wrap((n))])},t.prototype._renderSubMeshForShadowMap=function(t){var i=this,r=t.getRenderingMesh(),n=this._scene,a=n.getEngine(),o=t.getMaterial();if(o){a.setState(o.backFaceCulling);var s=r._getInstancesRenderList(t._id);if(!s.mustReturn){var l=a.getCaps().instancedArrays&&null!==s.visibleInstances[__uv.$wrap((t._id))]&&void 0!==s.visibleInstances[__uv.$wrap((t._id))];if(this.isReady(t,l)){if(a.enableEffect(this._effect),r._bind(t,this._effect,e.Material.TriangleFillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===e.Light.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),n.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(n.activeCamera),this.getLight().getDepthMinZ(n.activeCamera)+this.getLight().getDepthMaxZ(n.activeCamera)),o&&o.needAlphaTesting()){var c=o.getAlphaTestTexture();c&&(this._effect.setTexture("diffuseSampler",c),this._effect.setMatrix("diffuseMatrix",c.getTextureMatrix()||this._defaultTextureMatrix))}r.useBones&&r.computeBonesUsingShaders&&this._effect.setMatrices("mBones",r.skeleton.getTransformMatrices(r)),e.MaterialHelper.BindMorphTargetParameters(r,this._effect),this.forceBackFacesOnly&&a.setState(!0,0,!1,!0),r._processRendering(t,this._effect,e.Material.TriangleFillMode,s,l,(function(e,t){return i._effect.setMatrix("world",t)})),this.forceBackFacesOnly&&a.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},t.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===t.FILTER_NONE||this.filter===t.FILTER_PCSS?this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE))},t.prototype.forceCompilation=function(e,t){var i=this,r=o({useInstances:!1},t),n=this.getShadowMap();if(n){var a=n.renderList;if(a){for(var s=new Array,l=0,c=a;l<c.length;l++){var u=c[__uv.$wrap((l))];s.push.apply(s,u.subMeshes)}if(0!==s.length){var h=0,d=function(){if(i._scene&&i._scene.getEngine()){for(;i.isReady(s[__uv.$wrap((h))],r.useInstances);)if(++h>=s.length)return void(e&&e(i));setTimeout(d,16)}};d()}else e&&e(this)}else e&&e(this)}else e&&e(this)},t.prototype.forceCompilationAsync=function(e){var t=this;return new Promise((function(i){t.forceCompilation((function(){i()}),e)}))},t.prototype.isReady=function(t,i){var r=[];this._textureType!==e.Engine.TEXTURETYPE_UNSIGNED_INT&&r.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?r.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&r.push("#define DEPTHTEXTURE");var n=[e.VertexBuffer.PositionKind],a=t.getMesh(),o=t.getMaterial();if(this.normalBias&&a.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(n.push(e.VertexBuffer.NormalKind),r.push("#define NORMAL"),a.nonUniformScaling&&r.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===e.Light.LIGHTTYPEID_DIRECTIONALLIGHT&&r.push("#define DIRECTIONINLIGHTDATA")),o&&o.needAlphaTesting()){var s=o.getAlphaTestTexture();s&&(r.push("#define ALPHATEST"),a.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push("#define UV1")),a.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&1===s.coordinatesIndex&&(n.push(e.VertexBuffer.UV2Kind),r.push("#define UV2")))}a.useBones&&a.computeBonesUsingShaders?(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),a.numBoneInfluencers>4&&(n.push(e.VertexBuffer.MatricesIndicesExtraKind),n.push(e.VertexBuffer.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),r.push("#define BonesPerMesh "+(a.skeleton.bones.length+1))):r.push("#define NUM_BONE_INFLUENCERS 0");var l=a.morphTargetManager,c=0;l&&l.numInfluencers>0&&(r.push("#define MORPHTARGETS"),c=l.numInfluencers,r.push("#define NUM_MORPH_INFLUENCERS "+c),e.MaterialHelper.PrepareAttributesForMorphTargets(n,a,{NUM_MORPH_INFLUENCERS:c})),i&&(r.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"));var u=r.join("\n");return this._cachedDefines!==u&&(this._cachedDefines=u,this._effect=this._scene.getEngine().createEffect("shadowMap",n,["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences"],["diffuseSampler"],u,void 0,void 0,void 0,{maxSimultaneousMorphTargets:c})),!!this._effect.isReady()&&((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())))},t.prototype.prepareDefines=function(e,i){var r=this._scene,n=this._light;r.shadowsEnabled&&n.shadowEnabled&&(e[__uv.$wrap(("SHADOW"+i))]=!0,this.useContactHardeningShadow&&(e[__uv.$wrap(("SHADOWPCSS"+i))]=!0,this._filteringQuality===t.QUALITY_LOW?e[__uv.$wrap(("SHADOWLOWQUALITY"+i))]=!0:this._filteringQuality===t.QUALITY_MEDIUM&&(e[__uv.$wrap(("SHADOWMEDIUMQUALITY"+i))]=!0)),this.usePercentageCloserFiltering?(e[__uv.$wrap(("SHADOWPCF"+i))]=!0,this._filteringQuality===t.QUALITY_LOW?e[__uv.$wrap(("SHADOWLOWQUALITY"+i))]=!0:this._filteringQuality===t.QUALITY_MEDIUM&&(e[__uv.$wrap(("SHADOWMEDIUMQUALITY"+i))]=!0)):this.usePoissonSampling?e[__uv.$wrap(("SHADOWPOISSON"+i))]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?e[__uv.$wrap(("SHADOWESM"+i))]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(e[__uv.$wrap(("SHADOWCLOSEESM"+i))]=!0),n.needCube()&&(e[__uv.$wrap(("SHADOWCUBE"+i))]=!0))},t.prototype.bindShadowLight=function(e,i){var r=this._light,n=this._scene;if(n.shadowsEnabled&&r.shadowEnabled){var a=n.activeCamera;if(a){var o=this.getShadowMap();o&&(r.needCube()||i.setMatrix("lightMatrix"+e,this.getTransformMatrix()),this._filter===t.FILTER_PCF?(i.setDepthStencilTexture("shadowSampler"+e,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),o.getSize().width,1/o.getSize().width,this.frustumEdgeFalloff,e)):this._filter===t.FILTER_PCSS?(i.setDepthStencilTexture("shadowSampler"+e,this.getShadowMapForRendering()),i.setTexture("depthSampler"+e,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/o.getSize().width,this._contactHardeningLightSizeUVRatio*o.getSize().width,this.frustumEdgeFalloff,e)):(i.setTexture("shadowSampler"+e,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/o.getSize().width,this.depthScale,this.frustumEdgeFalloff,e)),r._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(a),this.getLight().getDepthMinZ(a)+this.getLight().getDepthMaxZ(a),e))}}},t.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=t.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var i=this._light.position;if(this._light.computeTransformedInformation()&&(i=this._light.transformedPosition),e.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(e.Vector3.Dot(this._lightDirection,e.Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!i.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(i),this._cachedDirection.copyFrom(this._lightDirection),e.Matrix.LookAtLHToRef(i,i.add(this._lightDirection),e.Vector3.Up(),this._viewMatrix);var r=this.getShadowMap();if(r){var n=r.renderList;n&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,n)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},t.prototype.recreateShadowMap=function(){var e=this._shadowMap;if(e){var t=e.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=t}},t.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},t.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},t.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},t.prototype.serialize=function(){var e={},t=this.getShadowMap();if(!t)return e;if(e.lightId=this._light.id,e.mapSize=t.getRenderSize(),e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.forceBackFacesOnly=this.forceBackFacesOnly,e.depthScale=this.depthScale,e.darkness=this.getDarkness(),e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.filteringQuality=this.filteringQuality,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.renderList=[],t.renderList)for(var i=0;i<t.renderList.length;i++){var r=t.renderList[__uv.$wrap((i))];e.renderList.push(r.id)}return e},t.Parse=function(e,i){for(var r=i.getLightByID(e.lightId),n=new t(e.mapSize,r),a=n.getShadowMap(),o=0;o<e.renderList.length;o++){i.getMeshesByID(e.renderList[__uv.$wrap((o))]).forEach((function(e){a&&(a.renderList||(a.renderList=[]),a.renderList.push(e))}))}return e.usePoissonSampling?n.usePoissonSampling=!0:e.useExponentialShadowMap?n.useExponentialShadowMap=!0:e.useBlurExponentialShadowMap?n.useBlurExponentialShadowMap=!0:e.useCloseExponentialShadowMap?n.useCloseExponentialShadowMap=!0:e.useBlurCloseExponentialShadowMap?n.useBlurCloseExponentialShadowMap=!0:e.usePercentageCloserFiltering?n.usePercentageCloserFiltering=!0:e.useContactHardeningShadow&&(n.useContactHardeningShadow=!0),e.filteringQuality&&(n.filteringQuality=e.filteringQuality),e.contactHardeningLightSizeUVRatio?n.contactHardeningLightSizeUVRatio=e.contactHardeningLightSizeUVRatio:e.useVarianceShadowMap?n.useExponentialShadowMap=!0:e.useBlurVarianceShadowMap&&(n.useBlurExponentialShadowMap=!0),e.depthScale&&(n.depthScale=e.depthScale),e.blurScale&&(n.blurScale=e.blurScale),e.blurBoxOffset&&(n.blurBoxOffset=e.blurBoxOffset),e.useKernelBlur&&(n.useKernelBlur=e.useKernelBlur),e.blurKernel&&(n.blurKernel=e.blurKernel),void 0!==e.bias&&(n.bias=e.bias),void 0!==e.normalBias&&(n.normalBias=e.normalBias),void 0!==e.frustumEdgeFalloff&&(n.frustumEdgeFalloff=e.frustumEdgeFalloff),e.darkness&&n.setDarkness(e.darkness),e.transparencyShadow&&n.setTransparencyShadow(!0),n.forceBackFacesOnly=e.forceBackFacesOnly,n},t.FILTER_NONE=0,t.FILTER_EXPONENTIALSHADOWMAP=1,t.FILTER_POISSONSAMPLING=2,t.FILTER_BLUREXPONENTIALSHADOWMAP=3,t.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,t.FILTER_PCF=6,t.FILTER_PCSS=7,t.QUALITY_HIGH=0,t.QUALITY_MEDIUM=1,t.QUALITY_LOW=2,t}();e.ShadowGenerator=t}(s||(s={})),function(e){e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_SHADOWGENERATOR,(function(t,i,r,n){if(void 0!==t.shadowGenerators&&null!==t.shadowGenerators)for(var a=0,o=t.shadowGenerators.length;a<o;a++){var s=t.shadowGenerators[__uv.$wrap((a))];e.ShadowGenerator.Parse(s,i)}}));var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_SHADOWGENERATOR,this.scene=t}return t.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},t.prototype.rebuild=function(){},t.prototype.serialize=function(e){e.shadowGenerators=[];for(var t=0,i=this.scene.lights;t<i.length;t++){var r=i[__uv.$wrap((t))].getShadowGenerator();r&&e.shadowGenerators.push(r.serialize())}},t.prototype.addFromContainer=function(e){},t.prototype.removeFromContainer=function(e){},t.prototype.dispose=function(){},t.prototype._gatherRenderTargets=function(e){var t=this.scene;if(this.scene.shadowsEnabled)for(var i=0;i<t.lights.length;i++){var r=t.lights[__uv.$wrap((i))],n=r.getShadowGenerator();if(r.isEnabled()&&r.shadowEnabled&&n){var a=n.getShadowMap();-1!==t.textures.indexOf(a)&&e.push(a)}}},t}();e.ShadowGeneratorSceneComponent=t}(s||(s={})),function(e){var t=function(){function e(e,t,i){void 0===t&&(t=""),void 0===i&&(i="black");var r=this;this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=i,this._resizeLoadingUI=function(){var e=r._renderingCanvas.getBoundingClientRect(),t=window.getComputedStyle(r._renderingCanvas).position;r._loadingDiv&&(r._loadingDiv.style.position="fixed"===t?"fixed":"absolute",r._loadingDiv.style.left=e.left+"px",r._loadingDiv.style.__uv$setSource(__uv).__uv$top=e.__uv$setSource(__uv).__uv$top+"px",r._loadingDiv.style.width=e.width+"px",r._loadingDiv.style.height=e.height+"px")}}return e.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.__uv$setSource(__uv).__uv$top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var e=document.createElement("style");e.type="text/css";e.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[__uv.$wrap((0))].appendChild(e);var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAYq0lEQVR4Xu2dCZRcVZnHScAJUZSwjSOIbAJmEAZwQCCMoAInYRGIg8AwegQx7AFzUBBmzAFlE4EAwxz2GRk2w7AnAURZBiEOZgyEQDAQAjmEJqTpNd3V1V3Vmd+/6utKV7/1vnpVXd2p/zn3vOV+27vfu/fd/W3QQAPrBZqbm7fJZrN79vf3T+/r67uf4wO9vb37WXQDIwWtra0Tenp6voQTv5XP56/BkfcR3iLk1g6B7hEeI+zP5V+ZiAbqBZ2dnZ8lV+6Gg87CobfhpOc4byf0FjwYE9DneBkWcXrM2tmzNzTxDdQKJPyETCazI46YgiMuI9zJuXJltuChFIHsP/PSfIfTjU19A2mira1tcxy3ey6XO5vEnkV4kes11XBmENDVj97XOT2O03FmWgMuoNLzGRJva8IUnPkzjjcT/kLoKCZzfQB7XiX8M2G8md7AUJgzJ+Z6e88gZ1xGuj3HsY17PcVkrG9gp7CUF/F8PUvxqdZDrFq1ahNVfKjwTCYxZuDE2wjKlc2WViMePM+HPNsFPOdf22OPblD5OZQHvphnV65cjTMzxaQY3eA5V9OO/hmnm1lSjE7woFsQbiXki4++foHnXkW4mLC1JUl947333tsMY3emqfB9jtPJlXN5U0+bOXPmWCPxgOccSy4+AfqPio+9/oFnbyatbqVE28GSZfjQ1NT0KQzaHMcdyPfyaNoE12HcvdxT29K3Fkv8A2vWrPmcifAFZNtD91yRY+SBZ+9UsMtEgD+jTpeenp6JXI6xpKkuUDqRcA6Kr0Wpens+InQTnIpV6Fdi+BQT64ulS5eOIzefD62na7CeoGcnLCM8ykt5OWlzcPv772/BS/w3nP+K+xU11+DvQe5dcrQlTfWAwbNMb8XA8AyGX80xtLlA6TAJuteMbVhhia1v5VMcr+LWMeoZ4xiYw7q6urbhHbgG+paCkIRQehHu4pO3O5fVydEomF5Ulx548JfVD2wqfKE2I3R3ob/f2GoC1DWhdz7HG3i5j2pvb9+Z24m6HvVZQtYsZFWcowlzePEP4jJdR/OQhxTVpAs9NMXxmZxuZKo8IG4s+v8R2tUFphSBTBWzH+OAFwn/gS3TuN55xYoVqfc6dXd3fwHZ1xFaTX0iyGbwjJqXXAammxP00EXx6UMGEx7ram7+vKnzBZ/87Xiwp40tEdDTgYwlHG/CmadSjO7L+XiialOZAej7POFG2VK0Khngl6Pn8/LL0YEtlFh4n8oDAqvaAYH8tzH2iNDm1IIFn8Ax50G7xtgCAU07CfAG4RHOz+vLZL7e0dGxlYlKHaj8BHo25xgrsfV5wrYH4KmouxV+ZZDnCUdwmXxMGgFvFUVWD+jQuOot6rI0tb4gcfaG9v+MrcAn+wj38gL8C7cObmlp2ZRjOkWYD6ypuAf6zjFHLSJ0c/6YQ813DM/yZXgehreiVgP8cvSfsOeExYsXuzs6n8v9j8mqBRZQmdjXVPuira1NHSpn8UDf4Xu0vd2uCtDzacJOlDDf5ng94X8JTWarB8R1EK7ju7udiYgEz/v3pLFKm4oHUHhh3iZdfshpaEYpA4pvKLLXBujLYKRq71XLhUHg27z12rW9B6L/QhLrWWxRH7nzeDK8awi/5HRTEx0K6MZQ694LHk0DqrgfADkreIYz1q5c+UlTEQzesIuMryrggYQWjNL3RGO7p2tuFMeqjaOidgzyCz1yJMTJ6L6d66WEVCcHIO/dQkI75Chs2g97Hoc3jRz9Lge1ED5l4r0gckqRPB0gTw34t1B+h3IqxZkmrn2SULUa7ezZszdE5xfR9130Xsm5ilrnHrmkQOcKvrkncxqrIiY6wlewbw7BOUfDo/b84zzvj9C7J7eCS0NrUiRKCPjUE7ScMBdlF/B2HqBi0ERXBcuXL99YnQz9fX2ah3Up4UnsWGEmDRuUhoTn+Z5PfvbZZ2N/fuCZRJgnfhNVBu73EZoIKt7l0L2UBsYeDZg016nb5EUCWuXQewinUtTuyq2aTStF14a8SD+VDQVj6hDYxjuXf4Hjl83sSMCmTp8j4FtoMuRQ5dAZcii3kk/0s2bBhxIcBxjxUlib1hWInEDO/6qKV+y4geO5HAMntEE/pq+nZyo0ywsG1SmwL4Orf+0yqGCfmvR73LAn9lAeBjQTEhkA+1h49a08iRflcq4H5iuXFU9cz4lqihC/LXS/NZa6Bc+pz5gql5ub6VXD2tZWTSPeyS7XgeLhXrMnEhj6MSHSwaIhFGZH8oA/JzzFeexvJbRN2HW03moT6cEChx6w4QY2rurn85JWrxsiCy0FwjcIqos8w7GZNPulkawDEbFHlaBtjzODEDrVztuKXMmADPWA3RaljyJeNdKq98ilAez8iJdyGqfO31V4NoV/EvyaCqR54V2EshE5Lqcb+TrkstkTLD4WKB4PNNZQ8P05HAelMXNSPWChC8JsYvwthJo0jSoF6fIqjjqe08Aat+LIkd+AVjn09zxbZFqK3tjXAUbXUaWDjTUSyN4J45YZX2Igo4cEOVfFson2ALIxSjR0jog5YNgpfNHM90BxIjDyWIB8Z2NfB01HISJ20wPaw4w1FlavXq1v8aPGXhFw9JNRFTDItifU/RwwpfmKxYsDK180kU4x0lhAXvOSJUs+bezlIDL2N4xi4GpjK4MGCuzUA+SPxzn3m4iKgKyV2DCV08DeMWg0B+zHHOt2DpjS3Mz1BfFOM25C5ZH4LxldJBB0g7GVARkaXgv8VsKqZtIMPpN9RUnJgRzU5Wfp22vifcG3+2vQvmdsdQXsX2pm+oKX+GYjjQXkPWqsXshpRhcJ0RpbGShSHiSuheP37ZYHsGusVHOrU1lMxkO9od4eE+8LlSzQqfetpnPAooBN/2Um+gISp89MkF8K4G3RrMJYoOhbYGxlQEGhSOGogfoLwipExGtUZVVBYIVAluaAaUpuWA+YujlPF22Ra/iBLYEOsV6tV4w0FiitfmLsXiBMU0NiAVrfsp77Zd8MHPgbDoHtva6uLs1jiv1piAKy5tCG+4KJ9wVO/p6RDzvy+b5rzSwP9Okh/WKPERiCWzfk4K8bUSTiOljAyCdx5DZG4gE8W5Dov+NYUfsV/j50fUC4dmXIQDh0qQ6PVgJsOcLM8oA410Ggvo6Ojr81di+g2TKuQOiyJOKWxlpCJpM5zUjKAL3awTsamQfEbYhjtDGKa5tPsyn/wAuiURftlBO56h6aunEwCMxxvV1d+2Fr7Jce2vAu5LUtLeoGi/19gtbToCaR97BoD6BvUs+WkXqgbw6OuhC6wH5l4rRGaCFOvYnjYbyxnpcsCvDVhYOxo6+zszNwSNHVTtJEmSiwzlMAQmNPwIPW42Dds2hfEK/5WJo0Fth+5VNxFHSlkoTzFRh/N3wnq0OGWxXtdoO8enFwaI4jsyidYgNZTxhrMEjEJ4w+En65ESWRXZ7Q4K/COqDAPlhka87WedB8KawmngTIHREOJs5pMiRp+p/GGgxL1FiA9hxjK6G1tVVdhJGAV15+cPXq1f7dahVC20Wg4miCp0uTe3Xh4Hwu93rY1B7SR/t7xQbP5R1FGgpy8IlKe+MJhZ9Aa7u5jPm+pGLX2BMDOZ+hDXgQiXIJ5xoXHZg96anEEFcvOTi0SMUXS4w0FijSTzTWYEA3hkTSEtDI2qw6RoytDLA6jctCvzKqJ8oPFOO7kAhnYe9cZGiWiZ/N9ezguWaSL4h3TUfvKJIfoN0I4sjigYSdZyxlcDVMgEczEY41ER6oZFBOh2Yqegf2zYoziFC3DuZZrjSTPLDtMlxaNPmPP/54W2OPxksrVozP5fLPGr8vEOpbxJCr3jQSJyDvGRNRhv7iHh8vE5LMpKznHBz4zSTOaXwe+mXGGh9tbWvVQf+iyfCAON/ZlTj4v43ECfB94Le4CuMrWVpTtw7O9fZOM5M8oD7xVSOLBdLuNWN1g7bgJUF8+4qpBjf7Te9M6hD4tBDc0289Wh2MHbuaSR7gsHOMLBaQ9W/G6o5MJrNDPu9dcYdQ33Yc95I6OFV5hnp2cGCliDingX5KU+9MShd0dmqta/k8J4zwnV2JsuuNxAnI83VwNpO52kiSoC4djA255cuXBzYPycGzjTQWkPdNY00OfRcQVLafRnd39ySLLsG1i20AyPZ3cDb7AyNJgnp1cOhUHUhcFiL045v9jTUa8Gjlm29fsQQhb3DzJLUEhC+oiK7EISPOwapoEh+7JQJti5YfGXs0YNC62ouC1h9lsrlToClsjc/RM7uSe0kd3EmlzTO/Kqk8Q106mM/Yw2aOB9jnOg6sWTHxJ9FraSJMy6nGz7RbZUDYmN7e3BnQ5Gisez7u3J9c0JwA6Pb0aCFvNObgwKk6NoU59uJwaJ8y1viAT4vCtEFXYO8SFQGtCZpllyXQtNqL+4lmZ/BN/5qJKQFZozEHe9JtAGSaw4wsFnie4JmUQcjleh8yZq0Fnmq3y0D02IzPMgnonYqYIfA4pC+TcXrgIahLB+PEb5s5HrjaR0b7kbHGB0pK7TDO1/T39x1lUZGAPlUH0xTbz+KSoC4dDDx2DQCHzTCaWOB5zjbW+KCSpW0IS0BIJmy6zWCk7WDuxZ4r5oO6dHB7e/sBZo4H2OfUsYOv9jHW+ECJdkAtA/c6MpmMd+XaEKj7km9M4F5TEfBzSKovDLKG1cHobw+b6EDa3WOksYBPAhevBUJMxl8GJTRhFyMLBKSJFn5ls9nvmogS0DfaHOzb3h8AcUuNNBLQNiWa0gRv4MwMMyBwCqxAfCIH82JdYSJKQN+ocjA5NHD2I/e1aj/23iPyhbG6A+bAgXsZoUEII/UAkkQORu71JqIE7o22HBw4VaelpWU74mPPDc/39d1trO5Qb4vJ8QXxbwat06WofcTInMCzeToAtN4VXUn/l1AXDkan9tDSfmL6C81BZooHxDkN9CMveLFZFFAWWZtDwVta3G0sJcAbe3bmYEiniShBXabcL+wflQDD5mD0yKlvk0b/Tk33AG5F7idG+/ibRe54oEl1nLG6A+ZYe1jyAIuG/u2LB3MazxwAfL5vJFGJinxQUwcju6c/n3+FNPm5JhJyy2k/sQTp5nm+2HBJCGi1X1WpwzuBoQXAN+IcjDz8mdePKi/WhH1uxd7GcCjIVBcWpUYDfZ0VbclEJSr2akMBhVrdX6j+Jx3DpSh7vKB8CIiqKwcrcXGqdr05k3RKbU9ryTQVkUB3aHMrEshw7kGCXiv8xxG0h6Uzent6Fpn6MhA17A6GT/3yTxNO1coJbgWur3JFf1fXNuTes5AZe18xXobFHJKv04JZc3O7CtIcgGL9KW03u3QCfL4D4b292dhrpoYgsYOhEz4kaOuHqXKqiagYiN9QnUlyKgX84JUYsQFP9GKzMFRSe8XJb9upE9Dn62CK/KQT75wdTLz+NXgPNdrDuYzeUd0ByN4Wp07n+EdCRZuTY1/ymZQDwIjQye9pA32xdw6IiUgHc639mN8kzCLRjkxzQRzitUpkZ8LZBP1CILUd55EVvdgsCrzJl5i8mgCja+Zgjst4Pq3DUnMmtSWqyNIuQruRU3+CbO08n+pvBAZAjf1IU5kcGJc0YRMBfVV3MPd2RN4+YbvYukI/3sSpe+LUmbw0ryG/6ts1oSLeYrMw6C0xeaFAGc+Wq3hbfeRk582b55lrzf3UHJwWkD0Wp+6BQ3+BfXEXw6UCdHX4TVB0BoJi9Y1Cp59XbUWN8HW7lRjLli3zbINE+1hNiCRI1cGakIhT99ani/A6z1z1nDoUqNQfbO40kyqDfrCBwMg3E5rsCy+8sFlHR8dEnFzRTq/I8hQ9NFFOtGhXVOxgFeUqfknUK7Ctpjl1ANKJ/vmUkvrdwRZmWjpA4J9MTyja2toKY8TQa/ufxP/Whdd5c5cQJHIwfBsTvkKiaqd6/fRyOHKqavdL0H+V2sxmWvrQCAeKItfmQlNyDG/8SVwnetMHyxmA7lm0K2I7GFrlVBW/V6FPP9GqeU4V0Kt2+O2yhctUN6AJBEWD9ngMnessJxh5AfCoQe+8q+xQOYLuWbQrQh2MXP1XYh8S9DKC2sI1z6kCatW3/RCZ6Vj9fNPMqx2wQVNJQlcNEl/mGG5pv48bi7HxMVSOoHsW7QqPg5GlvnJtk6/B9+HMqYUfaXE6rampqWy4dVhgi8FfLprnBXEex+i/wCSkNiSNDSpUxxt7Ccj2nQQYAwUHc9yE3HEotuifDklnfFYMdGNC/lWCxotDf4PvB/jHZTs71c+f2n+ryqCPPcb5/pKdGrTvbH2MUjH4ByOLBDpON9YSFi5cuI1FOwFbbyTox5T6y+iwFL8CqvWvwVtolWgSv/N4sXbl5ZP3r8hRLT50d56KgYJDCYXVhYOhtqqReKDdZuGJtSQSOk8f67x581SspvH3lpoBe9Vefbg/lzveaXmnAf6tEDMNGRp3LnV3ch29o10lQIf+bOKZc+XnmMGARF2EK4vUwQiSw33n7ZlqDWwcaK9Ob29vd26vwj+OT8m3kKFxdd9tlILSJ1Wo8Y8RZT/YiKOY4le5P3SGZJAc7telg7FroL16Jc/n/a1cBBCxsSblwT8LOfofcCh4AQ4x1uoCXZtgVKnYDXLMUECnPSQD29VBcrhfVw7GHrVXb6WylGg0SvUZcrr+YPYuwWVfaE9ltmpA2Q6EQq2UY+yigzf2oqCH4v4MIysD94fdwdig9uqDnB4T5/d+gwHPGNVFcOopyJiPLOfmGTwa0Ek8qS8RKDKORLFWH95utwbDd94SRqqN/Cv4PDXbTFfXfUZWBvRUPJCRBJiIqfnnccy0Dz74wHkWoypY2D4ZGU8gK+kKjQKQ8RcTW1uQI2fmc7nH7LIMFEW+sw6xdyN4CgvNByNIDjp+ZyRVhzlV7dVLaZc7t1cRoW0w9of/No6ptbuRdZupqC3QPZY33HchMkbJiRPssgyaHkN82XaJXPtOJuN+JRuixQI6Cu1VXiZtJehcFGpeNPyXI6cqPWTIvsxU1R7o912akevre4OHfTHot3fEfRbD3y8+Qu0djO5Ce5UXNGl7dTt4z0RGqnOuhgLZgmcPk2FHrrd3jgwkAVQ58e1ioxjcHeMLPWQcq+5gZKm9+hJHjXo5z4xQBQsxxyDjEfir+nNq5GfQo/nYh6f9e4NUgGEFx3DEzvw1nPrOhSJ+kh6GUBUHw6//Kmls96dJ2qv6FxNF9z8g405kVLVXDfkaiFAd4JIkttYUGFpyDOf91Ch/YVEe8DA/gORpuywDfLNMjBOQt4qEupbTPTX4YeJig+/qrnoxkfMeIdH2UHGBfP0H6kFepElc1rY5lBQYXZbzuO7BWYH7b3V3d/+TX1FEG/JSExEJdOi7qsnrx3DuNM8Zdg2NqnN/BjK0EXlVhxORr56wP6Lv/DT+X1FzYLynaOWe2s1TjCQW4An9t6Jk4hBVdH6YpB9YNXoS+SRk/JaQZHd5J2CnesLuyGaze3KZ2hTemoNcpO+uB3pAQuzvC7SeJSfc0258Wo97aX9PT+TmMEMB73jsO0wJzXnVx4llL7pe5kWaFtSqGHHgu6rpPr5jsdx+hyI59G+hA4C25GDO1V69mbf/77h0+lZpzZX44B+Ye1X1cWKz92pKrYlcjtzc6gfN+ufhApd/ErcwTvuTRNI0m4c4Tg77u6gfbCHdTuQcrRFaRKiFU7Xl1O/RqX9RObevRxR43gmEBYUn9wEJIMeF/jk0yVKTta2tE0jg43kx1OatWifEYKDrHYKGDnfkMrU1xHUPaoh7k8i+030EvoV3c6i4aTCoc/9+9NVkFgh6BmZFaig08he3oxYkwBEkQGCzg7gfG6kzaDvuSyLfgIyqt1cF6SAspoS4iJf3c9xaf3JrGEgUzZcOGgvO4agzjTQUkI9V5z4851MuLhBvUUp1gR7tjXEHL+shXFZnduNIBomi6T73FVLLByQePu4N3CxMbVxyzfeQUTYZrdpA3yvoPVf/1jdTGggC6aXx0ieLSecFcWoj72vkhU4IcswU7gVORksb6FHnufbouJ4Xbv+gf1g0EADav9uSeO9YenpA3IfURFVZ0gqEms1rRg0qCzM4TuYy1T061jt0dXXpX0xJ96FMDXIqQXtJ3tSfze6OaY0KU1ogfTUgUJMK0lBIL06dS/F/LJeRe0k2kAAk7BgSWN2GVW/aCOjRuPCbBHVGBG6J3ECKIN3VlfjroguqA+RrMsFvCNqisf5mRox2qPlB4s8vuiMdIE/fVjVvLlRnhKlqYLig7QIpOiva40PAqR2E22neJFrN10AVgWMOIDgPuMOjmRFa+HVaR0fHliaugXoEOe80nBWrZg2dZkZoYffuaW5u1kCVkadmbT70AGdqJodWOhxHqP2eFg1UDvsLatnSFq41M+KKnp6eXbhsdB2OdGiCeX8+/2ecqgnmk/VXNYtqYLSAnNposzpjgw3+H/belpVa8J7TAAAAAElFTkSuQmCC",t.style.position="absolute",t.style.left="50%",t.style.__uv$setSource(__uv).__uv$top="50%",t.style.marginLeft="-60px",t.style.marginTop="-60px",t.style.animation="spin1 2s infinite ease-in-out",t.style.webkitAnimation="spin1 2s infinite ease-in-out",t.style.transformOrigin="50% 50%",t.style.webkitTransformOrigin="50% 50%",this._loadingDiv.appendChild(t),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},e.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",(function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener("resize",e._resizeLoadingUI),e._loadingDiv=null)}))}},Object.defineProperty(e.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(e){this._loadingText=e,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),e}();e.DefaultLoadingScreen=t}(s||(s={})),function(e){var t=function(){function e(e,t,i){this.lengthComputable=e,this.loaded=t,this.total=i}return e.FromProgressEvent=function(t){return new e(t.lengthComputable,t.loaded,t.total)},e}();e.SceneLoaderProgressEvent=t;var i=function(){function i(){}return Object.defineProperty(i,"ForceFullSceneLoadingForIncremental",{get:function(){return i._ForceFullSceneLoadingForIncremental},set:function(e){i._ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ShowLoadingScreen",{get:function(){return i._ShowLoadingScreen},set:function(e){i._ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(i,"loggingLevel",{get:function(){return i._loggingLevel},set:function(e){i._loggingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(i,"CleanBoneMatrixWeights",{get:function(){return i._CleanBoneMatrixWeights},set:function(e){i._CleanBoneMatrixWeights=e},enumerable:!0,configurable:!0}),i._getDefaultPlugin=function(){return i._registeredPlugins[__uv.$wrap((".babylon"))]},i._getPluginForExtension=function(t){var r=i._registeredPlugins[__uv.$wrap((t))];return r||(e.Tools.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),i._getDefaultPlugin())},i._getPluginForDirectLoad=function(e){for(var t in i._registeredPlugins){var r=i._registeredPlugins[__uv.$wrap((t))].plugin;if(r.canDirectLoad&&r.canDirectLoad(e))return i._registeredPlugins[__uv.$wrap((t))]}return i._getDefaultPlugin()},i._getPluginForFilename=function(e){var t=e.indexOf("?");-1!==t&&(e=e.substring(0,t));var r=e.lastIndexOf("."),n=e.substring(r,e.length).toLowerCase();return i._getPluginForExtension(n)},i._getDirectLoad=function(e){return"data:"===e.substr(0,5)?e.substr(5):null},i._loadData=function(r,n,a,o,s,l,c){var u,h=i._getDirectLoad(r.name),d=c?i._getPluginForExtension(c):h?i._getPluginForDirectLoad(r.name):i._getPluginForFilename(r.name);u=d.plugin.createPlugin?d.plugin.createPlugin():d.plugin;var p,m=d.isBinary;i.OnPluginActivatedObservable.notifyObservers(u);var _=function(e,t){n.isDisposed?s("Scene has been disposed"):(n.database=p,a(u,e,t))},f=null,g=!1,y=u.onDisposeObservable;y&&y.add((function(){g=!0,f&&(f.abort(),f=null),l()}));var v=function(){g||(f=e.Tools.LoadFile(r.url,_,o?function(e){o(t.FromProgressEvent(e))}:void 0,p,m,(function(e,t){s("Failed to load scene."+(t?" "+t.message:""),t)})))};if(h)return _(h),u;if(-1===r.rootUrl.indexOf("file:")){var b=n.getEngine(),x=b.enableOfflineSupport;if(x){for(var S=!1,T=0,E=n.disableOfflineSupportExceptionRules;T<E.length;T++){if(E[__uv.$wrap((T))].test(r.url)){S=!0;break}}x=!S}x?p=new e.Database(r.url,v,b.disableManifestCheck):v()}else{var P=e.FilesInput.FilesToLoad[__uv.$wrap((r.name.toLowerCase()))];P?f=e.Tools.ReadFile(P,_,o,m):s("Unable to find file named "+r.name)}return u},i._getFileInfo=function(t,i){var r,n;if(i){if("/"===i.substr(0,1))return e.Tools.Error("Wrong sceneFilename parameter"),null;r=t+i,n=i}else r=t,n=e.Tools.GetFilename(t),t=e.Tools.GetFolderPath(t);return{url:r,rootUrl:t,name:n}},i.GetPluginForExtension=function(e){return i._getPluginForExtension(e).plugin},i.IsPluginForExtensionAvailable=function(e){return!!i._registeredPlugins[__uv.$wrap((e))]},i.RegisterPlugin=function(e){if("string"==typeof e.extensions){var t=e.extensions;i._registeredPlugins[__uv.$wrap((t.toLowerCase()))]={plugin:e,isBinary:!1}}else{var r=e.extensions;Object.keys(r).forEach((function(t){i._registeredPlugins[__uv.$wrap((t.toLowerCase()))]={plugin:e,isBinary:r[__uv.$wrap((t))].isBinary}}))}},i.ImportMesh=function(t,r,n,a,o,s,l,c){if(void 0===n&&(n=""),void 0===a&&(a=e.Engine.LastCreatedScene),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=null),!a)return e.Tools.Error("No scene available to import mesh to"),null;var u=i._getFileInfo(r,n);if(!u)return null;var h={};a._addPendingData(h);var d=function(){a._removePendingData(h)},p=function(t,i){var r="Unable to import meshes from "+u.url+": "+t;l?l(a,r,i):e.Tools.Error(r),d()},m=s?function(e){try{s(e)}catch(e){p("Error in onProgress callback",e)}}:void 0,_=function(e,t,i,r){if(a.importedMeshesFiles.push(u.url),o)try{o(e,t,i,r)}catch(e){p("Error in onSuccess callback",e)}a._removePendingData(h)};return i._loadData(u,a,(function(e,i,r){if(e.rewriteRootURL&&(u.rootUrl=e.rewriteRootURL(u.rootUrl,r)),e.importMesh){var n=e,o=new Array,s=new Array,l=new Array;if(!n.importMesh(t,a,i,u.rootUrl,o,s,l,p))return;a.loadingPluginName=e.name,_(o,s,l,[])}else{e.importMeshAsync(t,a,i,u.rootUrl,m,u.name).then((function(t){a.loadingPluginName=e.name,_(t.meshes,t.particleSystems,t.skeletons,t.animationGroups)})).catch((function(e){p(e.message,e)}))}}),m,p,d,c)},i.ImportMeshAsync=function(t,r,n,a,o,s){return void 0===n&&(n=""),void 0===a&&(a=e.Engine.LastCreatedScene),void 0===o&&(o=null),void 0===s&&(s=null),new Promise((function(e,l){i.ImportMesh(t,r,n,a,(function(t,i,r,n){e({meshes:t,particleSystems:i,skeletons:r,animationGroups:n})}),o,(function(e,t,i){l(i||new Error(t))}),s)}))},i.Load=function(t,r,n,a,o,s,l){return void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null),i.Append(t,r,new e.Scene(n),a,o,s,l)},i.LoadAsync=function(e,t,r,n,a){return void 0===n&&(n=null),void 0===a&&(a=null),new Promise((function(o,s){i.Load(e,t,r,(function(e){o(e)}),n,(function(e,t,i){s(i||new Error(t))}),a)}))},i.Append=function(t,r,n,a,o,s,l){if(void 0===r&&(r=""),void 0===n&&(n=e.Engine.LastCreatedScene),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null),!n)return e.Tools.Error("No scene available to append to"),null;var c=i._getFileInfo(t,r);if(!c)return null;i.ShowLoadingScreen&&n.getEngine().displayLoadingUI();var u={};n._addPendingData(u);var h=function(){n._removePendingData(u),n.getEngine().hideLoadingUI()},d=function(t,i){var r="Unable to load from "+c.url+(t?": "+t:"");s?s(n,r,i):e.Tools.Error(r),h()},p=o?function(e){try{o(e)}catch(e){d("Error in onProgress callback",e)}}:void 0,m=function(){if(a)try{a(n)}catch(e){d("Error in onSuccess callback",e)}n._removePendingData(u)};return i._loadData(c,n,(function(e,t,r){if(e.load){if(!e.load(n,t,c.rootUrl,d))return;n.loadingPluginName=e.name,m()}else{e.loadAsync(n,t,c.rootUrl,p,c.name).then((function(){n.loadingPluginName=e.name,m()})).catch((function(e){d(e.message,e)}))}i.ShowLoadingScreen&&n.executeWhenReady((function(){n.getEngine().hideLoadingUI()}))}),p,d,h,l)},i.AppendAsync=function(t,r,n,a,o){return void 0===r&&(r=""),void 0===n&&(n=e.Engine.LastCreatedScene),void 0===a&&(a=null),void 0===o&&(o=null),new Promise((function(e,s){i.Append(t,r,n,(function(t){e(t)}),a,(function(e,t,i){s(i||new Error(t))}),o)}))},i.LoadAssetContainer=function(t,r,n,a,o,s,l){if(void 0===r&&(r=""),void 0===n&&(n=e.Engine.LastCreatedScene),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null),!n)return e.Tools.Error("No scene available to load asset container to"),null;var c=i._getFileInfo(t,r);if(!c)return null;var u={};n._addPendingData(u);var h=function(){n._removePendingData(u)},d=function(t,i){var r="Unable to load assets from "+c.url+(t?": "+t:"");s?s(n,r,i):e.Tools.Error(r),h()},p=o?function(e){try{o(e)}catch(e){d("Error in onProgress callback",e)}}:void 0,m=function(e){if(a)try{a(e)}catch(e){d("Error in onSuccess callback",e)}n._removePendingData(u)};return i._loadData(c,n,(function(e,t,r){if(e.loadAssetContainer){var a=e.loadAssetContainer(n,t,c.rootUrl,d);if(!a)return;n.loadingPluginName=e.name,m(a)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(n,t,c.rootUrl,p,c.name).then((function(t){n.loadingPluginName=e.name,m(t)})).catch((function(e){d(e.message,e)}))}else d("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");i.ShowLoadingScreen&&n.executeWhenReady((function(){n.getEngine().hideLoadingUI()}))}),p,d,h,l)},i.LoadAssetContainerAsync=function(t,r,n,a,o){return void 0===r&&(r=""),void 0===n&&(n=e.Engine.LastCreatedScene),void 0===a&&(a=null),void 0===o&&(o=null),new Promise((function(e,s){i.LoadAssetContainer(t,r,n,(function(t){e(t)}),a,(function(e,t,i){s(i||new Error(t))}),o)}))},i._ForceFullSceneLoadingForIncremental=!1,i._ShowLoadingScreen=!0,i._CleanBoneMatrixWeights=!1,i.NO_LOGGING=0,i.MINIMAL_LOGGING=1,i.SUMMARY_LOGGING=2,i.DETAILED_LOGGING=3,i._loggingLevel=i.NO_LOGGING,i.OnPluginActivatedObservable=new e.Observable,i._registeredPlugins={},i}();e.SceneLoader=i}(s||(s={})),function(e){var t=function(t,i,r,n){for(var a=0,o=i.materials.length;a<o;a++){var s=i.materials[__uv.$wrap((a))];if(s.id===t)return e.Material.Parse(s,r,n)}return null},i=function(e,t,i){for(var r in t)if(e.name===t[__uv.$wrap((r))])return i.push(e.id),!0;return!(!e.parentId||-1===i.indexOf(e.parentId))&&(i.push(e.id),!0)},r=function(e,t){return e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")},n=function(t,i,n,a,o){void 0===o&&(o=!1);var s=new e.AssetContainer(t),l="importScene has failed JSON parse";try{var c=JSON.parse(i);l="";var u,h,d=e.SceneLoader.loggingLevel===e.SceneLoader.DETAILED_LOGGING;if(void 0!==c.lights&&null!==c.lights)for(u=0,h=c.lights.length;u<h;u++){var p=c.lights[__uv.$wrap((u))],m=e.Light.Parse(p,t);m&&(s.lights.push(m),l+=0===u?"\n\tLights:":"",l+="\n\t\t"+m.toString(d))}if(void 0!==c.animations&&null!==c.animations)for(u=0,h=c.animations.length;u<h;u++){var _=c.animations[__uv.$wrap((u))],f=e.Animation.Parse(_);t.animations.push(f),s.animations.push(f),l+=0===u?"\n\tAnimations:":"",l+="\n\t\t"+f.toString(d)}if(void 0!==c.materials&&null!==c.materials)for(u=0,h=c.materials.length;u<h;u++){var g=c.materials[__uv.$wrap((u))],y=e.Material.Parse(g,t,n);s.materials.push(y),l+=0===u?"\n\tMaterials:":"",l+="\n\t\t"+y.toString(d)}if(void 0!==c.multiMaterials&&null!==c.multiMaterials)for(u=0,h=c.multiMaterials.length;u<h;u++){var v=c.multiMaterials[__uv.$wrap((u))],b=e.Material.ParseMultiMaterial(v,t);s.multiMaterials.push(b),l+=0===u?"\n\tMultiMaterials:":"",l+="\n\t\t"+b.toString(d)}if(void 0!==c.morphTargetManagers&&null!==c.morphTargetManagers)for(var x=0,S=c.morphTargetManagers;x<S.length;x++){var T=S[__uv.$wrap((x))];s.morphTargetManagers.push(e.MorphTargetManager.Parse(T,t))}if(void 0!==c.skeletons&&null!==c.skeletons)for(u=0,h=c.skeletons.length;u<h;u++){var E=c.skeletons[__uv.$wrap((u))],P=e.Skeleton.Parse(E,t);s.skeletons.push(P),l+=0===u?"\n\tSkeletons:":"",l+="\n\t\t"+P.toString(d)}var A=c.geometries;if(null!=A){var M=new Array,C=A.boxes;if(null!=C)for(u=0,h=C.length;u<h;u++){var R=C[__uv.$wrap((u))];M.push(e.BoxGeometry.Parse(R,t))}var w=A.spheres;if(null!=w)for(u=0,h=w.length;u<h;u++){var I=w[__uv.$wrap((u))];M.push(e.SphereGeometry.Parse(I,t))}var O=A.cylinders;if(null!=O)for(u=0,h=O.length;u<h;u++){var D=O[__uv.$wrap((u))];M.push(e.CylinderGeometry.Parse(D,t))}var k=A.toruses;if(null!=k)for(u=0,h=k.length;u<h;u++){var B=k[__uv.$wrap((u))];M.push(e.TorusGeometry.Parse(B,t))}var F=A.grounds;if(null!=F)for(u=0,h=F.length;u<h;u++){var L=F[__uv.$wrap((u))];M.push(e.GroundGeometry.Parse(L,t))}var N=A.planes;if(null!=N)for(u=0,h=N.length;u<h;u++){var V=N[__uv.$wrap((u))];M.push(e.PlaneGeometry.Parse(V,t))}var G=A.torusKnots;if(null!=G)for(u=0,h=G.length;u<h;u++){var U=G[__uv.$wrap((u))];M.push(e.TorusKnotGeometry.Parse(U,t))}var z=A.vertexData;if(null!=z)for(u=0,h=z.length;u<h;u++){var H=z[__uv.$wrap((u))];M.push(e.Geometry.Parse(H,t,n))}M.forEach((function(e){e&&s.geometries.push(e)}))}if(void 0!==c.transformNodes&&null!==c.transformNodes)for(u=0,h=c.transformNodes.length;u<h;u++){var W=c.transformNodes[__uv.$wrap((u))],j=e.TransformNode.Parse(W,t,n);s.transformNodes.push(j)}if(void 0!==c.meshes&&null!==c.meshes)for(u=0,h=c.meshes.length;u<h;u++){var X=c.meshes[__uv.$wrap((u))],Y=e.Mesh.Parse(X,t,n);s.meshes.push(Y),l+=0===u?"\n\tMeshes:":"",l+="\n\t\t"+Y.toString(d)}if(void 0!==c.cameras&&null!==c.cameras)for(u=0,h=c.cameras.length;u<h;u++){var K=c.cameras[__uv.$wrap((u))],Q=e.Camera.Parse(K,t);s.cameras.push(Q),l+=0===u?"\n\tCameras:":"",l+="\n\t\t"+Q.toString(d)}if(void 0!==c.animationGroups&&null!==c.animationGroups)for(u=0,h=c.animationGroups.length;u<h;u++){var Z=c.animationGroups[__uv.$wrap((u))],q=e.AnimationGroup.Parse(Z,t);s.animationGroups.push(q),l+=0===u?"\n\tAnimationGroups:":"",l+="\n\t\t"+q.toString(d)}for(u=0,h=t.cameras.length;u<h;u++){(Q=t.cameras[__uv.$wrap((u))])._waitingParentId&&(Q.__uv$setSource(__uv).__uv$parent=t.getLastEntryByID(Q._waitingParentId),Q._waitingParentId=null)}for(u=0,h=t.lights.length;u<h;u++){var J=t.lights[__uv.$wrap((u))];J&&J._waitingParentId&&(J.__uv$setSource(__uv).__uv$parent=t.getLastEntryByID(J._waitingParentId),J._waitingParentId=null)}for(u=0,h=t.transformNodes.length;u<h;u++){var $=t.transformNodes[__uv.$wrap((u))];$._waitingParentId&&($.__uv$setSource(__uv).__uv$parent=t.getLastEntryByID($._waitingParentId),$._waitingParentId=null)}for(u=0,h=t.meshes.length;u<h;u++){(Y=t.meshes[__uv.$wrap((u))])._waitingParentId&&(Y.__uv$setSource(__uv).__uv$parent=t.getLastEntryByID(Y._waitingParentId),Y._waitingParentId=null)}for(u=0,h=t.meshes.length;u<h;u++){var ee=t.meshes[__uv.$wrap((u))];ee._waitingFreezeWorldMatrix?(ee.freezeWorldMatrix(),ee._waitingFreezeWorldMatrix=null):ee.computeWorldMatrix(!0)}for(u=0,h=t.lights.length;u<h;u++){var te=t.lights[__uv.$wrap((u))];if(te._excludedMeshesIds.length>0){for(var ie=0;ie<te._excludedMeshesIds.length;ie++){var re=t.getMeshByID(te._excludedMeshesIds[__uv.$wrap((ie))]);re&&te.excludedMeshes.push(re)}te._excludedMeshesIds=[]}if(te._includedOnlyMeshesIds.length>0){for(var ne=0;ne<te._includedOnlyMeshesIds.length;ne++){var ae=t.getMeshByID(te._includedOnlyMeshesIds[__uv.$wrap((ne))]);ae&&te.includedOnlyMeshes.push(ae)}te._includedOnlyMeshesIds=[]}}for(e.AbstractScene.Parse(c,t,s,n),u=0,h=t.meshes.length;u<h;u++){(Y=t.meshes[__uv.$wrap((u))])._waitingActions&&(e.ActionManager.Parse(Y._waitingActions,Y,t),Y._waitingActions=null)}void 0!==c.actions&&null!==c.actions&&e.ActionManager.Parse(c.actions,null,t),o||s.removeAllFromScene()}catch(t){var oe=r("loadAssets",c?c.producer:"Unknown")+l;if(!a)throw e.Tools.Log(oe),t;a(oe,t)}finally{null!==l&&e.SceneLoader.loggingLevel!==e.SceneLoader.NO_LOGGING&&e.Tools.Log(r("loadAssets",c?c.producer:"Unknown")+(e.SceneLoader.loggingLevel!==e.SceneLoader.MINIMAL_LOGGING?l:""))}return s};e.SceneLoader.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(e){return-1!==e.indexOf("babylon")},importMesh:function(n,a,o,s,l,c,u,h){var d="importMesh has failed JSON parse";try{var p=JSON.parse(o);d="";var m=e.SceneLoader.loggingLevel===e.SceneLoader.DETAILED_LOGGING;n?Array.isArray(n)||(n=[n]):n=null;var _=new Array;if(void 0!==p.meshes&&null!==p.meshes){var f,g,y,v=[],b=[];for(f=0,g=p.meshes.length;f<g;f++){var x=p.meshes[__uv.$wrap((f))];if(null===n||i(x,n,_)){if(null!==n&&delete n[__uv.$wrap((n.indexOf(x.name)))],void 0!==x.geometryId&&null!==x.geometryId&&void 0!==p.geometries&&null!==p.geometries){var S=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach((function(t){!0!==S&&p.geometries[__uv.$wrap((t))]&&Array.isArray(p.geometries[__uv.$wrap((t))])&&p.geometries[__uv.$wrap((t))].forEach((function(i){if(i.id===x.geometryId){switch(t){case"boxes":e.BoxGeometry.Parse(i,a);break;case"spheres":e.SphereGeometry.Parse(i,a);break;case"cylinders":e.CylinderGeometry.Parse(i,a);break;case"toruses":e.TorusGeometry.Parse(i,a);break;case"grounds":e.GroundGeometry.Parse(i,a);break;case"planes":e.PlaneGeometry.Parse(i,a);break;case"torusKnots":e.TorusKnotGeometry.Parse(i,a);break;case"vertexData":e.Geometry.Parse(i,a,s)}S=!0}}))})),!1===S&&e.Tools.Warn("Geometry not found for mesh "+x.id)}if(x.materialId){var T=-1!==b.indexOf(x.materialId);if(!1===T&&void 0!==p.multiMaterials&&null!==p.multiMaterials)for(var E=0,P=p.multiMaterials.length;E<P;E++){var A=p.multiMaterials[__uv.$wrap((E))];if(A.id===x.materialId){for(var M=0,C=A.materials.length;M<C;M++){var R,w=A.materials[__uv.$wrap((M))];b.push(w),(R=t(w,p,a,s))&&(d+="\n\tMaterial "+R.toString(m))}b.push(A.id);var I=e.Material.ParseMultiMaterial(A,a);I&&(T=!0,d+="\n\tMulti-Material "+I.toString(m));break}}if(!1===T)b.push(x.materialId),(R=t(x.materialId,p,a,s))?d+="\n\tMaterial "+R.toString(m):e.Tools.Warn("Material not found for mesh "+x.id)}if(x.skeletonId>-1&&void 0!==p.skeletons&&null!==p.skeletons)if(!1===v.indexOf(x.skeletonId)>-1)for(var O=0,D=p.skeletons.length;O<D;O++){var k=p.skeletons[__uv.$wrap((O))];if(k.id===x.skeletonId){var B=e.Skeleton.Parse(k,a);u.push(B),v.push(k.id),d+="\n\tSkeleton "+B.toString(m)}}if(void 0!==p.morphTargetManagers&&null!==p.morphTargetManagers)for(var F=0,L=p.morphTargetManagers;F<L.length;F++){var N=L[__uv.$wrap((F))];e.MorphTargetManager.Parse(N,a)}var V=e.Mesh.Parse(x,a,s);l.push(V),d+="\n\tMesh "+V.toString(m)}}for(f=0,g=a.meshes.length;f<g;f++)(y=a.meshes[__uv.$wrap((f))])._waitingParentId&&(y.__uv$setSource(__uv).__uv$parent=a.getLastEntryByID(y._waitingParentId),y._waitingParentId=null);for(f=0,g=a.meshes.length;f<g;f++)(y=a.meshes[__uv.$wrap((f))])._waitingFreezeWorldMatrix?(y.freezeWorldMatrix(),y._waitingFreezeWorldMatrix=null):y.computeWorldMatrix(!0)}if(void 0!==p.particleSystems&&null!==p.particleSystems){var G=e.AbstractScene.GetIndividualParser(e.SceneComponentConstants.NAME_PARTICLESYSTEM);if(G)for(f=0,g=p.particleSystems.length;f<g;f++){var U=p.particleSystems[__uv.$wrap((f))];-1!==_.indexOf(U.emitterId)&&c.push(G(U,a,s))}}return!0}catch(t){var z=r("importMesh",p?p.producer:"Unknown")+d;if(!h)throw e.Tools.Log(z),t;h(z,t)}finally{null!==d&&e.SceneLoader.loggingLevel!==e.SceneLoader.NO_LOGGING&&e.Tools.Log(r("importMesh",p?p.producer:"Unknown")+(e.SceneLoader.loggingLevel!==e.SceneLoader.MINIMAL_LOGGING?d:""))}return!1},load:function(t,i,a,o){var s="importScene has failed JSON parse";try{var l=JSON.parse(i);if(s="",void 0!==l.useDelayedTextureLoading&&null!==l.useDelayedTextureLoading&&(t.useDelayedTextureLoading=l.useDelayedTextureLoading&&!e.SceneLoader.ForceFullSceneLoadingForIncremental),void 0!==l.autoClear&&null!==l.autoClear&&(t.autoClear=l.autoClear),void 0!==l.clearColor&&null!==l.clearColor&&(t.clearColor=e.Color4.FromArray(l.clearColor)),void 0!==l.ambientColor&&null!==l.ambientColor&&(t.ambientColor=e.Color3.FromArray(l.ambientColor)),void 0!==l.gravity&&null!==l.gravity&&(t.gravity=e.Vector3.FromArray(l.gravity)),l.fogMode&&0!==l.fogMode)switch(t.fogMode=l.fogMode,t.fogColor=e.Color3.FromArray(l.fogColor),t.fogStart=l.fogStart,t.fogEnd=l.fogEnd,t.fogDensity=l.fogDensity,s+="\tFog mode for scene:  ",t.fogMode){case 1:s+="exp\n";break;case 2:s+="exp2\n";break;case 3:s+="linear\n"}if(l.physicsEnabled){var c;"cannon"===l.physicsEngine?c=new e.CannonJSPlugin:"oimo"===l.physicsEngine&&(c=new e.OimoJSPlugin),s="\tPhysics engine "+(l.physicsEngine?l.physicsEngine:"oimo")+" enabled\n";var u=l.physicsGravity?e.Vector3.FromArray(l.physicsGravity):null;t.enablePhysics(u,c)}if(void 0!==l.metadata&&null!==l.metadata&&(t.metadata=l.metadata),void 0!==l.collisionsEnabled&&null!==l.collisionsEnabled&&(t.collisionsEnabled=l.collisionsEnabled),t.workerCollisions=!!l.workerCollisions,!n(t,i,a,o,!0))return!1;if(l.autoAnimate&&t.beginAnimation(t,l.autoAnimateFrom,l.autoAnimateTo,l.autoAnimateLoop,l.autoAnimateSpeed||1),void 0!==l.activeCameraID&&null!==l.activeCameraID&&t.setActiveCameraByID(l.activeCameraID),void 0!==l.environmentTexture&&null!==l.environmentTexture){if(l.environmentTextureType&&"BABYLON.HDRCubeTexture"===l.environmentTextureType){var h=l.environmentTextureSize?l.environmentTextureSize:128,d=new e.HDRCubeTexture(a+l.environmentTexture,t,h);l.environmentTextureRotationY&&(d.rotationY=l.environmentTextureRotationY),t.environmentTexture=d}else{var p=e.CubeTexture.CreateFromPrefilteredData(a+l.environmentTexture,t);l.environmentTextureRotationY&&(p.rotationY=l.environmentTextureRotationY),t.environmentTexture=p}if(!0===l.createDefaultSkybox){var m=void 0!==t.activeCamera&&null!==t.activeCamera?(t.activeCamera.maxZ-t.activeCamera.minZ)/2:1e3,_=l.skyboxBlurLevel||0;t.createDefaultSkybox(void 0,!0,m,_)}}return!0}catch(t){var f=r("importScene",l?l.producer:"Unknown")+s;if(!o)throw e.Tools.Log(f),t;o(f,t)}finally{null!==s&&e.SceneLoader.loggingLevel!==e.SceneLoader.NO_LOGGING&&e.Tools.Log(r("importScene",l?l.producer:"Unknown")+(e.SceneLoader.loggingLevel!==e.SceneLoader.MINIMAL_LOGGING?s:""))}return!1},loadAssetContainer:function(e,t,i,r){return n(e,t,i,r)}})}(s||(s={})),function(e){var t=function(){function t(e,t,i,r,n,a,o,s,l){this.onProcessFileCallback=function(){return!0},this._engine=e,this._currentScene=t,this._sceneLoadedCallback=i,this._progressCallback=r,this._additionalRenderLoopLogicCallback=n,this._textureLoadingCallback=a,this._startingProcessingFilesCallback=o,this._onReloadCallback=s,this._errorCallback=l}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._dragEnterHandler=function(e){t.drag(e)},this._dragOverHandler=function(e){t.drag(e)},this._dropHandler=function(e){t.drop(e)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},t.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},t.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype._traverseFolder=function(e,t,i,r){var n=this,a=e.createReader(),o=e.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");a.readEntries((function(e){i.count+=e.length;for(var a=0,s=e;a<s.length;a++){var l=s[__uv.$wrap((a))];l.isFile?l.file((function(e){e.correctName=o+e.name,t.push(e),0==--i.count&&r()})):l.isDirectory&&n._traverseFolder(l,t,i,r)}--i.count&&r()}))},t.prototype._processFiles=function(e){for(var i=0;i<e.length;i++){var r=e[__uv.$wrap((i))].correctName.toLowerCase(),n=r.split(".").pop();this.onProcessFileCallback(e[__uv.$wrap((i))],r,n)&&("babylon"!==n&&"stl"!==n&&"obj"!==n&&"gltf"!==n&&"glb"!==n||-1!==r.indexOf(".binary.babylon")||-1!==r.indexOf(".incremental.babylon")||(this._sceneFileToLoad=e[__uv.$wrap((i))]),t.FilesToLoad[__uv.$wrap((r))]=e[__uv.$wrap((i))])}},t.prototype.loadFiles=function(e){var t=this;if(e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&0!==this._filesToLoad.length&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var i=new Array,r=[],n=e.dataTransfer?e.dataTransfer.items:null,a=0;a<this._filesToLoad.length;a++){var o=this._filesToLoad[__uv.$wrap((a))],s=o.name.toLowerCase(),l=void 0;if(o.correctName=s,n){var c=n[__uv.$wrap((a))];c.getAsEntry?l=c.getAsEntry():c.webkitGetAsEntry&&(l=c.webkitGetAsEntry())}l&&l.isDirectory?r.push(l):i.push(o)}if(0===r.length)this._processFiles(i),this._processReload();else for(var u={count:r.length},h=0,d=r;h<d.length;h++){var p=d[__uv.$wrap((h))];this._traverseFolder(p,i,u,(function(){t._processFiles(i),0===u.count&&t._processReload()}))}}},t.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},t.prototype.reload=function(){var t=this;this._sceneFileToLoad?(this._currentScene&&(e.Tools.errorsCount>0&&e.Tools.ClearLogCache(),this._engine.stopRenderLoop()),e.SceneLoader.LoadAsync("file:",this._sceneFileToLoad.name,this._engine,(function(e){t._progressCallback&&t._progressCallback(e)})).then((function(e){t._currentScene&&t._currentScene.dispose(),t._currentScene=e,t._sceneLoadedCallback&&t._sceneLoadedCallback(t._sceneFileToLoad,t._currentScene),t._currentScene.executeWhenReady((function(){t._engine.runRenderLoop((function(){t.renderFunction()}))}))})).catch((function(e){t._errorCallback&&t._errorCallback(t._sceneFileToLoad,t._currentScene,e.message)}))):e.Tools.Error("Please provide a valid .babylon file.")},t.FilesToLoad={},t}();e.FilesInput=t}(s||(s={})),function(e){var t=function(){function t(){}return t.EnableFor=function(e){e._tags=e._tags||{},e.hasTags=function(){return t.HasTags(e)},e.addTags=function(i){return t.AddTagsTo(e,i)},e.removeTags=function(i){return t.RemoveTagsFrom(e,i)},e.matchesTagsQuery=function(i){return t.MatchesQuery(e,i)}},t.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},t.HasTags=function(t){return!!t._tags&&!e.Tools.IsEmpty(t._tags)},t.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var i=[];for(var r in e._tags)e._tags.hasOwnProperty(r)&&!0===e._tags[__uv.$wrap((r))]&&i.push(r);return i.join(" ")}return e._tags},t.AddTagsTo=function(e,i){i&&("string"==typeof i&&i.split(" ").forEach((function(i,r,n){t._AddTagTo(e,i)})))},t._AddTagTo=function(e,i){""!==(i=i.trim())&&"true"!==i&&"false"!==i&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(t.EnableFor(e),e._tags[__uv.$wrap((i))]=!0))},t.RemoveTagsFrom=function(e,i){if(t.HasTags(e)){var r=i.split(" ");for(var n in r)t._RemoveTagFrom(e,r[__uv.$wrap((n))])}},t._RemoveTagFrom=function(e,t){delete e._tags[__uv.$wrap((t))]},t.MatchesQuery=function(i,r){return void 0===r||(""===r?t.HasTags(i):e.AndOrNotEvaluator.Eval(r,(function(e){return t.HasTags(i)&&i._tags[__uv.$wrap((e))]})))},t}();e.Tags=t}(s||(s={})),function(e){var t=function(){function e(){}return e.Eval=function(t,i){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,(function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,i)})):e._HandleParenthesisContent(t,i))||"false"!==t&&e.Eval(t,i)},e._HandleParenthesisContent=function(t,i){var r;i=i||function(e){return"true"===e};var n=t.split("||");for(var a in n)if(n.hasOwnProperty(a)){var o=e._SimplifyNegation(n[__uv.$wrap((a))].trim()),s=o.split("&&");if(s.length>1)for(var l=0;l<s.length;++l){var c=e._SimplifyNegation(s[__uv.$wrap((l))].trim());if(!(r="true"!==c&&"false"!==c?"!"===c[__uv.$wrap((0))]?!i(c.substring(1)):i(c):"true"===c)){o="false";break}}if(r||"true"===o){r=!0;break}r="true"!==o&&"false"!==o?"!"===o[__uv.$wrap((0))]?!i(o.substring(1)):i(o):"true"===o}return r?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(function(e){return(e=e.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?e="false":"!false"===e&&(e="true"),e},e}();e.AndOrNotEvaluator=t}(s||(s={})),function(e){var t=function(){function t(i,r,n){void 0===n&&(n=!1);var a=this;this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=r,this.currentSceneUrl=t._ReturnFullUrlLocation(i),this.db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?n?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this.manifestVersionFound=1,e.Tools.SetImmediate((function(){a.callbackManifestChecked(!0)}))):this._checkManifestFile():this.callbackManifestChecked(!0)}return Object.defineProperty(t.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),t.prototype._checkManifestFile=function(){var t=this,i=function(){t._enableSceneOffline=!1,t._enableTexturesOffline=!1,t.callbackManifestChecked(!1)},r=!1,n=this.currentSceneUrl+".manifest",a=new XMLHttpRequest;navigator.onLine&&(r=!0,n=n+(null==n.match(/\?/)?"?":"&")+Date.now()),a.open("GET",n,!0),a.addEventListener("load",(function(){if(200===a.status||e.Tools.ValidateXHRData(a,1))try{var r=JSON.parse(a.response);t._enableSceneOffline=r.enableSceneOffline,t._enableTexturesOffline=r.enableTexturesOffline,r.version&&!isNaN(parseInt(r.version))&&(t.manifestVersionFound=r.version),t.callbackManifestChecked&&t.callbackManifestChecked(!0)}catch(e){i()}else i()}),!1),a.addEventListener("error",(function(e){if(r){r=!1;var n=t.currentSceneUrl+".manifest";a.open("GET",n,!0),a.send()}else i()}),!1);try{a.send()}catch(t){e.Tools.Error("Error on XHR send request."),this.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){var r=this,n=function(){r.isSupported=!1,i&&i()};if(this.idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var a=this.idbFactory.open("babylonjs",1);a.onerror=function(e){n()},a.onblocked=function(t){e.Tools.Error("IDB request blocked. Please reload the page."),n()},a.onsuccess=function(e){r.db=a.result,t()},a.onupgradeneeded=function(t){if(r.db=t.target.result,r.db)try{r.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),r.db.createObjectStore("versions",{keyPath:"sceneUrl"}),r.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(t){e.Tools.Error("Error while creating object stores. Exception: "+t.message),n()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var r=this,n=t._ReturnFullUrlLocation(e),a=function(){r.hasReachedQuota||null===r.db?i.src=e:r._saveImageIntoDBAsync(n,i)};this.mustUpdateRessources?a():this._loadImageFromDBAsync(n,i,a)},t.prototype._loadImageFromDBAsync=function(t,i,r){if(this.isSupported&&null!==this.db){var n,a=this.db.transaction(["textures"]);a.onabort=function(e){i.src=t},a.oncomplete=function(a){var o;if(n){var s=window.URL||window.webkitURL;o=s.createObjectURL(n.data),i.onerror=function(){e.Tools.Error("Error loading image from blob URL: "+o+" switching back to web url: "+t),i.src=t},i.src=o}else r()};var o=a.objectStore("textures").get(t);o.onsuccess=function(e){n=e.target.result},o.onerror=function(r){e.Tools.Error("Error loading texture "+t+" from DB."),i.src=t}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,r){var n=this;if(this.isSupported){var a=function(){var e;if(o){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(o)}catch(i){e=t.createObjectURL(o)}}e&&(r.src=e)};if(t.IsUASupportingBlobStorage){var o,s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType="blob",s.addEventListener("load",(function(){if(200===s.status&&n.db){o=s.response;var e=n.db.transaction(["textures"],"readwrite");e.onabort=function(e){try{var t=(e.srcElement||e.target).error;t&&"QuotaExceededError"===t.name&&(n.hasReachedQuota=!0)}catch(e){}a()},e.oncomplete=function(e){a()};var l={textureUrl:i,data:o};try{var c=e.objectStore("textures").put(l);c.onsuccess=function(e){},c.onerror=function(e){a()}}catch(e){25===e.code&&(t.IsUASupportingBlobStorage=!1),r.src=i}}else r.src=i}),!1),s.addEventListener("error",(function(t){e.Tools.Error("Error in XHR request in BABYLON.Database."),r.src=i}),!1),s.send()}else r.src=i}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),r.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this;this._loadVersionFromDBAsync(e,t,(function(){i._saveVersionIntoDBAsync(e,t)}))},t.prototype._loadVersionFromDBAsync=function(t,i,r){var n,a=this;if(this.isSupported&&this.db)try{var o=this.db.transaction(["versions"]);o.oncomplete=function(e){n?a.manifestVersionFound!==n.data?(a.mustUpdateRessources=!0,r()):i(n.data):(a.mustUpdateRessources=!0,r())},o.onabort=function(e){i(-1)};var s=o.objectStore("versions").get(t);s.onsuccess=function(e){n=e.target.result},s.onerror=function(r){e.Tools.Error("Error loading version for scene "+t+" from DB."),i(-1)}}catch(t){e.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+t.message),i(-1)}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var r=this;if(this.isSupported&&!this.hasReachedQuota&&this.db)try{var n=this.db.transaction(["versions"],"readwrite");n.onabort=function(e){try{var t=e.srcElement.error;t&&"QuotaExceededError"===t.name&&(r.hasReachedQuota=!0)}catch(e){}i(-1)},n.oncomplete=function(e){i(r.manifestVersionFound)};var a={sceneUrl:t,data:this.manifestVersionFound},o=n.objectStore("versions").put(a);o.onsuccess=function(e){},o.onerror=function(t){e.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(t){e.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+t.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,r,n,a){var o=this,s=t._ReturnFullUrlLocation(e),l=function(){o._saveFileIntoDBAsync(s,i,r,a,n)};this._checkVersionFromDB(s,(function(e){-1!==e?o.mustUpdateRessources?o._saveFileIntoDBAsync(s,i,r,a,n):o._loadFileFromDBAsync(s,i,l,a):n&&n()}))},t.prototype._loadFileFromDBAsync=function(t,i,r,n){if(this.isSupported&&this.db){var a,o;a=-1!==t.indexOf(".babylon")?"scenes":"textures";var s=this.db.transaction([a]);s.oncomplete=function(e){o?i(o.data):r()},s.onabort=function(e){r()};var l=s.objectStore(a).get(t);l.onsuccess=function(e){o=e.target.result},l.onerror=function(i){e.Tools.Error("Error loading file "+t+" from DB."),r()}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},t.prototype._saveFileIntoDBAsync=function(t,i,r,n,a){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(".babylon")?"scenes":"textures";var l,c=new XMLHttpRequest;c.open("GET",t+"?"+Date.now(),!0),n&&(c.responseType="arraybuffer"),r&&(c.onprogress=r),c.addEventListener("load",(function(){if(200===c.status||c.status<400&&e.Tools.ValidateXHRData(c,n?6:1))if(l=n?c.response:c.responseText,!o.hasReachedQuota&&o.db){var r,u=o.db.transaction([s],"readwrite");u.onabort=function(e){try{var t=e.srcElement.error;t&&"QuotaExceededError"===t.name&&(o.hasReachedQuota=!0)}catch(e){}i(l)},u.oncomplete=function(e){i(l)},r="scenes"===s?{sceneUrl:t,data:l,version:o.manifestVersionFound}:{textureUrl:t,data:l};try{var h=u.objectStore(s).put(r);h.onsuccess=function(e){},h.onerror=function(t){e.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(e){i(l)}}else i(l);else c.status>=400&&a?a(c):i()}),!1),c.addEventListener("error",(function(t){e.Tools.Error("error on XHR request."),i()}),!1),c.send()}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t._ParseURL=function(e){document.createElement("a").href=e;var t=e.substring(0,e.lastIndexOf("#")),i=e.substring(t.lastIndexOf("/")+1,e.length);return e.substring(0,e.indexOf(i,0))},t._ReturnFullUrlLocation=function(e){return-1===e.indexOf("http:/")&&-1===e.indexOf("https:/")?t._ParseURL(window.__uv$setSource(__uv).__uv$location.href)+e:e},t}();e.Database=t}(s||(s={})),function(e){var t=function(){function t(){this._isEnabled=!0,this.leftColor=e.Color3.White(),this.rightColor=e.Color3.Black(),this.bias=0,this.power=1}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.FresnelDirtyFlag|e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var i=new t;return e.Tools.DeepCopy(this,i),i},t.prototype.serialize=function(){var e={};return e.isEnabled=this.isEnabled,e.leftColor=this.leftColor.asArray(),e.rightColor=this.rightColor.asArray(),e.bias=this.bias,e.power=this.power,e},t.Parse=function(i){var r=new t;return r.isEnabled=i.isEnabled,r.leftColor=e.Color3.FromArray(i.leftColor),r.rightColor=e.Color3.FromArray(i.rightColor),r.bias=i.bias,r.power=i.power||1,r},t}();e.FresnelParameters=t}(s||(s={})),function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i,!0)||this;return i.multiMaterials.push(r),r.subMaterials=new Array,r.storeEffectOnSubMeshes=!0,r}return a(i,t),Object.defineProperty(i.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!0,configurable:!0}),i.prototype._hookArray=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[__uv.$wrap((n))]=arguments[__uv.$wrap((n))];var a=i.apply(e,r);return t._markAllSubMeshesAsTexturesDirty(),a};var r=e.splice;e.splice=function(i,n){var a=r.apply(e,[i,n]);return t._markAllSubMeshesAsTexturesDirty(),a}},i.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[__uv.$wrap((e))]},i.prototype.getActiveTextures=function(){var e;return(e=t.prototype.getActiveTextures.call(this)).concat.apply(e,this.subMaterials.map((function(e){return e?e.getActiveTextures():[]})))},i.prototype.getClassName=function(){return"MultiMaterial"},i.prototype.isReadyForSubMesh=function(e,t,i){for(var r=0;r<this.subMaterials.length;r++){var n=this.subMaterials[__uv.$wrap((r))];if(n){if(n.storeEffectOnSubMeshes){if(!n.isReadyForSubMesh(e,t,i))return!1;continue}if(!n.isReady(e))return!1}}return!0},i.prototype.clone=function(e,t){for(var r=new i(e,this.getScene()),n=0;n<this.subMaterials.length;n++){var a=null,o=this.subMaterials[__uv.$wrap((n))];a=t&&o?o.clone(e+"-"+o.name):this.subMaterials[__uv.$wrap((n))],r.subMaterials.push(a)}return r},i.prototype.serialize=function(){var t={};t.name=this.name,t.id=this.id,e.Tags&&(t.tags=e.Tags.GetTags(this)),t.materials=[];for(var i=0;i<this.subMaterials.length;i++){var r=this.subMaterials[__uv.$wrap((i))];r?t.materials.push(r.id):t.materials.push(null)}return t},i.prototype.dispose=function(e,i){var r=this.getScene();if(r){var n=r.multiMaterials.indexOf(this);n>=0&&r.multiMaterials.splice(n,1),t.prototype.dispose.call(this,e,i)}},i}(e.Material);e.MultiMaterial=t}(s||(s={})),function(e){var t=function(){function t(){this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return t.prototype.attachControl=function(t,i){var r=this,n=null;void 0===this._pointerInput&&(this._onLostFocus=function(e){r._offsetX=null,r._offsetY=null},this._pointerInput=function(t,a){var o=t.event;if("mouse"!==o.pointerType)if(t.type===e.PointerEventTypes.POINTERDOWN){if(i||o.preventDefault(),r._pointerPressed.push(o.pointerId),1!==r._pointerPressed.length)return;n={x:o.clientX,y:o.clientY}}else if(t.type===e.PointerEventTypes.POINTERUP){if(i||o.preventDefault(),-1===(s=r._pointerPressed.indexOf(o.pointerId)))return;if(r._pointerPressed.splice(s,1),0!=s)return;n=null,r._offsetX=null,r._offsetY=null}else if(t.type===e.PointerEventTypes.POINTERMOVE){if(i||o.preventDefault(),!n)return;var s;if(0!=(s=r._pointerPressed.indexOf(o.pointerId)))return;r._offsetX=o.clientX-n.x,r._offsetY=-(o.clientY-n.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE),this._onLostFocus&&t.addEventListener("blur",this._onLostFocus)},t.prototype.detachControl=function(e){this._pointerInput&&e&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},t.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var t=this.camera;if(t.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)t.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var i=t._computeLocalCameraSpeed(),r=new e.Vector3(0,0,i*this._offsetY/this.touchMoveSensibility);e.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(r,t._cameraRotationMatrix))}}},t.prototype.getClassName=function(){return"FreeCameraTouchInput"},t.prototype.getSimpleName=function(){return"touch"},n([e.serialize()],t.prototype,"touchAngularSensibility",void 0),n([e.serialize()],t.prototype,"touchMoveSensibility",void 0),t}();e.FreeCameraTouchInput=t,e.CameraInputTypes.FreeCameraTouchInput=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("TouchCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.inputs.addTouch(),n._setupInputs(),n}return a(t,e),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.mouse;e&&(e.touchEnabled=!1)},t}(e.FreeCamera);e.TouchCamera=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l){void 0===o&&(o=null),void 0===s&&(s=!0),void 0===l&&(l=!1);var c=t.call(this,null,a,!s)||this;c.isCube=l,c.isEnabled=!0,c.autoClear=!0,c.onGeneratedObservable=new e.Observable,c._textures={},c._currentRefreshId=-1,c._refreshRate=1,c._vertexBuffers={},c._uniforms=new Array,c._samplers=new Array,c._floats={},c._ints={},c._floatsArrays={},c._colors3={},c._colors4={},c._vectors2={},c._vectors3={},c._matrices={},c._fallbackTextureUsed=!1,c._cachedDefines="",c._contentUpdateId=-1;var u=(a=c.getScene())._getComponent(e.SceneComponentConstants.NAME_PROCEDURALTEXTURE);u||(u=new e.ProceduralTextureSceneComponent(a),a._addComponent(u)),a.proceduralTextures.push(c),c._engine=a.getEngine(),c.name=i,c.isRenderTarget=!0,c._size=r,c._generateMipMaps=s,c.setFragment(n),c._fallbackTexture=o,l?(c._texture=c._engine.createRenderTargetCubeTexture(r,{generateMipMaps:s,generateDepthBuffer:!1,generateStencilBuffer:!1}),c.setFloat("face",0)):c._texture=c._engine.createRenderTargetTexture(r,{generateMipMaps:s,generateDepthBuffer:!1,generateStencilBuffer:!1});var h=[];return h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),c._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=new e.VertexBuffer(c._engine,h,e.VertexBuffer.PositionKind,!1,!1,2),c._createIndexBuffer(),c}return a(i,t),i.prototype.getContent=function(){return this._contentData&&this._currentRefreshId==this._contentUpdateId||(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._currentRefreshId),this._contentData},i.prototype._createIndexBuffer=function(){var e=this._engine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},i.prototype._rebuild=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&t._rebuild(),this._createIndexBuffer(),this.refreshRate===e.RenderTargetTexture.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=e.RenderTargetTexture.REFRESHRATE_RENDER_ONCE)},i.prototype.reset=function(){void 0!==this._effect&&this._engine._releaseEffect(this._effect)},i.prototype._getDefines=function(){return""},i.prototype.isReady=function(){var t,i=this,r=this._engine;if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var n=this._getDefines();return!(!this._effect||n!==this._cachedDefines||!this._effect.isReady())||(t=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=n,this._effect=r.createEffect(t,[e.VertexBuffer.PositionKind],this._uniforms,this._samplers,n,void 0,void 0,(function(){i.releaseInternalTexture(),i._fallbackTexture&&(i._texture=i._fallbackTexture._texture,i._texture&&i._texture.incrementReferences()),i._fallbackTextureUsed=!0})),this._effect.isReady())},i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},i.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),i.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},i.prototype.getRenderSize=function(){return this._size},i.prototype.resize=function(e,t){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(e,t),this._size=e,this._generateMipMaps=t)},i.prototype._checkUniform=function(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)},i.prototype.setTexture=function(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[__uv.$wrap((e))]=t,this},i.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[__uv.$wrap((e))]=t,this},i.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[__uv.$wrap((e))]=t,this},i.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[__uv.$wrap((e))]=t,this},i.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[__uv.$wrap((e))]=t,this},i.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[__uv.$wrap((e))]=t,this},i.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[__uv.$wrap((e))]=t,this},i.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[__uv.$wrap((e))]=t,this},i.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[__uv.$wrap((e))]=t,this},i.prototype.render=function(t){var i=this.getScene();if(i){var r=this._engine;for(var n in r.enableEffect(this._effect),r.setState(!1),this._textures)this._effect.setTexture(n,this._textures[__uv.$wrap((n))]);for(n in this._ints)this._effect.setInt(n,this._ints[__uv.$wrap((n))]);for(n in this._floats)this._effect.setFloat(n,this._floats[__uv.$wrap((n))]);for(n in this._floatsArrays)this._effect.setArray(n,this._floatsArrays[__uv.$wrap((n))]);for(n in this._colors3)this._effect.setColor3(n,this._colors3[__uv.$wrap((n))]);for(n in this._colors4){var a=this._colors4[__uv.$wrap((n))];this._effect.setFloat4(n,a.r,a.g,a.b,a.a)}for(n in this._vectors2)this._effect.setVector2(n,this._vectors2[__uv.$wrap((n))]);for(n in this._vectors3)this._effect.setVector3(n,this._vectors3[__uv.$wrap((n))]);for(n in this._matrices)this._effect.setMatrix(n,this._matrices[__uv.$wrap((n))]);if(this._texture){if(this.isCube)for(var o=0;o<6;o++)r.bindFramebuffer(this._texture,o,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",o),this.autoClear&&r.clear(i.clearColor,!0,!1,!1),r.drawElementsType(e.Material.TriangleFillMode,0,6),5===o&&r.generateMipMapsForCubemap(this._texture);else r.bindFramebuffer(this._texture,0,void 0,void 0,!0),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&r.clear(i.clearColor,!0,!1,!1),r.drawElementsType(e.Material.TriangleFillMode,0,6);r.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t},i.prototype.dispose=function(){var i=this.getScene();if(i){var r=i.proceduralTextures.indexOf(this);r>=0&&i.proceduralTextures.splice(r,1);var n=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];n&&(n.dispose(),this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),t.prototype.dispose.call(this)}},n([e.serialize()],i.prototype,"isEnabled",void 0),n([e.serialize()],i.prototype,"autoClear",void 0),n([e.serialize()],i.prototype,"_generateMipMaps",void 0),n([e.serialize()],i.prototype,"_size",void 0),n([e.serialize()],i.prototype,"refreshRate",null),i}(e.Texture);e.ProceduralTexture=t}(s||(s={})),function(e){var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_PROCEDURALTEXTURE,this.scene=t,this.scene.proceduralTextures=new Array,t.layers=new Array}return t.prototype.register=function(){this.scene._beforeClearStage.registerStep(e.SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){e.Tools.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var t=0;t<this.scene.proceduralTextures.length;t++){var i=this.scene.proceduralTextures[__uv.$wrap((t))];i._shouldRender()&&i.render()}e.Tools.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},t}();e.ProceduralTextureSceneComponent=t}(s||(s={})),function(e){var t=function(t){function i(e,i,r,n,a,o){var s=t.call(this,e,r,null,n,a,o)||this;return s._animate=!0,s._time=0,s._texturePath=i,s._loadJson(i),s.refreshRate=1,s}return a(i,t),i.prototype._loadJson=function(t){var i=this,r=function(){e.Tools.Log("No config file found in "+t+" trying to use ShadersStore or DOM element");try{i.setFragment(i._texturePath)}catch(t){e.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},n=t+"/config.json",a=new XMLHttpRequest;a.open("GET",n,!0),a.addEventListener("load",(function(){if(200===a.status||e.Tools.ValidateXHRData(a,1))try{i._config=JSON.parse(a.response),i.updateShaderUniforms(),i.updateTextures(),i.setFragment(i._texturePath+"/custom"),i._animate=i._config.animate,i.refreshRate=i._config.refreshrate}catch(e){r()}else r()}),!1),a.addEventListener("error",(function(){r()}),!1);try{a.send()}catch(t){e.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},i.prototype.isReady=function(){if(!t.prototype.isReady.call(this))return!1;for(var e in this._textures){if(!this._textures[__uv.$wrap((e))].isReady())return!1}return!0},i.prototype.render=function(e){var i=this.getScene();this._animate&&i&&(this._time+=.03*i.getAnimationRatio(),this.updateShaderUniforms()),t.prototype.render.call(this,e)},i.prototype.updateTextures=function(){for(var t=0;t<this._config.sampler2Ds.length;t++)this.setTexture(this._config.sampler2Ds[__uv.$wrap((t))].sample2Dname,new e.Texture(this._texturePath+"/"+this._config.sampler2Ds[__uv.$wrap((t))].textureRelativeUrl,this.getScene()))},i.prototype.updateShaderUniforms=function(){if(this._config)for(var t=0;t<this._config.uniforms.length;t++){var i=this._config.uniforms[__uv.$wrap((t))];switch(i.type){case"float":this.setFloat(i.name,i.value);break;case"color3":this.setColor3(i.name,new e.Color3(i.r,i.g,i.b));break;case"color4":this.setColor4(i.name,new e.Color4(i.r,i.g,i.b,i.a));break;case"vector2":this.setVector2(i.name,new e.Vector2(i.x,i.y));break;case"vector3":this.setVector3(i.name,new e.Vector3(i.x,i.y,i.z))}}this.setFloat("time",this._time)},Object.defineProperty(i.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!0,configurable:!0}),i}(e.ProceduralTexture);e.CustomProceduralTexture=t}(s||(s={})),function(e){var t=function(){function t(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._cameraTransform=e.Matrix.Identity(),this._deltaTransform=e.Vector3.Zero(),this._vector3=e.Vector3.Zero(),this._vector2=e.Vector2.Zero()}return t.prototype.attachControl=function(t,i){var r=this,n=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add((function(t){t.type!==e.Gamepad.POSE_ENABLED&&(r.gamepad&&t.type!==e.Gamepad.XBOX||(r.gamepad=t))})),this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add((function(e){r.gamepad===e&&(r.gamepad=null)})),this.gamepad=n.getGamepadByType(e.Gamepad.XBOX)},t.prototype.detachControl=function(e){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var t=this.camera,i=this.gamepad.leftStick,r=i.x/this.gamepadMoveSensibility,n=i.y/this.gamepadMoveSensibility;i.x=Math.abs(r)>.005?0+r:0,i.y=Math.abs(n)>.005?0+n:0;var a=this.gamepad.rightStick;if(a){var o=a.x/this.gamepadAngularSensibility,s=a.y/this.gamepadAngularSensibility;a.x=Math.abs(o)>.001?0+o:0,a.y=Math.abs(s)>.001?0+s:0}else a={x:0,y:0};t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):e.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);var l=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(i.x*l,0,-i.y*l),e.Vector3.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(a.y,a.x),t.cameraRotation.addInPlace(this._vector2)}},t.prototype.getClassName=function(){return"FreeCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},n([e.serialize()],t.prototype,"gamepadAngularSensibility",void 0),n([e.serialize()],t.prototype,"gamepadMoveSensibility",void 0),t}();e.FreeCameraGamepadInput=t,e.CameraInputTypes.FreeCameraGamepadInput=t}(s||(s={})),function(e){var t=function(){function t(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return t.prototype.attachControl=function(t,i){var r=this,n=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add((function(t){t.type!==e.Gamepad.POSE_ENABLED&&(r.gamepad&&t.type!==e.Gamepad.XBOX||(r.gamepad=t))})),this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add((function(e){r.gamepad===e&&(r.gamepad=null)})),this.gamepad=n.getGamepadByType(e.Gamepad.XBOX)},t.prototype.detachControl=function(e){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad){var e=this.camera,t=this.gamepad.rightStick;if(t){if(0!=t.x){var i=t.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(e.inertialAlphaOffset+=i)}if(0!=t.y){var r=t.y/this.gamepadRotationSensibility;0!=r&&Math.abs(r)>.005&&(e.inertialBetaOffset+=r)}}var n=this.gamepad.leftStick;if(n&&0!=n.y){var a=n.y/this.gamepadMoveSensibility;0!=a&&Math.abs(a)>.005&&(this.camera.inertialRadiusOffset-=a)}}},t.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},n([e.serialize()],t.prototype,"gamepadRotationSensibility",void 0),n([e.serialize()],t.prototype,"gamepadMoveSensibility",void 0),t}();e.ArcRotateCameraGamepadInput=t,e.CameraInputTypes.ArcRotateCameraGamepadInput=t}(s||(s={})),function(e){var t=function(){function t(t){var i=this;this._scene=t,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new e.Observable,e.Tools.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new e.Observable((function(e){for(var t in i._babylonGamepads){var r=i._babylonGamepads[__uv.$wrap((t))];r&&r._isConnected&&i.onGamepadConnectedObservable.notifyObserver(e,r)}})),this._onGamepadConnectedEvent=function(e){var t,r=e.gamepad;r.index in i._babylonGamepads&&i._babylonGamepads[__uv.$wrap((r.index))].isConnected||(i._babylonGamepads[__uv.$wrap((r.index))]?((t=i._babylonGamepads[__uv.$wrap((r.index))]).browserGamepad=r,t._isConnected=!0):t=i._addNewGamepad(r),i.onGamepadConnectedObservable.notifyObservers(t),i._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(e){var t=e.gamepad;for(var r in i._babylonGamepads)if(i._babylonGamepads[__uv.$wrap((r))].index===t.index){var n=i._babylonGamepads[__uv.$wrap((r))];n._isConnected=!1,i.onGamepadDisconnectedObservable.notifyObservers(n);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(t.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),t.prototype.getGamepadByType=function(t){void 0===t&&(t=e.Gamepad.XBOX);for(var i=0,r=this._babylonGamepads;i<r.length;i++){var n=r[__uv.$wrap((i))];if(n&&n.type===t)return n}return null},t.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach((function(e){e.dispose()})),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},t.prototype._addNewGamepad=function(t){var i;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var r=-1!==t.id.search("Xbox One");return i=r||-1!==t.id.search("Xbox 360")||-1!==t.id.search("xinput")?new e.Xbox360Pad(t.id,t.index,t,r):t.pose?e.PoseEnabledControllerHelper.InitiateController(t):new e.GenericPad(t.id,t.index,t),this._babylonGamepads[__uv.$wrap((i.index))]=i,i},t.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},t.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},t.prototype._checkGamepadsStatus=function(){var t=this;for(var i in this._updateGamepadObjects(),this._babylonGamepads){var r=this._babylonGamepads[__uv.$wrap((i))];r&&r.isConnected&&r.update()}this._isMonitoring&&!this._scene&&e.Tools.QueueNewFrame((function(){t._checkGamepadsStatus()}))},t.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++){var i=e[__uv.$wrap((t))];if(i)if(this._babylonGamepads[__uv.$wrap((i.index))])this._babylonGamepads[__uv.$wrap((t))].browserGamepad=i,this._babylonGamepads[__uv.$wrap((t))].isConnected||(this._babylonGamepads[__uv.$wrap((t))]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[__uv.$wrap((t))]));else{var r=this._addNewGamepad(i);this.onGamepadConnectedObservable.notifyObservers(r)}}},t}();e.GamepadManager=t}(s||(s={})),function(e){var t=function(e,t){this.x=e,this.y=t};e.StickValues=t;var i=function(){function e(t,i,r,n,a,o,s){void 0===n&&(n=0),void 0===a&&(a=1),void 0===o&&(o=2),void 0===s&&(s=3),this.id=t,this.index=i,this.browserGamepad=r,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=n,this._leftStickAxisY=a,this._rightStickAxisX=o,this._rightStickAxisY=s,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[__uv.$wrap((this._leftStickAxisX))],y:this.browserGamepad.axes[__uv.$wrap((this._leftStickAxisY))]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[__uv.$wrap((this._rightStickAxisX))],y:this.browserGamepad.axes[__uv.$wrap((this._rightStickAxisY))]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[__uv.$wrap((this._leftStickAxisX))],y:this.browserGamepad.axes[__uv.$wrap((this._leftStickAxisY))]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[__uv.$wrap((this._rightStickAxisX))],y:this.browserGamepad.axes[__uv.$wrap((this._rightStickAxisY))]})},e.prototype.dispose=function(){},e.GAMEPAD=0,e.GENERIC=1,e.XBOX=2,e.POSE_ENABLED=3,e}();e.Gamepad=i;var r=function(t){function r(r,n,a){var o=t.call(this,r,n,a)||this;return o.onButtonDownObservable=new e.Observable,o.onButtonUpObservable=new e.Observable,o.type=i.GENERIC,o._buttons=new Array(a.buttons.length),o}return a(r,t),r.prototype.onbuttondown=function(e){this._onbuttondown=e},r.prototype.onbuttonup=function(e){this._onbuttonup=e},r.prototype._setButtonValue=function(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e},r.prototype.update=function(){t.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._buttons[__uv.$wrap((e))]=this._setButtonValue(this.browserGamepad.buttons[__uv.$wrap((e))].value,this._buttons[__uv.$wrap((e))],e)},r.prototype.dispose=function(){t.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},r}(i);e.GenericPad=r}(s||(s={})),function(e){var t,i;!function(e){e[__uv.$wrap((e.A=0))]="A",e[__uv.$wrap((e.B=1))]="B",e[__uv.$wrap((e.X=2))]="X",e[__uv.$wrap((e.Y=3))]="Y",e[__uv.$wrap((e.Start=4))]="Start",e[__uv.$wrap((e.Back=5))]="Back",e[__uv.$wrap((e.LB=6))]="LB",e[__uv.$wrap((e.RB=7))]="RB",e[__uv.$wrap((e.LeftStick=8))]="LeftStick",e[__uv.$wrap((e.RightStick=9))]="RightStick"}(t=e.Xbox360Button||(e.Xbox360Button={})),function(e){e[__uv.$wrap((e.Up=0))]="Up",e[__uv.$wrap((e.Down=1))]="Down",e[__uv.$wrap((e.Left=2))]="Left",e[__uv.$wrap((e.Right=3))]="Right"}(i=e.Xbox360Dpad||(e.Xbox360Dpad={}));var r=function(r){function n(t,i,n,a){void 0===a&&(a=!1);var o=r.call(this,t,i,n,0,1,2,3)||this;return o._leftTrigger=0,o._rightTrigger=0,o.onButtonDownObservable=new e.Observable,o.onButtonUpObservable=new e.Observable,o.onPadDownObservable=new e.Observable,o.onPadUpObservable=new e.Observable,o._buttonA=0,o._buttonB=0,o._buttonX=0,o._buttonY=0,o._buttonBack=0,o._buttonStart=0,o._buttonLB=0,o._buttonRB=0,o._buttonLeftStick=0,o._buttonRightStick=0,o._dPadUp=0,o._dPadDown=0,o._dPadLeft=0,o._dPadRight=0,o._isXboxOnePad=!1,o.type=e.Gamepad.XBOX,o._isXboxOnePad=a,o}return a(n,r),n.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},n.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(n.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),n.prototype.onbuttondown=function(e){this._onbuttondown=e},n.prototype.onbuttonup=function(e){this._onbuttonup=e},n.prototype.ondpaddown=function(e){this._ondpaddown=e},n.prototype.ondpadup=function(e){this._ondpadup=e},n.prototype._setButtonValue=function(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e},n.prototype._setDPadValue=function(e,t,i){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===e&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),e},Object.defineProperty(n.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,t.A)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,t.B)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,t.X)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,t.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,t.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,t.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,t.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,t.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,t.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,t.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,i.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,i.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,i.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,i.Right)},enumerable:!0,configurable:!0}),n.prototype.update=function(){r.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[__uv.$wrap((0))].value,this.buttonB=this.browserGamepad.buttons[__uv.$wrap((1))].value,this.buttonX=this.browserGamepad.buttons[__uv.$wrap((2))].value,this.buttonY=this.browserGamepad.buttons[__uv.$wrap((3))].value,this.buttonLB=this.browserGamepad.buttons[__uv.$wrap((4))].value,this.buttonRB=this.browserGamepad.buttons[__uv.$wrap((5))].value,this.leftTrigger=this.browserGamepad.axes[__uv.$wrap((2))],this.rightTrigger=this.browserGamepad.axes[__uv.$wrap((5))],this.buttonBack=this.browserGamepad.buttons[__uv.$wrap((9))].value,this.buttonStart=this.browserGamepad.buttons[__uv.$wrap((8))].value,this.buttonLeftStick=this.browserGamepad.buttons[__uv.$wrap((6))].value,this.buttonRightStick=this.browserGamepad.buttons[__uv.$wrap((7))].value,this.dPadUp=this.browserGamepad.buttons[__uv.$wrap((11))].value,this.dPadDown=this.browserGamepad.buttons[__uv.$wrap((12))].value,this.dPadLeft=this.browserGamepad.buttons[__uv.$wrap((13))].value,this.dPadRight=this.browserGamepad.buttons[__uv.$wrap((14))].value):(this.buttonA=this.browserGamepad.buttons[__uv.$wrap((0))].value,this.buttonB=this.browserGamepad.buttons[__uv.$wrap((1))].value,this.buttonX=this.browserGamepad.buttons[__uv.$wrap((2))].value,this.buttonY=this.browserGamepad.buttons[__uv.$wrap((3))].value,this.buttonLB=this.browserGamepad.buttons[__uv.$wrap((4))].value,this.buttonRB=this.browserGamepad.buttons[__uv.$wrap((5))].value,this.leftTrigger=this.browserGamepad.buttons[__uv.$wrap((6))].value,this.rightTrigger=this.browserGamepad.buttons[__uv.$wrap((7))].value,this.buttonBack=this.browserGamepad.buttons[__uv.$wrap((8))].value,this.buttonStart=this.browserGamepad.buttons[__uv.$wrap((9))].value,this.buttonLeftStick=this.browserGamepad.buttons[__uv.$wrap((10))].value,this.buttonRightStick=this.browserGamepad.buttons[__uv.$wrap((11))].value,this.dPadUp=this.browserGamepad.buttons[__uv.$wrap((12))].value,this.dPadDown=this.browserGamepad.buttons[__uv.$wrap((13))].value,this.dPadLeft=this.browserGamepad.buttons[__uv.$wrap((14))].value,this.dPadRight=this.browserGamepad.buttons[__uv.$wrap((15))].value)},n.prototype.dispose=function(){r.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},n}(e.Gamepad);e.Xbox360Pad=r}(s||(s={})),function(e){var t;!function(e){e[__uv.$wrap((e.VIVE=0))]="VIVE",e[__uv.$wrap((e.OCULUS=1))]="OCULUS",e[__uv.$wrap((e.WINDOWS=2))]="WINDOWS",e[__uv.$wrap((e.GEAR_VR=3))]="GEAR_VR",e[__uv.$wrap((e.DAYDREAM=4))]="DAYDREAM",e[__uv.$wrap((e.GENERIC=5))]="GENERIC"}(t=e.PoseEnabledControllerType||(e.PoseEnabledControllerType={}));var i=function(){function t(){}return t.InitiateController=function(t){return-1!==t.id.indexOf("Oculus Touch")?new e.OculusTouchController(t):0===t.id.indexOf(e.WindowsMotionController.GAMEPAD_ID_PREFIX)?new e.WindowsMotionController(t):-1!==t.id.toLowerCase().indexOf("openvr")?new e.ViveController(t):0===t.id.indexOf(e.GearVRController.GAMEPAD_ID_PREFIX)||-1!==t.id.indexOf("Oculus Go")?new e.GearVRController(t):0===t.id.indexOf(e.DaydreamController.GAMEPAD_ID_PREFIX)?new e.DaydreamController(t):new e.GenericController(t)},t}();e.PoseEnabledControllerHelper=i;var r=function(i){function r(r){var n=i.call(this,r.id,r.index,r)||this;return n._deviceRoomPosition=e.Vector3.Zero(),n._deviceRoomRotationQuaternion=new e.Quaternion,n.devicePosition=e.Vector3.Zero(),n.deviceRotationQuaternion=new e.Quaternion,n.deviceScaleFactor=1,n._trackPosition=!0,n._maxRotationDistFromHeadset=Math.PI/5,n._draggedRoomRotation=0,n._leftHandSystemQuaternion=new e.Quaternion,n._deviceToWorld=e.Matrix.Identity(),n._pointingPoseNode=null,n._workingMatrix=e.Matrix.Identity(),n._meshAttachedObservable=new e.Observable,n.type=e.Gamepad.POSE_ENABLED,n.controllerType=t.GENERIC,n.position=e.Vector3.Zero(),n.rotationQuaternion=new e.Quaternion,n._calculatedPosition=e.Vector3.Zero(),n._calculatedRotation=new e.Quaternion,e.Quaternion.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return a(r,i),r.prototype._disableTrackPosition=function(e){this._trackPosition&&(this._calculatedPosition.copyFrom(e),this._trackPosition=!1)},r.prototype.update=function(){i.prototype.update.call(this),this._updatePoseAndMesh()},r.prototype._updatePoseAndMesh=function(){var t=this.browserGamepad.pose;if((this.updateFromDevice(t),!this._trackPosition&&e.Engine.LastCreatedScene&&e.Engine.LastCreatedScene.activeCamera&&e.Engine.LastCreatedScene.activeCamera.devicePosition)&&((i=e.Engine.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(i.devicePosition),i.deviceRotationQuaternion)){var i;(i=i)._deviceRoomRotationQuaternion.toEulerAnglesToRef(e.Tmp.Vector3[__uv.$wrap((0))]);var r=Math.atan2(Math.sin(e.Tmp.Vector3[__uv.$wrap((0))].y-this._draggedRoomRotation),Math.cos(e.Tmp.Vector3[__uv.$wrap((0))].y-this._draggedRoomRotation));if(Math.abs(r)>this._maxRotationDistFromHeadset){var n=r-(r<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=n;var a=Math.sin(-n),o=Math.cos(-n);this._calculatedPosition.x=this._calculatedPosition.x*o-this._calculatedPosition.z*a,this._calculatedPosition.z=this._calculatedPosition.x*a+this._calculatedPosition.z*o}}e.Vector3.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),e.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},r.prototype.updateFromDevice=function(e){if(e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[__uv.$wrap((0))],e.position[__uv.$wrap((1))],-e.position[__uv.$wrap((2))]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var t=this.rawPose;e.orientation&&t.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[__uv.$wrap((0))],t.orientation[__uv.$wrap((1))],-t.orientation[__uv.$wrap((2))],-t.orientation[__uv.$wrap((3))]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},r.prototype.attachToMesh=function(t){if(this._mesh&&(this._mesh.__uv$setSource(__uv).__uv$parent=null),this._mesh=t,this._poseControlledCamera&&(this._mesh.__uv$setSource(__uv).__uv$parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new e.Quaternion),this._updatePoseAndMesh(),this._pointingPoseNode){for(var i=[],r=this._pointingPoseNode;r.__uv$setSource(__uv).__uv$parent;)i.push(r.__uv$setSource(__uv).__uv$parent),r=r.__uv$setSource(__uv).__uv$parent;i.reverse().forEach((function(e){e.computeWorldMatrix(!0)}))}this._meshAttachedObservable.notifyObservers(t)},r.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.__uv$setSource(__uv).__uv$parent=this._poseControlledCamera)},r.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,i.prototype.dispose.call(this)},Object.defineProperty(r.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),r.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this.mesh)return new e.Ray(e.Vector3.Zero(),new e.Vector3(0,0,1),t);var i=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),r=i.getTranslation(),n=new e.Vector3(0,0,-1),a=e.Vector3.TransformNormal(n,i),o=e.Vector3.Normalize(a);return new e.Ray(r,o,t)},r.POINTING_POSE="POINTING_POSE",r}(e.Gamepad);e.PoseEnabledController=r}(s||(s={})),function(e){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.onTriggerStateChangedObservable=new e.Observable,r.onMainButtonStateChangedObservable=new e.Observable,r.onSecondaryButtonStateChangedObservable=new e.Observable,r.onPadStateChangedObservable=new e.Observable,r.onPadValuesChangedObservable=new e.Observable,r.pad={x:0,y:0},r._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},r._buttons=new Array(i.buttons.length),r.hand=i.hand,r}return a(i,t),i.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(i.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),i.prototype.update=function(){t.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._setButtonValue(this.browserGamepad.buttons[__uv.$wrap((e))],this._buttons[__uv.$wrap((e))],e);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},i.prototype._setButtonValue=function(e,t,i){e||(e={pressed:!1,touched:!1,value:0}),t?(this._checkChanges(e,t),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,i,e),this._handleButtonChange(i,e,this._changes)),this._buttons[__uv.$wrap((i))].pressed=e.pressed,this._buttons[__uv.$wrap((i))].touched=e.touched,this._buttons[__uv.$wrap((i))].value=e.value<1e-8?0:e.value):this._buttons[__uv.$wrap((i))]={pressed:e.pressed,touched:e.touched,value:e.value}},i.prototype._checkChanges=function(e,t){return this._changes.pressChanged=e.pressed!==t.pressed,this._changes.touchChanged=e.touched!==t.touched,this._changes.valueChanged=e.value!==t.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},i.prototype.dispose=function(){t.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},i}(e.PoseEnabledController);e.WebVRController=t}(s||(s={})),function(e){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.onSecondaryTriggerStateChangedObservable=new e.Observable,r.onThumbRestChangedObservable=new e.Observable,r.controllerType=e.PoseEnabledControllerType.OCULUS,r}return a(i,t),i.prototype.initControllerMesh=function(t,r){var n,a=this;n="left"===this.hand?i.MODEL_LEFT_FILENAME:i.MODEL_RIGHT_FILENAME,e.SceneLoader.ImportMesh("",i.MODEL_BASE_URL,n,t,(function(e){a._defaultModel=e[__uv.$wrap((1))],a.attachToMesh(a._defaultModel),r&&r(a._defaultModel)}))},Object.defineProperty(i.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),i.prototype._handleButtonChange=function(e,t,i){var r=t,n="right"===this.hand?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(r);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[__uv.$wrap((3))].rotation.x=.2*-r.value,this._defaultModel.getChildren()[__uv.$wrap((3))].position.y=.005*-r.value,this._defaultModel.getChildren()[__uv.$wrap((3))].position.z=.005*-r.value),void this.onTriggerStateChangedObservable.notifyObservers(r);case 2:return this._defaultModel&&(this._defaultModel.getChildren()[__uv.$wrap((4))].position.x=n*r.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(r);case 3:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[__uv.$wrap((1))].position.y=-.001:this._defaultModel.getChildren()[__uv.$wrap((1))].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(r);case 4:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[__uv.$wrap((2))].position.y=-.001:this._defaultModel.getChildren()[__uv.$wrap((2))].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(r);case 5:return void this.onThumbRestChangedObservable.notifyObservers(r)}},i.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",i.MODEL_LEFT_FILENAME="left.babylon",i.MODEL_RIGHT_FILENAME="right.babylon",i}(e.WebVRController);e.OculusTouchController=t}(s||(s={})),function(e){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.controllerType=e.PoseEnabledControllerType.VIVE,r._invertLeftStickY=!0,r}return a(i,t),i.prototype.initControllerMesh=function(t,r){var n=this;e.SceneLoader.ImportMesh("",i.MODEL_BASE_URL,i.MODEL_FILENAME,t,(function(e){n._defaultModel=e[__uv.$wrap((1))],n.attachToMesh(n._defaultModel),r&&r(n._defaultModel)}))},Object.defineProperty(i.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),i.prototype._handleButtonChange=function(e,t,i){var r=t;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(r);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[__uv.$wrap((6))].rotation.x=.15*-r.value),void this.onTriggerStateChangedObservable.notifyObservers(r);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(r);case 3:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[__uv.$wrap((2))].position.y=-.001:this._defaultModel.getChildren()[__uv.$wrap((2))].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(r)}},i.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",i.MODEL_FILENAME="wand.babylon",i}(e.WebVRController);e.ViveController=t}(s||(s={})),function(e){var t=function(t){function i(e){return t.call(this,e)||this}return a(i,t),i.prototype.initControllerMesh=function(t,r){var n=this;e.SceneLoader.ImportMesh("",i.MODEL_BASE_URL,i.MODEL_FILENAME,t,(function(e){n._defaultModel=e[__uv.$wrap((1))],n.attachToMesh(n._defaultModel),r&&r(n._defaultModel)}))},i.prototype._handleButtonChange=function(e,t,i){console.log("Button id: "+e+"state: "),console.dir(t)},i.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",i.MODEL_FILENAME="generic.babylon",i}(e.WebVRController);e.GenericController=t}(s||(s={})),function(e){var t=function(){this.buttonMeshes={},this.axisMeshes={}},i=function(i){function r(t){var r=i.call(this,t)||this;return r._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:e.PoseEnabledController.POINTING_POSE},r.onTrackpadChangedObservable=new e.Observable,r.onTrackpadValuesChangedObservable=new e.Observable,r.trackpad={x:0,y:0},r.controllerType=e.PoseEnabledControllerType.WINDOWS,r._loadedMeshInfo=null,r}return a(r,i),Object.defineProperty(r.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),r.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[__uv.$wrap((2))]==this.trackpad.x&&this.browserGamepad.axes[__uv.$wrap((3))]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[__uv.$wrap((2))],this.trackpad.y=this.browserGamepad.axes[__uv.$wrap((3))],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},r.prototype.update=function(){if(i.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var e=0;e<this._mapping.axisMeshNames.length;e++)this._lerpAxisTransform(e,this.browserGamepad.axes[__uv.$wrap((e))])},r.prototype._handleButtonChange=function(e,t,i){var r=this._mapping.buttons[__uv.$wrap((e))];if(r){this._updateTrackpad();var n=this[__uv.$wrap((this._mapping.buttonObservableNames[__uv.$wrap((r))]))];n&&n.notifyObservers(t),this._lerpButtonTransform(r,t.value)}},r.prototype._lerpButtonTransform=function(t,i){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.buttonMeshes[__uv.$wrap((t))];r.unpressed.rotationQuaternion&&r.pressed.rotationQuaternion&&r.value.rotationQuaternion&&(e.Quaternion.SlerpToRef(r.unpressed.rotationQuaternion,r.pressed.rotationQuaternion,i,r.value.rotationQuaternion),e.Vector3.LerpToRef(r.unpressed.position,r.pressed.position,i,r.value.position))}},r.prototype._lerpAxisTransform=function(t,i){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.axisMeshes[__uv.$wrap((t))];if(r&&r.min.rotationQuaternion&&r.max.rotationQuaternion&&r.value.rotationQuaternion){var n=.5*i+.5;e.Quaternion.SlerpToRef(r.min.rotationQuaternion,r.max.rotationQuaternion,n,r.value.rotationQuaternion),e.Vector3.LerpToRef(r.min.position,r.max.position,n,r.value.position)}}},r.prototype.initControllerMesh=function(t,i,n){var a,o,s=this;if(void 0===n&&(n=!1),e.SceneLoader.IsPluginForExtensionAvailable(".glb")){var l="default";if(this.id&&!n){var c=this.id.match(r.GAMEPAD_ID_PATTERN);l=c&&c[__uv.$wrap((0))]||l}o="left"===this.hand?r.MODEL_LEFT_FILENAME:r.MODEL_RIGHT_FILENAME,a=r.MODEL_BASE_URL+l+"/"}else e.Tools.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),a=e.GenericController.MODEL_BASE_URL,o=e.GenericController.MODEL_FILENAME;e.SceneLoader.ImportMesh("",a,o,t,(function(e){s._loadedMeshInfo=s.processModel(t,e),s._loadedMeshInfo&&(s._defaultModel=s._loadedMeshInfo.rootNode,s.attachToMesh(s._defaultModel),i&&i(s._defaultModel))}),null,(function(t,r){e.Tools.Log(r),e.Tools.Warn("Failed to retrieve controller model from the remote server: "+a+o),n||s.initControllerMesh(t,i,!0)}))},r.prototype.processModel=function(t,i){for(var r=null,n=new e.Mesh(this.id+" "+this.hand,t),a=null,o=0;o<i.length;o++){var s=i[__uv.$wrap((o))];if(!s.__uv$setSource(__uv).__uv$parent){s.isPickable=!1,a=s;break}}return a?(a.setParent(n),r=this.createMeshInfo(n)):e.Tools.Warn("Could not find root node in model file."),r},r.prototype.createMeshInfo=function(i){var r,n=new t;for(n.rootNode=i,n.buttonMeshes={},n.axisMeshes={},r=0;r<this._mapping.buttons.length;r++){var a=this._mapping.buttonMeshNames[__uv.$wrap((this._mapping.buttons[__uv.$wrap((r))]))];if(a){var o=h(i,a);if(o){var s={index:r,value:d(o,"VALUE"),pressed:d(o,"PRESSED"),unpressed:d(o,"UNPRESSED")};s.value&&s.pressed&&s.unpressed?n.buttonMeshes[__uv.$wrap((this._mapping.buttons[__uv.$wrap((r))]))]=s:e.Tools.Warn("Missing button submesh under mesh with name: "+a+"(VALUE: "+!!s.value+", PRESSED: "+!!s.pressed+", UNPRESSED:"+!!s.unpressed+")")}else e.Tools.Warn("Missing button mesh with name: "+a)}else e.Tools.Log("Skipping unknown button at index: "+r+" with mapped name: "+this._mapping.buttons[__uv.$wrap((r))])}for(r=0;r<this._mapping.axisMeshNames.length;r++){var l=this._mapping.axisMeshNames[__uv.$wrap((r))];if(l){var c=h(i,l);if(c){var u={index:r,value:d(c,"VALUE"),min:d(c,"MIN"),max:d(c,"MAX")};u.value&&u.min&&u.max?n.axisMeshes[__uv.$wrap((r))]=u:e.Tools.Warn("Missing axis submesh under mesh with name: "+l+"(VALUE: "+!!u.value+", MIN: "+!!u.min+", MAX:"+!!u.max+")")}else e.Tools.Warn("Missing axis mesh with name: "+l)}else e.Tools.Log("Skipping unknown axis at index: "+r)}return n.pointingPoseNode=h(i,this._mapping.pointingPoseMeshName),n.pointingPoseNode?this._pointingPoseNode=n.pointingPoseNode:e.Tools.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),n;function h(e,t){return e.getChildMeshes(!1,(function(e){return e.name===t}))[__uv.$wrap((0))]}function d(e,t){return e.getChildMeshes(!0,(function(e){return e.name==t}))[__uv.$wrap((0))]}},r.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return i.prototype.getForwardRay.call(this,t);var r=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),n=r.getTranslation(),a=new e.Vector3(0,0,-1),o=e.Vector3.TransformNormal(a,r),s=e.Vector3.Normalize(o);return new e.Ray(n,s,t)},r.prototype.dispose=function(){i.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear()},r.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",r.MODEL_LEFT_FILENAME="left.glb",r.MODEL_RIGHT_FILENAME="right.glb",r.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",r.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,r}(e.WebVRController);e.WindowsMotionController=i}(s||(s={})),function(e){var t=function(t){function i(i){var r=t.call(this,i)||this;return r._buttonIndexToObservableNameMap=["onTrackpadChangedObservable","onTriggerStateChangedObservable"],r.controllerType=e.PoseEnabledControllerType.GEAR_VR,r._calculatedPosition=new e.Vector3("left"==r.hand?-.15:.15,-.5,.25),r._disableTrackPosition(r._calculatedPosition),r}return a(i,t),i.prototype.initControllerMesh=function(t,r){var n=this;e.SceneLoader.ImportMesh("",i.MODEL_BASE_URL,i.MODEL_FILENAME,t,(function(i){var a=new e.Mesh("",t);i[__uv.$wrap((1))].__uv$setSource(__uv).__uv$parent=a,i[__uv.$wrap((1))].position.z=-.15,n._defaultModel=a,n.attachToMesh(n._defaultModel),r&&r(n._defaultModel)}))},i.prototype._handleButtonChange=function(e,t,i){if(e<this._buttonIndexToObservableNameMap.length){var r=this[__uv.$wrap((this._buttonIndexToObservableNameMap[__uv.$wrap((e))]))];r&&r.notifyObservers(t)}},i.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",i.MODEL_FILENAME="generic.babylon",i.GAMEPAD_ID_PREFIX="Gear VR",i}(e.WebVRController);e.GearVRController=t}(s||(s={})),function(e){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.controllerType=e.PoseEnabledControllerType.DAYDREAM,r}return a(i,t),i.prototype.initControllerMesh=function(t,r){var n=this;e.SceneLoader.ImportMesh("",i.MODEL_BASE_URL,i.MODEL_FILENAME,t,(function(e){n._defaultModel=e[__uv.$wrap((1))],n.attachToMesh(n._defaultModel),r&&r(n._defaultModel)}))},i.prototype._handleButtonChange=function(t,i,r){if(0===t){var n=this.onTriggerStateChangedObservable;n&&n.notifyObservers(i)}else e.Tools.Warn("Unrecognized Daydream button index: "+t)},i.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",i.MODEL_FILENAME="generic.babylon",i.GAMEPAD_ID_PREFIX="Daydream",i}(e.WebVRController);e.DaydreamController=t}(s||(s={})),function(e){Object.defineProperty(e.Scene.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new e.GamepadManager(this);var i=this._getComponent(e.SceneComponentConstants.NAME_GAMEPAD);i||(i=new t(this),this._addComponent(i))}return this._gamepadManager},enumerable:!0,configurable:!0}),e.FreeCameraInputsManager.prototype.addGamepad=function(){return this.add(new e.FreeCameraGamepadInput),this},e.ArcRotateCameraInputsManager.prototype.addGamepad=function(){return this.add(new e.ArcRotateCameraGamepadInput),this};var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_GAMEPAD,this.scene=t}return t.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){var e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)},t.prototype._beforeCameraUpdate=function(){var e=this.scene._gamepadManager;e&&e._isMonitoring&&e._checkGamepadsStatus()},t}();e.GamepadSystemSceneComponent=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("FollowCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}})),e.Node.AddNodeConstructor("ArcFollowCamera",(function(e,t){return function(){return new i(e,0,0,1,null,t)}}));var t=function(t){function i(e,i,r,n){void 0===n&&(n=null);var a=t.call(this,e,i,r)||this;return a.radius=12,a.rotationOffset=0,a.heightOffset=4,a.cameraAcceleration=.05,a.maxCameraSpeed=20,a.lockedTarget=n,a}return a(i,t),i.prototype._follow=function(t){if(t){var i;if(t.rotationQuaternion){var r=new e.Matrix;t.rotationQuaternion.toRotationMatrix(r),i=Math.atan2(r.m[__uv.$wrap((8))],r.m[__uv.$wrap((10))])}else i=t.rotation.y;var n=e.Tools.ToRadians(this.rotationOffset)+i,a=t.getAbsolutePosition(),o=a.x+Math.sin(n)*this.radius,s=a.z+Math.cos(n)*this.radius,l=o-this.position.x,c=a.y+this.heightOffset-this.position.y,u=s-this.position.z,h=l*this.cameraAcceleration*2,d=c*this.cameraAcceleration,p=u*this.cameraAcceleration*2;(h>this.maxCameraSpeed||h<-this.maxCameraSpeed)&&(h=h<1?-this.maxCameraSpeed:this.maxCameraSpeed),(d>this.maxCameraSpeed||d<-this.maxCameraSpeed)&&(d=d<1?-this.maxCameraSpeed:this.maxCameraSpeed),(p>this.maxCameraSpeed||p<-this.maxCameraSpeed)&&(p=p<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new e.Vector3(this.position.x+h,this.position.y+d,this.position.z+p),this.setTarget(a)}},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},i.prototype.getClassName=function(){return"FollowCamera"},n([e.serialize()],i.prototype,"radius",void 0),n([e.serialize()],i.prototype,"rotationOffset",void 0),n([e.serialize()],i.prototype,"heightOffset",void 0),n([e.serialize()],i.prototype,"cameraAcceleration",void 0),n([e.serialize()],i.prototype,"maxCameraSpeed",void 0),n([e.serializeAsMeshReference("lockedTargetId")],i.prototype,"lockedTarget",void 0),i}(e.TargetCamera);e.FollowCamera=t;var i=function(t){function i(i,r,n,a,o,s){var l=t.call(this,i,e.Vector3.Zero(),s)||this;return l.alpha=r,l.beta=n,l.radius=a,l.target=o,l._cartesianCoordinates=e.Vector3.Zero(),l._follow(),l}return a(i,t),i.prototype._follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var e=this.target.getAbsolutePosition();this.position=e.add(this._cartesianCoordinates),this.setTarget(e)}},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this._follow()},i.prototype.getClassName=function(){return"ArcFollowCamera"},i}(e.TargetCamera);e.ArcFollowCamera=i}(s||(s={})),function(e){var t=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.inputs.addGamepad(),n}return a(t,e),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(e.TouchCamera);e.UniversalCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("GamepadCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(e){function t(t,i,r){return e.call(this,t,i,r)||this}return a(t,e),t.prototype.getClassName=function(){return"GamepadCamera"},t}(e.UniversalCamera);e.GamepadCamera=t}(s||(s={})),function(e){var t=function(){function e(){this._renderPipelines={}}return e.prototype.addPipeline=function(e){this._renderPipelines[__uv.$wrap((e._name))]=e},e.prototype.attachCamerasToRenderPipeline=function(e,t,i){void 0===i&&(i=!1);var r=this._renderPipelines[__uv.$wrap((e))];r&&r._attachCameras(t,i)},e.prototype.detachCamerasFromRenderPipeline=function(e,t){var i=this._renderPipelines[__uv.$wrap((e))];i&&i._detachCameras(t)},e.prototype.enableEffectInPipeline=function(e,t,i){var r=this._renderPipelines[__uv.$wrap((e))];r&&r._enableEffect(t,i)},e.prototype.disableEffectInPipeline=function(e,t,i){var r=this._renderPipelines[__uv.$wrap((e))];r&&r._disableEffect(t,i)},e.prototype.update=function(){for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var t=this._renderPipelines[__uv.$wrap((e))];t.isSupported?t._update():(t.dispose(),delete this._renderPipelines[__uv.$wrap((e))])}},e.prototype._rebuild=function(){for(var e in this._renderPipelines){if(this._renderPipelines.hasOwnProperty(e))this._renderPipelines[__uv.$wrap((e))]._rebuild()}},e.prototype.dispose=function(){for(var e in this._renderPipelines){if(this._renderPipelines.hasOwnProperty(e))this._renderPipelines[__uv.$wrap((e))].dispose()}},e}();e.PostProcessRenderPipelineManager=t}(s||(s={})),function(e){Object.defineProperty(e.Scene.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var i=this._getComponent(e.SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER);i||(i=new t(this),this._addComponent(i)),this._postProcessRenderPipelineManager=new e.PostProcessRenderPipelineManager}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=t}return t.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},t.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},t.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},t.prototype._gatherRenderTargets=function(e){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},t}();e.PostProcessRenderPipelineManagerSceneComponent=t}(s||(s={})),function(e){var t=function(){function t(e,t,i,r){this._name=t,this._singleInstance=r||!0,this._getPostProcesses=i,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(t.prototype,"isSupported",{get:function(){for(var e in this._postProcesses)if(this._postProcesses.hasOwnProperty(e))for(var t=this._postProcesses[__uv.$wrap((e))],i=0;i<t.length;i++)if(!t[__uv.$wrap((i))].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype._update=function(){},t.prototype._attachCameras=function(t){var i,r=this,n=e.Tools.MakeArray(t||this._cameras);if(n)for(var a=0;a<n.length;a++){var o=n[__uv.$wrap((a))],s=o.name;if(i=this._singleInstance?0:s,!this._postProcesses[__uv.$wrap((i))]){var l=this._getPostProcesses();l&&(this._postProcesses[__uv.$wrap((i))]=Array.isArray(l)?l:[l])}this._indicesForCamera[__uv.$wrap((s))]||(this._indicesForCamera[__uv.$wrap((s))]=[]),this._postProcesses[__uv.$wrap((i))].forEach((function(e){var t=o.attachPostProcess(e);r._indicesForCamera[__uv.$wrap((s))].push(t)})),this._cameras[__uv.$wrap((s))]||(this._cameras[__uv.$wrap((s))]=o)}},t.prototype._detachCameras=function(t){var i=e.Tools.MakeArray(t||this._cameras);if(i)for(var r=0;r<i.length;r++){var n=i[__uv.$wrap((r))],a=n.name;this._postProcesses[__uv.$wrap((this._singleInstance?0:a))].forEach((function(e){n.detachPostProcess(e)})),this._cameras[__uv.$wrap((a))]&&(this._cameras[__uv.$wrap((a))]=null)}},t.prototype._enable=function(t){var i=this,r=e.Tools.MakeArray(t||this._cameras);if(r)for(var n=0;n<r.length;n++)for(var a=r[__uv.$wrap((n))],o=a.name,s=0;s<this._indicesForCamera[__uv.$wrap((o))].length;s++)void 0!==a._postProcesses[__uv.$wrap((this._indicesForCamera[__uv.$wrap((o))][__uv.$wrap((s))]))]&&null!==a._postProcesses[__uv.$wrap((this._indicesForCamera[__uv.$wrap((o))][__uv.$wrap((s))]))]||this._postProcesses[__uv.$wrap((this._singleInstance?0:o))].forEach((function(e){r[__uv.$wrap((n))].attachPostProcess(e,i._indicesForCamera[__uv.$wrap((o))][__uv.$wrap((s))])}))},t.prototype._disable=function(t){var i=e.Tools.MakeArray(t||this._cameras);if(i)for(var r=0;r<i.length;r++){var n=i[__uv.$wrap((r))],a=n.name;this._postProcesses[__uv.$wrap((this._singleInstance?0:a))].forEach((function(e){n.detachPostProcess(e)}))}},t.prototype.getPostProcesses=function(e){return this._singleInstance?this._postProcesses[__uv.$wrap((0))]:e?this._postProcesses[__uv.$wrap((e.name))]:null},t}();e.PostProcessRenderEffect=t}(s||(s={})),function(e){var t=function(){function t(e,t){this.engine=e,this._name=t,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return t.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(t.prototype,"isSupported",{get:function(){for(var e in this._renderEffects)if(this._renderEffects.hasOwnProperty(e)&&!this._renderEffects[__uv.$wrap((e))].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype.addEffect=function(e){this._renderEffects[__uv.$wrap((e._name))]=e},t.prototype._rebuild=function(){},t.prototype._enableEffect=function(t,i){var r=this._renderEffects[__uv.$wrap((t))];r&&r._enable(e.Tools.MakeArray(i||this._cameras))},t.prototype._disableEffect=function(t,i){var r=this._renderEffects[__uv.$wrap((t))];r&&r._disable(e.Tools.MakeArray(i||this._cameras))},t.prototype._attachCameras=function(t,i){var r=e.Tools.MakeArray(t||this._cameras);if(r){var n,a=[];for(n=0;n<r.length;n++){var o=r[__uv.$wrap((n))],s=o.name;-1===this._cameras.indexOf(o)?this._cameras[__uv.$wrap((s))]=o:i&&a.push(n)}for(n=0;n<a.length;n++)t.splice(a[__uv.$wrap((n))],1);for(var l in this._renderEffects)this._renderEffects.hasOwnProperty(l)&&this._renderEffects[__uv.$wrap((l))]._attachCameras(r)}},t.prototype._detachCameras=function(t){var i=e.Tools.MakeArray(t||this._cameras);if(i){for(var r in this._renderEffects)this._renderEffects.hasOwnProperty(r)&&this._renderEffects[__uv.$wrap((r))]._detachCameras(i);for(var n=0;n<i.length;n++)this._cameras.splice(this._cameras.indexOf(i[__uv.$wrap((n))]),1)}},t.prototype._update=function(){for(var e in this._renderEffects)this._renderEffects.hasOwnProperty(e)&&this._renderEffects[__uv.$wrap((e))]._update();for(var t=0;t<this._cameras.length;t++){var i=this._cameras[__uv.$wrap((t))].name;this._renderEffectsForIsolatedPass[__uv.$wrap((i))]&&this._renderEffectsForIsolatedPass[__uv.$wrap((i))]._update()}},t.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},t.prototype._enableMSAAOnFirstPostProcess=function(e){var t=Object.keys(this._renderEffects);if(this.engine.webGLVersion>=2&&t.length>0){var i=this._renderEffects[__uv.$wrap((t[__uv.$wrap((0))]))].getPostProcesses();if(i)return i[__uv.$wrap((0))].samples=e,!0}return!1},t.prototype.dispose=function(){},n([e.serialize()],t.prototype,"_name",void 0),t}();e.PostProcessRenderPipeline=t}(s||(s={})),function(e){var t=function(){function t(t,i,r){void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT),void 0===r&&(r=null);var n=this;this.useOnlyInActiveCamera=!1,this._scene=t;var a=t._getComponent(e.SceneComponentConstants.NAME_DEPTHRENDERER);a||(a=new e.DepthRendererSceneComponent(t),t._addComponent(a)),this._camera=r;var o=t.getEngine();this._depthMap=new e.RenderTargetTexture("depthMap",{width:o.getRenderWidth(),height:o.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add((function(t){t.clear(new e.Color4(1,1,1,1),!0,!0,!0)}));var s=function(t){var i=t.getRenderingMesh(),r=n._scene,a=r.getEngine(),o=t.getMaterial();if(o){a.setState(o.backFaceCulling,0,!1,r.useRightHandedSystem);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var l=a.getCaps().instancedArrays&&null!==s.visibleInstances[__uv.$wrap((t._id))],c=n._camera||r.activeCamera;if(n.isReady(t,l)&&c){if(a.enableEffect(n._effect),i._bind(t,n._effect,e.Material.TriangleFillMode),n._effect.setMatrix("viewProjection",r.getTransformMatrix()),n._effect.setFloat2("depthValues",c.minZ,c.minZ+c.maxZ),o&&o.needAlphaTesting()){var u=o.getAlphaTestTexture();u&&(n._effect.setTexture("diffuseSampler",u),n._effect.setMatrix("diffuseMatrix",u.getTextureMatrix()))}i.useBones&&i.computeBonesUsingShaders&&i.skeleton&&n._effect.setMatrices("mBones",i.skeleton.getTransformMatrices(i)),i._processRendering(t,n._effect,e.Material.TriangleFillMode,s,l,(function(e,t){return n._effect.setMatrix("world",t)}))}}}};this._depthMap.customRenderFunction=function(e,t,i,r){var n;if(r.length){for(o.setColorWrite(!1),n=0;n<r.length;n++)s(r.data[__uv.$wrap((n))]);o.setColorWrite(!0)}for(n=0;n<e.length;n++)s(e.data[__uv.$wrap((n))]);for(n=0;n<t.length;n++)s(t.data[__uv.$wrap((n))])}}return t.prototype.isReady=function(t,i){var r=t.getMaterial();if(r.disableDepthWrite)return!1;var n=[],a=[e.VertexBuffer.PositionKind],o=t.getMesh();r&&r.needAlphaTesting()&&r.getAlphaTestTexture()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(a.push(e.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(a.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders?(a.push(e.VertexBuffer.MatricesIndicesKind),a.push(e.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(a.push(e.VertexBuffer.MatricesIndicesExtraKind),a.push(e.VertexBuffer.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"));var s=n.join("\n");return this._cachedDefines!==s&&(this._cachedDefines=s,this._effect=this._scene.getEngine().createEffect("depth",a,["world","mBones","viewProjection","diffuseMatrix","depthValues"],["diffuseSampler"],s)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(s||(s={})),function(e){e.Scene.prototype.enableDepthRenderer=function(t){if(!(t=t||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[__uv.$wrap((t.id))]){var i=0;if(this.getEngine().getCaps().textureHalfFloatRender)i=e.Engine.TEXTURETYPE_HALF_FLOAT;else{if(!this.getEngine().getCaps().textureFloatRender)throw"Depth renderer does not support int texture type";i=e.Engine.TEXTURETYPE_FLOAT}this._depthRenderer[__uv.$wrap((t.id))]=new e.DepthRenderer(this,i,t)}return this._depthRenderer[__uv.$wrap((t.id))]},e.Scene.prototype.disableDepthRenderer=function(e){(e=e||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[__uv.$wrap((e.id))]&&(this._depthRenderer[__uv.$wrap((e.id))].dispose(),delete this._depthRenderer[__uv.$wrap((e.id))])};var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_DEPTHRENDERER,this.scene=t}return t.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){for(var e in this.scene._depthRenderer)this.scene._depthRenderer[__uv.$wrap((e))].dispose()},t.prototype._gatherRenderTargets=function(e){if(this.scene._depthRenderer)for(var t in this.scene._depthRenderer){var i=this.scene._depthRenderer[__uv.$wrap((t))];i.useOnlyInActiveCamera||e.push(i.getDepthMap())}},t.prototype._gatherActiveCameraRenderTargets=function(e){if(this.scene._depthRenderer)for(var t in this.scene._depthRenderer){var i=this.scene._depthRenderer[__uv.$wrap((t))];i.useOnlyInActiveCamera&&this.scene.activeCamera.id===t&&e.push(i.getDepthMap())}},t}();e.DepthRendererSceneComponent=t}(s||(s={})),function(e){var t=function(){function t(t,i){void 0===i&&(i=1),this._enablePosition=!1,this._scene=t,this._ratio=i;var r=t._getComponent(e.SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER);r||(r=new e.GeometryBufferRendererSceneComponent(t),t._addComponent(r)),this._createRenderTargets()}return Object.defineProperty(t.prototype,"renderList",{set:function(e){this._multiRenderTarget.renderList=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(e){this._enablePosition=e,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ratio",{get:function(){return this._ratio},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,i){var r=t.getMaterial();if(r&&r.disableDepthWrite)return!1;var n=[],a=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh();r&&r.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(a.push(e.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(a.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),this._enablePosition&&n.push("#define POSITION"),o.useBones&&o.computeBonesUsingShaders?(a.push(e.VertexBuffer.MatricesIndicesKind),a.push(e.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(a.push(e.VertexBuffer.MatricesIndicesExtraKind),a.push(e.VertexBuffer.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"));var s=n.join("\n");return this._cachedDefines!==s&&(this._cachedDefines=s,this._effect=this._scene.getEngine().createEffect("geometry",a,["world","mBones","viewProjection","diffuseMatrix","view"],["diffuseSampler"],s,void 0,void 0,void 0,{buffersCount:this._enablePosition?3:2})),this._effect.isReady()},t.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(t.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(e){this._multiRenderTarget.samples=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.getGBuffer().dispose()},t.prototype._createRenderTargets=function(){var t=this,i=this._scene.getEngine(),r=this._enablePosition?3:2;if(this._multiRenderTarget=new e.MultiRenderTarget("gBuffer",{width:i.getRenderWidth()*this._ratio,height:i.getRenderHeight()*this._ratio},r,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:e.Engine.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add((function(t){t.clear(new e.Color4(0,0,0,1),!0,!0,!0)}));var n=function(i){var r=i.getRenderingMesh(),n=t._scene,a=n.getEngine(),o=i.getMaterial();if(o){a.setState(o.backFaceCulling,0,!1,n.useRightHandedSystem);var s=r._getInstancesRenderList(i._id);if(!s.mustReturn){var l=a.getCaps().instancedArrays&&null!==s.visibleInstances[__uv.$wrap((i._id))];if(t.isReady(i,l)){if(a.enableEffect(t._effect),r._bind(i,t._effect,e.Material.TriangleFillMode),t._effect.setMatrix("viewProjection",n.getTransformMatrix()),t._effect.setMatrix("view",n.getViewMatrix()),o&&o.needAlphaTesting()){var c=o.getAlphaTestTexture();c&&(t._effect.setTexture("diffuseSampler",c),t._effect.setMatrix("diffuseMatrix",c.getTextureMatrix()))}r.useBones&&r.computeBonesUsingShaders&&r.skeleton&&t._effect.setMatrices("mBones",r.skeleton.getTransformMatrices(r)),r._processRendering(i,t._effect,e.Material.TriangleFillMode,s,l,(function(e,i){return t._effect.setMatrix("world",i)}))}}}};this._multiRenderTarget.customRenderFunction=function(e,t,r,a){var o;if(a.length){for(i.setColorWrite(!1),o=0;o<a.length;o++)n(a.data[__uv.$wrap((o))]);i.setColorWrite(!0)}for(o=0;o<e.length;o++)n(e.data[__uv.$wrap((o))]);for(o=0;o<t.length;o++)n(t.data[__uv.$wrap((o))])}}},t}();e.GeometryBufferRenderer=t}(s||(s={})),function(e){Object.defineProperty(e.Scene.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(e){e&&e.isSupported&&(this._geometryBufferRenderer=e)},enumerable:!0,configurable:!0}),e.Scene.prototype.enableGeometryBufferRenderer=function(t){return void 0===t&&(t=1),this._geometryBufferRenderer||(this._geometryBufferRenderer=new e.GeometryBufferRenderer(this,t),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null)),this._geometryBufferRenderer},e.Scene.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER,this.scene=t}return t.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(e.SceneComponentConstants.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t.prototype._gatherRenderTargets=function(e){this.scene._geometryBufferRenderer&&e.push(this.scene._geometryBufferRenderer.getGBuffer())},t}();e.GeometryBufferRendererSceneComponent=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){var o=t.call(this,r.getEngine(),i)||this;o.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",o.SSAORenderEffect="SSAORenderEffect",o.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",o.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",o.SSAOCombineRenderEffect="SSAOCombineRenderEffect",o.totalStrength=1,o.radius=1e-4,o.area=.0075,o.fallOff=1e-6,o.base=.5,o._firstUpdate=!0,o._scene=r,o._createRandomTexture(),o._depthTexture=r.enableDepthRenderer().getDepthMap();var s=n.ssaoRatio||n,l=n.combineRatio||n;return o._originalColorPostProcess=new e.PassPostProcess("SSAOOriginalSceneColor",l,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),o._createSSAOPostProcess(s),o._createBlurPostProcess(s),o._createSSAOCombinePostProcess(l),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAOOriginalSceneColorEffect,(function(){return o._originalColorPostProcess}),!0)),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAORenderEffect,(function(){return o._ssaoPostProcess}),!0)),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAOBlurHRenderEffect,(function(){return o._blurHPostProcess}),!0)),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAOBlurVRenderEffect,(function(){return o._blurVPostProcess}),!0)),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAOCombineRenderEffect,(function(){return o._ssaoCombinePostProcess}),!0)),r.postProcessRenderPipelineManager.addPipeline(o),a&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,a),o}return a(i,t),i.prototype.dispose=function(e){void 0===e&&(e=!1);for(var i=0;i<this._scene.cameras.length;i++){var r=this._scene.cameras[__uv.$wrap((i))];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),t.prototype.dispose.call(this)},i.prototype._createBlurPostProcess=function(t){var i=this;this._blurHPostProcess=new e.BlurPostProcess("BlurH",new e.Vector2(1,0),16,t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new e.BlurPostProcess("BlurV",new e.Vector2(0,1),16,t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add((function(){var e=i._blurHPostProcess.width/i._scene.getEngine().getRenderWidth();i._blurHPostProcess.kernel=16*e})),this._blurVPostProcess.onActivateObservable.add((function(){var e=i._blurVPostProcess.height/i._scene.getEngine().getRenderHeight();i._blurVPostProcess.kernel=16*e}))},i.prototype._rebuild=function(){this._firstUpdate=!0,t.prototype._rebuild.call(this)},i.prototype._createSSAOPostProcess=function(t){var i=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new e.PostProcess("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO"),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3("sampleSphere",r),e.setFloat("samplesFactor",1/16),e.setFloat("randTextureTiles",4)),e.setFloat("totalStrength",i.totalStrength),e.setFloat("radius",i.radius),e.setFloat("area",i.area),e.setFloat("fallOff",i.fallOff),e.setFloat("base",i.base),e.setTexture("textureSampler",i._depthTexture),e.setTexture("randomSampler",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(t){t.setVector4("viewport",e.Tmp.Vector4[__uv.$wrap((0))].copyFromFloats(0,0,1,1)),t.setTextureFromPostProcess("originalColor",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){this._randomTexture=new e.DynamicTexture("SSAORandomTexture",512,this._scene,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var t=this._randomTexture.getContext(),i=function(e,t){return Math.random()*(t-e)+e},r=e.Vector3.Zero(),n=0;n<512;n++)for(var a=0;a<512;a++)r.x=Math.floor(255*i(-1,1)),r.y=Math.floor(255*i(-1,1)),r.z=Math.floor(255*i(-1,1)),t.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",t.fillRect(n,a,1,1);this._randomTexture.update(!1)},n([e.serialize()],i.prototype,"totalStrength",void 0),n([e.serialize()],i.prototype,"radius",void 0),n([e.serialize()],i.prototype,"area",void 0),n([e.serialize()],i.prototype,"fallOff",void 0),n([e.serialize()],i.prototype,"base",void 0),i}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){var o=t.call(this,r.getEngine(),i)||this;if(o.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",o.SSAORenderEffect="SSAORenderEffect",o.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",o.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",o.SSAOCombineRenderEffect="SSAOCombineRenderEffect",o.totalStrength=1,o.maxZ=100,o.minZAspect=.2,o._samples=8,o._textureSamples=1,o._expensiveBlur=!0,o.radius=2,o.base=0,o._firstUpdate=!0,o._bits=new Uint32Array(1),o._scene=r,o._ratio=n,!o.isSupported)return e.Tools.Error("SSAO 2 needs WebGL 2 support."),o;var s=o._ratio.ssaoRatio||n,l=o._ratio.blurRatio||n,c=r.enableGeometryBufferRenderer();return o._createRandomTexture(),o._depthTexture=c.getGBuffer().textures[__uv.$wrap((0))],o._normalTexture=c.getGBuffer().textures[__uv.$wrap((1))],o._originalColorPostProcess=new e.PassPostProcess("SSAOOriginalSceneColor",1,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),o._originalColorPostProcess.samples=o.textureSamples,o._createSSAOPostProcess(1),o._createBlurPostProcess(s,l),o._createSSAOCombinePostProcess(l),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAOOriginalSceneColorEffect,(function(){return o._originalColorPostProcess}),!0)),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAORenderEffect,(function(){return o._ssaoPostProcess}),!0)),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAOBlurHRenderEffect,(function(){return o._blurHPostProcess}),!0)),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAOBlurVRenderEffect,(function(){return o._blurVPostProcess}),!0)),o.addEffect(new e.PostProcessRenderEffect(r.getEngine(),o.SSAOCombineRenderEffect,(function(){return o._ssaoCombinePostProcess}),!0)),r.postProcessRenderPipelineManager.addPipeline(o),a&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,a),o}return a(i,t),Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(e){this._ssaoPostProcess.updateEffect("#define SAMPLES "+e+"\n#define SSAO"),this._samples=e,this._sampleSphere=this._generateHemisphere(),this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(e){this._textureSamples=e,this._originalColorPostProcess.samples=e,this._blurHPostProcess.samples=e,this._blurVPostProcess.samples=e,this._ssaoPostProcess.samples=e,this._ssaoCombinePostProcess.samples=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(e){this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._expensiveBlur=e,this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsSupported",{get:function(){var t=e.Engine.LastCreatedEngine;return!!t&&t.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),i.prototype.dispose=function(e){void 0===e&&(e=!1);for(var i=0;i<this._scene.cameras.length;i++){var r=this._scene.cameras[__uv.$wrap((i))];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),t.prototype.dispose.call(this)},i.prototype._createBlurPostProcess=function(t,i){var r=this;this._samplerOffsets=[];for(var n=this.expensiveBlur,a=-8;a<8;a++)this._samplerOffsets.push(2*a+.5);this._blurHPostProcess=new e.PostProcess("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(n?"1":"0")+"\n"),this._blurHPostProcess.onApply=function(e){r._scene.activeCamera&&(e.setFloat("outSize",r._ssaoCombinePostProcess.width>0?r._ssaoCombinePostProcess.width:r._originalColorPostProcess.width),e.setFloat("near",r._scene.activeCamera.minZ),e.setFloat("far",r._scene.activeCamera.maxZ),e.setFloat("radius",r.radius),e.setTexture("depthSampler",r._depthTexture),r._firstUpdate&&e.setArray("samplerOffsets",r._samplerOffsets))},this._blurVPostProcess=new e.PostProcess("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],i,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE "+(n?"1":"0")+"\n"),this._blurVPostProcess.onApply=function(e){r._scene.activeCamera&&(e.setFloat("outSize",r._ssaoCombinePostProcess.height>0?r._ssaoCombinePostProcess.height:r._originalColorPostProcess.height),e.setFloat("near",r._scene.activeCamera.minZ),e.setFloat("far",r._scene.activeCamera.maxZ),e.setFloat("radius",r.radius),e.setTexture("depthSampler",r._depthTexture),r._firstUpdate&&(e.setArray("samplerOffsets",r._samplerOffsets),r._firstUpdate=!1))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},i.prototype._rebuild=function(){this._firstUpdate=!0,t.prototype._rebuild.call(this)},i.prototype._radicalInverse_VdC=function(e){return this._bits[__uv.$wrap((0))]=e,this._bits[__uv.$wrap((0))]=(this._bits[__uv.$wrap((0))]<<16|this._bits[__uv.$wrap((0))]>>16)>>>0,this._bits[__uv.$wrap((0))]=(1431655765&this._bits[__uv.$wrap((0))])<<1|(2863311530&this._bits[__uv.$wrap((0))])>>>1>>>0,this._bits[__uv.$wrap((0))]=(858993459&this._bits[__uv.$wrap((0))])<<2|(3435973836&this._bits[__uv.$wrap((0))])>>>2>>>0,this._bits[__uv.$wrap((0))]=(252645135&this._bits[__uv.$wrap((0))])<<4|(4042322160&this._bits[__uv.$wrap((0))])>>>4>>>0,this._bits[__uv.$wrap((0))]=(16711935&this._bits[__uv.$wrap((0))])<<8|(4278255360&this._bits[__uv.$wrap((0))])>>>8>>>0,2.3283064365386963e-10*this._bits[__uv.$wrap((0))]},i.prototype._hammersley=function(e,t){return[e/t,this._radicalInverse_VdC(e)]},i.prototype._hemisphereSample_uniform=function(t,i){var r=2*i*Math.PI,n=1-(.85*t+.15),a=Math.sqrt(1-n*n);return new e.Vector3(Math.cos(r)*a,Math.sin(r)*a,n)},i.prototype._generateHemisphere=function(){for(var e,t=this.samples,i=[],r=0;r<t;){if(t<16)e=this._hemisphereSample_uniform(Math.random(),Math.random());else{var n=this._hammersley(r,t);e=this._hemisphereSample_uniform(n[__uv.$wrap((0))],n[__uv.$wrap((1))])}i.push(e.x,e.y,e.z),r++}return i},i.prototype._createSSAOPostProcess=function(t){var i=this,r=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new e.PostProcess("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+r+"\n#define SSAO"),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3("sampleSphere",i._sampleSphere),e.setFloat("randTextureTiles",32)),i._scene.activeCamera&&(e.setFloat("samplesFactor",1/i.samples),e.setFloat("totalStrength",i.totalStrength),e.setFloat2("texelSize",1/i._ssaoPostProcess.width,1/i._ssaoPostProcess.height),e.setFloat("radius",i.radius),e.setFloat("maxZ",i.maxZ),e.setFloat("minZAspect",i.minZAspect),e.setFloat("base",i.base),e.setFloat("near",i._scene.activeCamera.minZ),e.setFloat("far",i._scene.activeCamera.maxZ),e.setFloat("xViewport",Math.tan(i._scene.activeCamera.fov/2)*i._scene.getEngine().getAspectRatio(i._scene.activeCamera,!0)),e.setFloat("yViewport",Math.tan(i._scene.activeCamera.fov/2)),e.setMatrix("projection",i._scene.getProjectionMatrix()),e.setTexture("textureSampler",i._depthTexture),e.setTexture("normalSampler",i._normalTexture),e.setTexture("randomSampler",i._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(t){var r=i._scene.activeCamera.viewport;t.setVector4("viewport",e.Tmp.Vector4[__uv.$wrap((0))].copyFromFloats(r.x,r.y,r.width,r.height)),t.setTextureFromPostProcess("originalColor",i._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples},i.prototype._createRandomTexture=function(){this._randomTexture=new e.DynamicTexture("SSAORandomTexture",128,this._scene,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var t=this._randomTexture.getContext(),i=function(e,t){return Math.random()*(t-e)+e},r=e.Vector3.Zero(),n=0;n<128;n++)for(var a=0;a<128;a++)r.x=i(0,1),r.y=i(0,1),r.z=0,r.normalize(),r.scaleInPlace(255),r.x=Math.floor(r.x),r.y=Math.floor(r.y),t.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",t.fillRect(n,a,1,1);this._randomTexture.update(!1)},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="SSAO2RenderingPipeline",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse((function(){return new i(t._name,r,t._ratio)}),t,r,n)},n([e.serialize()],i.prototype,"totalStrength",void 0),n([e.serialize()],i.prototype,"maxZ",void 0),n([e.serialize()],i.prototype,"minZAspect",void 0),n([e.serialize("samples")],i.prototype,"_samples",void 0),n([e.serialize("textureSamples")],i.prototype,"_textureSamples",void 0),n([e.serialize()],i.prototype,"_ratio",void 0),n([e.serialize("expensiveBlur")],i.prototype,"_expensiveBlur",void 0),n([e.serialize()],i.prototype,"radius",void 0),n([e.serialize()],i.prototype,"base",void 0),i}(e.PostProcessRenderPipeline);e.SSAO2RenderingPipeline=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o){void 0===a&&(a=1);var s=t.call(this,n.getEngine(),i)||this;return s.LensChromaticAberrationEffect="LensChromaticAberrationEffect",s.HighlightsEnhancingEffect="HighlightsEnhancingEffect",s.LensDepthOfFieldEffect="LensDepthOfFieldEffect",s._scene=n,s._depthTexture=n.enableDepthRenderer().getDepthMap(),r.grain_texture?s._grainTexture=r.grain_texture:s._createGrainTexture(),s._edgeBlur=r.edge_blur?r.edge_blur:0,s._grainAmount=r.grain_amount?r.grain_amount:0,s._chromaticAberration=r.chromatic_aberration?r.chromatic_aberration:0,s._distortion=r.distortion?r.distortion:0,s._highlightsGain=void 0!==r.dof_gain?r.dof_gain:-1,s._highlightsThreshold=r.dof_threshold?r.dof_threshold:1,s._dofDistance=void 0!==r.dof_focus_distance?r.dof_focus_distance:-1,s._dofAperture=r.dof_aperture?r.dof_aperture:1,s._dofDarken=r.dof_darken?r.dof_darken:0,s._dofPentagon=void 0===r.dof_pentagon||r.dof_pentagon,s._blurNoise=void 0===r.blur_noise||r.blur_noise,s._createChromaticAberrationPostProcess(a),s._createHighlightsPostProcess(a),s._createDepthOfFieldPostProcess(a/4),s.addEffect(new e.PostProcessRenderEffect(n.getEngine(),s.LensChromaticAberrationEffect,(function(){return s._chromaticAberrationPostProcess}),!0)),s.addEffect(new e.PostProcessRenderEffect(n.getEngine(),s.HighlightsEnhancingEffect,(function(){return s._highlightsPostProcess}),!0)),s.addEffect(new e.PostProcessRenderEffect(n.getEngine(),s.LensDepthOfFieldEffect,(function(){return s._depthOfFieldPostProcess}),!0)),-1===s._highlightsGain&&s._disableEffect(s.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(s),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o),s}return a(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n")},i.prototype.disablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect()},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat("chromatic_aberration",i._chromaticAberration),e.setFloat("screen_width",i._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",i._scene.getEngine().getRenderHeight()),e.setFloat("radialIntensity",1),e.setFloat2("direction",17,17),e.setFloat2("centerPosition",.5,.5)}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.onApply=function(e){e.setFloat("gain",i._highlightsGain),e.setFloat("threshold",i._highlightsThreshold),e.setTextureFromPostProcess("textureSampler",i._chromaticAberrationPostProcess),e.setFloat("screen_width",i._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",i._scene.getEngine().getRenderHeight())}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture("depthSampler",i._depthTexture),e.setTexture("grainSampler",i._grainTexture),e.setTextureFromPostProcess("textureSampler",i._highlightsPostProcess),e.setTextureFromPostProcess("highlightsSampler",i._depthOfFieldPostProcess),e.setFloat("grain_amount",i._grainAmount),e.setBool("blur_noise",i._blurNoise),e.setFloat("screen_width",i._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",i._scene.getEngine().getRenderHeight()),e.setFloat("distortion",i._distortion),e.setBool("dof_enabled",-1!==i._dofDistance),e.setFloat("screen_distance",1/(.1-1/i._dofDistance)),e.setFloat("aperture",i._dofAperture),e.setFloat("darken",i._dofDarken),e.setFloat("edge_blur",i._edgeBlur),e.setBool("highlights",-1!==i._highlightsGain),i._scene.activeCamera&&(e.setFloat("near",i._scene.activeCamera.minZ),e.setFloat("far",i._scene.activeCamera.maxZ))}},i.prototype._createGrainTexture=function(){this._grainTexture=new e.DynamicTexture("LensNoiseTexture",512,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var t,i,r,n=this._grainTexture.getContext(),a=0;a<512;a++)for(var o=0;o<512;o++)t=Math.floor(255*(i=.42,r=.58,Math.random()*(r-i)+i)),n.fillStyle="rgb("+t+", "+t+", "+t+")",n.fillRect(a,o,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o){void 0===a&&(a=null);var s=t.call(this,r.getEngine(),i)||this;return s.downSampleX4PostProcess=null,s.brightPassPostProcess=null,s.blurHPostProcesses=[],s.blurVPostProcesses=[],s.textureAdderPostProcess=null,s.volumetricLightPostProcess=null,s.volumetricLightSmoothXPostProcess=null,s.volumetricLightSmoothYPostProcess=null,s.volumetricLightMergePostProces=null,s.volumetricLightFinalPostProcess=null,s.luminancePostProcess=null,s.luminanceDownSamplePostProcesses=[],s.hdrPostProcess=null,s.textureAdderFinalPostProcess=null,s.lensFlareFinalPostProcess=null,s.hdrFinalPostProcess=null,s.lensFlarePostProcess=null,s.lensFlareComposePostProcess=null,s.motionBlurPostProcess=null,s.depthOfFieldPostProcess=null,s.fxaaPostProcess=null,s.brightThreshold=1,s.blurWidth=512,s.horizontalBlur=!1,s.exposure=1,s.lensTexture=null,s.volumetricLightCoefficient=.2,s.volumetricLightPower=4,s.volumetricLightBlurScale=64,s.sourceLight=null,s.hdrMinimumLuminance=1,s.hdrDecreaseRate=.5,s.hdrIncreaseRate=.5,s.lensColorTexture=null,s.lensFlareStrength=20,s.lensFlareGhostDispersal=1.4,s.lensFlareHaloWidth=.7,s.lensFlareDistortionStrength=16,s.lensStarTexture=null,s.lensFlareDirtTexture=null,s.depthOfFieldDistance=10,s.depthOfFieldBlurWidth=64,s.motionStrength=1,s.animations=[],s._currentDepthOfFieldSource=null,s._hdrCurrentLuminance=1,s._bloomEnabled=!1,s._depthOfFieldEnabled=!1,s._vlsEnabled=!1,s._lensFlareEnabled=!1,s._hdrEnabled=!1,s._motionBlurEnabled=!1,s._fxaaEnabled=!1,s._motionBlurSamples=64,s._volumetricLightStepsCount=50,s._samples=1,s._cameras=o||[],s._scene=r,s._basePostProcess=a,s._ratio=n,s._floatTextureType=r.getEngine().getCaps().textureFloatRender?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_HALF_FLOAT,r.postProcessRenderPipelineManager.addPipeline(s),s._buildPipeline(),s}return a(i,t),Object.defineProperty(i.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(e){this._lensFlareEnabled!==e&&(this._lensFlareEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(e){this._hdrEnabled!==e&&(this._hdrEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(t){if(this._vlsEnabled!==t){if(t)if(!this._scene.enableGeometryBufferRenderer())return void e.Tools.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");this._vlsEnabled=t,this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(e){this._motionBlurEnabled!==e&&(this._motionBlurEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(e){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS "+e.toFixed(1)),this._volumetricLightStepsCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this.motionBlurPostProcess&&this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+e.toFixed(1)),this._motionBlurSamples=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!0,configurable:!0}),i.prototype._buildPipeline=function(){var t=this,i=this._ratio,r=this._scene;this._disposePostProcesses(),this._reset(),this._basePostProcess?this.originalPostProcess=this._basePostProcess:(this.originalPostProcess=new e.PostProcess("HDRPass","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.onApply=function(e){t._currentDepthOfFieldSource=t.originalPostProcess}),(this._bloomEnabled||this._vlsEnabled||this._lensFlareEnabled||this._depthOfFieldEnabled||this._motionBlurEnabled)&&this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRPassPostProcess",(function(){return t.originalPostProcess}),!0)),this._currentDepthOfFieldSource=this.originalPostProcess,this._bloomEnabled&&(this._createDownSampleX4PostProcess(r,i/2),this._createBrightPassPostProcess(r,i/2),this._createBlurPostProcesses(r,i/4,1),this._createTextureAdderPostProcess(r,i),this.textureAdderFinalPostProcess=new e.PostProcess("HDRDepthOfFieldSource","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRBaseDepthOfFieldSource",(function(){return t.textureAdderFinalPostProcess}),!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(r,i),this.volumetricLightFinalPostProcess=new e.PostProcess("HDRVLSFinal","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRVLSFinal",(function(){return t.volumetricLightFinalPostProcess}),!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(r,i),this.lensFlareFinalPostProcess=new e.PostProcess("HDRPostLensFlareDepthOfFieldSource","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRPostLensFlareDepthOfFieldSource",(function(){return t.lensFlareFinalPostProcess}),!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(r,this._floatTextureType),this._createHdrPostProcess(r,i),this.hdrFinalPostProcess=new e.PostProcess("HDRPostHDReDepthOfFieldSource","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRPostHDReDepthOfFieldSource",(function(){return t.hdrFinalPostProcess}),!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(r,i/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(r,i)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(r,i),this._fxaaEnabled&&(this.fxaaPostProcess=new e.FxaaPostProcess("fxaa",1,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRFxaa",(function(){return t.fxaaPostProcess}),!0))),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&e.Tools.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},i.prototype._createDownSampleX4PostProcess=function(t,i){var r=this,n=new Array(32);this.downSampleX4PostProcess=new e.PostProcess("HDRDownSampleX4","standard",["dsOffsets"],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define DOWN_SAMPLE_X4",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.downSampleX4PostProcess.onApply=function(e){for(var t=0,i=r.downSampleX4PostProcess.width,a=r.downSampleX4PostProcess.height,o=-2;o<2;o++)for(var s=-2;s<2;s++)n[__uv.$wrap((t))]=(o+.5)*(1/i),n[__uv.$wrap((t+1))]=(s+.5)*(1/a),t+=2;e.setArray2("dsOffsets",n)},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRDownSampleX4",(function(){return r.downSampleX4PostProcess}),!0))},i.prototype._createBrightPassPostProcess=function(t,i){var r=this,n=new Array(8);this.brightPassPostProcess=new e.PostProcess("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define BRIGHT_PASS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.brightPassPostProcess.onApply=function(e){var t=1/r.brightPassPostProcess.width,i=1/r.brightPassPostProcess.height;n[__uv.$wrap((0))]=-.5*t,n[__uv.$wrap((1))]=.5*i,n[__uv.$wrap((2))]=.5*t,n[__uv.$wrap((3))]=.5*i,n[__uv.$wrap((4))]=-.5*t,n[__uv.$wrap((5))]=-.5*i,n[__uv.$wrap((6))]=.5*t,n[__uv.$wrap((7))]=-.5*i,e.setArray2("dsOffsets",n),e.setFloat("brightThreshold",r.brightThreshold)},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBrightPass",(function(){return r.brightPassPostProcess}),!0))},i.prototype._createBlurPostProcesses=function(t,i,r,n){var a=this;void 0===n&&(n="blurWidth");var o=t.getEngine(),s=new e.BlurPostProcess("HDRBlurH_"+r,new e.Vector2(1,0),this[__uv.$wrap((n))],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),l=new e.BlurPostProcess("HDRBlurV_"+r,new e.Vector2(0,1),this[__uv.$wrap((n))],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT);s.onActivateObservable.add((function(){var e=s.width/o.getRenderWidth();s.kernel=a[__uv.$wrap((n))]*e})),l.onActivateObservable.add((function(){var e=l.height/o.getRenderHeight();l.kernel=a.horizontalBlur?64*e:a[__uv.$wrap((n))]*e})),this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBlurH"+r,(function(){return s}),!0)),this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBlurV"+r,(function(){return l}),!0)),this.blurHPostProcesses.push(s),this.blurVPostProcesses.push(l)},i.prototype._createTextureAdderPostProcess=function(t,i){var r=this;this.textureAdderPostProcess=new e.PostProcess("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define TEXTURE_ADDER",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.textureAdderPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",r._vlsEnabled?r._currentDepthOfFieldSource:r.originalPostProcess),e.setTexture("lensSampler",r.lensTexture),e.setFloat("exposure",r.exposure),r._currentDepthOfFieldSource=r.textureAdderFinalPostProcess},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRTextureAdder",(function(){return r.textureAdderPostProcess}),!0))},i.prototype._createVolumetricLightPostProcess=function(t,i){var r=this,n=t.enableGeometryBufferRenderer();n.enablePosition=!0;var a=n.getGBuffer();this.volumetricLightPostProcess=new e.PostProcess("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],i/8,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define VLS\n#define NB_STEPS "+this._volumetricLightStepsCount.toFixed(1));var o=e.Vector2.Zero();this.volumetricLightPostProcess.onApply=function(e){if(r.sourceLight&&r.sourceLight.getShadowGenerator()&&r._scene.activeCamera){var t=r.sourceLight.getShadowGenerator();e.setTexture("shadowMapSampler",t.getShadowMap()),e.setTexture("positionSampler",a.textures[__uv.$wrap((2))]),e.setColor3("sunColor",r.sourceLight.diffuse),e.setVector3("sunDirection",r.sourceLight.getShadowDirection()),e.setVector3("cameraPosition",r._scene.activeCamera.globalPosition),e.setMatrix("shadowViewProjection",t.getTransformMatrix()),e.setFloat("scatteringCoefficient",r.volumetricLightCoefficient),e.setFloat("scatteringPower",r.volumetricLightPower),o.x=r.sourceLight.getDepthMinZ(r._scene.activeCamera),o.y=r.sourceLight.getDepthMaxZ(r._scene.activeCamera),e.setVector2("depthValues",o)}},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRVLS",(function(){return r.volumetricLightPostProcess}),!0)),this._createBlurPostProcesses(t,i/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new e.PostProcess("HDRVLSMerge","standard",[],["originalSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(e){e.setTextureFromPostProcess("originalSampler",r._bloomEnabled?r.textureAdderFinalPostProcess:r.originalPostProcess),r._currentDepthOfFieldSource=r.volumetricLightFinalPostProcess},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRVLSMerge",(function(){return r.volumetricLightMergePostProces}),!0))},i.prototype._createLuminancePostProcesses=function(t,r){var n=this,a=Math.pow(3,i.LuminanceSteps);this.luminancePostProcess=new e.PostProcess("HDRLuminance","standard",["lumOffsets"],[],{width:a,height:a},null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LUMINANCE",r);var o=[];this.luminancePostProcess.onApply=function(e){var t=1/n.luminancePostProcess.width,i=1/n.luminancePostProcess.height;o[__uv.$wrap((0))]=-.5*t,o[__uv.$wrap((1))]=.5*i,o[__uv.$wrap((2))]=.5*t,o[__uv.$wrap((3))]=.5*i,o[__uv.$wrap((4))]=-.5*t,o[__uv.$wrap((5))]=-.5*i,o[__uv.$wrap((6))]=.5*t,o[__uv.$wrap((7))]=-.5*i,e.setArray2("lumOffsets",o)},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLuminance",(function(){return n.luminancePostProcess}),!0));for(var s=i.LuminanceSteps-1;s>=0;s--){a=Math.pow(3,s);var l="#define LUMINANCE_DOWN_SAMPLE\n";0===s&&(l+="#define FINAL_DOWN_SAMPLER");var c=new e.PostProcess("HDRLuminanceDownSample"+s,"standard",["dsOffsets","halfDestPixelSize"],[],{width:a,height:a},null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,l,r);this.luminanceDownSamplePostProcesses.push(c)}var u=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach((function(i,r){var a=new Array(18);i.onApply=function(e){if(u){for(var t=0,o=-1;o<2;o++)for(var s=-1;s<2;s++)a[__uv.$wrap((t))]=o/u.width,a[__uv.$wrap((t+1))]=s/u.height,t+=2;e.setArray2("dsOffsets",a),e.setFloat("halfDestPixelSize",.5/u.width),u=r===n.luminanceDownSamplePostProcesses.length-1?n.luminancePostProcess:i}},r===n.luminanceDownSamplePostProcesses.length-1&&(i.onAfterRender=function(i){var r=t.getEngine().readPixels(0,0,1,1),a=new e.Vector4(1/16581375,1/65025,1/255,1);n._hdrCurrentLuminance=(r[__uv.$wrap((0))]*a.x+r[__uv.$wrap((1))]*a.y+r[__uv.$wrap((2))]*a.z+r[__uv.$wrap((3))]*a.w)/100}),n.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLuminanceDownSample"+r,(function(){return i}),!0))}))},i.prototype._createHdrPostProcess=function(t,i){var r=this;this.hdrPostProcess=new e.PostProcess("HDR","standard",["averageLuminance"],["textureAdderSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define HDR",e.Engine.TEXTURETYPE_UNSIGNED_INT);var n=1,a=0,o=0;this.hdrPostProcess.onApply=function(i){if(i.setTextureFromPostProcess("textureAdderSampler",r._currentDepthOfFieldSource),a+=t.getEngine().getDeltaTime(),n<0)n=r._hdrCurrentLuminance;else{var s=(o-a)/1e3;r._hdrCurrentLuminance<n+r.hdrDecreaseRate*s?n+=r.hdrDecreaseRate*s:r._hdrCurrentLuminance>n-r.hdrIncreaseRate*s?n-=r.hdrIncreaseRate*s:n=r._hdrCurrentLuminance}n=e.Scalar.Clamp(n,r.hdrMinimumLuminance,1e20),i.setFloat("averageLuminance",n),o=a,r._currentDepthOfFieldSource=r.hdrFinalPostProcess},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDR",(function(){return r.hdrPostProcess}),!0))},i.prototype._createLensFlarePostProcess=function(t,i){var r=this;this.lensFlarePostProcess=new e.PostProcess("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],i/2,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LENS_FLARE",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLensFlare",(function(){return r.lensFlarePostProcess}),!0)),this._createBlurPostProcesses(t,i/4,2),this.lensFlareComposePostProcess=new e.PostProcess("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LENS_FLARE_COMPOSE",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLensFlareCompose",(function(){return r.lensFlareComposePostProcess}),!0));var n=new e.Vector2(0,0);this.lensFlarePostProcess.onApply=function(e){e.setTextureFromPostProcess("textureSampler",r._bloomEnabled?r.blurHPostProcesses[__uv.$wrap((0))]:r.originalPostProcess),e.setTexture("lensColorSampler",r.lensColorTexture),e.setFloat("strength",r.lensFlareStrength),e.setFloat("ghostDispersal",r.lensFlareGhostDispersal),e.setFloat("haloWidth",r.lensFlareHaloWidth),n.x=r.lensFlarePostProcess.width,n.y=r.lensFlarePostProcess.height,e.setVector2("resolution",n),e.setFloat("distortionStrength",r.lensFlareDistortionStrength)};var a=e.Matrix.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),o=e.Matrix.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(t){if(r._scene.activeCamera){t.setTextureFromPostProcess("otherSampler",r._currentDepthOfFieldSource),t.setTexture("lensDirtSampler",r.lensFlareDirtTexture),t.setTexture("lensStarSampler",r.lensStarTexture);var i=r._scene.activeCamera.getViewMatrix().getRow(0),n=r._scene.activeCamera.getViewMatrix().getRow(2),s=e.Vector3.Dot(i.toVector3(),new e.Vector3(1,0,0))+e.Vector3.Dot(n.toVector3(),new e.Vector3(0,0,1));s*=4;var l=e.Matrix.FromValues(.5*Math.cos(s),-Math.sin(s),0,0,Math.sin(s),.5*Math.cos(s),0,0,0,0,1,0,0,0,0,1),c=o.multiply(l).multiply(a);t.setMatrix("lensStarMatrix",c),r._currentDepthOfFieldSource=r.lensFlareFinalPostProcess}}},i.prototype._createDepthOfFieldPostProcess=function(t,i){var r=this;this.depthOfFieldPostProcess=new e.PostProcess("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define DEPTH_OF_FIELD",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",r._currentDepthOfFieldSource),e.setTexture("depthSampler",r._getDepthTexture()),e.setFloat("distance",r.depthOfFieldDistance)},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRDepthOfField",(function(){return r.depthOfFieldPostProcess}),!0))},i.prototype._createMotionBlurPostProcess=function(t,i){var r=this;this.motionBlurPostProcess=new e.PostProcess("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+this.motionBlurSamples.toFixed(1),e.Engine.TEXTURETYPE_UNSIGNED_INT);var n=0,a=e.Matrix.Identity(),o=e.Matrix.Identity(),s=e.Matrix.Identity(),l=e.Vector2.Zero();this.motionBlurPostProcess.onApply=function(e){(s=t.getProjectionMatrix().multiply(t.getViewMatrix())).invertToRef(o),e.setMatrix("inverseViewProjection",o),e.setMatrix("prevViewProjection",a),a=s,l.x=r.motionBlurPostProcess.width,l.y=r.motionBlurPostProcess.height,e.setVector2("screenSize",l),n=t.getEngine().getFps()/60,e.setFloat("motionScale",n),e.setFloat("motionStrength",r.motionStrength),e.setTexture("depthSampler",r._getDepthTexture())},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRMotionBlur",(function(){return r.motionBlurPostProcess}),!0))},i.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[__uv.$wrap((0))]:this._scene.enableDepthRenderer().getDepthMap()},i.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var t=this._cameras[__uv.$wrap((e))];this.originalPostProcess&&this.originalPostProcess.dispose(t),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(t),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(t),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(t),this.textureAdderFinalPostProcess&&this.textureAdderFinalPostProcess.dispose(t),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(t),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(t),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(t),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(t),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(t),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(t),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(t);for(var i=0;i<this.luminanceDownSamplePostProcesses.length;i++)this.luminanceDownSamplePostProcesses[__uv.$wrap((i))].dispose(t);this.luminancePostProcess&&this.luminancePostProcess.dispose(t),this.hdrPostProcess&&this.hdrPostProcess.dispose(t),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(t),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(t),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(t),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(t);for(i=0;i<this.blurHPostProcesses.length;i++)this.blurHPostProcesses[__uv.$wrap((i))].dispose(t);for(i=0;i<this.blurVPostProcesses.length;i++)this.blurVPostProcesses[__uv.$wrap((i))].dispose(t)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},i.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),t.prototype.dispose.call(this)},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return this.sourceLight&&(t.sourceLightId=this.sourceLight.id),t.customType="StandardRenderingPipeline",t},i.Parse=function(t,r,n){var a=e.SerializationHelper.Parse((function(){return new i(t._name,r,t._ratio)}),t,r,n);return t.sourceLightId&&(a.sourceLight=r.getLightByID(t.sourceLightId)),a},i.LuminanceSteps=6,n([e.serialize()],i.prototype,"brightThreshold",void 0),n([e.serialize()],i.prototype,"blurWidth",void 0),n([e.serialize()],i.prototype,"horizontalBlur",void 0),n([e.serialize()],i.prototype,"exposure",void 0),n([e.serializeAsTexture("lensTexture")],i.prototype,"lensTexture",void 0),n([e.serialize()],i.prototype,"volumetricLightCoefficient",void 0),n([e.serialize()],i.prototype,"volumetricLightPower",void 0),n([e.serialize()],i.prototype,"volumetricLightBlurScale",void 0),n([e.serialize()],i.prototype,"hdrMinimumLuminance",void 0),n([e.serialize()],i.prototype,"hdrDecreaseRate",void 0),n([e.serialize()],i.prototype,"hdrIncreaseRate",void 0),n([e.serializeAsTexture("lensColorTexture")],i.prototype,"lensColorTexture",void 0),n([e.serialize()],i.prototype,"lensFlareStrength",void 0),n([e.serialize()],i.prototype,"lensFlareGhostDispersal",void 0),n([e.serialize()],i.prototype,"lensFlareHaloWidth",void 0),n([e.serialize()],i.prototype,"lensFlareDistortionStrength",void 0),n([e.serializeAsTexture("lensStarTexture")],i.prototype,"lensStarTexture",void 0),n([e.serializeAsTexture("lensFlareDirtTexture")],i.prototype,"lensFlareDirtTexture",void 0),n([e.serialize()],i.prototype,"depthOfFieldDistance",void 0),n([e.serialize()],i.prototype,"depthOfFieldBlurWidth",void 0),n([e.serialize()],i.prototype,"motionStrength",void 0),n([e.serialize()],i.prototype,"_ratio",void 0),n([e.serialize()],i.prototype,"BloomEnabled",null),n([e.serialize()],i.prototype,"DepthOfFieldEnabled",null),n([e.serialize()],i.prototype,"LensFlareEnabled",null),n([e.serialize()],i.prototype,"HDREnabled",null),n([e.serialize()],i.prototype,"VLSEnabled",null),n([e.serialize()],i.prototype,"MotionBlurEnabled",null),n([e.serialize()],i.prototype,"fxaaEnabled",null),n([e.serialize()],i.prototype,"volumetricLightStepsCount",null),n([e.serialize()],i.prototype,"motionBlurSamples",null),n([e.serialize()],i.prototype,"samples",null),i}(e.PostProcessRenderPipeline);e.StandardRenderingPipeline=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l){void 0===n&&(n=null),void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT);var c=t.call(this,i,"fxaa",["texelSize"],null,r,n,a||e.Texture.BILINEAR_SAMPLINGMODE,o,s,null,l,"fxaa",void 0,!0)||this,u=c._getDefines();return c.updateEffect(u),c.onApplyObservable.add((function(e){var t=c.texelSize;e.setFloat2("texelSize",t.x,t.y)})),c}return a(i,t),i.prototype._getDefines=function(){var e=this.getEngine();if(!e)return null;var t=e.getGlInfo();return t&&t.renderer&&t.renderer.toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null},i}(e.PostProcess);e.FxaaPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u,h){void 0===u&&(u=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1);var d=t.call(this,i,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],a,o,s,l,c,null,u,void 0,null,h)||this;return d.aberrationAmount=30,d.radialIntensity=0,d.direction=new e.Vector2(.707,.707),d.centerPosition=new e.Vector2(.5,.5),d.onApplyObservable.add((function(e){e.setFloat("chromatic_aberration",d.aberrationAmount),e.setFloat("screen_width",r),e.setFloat("screen_height",n),e.setFloat("radialIntensity",d.radialIntensity),e.setFloat2("direction",d.direction.x,d.direction.y),e.setFloat2("centerPosition",d.centerPosition.x,d.centerPosition.y)})),d}return a(i,t),i}(e.PostProcess);e.ChromaticAberrationPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c){void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=!1);var u=t.call(this,i,"grain",["intensity","animatedSeed"],[],r,n,a,o,s,null,l,void 0,null,c)||this;return u.intensity=30,u.animated=!1,u.onApplyObservable.add((function(e){e.setFloat("intensity",u.intensity),e.setFloat("animatedSeed",u.animated?Math.random()+1:1)})),u}return a(i,t),i}(e.PostProcess);e.GrainPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c){void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=!1);var u=t.call(this,i,"sharpen",["sharpnessAmounts","screenSize"],null,r,n,a,o,s,null,l,void 0,null,c)||this;return u.colorAmount=1,u.edgeAmount=.3,u.onApply=function(e){e.setFloat2("screenSize",u.width,u.height),e.setFloat2("sharpnessAmounts",u.edgeAmount,u.colorAmount)},u}return a(i,t),i}(e.PostProcess);e.SharpenPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u,h,d){void 0===s&&(s=e.Texture.BILINEAR_SAMPLINGMODE),void 0===u&&(u=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=""),void 0===d&&(d=!1);var p=t.call(this,i,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],a,o,s,l,c,null,u,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return p.direction=r,p.blockCompilation=d,p._packedFloat=!1,p._staticDefines="",p._staticDefines=h,p.onApplyObservable.add((function(e){p._outputTexture?e.setFloat2("delta",1/p._outputTexture.width*p.direction.x,1/p._outputTexture.height*p.direction.y):e.setFloat2("delta",1/p.width*p.direction.x,1/p.height*p.direction.y)})),p.kernel=n,p}return a(i,t),Object.defineProperty(i.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),i.prototype.updateEffect=function(e,t,i,r,n,a){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this._updateParameters(n,a)},i.prototype._updateParameters=function(e,i){for(var r=this._kernel,n=(r-1)/2,a=[],o=[],s=0,l=0;l<r;l++){var c=l/(r-1),u=this._gaussianWeight(2*c-1);a[__uv.$wrap((l))]=l-n,o[__uv.$wrap((l))]=u,s+=u}for(l=0;l<o.length;l++)o[__uv.$wrap((l))]/=s;var h=[],d=[],p=[];for(l=0;l<=n;l+=2){var m=Math.min(l+1,Math.floor(n));if(l===m)p.push({o:a[__uv.$wrap((l))],w:o[__uv.$wrap((l))]});else{var _=m===n,f=o[__uv.$wrap((l))]+o[__uv.$wrap((m))]*(_?.5:1),g=a[__uv.$wrap((l))]+1/(1+o[__uv.$wrap((l))]/o[__uv.$wrap((m))]);0===g?(p.push({o:a[__uv.$wrap((l))],w:o[__uv.$wrap((l))]}),p.push({o:a[__uv.$wrap((l+1))],w:o[__uv.$wrap((l+1))]})):(p.push({o:g,w:f}),p.push({o:-g,w:f}))}}for(l=0;l<p.length;l++)d[__uv.$wrap((l))]=p[__uv.$wrap((l))].o,h[__uv.$wrap((l))]=p[__uv.$wrap((l))].w;a=d,o=h;var y=this.getEngine().getCaps().maxVaryingVectors,v=Math.max(y,0)-1,b=Math.min(a.length,v),x="";x+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(x+="#define CENTER_WEIGHT "+this._glslFloat(o[__uv.$wrap((b-1))])+"\r\n",b--);for(l=0;l<b;l++)x+="#define KERNEL_OFFSET"+l+" "+this._glslFloat(a[__uv.$wrap((l))])+"\r\n",x+="#define KERNEL_WEIGHT"+l+" "+this._glslFloat(o[__uv.$wrap((l))])+"\r\n";var S=0;for(l=v;l<a.length;l++)x+="#define KERNEL_DEP_OFFSET"+S+" "+this._glslFloat(a[__uv.$wrap((l))])+"\r\n",x+="#define KERNEL_DEP_WEIGHT"+S+" "+this._glslFloat(o[__uv.$wrap((l))])+"\r\n",S++;this.packedFloat&&(x+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,t.prototype.updateEffect.call(this,x,null,null,{varyingCount:b,depCount:S},e,i)},i.prototype._nearestBestKernel=function(e){for(var t=Math.round(e),i=0,r=[t,t-1,t+1,t-2,t+2];i<r.length;i++){var n=r[__uv.$wrap((i))];if(n%2!=0&&Math.floor(n/2)%2==0&&n>0)return Math.max(n,3)}return Math.max(t,3)},i.prototype._gaussianWeight=function(e){var t=-e*e/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(t)},i.prototype._glslFloat=function(e,t){return void 0===t&&(t=8),e.toFixed(t).replace(/0+$/,"")},i}(e.PostProcess);e.BlurPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u,h,d,p,m){void 0===c&&(c=null),void 0===u&&(u=e.Texture.BILINEAR_SAMPLINGMODE),void 0===p&&(p=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===m&&(m=!1);var _=t.call(this,i,n,a,o,s,u=e.Texture.BILINEAR_SAMPLINGMODE,h,d,p=e.Engine.TEXTURETYPE_UNSIGNED_INT,"#define DOF 1\r\n",m)||this;return _.direction=n,_.onApplyObservable.add((function(e){null!=c&&e.setTextureFromPostProcess("textureSampler",c),e.setTextureFromPostProcessOutput("circleOfConfusionSampler",l),r.activeCamera&&e.setFloat2("cameraMinMaxZ",r.activeCamera.minZ,r.activeCamera.maxZ)})),_}return a(i,t),i}(e.BlurPostProcess);e.DepthOfFieldBlurPostProcess=t}(s||(s={})),function(e){var t=function(){};e.DepthOfFieldMergePostProcessOptions=t;var i=function(t){function i(i,r,n,a,o,s,l,c,u,h,d){void 0===h&&(h=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===d&&(d=!1);var p=t.call(this,i,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],o,s,l,c,u,null,h,void 0,null,!0)||this;return p.blurSteps=a,p.onApplyObservable.add((function(e){e.setTextureFromPostProcess("textureSampler",r),e.setTextureFromPostProcessOutput("circleOfConfusionSampler",n),a.forEach((function(t,i){e.setTextureFromPostProcessOutput("blurStep"+(a.length-i-1),t)}))})),d||p.updateEffect(),p}return a(i,t),i.prototype.updateEffect=function(e,i,r,n,a,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),e||(e="",e+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+"\n"),t.prototype.updateEffect.call(this,e,i,r,n,a,o)},i}(e.PostProcess);e.DepthOfFieldMergePostProcess=i}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u){void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===u&&(u=!1);var h=t.call(this,i,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],n,a,o,s,l,null,c,void 0,null,u)||this;return h.lensSize=50,h.fStop=1.4,h.focusDistance=2e3,h.focalLength=50,h._depthTexture=null,h._depthTexture=r,h.onApplyObservable.add((function(t){if(h._depthTexture){t.setTexture("depthSampler",h._depthTexture);var i=h.lensSize/h.fStop*h.focalLength/(h.focusDistance-h.focalLength);t.setFloat("focusDistance",h.focusDistance),t.setFloat("cocPrecalculation",i),t.setFloat2("cameraMinMaxZ",h._depthTexture.activeCamera.minZ,h._depthTexture.activeCamera.maxZ)}else e.Tools.Warn("No depth texture set on CircleOfConfusionPostProcess")})),h}return a(i,t),Object.defineProperty(i.prototype,"depthTexture",{set:function(e){this._depthTexture=e},enumerable:!0,configurable:!0}),i}(e.PostProcess);e.CircleOfConfusionPostProcess=t}(s||(s={})),function(e){var t;!function(e){e[__uv.$wrap((e.Low=0))]="Low",e[__uv.$wrap((e.Medium=1))]="Medium",e[__uv.$wrap((e.High=2))]="High"}(t=e.DepthOfFieldEffectBlurLevel||(e.DepthOfFieldEffectBlurLevel={}));var i=function(i){function r(r,n,a,o,s){void 0===a&&(a=t.Low),void 0===o&&(o=0),void 0===s&&(s=!1);var l=i.call(this,r.getEngine(),"depth of field",(function(){return l._effects}),!0)||this;l._effects=[],l._circleOfConfusion=new e.CircleOfConfusionPostProcess("circleOfConfusion",n,1,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,o,s),l._depthOfFieldBlurY=[],l._depthOfFieldBlurX=[];var c=1,u=15;switch(a){case t.High:c=3,u=51;break;case t.Medium:c=2,u=31;break;default:u=15,c=1}for(var h=u/Math.pow(2,c-1),d=1,p=0;p<c;p++){var m=new e.DepthOfFieldBlurPostProcess("verticle blur",r,new e.Vector2(0,1),h,d,null,l._circleOfConfusion,0==p?l._circleOfConfusion:null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,o,s);m.autoClear=!1,d=.75/Math.pow(2,p);var _=new e.DepthOfFieldBlurPostProcess("horizontal blur",r,new e.Vector2(1,0),h,d,null,l._circleOfConfusion,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,o,s);_.autoClear=!1,l._depthOfFieldBlurY.push(m),l._depthOfFieldBlurX.push(_)}l._effects=[l._circleOfConfusion];for(p=0;p<l._depthOfFieldBlurX.length;p++)l._effects.push(l._depthOfFieldBlurY[__uv.$wrap((p))]),l._effects.push(l._depthOfFieldBlurX[__uv.$wrap((p))]);return l._dofMerge=new e.DepthOfFieldMergePostProcess("dofMerge",l._circleOfConfusion,l._circleOfConfusion,l._depthOfFieldBlurX,d,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,o,s),l._dofMerge.autoClear=!1,l._effects.push(l._dofMerge),l}return a(r,i),Object.defineProperty(r.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(e){this._circleOfConfusion.focalLength=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(e){this._circleOfConfusion.fStop=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(e){this._circleOfConfusion.focusDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(e){this._circleOfConfusion.lensSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthTexture",{set:function(e){this._circleOfConfusion.depthTexture=e},enumerable:!0,configurable:!0}),r.prototype.disposeEffects=function(e){for(var t=0;t<this._effects.length;t++)this._effects[__uv.$wrap((t))].dispose(e)},r.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[__uv.$wrap((e))].updateEffect()},r.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[__uv.$wrap((e))].isReady())return!1;return!0},r}(e.PostProcessRenderEffect);e.DepthOfFieldEffect=i}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u,h,d){void 0===h&&(h=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===d&&(d=!1);var p=t.call(this,i,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],o,s,l,c,u,null,h,void 0,null,!0)||this;return p.weight=a,p.onApplyObservable.add((function(e){e.setTextureFromPostProcess("textureSampler",r),e.setTextureFromPostProcessOutput("bloomBlur",n),e.setFloat("bloomWeight",p.weight)})),d||p.updateEffect(),p}return a(i,t),i}(e.PostProcess);e.BloomMergePostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c){void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=!1);var u=t.call(this,i,"extractHighlights",["threshold","exposure"],null,r,n,a,o,s,null,l,void 0,null,c)||this;return u.threshold=.9,u._exposure=1,u._inputPostProcess=null,u.onApplyObservable.add((function(t){u._inputPostProcess&&t.setTextureFromPostProcess("textureSampler",u._inputPostProcess),t.setFloat("threshold",Math.pow(u.threshold,e.ToGammaSpace)),t.setFloat("exposure",u._exposure)})),u}return a(i,t),i}(e.PostProcess);e.ExtractHighlightsPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s){void 0===o&&(o=0),void 0===s&&(s=!1);var l=t.call(this,i.getEngine(),"bloom",(function(){return l._effects}),!0)||this;return l.bloomScale=r,l._effects=[],l._downscale=new e.ExtractHighlightsPostProcess("highlights",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,o,s),l._blurX=new e.BlurPostProcess("horizontal blur",new e.Vector2(1,0),10,r,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,o,void 0,s),l._blurX.alwaysForcePOT=!0,l._blurX.autoClear=!1,l._blurY=new e.BlurPostProcess("vertical blur",new e.Vector2(0,1),10,r,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,o,void 0,s),l._blurY.alwaysForcePOT=!0,l._blurY.autoClear=!1,l.kernel=a,l._effects=[l._downscale,l._blurX,l._blurY],l._merge=new e.BloomMergePostProcess("bloomMerge",l._downscale,l._blurY,n,r,null,e.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,o,s),l._merge.autoClear=!1,l._effects.push(l._merge),l}return a(i,t),Object.defineProperty(i.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(e){this._downscale.threshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weight",{get:function(){return this._merge.weight},set:function(e){this._merge.weight=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(e){this._blurX.kernel=e*this.bloomScale,this._blurY.kernel=e*this.bloomScale},enumerable:!0,configurable:!0}),i.prototype.disposeEffects=function(e){for(var t=0;t<this._effects.length;t++)this._effects[__uv.$wrap((t))].dispose(e)},i.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[__uv.$wrap((e))].updateEffect()},i.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[__uv.$wrap((e))].isReady())return!1;return!0},i}(e.PostProcessRenderEffect);e.BloomEffect=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o){void 0===i&&(i=""),void 0===r&&(r=!0),void 0===n&&(n=e.Engine.LastCreatedScene),void 0===o&&(o=!0);var s=t.call(this,n.getEngine(),i)||this;s._camerasToBeAttached=[],s.SharpenPostProcessId="SharpenPostProcessEffect",s.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",s.FxaaPostProcessId="FxaaPostProcessEffect",s.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",s.GrainPostProcessId="GrainPostProcessEffect",s._glowLayer=null,s.animations=[],s._imageProcessingConfigurationObserver=null,s._sharpenEnabled=!1,s._bloomEnabled=!1,s._depthOfFieldEnabled=!1,s._depthOfFieldBlurLevel=e.DepthOfFieldEffectBlurLevel.Low,s._fxaaEnabled=!1,s._imageProcessingEnabled=!0,s._bloomScale=.5,s._chromaticAberrationEnabled=!1,s._grainEnabled=!1,s._buildAllowed=!0,s._resizeObserver=null,s._hardwareScaleLevel=1,s._bloomKernel=64,s._bloomWeight=.15,s._bloomThreshold=.9,s._samples=1,s._hasCleared=!1,s._prevPostProcess=null,s._prevPrevPostProcess=null,s._depthOfFieldSceneObserver=null,s._cameras=a||n.cameras,s._cameras=s._cameras.slice(),s._camerasToBeAttached=s._cameras.slice(),s._buildAllowed=o,s._scene=n;var l=s._scene.getEngine().getCaps();s._hdr=r&&(l.textureHalfFloatRender||l.textureFloatRender),s._hdr?l.textureHalfFloatRender?s._defaultPipelineTextureType=e.Engine.TEXTURETYPE_HALF_FLOAT:l.textureFloatRender&&(s._defaultPipelineTextureType=e.Engine.TEXTURETYPE_FLOAT):s._defaultPipelineTextureType=e.Engine.TEXTURETYPE_UNSIGNED_INT,n.postProcessRenderPipelineManager.addPipeline(s);var c=s._scene.getEngine();return s.sharpen=new e.SharpenPostProcess("sharpen",1,null,e.Texture.BILINEAR_SAMPLINGMODE,c,!1,s._defaultPipelineTextureType,!0),s._sharpenEffect=new e.PostProcessRenderEffect(c,s.SharpenPostProcessId,(function(){return s.sharpen}),!0),s.depthOfField=new e.DepthOfFieldEffect(s._scene,null,s._depthOfFieldBlurLevel,s._defaultPipelineTextureType,!0),s.bloom=new e.BloomEffect(s._scene,s._bloomScale,s._bloomWeight,s.bloomKernel,s._defaultPipelineTextureType,!0),s.chromaticAberration=new e.ChromaticAberrationPostProcess("ChromaticAberration",c.getRenderWidth(),c.getRenderHeight(),1,null,e.Texture.BILINEAR_SAMPLINGMODE,c,!1,s._defaultPipelineTextureType,!0),s._chromaticAberrationEffect=new e.PostProcessRenderEffect(c,s.ChromaticAberrationPostProcessId,(function(){return s.chromaticAberration}),!0),s.grain=new e.GrainPostProcess("Grain",1,null,e.Texture.BILINEAR_SAMPLINGMODE,c,!1,s._defaultPipelineTextureType,!0),s._grainEffect=new e.PostProcessRenderEffect(c,s.GrainPostProcessId,(function(){return s.grain}),!0),s._resizeObserver=c.onResizeObservable.add((function(){s._hardwareScaleLevel=c.getHardwareScalingLevel(),s.bloomKernel=s.bloomKernel})),s._imageProcessingConfigurationObserver=s._scene.imageProcessingConfiguration.onUpdateParameters.add((function(){s.bloom._downscale._exposure=s._scene.imageProcessingConfiguration.exposure})),s._buildPipeline(),s}return a(i,t),Object.defineProperty(i.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(e){this._sharpenEnabled!==e&&(this._sharpenEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(e){this._bloomKernel=e,this.bloom.kernel=e/this._hardwareScaleLevel},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(e){this._bloomWeight!==e&&(this.bloom.weight=e,this._bloomWeight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(e){this._bloomThreshold!==e&&(this.bloom.threshold=e,this._bloomThreshold=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(e){this._bloomScale!==e&&(this._bloomScale=e,this._rebuildBloom(),this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),i.prototype._rebuildBloom=function(){var t=this.bloom;this.bloom=new e.BloomEffect(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=t.threshold;for(var i=0;i<this._cameras.length;i++)t.disposeEffects(this._cameras[__uv.$wrap((i))])},Object.defineProperty(i.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(t){if(this._depthOfFieldBlurLevel!==t){this._depthOfFieldBlurLevel=t;var i=this.depthOfField;this.depthOfField=new e.DepthOfFieldEffect(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=i.focalLength,this.depthOfField.focusDistance=i.focusDistance,this.depthOfField.fStop=i.fStop,this.depthOfField.lensSize=i.lensSize;for(var r=0;r<this._cameras.length;r++)i.disposeEffects(this._cameras[__uv.$wrap((r))]);this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(e){this._imageProcessingEnabled!==e&&(this._imageProcessingEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"glowLayerEnabled",{get:function(){return null==this._glowLayer},set:function(t){t&&!this._glowLayer?this._glowLayer=new e.GlowLayer("",this._scene):!t&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(e){this._chromaticAberrationEnabled!==e&&(this._chromaticAberrationEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(e){this._grainEnabled!==e&&(this._grainEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),i.prototype.prepare=function(){var e=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=e},i.prototype._setAutoClearAndTextureSharing=function(e,t){void 0===t&&(t=!1),this._hasCleared?e.autoClear=!1:(e.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),t||(this._prevPrevPostProcess?e.shareOutputWith(this._prevPrevPostProcess):e.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=e)},i.prototype._buildPipeline=function(){var t=this;if(this._buildAllowed){this._scene.autoClear=!0;var i=this._scene.getEngine();if(this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var r=0,n=this._cameras;r<n.length;r++){var a=n[__uv.$wrap((r))];(o=this._scene.enableDepthRenderer(a)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add((function(e){t._cameras.indexOf(e.activeCamera)>-1&&(t.depthOfField.depthTexture=e.enableDepthRenderer(e.activeCamera).getDepthMap())}))}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var o=this._scene.enableDepthRenderer(this._cameras[__uv.$wrap((0))]);this.depthOfField.depthTexture=o.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[__uv.$wrap((0))],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[__uv.$wrap((0))],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new e.ImageProcessingPostProcess("imageProcessing",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new e.PostProcessRenderEffect(i,this.ImageProcessingPostProcessId,(function(){return t.imageProcessing}),!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new e.FxaaPostProcess("fxaa",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this.addEffect(new e.PostProcessRenderEffect(i,this.FxaaPostProcessId,(function(){return t.fxaa}),!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&e.Tools.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")}},i.prototype._disposePostProcesses=function(e){void 0===e&&(e=!1);for(var t=0;t<this._cameras.length;t++){var i=this._cameras[__uv.$wrap((t))];this.imageProcessing&&this.imageProcessing.dispose(i),this.fxaa&&this.fxaa.dispose(i),e&&(this.sharpen&&this.sharpen.dispose(i),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(i)),this.bloom&&this.bloom.disposeEffects(i),this.chromaticAberration&&this.chromaticAberration.dispose(i),this.grain&&this.grain.dispose(i),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,e&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},i.prototype.addCamera=function(e){this._camerasToBeAttached.push(e),this._buildPipeline()},i.prototype.removeCamera=function(e){var t=this._camerasToBeAttached.indexOf(e);this._camerasToBeAttached.splice(t,1),this._buildPipeline()},i.prototype.dispose=function(){this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),t.prototype.dispose.call(this)},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="DefaultRenderingPipeline",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse((function(){return new i(t._name,t._name._hdr,r)}),t,r,n)},n([e.serialize()],i.prototype,"sharpenEnabled",null),n([e.serialize()],i.prototype,"bloomKernel",null),n([e.serialize()],i.prototype,"_bloomWeight",void 0),n([e.serialize()],i.prototype,"_bloomThreshold",void 0),n([e.serialize()],i.prototype,"_hdr",void 0),n([e.serialize()],i.prototype,"bloomWeight",null),n([e.serialize()],i.prototype,"bloomThreshold",null),n([e.serialize()],i.prototype,"bloomScale",null),n([e.serialize()],i.prototype,"bloomEnabled",null),n([e.serialize()],i.prototype,"depthOfFieldEnabled",null),n([e.serialize()],i.prototype,"depthOfFieldBlurLevel",null),n([e.serialize()],i.prototype,"fxaaEnabled",null),n([e.serialize()],i.prototype,"samples",null),n([e.serialize()],i.prototype,"imageProcessingEnabled",null),n([e.serialize()],i.prototype,"glowLayerEnabled",null),n([e.serialize()],i.prototype,"chromaticAberrationEnabled",null),n([e.serialize()],i.prototype,"grainEnabled",null),i}(e.PostProcessRenderPipeline);e.DefaultRenderingPipeline=t}(s||(s={})),function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines);e.ImageProcessingConfigurationDefines=t;var i=function(){function t(){this.colorCurves=new e.ColorCurves,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=t.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new e.Color4(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=t.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new e.Observable}return Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),t.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},t.prototype.getClassName=function(){return"ImageProcessingConfiguration"},t.PrepareUniforms=function(t,i){i.EXPOSURE&&t.push("exposureLinear"),i.CONTRAST&&t.push("contrast"),i.COLORGRADING&&t.push("colorTransformSettings"),i.VIGNETTE&&(t.push("vInverseScreenSize"),t.push("vignetteSettings1"),t.push("vignetteSettings2")),i.COLORCURVES&&e.ColorCurves.PrepareUniforms(t)},t.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},t.prototype.prepareDefines=function(e,i){if(void 0===i&&(i=!1),i!==this.applyByPostProcess||!this._isEnabled)return e.VIGNETTE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.IMAGEPROCESSING=!1,void(e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===t._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case t.TONEMAPPING_ACES:e.TONEMAPPING_ACES=!0}e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING},t.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},t.prototype.bind=function(t,i){if(void 0===i&&(i=1),this._colorCurvesEnabled&&this.colorCurves&&e.ColorCurves.Bind(this.colorCurves,t),this._vignetteEnabled){var r=1/t.getEngine().getRenderWidth(),n=1/t.getEngine().getRenderHeight();t.setFloat2("vInverseScreenSize",r,n);var a=Math.tan(.5*this.vignetteCameraFov),o=a*i,s=Math.sqrt(o*a);o=e.Tools.Mix(o,s,this.vignetteStretch),a=e.Tools.Mix(a,s,this.vignetteStretch),t.setFloat4("vignetteSettings1",o,a,-o*this.vignetteCentreX,-a*this.vignetteCentreY);var l=-2*this.vignetteWeight;t.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}if(t.setFloat("exposureLinear",this.exposure),t.setFloat("contrast",this.contrast),this.colorGradingTexture){t.setTexture("txColorTransform",this.colorGradingTexture);var c=this.colorGradingTexture.getSize().height;t.setFloat4("colorTransformSettings",(c-1)/c,.5/c,c,this.colorGradingTexture.level)}},t.prototype.clone=function(){return e.SerializationHelper.Clone((function(){return new t}),this)},t.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},t.Parse=function(i){return e.SerializationHelper.Parse((function(){return new t}),i,null,null)},Object.defineProperty(t,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(t,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),t.TONEMAPPING_STANDARD=0,t.TONEMAPPING_ACES=1,t._VIGNETTEMODE_MULTIPLY=0,t._VIGNETTEMODE_OPAQUE=1,n([e.serializeAsColorCurves()],t.prototype,"colorCurves",void 0),n([e.serialize()],t.prototype,"_colorCurvesEnabled",void 0),n([e.serializeAsTexture("colorGradingTexture")],t.prototype,"_colorGradingTexture",void 0),n([e.serialize()],t.prototype,"_colorGradingEnabled",void 0),n([e.serialize()],t.prototype,"_colorGradingWithGreenDepth",void 0),n([e.serialize()],t.prototype,"_colorGradingBGR",void 0),n([e.serialize()],t.prototype,"_exposure",void 0),n([e.serialize()],t.prototype,"_toneMappingEnabled",void 0),n([e.serialize()],t.prototype,"_toneMappingType",void 0),n([e.serialize()],t.prototype,"_contrast",void 0),n([e.serialize()],t.prototype,"vignetteStretch",void 0),n([e.serialize()],t.prototype,"vignetteCentreX",void 0),n([e.serialize()],t.prototype,"vignetteCentreY",void 0),n([e.serialize()],t.prototype,"vignetteWeight",void 0),n([e.serializeAsColor4()],t.prototype,"vignetteColor",void 0),n([e.serialize()],t.prototype,"vignetteCameraFov",void 0),n([e.serialize()],t.prototype,"_vignetteBlendMode",void 0),n([e.serialize()],t.prototype,"_vignetteEnabled",void 0),n([e.serialize()],t.prototype,"_applyByPostProcess",void 0),n([e.serialize()],t.prototype,"_isEnabled",void 0),t}();e.ImageProcessingConfiguration=i}(s||(s={})),function(e){var t=function(t){function i(i,r){var n=t.call(this,r)||this;return i?(n._engine=r.getEngine(),n._textureMatrix=e.Matrix.Identity(),n.name=i,n.url=i,n.hasAlpha=!1,n.isCube=!1,n.is3D=n._engine.webGLVersion>1,n.wrapU=e.Texture.CLAMP_ADDRESSMODE,n.wrapV=e.Texture.CLAMP_ADDRESSMODE,n.wrapR=e.Texture.CLAMP_ADDRESSMODE,n.anisotropicFilteringLevel=1,n._texture=n._getFromCache(i,!0),n._texture||(r.useDelayedTextureLoading?n.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:n.loadTexture()),n):n}return a(i,t),i.prototype.getTextureMatrix=function(){return this._textureMatrix},i.prototype.load3dlTexture=function(){var t,r=this._engine;t=1===r.webGLVersion?r.createRawTexture(null,1,1,e.Engine.TEXTUREFORMAT_RGBA,!1,!1,e.Texture.BILINEAR_SAMPLINGMODE):r.createRawTexture3D(null,1,1,1,e.Engine.TEXTUREFORMAT_RGBA,!1,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._texture=t;var n=function(n){if("string"==typeof n){for(var a,o=null,s=null,l=n.split("\n"),c=0,u=0,h=0,d=0,p=0,m=0;m<l.length;m++)if(a=l[__uv.$wrap((m))],i._noneEmptyLineRegex.test(a)&&0!==a.indexOf("#")){var _=a.split(" ");if(0!==c){if(0!=c){var f=Math.max(parseInt(_[__uv.$wrap((0))]),0),g=Math.max(parseInt(_[__uv.$wrap((1))]),0),y=Math.max(parseInt(_[__uv.$wrap((2))]),0);p=Math.max(f,p),p=Math.max(g,p),p=Math.max(y,p);var v=4*(u+d*c+h*c*c);s&&(s[__uv.$wrap((v+0))]=f,s[__uv.$wrap((v+1))]=g,s[__uv.$wrap((v+2))]=y),++h%c==0&&(h=0,++d%c==0&&(u++,d=0))}}else c=_.length,o=new Uint8Array(c*c*c*4),s=new Float32Array(c*c*c*4)}if(s&&o)for(m=0;m<s.length;m++)if(m>0&&(m+1)%4==0)o[__uv.$wrap((m))]=255;else{var b=s[__uv.$wrap((m))];o[__uv.$wrap((m))]=b/p*255}t.is3D?(t.updateSize(c,c,c),r.updateRawTexture3D(t,o,e.Engine.TEXTUREFORMAT_RGBA,!1)):(t.updateSize(c*c,c),r.updateRawTexture(t,o,e.Engine.TEXTUREFORMAT_RGBA,!1))}},a=this.getScene();return a?a._loadFile(this.url,n):this._engine._loadFile(this.url,n),this._texture},i.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},i.prototype.clone=function(){var e=new i(this.url,this.getScene());return e.level=this.level,e},i.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},i.Parse=function(e,t,r){var n=null;return e.name&&!e.isRenderTarget&&((n=new i(e.name,t)).name=e.name,n.level=e.level),n},i.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e.customType="BABYLON.ColorGradingTexture",e},i._noneEmptyLineRegex=/\S+/,i}(e.BaseTexture);e.ColorGradingTexture=t}(s||(s={})),function(e){var t=function(){function t(){this._dirty=!0,this._tempColor=new e.Color4(0,0,0,0),this._globalCurve=new e.Color4(0,0,0,0),this._highlightsCurve=new e.Color4(0,0,0,0),this._midtonesCurve=new e.Color4(0,0,0,0),this._shadowsCurve=new e.Color4(0,0,0,0),this._positiveCurve=new e.Color4(0,0,0,0),this._negativeCurve=new e.Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(t.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ColorCurves"},t.Bind=function(e,t,i,r,n){void 0===i&&(i="vCameraColorCurvePositive"),void 0===r&&(r="vCameraColorCurveNeutral"),void 0===n&&(n="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(n,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},t.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},t.prototype.getColorGradingDataToRef=function(e,i,r,n,a){null!=e&&(e=t.clamp(e,0,360),i=t.clamp(i,-100,100),r=t.clamp(r,-100,100),n=t.clamp(n,-100,100),i=t.applyColorGradingSliderNonlinear(i),i*=.5,n=t.applyColorGradingSliderNonlinear(n),i<0&&(i*=-1,e=(e+180)%360),t.fromHSBToRef(e,i,50+.25*n,a),a.scaleToRef(2,a),a.a=1+.01*r)},t.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100},t.fromHSBToRef=function(e,i,r,n){var a=t.clamp(e,0,360),o=t.clamp(i/100,0,1),s=t.clamp(r/100,0,1);if(0===o)n.r=s,n.g=s,n.b=s;else{a/=60;var l=Math.floor(a),c=a-l,u=s*(1-o),h=s*(1-o*c),d=s*(1-o*(1-c));switch(l){case 0:n.r=s,n.g=d,n.b=u;break;case 1:n.r=h,n.g=s,n.b=u;break;case 2:n.r=u,n.g=s,n.b=d;break;case 3:n.r=u,n.g=h,n.b=s;break;case 4:n.r=d,n.g=u,n.b=s;break;default:n.r=s,n.g=u,n.b=h}}n.a=1},t.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},t.prototype.clone=function(){return e.SerializationHelper.Clone((function(){return new t}),this)},t.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},t.Parse=function(i){return e.SerializationHelper.Parse((function(){return new t}),i,null,null)},n([e.serialize()],t.prototype,"_globalHue",void 0),n([e.serialize()],t.prototype,"_globalDensity",void 0),n([e.serialize()],t.prototype,"_globalSaturation",void 0),n([e.serialize()],t.prototype,"_globalExposure",void 0),n([e.serialize()],t.prototype,"_highlightsHue",void 0),n([e.serialize()],t.prototype,"_highlightsDensity",void 0),n([e.serialize()],t.prototype,"_highlightsSaturation",void 0),n([e.serialize()],t.prototype,"_highlightsExposure",void 0),n([e.serialize()],t.prototype,"_midtonesHue",void 0),n([e.serialize()],t.prototype,"_midtonesDensity",void 0),n([e.serialize()],t.prototype,"_midtonesSaturation",void 0),n([e.serialize()],t.prototype,"_midtonesExposure",void 0),t}();e.ColorCurves=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u,h){var d=t.call(this,i,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],s,l,c,u,h)||this;return d.color=n,d.depth=a,d.colorLevel=o,d._ownRefractionTexture=!0,d.onActivateObservable.add((function(t){d._refTexture=d._refTexture||new e.Texture(r,t.getScene())})),d.onApplyObservable.add((function(e){e.setColor3("baseColor",d.color),e.setFloat("depth",d.depth),e.setFloat("colorLevel",d.colorLevel),e.setTexture("refractionSampler",d._refTexture)})),d}return a(i,t),Object.defineProperty(i.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(e){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=e,this._ownRefractionTexture=!1},enumerable:!0,configurable:!0}),i.prototype.dispose=function(e){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),t.prototype.dispose.call(this,e)},i}(e.PostProcess);e.RefractionPostProcess=t}(s||(s={})),function(e){var t=function(e){function t(t,i,r,n,a,o){var s=e.call(this,t,"blackAndWhite",["degree"],null,i,r,n,a,o)||this;return s.degree=1,s.onApplyObservable.add((function(e){e.setFloat("degree",s.degree)})),s}return a(t,e),t}(e.PostProcess);e.BlackAndWhitePostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c){void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT);var u=t.call(this,i,"convolution",["kernel","screenSize"],null,n,a,o,s,l,null,c)||this;return u.kernel=r,u.onApply=function(e){e.setFloat2("screenSize",u.width,u.height),e.setArray("kernel",u.kernel)},u}return a(i,t),i.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],i.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],i.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],i.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],i.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],i.GaussianKernel=[0,1,0,1,1,1,0,1,0],i}(e.PostProcess);e.ConvolutionPostProcess=t}(s||(s={})),function(e){var t=function(e){function t(t,i,r,n,a,o,s){var l=e.call(this,t,"filter",["kernelMatrix"],null,r,n,a,o,s)||this;return l.kernelMatrix=i,l.onApply=function(e){e.setMatrix("kernelMatrix",l.kernelMatrix)},l}return a(t,e),t}(e.PostProcess);e.FilterPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(r,n,a,o,s,l,c,u,h){void 0===s&&(s=100),void 0===l&&(l=e.Texture.BILINEAR_SAMPLINGMODE);var d=t.call(this,r,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],n.postProcessRatio||n,a,l,c,u,"#define NUM_SAMPLES "+s)||this;return d._screenCoordinates=e.Vector2.Zero(),d.customMeshPosition=e.Vector3.Zero(),d.useCustomMeshPosition=!1,d.invert=!0,d.excludedMeshes=new Array,d.exposure=.3,d.decay=.96815,d.weight=.58767,d.density=.926,c=(h=null===a?h:a.getScene()).getEngine(),d._viewPort=new e.Viewport(0,0,1,1).toGlobal(c.getRenderWidth(),c.getRenderHeight()),d.mesh=null!==o?o:i.CreateDefaultMesh("VolumetricLightScatteringMesh",h),d._createPass(h,n.passRatio||n),d.onActivate=function(e){d.isSupported||d.dispose(e),d.onActivate=null},d.onApplyObservable.add((function(e){d._updateMeshScreenCoordinates(h),e.setTexture("lightScatteringSampler",d._volumetricLightScatteringRTT),e.setFloat("exposure",d.exposure),e.setFloat("decay",d.decay),e.setFloat("weight",d.weight),e.setFloat("density",d.density),e.setVector2("meshPositionOnScreen",d._screenCoordinates)})),d}return a(i,t),Object.defineProperty(i.prototype,"useDiffuseColor",{get:function(){return e.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(t){e.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},i.prototype._isReady=function(t,i){var r=t.getMesh();if(r===this.mesh&&r.material)return r.material.isReady(r);var n=[],a=[e.VertexBuffer.PositionKind],o=t.getMaterial();o&&(o.needAlphaTesting()&&n.push("#define ALPHATEST"),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(a.push(e.VertexBuffer.UVKind),n.push("#define UV1")),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(a.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),r.useBones&&r.computeBonesUsingShaders?(a.push(e.VertexBuffer.MatricesIndicesKind),a.push(e.VertexBuffer.MatricesWeightsKind),n.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers),n.push("#define BonesPerMesh "+(r.skeleton?r.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"));var s=n.join("\n");return this._cachedDefines!==s&&(this._cachedDefines=s,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},a,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],s)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)},i.prototype._createPass=function(t,i){var r=this,n=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture("volumetricLightScatteringMap",{width:n.getRenderWidth()*i,height:n.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var a=this.getCamera();a?a.customRenderTargets.push(this._volumetricLightScatteringRTT):t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var i=t.getRenderingMesh();if(!r._meshExcluded(i)){var n=t.getMaterial();if(n){var a=i.getScene(),o=a.getEngine();o.setState(n.backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var l=o.getCaps().instancedArrays&&null!==s.visibleInstances[__uv.$wrap((t._id))];if(r._isReady(t,l)){var c=r._volumetricLightScatteringPass;if(i===r.mesh&&(c=t.effect?t.effect:n.getEffect()),o.enableEffect(c),i._bind(t,c,e.Material.TriangleFillMode),i===r.mesh)n.bind(i.getWorldMatrix(),i);else{if(r._volumetricLightScatteringPass.setMatrix("viewProjection",a.getTransformMatrix()),n&&n.needAlphaTesting()){var u=n.getAlphaTestTexture();r._volumetricLightScatteringPass.setTexture("diffuseSampler",u),u&&r._volumetricLightScatteringPass.setMatrix("diffuseMatrix",u.getTextureMatrix())}i.useBones&&i.computeBonesUsingShaders&&i.skeleton&&r._volumetricLightScatteringPass.setMatrices("mBones",i.skeleton.getTransformMatrices(i))}i._processRendering(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,l,(function(e,t){return c.setMatrix("world",t)}))}}}}},l=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add((function(){o=t.clearColor,t.clearColor=l})),this._volumetricLightScatteringRTT.onAfterRenderObservable.add((function(){t.clearColor=o})),this._volumetricLightScatteringRTT.customRenderFunction=function(i,r,n,a){var o,l=t.getEngine();if(a.length){for(l.setColorWrite(!1),o=0;o<a.length;o++)s(a.data[__uv.$wrap((o))]);l.setColorWrite(!0)}for(o=0;o<i.length;o++)s(i.data[__uv.$wrap((o))]);for(o=0;o<r.length;o++)s(r.data[__uv.$wrap((o))]);if(n.length){for(o=0;o<n.length;o++){var c=n.data[__uv.$wrap((o))],u=c.getBoundingInfo();u&&t.activeCamera&&(c._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=u.boundingSphere.centerWorld.subtract(t.activeCamera.position).length())}var h=n.data.slice(0,n.length);for(h.sort((function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0})),l.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<h.length;o++)s(h[__uv.$wrap((o))]);l.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i,r=t.getTransformMatrix();i=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.__uv$setSource(__uv).__uv$parent?this.mesh.getAbsolutePosition():this.mesh.position;var n=e.Vector3.Project(i,e.Matrix.Identity(),r,this._viewPort);this._screenCoordinates.x=n.x/this._viewPort.width,this._screenCoordinates.y=n.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var r=e.Mesh.CreatePlane(t,1,i);r.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL;var n=new e.StandardMaterial(t+"Material",i);return n.emissiveColor=new e.Color3(1,1,1),r.material=n,r},n([e.serializeAsVector3()],i.prototype,"customMeshPosition",void 0),n([e.serialize()],i.prototype,"useCustomMeshPosition",void 0),n([e.serialize()],i.prototype,"invert",void 0),n([e.serializeAsMeshReference()],i.prototype,"mesh",void 0),n([e.serialize()],i.prototype,"excludedMeshes",void 0),n([e.serialize()],i.prototype,"exposure",void 0),n([e.serialize()],i.prototype,"decay",void 0),n([e.serialize()],i.prototype,"weight",void 0),n([e.serialize()],i.prototype,"density",void 0),i}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l){var c=t.call(this,i,"colorCorrection",null,["colorTable"],n,a,o,s,l)||this;return c._colorTableTexture=new e.Texture(r,a.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),c._colorTableTexture.anisotropicFilteringLevel=1,c._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,c._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,c.onApply=function(e){e.setTexture("colorTable",c._colorTableTexture)},c}return a(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(s||(s={})),function(e){var t;!function(e){e[__uv.$wrap((e.Hable=0))]="Hable",e[__uv.$wrap((e.Reinhard=1))]="Reinhard",e[__uv.$wrap((e.HejiDawson=2))]="HejiDawson",e[__uv.$wrap((e.Photographic=3))]="Photographic"}(t=e.TonemappingOperator||(e.TonemappingOperator={}));var i=function(i){function r(r,n,a,o,s,l,c){void 0===s&&(s=e.Texture.BILINEAR_SAMPLINGMODE),void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT);var u=i.call(this,r,"tonemap",["_ExposureAdjustment"],null,1,o,s,l,!0,null,c)||this;u._operator=n,u.exposureAdjustment=a;var h="#define ";return u._operator===t.Hable?h+="HABLE_TONEMAPPING":u._operator===t.Reinhard?h+="REINHARD_TONEMAPPING":u._operator===t.HejiDawson?h+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":u._operator===t.Photographic&&(h+="PHOTOGRAPHIC_TONEMAPPING"),u.updateEffect(h),u.onApply=function(e){e.setFloat("_ExposureAdjustment",u.exposureAdjustment)},u}return a(r,i),r}(e.PostProcess);e.TonemapPostProcess=i}(s||(s={})),function(e){var t=function(e){function t(t,i,r,n,a,o){return e.call(this,t,"displayPass",["passSampler"],["passSampler"],i,r,n,a,o)||this}return a(t,e),t}(e.PostProcess);e.DisplayPassPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l){return void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT),t.call(this,i,"highlights",null,null,r,n,a,o,s,null,l)||this}return a(i,t),i}(e.PostProcess);e.HighlightsPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c){void 0===n&&(n=null),void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT);var u=t.call(this,i,"imageProcessing",[],[],r,n,a,o,s,null,l,"postprocess",null,!0)||this;return u._fromLinearSpace=!0,u._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},c?(c.applyByPostProcess=!0,u._attachImageProcessingConfiguration(c,!0),u.fromLinearSpace=!1):(u._attachImageProcessingConfiguration(null,!0),u.imageProcessingConfiguration.applyByPostProcess=!0),u.onApply=function(e){u.imageProcessingConfiguration.bind(e,u.aspectRatio)},u}return a(i,t),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e)},enumerable:!0,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(t,i){var r=this;if(void 0===i&&(i=!1),t!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),t)this._imageProcessingConfiguration=t;else{var n=null,a=this.getEngine(),o=this.getCamera();if(o)n=o.getScene();else if(a&&a.scenes){var s=a.scenes;n=s[__uv.$wrap((s.length-1))]}else n=e.Engine.LastCreatedScene;this._imageProcessingConfiguration=n.imageProcessingConfiguration}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(e){r._updateParameters()}))),i||this._updateParameters()}},Object.defineProperty(i.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(e){this.imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(e){this.imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(e){this.imageProcessingConfiguration.vignetteStretch=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(e){this.imageProcessingConfiguration.vignetteCentreX=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(e){this.imageProcessingConfiguration.vignetteCentreY=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(e){this.imageProcessingConfiguration.vignetteWeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(e){this.imageProcessingConfiguration.vignetteColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(e){this.imageProcessingConfiguration.vignetteCameraFov=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(e){this.imageProcessingConfiguration.vignetteBlendMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(e){this.imageProcessingConfiguration.vignetteEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(e){this._fromLinearSpace!==e&&(this._fromLinearSpace=e,this._updateParameters())},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"ImageProcessingPostProcess"},i.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var t="";for(var i in this._defines)this._defines[__uv.$wrap((i))]&&(t+="#define "+i+";\r\n");var r=["textureSampler"],n=["scale"];e.ImageProcessingConfiguration&&(e.ImageProcessingConfiguration.PrepareSamplers(r,this._defines),e.ImageProcessingConfiguration.PrepareUniforms(n,this._defines)),this.updateEffect(t,n,r)},i.prototype.dispose=function(e){t.prototype.dispose.call(this,e),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},n([e.serialize()],i.prototype,"_fromLinearSpace",void 0),i}(e.PostProcess);e.ImageProcessingPostProcess=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l){void 0===n&&(n=null),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null);var c=t.call(this,i,r.getScene())||this;return c.name=i,c.children=new Array,c.animations=new Array,c._index=null,c._absoluteTransform=new e.Matrix,c._invertedAbsoluteTransform=new e.Matrix,c._scalingDeterminant=1,c._worldTransform=new e.Matrix,c._needToDecompose=!0,c._needToCompose=!1,c._skeleton=r,c._localMatrix=a?a.clone():e.Matrix.Identity(),c._restPose=o||c._localMatrix.clone(),c._baseMatrix=s||c._localMatrix.clone(),c._index=l,r.bones.push(c),c.setParent(n,!1),(s||a)&&c._updateDifferenceMatrix(),c}return a(i,t),Object.defineProperty(i.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(e){this._localMatrix.copyFrom(e),this._needToDecompose=!0},enumerable:!0,configurable:!0}),i.prototype.getSkeleton=function(){return this._skeleton},i.prototype.getParent=function(){return this._parent},i.prototype.setParent=function(e,t){if(void 0===t&&(t=!0),this._parent!==e){if(this._parent){var i=this._parent.children.indexOf(this);-1!==i&&this._parent.children.splice(i,1)}this._parent=e,this._parent&&this._parent.children.push(this),t&&this._updateDifferenceMatrix(),this.markAsDirty()}},i.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},i.prototype.getBaseMatrix=function(){return this._baseMatrix},i.prototype.getRestPose=function(){return this._restPose},i.prototype.getWorldMatrix=function(){return this._worldTransform},i.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},i.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},i.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},Object.defineProperty(i.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(e){this.setRotationQuaternion(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),i.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=e.Vector3.Zero(),this._localRotation=e.Quaternion.Zero(),this._localPosition=e.Vector3.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},i.prototype._compose=function(){this._needToCompose&&(this._needToCompose=!1,e.Matrix.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix))},i.prototype.updateMatrix=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!0),this._baseMatrix.copyFrom(e),t&&this._updateDifferenceMatrix(),i?(this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose()):this.markAsDirty()},i.prototype._updateDifferenceMatrix=function(e,t){if(void 0===t&&(t=!0),e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),t)for(var i=0;i<this.children.length;i++)this.children[__uv.$wrap((i))]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},i.prototype.markAsDirty=function(){this._currentRenderId++,this._childRenderId++,this._skeleton._markAsDirty()},i.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},i.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},i.prototype.copyAnimationRange=function(t,i,r,n,a){void 0===n&&(n=!1),void 0===a&&(a=null),0===this.animations.length&&(this.animations.push(new e.Animation(this.name,"_matrix",t.animations[__uv.$wrap((0))].framePerSecond,e.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[__uv.$wrap((0))].setKeys([]));var o=t.animations[__uv.$wrap((0))].getRange(i);if(!o)return!1;for(var s,l,c,u=o.from,h=o.to,d=t.animations[__uv.$wrap((0))].getKeys(),p=t.length,m=t.getParent(),_=this.getParent(),f=n&&m&&p&&this.length&&p!==this.length,g=f&&_&&m?_.length/m.length:1,y=n&&!_&&a&&(1!==a.x||1!==a.y||1!==a.z),v=this.animations[__uv.$wrap((0))].getKeys(),b=0,x=d.length;b<x;b++)(s=d[__uv.$wrap((b))]).frame>=u&&s.frame<=h&&(n?(c=s.value.clone(),f?(l=c.getTranslation(),c.setTranslation(l.scaleInPlace(g))):y&&a?(l=c.getTranslation(),c.setTranslation(l.multiplyInPlace(a))):c=s.value):c=s.value,v.push({frame:s.frame+r,value:c}));return this.animations[__uv.$wrap((0))].createRange(i,u+r,h+r),!0},i.prototype.translate=function(t,r,n){void 0===r&&(r=e.Space.LOCAL);var a=this.getLocalMatrix();if(r==e.Space.LOCAL)a.m[__uv.$wrap((12))]+=t.x,a.m[__uv.$wrap((13))]+=t.y,a.m[__uv.$wrap((14))]+=t.z;else{var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[__uv.$wrap((0))],l=i._tmpVecs[__uv.$wrap((0))];this._parent&&(n&&o?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(o,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.m[__uv.$wrap((12))]=0,s.m[__uv.$wrap((13))]=0,s.m[__uv.$wrap((14))]=0,s.invert(),e.Vector3.TransformCoordinatesToRef(t,s,l),a.m[__uv.$wrap((12))]+=l.x,a.m[__uv.$wrap((13))]+=l.y,a.m[__uv.$wrap((14))]+=l.z}this._markAsDirtyAndDecompose()},i.prototype.setPosition=function(t,r,n){void 0===r&&(r=e.Space.LOCAL);var a=this.getLocalMatrix();if(r==e.Space.LOCAL)a.m[__uv.$wrap((12))]=t.x,a.m[__uv.$wrap((13))]=t.y,a.m[__uv.$wrap((14))]=t.z;else{var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[__uv.$wrap((0))],l=i._tmpVecs[__uv.$wrap((0))];this._parent&&(n&&o?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(o,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.invert(),e.Vector3.TransformCoordinatesToRef(t,s,l),a.m[__uv.$wrap((12))]=l.x,a.m[__uv.$wrap((13))]=l.y,a.m[__uv.$wrap((14))]=l.z}this._markAsDirtyAndDecompose()},i.prototype.setAbsolutePosition=function(t,i){this.setPosition(t,e.Space.WORLD,i)},i.prototype.scale=function(t,r,n,a){void 0===a&&(a=!1);var o=this.getLocalMatrix(),s=i._tmpMats[__uv.$wrap((0))];e.Matrix.ScalingToRef(t,r,n,s),s.multiplyToRef(o,o),s.invert();for(var l=0,c=this.children;l<c.length;l++){var u=(p=c[__uv.$wrap((l))]).getLocalMatrix();u.multiplyToRef(s,u),u.m[__uv.$wrap((12))]*=t,u.m[__uv.$wrap((13))]*=r,u.m[__uv.$wrap((14))]*=n,p._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),a)for(var h=0,d=this.children;h<d.length;h++){var p;(p=d[__uv.$wrap((h))]).scale(t,r,n,a)}},i.prototype.setScale=function(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()},i.prototype.getScale=function(){return this._decompose(),this._localScaling},i.prototype.getScaleToRef=function(e){this._decompose(),e.copyFrom(this._localScaling)},i.prototype.setYawPitchRoll=function(t,r,n,a,o){if(void 0===a&&(a=e.Space.LOCAL),a===e.Space.LOCAL){var s=i._tmpQuat;return e.Quaternion.RotationYawPitchRollToRef(t,r,n,s),void this.setRotationQuaternion(s,a,o)}var l=i._tmpMats[__uv.$wrap((0))];if(this._getNegativeRotationToRef(l,o)){var c=i._tmpMats[__uv.$wrap((1))];e.Matrix.RotationYawPitchRollToRef(t,r,n,c),l.multiplyToRef(c,c),this._rotateWithMatrix(c,a,o)}},i.prototype.rotate=function(t,r,n,a){void 0===n&&(n=e.Space.LOCAL);var o=i._tmpMats[__uv.$wrap((0))];o.m[__uv.$wrap((12))]=0,o.m[__uv.$wrap((13))]=0,o.m[__uv.$wrap((14))]=0,e.Matrix.RotationAxisToRef(t,r,o),this._rotateWithMatrix(o,n,a)},i.prototype.setAxisAngle=function(t,r,n,a){if(void 0===n&&(n=e.Space.LOCAL),n===e.Space.LOCAL){var o=i._tmpQuat;return e.Quaternion.RotationAxisToRef(t,r,o),void this.setRotationQuaternion(o,n,a)}var s=i._tmpMats[__uv.$wrap((0))];if(this._getNegativeRotationToRef(s,a)){var l=i._tmpMats[__uv.$wrap((1))];e.Matrix.RotationAxisToRef(t,r,l),s.multiplyToRef(l,l),this._rotateWithMatrix(l,n,a)}},i.prototype.setRotation=function(t,i,r){void 0===i&&(i=e.Space.LOCAL),this.setYawPitchRoll(t.y,t.x,t.z,i,r)},i.prototype.setRotationQuaternion=function(t,r,n){if(void 0===r&&(r=e.Space.LOCAL),r===e.Space.LOCAL)return this._decompose(),this._localRotation.copyFrom(t),void this._markAsDirtyAndCompose();var a=i._tmpMats[__uv.$wrap((0))];if(this._getNegativeRotationToRef(a,n)){var o=i._tmpMats[__uv.$wrap((1))];e.Matrix.FromQuaternionToRef(t,o),a.multiplyToRef(o,o),this._rotateWithMatrix(o,r,n)}},i.prototype.setRotationMatrix=function(t,r,n){if(void 0===r&&(r=e.Space.LOCAL),r===e.Space.LOCAL){var a=i._tmpQuat;return e.Quaternion.FromRotationMatrixToRef(t,a),void this.setRotationQuaternion(a,r,n)}var o=i._tmpMats[__uv.$wrap((0))];if(this._getNegativeRotationToRef(o,n)){var s=i._tmpMats[__uv.$wrap((1))];s.copyFrom(t),o.multiplyToRef(t,s),this._rotateWithMatrix(s,r,n)}},i.prototype._rotateWithMatrix=function(t,r,n){void 0===r&&(r=e.Space.LOCAL);var a=this.getLocalMatrix(),o=a.m[__uv.$wrap((12))],s=a.m[__uv.$wrap((13))],l=a.m[__uv.$wrap((14))],c=this.getParent(),u=i._tmpMats[__uv.$wrap((3))],h=i._tmpMats[__uv.$wrap((4))];c&&r==e.Space.WORLD?(n?(u.copyFrom(n.getWorldMatrix()),c.getAbsoluteTransform().multiplyToRef(u,u)):u.copyFrom(c.getAbsoluteTransform()),h.copyFrom(u),h.invert(),a.multiplyToRef(u,a),a.multiplyToRef(t,a),a.multiplyToRef(h,a)):r==e.Space.WORLD&&n?(u.copyFrom(n.getWorldMatrix()),h.copyFrom(u),h.invert(),a.multiplyToRef(u,a),a.multiplyToRef(t,a),a.multiplyToRef(h,a)):a.multiplyToRef(t,a),a.m[__uv.$wrap((12))]=o,a.m[__uv.$wrap((13))]=s,a.m[__uv.$wrap((14))]=l,this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},i.prototype._getNegativeRotationToRef=function(t,r){var n=i._tmpMats[__uv.$wrap((2))];return t.copyFrom(this.getAbsoluteTransform()),r&&(t.multiplyToRef(r.getWorldMatrix(),t),e.Matrix.ScalingToRef(r.scaling.x,r.scaling.y,r.scaling.z,n)),t.invert(),!isNaN(t.m[__uv.$wrap((0))])&&(n.m[__uv.$wrap((0))]*=this._scalingDeterminant,t.multiplyToRef(n,t),!0)},i.prototype.getPosition=function(t,i){void 0===t&&(t=e.Space.LOCAL),void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getPositionToRef(t,i,r),r},i.prototype.getPositionToRef=function(t,r,n){if(void 0===t&&(t=e.Space.LOCAL),t==e.Space.LOCAL){var a=this.getLocalMatrix();n.x=a.m[__uv.$wrap((12))],n.y=a.m[__uv.$wrap((13))],n.z=a.m[__uv.$wrap((14))]}else{var o=null;r&&(o=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[__uv.$wrap((0))];r&&o?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(o,s)):s=this.getAbsoluteTransform(),n.x=s.m[__uv.$wrap((12))],n.y=s.m[__uv.$wrap((13))],n.z=s.m[__uv.$wrap((14))]}},i.prototype.getAbsolutePosition=function(t){void 0===t&&(t=null);var i=e.Vector3.Zero();return this.getPositionToRef(e.Space.WORLD,t,i),i},i.prototype.getAbsolutePositionToRef=function(t,i){this.getPositionToRef(e.Space.WORLD,t,i)},i.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var t=this.children,i=t.length,r=0;r<i;r++)t[__uv.$wrap((r))].computeAbsoluteTransforms()},i.prototype.getDirection=function(t,i){void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getDirectionToRef(t,i,r),r},i.prototype.getDirectionToRef=function(t,r,n){void 0===r&&(r=null);var a=null;r&&(a=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var o=i._tmpMats[__uv.$wrap((0))];o.copyFrom(this.getAbsoluteTransform()),r&&a&&o.multiplyToRef(a,o),e.Vector3.TransformNormalToRef(t,o,n),n.normalize()},i.prototype.getRotation=function(t,i){void 0===t&&(t=e.Space.LOCAL),void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getRotationToRef(t,i,r),r},i.prototype.getRotationToRef=function(t,r,n){void 0===t&&(t=e.Space.LOCAL),void 0===r&&(r=null);var a=i._tmpQuat;this.getRotationQuaternionToRef(t,r,a),a.toEulerAnglesToRef(n)},i.prototype.getRotationQuaternion=function(t,i){void 0===t&&(t=e.Space.LOCAL),void 0===i&&(i=null);var r=e.Quaternion.Identity();return this.getRotationQuaternionToRef(t,i,r),r},i.prototype.getRotationQuaternionToRef=function(t,r,n){if(void 0===t&&(t=e.Space.LOCAL),void 0===r&&(r=null),t==e.Space.LOCAL)this._decompose(),n.copyFrom(this._localRotation);else{var a=i._tmpMats[__uv.$wrap((0))],o=this.getAbsoluteTransform();r?o.multiplyToRef(r.getWorldMatrix(),a):a.copyFrom(o),a.m[__uv.$wrap((0))]*=this._scalingDeterminant,a.m[__uv.$wrap((1))]*=this._scalingDeterminant,a.m[__uv.$wrap((2))]*=this._scalingDeterminant,a.decompose(void 0,n,void 0)}},i.prototype.getRotationMatrix=function(t,i){void 0===t&&(t=e.Space.LOCAL);var r=e.Matrix.Identity();return this.getRotationMatrixToRef(t,i,r),r},i.prototype.getRotationMatrixToRef=function(t,r,n){if(void 0===t&&(t=e.Space.LOCAL),t==e.Space.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(n);else{var a=i._tmpMats[__uv.$wrap((0))],o=this.getAbsoluteTransform();r?o.multiplyToRef(r.getWorldMatrix(),a):a.copyFrom(o),a.m[__uv.$wrap((0))]*=this._scalingDeterminant,a.m[__uv.$wrap((1))]*=this._scalingDeterminant,a.m[__uv.$wrap((2))]*=this._scalingDeterminant,a.getRotationMatrixToRef(n)}},i.prototype.getAbsolutePositionFromLocal=function(t,i){void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getAbsolutePositionFromLocalToRef(t,i,r),r},i.prototype.getAbsolutePositionFromLocalToRef=function(t,r,n){void 0===r&&(r=null);var a=null;r&&(a=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var o=i._tmpMats[__uv.$wrap((0))];r&&a?(o.copyFrom(this.getAbsoluteTransform()),o.multiplyToRef(a,o)):o=this.getAbsoluteTransform(),e.Vector3.TransformCoordinatesToRef(t,o,n)},i.prototype.getLocalPositionFromAbsolute=function(t,i){void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getLocalPositionFromAbsoluteToRef(t,i,r),r},i.prototype.getLocalPositionFromAbsoluteToRef=function(t,r,n){void 0===r&&(r=null);var a=null;r&&(a=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var o=i._tmpMats[__uv.$wrap((0))];o.copyFrom(this.getAbsoluteTransform()),r&&a&&o.multiplyToRef(a,o),o.invert(),e.Vector3.TransformCoordinatesToRef(t,o,n)},i._tmpVecs=[e.Vector3.Zero(),e.Vector3.Zero()],i._tmpQuat=e.Quaternion.Identity(),i._tmpMats=[e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity()],i}(e.Node);e.Bone=t}(s||(s={})),function(e){var t=function(){function t(t,i,r){if(this.targetPosition=e.Vector3.Zero(),this.poleTargetPosition=e.Vector3.Zero(),this.poleTargetLocalOffset=e.Vector3.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=e.Quaternion.Identity(),this._bone1Mat=e.Matrix.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=e.Vector3.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=i,this._bone1=i.getParent(),this._bone1){this.mesh=t;var n=i.getPosition();if(i.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,n.x>n.y&&n.x>n.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var a=this._bone1.getScale(),o=this._bone2.getScale();this._bone1Length=this._bone1.length*a.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*o.y*this.mesh.scaling.y}else if(this._bone1.children[__uv.$wrap((0))]){t.computeWorldMatrix(!0);var s=this._bone2.children[__uv.$wrap((0))].getAbsolutePosition(t),l=this._bone2.getAbsolutePosition(t),c=this._bone1.getAbsolutePosition(t);this._bone1Length=e.Vector3.Distance(s,l),this._bone2Length=e.Vector3.Distance(l,c)}this._bone1.getRotationMatrixToRef(e.Space.WORLD,t,this._bone1Mat),this.maxAngle=Math.PI,r&&(r.targetMesh&&(this.targetMesh=r.targetMesh,this.targetMesh.computeWorldMatrix(!0)),r.poleTargetMesh?(this.poleTargetMesh=r.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):r.poleTargetBone?this.poleTargetBone=r.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),r.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(r.poleTargetLocalOffset),r.poleAngle&&(this.poleAngle=r.poleAngle),r.bendAxis&&this._bendAxis.copyFrom(r.bendAxis),r.maxAngle&&(this.maxAngle=r.maxAngle),r.slerpAmount&&(this.slerpAmount=r.slerpAmount))}}return Object.defineProperty(t.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(e){this._setMaxAngle(e)},enumerable:!0,configurable:!0}),t.prototype._setMaxAngle=function(e){e<0&&(e=0),(e>Math.PI||null==e)&&(e=Math.PI),this._maxAngle=e;var t=this._bone1Length,i=this._bone2Length;this._maxReach=Math.sqrt(t*t+i*i-2*t*i*Math.cos(e))},t.prototype.update=function(){var i=this._bone1;if(i){var r=this.targetPosition,n=this.poleTargetPosition,a=t._tmpMats[__uv.$wrap((0))],o=t._tmpMats[__uv.$wrap((1))];this.targetMesh&&r.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,n):this.poleTargetMesh&&e.Vector3.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),n);var s=t._tmpVecs[__uv.$wrap((0))],l=t._tmpVecs[__uv.$wrap((1))],c=t._tmpVecs[__uv.$wrap((2))],u=t._tmpVecs[__uv.$wrap((3))],h=t._tmpVecs[__uv.$wrap((4))],d=t._tmpQuat;i.getAbsolutePositionToRef(this.mesh,s),n.subtractToRef(s,h),0==h.x&&0==h.y&&0==h.z?h.y=1:h.normalize(),r.subtractToRef(s,u),u.normalize(),e.Vector3.CrossToRef(u,h,l),l.normalize(),e.Vector3.CrossToRef(u,l,c),c.normalize(),e.Matrix.FromXYZAxesToRef(c,u,l,a);var p=this._bone1Length,m=this._bone2Length,_=e.Vector3.Distance(s,r);this._maxReach>0&&(_=Math.min(this._maxReach,_));var f=(m*m+_*_-p*p)/(2*m*_),g=(_*_+p*p-m*m)/(2*_*p);f>1&&(f=1),g>1&&(g=1),f<-1&&(f=-1),g<-1&&(g=-1);var y=Math.acos(f),v=Math.acos(g),b=-y-v;if(this._rightHandedSystem)e.Matrix.RotationYawPitchRollToRef(0,0,this._adjustRoll,o),o.multiplyToRef(a,a),e.Matrix.RotationAxisToRef(this._bendAxis,v,o),o.multiplyToRef(a,a);else{var x=t._tmpVecs[__uv.$wrap((5))];x.copyFrom(this._bendAxis),x.x*=-1,e.Matrix.RotationAxisToRef(x,-v,o),o.multiplyToRef(a,a)}this.poleAngle&&(e.Matrix.RotationAxisToRef(u,this.poleAngle,o),a.multiplyToRef(o,a)),this._bone1&&(this.slerpAmount<1?(this._slerping||e.Quaternion.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),e.Quaternion.FromRotationMatrixToRef(a,d),e.Quaternion.SlerpToRef(this._bone1Quat,d,this.slerpAmount,this._bone1Quat),b=this._bone2Ang*(1-this.slerpAmount)+b*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,e.Space.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(a,e.Space.WORLD,this.mesh),this._bone1Mat.copyFrom(a),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,b,e.Space.LOCAL),this._bone2Ang=b}},t._tmpVecs=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],t._tmpQuat=e.Quaternion.Identity(),t._tmpMats=[e.Matrix.Identity(),e.Matrix.Identity()],t}();e.BoneIKController=t}(s||(s={})),function(e){var t=function(){function t(t,i,r,n){if(this.upAxis=e.Vector3.Up(),this.upAxisSpace=e.Space.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=e.Quaternion.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=e.Vector3.Forward(),this.mesh=t,this.bone=i,this.target=r,n&&(n.adjustYaw&&(this.adjustYaw=n.adjustYaw),n.adjustPitch&&(this.adjustPitch=n.adjustPitch),n.adjustRoll&&(this.adjustRoll=n.adjustRoll),null!=n.maxYaw?this.maxYaw=n.maxYaw:this.maxYaw=Math.PI,null!=n.minYaw?this.minYaw=n.minYaw:this.minYaw=-Math.PI,null!=n.maxPitch?this.maxPitch=n.maxPitch:this.maxPitch=Math.PI,null!=n.minPitch?this.minPitch=n.minPitch:this.minPitch=-Math.PI,null!=n.slerpAmount&&(this.slerpAmount=n.slerpAmount),null!=n.upAxis&&(this.upAxis=n.upAxis),null!=n.upAxisSpace&&(this.upAxisSpace=n.upAxisSpace),null!=n.yawAxis||null!=n.pitchAxis)){var a=e.Axis.Y,o=e.Axis.X;null!=n.yawAxis&&(a=n.yawAxis.clone()).normalize(),null!=n.pitchAxis&&(o=n.pitchAxis.clone()).normalize();var s=e.Vector3.Cross(o,a);this._transformYawPitch=e.Matrix.Identity(),e.Matrix.FromXYZAxesToRef(o,a,s,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}i.getParent()||this.upAxisSpace!=e.Space.BONE||(this.upAxisSpace=e.Space.LOCAL)}return Object.defineProperty(t.prototype,"minYaw",{get:function(){return this._minYaw},set:function(e){this._minYaw=e,this._minYawSin=Math.sin(e),this._minYawCos=Math.cos(e),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(e){this._maxYaw=e,this._maxYawSin=Math.sin(e),this._maxYawCos=Math.cos(e),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPitch",{get:function(){return this._minPitch},set:function(e){this._minPitch=e,this._minPitchTan=Math.tan(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(e){this._maxPitch=e,this._maxPitchTan=Math.tan(e)},enumerable:!0,configurable:!0}),t.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var i=this.bone,r=t._tmpVecs[__uv.$wrap((0))];i.getAbsolutePositionToRef(this.mesh,r);var n=this.target,a=t._tmpMats[__uv.$wrap((0))],o=t._tmpMats[__uv.$wrap((1))],s=this.mesh,l=i.getParent(),c=t._tmpVecs[__uv.$wrap((1))];c.copyFrom(this.upAxis),this.upAxisSpace==e.Space.BONE&&l?(this._transformYawPitch&&e.Vector3.TransformCoordinatesToRef(c,this._transformYawPitchInv,c),l.getDirectionToRef(c,this.mesh,c)):this.upAxisSpace==e.Space.LOCAL&&(s.getDirectionToRef(c,c),1==s.scaling.x&&1==s.scaling.y&&1==s.scaling.z||c.normalize());var u=!1,h=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(u=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(h=!0),u||h){var d=t._tmpMats[__uv.$wrap((2))],p=t._tmpMats[__uv.$wrap((3))];if(this.upAxisSpace==e.Space.BONE&&1==c.y&&l)l.getRotationMatrixToRef(e.Space.WORLD,this.mesh,d);else if(this.upAxisSpace!=e.Space.LOCAL||1!=c.y||l){(_=t._tmpVecs[__uv.$wrap((2))]).copyFrom(this._fowardAxis),this._transformYawPitch&&e.Vector3.TransformCoordinatesToRef(_,this._transformYawPitchInv,_),l?l.getDirectionToRef(_,this.mesh,_):s.getDirectionToRef(_,_);var m=e.Vector3.Cross(c,_);m.normalize();var _=e.Vector3.Cross(m,c);e.Matrix.FromXYZAxesToRef(m,c,_,d)}else d.copyFrom(s.getWorldMatrix());d.invertToRef(p);var f=null;if(h){var g=t._tmpVecs[__uv.$wrap((3))];n.subtractToRef(r,g),e.Vector3.TransformCoordinatesToRef(g,p,g),f=Math.sqrt(g.x*g.x+g.z*g.z);var y=Math.atan2(g.y,f),v=y;y>this._maxPitch?(g.y=this._maxPitchTan*f,v=this._maxPitch):y<this._minPitch&&(g.y=this._minPitchTan*f,v=this._minPitch),y!=v&&(e.Vector3.TransformCoordinatesToRef(g,d,g),g.addInPlace(r),n=g)}if(u){g=t._tmpVecs[__uv.$wrap((4))];n.subtractToRef(r,g),e.Vector3.TransformCoordinatesToRef(g,p,g);var b=Math.atan2(g.x,g.z),x=b;if((b>this._maxYaw||b<this._minYaw)&&(null==f&&(f=Math.sqrt(g.x*g.x+g.z*g.z)),this._yawRange>Math.PI?this._isAngleBetween(b,this._maxYaw,this._midYawConstraint)?(g.z=this._maxYawCos*f,g.x=this._maxYawSin*f,x=this._maxYaw):this._isAngleBetween(b,this._midYawConstraint,this._minYaw)&&(g.z=this._minYawCos*f,g.x=this._minYawSin*f,x=this._minYaw):b>this._maxYaw?(g.z=this._maxYawCos*f,g.x=this._maxYawSin*f,x=this._maxYaw):b<this._minYaw&&(g.z=this._minYawCos*f,g.x=this._minYawSin*f,x=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var S=t._tmpVecs[__uv.$wrap((8))];S.copyFrom(e.Axis.Z),this._transformYawPitch&&e.Vector3.TransformCoordinatesToRef(S,this._transformYawPitchInv,S);var T=t._tmpMats[__uv.$wrap((4))];this._boneQuat.toRotationMatrix(T),this.mesh.getWorldMatrix().multiplyToRef(T,T),e.Vector3.TransformCoordinatesToRef(S,T,S),e.Vector3.TransformCoordinatesToRef(S,p,S);var E=Math.atan2(S.x,S.z);if(this._getAngleBetween(E,b)>this._getAngleBetween(E,this._midYawConstraint)){null==f&&(f=Math.sqrt(g.x*g.x+g.z*g.z));var P=this._getAngleBetween(E,this._maxYaw);this._getAngleBetween(E,this._minYaw)<P?(x=E+.75*Math.PI,g.z=Math.cos(x)*f,g.x=Math.sin(x)*f):(x=E-.75*Math.PI,g.z=Math.cos(x)*f,g.x=Math.sin(x)*f)}}b!=x&&(e.Vector3.TransformCoordinatesToRef(g,d,g),g.addInPlace(r),n=g)}}var A=t._tmpVecs[__uv.$wrap((5))],M=t._tmpVecs[__uv.$wrap((6))],C=t._tmpVecs[__uv.$wrap((7))],R=t._tmpQuat;n.subtractToRef(r,A),A.normalize(),e.Vector3.CrossToRef(c,A,M),M.normalize(),e.Vector3.CrossToRef(A,M,C),C.normalize(),e.Matrix.FromXYZAxesToRef(M,C,A,a),0===M.x&&0===M.y&&0===M.z||0===C.x&&0===C.y&&0===C.z||0===A.x&&0===A.y&&0===A.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(e.Matrix.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,o),o.multiplyToRef(a,a)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(e.Space.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(a,a),e.Quaternion.FromRotationMatrixToRef(a,R),e.Quaternion.SlerpToRef(this._boneQuat,R,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,e.Space.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(a,a),this.bone.setRotationMatrix(a,e.Space.WORLD,this.mesh),this._slerping=!1))}},t.prototype._getAngleDiff=function(e,t){var i=t-e;return(i%=2*Math.PI)>Math.PI?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI),i},t.prototype._getAngleBetween=function(e,t){var i=0;return(i=(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)?t-e:e-t)>Math.PI&&(i=2*Math.PI-i),i},t.prototype._isAngleBetween=function(e,t,i){if(e=(e%=2*Math.PI)<0?e+2*Math.PI:e,(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(i=(i%=2*Math.PI)<0?i+2*Math.PI:i)){if(e>t&&e<i)return!0}else if(e>i&&e<t)return!0;return!1},t._tmpVecs=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],t._tmpQuat=e.Quaternion.Identity(),t._tmpMats=[e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity()],t}();e.BoneLookController=t}(s||(s={})),function(e){var t=function(){function t(t,i,r){this.name=t,this.id=i,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=e.Matrix.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this.doNotSerialize=!1,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new e.Observable,this.bones=[],this._scene=r||e.Engine.LastCreatedScene,r.skeletons.push(this),this._isDirty=!0}return Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),t.prototype.getTransformMatrices=function(e){return this.needInitialSkinMatrix&&e._bonesTransformMatrices?e._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},t.prototype.getScene=function(){return this._scene},t.prototype.toString=function(e){var t="Name: "+this.name+", nBones: "+this.bones.length;if(t+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var r in this._ranges)i&&(t+=", ",i=!1),t+=r;t+="}"}return t},t.prototype.getBoneIndexByName=function(e){for(var t=0,i=this.bones.length;t<i;t++)if(this.bones[__uv.$wrap((t))].name===e)return t;return-1},t.prototype.createAnimationRange=function(t,i,r){if(!this._ranges[__uv.$wrap((t))]){this._ranges[__uv.$wrap((t))]=new e.AnimationRange(t,i,r);for(var n=0,a=this.bones.length;n<a;n++)this.bones[__uv.$wrap((n))].animations[__uv.$wrap((0))]&&this.bones[__uv.$wrap((n))].animations[__uv.$wrap((0))].createRange(t,i,r)}},t.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,r=this.bones.length;i<r;i++)this.bones[__uv.$wrap((i))].animations[__uv.$wrap((0))]&&this.bones[__uv.$wrap((i))].animations[__uv.$wrap((0))].deleteRange(e,t);this._ranges[__uv.$wrap((e))]=null},t.prototype.getAnimationRange=function(e){return this._ranges[__uv.$wrap((e))]},t.prototype.getAnimationRanges=function(){var e,t=[],i=0;for(e in this._ranges)t[__uv.$wrap((i))]=this._ranges[__uv.$wrap((e))],i++;return t},t.prototype.copyAnimationRange=function(t,i,r){if(void 0===r&&(r=!1),this._ranges[__uv.$wrap((i))]||!t.getAnimationRange(i))return!1;var n,a,o=!0,s=this._getHighestAnimationFrame()+1,l={},c=t.bones;for(a=0,n=c.length;a<n;a++)l[__uv.$wrap((c[__uv.$wrap((a))].name))]=c[__uv.$wrap((a))];this.bones.length!==c.length&&(e.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+c.length),o=!1);var u=r&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(a=0,n=this.bones.length;a<n;a++){var h=this.bones[__uv.$wrap((a))].name,d=l[__uv.$wrap((h))];d?o=o&&this.bones[__uv.$wrap((a))].copyAnimationRange(d,i,s,r,u):(e.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+h),o=!1)}var p=t.getAnimationRange(i);return p&&(this._ranges[__uv.$wrap((i))]=new e.AnimationRange(i,p.from+s,p.to+s)),o},t.prototype.returnToRest=function(){for(var e=0;e<this.bones.length;e++)this.bones[__uv.$wrap((e))].returnToRest()},t.prototype._getHighestAnimationFrame=function(){for(var e=0,t=0,i=this.bones.length;t<i;t++)if(this.bones[__uv.$wrap((t))].animations[__uv.$wrap((0))]){var r=this.bones[__uv.$wrap((t))].animations[__uv.$wrap((0))].getHighestFrame();e<r&&(e=r)}return e},t.prototype.beginAnimation=function(e,t,i,r){var n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,i,r):null},t.prototype._markAsDirty=function(){this._isDirty=!0},t.prototype._registerMeshWithPoseMatrix=function(e){this._meshesWithPoseMatrix.push(e)},t.prototype._unregisterMeshWithPoseMatrix=function(e){var t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)},t.prototype._computeTransformMatrices=function(e,t){this.onBeforeComputeObservable.notifyObservers(this);for(var i=0;i<this.bones.length;i++){var r=this.bones[__uv.$wrap((i))],n=r.getParent();if(n?r.getLocalMatrix().multiplyToRef(n.getWorldMatrix(),r.getWorldMatrix()):t?r.getLocalMatrix().multiplyToRef(t,r.getWorldMatrix()):r.getWorldMatrix().copyFrom(r.getLocalMatrix()),-1!==r._index){var a=null===r._index?i:r._index;r.getInvertedAbsoluteTransform().multiplyToArray(r.getWorldMatrix(),e,16*a)}}this._identity.copyToArray(e,16*this.bones.length)},t.prototype.prepare=function(){if(this._isDirty){if(this.needInitialSkinMatrix)for(var t=0;t<this._meshesWithPoseMatrix.length;t++){var i=this._meshesWithPoseMatrix[__uv.$wrap((t))],r=i.getPoseMatrix();if(i._bonesTransformMatrices&&i._bonesTransformMatrices.length===16*(this.bones.length+1)||(i._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==i){this._synchronizedWithMesh=i;for(var n=0;n<this.bones.length;n++){var a=this.bones[__uv.$wrap((n))];if(!a.getParent())a.getBaseMatrix().multiplyToRef(r,e.Tmp.Matrix[__uv.$wrap((1))]),a._updateDifferenceMatrix(e.Tmp.Matrix[__uv.$wrap((1))])}}this._computeTransformMatrices(i._bonesTransformMatrices,r)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},t.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[__uv.$wrap((e))])}return this._animatables},t.prototype.clone=function(i,r){var n=new t(i,r||i,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var a=0;a<this.bones.length;a++){var o=this.bones[__uv.$wrap((a))],s=null,l=o.getParent();if(l){var c=this.bones.indexOf(l);s=n.bones[__uv.$wrap((c))]}var u=new e.Bone(o.name,n,s,o.getBaseMatrix().clone(),o.getRestPose().clone());e.Tools.DeepCopy(o.animations,u.animations)}if(this._ranges)for(var h in n._ranges={},this._ranges){var d=this._ranges[__uv.$wrap((h))];d&&(n._ranges[__uv.$wrap((h))]=d.clone())}return this._isDirty=!0,n},t.prototype.enableBlending=function(e){void 0===e&&(e=.01),this.bones.forEach((function(t){t.animations.forEach((function(t){t.enableBlending=!0,t.blendingSpeed=e}))}))},t.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this)},t.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var t=0;t<this.bones.length;t++){var i=this.bones[__uv.$wrap((t))],r=i.getParent(),n={parentBoneIndex:r?this.bones.indexOf(r):-1,name:i.name,matrix:i.getBaseMatrix().toArray(),rest:i.getRestPose().toArray()};for(var a in e.bones.push(n),i.length&&(n.length=i.length),i.metadata&&(n.metadata=i.metadata),i.animations&&i.animations.length>0&&(n.animation=i.animations[__uv.$wrap((0))].serialize()),e.ranges=[],this._ranges){var o=this._ranges[__uv.$wrap((a))];if(o){var s={};s.name=a,s.from=o.from,s.to=o.to,e.ranges.push(s)}}}return e},t.Parse=function(i,r){var n,a=new t(i.name,i.id,r);for(i.dimensionsAtRest&&(a.dimensionsAtRest=e.Vector3.FromArray(i.dimensionsAtRest)),a.needInitialSkinMatrix=i.needInitialSkinMatrix,n=0;n<i.bones.length;n++){var o=i.bones[__uv.$wrap((n))],s=null;o.parentBoneIndex>-1&&(s=a.bones[__uv.$wrap((o.parentBoneIndex))]);var l=o.rest?e.Matrix.FromArray(o.rest):null,c=new e.Bone(o.name,a,s,e.Matrix.FromArray(o.matrix),l);void 0!==o.id&&null!==o.id&&(c.id=o.id),o.length&&(c.length=o.length),o.metadata&&(c.metadata=o.metadata),o.animation&&c.animations.push(e.Animation.Parse(o.animation))}if(i.ranges)for(n=0;n<i.ranges.length;n++){var u=i.ranges[__uv.$wrap((n))];a.createAnimationRange(u.name,u.from,u.to)}return a},t.prototype.computeAbsoluteTransforms=function(e){void 0===e&&(e=!1);var t=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=t||e)&&(this.bones[__uv.$wrap((0))].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=t)},t.prototype.getPoseMatrix=function(){var e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[__uv.$wrap((0))].getPoseMatrix()),e},t.prototype.sortBones=function(){for(var e=new Array,t=new Array(this.bones.length),i=0;i<this.bones.length;i++)this._sortBones(i,e,t);this.bones=e},t.prototype._sortBones=function(e,t,i){if(!i[__uv.$wrap((e))]){i[__uv.$wrap((e))]=!0;var r=this.bones[__uv.$wrap((e))];void 0===r._index&&(r._index=e);var n=r.getParent();n&&this._sortBones(this.bones.indexOf(n),t,i),t.push(r)}},t}();e.Skeleton=t}(s||(s={})),function(e){var t=function(){function t(){}return t.Ldexp=function(e,t){return t>1023?e*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?e*Math.pow(2,-1074)*Math.pow(2,t+1074):e*Math.pow(2,t)},t.Rgbe2float=function(e,t,i,r,n,a){n>0?(n=this.Ldexp(1,n-136),e[__uv.$wrap((a+0))]=t*n,e[__uv.$wrap((a+1))]=i*n,e[__uv.$wrap((a+2))]=r*n):(e[__uv.$wrap((a+0))]=0,e[__uv.$wrap((a+1))]=0,e[__uv.$wrap((a+2))]=0)},t.readStringLine=function(e,t){for(var i="",r="",n=t;n<e.length-t&&"\n"!=(r=String.fromCharCode(e[__uv.$wrap((n))]));n++)i+=r;return i},t.RGBE_ReadHeader=function(e){var t,i,r=this.readStringLine(e,0);if("#"!=r[__uv.$wrap((0))]||"?"!=r[__uv.$wrap((1))])throw"Bad HDR Format.";var n=!1,a=!1,o=0;do{o+=r.length+1,"FORMAT=32-bit_rle_rgbe"==(r=this.readStringLine(e,o))?a=!0:0==r.length&&(n=!0)}while(!n);if(!a)throw"HDR Bad header format, unsupported FORMAT";o+=r.length+1,r=this.readStringLine(e,o);var s=/^\-Y (.*) \+X (.*)$/g.exec(r);if(!s||s.length<3)throw"HDR Bad header format, no size";if(i=parseInt(s[__uv.$wrap((2))]),t=parseInt(s[__uv.$wrap((1))]),i<8||i>32767)throw"HDR Bad header format, unsupported size";return{height:t,width:i,dataPosition:o+=r.length+1}},t.GetCubeMapTextureData=function(t,i){var r=new Uint8Array(t),n=this.RGBE_ReadHeader(r),a=this.RGBE_ReadPixels_RLE(r,n);return e.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(a,n.width,n.height,i)},t.RGBE_ReadPixels=function(e,t){return this.RGBE_ReadPixels_RLE(e,t)},t.RGBE_ReadPixels_RLE=function(e,t){for(var i,r,n,a,o,s=t.height,l=t.width,c=t.dataPosition,u=0,h=0,d=0,p=new ArrayBuffer(4*l),m=new Uint8Array(p),_=new ArrayBuffer(t.width*t.height*4*3),f=new Float32Array(_);s>0;){if(i=e[__uv.$wrap((c++))],r=e[__uv.$wrap((c++))],n=e[__uv.$wrap((c++))],a=e[__uv.$wrap((c++))],2!=i||2!=r||128&n)throw"HDR Bad header format, not RLE";if((n<<8|a)!=l)throw"HDR Bad header format, wrong scan line width";for(u=0,d=0;d<4;d++)for(h=(d+1)*l;u<h;)if(i=e[__uv.$wrap((c++))],r=e[__uv.$wrap((c++))],i>128){if(0==(o=i-128)||o>h-u)throw"HDR Bad Format, bad scanline data (run)";for(;o-- >0;)m[__uv.$wrap((u++))]=r}else{if(0==(o=i)||o>h-u)throw"HDR Bad Format, bad scanline data (non-run)";if(m[__uv.$wrap((u++))]=r,--o>0)for(var g=0;g<o;g++)m[__uv.$wrap((u++))]=e[__uv.$wrap((c++))]}for(d=0;d<l;d++)i=m[__uv.$wrap((d))],r=m[__uv.$wrap((d+l))],n=m[__uv.$wrap((d+2*l))],a=m[__uv.$wrap((d+3*l))],this.Rgbe2float(f,i,r,n,a,(t.height-s)*l*3+3*d);s--}return f},t}();e.HDRTools=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s,l,c,u){void 0===a&&(a=!1),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===l&&(l=!1),void 0===c&&(c=null),void 0===u&&(u=null);var h=t.call(this,r)||this;return h._generateHarmonics=!0,h._onLoad=null,h._onError=null,h.coordinatesMode=e.Texture.CUBIC_MODE,h._isBlocking=!0,h._rotationY=0,h.boundingBoxPosition=e.Vector3.Zero(),i?(h.name=i,h.url=i,h.hasAlpha=!1,h.isCube=!0,h._textureMatrix=e.Matrix.Identity(),h._onLoad=c,h._onError=u,h.gammaSpace=s,h._noMipmap=a,h._size=n,h._texture=h._getFromCache(i,h._noMipmap),h._texture||(r.useDelayedTextureLoading?h.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:h.loadTexture()),h):h}return a(i,t),Object.defineProperty(i.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rotationY},set:function(t){this._rotationY=t,this.setReflectionTextureMatrix(e.Matrix.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(t){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(t)){this._boundingBoxSize=t;var i=this.getScene();i&&i.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)}},enumerable:!0,configurable:!0}),i.prototype.loadTexture=function(){var t=this,r=this.getScene();r&&(this._texture=r.getEngine().createRawCubeTextureFromUrl(this.url,r,this._size,e.Engine.TEXTUREFORMAT_RGB,r.getEngine().getCaps().textureFloat?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,(function(r){t.lodGenerationOffset=0,t.lodGenerationScale=.8;var n=t.getScene();if(!n)return null;var a=e.HDRTools.GetCubeMapTextureData(r,t._size);if(t._generateHarmonics){var o=e.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(a);t.sphericalPolynomial=o}for(var s=[],l=null,c=0;c<6;c++){if(!n.getEngine().getCaps().textureFloat){var u=new ArrayBuffer(t._size*t._size*3);l=new Uint8Array(u)}var h=a[__uv.$wrap((i._facesMapping[__uv.$wrap((c))]))];if(t.gammaSpace||l)for(var d=0;d<t._size*t._size;d++)if(t.gammaSpace&&(h[__uv.$wrap((3*d+0))]=Math.pow(h[__uv.$wrap((3*d+0))],e.ToGammaSpace),h[__uv.$wrap((3*d+1))]=Math.pow(h[__uv.$wrap((3*d+1))],e.ToGammaSpace),h[__uv.$wrap((3*d+2))]=Math.pow(h[__uv.$wrap((3*d+2))],e.ToGammaSpace)),l){var p=Math.max(255*h[__uv.$wrap((3*d+0))],0),m=Math.max(255*h[__uv.$wrap((3*d+1))],0),_=Math.max(255*h[__uv.$wrap((3*d+2))],0),f=Math.max(Math.max(p,m),_);if(f>255){var g=255/f;p*=g,m*=g,_*=g}l[__uv.$wrap((3*d+0))]=p,l[__uv.$wrap((3*d+1))]=m,l[__uv.$wrap((3*d+2))]=_}l?s.push(l):s.push(h)}return s}),null,this._onLoad,this._onError))},i.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=new i(this.url,e,this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t.coordinatesIndex=this.coordinatesIndex,t.coordinatesMode=this.coordinatesMode,t},i.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i.prototype.setReflectionTextureMatrix=function(e){this._textureMatrix=e},i.Parse=function(t,r,n){var a=null;return t.name&&!t.isRenderTarget&&((a=new i(n+t.name,r,t.size,t.noMipmap,t.generateHarmonics,t.useInGammaSpace)).name=t.name,a.hasAlpha=t.hasAlpha,a.level=t.level,a.coordinatesMode=t.coordinatesMode,a.isBlocking=t.isBlocking),a&&(t.boundingBoxPosition&&(a.boundingBoxPosition=e.Vector3.FromArray(t.boundingBoxPosition)),t.boundingBoxSize&&(a.boundingBoxSize=e.Vector3.FromArray(t.boundingBoxSize)),t.rotationY&&(a.rotationY=t.rotationY)),a},i.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e},i._facesMapping=["right","left","up","down","front","back"],i}(e.BaseTexture);e.HDRCubeTexture=t}(s||(s={})),function(e){var t=function(){function t(){}return t.ConvertPanoramaToCubemap=function(t,i,r,n){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=i*r*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(n,this.FACE_FRONT,t,i,r),back:this.CreateCubemapTexture(n,this.FACE_BACK,t,i,r),left:this.CreateCubemapTexture(n,this.FACE_LEFT,t,i,r),right:this.CreateCubemapTexture(n,this.FACE_RIGHT,t,i,r),up:this.CreateCubemapTexture(n,this.FACE_UP,t,i,r),down:this.CreateCubemapTexture(n,this.FACE_DOWN,t,i,r),size:n,type:e.Engine.TEXTURETYPE_FLOAT,format:e.Engine.TEXTUREFORMAT_RGB,gammaSpace:!1}},t.CreateCubemapTexture=function(e,t,i,r,n){for(var a=new ArrayBuffer(e*e*4*3),o=new Float32Array(a),s=t[__uv.$wrap((1))].subtract(t[__uv.$wrap((0))]).scale(1/e),l=t[__uv.$wrap((3))].subtract(t[__uv.$wrap((2))]).scale(1/e),c=1/e,u=0,h=0;h<e;h++){for(var d=t[__uv.$wrap((0))],p=t[__uv.$wrap((2))],m=0;m<e;m++){var _=p.subtract(d).scale(u).add(d);_.normalize();var f=this.CalcProjectionSpherical(_,i,r,n);o[__uv.$wrap((h*e*3+3*m+0))]=f.r,o[__uv.$wrap((h*e*3+3*m+1))]=f.g,o[__uv.$wrap((h*e*3+3*m+2))]=f.b,d=d.add(s),p=p.add(l)}u+=c}return o},t.CalcProjectionSpherical=function(e,t,i,r){for(var n=Math.atan2(e.z,e.x),a=Math.acos(e.y);n<-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;var o=n/Math.PI,s=a/Math.PI;o=.5*o+.5;var l=Math.round(o*i);l<0?l=0:l>=i&&(l=i-1);var c=Math.round(s*r);c<0?c=0:c>=r&&(c=r-1);var u=r-c-1;return{r:t[__uv.$wrap((u*i*3+3*l+0))],g:t[__uv.$wrap((u*i*3+3*l+1))],b:t[__uv.$wrap((u*i*3+3*l+2))]}},t.FACE_FRONT=[new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,-1),new e.Vector3(-1,1,-1),new e.Vector3(1,1,-1)],t.FACE_BACK=[new e.Vector3(1,-1,1),new e.Vector3(-1,-1,1),new e.Vector3(1,1,1),new e.Vector3(-1,1,1)],t.FACE_RIGHT=[new e.Vector3(1,-1,-1),new e.Vector3(1,-1,1),new e.Vector3(1,1,-1),new e.Vector3(1,1,1)],t.FACE_LEFT=[new e.Vector3(-1,-1,1),new e.Vector3(-1,-1,-1),new e.Vector3(-1,1,1),new e.Vector3(-1,1,-1)],t.FACE_DOWN=[new e.Vector3(-1,1,-1),new e.Vector3(1,1,-1),new e.Vector3(-1,1,1),new e.Vector3(1,1,1)],t.FACE_UP=[new e.Vector3(-1,-1,1),new e.Vector3(1,-1,1),new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,-1)],t}();e.PanoramaToCubeMapTools=t}(s||(s={})),function(e){var t=function(e){function t(t,i){var r=e.call(this,t.x,t.y)||this;return r.index=i,r}return a(t,e),t}(e.Vector2),r=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,r=new Array;return e.forEach((function(e){if(0===r.length||!e.equalsWithEpsilon(r[__uv.$wrap((0))])){var n=new t(e,i.elements.length);r.push(n),i.elements.push(n)}})),r},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[__uv.$wrap((0))].x,this.elements[__uv.$wrap((0))].y),i=new e.Vector2(this.elements[__uv.$wrap((0))].x,this.elements[__uv.$wrap((0))].y);return this.elements.forEach((function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)})),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),n=function(){function t(){}return t.Rectangle=function(t,i,r,n){return[new e.Vector2(t,i),new e.Vector2(r,i),new e.Vector2(r,n),new e.Vector2(t,n)]},t.Circle=function(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=32);for(var a=new Array,o=0,s=2*Math.PI/n,l=0;l<n;l++)a.push(new e.Vector2(i+Math.cos(o)*t,r+Math.sin(o)*t)),o-=s;return a},t.Parse=function(t){var i,r=t.split(/[^-+eE\.\d]+/).map(parseFloat).filter((function(e){return!isNaN(e)})),n=[];for(i=0;i<(2147483646&r.length);i+=2)n.push(new e.Vector2(r[__uv.$wrap((i))],r[__uv.$wrap((i+1))]));return n},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=n;var o=function(){function t(t,n,a){var o;this._points=new r,this._outlinepoints=new r,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this._name=t,this._scene=a,o=n instanceof e.Path2?n.getPoints():n,this._addToepoint(o),this._points.add(o),this._outlinepoints.add(o),void 0===i&&e.Tools.Warn("Earcut was not found, the polygon will not be built.")}return t.prototype._addToepoint=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[__uv.$wrap((t))];this._epoints.push(r.x,r.y)}},t.prototype.addHole=function(e){this._points.add(e);var t=new r;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},t.prototype.build=function(t,r){var n=this;void 0===t&&(t=!1),void 0===r&&(r=0);var a=new e.Mesh(this._name,this._scene),o=new Array,s=new Array,l=new Array,c=this._points.computeBounds();this._points.elements.forEach((function(e){o.push(0,1,0),s.push(e.x,0,e.y),l.push((e.x-c.min.x)/c.width,(e.y-c.min.y)/c.height)}));for(var u=new Array,h=i(this._epoints,this._eholes,2),d=0;d<h.length;d++)u.push(h[__uv.$wrap((d))]);if(r>0){var p=s.length/3;this._points.elements.forEach((function(e){o.push(0,-1,0),s.push(e.x,-r,e.y),l.push(1-(e.x-c.min.x)/c.width,1-(e.y-c.min.y)/c.height)}));var m=u.length;for(d=0;d<m;d+=3){var _=u[__uv.$wrap((d+0))],f=u[__uv.$wrap((d+1))],g=u[__uv.$wrap((d+2))];u.push(g+p),u.push(f+p),u.push(_+p)}this.addSide(s,o,l,u,c,this._outlinepoints,r,!1),this._holes.forEach((function(e){n.addSide(s,o,l,u,c,e,r,!0)}))}return a.setVerticesData(e.VertexBuffer.PositionKind,s,t),a.setVerticesData(e.VertexBuffer.NormalKind,o,t),a.setVerticesData(e.VertexBuffer.UVKind,l,t),a.setIndices(u),a},t.prototype.addSide=function(t,i,r,n,a,o,s,l){for(var c=t.length/3,u=0,h=0;h<o.elements.length;h++){var d,p=o.elements[__uv.$wrap((h))];d=h+1>o.elements.length-1?o.elements[__uv.$wrap((0))]:o.elements[__uv.$wrap((h+1))],t.push(p.x,0,p.y),t.push(p.x,-s,p.y),t.push(d.x,0,d.y),t.push(d.x,-s,d.y);var m=new e.Vector3(p.x,0,p.y),_=new e.Vector3(d.x,0,d.y).subtract(m),f=new e.Vector3(0,1,0),g=e.Vector3.Cross(_,f);g=g.normalize(),r.push(u/a.width,0),r.push(u/a.width,1),u+=_.length(),r.push(u/a.width,0),r.push(u/a.width,1),l?(i.push(g.x,g.y,g.z),i.push(g.x,g.y,g.z),i.push(g.x,g.y,g.z),i.push(g.x,g.y,g.z),n.push(c),n.push(c+2),n.push(c+1),n.push(c+1),n.push(c+2),n.push(c+3)):(i.push(-g.x,-g.y,-g.z),i.push(-g.x,-g.y,-g.z),i.push(-g.x,-g.y,-g.z),i.push(-g.x,-g.y,-g.z),n.push(c),n.push(c+1),n.push(c+2),n.push(c+1),n.push(c+3),n.push(c+2)),c+=4}},t}();e.PolygonMeshBuilder=o}(s||(s={})),function(e){var t=0,i=function(){function t(e,t,i){this.pos=e,this.normal=t,this.uv=i}return t.prototype.clone=function(){return new t(this.pos.clone(),this.normal.clone(),this.uv.clone())},t.prototype.flip=function(){this.normal=this.normal.scale(-1)},t.prototype.interpolate=function(i,r){return new t(e.Vector3.Lerp(this.pos,i.pos,r),e.Vector3.Lerp(this.normal,i.normal,r),e.Vector2.Lerp(this.uv,i.uv,r))},t}(),r=function(){function t(e,t){this.normal=e,this.w=t}return t.FromPoints=function(i,r,n){var a=n.subtract(i),o=r.subtract(i);if(0===a.lengthSquared()||0===o.lengthSquared())return null;var s=e.Vector3.Normalize(e.Vector3.Cross(a,o));return new t(s,e.Vector3.Dot(s,i))},t.prototype.clone=function(){return new t(this.normal.clone(),this.w)},t.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},t.prototype.splitPolygon=function(i,r,a,o,s){var l,c,u=0,h=[];for(l=0;l<i.vertices.length;l++){var d=(c=e.Vector3.Dot(this.normal,i.vertices[__uv.$wrap((l))].pos)-this.w)<-t.EPSILON?2:c>t.EPSILON?1:0;u|=d,h.push(d)}switch(u){case 0:(e.Vector3.Dot(this.normal,i.plane.normal)>0?r:a).push(i);break;case 1:o.push(i);break;case 2:s.push(i);break;case 3:var p,m=[],_=[];for(l=0;l<i.vertices.length;l++){var f=(l+1)%i.vertices.length,g=h[__uv.$wrap((l))],y=h[__uv.$wrap((f))],v=i.vertices[__uv.$wrap((l))],b=i.vertices[__uv.$wrap((f))];if(2!==g&&m.push(v),1!==g&&_.push(2!==g?v.clone():v),3==(g|y)){c=(this.w-e.Vector3.Dot(this.normal,v.pos))/e.Vector3.Dot(this.normal,b.pos.subtract(v.pos));var x=v.interpolate(b,c);m.push(x),_.push(x.clone())}}m.length>=3&&(p=new n(m,i.shared)).plane&&o.push(p),_.length>=3&&(p=new n(_,i.shared)).plane&&s.push(p)}},t.EPSILON=1e-5,t}(),n=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=r.FromPoints(e[__uv.$wrap((0))].pos,e[__uv.$wrap((1))].pos,e[__uv.$wrap((2))].pos)}return e.prototype.clone=function(){return new e(this.vertices.map((function(e){return e.clone()})),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map((function(e){e.flip()})),this.plane.flip()},e}(),a=function(){function e(e){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map((function(e){return e.clone()})),t},e.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[__uv.$wrap((e))].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},e.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=new Array,i=new Array,r=0;r<e.length;r++)this.plane.splitPolygon(e[__uv.$wrap((r))],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)},e.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[__uv.$wrap((0))].plane.clone());for(var i=new Array,r=new Array,n=0;n<t.length;n++)this.plane.splitPolygon(t[__uv.$wrap((n))],this.polygons,this.polygons,i,r);i.length&&(this.front||(this.front=new e),this.front.build(i)),r.length&&(this.back||(this.back=new e),this.back.build(r))}},e}(),o=function(){function r(){this.polygons=new Array}return r.FromMesh=function(a){var o,s,l,c,u,h,d,p,m,_,f=new Array,g=null;if(!(a instanceof e.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";a.computeWorldMatrix(!0),d=a.getWorldMatrix(),p=a.position.clone(),m=a.rotation.clone(),a.rotationQuaternion&&(g=a.rotationQuaternion.clone()),_=a.scaling.clone();for(var y=a.getIndices(),v=a.getVerticesData(e.VertexBuffer.PositionKind),b=a.getVerticesData(e.VertexBuffer.NormalKind),x=a.getVerticesData(e.VertexBuffer.UVKind),S=a.subMeshes,T=0,E=S.length;T<E;T++)for(var P=S[__uv.$wrap((T))].indexStart,A=S[__uv.$wrap((T))].indexCount+S[__uv.$wrap((T))].indexStart;P<A;P+=3){h=[];for(var M=0;M<3;M++){var C=new e.Vector3(b[__uv.$wrap((3*y[__uv.$wrap((P+M))]))],b[__uv.$wrap((3*y[__uv.$wrap((P+M))]+1))],b[__uv.$wrap((3*y[__uv.$wrap((P+M))]+2))]);l=new e.Vector2(x[__uv.$wrap((2*y[__uv.$wrap((P+M))]))],x[__uv.$wrap((2*y[__uv.$wrap((P+M))]+1))]);var R=new e.Vector3(v[__uv.$wrap((3*y[__uv.$wrap((P+M))]))],v[__uv.$wrap((3*y[__uv.$wrap((P+M))]+1))],v[__uv.$wrap((3*y[__uv.$wrap((P+M))]+2))]);c=e.Vector3.TransformCoordinates(R,d),s=e.Vector3.TransformNormal(C,d),o=new i(c,s,l),h.push(o)}(u=new n(h,{subMeshId:T,meshId:t,materialIndex:S[__uv.$wrap((T))].materialIndex})).plane&&f.push(u)}var w=r.FromPolygons(f);return w.matrix=d,w.position=p,w.rotation=m,w.scaling=_,w.rotationQuaternion=g,t++,w},r.FromPolygons=function(e){var t=new r;return t.polygons=e,t},r.prototype.clone=function(){var e=new r;return e.polygons=this.polygons.map((function(e){return e.clone()})),e.copyTransformAttributes(this),e},r.prototype.union=function(e){var t=new a(this.clone().polygons),i=new a(e.clone().polygons);return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),r.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},r.prototype.unionInPlace=function(e){var t=new a(this.polygons),i=new a(e.polygons);t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),this.polygons=t.allPolygons()},r.prototype.subtract=function(e){var t=new a(this.clone().polygons),i=new a(e.clone().polygons);return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),r.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},r.prototype.subtractInPlace=function(e){var t=new a(this.polygons),i=new a(e.polygons);t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},r.prototype.intersect=function(e){var t=new a(this.clone().polygons),i=new a(e.clone().polygons);return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),r.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},r.prototype.intersectInPlace=function(e){var t=new a(this.polygons),i=new a(e.polygons);t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},r.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},r.prototype.inverseInPlace=function(){this.polygons.map((function(e){e.flip()}))},r.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},r.prototype.buildMeshGeometry=function(t,i,r){var n=this.matrix.clone();n.invert();var a,o,s,l=new e.Mesh(t,i),c=[],u=[],h=[],d=[],p=e.Vector3.Zero(),m=e.Vector3.Zero(),_=e.Vector2.Zero(),f=this.polygons,g=[0,0,0],y={},v=0,b={};r&&f.sort((function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId}));for(var x=0,S=f.length;x<S;x++){b[__uv.$wrap(((a=f[__uv.$wrap((x))]).shared.meshId))]||(b[__uv.$wrap((a.shared.meshId))]={}),b[__uv.$wrap((a.shared.meshId))][__uv.$wrap((a.shared.subMeshId))]||(b[__uv.$wrap((a.shared.meshId))][__uv.$wrap((a.shared.subMeshId))]={indexStart:1/0,indexEnd:-1/0,materialIndex:a.shared.materialIndex}),s=b[__uv.$wrap((a.shared.meshId))][__uv.$wrap((a.shared.subMeshId))];for(var T=2,E=a.vertices.length;T<E;T++){g[__uv.$wrap((0))]=0,g[__uv.$wrap((1))]=T-1,g[__uv.$wrap((2))]=T;for(var P=0;P<3;P++){p.copyFrom(a.vertices[__uv.$wrap((g[__uv.$wrap((P))]))].pos),m.copyFrom(a.vertices[__uv.$wrap((g[__uv.$wrap((P))]))].normal),_.copyFrom(a.vertices[__uv.$wrap((g[__uv.$wrap((P))]))].uv);var A=e.Vector3.TransformCoordinates(p,n),M=e.Vector3.TransformNormal(m,n);void 0!==(o=y[__uv.$wrap((A.x+","+A.y+","+A.z))])&&h[__uv.$wrap((3*o))]===M.x&&h[__uv.$wrap((3*o+1))]===M.y&&h[__uv.$wrap((3*o+2))]===M.z&&d[__uv.$wrap((2*o))]===_.x&&d[__uv.$wrap((2*o+1))]===_.y||(c.push(A.x,A.y,A.z),d.push(_.x,_.y),h.push(m.x,m.y,m.z),o=y[__uv.$wrap((A.x+","+A.y+","+A.z))]=c.length/3-1),u.push(o),s.indexStart=Math.min(v,s.indexStart),s.indexEnd=Math.max(v,s.indexEnd),v++}}}if(l.setVerticesData(e.VertexBuffer.PositionKind,c),l.setVerticesData(e.VertexBuffer.NormalKind,h),l.setVerticesData(e.VertexBuffer.UVKind,d),l.setIndices(u,null),r){var C,R=0;for(var w in l.subMeshes=new Array,b){for(var I in C=-1,b[__uv.$wrap((w))])s=b[__uv.$wrap((w))][__uv.$wrap((I))],e.SubMesh.CreateFromIndices(s.materialIndex+R,s.indexStart,s.indexEnd-s.indexStart+1,l),C=Math.max(s.materialIndex,C);R+=++C}}return l},r.prototype.toMesh=function(e,t,i,r){var n=this.buildMeshGeometry(e,i,r);return n.material=t,n.position.copyFrom(this.position),n.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(n.rotationQuaternion=this.rotationQuaternion.clone()),n.scaling.copyFrom(this.scaling),n.computeWorldMatrix(!0),n},r}();e.CSG=o}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a){this.size=t,this.position=i,this.alphaMode=e.Engine.ALPHA_ONEONE,this.color=r||new e.Color3(1,1,1),this.texture=n?new e.Texture(n,a.getScene(),!0):null,this._system=a,a.lensFlares.push(this)}return t.AddFlare=function(e,i,r,n,a){return new t(e,i,r,n,a)},t.prototype.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},t}();e.LensFlare=t}(s||(s={})),function(e){e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_LENSFLARESYSTEM,(function(t,i,r,n){if(void 0!==t.lensFlareSystems&&null!==t.lensFlareSystems){r.lensFlareSystems||(r.lensFlareSystems=new Array);for(var a=0,o=t.lensFlareSystems.length;a<o;a++){var s=t.lensFlareSystems[__uv.$wrap((a))],l=e.LensFlareSystem.Parse(s,i,n);r.lensFlareSystems.push(l)}}})),e.AbstractScene.prototype.getLensFlareSystemByName=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[__uv.$wrap((t))].name===e)return this.lensFlareSystems[__uv.$wrap((t))];return null},e.AbstractScene.prototype.getLensFlareSystemByID=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[__uv.$wrap((t))].id===e)return this.lensFlareSystems[__uv.$wrap((t))];return null},e.AbstractScene.prototype.removeLensFlareSystem=function(e){var t=this.lensFlareSystems.indexOf(e);return-1!==t&&this.lensFlareSystems.splice(t,1),t},e.AbstractScene.prototype.addLensFlareSystem=function(e){this.lensFlareSystems.push(e)};var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_LENSFLARESYSTEM,this.scene=t,t.lensFlareSystems=new Array}return t.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},t.prototype.rebuild=function(){},t.prototype.addFromContainer=function(e){var t=this;e.lensFlareSystems&&e.lensFlareSystems.forEach((function(e){t.scene.addLensFlareSystem(e)}))},t.prototype.removeFromContainer=function(e){var t=this;e.lensFlareSystems&&e.lensFlareSystems.forEach((function(e){t.scene.removeLensFlareSystem(e)}))},t.prototype.serialize=function(e){e.lensFlareSystems=[];for(var t=0,i=this.scene.lensFlareSystems;t<i.length;t++){var r=i[__uv.$wrap((t))];e.lensFlareSystems.push(r.serialize())}},t.prototype.dispose=function(){for(var e=this.scene.lensFlareSystems;e.length;)e[__uv.$wrap((0))].dispose()},t.prototype._draw=function(t){if(this.scene.lensFlaresEnabled){var i=this.scene.lensFlareSystems;e.Tools.StartPerformanceCounter("Lens flares",i.length>0);for(var r=0,n=i;r<n.length;r++){var a=n[__uv.$wrap((r))];0!=(t.layerMask&a.layerMask)&&a.render()}e.Tools.EndPerformanceCounter("Lens flares",i.length>0)}},t}();e.LensFlareSystemSceneComponent=t}(s||(s={})),function(e){var t=function(){function t(t,i,r){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=r||e.Engine.LastCreatedScene;var n=this._scene._getComponent(e.SceneComponentConstants.NAME_LENSFLARESYSTEM);n||(n=new e.LensFlareSystemSceneComponent(this._scene),r._addComponent(n)),this._emitter=i,this.id=t,r.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return r.activeCamera&&e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&r.activeCamera.layerMask)};var a=r.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=new e.VertexBuffer(a,o,e.VertexBuffer.PositionKind,!1,!1,2);var s=[];s.push(0),s.push(1),s.push(2),s.push(0),s.push(2),s.push(3),this._indexBuffer=a.createIndexBuffer(s),this._effect=a.createEffect("lensFlare",[e.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEmitter=function(){return this._emitter},t.prototype.setEmitter=function(e){this._emitter=e},t.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},t.prototype.computeEffectivePosition=function(t){var i=this.getEmitterPosition();return i=e.Vector3.Project(i,e.Matrix.Identity(),this._scene.getTransformMatrix(),t),this._positionX=i.x,this._positionY=i.y,i=e.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(t.x-=this.viewportBorder,t.y-=this.viewportBorder,t.width+=2*this.viewportBorder,t.height+=2*this.viewportBorder,i.x+=this.viewportBorder,i.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),i.z>0&&(this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&(this._positionY,t.y,t.height),!0)},t.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var t=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),i=t.length();t.normalize();var r=new e.Ray(this._scene.activeCamera.globalPosition,t),n=this._scene.pickWithRay(r,this.meshesSelectionPredicate,!0);return!n||!n.hit||n.distance>i},t.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var t,i,r=this._scene.getEngine(),n=this._scene.activeCamera.viewport.toGlobal(r.getRenderWidth(!0),r.getRenderHeight(!0));if(!this.computeEffectivePosition(n))return!1;if(!this._isVisible())return!1;var a=(t=this._positionX<this.borderLimit+n.x?this.borderLimit+n.x-this._positionX:this._positionX>n.x+n.width-this.borderLimit?this._positionX-n.x-n.width+this.borderLimit:0)>(i=this._positionY<this.borderLimit+n.y?this.borderLimit+n.y-this._positionY:this._positionY>n.y+n.height-this.borderLimit?this._positionY-n.y-n.height+this.borderLimit:0)?t:i;(a-=this.viewportBorder)>this.borderLimit&&(a=this.borderLimit);var o=1-e.Scalar.Clamp(a/this.borderLimit,0,1);if(o<0)return!1;o>1&&(o=1),this.viewportBorder>0&&(n.x+=this.viewportBorder,n.y+=this.viewportBorder,n.width-=2*this.viewportBorder,n.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var s=n.x+n.width/2,l=n.y+n.height/2,c=s-this._positionX,u=l-this._positionY;r.enableEffect(this._effect),r.setState(!1),r.setDepthBuffer(!1),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var h=0;h<this.lensFlares.length;h++){var d=this.lensFlares[__uv.$wrap((h))];r.setAlphaMode(d.alphaMode);var p=s-c*d.position,m=l-u*d.position,_=d.size,f=d.size*r.getAspectRatio(this._scene.activeCamera,!0),g=p/(n.width+2*n.x)*2-1,y=1-m/(n.height+2*n.y)*2,v=e.Matrix.FromValues(_/2,0,0,0,0,f/2,0,0,0,0,1,0,g,y,0,1);this._effect.setMatrix("viewportMatrix",v),this._effect.setTexture("textureSampler",d.texture),this._effect.setFloat4("color",d.color.r*o,d.color.g*o,d.color.b*o,1),r.drawElementsType(e.Material.TriangleFillMode,0,6)}return r.setDepthBuffer(!0),r.setAlphaMode(e.Engine.ALPHA_DISABLE),!0},t.prototype.dispose=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];for(t&&(t.dispose(),this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[__uv.$wrap((0))].dispose();var i=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(i,1)},t.Parse=function(i,r,n){var a=r.getLastEntryByID(i.emitterId),o=i.name||"lensFlareSystem#"+i.emitterId,s=new t(o,a,r);s.id=i.id||o,s.borderLimit=i.borderLimit;for(var l=0;l<i.flares.length;l++){var c=i.flares[__uv.$wrap((l))];e.LensFlare.AddFlare(c.size,c.position,e.Color3.FromArray(c.color),c.textureName?n+c.textureName:"",s)}return s},t.prototype.serialize=function(){var t={};t.id=this.id,t.name=this.name,t.emitterId=this.getEmitter().id,t.borderLimit=this.borderLimit,t.flares=[];for(var i=0;i<this.lensFlares.length;i++){var r=this.lensFlares[__uv.$wrap((i))];t.flares.push({size:r.size,position:r.position,color:r.color.asArray(),textureName:e.Tools.GetFilename(r.texture?r.texture.name:"")})}return t},t}();e.LensFlareSystem=t}(s||(s={})),function(e){var t=function(){function e(e,t){this.type=e,this.jointData=t,t.nativeParams=t.nativeParams||{}}return Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(e){this._physicsJoint,this._physicsJoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(e){this._physicsPlugin=e},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(e){e(this._physicsPlugin.world,this._physicsJoint)},e.DistanceJoint=0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e}();e.PhysicsJoint=t;var i=function(e){function i(i){return e.call(this,t.DistanceJoint,i)||this}return a(i,e),i.prototype.updateDistance=function(e,t){this._physicsPlugin.updateDistanceJoint(this,e,t)},i}(t);e.DistanceJoint=i;var r=function(e){function t(t,i){return e.call(this,t,i)||this}return a(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(t);e.MotorEnabledJoint=r;var n=function(e){function i(i){return e.call(this,t.HingeJoint,i)||this}return a(i,e),i.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},i.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},i}(r);e.HingeJoint=n;var o=function(e){function i(i){return e.call(this,t.Hinge2Joint,i)||this}return a(i,e),i.prototype.setMotor=function(e,t,i){void 0===i&&(i=0),this._physicsPlugin.setMotor(this,e||0,t,i)},i.prototype.setLimit=function(e,t,i){void 0===i&&(i=0),this._physicsPlugin.setLimit(this,e,t,i)},i}(r);e.Hinge2Joint=o}(s||(s={})),function(e){var t=function(){function t(t,i,r,n){void 0===r&&(r={mass:0});var a=this;this.object=t,this.type=i,this._options=r,this._scene=n,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=e.Vector3.Zero(),this._isDisposed=!1,this._tmpQuat=new e.Quaternion,this._tmpQuat2=new e.Quaternion,this.beforeStep=function(){a._physicsEngine&&(a.object.translate(a._deltaPosition,-1),a._deltaRotationConjugated&&a.object.rotationQuaternion&&a.object.rotationQuaternion.multiplyToRef(a._deltaRotationConjugated,a.object.rotationQuaternion),a.object.computeWorldMatrix(!1),a.object.__uv$setSource(__uv).__uv$parent&&a.object.rotationQuaternion?(a.getParentsRotation(),a._tmpQuat.multiplyToRef(a.object.rotationQuaternion,a._tmpQuat)):a._tmpQuat.copyFrom(a.object.rotationQuaternion||new e.Quaternion),a._options.disableBidirectionalTransformation||a.object.rotationQuaternion&&a._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(a,a.object.getAbsolutePivotPoint(),a._tmpQuat),a._onBeforePhysicsStepCallbacks.forEach((function(e){e(a)})))},this.afterStep=function(){a._physicsEngine&&(a._onAfterPhysicsStepCallbacks.forEach((function(e){e(a)})),a._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(a),a.object.__uv$setSource(__uv).__uv$parent&&a.object.rotationQuaternion&&(a.getParentsRotation(),a._tmpQuat.conjugateInPlace(),a._tmpQuat.multiplyToRef(a.object.rotationQuaternion,a.object.rotationQuaternion)),a.object.setAbsolutePosition(a.object.position),a._deltaRotation&&a.object.rotationQuaternion&&a.object.rotationQuaternion.multiplyToRef(a._deltaRotation,a.object.rotationQuaternion),a.object.translate(a._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(e){if((a._onPhysicsCollideCallbacks.length||a.onCollideEvent)&&a._physicsEngine){var t=a._physicsEngine.getImpostorWithPhysicsBody(e.body);t&&(a.onCollideEvent&&a.onCollideEvent(a,t),a._onPhysicsCollideCallbacks.filter((function(e){return-1!==e.otherImpostors.indexOf(t)})).forEach((function(e){e.callback(a,t)})))}},this.object?(!this._scene&&t.getScene&&(this._scene=t.getScene()),this._scene&&(this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new e.Quaternion),this._options.mass=void 0===r.mass?0:r.mass,this._options.friction=void 0===r.friction?.2:r.friction,this._options.restitution=void 0===r.restitution?.2:r.restitution,this._joints=[],!this.object.__uv$setSource(__uv).__uv$parent||this._options.ignoreParent?this._init():this.object.__uv$setSource(__uv).__uv$parent.physicsImpostor&&e.Tools.Warn("You must affect impostors to children before affecting impostor to parent.")):e.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):e.Tools.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(e){this.setMass(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,e)},enumerable:!0,configurable:!0}),t.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.__uv$setSource(__uv).__uv$parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},t.prototype._getPhysicsParent=function(){return this.object.__uv$setSource(__uv).__uv$parent instanceof e.AbstractMesh?this.object.__uv$setSource(__uv).__uv$parent.physicsImpostor:null},t.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},t.prototype.setScalingUpdated=function(e){this.forceUpdate()},t.prototype.forceUpdate=function(){this._init(),this.__uv$setSource(__uv).__uv$parent&&!this._options.ignoreParent&&this.__uv$setSource(__uv).__uv$parent.forceUpdate()},Object.defineProperty(t.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(e){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=e,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(e){this._parent=e},enumerable:!0,configurable:!0}),t.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},t.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var e=this.object.rotationQuaternion;this.object.rotationQuaternion=t.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var i=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=e,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),i}return t.DEFAULT_OBJECT_SIZE},t.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},t.prototype.getParam=function(e){return this._options[__uv.$wrap((e))]},t.prototype.setParam=function(e,t){this._options[__uv.$wrap((e))]=t,this._bodyUpdateRequired=!0},t.prototype.setMass=function(e){this.getParam("mass")!==e&&this.setParam("mass",e),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,e)},t.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):e.Vector3.Zero()},t.prototype.setLinearVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,e)},t.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):e.Vector3.Zero()},t.prototype.setAngularVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,e)},t.prototype.executeNativeFunction=function(e){this._physicsEngine&&e(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},t.prototype.registerBeforePhysicsStep=function(e){this._onBeforePhysicsStepCallbacks.push(e)},t.prototype.unregisterBeforePhysicsStep=function(t){var i=this._onBeforePhysicsStepCallbacks.indexOf(t);i>-1?this._onBeforePhysicsStepCallbacks.splice(i,1):e.Tools.Warn("Function to remove was not found")},t.prototype.registerAfterPhysicsStep=function(e){this._onAfterPhysicsStepCallbacks.push(e)},t.prototype.unregisterAfterPhysicsStep=function(t){var i=this._onAfterPhysicsStepCallbacks.indexOf(t);i>-1?this._onAfterPhysicsStepCallbacks.splice(i,1):e.Tools.Warn("Function to remove was not found")},t.prototype.registerOnPhysicsCollide=function(e,t){var i=e instanceof Array?e:[e];this._onPhysicsCollideCallbacks.push({callback:t,otherImpostors:i})},t.prototype.unregisterOnPhysicsCollide=function(t,i){var r=t instanceof Array?t:[t],n=-1;this._onPhysicsCollideCallbacks.some((function(e,t){if(e.callback===i&&e.otherImpostors.length===r.length){var a=e.otherImpostors.every((function(e){return r.indexOf(e)>-1}));return a&&(n=t),a}return!1}))?this._onPhysicsCollideCallbacks.splice(n,1):e.Tools.Warn("Function to remove was not found")},t.prototype.getParentsRotation=function(){var t=this.object.__uv$setSource(__uv).__uv$parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);t;)t.rotationQuaternion?this._tmpQuat2.copyFrom(t.rotationQuaternion):e.Quaternion.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,t.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),t=t.__uv$setSource(__uv).__uv$parent;return this._tmpQuat},t.prototype.applyForce=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,e,t),this},t.prototype.applyImpulse=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,e,t),this},t.prototype.createJoint=function(t,i,r){var n=new e.PhysicsJoint(i,r);return this.addJoint(t,n),this},t.prototype.addJoint=function(e,t){return this._joints.push({otherImpostor:e,joint:t}),this._physicsEngine&&this._physicsEngine.addJoint(this,e,t),this},t.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},t.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},t.prototype.clone=function(e){return e?new t(e,this.type,this._options,this._scene):null},t.prototype.dispose=function(){var e=this;this._physicsEngine&&(this._joints.forEach((function(t){e._physicsEngine&&e._physicsEngine.removeJoint(e,t.otherImpostor,t.joint)})),this._physicsEngine.removeImpostor(this),this.__uv$setSource(__uv).__uv$parent&&this.__uv$setSource(__uv).__uv$parent.forceUpdate(),this._isDisposed=!0)},t.prototype.setDeltaPosition=function(e){this._deltaPosition.copyFrom(e)},t.prototype.setDeltaRotation=function(t){this._deltaRotation||(this._deltaRotation=new e.Quaternion),this._deltaRotation.copyFrom(t),this._deltaRotationConjugated=this._deltaRotation.conjugate()},t.prototype.getBoxSizeToRef=function(e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,e),this},t.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},t.prototype.syncBoneWithImpostor=function(i,r,n,a,o){var s=t._tmpVecs[__uv.$wrap((0))],l=this.object;if(l.rotationQuaternion)if(o){var c=t._tmpQuat;l.rotationQuaternion.multiplyToRef(o,c),i.setRotationQuaternion(c,e.Space.WORLD,r)}else i.setRotationQuaternion(l.rotationQuaternion,e.Space.WORLD,r);s.x=0,s.y=0,s.z=0,n&&(s.x=n.x,s.y=n.y,s.z=n.z,i.getDirectionToRef(s,r,s),null==a&&(a=n.length()),s.x*=a,s.y*=a,s.z*=a),i.getParent()?(s.addInPlace(l.getAbsolutePosition()),i.setAbsolutePosition(s,r)):(r.setAbsolutePosition(l.getAbsolutePosition()),r.position.x-=s.x,r.position.y-=s.y,r.position.z-=s.z)},t.prototype.syncImpostorWithBone=function(i,r,n,a,o,s){var l=this.object;if(l.rotationQuaternion)if(o){var c=t._tmpQuat;i.getRotationQuaternionToRef(e.Space.WORLD,r,c),c.multiplyToRef(o,l.rotationQuaternion)}else i.getRotationQuaternionToRef(e.Space.WORLD,r,l.rotationQuaternion);var u=t._tmpVecs[__uv.$wrap((0))],h=t._tmpVecs[__uv.$wrap((1))];s||((s=t._tmpVecs[__uv.$wrap((2))]).x=0,s.y=1,s.z=0),i.getDirectionToRef(s,r,h),i.getAbsolutePositionToRef(r,u),null==a&&n&&(a=n.length()),null!=a&&(u.x+=h.x*a,u.y+=h.y*a,u.z+=h.z*a),l.setAbsolutePosition(u)},t.DEFAULT_OBJECT_SIZE=new e.Vector3(1,1,1),t.IDENTITY_QUATERNION=e.Quaternion.Identity(),t._tmpVecs=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],t._tmpQuat=e.Quaternion.Identity(),t.NoImpostor=0,t.SphereImpostor=1,t.BoxImpostor=2,t.PlaneImpostor=3,t.MeshImpostor=4,t.CylinderImpostor=7,t.ParticleImpostor=8,t.HeightmapImpostor=9,t}();e.PhysicsImpostor=t}(s||(s={})),function(e){var t=function(){function t(t,i){if(void 0===i&&(i=new e.CannonJSPlugin),this._physicsPlugin=i,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new e.Vector3(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return t.prototype.setGravity=function(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)},t.prototype.setTimeStep=function(e){void 0===e&&(e=1/60),this._physicsPlugin.setTimeStep(e)},t.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},t.prototype.dispose=function(){this._impostors.forEach((function(e){e.dispose()})),this._physicsPlugin.dispose()},t.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},t.prototype.addImpostor=function(e){e.uniqueId=this._impostors.push(e),e.__uv$setSource(__uv).__uv$parent||this._physicsPlugin.generatePhysicsBody(e)},t.prototype.removeImpostor=function(e){var t=this._impostors.indexOf(e);if(t>-1){var i=this._impostors.splice(t,1);i.length&&(i[__uv.$wrap((0))].physicsBody=null)}},t.prototype.addJoint=function(e,t,i){var r={mainImpostor:e,connectedImpostor:t,joint:i};i.physicsPlugin=this._physicsPlugin,this._joints.push(r),this._physicsPlugin.generateJoint(r)},t.prototype.removeJoint=function(e,t,i){var r=this._joints.filter((function(r){return r.connectedImpostor===t&&r.joint===i&&r.mainImpostor===e}));r.length&&this._physicsPlugin.removeJoint(r[__uv.$wrap((0))])},t.prototype._step=function(e){var t=this;this._impostors.forEach((function(e){e.isBodyInitRequired()&&t._physicsPlugin.generatePhysicsBody(e)})),e>.1?e=.1:e<=0&&(e=1/60),this._physicsPlugin.executeStep(e,this._impostors)},t.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},t.prototype.getImpostors=function(){return this._impostors},t.prototype.getImpostorForPhysicsObject=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[__uv.$wrap((t))].object===e)return this._impostors[__uv.$wrap((t))];return null},t.prototype.getImpostorWithPhysicsBody=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[__uv.$wrap((t))].physicsBody===e)return this._impostors[__uv.$wrap((t))];return null},t.Epsilon=.001,t}();e.PhysicsEngine=t}(s||(s={})),function(e){var t=function(){function t(t){this._scene=t,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||e.Tools.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return t.prototype.applyRadialExplosionImpulse=function(t,r,n,o){if(void 0===o&&(o=a.Constant),!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var s=this._physicsEngine.getImpostors();if(0===s.length)return null;var l=new i(this._scene);return s.forEach((function(e){var i=l.getImpostorForceAndContactPoint(e,t,r,n,o);i&&e.applyImpulse(i.force,i.contactPoint)})),l.dispose(!1),l},t.prototype.applyRadialExplosionForce=function(t,r,n,o){if(void 0===o&&(o=a.Constant),!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var s=this._physicsEngine.getImpostors();if(0===s.length)return null;var l=new i(this._scene);return s.forEach((function(e){var i=l.getImpostorForceAndContactPoint(e,t,r,n,o);i&&e.applyForce(i.force,i.contactPoint)})),l.dispose(!1),l},t.prototype.gravitationalField=function(t,i,n,o){if(void 0===o&&(o=a.Constant),!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;var s=new r(this,this._scene,t,i,n,o);return s.dispose(!1),s},t.prototype.updraft=function(t,i,r,a,s){if(void 0===s&&(s=o.Center),!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;var l=new n(this._scene,t,i,r,a,s);return l.dispose(!1),l},t.prototype.vortex=function(t,i,r,n){if(!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;var a=new s(this._scene,t,i,r,n);return a.dispose(!1),a},t}();e.PhysicsHelper=t;var i=function(){function t(e){this._sphereOptions={segments:32,diameter:1},this._rays=[],this._dataFetched=!1,this._scene=e}return t.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere,rays:this._rays}},t.prototype.getImpostorForceAndContactPoint=function(t,i,r,n,o){if(0===t.mass)return null;if(!this._intersectsWithSphere(t,i,r))return null;if("Mesh"!==t.object.getClassName()&&"InstancedMesh"!==t.object.getClassName())return null;var s=t.getObjectCenter().subtract(i),l=new e.Ray(i,s,r);this._rays.push(l);var c=l.intersectsMesh(t.object).pickedPoint;if(!c)return null;var u=e.Vector3.Distance(i,c);if(u>r)return null;var h=o===a.Constant?n:n*(1-u/r);return{force:s.multiplyByFloats(h,h,h),contactPoint:c}},t.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout((function(){t._dataFetched||t._sphere.dispose()}),0)},t.prototype._prepareSphere=function(){this._sphere||(this._sphere=e.MeshBuilder.CreateSphere("radialExplosionEventSphere",this._sphereOptions,this._scene),this._sphere.isVisible=!1)},t.prototype._intersectsWithSphere=function(t,i,r){var n=t.object;return this._prepareSphere(),this._sphere.position=i,this._sphere.scaling=new e.Vector3(2*r,2*r,2*r),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(n,!0)},t}();e.PhysicsRadialExplosionEvent=i;var r=function(){function e(e,t,i,r,n,o){void 0===o&&(o=a.Constant),this._dataFetched=!1,this._physicsHelper=e,this._scene=t,this._origin=i,this._radius=r,this._strength=n,this._falloff=o,this._tickCallback=this._tick.bind(this)}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout((function(){t._dataFetched||t._sphere.dispose()}),0)},e.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._radius,-1*this._strength,this._falloff);else{var e=this._physicsHelper.applyRadialExplosionForce(this._origin,this._radius,-1*this._strength,this._falloff);e&&(this._sphere=e.getData().sphere.clone("radialExplosionEventSphereClone"))}},e}();e.PhysicsGravitationalFieldEvent=r;var n=function(){function t(t,i,r,n,a,s){this._scene=t,this._origin=i,this._radius=r,this._strength=n,this._height=a,this._updraftMode=s,this._originTop=e.Vector3.Zero(),this._originDirection=e.Vector3.Zero(),this._cylinderPosition=e.Vector3.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._origin.addToRef(new e.Vector3(0,this._height/2,0),this._cylinderPosition),this._origin.addToRef(new e.Vector3(0,this._height,0),this._originTop),this._updraftMode===o.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this)}return t.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},t.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},t.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},t.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._cylinder.dispose():setTimeout((function(){t._dataFetched||t._cylinder.dispose()}),0)},t.prototype.getImpostorForceAndContactPoint=function(e){if(0===e.mass)return null;if(!this._intersectsWithCylinder(e))return null;var t=e.getObjectCenter();if(this._updraftMode===o.Perpendicular)var i=this._originDirection;else i=t.subtract(this._originTop);var r=-1*this._strength;return{force:i.multiplyByFloats(r,r,r),contactPoint:t}},t.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach((function(t){var i=e.getImpostorForceAndContactPoint(t);i&&t.applyForce(i.force,i.contactPoint)}))},t.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=e.MeshBuilder.CreateCylinder("updraftEventCylinder",{height:this._height,diameter:2*this._radius},this._scene),this._cylinder.isVisible=!1)},t.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._prepareCylinder(),this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},t}();e.PhysicsUpdraftEvent=n;var a,o,s=function(){function t(t,i,r,n,a){this._scene=t,this._origin=i,this._radius=r,this._strength=n,this._height=a,this._originTop=e.Vector3.Zero(),this._centripetalForceThreshold=.7,this._updraftMultiplier=.02,this._cylinderPosition=e.Vector3.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._origin.addToRef(new e.Vector3(0,this._height/2,0),this._cylinderPosition),this._origin.addToRef(new e.Vector3(0,this._height,0),this._originTop),this._tickCallback=this._tick.bind(this)}return t.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},t.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},t.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},t.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._cylinder.dispose():setTimeout((function(){t._dataFetched||t._cylinder.dispose()}),0)},t.prototype.getImpostorForceAndContactPoint=function(t){if(0===t.mass)return null;if(!this._intersectsWithCylinder(t))return null;if("Mesh"!==t.object.getClassName()&&"InstancedMesh"!==t.object.getClassName())return null;var i=t.getObjectCenter(),r=new e.Vector3(this._origin.x,i.y,this._origin.z),n=i.subtract(r),a=new e.Ray(r,n,this._radius).intersectsMesh(t.object),o=a.pickedPoint;if(!o)return null;var s=a.distance/this._radius,l=e.Vector3.Cross(r,i).normalize(),c=o.normalize();if(s>this._centripetalForceThreshold&&(c=c.negate()),s>this._centripetalForceThreshold)var u=c.x*this._strength/8,h=c.y*this._updraftMultiplier,d=c.z*this._strength/8;else u=(l.x+c.x)/2,h=this._originTop.y*this._updraftMultiplier,d=(l.z+c.z)/2;var p=new e.Vector3(u,h,d);return{force:p=p.multiplyByFloats(this._strength,this._strength,this._strength),contactPoint:i}},t.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach((function(t){var i=e.getImpostorForceAndContactPoint(t);i&&t.applyForce(i.force,i.contactPoint)}))},t.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=e.MeshBuilder.CreateCylinder("vortexEventCylinder",{height:this._height,diameter:2*this._radius},this._scene),this._cylinder.isVisible=!1)},t.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._prepareCylinder(),this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},t}();e.PhysicsVortexEvent=s,function(e){e[__uv.$wrap((e.Constant=0))]="Constant",e[__uv.$wrap((e.Linear=1))]="Linear"}(a=e.PhysicsRadialImpulseFalloff||(e.PhysicsRadialImpulseFalloff={})),function(e){e[__uv.$wrap((e.Center=0))]="Center",e[__uv.$wrap((e.Perpendicular=1))]="Perpendicular"}(o=e.PhysicsUpdraftMode||(e.PhysicsUpdraftMode={}))}(s||(s={})),function(t){var i=function(){function i(i,r){void 0===i&&(i=!0),void 0===r&&(r=10),this._useDeltaForWorldStep=i,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this.BJSCANNON=e,this._minus90X=new t.Quaternion(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new t.Quaternion(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=t.Vector3.Zero(),this._tmpDeltaPosition=t.Vector3.Zero(),this._tmpUnityRotation=new t.Quaternion,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=r):t.Tools.Error("CannonJS is not available. Please make sure you included the js file.")}return i.prototype.setGravity=function(e){this.world.gravity.copy(e)},i.prototype.setTimeStep=function(e){this._fixedTimeStep=e},i.prototype.getTimeStep=function(){return this._fixedTimeStep},i.prototype.executeStep=function(e,t){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?e:0,3)},i.prototype.applyImpulse=function(e,t,i){var r=new this.BJSCANNON.Vec3(i.x,i.y,i.z),n=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyImpulse(n,r)},i.prototype.applyForce=function(e,t,i){var r=new this.BJSCANNON.Vec3(i.x,i.y,i.z),n=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyForce(n,r)},i.prototype.generatePhysicsBody=function(e){if(e.__uv$setSource(__uv).__uv$parent)e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());else{if(e.isBodyInitRequired()){var t=this._createShape(e),i=e.physicsBody;i&&this.removePhysicsBody(e);var r=this._addMaterial("mat-"+e.uniqueId,e.getParam("friction"),e.getParam("restitution")),n={mass:e.getParam("mass"),material:r},a=e.getParam("nativeOptions");for(var o in a)a.hasOwnProperty(o)&&(n[__uv.$wrap((o))]=a[__uv.$wrap((o))]);e.physicsBody=new this.BJSCANNON.Body(n),e.physicsBody.addEventListener("collide",e.onCollide),this.world.addEventListener("preStep",e.beforeStep),this.world.addEventListener("postStep",e.afterStep),e.physicsBody.addShape(t),this.world.add(e.physicsBody),i&&["force","torque","velocity","angularVelocity"].forEach((function(t){e.physicsBody[__uv.$wrap((t))].copy(i[__uv.$wrap((t))])})),this._processChildMeshes(e)}this._updatePhysicsBodyTransformation(e)}},i.prototype._processChildMeshes=function(e){var i=this,r=e.object.getChildMeshes?e.object.getChildMeshes(!0):[],n=e.object.rotationQuaternion;if(r.length){var a=function(r,o){if(n&&o.rotationQuaternion){var s=o.getPhysicsImpostor();if(s)if(s.__uv$setSource(__uv).__uv$parent!==e){var l=o.getAbsolutePosition().subtract(e.object.getAbsolutePosition()),c=o.rotationQuaternion.multiply(t.Quaternion.Inverse(n));s.physicsBody&&(i.removePhysicsBody(s),s.physicsBody=null),s.__uv$setSource(__uv).__uv$parent=e,s.resetUpdateFlags(),e.physicsBody.addShape(i._createShape(s),new i.BJSCANNON.Vec3(l.x,l.y,l.z),new i.BJSCANNON.Quaternion(c.x,c.y,c.z,c.w)),e.physicsBody.mass+=s.getParam("mass")}n.multiplyInPlace(o.rotationQuaternion),o.getChildMeshes(!0).filter((function(e){return!!e.physicsImpostor})).forEach(a.bind(i,o.getAbsolutePosition()))}};r.filter((function(e){return!!e.physicsImpostor})).forEach(a.bind(this,e.object.getAbsolutePosition()))}},i.prototype.removePhysicsBody=function(e){e.physicsBody.removeEventListener("collide",e.onCollide),this.world.removeEventListener("preStep",e.beforeStep),this.world.removeEventListener("postStep",e.afterStep),this.world.remove(e.physicsBody)},i.prototype.generateJoint=function(e){var i=e.mainImpostor.physicsBody,r=e.connectedImpostor.physicsBody;if(i&&r){var n,a=e.joint.jointData,o={pivotA:a.mainPivot?(new this.BJSCANNON.Vec3).copy(a.mainPivot):null,pivotB:a.connectedPivot?(new this.BJSCANNON.Vec3).copy(a.connectedPivot):null,axisA:a.mainAxis?(new this.BJSCANNON.Vec3).copy(a.mainAxis):null,axisB:a.connectedAxis?(new this.BJSCANNON.Vec3).copy(a.connectedAxis):null,maxForce:a.nativeParams.maxForce,collideConnected:!!a.collision};switch(e.joint.type){case t.PhysicsJoint.HingeJoint:case t.PhysicsJoint.Hinge2Joint:n=new this.BJSCANNON.HingeConstraint(i,r,o);break;case t.PhysicsJoint.DistanceJoint:n=new this.BJSCANNON.DistanceConstraint(i,r,a.maxDistance||2);break;case t.PhysicsJoint.SpringJoint:var s=a;n=new this.BJSCANNON.Spring(i,r,{restLength:s.length,stiffness:s.stiffness,damping:s.damping,localAnchorA:o.pivotA,localAnchorB:o.pivotB});break;case t.PhysicsJoint.LockJoint:n=new this.BJSCANNON.LockConstraint(i,r,o);break;case t.PhysicsJoint.PointToPointJoint:case t.PhysicsJoint.BallAndSocketJoint:default:n=new this.BJSCANNON.PointToPointConstraint(i,o.pivotA,r,o.pivotA,o.maxForce)}n.collideConnected=!!a.collision,e.joint.physicsJoint=n,e.joint.type!==t.PhysicsJoint.SpringJoint?this.world.addConstraint(n):(e.joint.jointData.forceApplicationCallback=e.joint.jointData.forceApplicationCallback||function(){n.applyForce()},e.mainImpostor.registerAfterPhysicsStep(e.joint.jointData.forceApplicationCallback))}},i.prototype.removeJoint=function(e){e.joint.type!==t.PhysicsJoint.SpringJoint?this.world.removeConstraint(e.joint.physicsJoint):e.mainImpostor.unregisterAfterPhysicsStep(e.joint.jointData.forceApplicationCallback)},i.prototype._addMaterial=function(e,t,i){var r,n;for(r=0;r<this._physicsMaterials.length;r++)if((n=this._physicsMaterials[__uv.$wrap((r))]).friction===t&&n.restitution===i)return n;var a=new this.BJSCANNON.Material(e);return a.friction=t,a.restitution=i,this._physicsMaterials.push(a),a},i.prototype._checkWithEpsilon=function(e){return e<t.PhysicsEngine.Epsilon?t.PhysicsEngine.Epsilon:e},i.prototype._createShape=function(e){var i,r=e.object,n=e.getObjectExtendSize();switch(e.type){case t.PhysicsImpostor.SphereImpostor:var a=n.x,o=n.y,s=n.z;i=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(a),this._checkWithEpsilon(o),this._checkWithEpsilon(s))/2);break;case t.PhysicsImpostor.CylinderImpostor:i=new this.BJSCANNON.Cylinder(this._checkWithEpsilon(n.x)/2,this._checkWithEpsilon(n.x)/2,this._checkWithEpsilon(n.y),16);break;case t.PhysicsImpostor.BoxImpostor:var l=n.scale(.5);i=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(l.x),this._checkWithEpsilon(l.y),this._checkWithEpsilon(l.z)));break;case t.PhysicsImpostor.PlaneImpostor:t.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),i=new this.BJSCANNON.Plane;break;case t.PhysicsImpostor.MeshImpostor:var c=r.getVerticesData?r.getVerticesData(t.VertexBuffer.PositionKind):[],u=r.getIndices?r.getIndices():[];if(!c)return;var h=r.position.clone(),d=r.rotation&&r.rotation.clone(),p=r.rotationQuaternion&&r.rotationQuaternion.clone();r.position.copyFromFloats(0,0,0),r.rotation&&r.rotation.copyFromFloats(0,0,0),r.rotationQuaternion&&r.rotationQuaternion.copyFrom(e.getParentsRotation()),r.rotationQuaternion&&r.__uv$setSource(__uv).__uv$parent&&r.rotationQuaternion.conjugateInPlace();var m,_=r.computeWorldMatrix(!0),f=new Array;for(m=0;m<c.length;m+=3)t.Vector3.TransformCoordinates(t.Vector3.FromArray(c,m),_).toArray(f,m);t.Tools.Warn("MeshImpostor only collides against spheres."),i=new this.BJSCANNON.Trimesh(f,u),r.position.copyFrom(h),d&&r.rotation&&r.rotation.copyFrom(d),p&&r.rotationQuaternion&&r.rotationQuaternion.copyFrom(p);break;case t.PhysicsImpostor.HeightmapImpostor:var g=r.position.clone(),y=r.rotation&&r.rotation.clone(),v=r.rotationQuaternion&&r.rotationQuaternion.clone();r.position.copyFromFloats(0,0,0),r.rotation&&r.rotation.copyFromFloats(0,0,0),r.rotationQuaternion&&r.rotationQuaternion.copyFrom(e.getParentsRotation()),r.rotationQuaternion&&r.__uv$setSource(__uv).__uv$parent&&r.rotationQuaternion.conjugateInPlace(),r.rotationQuaternion&&r.rotationQuaternion.multiplyInPlace(this._minus90X),i=this._createHeightmap(r),r.position.copyFrom(g),y&&r.rotation&&r.rotation.copyFrom(y),v&&r.rotationQuaternion&&r.rotationQuaternion.copyFrom(v),r.computeWorldMatrix(!0);break;case t.PhysicsImpostor.ParticleImpostor:i=new this.BJSCANNON.Particle}return i},i.prototype._createHeightmap=function(e,i){var r,n=e.getVerticesData(t.VertexBuffer.PositionKind),a=e.computeWorldMatrix(!0),o=new Array;for(r=0;r<n.length;r+=3)t.Vector3.TransformCoordinates(t.Vector3.FromArray(n,r),a).toArray(o,r);n=o;for(var s=new Array,l=i||~~(Math.sqrt(n.length/3)-1),c=e.getBoundingInfo(),u=Math.min(c.boundingBox.extendSizeWorld.x,c.boundingBox.extendSizeWorld.y),h=c.boundingBox.extendSizeWorld.z,d=2*u/l,p=0;p<n.length;p+=3){var m=Math.round(n[__uv.$wrap((p+0))]/d+l/2),_=Math.round(-1*(n[__uv.$wrap((p+1))]/d-l/2)),f=-n[__uv.$wrap((p+2))]+h;s[__uv.$wrap((m))]||(s[__uv.$wrap((m))]=[]),s[__uv.$wrap((m))][__uv.$wrap((_))]||(s[__uv.$wrap((m))][__uv.$wrap((_))]=f),s[__uv.$wrap((m))][__uv.$wrap((_))]=Math.max(f,s[__uv.$wrap((m))][__uv.$wrap((_))])}for(m=0;m<=l;++m){if(!s[__uv.$wrap((m))]){for(var g=1;!s[__uv.$wrap(((m+g)%l))];)g++;s[__uv.$wrap((m))]=s[__uv.$wrap(((m+g)%l))].slice()}for(_=0;_<=l;++_)if(!s[__uv.$wrap((m))][__uv.$wrap((_))]){var y;for(g=1;void 0===y;)y=s[__uv.$wrap((m))][__uv.$wrap(((_+g++)%l))];s[__uv.$wrap((m))][__uv.$wrap((_))]=y}}var v=new this.BJSCANNON.Heightfield(s,{elementSize:d});return v.minY=h,v},i.prototype._updatePhysicsBodyTransformation=function(e){var i=e.object;if(i.computeWorldMatrix&&i.computeWorldMatrix(!0),i.getBoundingInfo()){var r=e.getObjectCenter();this._tmpDeltaPosition.copyFrom(i.getAbsolutePivotPoint().subtract(r)),this._tmpDeltaPosition.divideInPlace(e.object.scaling),this._tmpPosition.copyFrom(r);var n=i.rotationQuaternion;if(n){if(e.type!==t.PhysicsImpostor.PlaneImpostor&&e.type!==t.PhysicsImpostor.HeightmapImpostor&&e.type!==t.PhysicsImpostor.CylinderImpostor||(n=n.multiply(this._minus90X),e.setDeltaRotation(this._plus90X)),e.type===t.PhysicsImpostor.HeightmapImpostor){var a=i,o=a.getBoundingInfo(),s=a.rotationQuaternion;a.rotationQuaternion=this._tmpUnityRotation,a.computeWorldMatrix(!0);var l=r.clone(),c=a.getPivotMatrix()||t.Matrix.Translation(0,0,0),u=t.Matrix.Translation(o.boundingBox.extendSizeWorld.x,0,-o.boundingBox.extendSizeWorld.z);a.setPreTransformMatrix(u),a.computeWorldMatrix(!0);var h=o.boundingBox.centerWorld.subtract(r).subtract(a.position).negate();this._tmpPosition.copyFromFloats(h.x,h.y-o.boundingBox.extendSizeWorld.y,h.z),this._tmpDeltaPosition.copyFrom(o.boundingBox.centerWorld.subtract(l)),this._tmpDeltaPosition.y+=o.boundingBox.extendSizeWorld.y,a.rotationQuaternion=s,a.setPreTransformMatrix(c),a.computeWorldMatrix(!0)}else e.type===t.PhysicsImpostor.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);e.setDeltaPosition(this._tmpDeltaPosition),e.physicsBody.position.copy(this._tmpPosition),e.physicsBody.quaternion.copy(n)}}},i.prototype.setTransformationFromPhysicsBody=function(e){e.object.position.copyFrom(e.physicsBody.position),e.object.rotationQuaternion&&e.object.rotationQuaternion.copyFrom(e.physicsBody.quaternion)},i.prototype.setPhysicsBodyTransformation=function(e,t,i){e.physicsBody.position.copy(t),e.physicsBody.quaternion.copy(i)},i.prototype.isSupported=function(){return void 0!==this.BJSCANNON},i.prototype.setLinearVelocity=function(e,t){e.physicsBody.velocity.copy(t)},i.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.copy(t)},i.prototype.getLinearVelocity=function(e){var i=e.physicsBody.velocity;return i?new t.Vector3(i.x,i.y,i.z):null},i.prototype.getAngularVelocity=function(e){var i=e.physicsBody.angularVelocity;return i?new t.Vector3(i.x,i.y,i.z):null},i.prototype.setBodyMass=function(e,t){e.physicsBody.mass=t,e.physicsBody.updateMassProperties()},i.prototype.getBodyMass=function(e){return e.physicsBody.mass},i.prototype.getBodyFriction=function(e){return e.physicsBody.material.friction},i.prototype.setBodyFriction=function(e,t){e.physicsBody.material.friction=t},i.prototype.getBodyRestitution=function(e){return e.physicsBody.material.restitution},i.prototype.setBodyRestitution=function(e,t){e.physicsBody.material.restitution=t},i.prototype.sleepBody=function(e){e.physicsBody.sleep()},i.prototype.wakeUpBody=function(e){e.physicsBody.wakeUp()},i.prototype.updateDistanceJoint=function(e,t,i){e.physicsJoint.distance=t},i.prototype.setMotor=function(e,t,i,r){r||(e.physicsJoint.enableMotor(),e.physicsJoint.setMotorSpeed(t),i&&this.setLimit(e,i))},i.prototype.setLimit=function(e,t,i){e.physicsJoint.motorEquation.maxForce=t,e.physicsJoint.motorEquation.minForce=void 0===i?-t:i},i.prototype.syncMeshWithImpostor=function(e,t){var i=t.physicsBody;e.position.x=i.position.x,e.position.y=i.position.y,e.position.z=i.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=i.quaternion.x,e.rotationQuaternion.y=i.quaternion.y,e.rotationQuaternion.z=i.quaternion.z,e.rotationQuaternion.w=i.quaternion.w)},i.prototype.getRadius=function(e){return e.physicsBody.shapes[__uv.$wrap((0))].boundingSphereRadius},i.prototype.getBoxSizeToRef=function(e,t){var i=e.physicsBody.shapes[__uv.$wrap((0))];t.x=2*i.halfExtents.x,t.y=2*i.halfExtents.y,t.z=2*i.halfExtents.z},i.prototype.dispose=function(){},i.prototype._extendNamespace=function(){var e=new this.BJSCANNON.Vec3,t=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(i,r,n){if(n=n||10,0===(r=r||0))this.internalStep(i),this.time+=i;else{var a=Math.floor((this.time+r)/i)-Math.floor(this.time/i);a=Math.min(a,n)||1;for(var o=performance.now(),s=0;s!==a&&(this.internalStep(i),!(performance.now()-o>1e3*i));s++);this.time+=r;for(var l=this.time%i/i,c=e,u=this.bodies,h=0;h!==u.length;h++){var d=u[__uv.$wrap((h))];d.type!==t.Body.STATIC&&d.sleepState!==t.Body.SLEEPING?(d.position.vsub(d.previousPosition,c),c.scale(l,c),d.position.vadd(c,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}}}},i}();t.CannonJSPlugin=i}(s||(s={})),function(e){var i=function(){function i(i){this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=e.Vector3.Zero(),this.BJSOIMO=t,this.world=new this.BJSOIMO.World({iterations:i}),this.world.clear()}return i.prototype.setGravity=function(e){this.world.gravity.copy(e)},i.prototype.setTimeStep=function(e){this.world.timeStep=e},i.prototype.getTimeStep=function(){return this.world.timeStep},i.prototype.executeStep=function(e,t){var i=this;t.forEach((function(e){e.beforeStep()})),this.world.step(),t.forEach((function(e){e.afterStep(),i._tmpImpostorsArray[__uv.$wrap((e.uniqueId))]=e}));for(var r=this.world.contacts;null!==r;)if(!r.touching||r.body1.sleeping||r.body2.sleeping){var n=this._tmpImpostorsArray[__uv.$wrap((+r.body1.name))],a=this._tmpImpostorsArray[__uv.$wrap((+r.body2.name))];n&&a?(n.onCollide({body:a.physicsBody}),a.onCollide({body:n.physicsBody}),r=r.next):r=r.next}else r=r.next},i.prototype.applyImpulse=function(e,t,i){var r=e.physicsBody.mass;e.physicsBody.applyImpulse(i.scale(this.world.invScale),t.scale(this.world.invScale*r))},i.prototype.applyForce=function(t,i,r){e.Tools.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(t,i,r)},i.prototype.generatePhysicsBody=function(t){var i=this;if(t.__uv$setSource(__uv).__uv$parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else{if(t.isBodyInitRequired()){var r={name:t.uniqueId,config:[t.getParam("mass")||1,t.getParam("friction"),t.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==t.getParam("mass"),density:t.getParam("mass"),friction:t.getParam("friction"),restitution:t.getParam("restitution"),world:this.world},n=[t];(s=t.object).getChildMeshes&&s.getChildMeshes().forEach((function(e){e.physicsImpostor&&n.push(e.physicsImpostor)}));var a=function(t){return Math.max(t,e.PhysicsEngine.Epsilon)},o=new e.Quaternion;n.forEach((function(n){if(n.object.rotationQuaternion){var s=n.object.rotationQuaternion;o=s.clone();var l=s.toEulerAngles(),c=n.getObjectExtendSize();if(n===t){var u=t.getObjectCenter();t.object.getAbsolutePivotPoint().subtractToRef(u,i._tmpPositionVector),i._tmpPositionVector.divideInPlace(t.object.scaling),r.pos.push(u.x),r.pos.push(u.y),r.pos.push(u.z),r.posShape.push(0,0,0),r.rot.push(0),r.rot.push(0),r.rot.push(0),r.rotShape.push(0,0,0)}else{var h=n.object.getAbsolutePosition().subtract(t.object.getAbsolutePosition());r.posShape.push(h.x),r.posShape.push(h.y),r.posShape.push(h.z),r.pos.push(0,0,0),r.rot.push(0),r.rot.push(0),r.rot.push(0),r.rotShape.push(57.29577951308232*l.x),r.rotShape.push(57.29577951308232*l.y),r.rotShape.push(57.29577951308232*l.z)}switch(n.type){case e.PhysicsImpostor.ParticleImpostor:e.Tools.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case e.PhysicsImpostor.SphereImpostor:var d=c.x,p=c.y,m=c.z,_=Math.max(a(d),a(p),a(m))/2;r.type.push("sphere"),r.size.push(_),r.size.push(_),r.size.push(_);break;case e.PhysicsImpostor.CylinderImpostor:var f=a(c.x)/2,g=a(c.y);r.type.push("cylinder"),r.size.push(f),r.size.push(g),r.size.push(g);break;case e.PhysicsImpostor.PlaneImpostor:case e.PhysicsImpostor.BoxImpostor:default:f=a(c.x),g=a(c.y);var y=a(c.z);r.type.push("box"),r.size.push(f),r.size.push(g),r.size.push(y)}n.object.rotationQuaternion=s}})),t.physicsBody=this.world.add(r),t.physicsBody.resetQuaternion(o),t.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var s;t.setDeltaPosition(this._tmpPositionVector)}},i.prototype.removePhysicsBody=function(e){this.world.removeRigidBody(e.physicsBody)},i.prototype.generateJoint=function(t){var i=t.mainImpostor.physicsBody,r=t.connectedImpostor.physicsBody;if(i&&r){var n,a=t.joint.jointData,o=a.nativeParams||{},s={body1:i,body2:r,axe1:o.axe1||(a.mainAxis?a.mainAxis.asArray():null),axe2:o.axe2||(a.connectedAxis?a.connectedAxis.asArray():null),pos1:o.pos1||(a.mainPivot?a.mainPivot.asArray():null),pos2:o.pos2||(a.connectedPivot?a.connectedPivot.asArray():null),min:o.min,max:o.max,collision:o.collision||a.collision,spring:o.spring,world:this.world};switch(t.joint.type){case e.PhysicsJoint.BallAndSocketJoint:n="jointBall";break;case e.PhysicsJoint.SpringJoint:e.Tools.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var l=a;s.min=l.length||s.min,s.max=Math.max(s.min,s.max);case e.PhysicsJoint.DistanceJoint:n="jointDistance",s.max=a.maxDistance;break;case e.PhysicsJoint.PrismaticJoint:n="jointPrisme";break;case e.PhysicsJoint.SliderJoint:n="jointSlide";break;case e.PhysicsJoint.WheelJoint:n="jointWheel";break;case e.PhysicsJoint.HingeJoint:default:n="jointHinge"}s.type=n,t.joint.physicsJoint=this.world.add(s)}},i.prototype.removeJoint=function(t){try{this.world.removeJoint(t.joint.physicsJoint)}catch(t){e.Tools.Warn(t)}},i.prototype.isSupported=function(){return void 0!==this.BJSOIMO},i.prototype.setTransformationFromPhysicsBody=function(e){e.physicsBody.sleeping||(e.object.position.copyFrom(e.physicsBody.getPosition()),e.object.rotationQuaternion&&e.object.rotationQuaternion.copyFrom(e.physicsBody.getQuaternion()))},i.prototype.setPhysicsBodyTransformation=function(e,t,i){var r=e.physicsBody;r.position.copy(t),r.orientation.copy(i),r.syncShapes(),r.awake()},i.prototype.setLinearVelocity=function(e,t){e.physicsBody.linearVelocity.copy(t)},i.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.copy(t)},i.prototype.getLinearVelocity=function(t){var i=t.physicsBody.linearVelocity;return i?new e.Vector3(i.x,i.y,i.z):null},i.prototype.getAngularVelocity=function(t){var i=t.physicsBody.angularVelocity;return i?new e.Vector3(i.x,i.y,i.z):null},i.prototype.setBodyMass=function(e,t){var i=0===t;e.physicsBody.shapes.density=i?1:t,e.physicsBody.setupMass(i?2:1)},i.prototype.getBodyMass=function(e){return e.physicsBody.shapes.density},i.prototype.getBodyFriction=function(e){return e.physicsBody.shapes.friction},i.prototype.setBodyFriction=function(e,t){e.physicsBody.shapes.friction=t},i.prototype.getBodyRestitution=function(e){return e.physicsBody.shapes.restitution},i.prototype.setBodyRestitution=function(e,t){e.physicsBody.shapes.restitution=t},i.prototype.sleepBody=function(e){e.physicsBody.sleep()},i.prototype.wakeUpBody=function(e){e.physicsBody.awake()},i.prototype.updateDistanceJoint=function(e,t,i){e.physicsJoint.limitMotor.upperLimit=t,void 0!==i&&(e.physicsJoint.limitMotor.lowerLimit=i)},i.prototype.setMotor=function(e,t,i,r){var n=r?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;n&&n.setMotor(t,i)},i.prototype.setLimit=function(e,t,i,r){var n=r?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;n&&n.setLimit(t,void 0===i?-t:i)},i.prototype.syncMeshWithImpostor=function(e,t){var i=t.physicsBody;e.position.x=i.position.x,e.position.y=i.position.y,e.position.z=i.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=i.orientation.x,e.rotationQuaternion.y=i.orientation.y,e.rotationQuaternion.z=i.orientation.z,e.rotationQuaternion.w=i.orientation.s)},i.prototype.getRadius=function(e){return e.physicsBody.shapes.radius},i.prototype.getBoxSizeToRef=function(e,t){var i=e.physicsBody.shapes;t.x=2*i.halfWidth,t.y=2*i.halfHeight,t.z=2*i.halfDepth},i.prototype.dispose=function(){this.world.clear()},i}();e.OimoJSPlugin=i}(s||(s={})),function(e){e.Scene.prototype.getPhysicsEngine=function(){return this._physicsEngine},e.Scene.prototype.enablePhysics=function(i,r){if(void 0===i&&(i=null),this._physicsEngine)return!0;var n=this._getComponent(e.SceneComponentConstants.NAME_PHYSICSENGINE);n||(n=new t(this),this._addComponent(n));try{return this._physicsEngine=new e.PhysicsEngine(i,r),!0}catch(t){return e.Tools.Error(t.message),!1}},e.Scene.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},e.Scene.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},e.Scene.prototype.deleteCompoundImpostor=function(e){var t=e.parts[__uv.$wrap((0))].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},e.Scene.prototype._advancePhysicsEngineStep=function(e){this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this))},Object.defineProperty(e.AbstractMesh.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(e){var t=this;this._physicsImpostor!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add((function(){t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)}))))},enumerable:!0,configurable:!0}),e.AbstractMesh.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},e.AbstractMesh.prototype.applyImpulse=function(e,t){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(e,t),this):this},e.AbstractMesh.prototype.setPhysicsLinkWith=function(t,i,r,n){return this.physicsImpostor&&t.physicsImpostor?(this.physicsImpostor.createJoint(t.physicsImpostor,e.PhysicsJoint.HingeJoint,{mainPivot:i,connectedPivot:r,nativeParams:n}),this):this};var t=function(){function t(t){var i=this;this.name=e.SceneComponentConstants.NAME_PHYSICSENGINE,this.scene=t,this.scene.onBeforePhysicsObservable=new e.Observable,this.scene.onAfterPhysicsObservable=new e.Observable,this.scene.getDeterministicFrameTime=function(){return i.scene._physicsEngine?1e3*i.scene._physicsEngine.getTimeStep():1e3/60}}return t.prototype.register=function(){},t.prototype.rebuild=function(){},t.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},t}();e.PhysicsEngineSceneComponent=t}(s||(s={})),function(e){function t(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var i=t("DXT1"),r=t("DXT3"),n=t("DXT5"),a=t("DX10"),o=function(){function t(){}return t.GetDDSInfo=function(t){var o=new Int32Array(t,0,31),s=new Int32Array(t,0,35),l=1;131072&o[__uv.$wrap((2))]&&(l=Math.max(1,o[__uv.$wrap((7))]));var c=o[__uv.$wrap((21))],u=c===a?s[__uv.$wrap((32))]:0,h=e.Engine.TEXTURETYPE_UNSIGNED_INT;switch(c){case 113:h=e.Engine.TEXTURETYPE_HALF_FLOAT;break;case 116:h=e.Engine.TEXTURETYPE_FLOAT;break;case a:if(10===u){h=e.Engine.TEXTURETYPE_HALF_FLOAT;break}}return{width:o[__uv.$wrap((4))],height:o[__uv.$wrap((3))],mipmapCount:l,isFourCC:4==(4&o[__uv.$wrap((20))]),isRGB:64==(64&o[__uv.$wrap((20))]),isLuminance:131072==(131072&o[__uv.$wrap((20))]),isCube:512==(512&o[__uv.$wrap((28))]),isCompressed:c===i||c===r||c===n,dxgiFormat:u,textureType:h}},t._ToHalfFloat=function(e){t._FloatView||(t._FloatView=new Float32Array(1),t._Int32View=new Int32Array(t._FloatView.buffer)),t._FloatView[__uv.$wrap((0))]=e;var i=t._Int32View[__uv.$wrap((0))],r=i>>16&32768,n=i>>12&2047,a=i>>23&255;return a<103?r:a>142?(r|=31744,r|=(255==a?0:1)&&8388607&i):a<113?r|=((n|=2048)>>114-a)+(n>>113-a&1):(r|=a-112<<10|n>>1,r+=1&n)},t._FromHalfFloat=function(e){var t=(32768&e)>>15,i=(31744&e)>>10,r=1023&e;return 0===i?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==i?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+r/Math.pow(2,10))},t._GetHalfFloatAsFloatRGBAArrayBuffer=function(e,i,r,n,a,o){for(var s=new Float32Array(n),l=new Uint16Array(a,r),c=0,u=0;u<i;u++)for(var h=0;h<e;h++){var d=4*(h+u*e);s[__uv.$wrap((c))]=t._FromHalfFloat(l[__uv.$wrap((d))]),s[__uv.$wrap((c+1))]=t._FromHalfFloat(l[__uv.$wrap((d+1))]),s[__uv.$wrap((c+2))]=t._FromHalfFloat(l[__uv.$wrap((d+2))]),t.StoreLODInAlphaChannel?s[__uv.$wrap((c+3))]=o:s[__uv.$wrap((c+3))]=t._FromHalfFloat(l[__uv.$wrap((d+3))]),c+=4}return s},t._GetHalfFloatRGBAArrayBuffer=function(e,i,r,n,a,o){if(t.StoreLODInAlphaChannel){for(var s=new Uint16Array(n),l=new Uint16Array(a,r),c=0,u=0;u<i;u++)for(var h=0;h<e;h++){var d=4*(h+u*e);s[__uv.$wrap((c))]=l[__uv.$wrap((d))],s[__uv.$wrap((c+1))]=l[__uv.$wrap((d+1))],s[__uv.$wrap((c+2))]=l[__uv.$wrap((d+2))],s[__uv.$wrap((c+3))]=t._ToHalfFloat(o),c+=4}return s}return new Uint16Array(a,r,n)},t._GetFloatRGBAArrayBuffer=function(e,i,r,n,a,o){if(t.StoreLODInAlphaChannel){for(var s=new Float32Array(n),l=new Float32Array(a,r),c=0,u=0;u<i;u++)for(var h=0;h<e;h++){var d=4*(h+u*e);s[__uv.$wrap((c))]=l[__uv.$wrap((d))],s[__uv.$wrap((c+1))]=l[__uv.$wrap((d+1))],s[__uv.$wrap((c+2))]=l[__uv.$wrap((d+2))],s[__uv.$wrap((c+3))]=o,c+=4}return s}return new Float32Array(a,r,n)},t._GetFloatAsUIntRGBAArrayBuffer=function(i,r,n,a,o,s){for(var l=new Uint8Array(a),c=new Float32Array(o,n),u=0,h=0;h<r;h++)for(var d=0;d<i;d++){var p=4*(d+h*i);l[__uv.$wrap((u))]=255*e.Scalar.Clamp(c[__uv.$wrap((p))]),l[__uv.$wrap((u+1))]=255*e.Scalar.Clamp(c[__uv.$wrap((p+1))]),l[__uv.$wrap((u+2))]=255*e.Scalar.Clamp(c[__uv.$wrap((p+2))]),t.StoreLODInAlphaChannel?l[__uv.$wrap((u+3))]=s:l[__uv.$wrap((u+3))]=255*e.Scalar.Clamp(c[__uv.$wrap((p+3))]),u+=4}return l},t._GetHalfFloatAsUIntRGBAArrayBuffer=function(i,r,n,a,o,s){for(var l=new Uint8Array(a),c=new Uint16Array(o,n),u=0,h=0;h<r;h++)for(var d=0;d<i;d++){var p=4*(d+h*i);l[__uv.$wrap((u))]=255*e.Scalar.Clamp(t._FromHalfFloat(c[__uv.$wrap((p))])),l[__uv.$wrap((u+1))]=255*e.Scalar.Clamp(t._FromHalfFloat(c[__uv.$wrap((p+1))])),l[__uv.$wrap((u+2))]=255*e.Scalar.Clamp(t._FromHalfFloat(c[__uv.$wrap((p+2))])),t.StoreLODInAlphaChannel?l[__uv.$wrap((u+3))]=s:l[__uv.$wrap((u+3))]=255*e.Scalar.Clamp(t._FromHalfFloat(c[__uv.$wrap((p+3))])),u+=4}return l},t._GetRGBAArrayBuffer=function(e,t,i,r,n,a,o,s,l){for(var c=new Uint8Array(r),u=new Uint8Array(n,i),h=0,d=0;d<t;d++)for(var p=0;p<e;p++){var m=4*(p+d*e);c[__uv.$wrap((h))]=u[__uv.$wrap((m+a))],c[__uv.$wrap((h+1))]=u[__uv.$wrap((m+o))],c[__uv.$wrap((h+2))]=u[__uv.$wrap((m+s))],c[__uv.$wrap((h+3))]=u[__uv.$wrap((m+l))],h+=4}return c},t._ExtractLongWordOrder=function(e){return 0===e||255===e||-16777216===e?0:1+t._ExtractLongWordOrder(e>>8)},t._GetRGBArrayBuffer=function(e,t,i,r,n,a,o,s){for(var l=new Uint8Array(r),c=new Uint8Array(n,i),u=0,h=0;h<t;h++)for(var d=0;d<e;d++){var p=3*(d+h*e);l[__uv.$wrap((u))]=c[__uv.$wrap((p+a))],l[__uv.$wrap((u+1))]=c[__uv.$wrap((p+o))],l[__uv.$wrap((u+2))]=c[__uv.$wrap((p+s))],u+=3}return l},t._GetLuminanceArrayBuffer=function(e,t,i,r,n){for(var a=new Uint8Array(r),o=new Uint8Array(n,i),s=0,l=0;l<t;l++)for(var c=0;c<e;c++){var u=c+l*e;a[__uv.$wrap((s))]=o[__uv.$wrap((u))],s++}return a},t.UploadDDSLevels=function(o,s,l,c,u,h,d,p){void 0===d&&(d=-1);var m=null;c.sphericalPolynomial&&(m=new Array);var _,f,g,y,v,b,x,S=o.getCaps().s3tc,T=new Int32Array(l,0,31),E=0,P=0,A=1;if(542327876===T[__uv.$wrap((0))])if(c.isFourCC||c.isRGB||c.isLuminance)if(!c.isCompressed||S){var M=T[__uv.$wrap((22))];y=T[__uv.$wrap((1))]+4;var C,R=!1;if(c.isFourCC)switch(_=T[__uv.$wrap((21))]){case i:A=8,P=S.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case r:A=16,P=S.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case n:A=16,P=S.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:R=!0;break;case a:y+=20;var w=!1;switch(c.dxgiFormat){case 10:R=!0,w=!0;break;case 88:c.isRGB=!0,c.isFourCC=!1,M=32,w=!0}if(w)break;default:return void console.error("Unsupported FourCC code:",(C=_,String.fromCharCode(255&C,C>>8&255,C>>16&255,C>>24&255)))}var I=t._ExtractLongWordOrder(T[__uv.$wrap((23))]),O=t._ExtractLongWordOrder(T[__uv.$wrap((24))]),D=t._ExtractLongWordOrder(T[__uv.$wrap((25))]),k=t._ExtractLongWordOrder(T[__uv.$wrap((26))]);R&&(P=o._getRGBABufferInternalSizedFormat(c.textureType)),b=1,131072&T[__uv.$wrap((2))]&&!1!==u&&(b=Math.max(1,T[__uv.$wrap((7))]));for(var B=0;B<h;B++){for(f=T[__uv.$wrap((4))],g=T[__uv.$wrap((3))],x=0;x<b;++x){if(-1===d||d===x){var F=-1===d?x:0;if(!c.isCompressed&&c.isFourCC){s.format=e.Engine.TEXTUREFORMAT_RGBA,E=f*g*4;var L=null;o._badOS||o._badDesktopOS||!o.getCaps().textureHalfFloat&&!o.getCaps().textureFloat?(128===M?(L=t._GetFloatAsUIntRGBAArrayBuffer(f,g,y,E,l,F),m&&0==F&&m.push(t._GetFloatRGBAArrayBuffer(f,g,y,E,l,F))):64===M&&(L=t._GetHalfFloatAsUIntRGBAArrayBuffer(f,g,y,E,l,F),m&&0==F&&m.push(t._GetHalfFloatAsFloatRGBAArrayBuffer(f,g,y,E,l,F))),s.type=e.Engine.TEXTURETYPE_UNSIGNED_INT):128===M?(s.type=e.Engine.TEXTURETYPE_FLOAT,L=t._GetFloatRGBAArrayBuffer(f,g,y,E,l,F),m&&0==F&&m.push(L)):64!==M||o.getCaps().textureHalfFloat?(s.type=e.Engine.TEXTURETYPE_HALF_FLOAT,L=t._GetHalfFloatRGBAArrayBuffer(f,g,y,E,l,F),m&&0==F&&m.push(t._GetHalfFloatAsFloatRGBAArrayBuffer(f,g,y,E,l,F))):(s.type=e.Engine.TEXTURETYPE_FLOAT,L=t._GetHalfFloatAsFloatRGBAArrayBuffer(f,g,y,E,l,F),m&&0==F&&m.push(L)),L&&o._uploadDataToTextureDirectly(s,L,B,F)}else if(c.isRGB)s.type=e.Engine.TEXTURETYPE_UNSIGNED_INT,24===M?(s.format=e.Engine.TEXTUREFORMAT_RGB,E=f*g*3,v=t._GetRGBArrayBuffer(f,g,y,E,l,I,O,D),o._uploadDataToTextureDirectly(s,v,B,F)):(s.format=e.Engine.TEXTUREFORMAT_RGBA,E=f*g*4,v=t._GetRGBAArrayBuffer(f,g,y,E,l,I,O,D,k),o._uploadDataToTextureDirectly(s,v,B,F));else if(c.isLuminance){var N=o._getUnpackAlignement(),V=f;E=Math.floor((f+N-1)/N)*N*(g-1)+V,v=t._GetLuminanceArrayBuffer(f,g,y,E,l),s.format=e.Engine.TEXTUREFORMAT_LUMINANCE,s.type=e.Engine.TEXTURETYPE_UNSIGNED_INT,o._uploadDataToTextureDirectly(s,v,B,F)}else E=Math.max(4,f)/4*Math.max(4,g)/4*A,v=new Uint8Array(l,y,E),s.type=e.Engine.TEXTURETYPE_UNSIGNED_INT,o._uploadCompressedDataToTextureDirectly(s,P,f,g,v,B,F)}y+=M?f*g*(M/8):E,f*=.5,g*=.5,f=Math.max(1,f),g=Math.max(1,g)}if(void 0!==p)break}m&&m.length>0?c.sphericalPolynomial=e.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial({size:T[__uv.$wrap((4))],right:m[__uv.$wrap((0))],left:m[__uv.$wrap((1))],up:m[__uv.$wrap((2))],down:m[__uv.$wrap((3))],front:m[__uv.$wrap((4))],back:m[__uv.$wrap((5))],format:e.Engine.TEXTUREFORMAT_RGBA,type:e.Engine.TEXTURETYPE_FLOAT,gammaSpace:!1}):c.sphericalPolynomial=void 0}else e.Tools.Error("Compressed textures are not supported on this platform.");else e.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else e.Tools.Error("Invalid magic number in DDS header")},t.StoreLODInAlphaChannel=!1,t}();e.DDSTools=o}(s||(s={})),function(e){var t=function(){function t(){this.supportCascades=!0}return t.prototype.canLoad=function(e,t,i,r,n){return 0===e.indexOf(".dds")},t.prototype.transformUrl=function(e,t){return e},t.prototype.getFallbackTextureUrl=function(e,t){return null},t.prototype.loadCubeData=function(t,i,r,n,a){var o,s=i.getEngine(),l=!1;if(Array.isArray(t))for(var c=0;c<t.length;c++){var u=t[__uv.$wrap((c))];o=e.DDSTools.GetDDSInfo(u),i.width=o.width,i.height=o.height,l=(o.isRGB||o.isLuminance||o.mipmapCount>1)&&i.generateMipMaps,s._unpackFlipY(o.isCompressed),e.DDSTools.UploadDDSLevels(s,i,u,o,l,6,-1,c),o.isFourCC||1!==o.mipmapCount||s.generateMipMapsForCubemap(i)}else{var h=t;o=e.DDSTools.GetDDSInfo(h),i.width=o.width,i.height=o.height,r&&(o.sphericalPolynomial=new e.SphericalPolynomial),l=(o.isRGB||o.isLuminance||o.mipmapCount>1)&&i.generateMipMaps,s._unpackFlipY(o.isCompressed),e.DDSTools.UploadDDSLevels(s,i,h,o,l,6),o.isFourCC||1!==o.mipmapCount||s.generateMipMapsForCubemap(i)}s._setCubeMapTextureParams(l),i.isReady=!0,n&&n({isDDS:!0,width:i.width,info:o,data:t,texture:i})},t.prototype.loadData=function(t,i,r){var n=e.DDSTools.GetDDSInfo(t),a=(n.isRGB||n.isLuminance||n.mipmapCount>1)&&i.generateMipMaps&&n.width>>n.mipmapCount-1==1;r(n.width,n.height,a,n.isFourCC,(function(){e.DDSTools.UploadDDSLevels(i.getEngine(),i,t,n,a,1)}))},t}();e.Engine._TextureLoaders.push(new t)}(s||(s={})),function(e){var t=function(){function t(){}return t.GetTGAHeader=function(e){var t=0;return{id_length:e[__uv.$wrap((t++))],colormap_type:e[__uv.$wrap((t++))],image_type:e[__uv.$wrap((t++))],colormap_index:e[__uv.$wrap((t++))]|e[__uv.$wrap((t++))]<<8,colormap_length:e[__uv.$wrap((t++))]|e[__uv.$wrap((t++))]<<8,colormap_size:e[__uv.$wrap((t++))],origin:[e[__uv.$wrap((t++))]|e[__uv.$wrap((t++))]<<8,e[__uv.$wrap((t++))]|e[__uv.$wrap((t++))]<<8],width:e[__uv.$wrap((t++))]|e[__uv.$wrap((t++))]<<8,height:e[__uv.$wrap((t++))]|e[__uv.$wrap((t++))]<<8,pixel_size:e[__uv.$wrap((t++))],flags:e[__uv.$wrap((t++))]}},t.UploadContent=function(i,r){if(r.length<19)e.Tools.Error("Unable to load TGA file - Not enough data to contain header");else{var n=18,a=t.GetTGAHeader(r);if(a.id_length+n>r.length)e.Tools.Error("Unable to load TGA file - Not enough data");else{n+=a.id_length;var o,s=!1,l=!1,c=!1;switch(a.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:l=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:c=!0}var u,h,d,p,m,_,f,g=a.pixel_size>>3,y=a.width*a.height*g;if(l&&(u=r.subarray(n,n+=a.colormap_length*(a.colormap_size>>3))),s){var v,b,x;o=new Uint8Array(y);for(var S=0,T=new Uint8Array(g);n<y&&S<y;)if(b=1+(127&(v=r[__uv.$wrap((n++))])),128&v){for(x=0;x<g;++x)T[__uv.$wrap((x))]=r[__uv.$wrap((n++))];for(x=0;x<b;++x)o.set(T,S+x*g);S+=g*b}else{for(b*=g,x=0;x<b;++x)o[__uv.$wrap((S+x))]=r[__uv.$wrap((n++))];S+=b}}else o=r.subarray(n,n+=l?a.width*a.height:y);switch((a.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:h=0,p=1,f=a.width,d=0,m=1,_=a.height;break;case t._ORIGIN_BL:h=0,p=1,f=a.width,d=a.height-1,m=-1,_=-1;break;case t._ORIGIN_UR:h=a.width-1,p=-1,f=-1,d=0,m=1,_=a.height;break;case t._ORIGIN_BR:h=a.width-1,p=-1,f=-1,d=a.height-1,m=-1,_=-1}var E=t[__uv.$wrap(("_getImageData"+(c?"Grey":"")+a.pixel_size+"bits"))](a,u,o,d,m,_,h,p,f);i.getEngine()._uploadDataToTextureDirectly(i,E)}}},t._getImageData8bits=function(e,t,i,r,n,a,o,s,l){var c,u,h,d=i,p=t,m=e.width,_=e.height,f=0,g=new Uint8Array(m*_*4);for(h=r;h!==a;h+=n)for(u=o;u!==l;u+=s,f++)c=d[__uv.$wrap((f))],g[__uv.$wrap((4*(u+m*h)+3))]=255,g[__uv.$wrap((4*(u+m*h)+2))]=p[__uv.$wrap((3*c+0))],g[__uv.$wrap((4*(u+m*h)+1))]=p[__uv.$wrap((3*c+1))],g[__uv.$wrap((4*(u+m*h)+0))]=p[__uv.$wrap((3*c+2))];return g},t._getImageData16bits=function(e,t,i,r,n,a,o,s,l){var c,u,h,d=i,p=e.width,m=e.height,_=0,f=new Uint8Array(p*m*4);for(h=r;h!==a;h+=n)for(u=o;u!==l;u+=s,_+=2){var g=255*((31744&(c=d[__uv.$wrap((_+0))]+(d[__uv.$wrap((_+1))]<<8)))>>10)/31|0,y=255*((992&c)>>5)/31|0,v=255*(31&c)/31|0;f[__uv.$wrap((4*(u+p*h)+0))]=g,f[__uv.$wrap((4*(u+p*h)+1))]=y,f[__uv.$wrap((4*(u+p*h)+2))]=v,f[__uv.$wrap((4*(u+p*h)+3))]=32768&c?0:255}return f},t._getImageData24bits=function(e,t,i,r,n,a,o,s,l){var c,u,h=i,d=e.width,p=e.height,m=0,_=new Uint8Array(d*p*4);for(u=r;u!==a;u+=n)for(c=o;c!==l;c+=s,m+=3)_[__uv.$wrap((4*(c+d*u)+3))]=255,_[__uv.$wrap((4*(c+d*u)+2))]=h[__uv.$wrap((m+0))],_[__uv.$wrap((4*(c+d*u)+1))]=h[__uv.$wrap((m+1))],_[__uv.$wrap((4*(c+d*u)+0))]=h[__uv.$wrap((m+2))];return _},t._getImageData32bits=function(e,t,i,r,n,a,o,s,l){var c,u,h=i,d=e.width,p=e.height,m=0,_=new Uint8Array(d*p*4);for(u=r;u!==a;u+=n)for(c=o;c!==l;c+=s,m+=4)_[__uv.$wrap((4*(c+d*u)+2))]=h[__uv.$wrap((m+0))],_[__uv.$wrap((4*(c+d*u)+1))]=h[__uv.$wrap((m+1))],_[__uv.$wrap((4*(c+d*u)+0))]=h[__uv.$wrap((m+2))],_[__uv.$wrap((4*(c+d*u)+3))]=h[__uv.$wrap((m+3))];return _},t._getImageDataGrey8bits=function(e,t,i,r,n,a,o,s,l){var c,u,h,d=i,p=e.width,m=e.height,_=0,f=new Uint8Array(p*m*4);for(h=r;h!==a;h+=n)for(u=o;u!==l;u+=s,_++)c=d[__uv.$wrap((_))],f[__uv.$wrap((4*(u+p*h)+0))]=c,f[__uv.$wrap((4*(u+p*h)+1))]=c,f[__uv.$wrap((4*(u+p*h)+2))]=c,f[__uv.$wrap((4*(u+p*h)+3))]=255;return f},t._getImageDataGrey16bits=function(e,t,i,r,n,a,o,s,l){var c,u,h=i,d=e.width,p=e.height,m=0,_=new Uint8Array(d*p*4);for(u=r;u!==a;u+=n)for(c=o;c!==l;c+=s,m+=2)_[__uv.$wrap((4*(c+d*u)+0))]=h[__uv.$wrap((m+0))],_[__uv.$wrap((4*(c+d*u)+1))]=h[__uv.$wrap((m+0))],_[__uv.$wrap((4*(c+d*u)+2))]=h[__uv.$wrap((m+0))],_[__uv.$wrap((4*(c+d*u)+3))]=h[__uv.$wrap((m+1))];return _},t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();e.TGATools=t}(s||(s={})),function(e){var t=function(){function t(){this.supportCascades=!1}return t.prototype.canLoad=function(e,t,i,r,n){return 0===e.indexOf(".tga")},t.prototype.transformUrl=function(e,t){return e},t.prototype.getFallbackTextureUrl=function(e,t){return null},t.prototype.loadCubeData=function(e,t,i,r,n){throw".env not supported in Cube."},t.prototype.loadData=function(t,i,r){var n=new Uint8Array(t),a=e.TGATools.GetTGAHeader(n);r(a.width,a.height,i.generateMipMaps,!1,(function(){e.TGATools.UploadContent(i,n)}))},t}();e.Engine._TextureLoaders.push(new t)}(s||(s={})),function(e){var t=function(){function t(i,r,n,a){this.arrayBuffer=i;var o=new Uint8Array(this.arrayBuffer,0,12);if(171===o[__uv.$wrap((0))]&&75===o[__uv.$wrap((1))]&&84===o[__uv.$wrap((2))]&&88===o[__uv.$wrap((3))]&&32===o[__uv.$wrap((4))]&&49===o[__uv.$wrap((5))]&&49===o[__uv.$wrap((6))]&&187===o[__uv.$wrap((7))]&&13===o[__uv.$wrap((8))]&&10===o[__uv.$wrap((9))]&&26===o[__uv.$wrap((10))]&&10===o[__uv.$wrap((11))]){var s=new Int32Array(this.arrayBuffer,12,13),l=16909060===s[__uv.$wrap((0))];this.glType=l?this.switchEndianness(s[__uv.$wrap((1))]):s[__uv.$wrap((1))],this.glTypeSize=l?this.switchEndianness(s[__uv.$wrap((2))]):s[__uv.$wrap((2))],this.glFormat=l?this.switchEndianness(s[__uv.$wrap((3))]):s[__uv.$wrap((3))],this.glInternalFormat=l?this.switchEndianness(s[__uv.$wrap((4))]):s[__uv.$wrap((4))],this.glBaseInternalFormat=l?this.switchEndianness(s[__uv.$wrap((5))]):s[__uv.$wrap((5))],this.pixelWidth=l?this.switchEndianness(s[__uv.$wrap((6))]):s[__uv.$wrap((6))],this.pixelHeight=l?this.switchEndianness(s[__uv.$wrap((7))]):s[__uv.$wrap((7))],this.pixelDepth=l?this.switchEndianness(s[__uv.$wrap((8))]):s[__uv.$wrap((8))],this.numberOfArrayElements=l?this.switchEndianness(s[__uv.$wrap((9))]):s[__uv.$wrap((9))],this.numberOfFaces=l?this.switchEndianness(s[__uv.$wrap((10))]):s[__uv.$wrap((10))],this.numberOfMipmapLevels=l?this.switchEndianness(s[__uv.$wrap((11))]):s[__uv.$wrap((11))],this.bytesOfKeyValueData=l?this.switchEndianness(s[__uv.$wrap((12))]):s[__uv.$wrap((12))],0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===r?this.loadType=t.COMPRESSED_2D:e.Tools.Error("number of faces expected"+r+", but found "+this.numberOfFaces):e.Tools.Error("texture arrays not currently supported"):e.Tools.Error("only 2D textures currently supported")):e.Tools.Error("only compressed formats currently supported")}else e.Tools.Error("texture missing KTX identifier")}return t.prototype.switchEndianness=function(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255},t.prototype.uploadLevels=function(e,i){switch(this.loadType){case t.COMPRESSED_2D:this._upload2DCompressedLevels(e,i);break;case t.TEX_2D:case t.COMPRESSED_3D:case t.TEX_3D:}},t.prototype._upload2DCompressedLevels=function(e,i){for(var r=t.HEADER_LEN+this.bytesOfKeyValueData,n=this.pixelWidth,a=this.pixelHeight,o=i?this.numberOfMipmapLevels:1,s=0;s<o;s++){var l=new Int32Array(this.arrayBuffer,r,1)[__uv.$wrap((0))];r+=4;for(var c=0;c<this.numberOfFaces;c++){var u=new Uint8Array(this.arrayBuffer,r,l);e.getEngine()._uploadCompressedDataToTextureDirectly(e,this.glInternalFormat,n,a,u,c,s),r+=l,r+=3-(l+3)%4}n=Math.max(1,.5*n),a=Math.max(1,.5*a)}},t.HEADER_LEN=64,t.COMPRESSED_2D=0,t.COMPRESSED_3D=1,t.TEX_2D=2,t.TEX_3D=3,t}();e.KhronosTextureContainer=t}(s||(s={})),function(e){var t=function(){function t(){this.supportCascades=!1}return t.prototype.canLoad=function(e,t,i,r,n){return!(!t||r||i||n)},t.prototype.transformUrl=function(e,t){var i=e.lastIndexOf(".");return(i>-1?e.substring(0,i):e)+t},t.prototype.getFallbackTextureUrl=function(e,t){var i=new RegExp(t+"$");return e.replace(i,"")},t.prototype.loadCubeData=function(t,i,r,n,a){if(!Array.isArray(t)){var o=i.getEngine(),s=new e.KhronosTextureContainer(t,6),l=s.numberOfMipmapLevels>1&&i.generateMipMaps;o._unpackFlipY(!0),s.uploadLevels(i,i.generateMipMaps),i.width=s.pixelWidth,i.height=s.pixelHeight,o._setCubeMapTextureParams(l),i.isReady=!0}},t.prototype.loadData=function(t,i,r){var n=new e.KhronosTextureContainer(t,1);r(n.pixelWidth,n.pixelHeight,!1,!0,(function(){n.uploadLevels(i,i.generateMipMaps)}))},t}();e.Engine._TextureLoaders.unshift(new t)}(s||(s={})),function(e){var t=function(){function t(){}return t.GetEnvInfo=function(i){for(var r=new DataView(i),n=0,a=0;a<t._MagicBytes.length;a++)if(r.getUint8(n++)!==t._MagicBytes[__uv.$wrap((a))])return e.Tools.Error("Not a babylon environment map"),null;for(var o="",s=0;s=r.getUint8(n++);)o+=String.fromCharCode(s);var l=JSON.parse(o);return l.specular&&(l.specular.specularDataPosition=n,l.specular.lodGenerationScale=l.specular.lodGenerationScale||.8),l},t.CreateEnvTextureAsync=function(i){var r=this,n=i.getInternalTexture();if(!n)return Promise.reject("The cube texture is invalid.");if(!i._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var a=n.getEngine();if(a&&a.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(i.textureType===e.Engine.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var o=a.getRenderingCanvas();if(!o)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var s=e.Engine.TEXTURETYPE_FLOAT;if(!a.getCaps().textureFloatRender&&(s=e.Engine.TEXTURETYPE_HALF_FLOAT,!a.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var l=n.width,c=new e.Scene(a),u={},h=[],d=e.Scalar.Log2(n.width);d=Math.round(d);for(var p=function(t){for(var r=Math.pow(2,d-t),n=function(n){var l=i.readPixels(n,t),d=a.createRawTexture(l,r,r,e.Engine.TEXTUREFORMAT_RGBA,!1,!1,e.Texture.NEAREST_SAMPLINGMODE,null,s),p=new Promise((function(i,s){var l=new e.PostProcess("rgbdEncode","rgbdEncode",null,null,1,null,e.Texture.NEAREST_SAMPLINGMODE,a,!1,void 0,e.Engine.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);l.getEffect().executeWhenCompiled((function(){l.onApply=function(e){e._bindTexture("textureSampler",d)};var s=a.getRenderWidth(),h=a.getRenderHeight();a.setSize(r,r),c.postProcessManager.directRender([l],null),e.Tools.ToBlob(o,(function(e){var r=new FileReader;r.onload=function(e){var r=e.target.result;u[__uv.$wrap((6*t+n))]=r,i()},r.readAsArrayBuffer(e)})),a.setSize(s,h)}))}));h.push(p)},l=0;l<6;l++)n(l)},m=0;m<=d;m++)p(m);return Promise.all(h).then((function(){c.dispose();for(var e={version:1,width:l,irradiance:r._CreateEnvTextureIrradiance(i),specular:{mipmaps:[],lodGenerationScale:i.lodGenerationScale}},n=0,a=0;a<=d;a++)for(var o=0;o<6;o++){var s=u[__uv.$wrap((6*a+o))].byteLength;e.specular.mipmaps.push({length:s,position:n}),n+=s}for(var h=JSON.stringify(e),p=new ArrayBuffer(h.length+1),m=new Uint8Array(p),_=(a=0,h.length);a<_;a++)m[__uv.$wrap((a))]=h.charCodeAt(a);m[__uv.$wrap((h.length))]=0;var f=t._MagicBytes.length+n+p.byteLength,g=new ArrayBuffer(f),y=new Uint8Array(g),v=new DataView(g),b=0;for(a=0;a<t._MagicBytes.length;a++)v.setUint8(b++,t._MagicBytes[__uv.$wrap((a))]);y.set(new Uint8Array(p),b),b+=p.byteLength;for(a=0;a<=d;a++)for(o=0;o<6;o++){var x=u[__uv.$wrap((6*a+o))];y.set(new Uint8Array(x),b),b+=x.byteLength}return g}))},t._CreateEnvTextureIrradiance=function(e){var t=e.sphericalPolynomial;return null==t?null:{x:[t.x.x,t.x.y,t.x.z],y:[t.y.x,t.y.y,t.y.z],z:[t.z.x,t.z.y,t.z.z],xx:[t.xx.x,t.xx.y,t.xx.z],yy:[t.yy.x,t.yy.y,t.yy.z],zz:[t.zz.x,t.zz.y,t.zz.z],yz:[t.yz.x,t.yz.y,t.yz.z],zx:[t.zx.x,t.zx.y,t.zx.z],xy:[t.xy.x,t.xy.y,t.xy.z]}},t.UploadEnvLevelsAsync=function(i,r,n){if(1!==n.version)throw new Error('Unsupported babylon environment map version "'+n.version+'"');var a=n.specular;if(!a)return Promise.resolve();var o=e.Scalar.Log2(n.width);if(o=Math.round(o)+1,a.mipmaps.length!==6*o)throw new Error('Unsupported specular mipmaps number "'+a.mipmaps.length+'"');i._lodGenerationScale=a.lodGenerationScale;for(var s=new Array(o),l=0;l<o;l++){s[__uv.$wrap((l))]=new Array(6);for(var c=0;c<6;c++){var u=a.mipmaps[__uv.$wrap((6*l+c))];s[__uv.$wrap((l))][__uv.$wrap((c))]=new Uint8Array(r,a.specularDataPosition+u.position,u.length)}}return t.UploadLevelsAsync(i,s)},t.UploadLevelsAsync=function(t,i){if(!e.Tools.IsExponentOfTwo(t.width))throw new Error("Texture size must be a power of two");var r=Math.round(e.Scalar.Log2(t.width))+1,n=t.getEngine(),a=!1,o=!1,s=null,l=null,c=null,u=n.getCaps();if(t.format=e.Engine.TEXTUREFORMAT_RGBA,t.type=e.Engine.TEXTURETYPE_UNSIGNED_INT,t.generateMipMaps=!0,n.updateTextureSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE,t),u.textureLOD?n.webGLVersion<2?a=!1:u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering?(a=!0,t.type=e.Engine.TEXTURETYPE_HALF_FLOAT):u.textureFloatRender&&u.textureFloatLinearFiltering&&(a=!0,t.type=e.Engine.TEXTURETYPE_FLOAT):(a=!1,o=!0,c={}),a)s=new e.PostProcess("rgbdDecode","rgbdDecode",null,null,1,null,e.Texture.TRILINEAR_SAMPLINGMODE,n,!1,void 0,t.type,void 0,null,!1),t._isRGBD=!1,t.invertY=!1,l=n.createRenderTargetCubeTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:e.Texture.TRILINEAR_SAMPLINGMODE,type:t.type,format:e.Engine.TEXTUREFORMAT_RGBA});else if(t._isRGBD=!0,t.invertY=!0,o)for(var h=t._lodGenerationScale,d=t._lodGenerationOffset,p=0;p<3;p++){var m=(r-1)*h+d,_=d+(m-d)*(1-p/2),f=Math.round(Math.min(Math.max(_,0),m)),g=new e.InternalTexture(n,e.InternalTexture.DATASOURCE_TEMP);g.isCube=!0,g.invertY=!0,g.generateMipMaps=!1,n.updateTextureSamplingMode(e.Texture.LINEAR_LINEAR,g);var y=new e.BaseTexture(null);switch(y.isCube=!0,y._texture=g,c[__uv.$wrap((f))]=y,p){case 0:t._lodTextureLow=y;break;case 1:t._lodTextureMid=y;break;case 2:t._lodTextureHigh=y}}var v=[],b=function(r){for(var u=function(u){var h=i[__uv.$wrap((r))][__uv.$wrap((u))],d=new Blob([h],{type:"image/png"}),p=URL.createObjectURL(d),m=new Image;m.src=p;var _=new Promise((function(i,h){m.onload=function(){if(a){var d=n.createTexture(null,!0,!0,null,e.Texture.NEAREST_SAMPLINGMODE,null,(function(e){h(e)}),m);s.getEffect().executeWhenCompiled((function(){s.onApply=function(e){e._bindTexture("textureSampler",d),e.setFloat2("scale",1,1)},n.scenes[__uv.$wrap((0))].postProcessManager.directRender([s],l,!0,u,r),n.restoreDefaultFramebuffer(),d.dispose(),window.URL.revokeObjectURL(p),i()}))}else{if(n._uploadImageToTexture(t,m,u,r),o){var _=c[__uv.$wrap((r))];_&&n._uploadImageToTexture(_._texture,m,u,0)}i()}},m.onerror=function(e){h(e)}}));v.push(_)},h=0;h<6;h++)u(h)};for(p=0;p<i.length;p++)b(p);if(i.length<r){var x=void 0,S=Math.pow(2,r-1-i.length),T=S*S*4;switch(t.type){case e.Engine.TEXTURETYPE_UNSIGNED_INT:x=new Uint8Array(T);break;case e.Engine.TEXTURETYPE_HALF_FLOAT:x=new Uint16Array(T);break;case e.Engine.TEXTURETYPE_FLOAT:x=new Float32Array(T)}for(p=i.length;p<r;p++)for(var E=0;E<6;E++)n._uploadArrayBufferViewToTexture(t,x,E,p)}return Promise.all(v).then((function(){l&&(n._releaseFramebufferObjects(l),l._swapAndDie(t)),s&&s.dispose(),o&&(t._lodTextureHigh&&t._lodTextureHigh._texture&&(t._lodTextureHigh._texture.isReady=!0),t._lodTextureMid&&t._lodTextureMid._texture&&(t._lodTextureMid._texture.isReady=!0),t._lodTextureLow&&t._lodTextureLow._texture&&(t._lodTextureLow._texture.isReady=!0))}))},t.UploadEnvSpherical=function(t,i){1!==i.version&&e.Tools.Warn('Unsupported babylon environment map version "'+i.version+'"');var r=i.irradiance;if(r){var n=new e.SphericalPolynomial;e.Vector3.FromArrayToRef(r.x,0,n.x),e.Vector3.FromArrayToRef(r.y,0,n.y),e.Vector3.FromArrayToRef(r.z,0,n.z),e.Vector3.FromArrayToRef(r.xx,0,n.xx),e.Vector3.FromArrayToRef(r.yy,0,n.yy),e.Vector3.FromArrayToRef(r.zz,0,n.zz),e.Vector3.FromArrayToRef(r.yz,0,n.yz),e.Vector3.FromArrayToRef(r.zx,0,n.zx),e.Vector3.FromArrayToRef(r.xy,0,n.xy),t._sphericalPolynomial=n}},t._MagicBytes=[134,22,135,150,246,214,150,54],t}();e.EnvironmentTextureTools=t}(s||(s={})),function(e){var t=function(){function t(){this.supportCascades=!1}return t.prototype.canLoad=function(e,t,i,r,n){return 0===e.indexOf(".env")},t.prototype.transformUrl=function(e,t){return e},t.prototype.getFallbackTextureUrl=function(e,t){return null},t.prototype.loadCubeData=function(t,i,r,n,a){if(!Array.isArray(t)){t=t;var o=e.EnvironmentTextureTools.GetEnvInfo(t);o?(i.width=o.width,i.height=o.width,e.EnvironmentTextureTools.UploadEnvSpherical(i,o),e.EnvironmentTextureTools.UploadEnvLevelsAsync(i,t,o).then((function(){i.isReady=!0,n&&n()}))):a&&a("Can not parse the environment file",null)}},t.prototype.loadData=function(e,t,i){throw".env not supported in 2d."},t}();e.Engine._TextureLoaders.push(new t)}(s||(s={})),function(e){var t=function(){function t(t){var i=this;this.originalScene=t,this._pointerCaptures={},this._lastPointerEvents={},this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new e.Observable,this.utilityLayerScene=new e.Scene(t.getEngine()),this.utilityLayerScene.useRightHandedSystem=t.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,t.getEngine().scenes.pop(),this.utilityLayerScene.detachControl(),this._originalPointerObserver=t.onPrePointerObservable.add((function(r,n){if(i.processAllEvents||r.type===e.PointerEventTypes.POINTERMOVE||r.type===e.PointerEventTypes.POINTERUP||r.type===e.PointerEventTypes.POINTERDOWN){var a=r.event;if(t.isPointerCaptured(a.pointerId))i._pointerCaptures[__uv.$wrap((a.pointerId))]=!1;else{var o=r.ray?i.utilityLayerScene.pickWithRay(r.ray):i.utilityLayerScene.pick(t.pointerX,t.pointerY);if(!r.ray&&o&&(r.ray=o.ray),i.utilityLayerScene.onPrePointerObservable.notifyObservers(r),i.onlyCheckPointerDownEvents&&r.type!=e.PointerEventTypes.POINTERDOWN)return r.skipOnPointerObservable||i.utilityLayerScene.onPointerObservable.notifyObservers(new e.PointerInfo(r.type,r.event,o)),void(r.type===e.PointerEventTypes.POINTERUP&&i._pointerCaptures[__uv.$wrap((a.pointerId))]&&(i._pointerCaptures[__uv.$wrap((a.pointerId))]=!1));if(i.utilityLayerScene.autoClearDepthAndStencil)o&&o.hit&&(r.skipOnPointerObservable||i.utilityLayerScene.onPointerObservable.notifyObservers(new e.PointerInfo(r.type,r.event,o)),r.skipOnPointerObservable=!0);else{var s=r.ray?t.pickWithRay(r.ray):t.pick(t.pointerX,t.pointerY),l=r.event;s&&o&&(0===o.distance&&s.pickedMesh?i.mainSceneTrackerPredicate&&i.mainSceneTrackerPredicate(s.pickedMesh)?(i._notifyObservers(r,s,l),r.skipOnPointerObservable=!0):r.type===e.PointerEventTypes.POINTERDOWN?i._pointerCaptures[__uv.$wrap((l.pointerId))]=!0:i._lastPointerEvents[__uv.$wrap((l.pointerId))]&&(i.onPointerOutObservable.notifyObservers(l.pointerId),delete i._lastPointerEvents[__uv.$wrap((l.pointerId))]):!i._pointerCaptures[__uv.$wrap((l.pointerId))]&&(o.distance<s.distance||0===s.distance)?(i._notifyObservers(r,o,l),r.skipOnPointerObservable||(r.skipOnPointerObservable=o.distance>0)):!i._pointerCaptures[__uv.$wrap((l.pointerId))]&&o.distance>s.distance&&(i.mainSceneTrackerPredicate&&i.mainSceneTrackerPredicate(s.pickedMesh)?(i._notifyObservers(r,s,l),r.skipOnPointerObservable=!0):i._lastPointerEvents[__uv.$wrap((l.pointerId))]&&(i.onPointerOutObservable.notifyObservers(l.pointerId),delete i._lastPointerEvents[__uv.$wrap((l.pointerId))])),r.type===e.PointerEventTypes.POINTERUP&&i._pointerCaptures[__uv.$wrap((l.pointerId))]&&(i._pointerCaptures[__uv.$wrap((l.pointerId))]=!1))}}}})),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterRenderObservable.add((function(){i.shouldRender&&i.render()})),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add((function(){i.dispose()})),this._updateCamera()}return Object.defineProperty(t,"DefaultUtilityLayer",{get:function(){return null==t._DefaultUtilityLayer&&(t._DefaultUtilityLayer=new t(e.Engine.LastCreatedScene),t._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce((function(){t._DefaultUtilityLayer=null}))),t._DefaultUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DefaultKeepDepthUtilityLayer",{get:function(){return null==t._DefaultKeepDepthUtilityLayer&&(t._DefaultKeepDepthUtilityLayer=new t(e.Engine.LastCreatedScene),t._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,t._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce((function(){t._DefaultKeepDepthUtilityLayer=null}))),t._DefaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),t.prototype._notifyObservers=function(t,i,r){t.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new e.PointerInfo(t.type,t.event,i)),this._lastPointerEvents[__uv.$wrap((r.pointerId))]=!0)},t.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var e=this.utilityLayerScene.activeCamera.getScene(),t=this.utilityLayerScene.activeCamera;t._scene=this.utilityLayerScene,t.leftCamera&&(t.leftCamera._scene=this.utilityLayerScene),t.rightCamera&&(t.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),t._scene=e,t.leftCamera&&(t.leftCamera._scene=e),t.rightCamera&&(t.rightCamera._scene=e)}},t.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},t.prototype._updateCamera=function(){this.utilityLayerScene.activeCamera=this.originalScene.activeCamera},t._DefaultUtilityLayer=null,t._DefaultKeepDepthUtilityLayer=null,t}();e.UtilityLayerRenderer=t}(s||(s={})),function(e){var t=function(){function t(t){this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new e.Observable,this.onDragStartObservable=new e.Observable,this.onDragEndObservable=new e.Observable,this.moveAttached=!0,this.enabled=!0,this.detachCameraControls=!0,this.useObjectOrienationForDragging=!0,this._tmpVector=new e.Vector3(0,0,0),this._alternatePickedPoint=new e.Vector3(0,0,0),this._worldDragAxis=new e.Vector3(0,0,0),this._targetPosition=new e.Vector3(0,0,0),this._attachedElement=null,this._startDragRay=new e.Ray(new e.Vector3,new e.Vector3),this._lastPointerRay={},this._dragDelta=new e.Vector3,this._pointA=new e.Vector3(0,0,0),this._pointB=new e.Vector3(0,0,0),this._pointC=new e.Vector3(0,0,0),this._lineA=new e.Vector3(0,0,0),this._lineB=new e.Vector3(0,0,0),this._localAxis=new e.Vector3(0,0,0),this._lookAt=new e.Vector3(0,0,0),this._options=t||{};var i=0;if(this._options.dragAxis&&i++,this._options.dragPlaneNormal&&i++,i>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(t.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.attach=function(i){var r=this;this._scene=i.getScene(),this._attachedNode=i,t._planeScene||(this._debugMode?t._planeScene=this._scene:(t._planeScene=new e.Scene(this._scene.getEngine()),t._planeScene.detachControl(),this._scene.getEngine().scenes.pop(),this._scene.onDisposeObservable.addOnce((function(){t._planeScene.dispose(),t._planeScene=null})))),this._dragPlane=e.Mesh.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,t._planeScene,!1,e.Mesh.DOUBLESIDE),this.lastDragPosition=new e.Vector3(0,0,0);this._pointerObserver=this._scene.onPointerObservable.add((function(i,n){var a;if(r.enabled)if(i.type==e.PointerEventTypes.POINTERDOWN)!r.dragging&&i.pickInfo&&i.pickInfo.hit&&i.pickInfo.pickedMesh&&i.pickInfo.pickedPoint&&i.pickInfo.ray&&(a=i.pickInfo.pickedMesh,r._attachedNode==a||a.isDescendantOf(r._attachedNode))&&r._startDrag(i.event.pointerId,i.pickInfo.ray,i.pickInfo.pickedPoint);else if(i.type==e.PointerEventTypes.POINTERUP)r.currentDraggingPointerID==i.event.pointerId&&r.releaseDrag();else if(i.type==e.PointerEventTypes.POINTERMOVE){var o=i.event.pointerId;r.currentDraggingPointerID===t._AnyMouseID&&o!==t._AnyMouseID&&"mouse"==i.event.pointerType&&(r._lastPointerRay[__uv.$wrap((r.currentDraggingPointerID))]&&(r._lastPointerRay[__uv.$wrap((o))]=r._lastPointerRay[__uv.$wrap((r.currentDraggingPointerID))],delete r._lastPointerRay[__uv.$wrap((r.currentDraggingPointerID))]),r.currentDraggingPointerID=o),r._lastPointerRay[__uv.$wrap((o))]||(r._lastPointerRay[__uv.$wrap((o))]=new e.Ray(new e.Vector3,new e.Vector3)),i.pickInfo&&i.pickInfo.ray&&(r._lastPointerRay[__uv.$wrap((o))].origin.copyFrom(i.pickInfo.ray.origin),r._lastPointerRay[__uv.$wrap((o))].direction.copyFrom(i.pickInfo.ray.direction),r.currentDraggingPointerID==o&&r.dragging&&r._moveDrag(i.pickInfo.ray))}})),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add((function(){r._moving&&r.moveAttached&&(e.BoundingBoxGizmo._RemoveAndStorePivotPoint(r._attachedNode),r._targetPosition.subtractToRef(r._attachedNode.absolutePosition,r._tmpVector),r._tmpVector.scaleInPlace(r.dragDeltaRatio),r._attachedNode.getAbsolutePosition().addToRef(r._tmpVector,r._tmpVector),r._attachedNode.setAbsolutePosition(r._tmpVector),e.BoundingBoxGizmo._RestorePivotPoint(r._attachedNode))}))},t.prototype.releaseDrag=function(){this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID}),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&this._scene.activeCamera.attachControl(this._attachedElement,!0)},t.prototype.startDrag=function(e,i,r){void 0===e&&(e=t._AnyMouseID),this._startDrag(e,i,r);var n=this._lastPointerRay[__uv.$wrap((e))];e===t._AnyMouseID&&(n=this._lastPointerRay[__uv.$wrap((Object.keys(this._lastPointerRay)[__uv.$wrap((0))]))]),n&&this._moveDrag(n)},t.prototype._startDrag=function(t,i,r){if(this._scene.activeCamera&&!this.dragging&&this._attachedNode){e.BoundingBoxGizmo._RemoveAndStorePivotPoint(this._attachedNode),i?(this._startDragRay.direction.copyFrom(i.direction),this._startDragRay.origin.copyFrom(i.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this._attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,r||this._tmpVector);var n=this._pickWithRayOnDragPlane(this._startDragRay);n&&(this.dragging=!0,this.currentDraggingPointerID=t,this.lastDragPosition.copyFrom(n),this.onDragStartObservable.notifyObservers({dragPlanePoint:n,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this._attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedElement?(this._attachedElement=this._scene.activeCamera.inputs.attachedElement,this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)):this._attachedElement=null)),e.BoundingBoxGizmo._RestorePivotPoint(this._attachedNode)}},t.prototype._moveDrag=function(t){this._moving=!0;var i=this._pickWithRayOnDragPlane(t);if(i){this.updateDragPlane&&this._updateDragPlanePosition(t,i);var r=0;this._options.dragAxis?(e.Vector3.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis),i.subtractToRef(this.lastDragPosition,this._tmpVector),r=e.Vector3.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(r,this._dragDelta)):(r=this._dragDelta.length(),i.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:r,delta:this._dragDelta,dragPlanePoint:i,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(i)}},t.prototype._pickWithRayOnDragPlane=function(i){var r=this;if(!i)return null;var n=Math.acos(e.Vector3.Dot(this._dragPlane.forward,i.direction));if(n>Math.PI/2&&(n=Math.PI-n),this.maxDragAngle>0&&n>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(i.direction),this._attachedNode.absolutePosition.subtractToRef(i.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(-2*e.Vector3.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var a=e.Vector3.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-a,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this._attachedNode.absolutePosition),this._alternatePickedPoint}return null}var o=t._planeScene.pickWithRay(i,(function(e){return e==r._dragPlane}));return o&&o.hit&&o.pickedMesh&&o.pickedPoint?o.pickedPoint:null},t.prototype._updateDragPlanePosition=function(t,i){this._pointA.copyFrom(i),this._options.dragAxis?(this.useObjectOrienationForDragging?e.Vector3.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),this._pointA.addToRef(this._localAxis,this._pointB),t.origin.subtractToRef(this._pointA,this._pointC),this._pointA.addToRef(this._pointC.normalize(),this._pointC),this._pointB.subtractToRef(this._pointA,this._lineA),this._pointC.subtractToRef(this._pointA,this._lineB),e.Vector3.CrossToRef(this._lineA,this._lineB,this._lookAt),e.Vector3.CrossToRef(this._lineA,this._lookAt,this._lookAt),this._lookAt.normalize(),this._dragPlane.position.copyFrom(this._pointA),this._pointA.subtractToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrienationForDragging?e.Vector3.TransformCoordinatesToRef(this._options.dragPlaneNormal,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.subtractToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(t.origin)),this._dragPlane.computeWorldMatrix(!0)},t.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},t._AnyMouseID=-2,t}();e.PointerDragBehavior=t}(s||(s={})),function(e){var t=function(){function t(){this._startDistance=0,this._initialScale=new e.Vector3(0,0,0),this._targetScale=new e.Vector3(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new e.PointerDragBehavior({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new e.PointerDragBehavior({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(t.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},t.prototype.attach=function(e){var t=this;this._ownerNode=e,this._dragBehaviorA.onDragStartObservable.add((function(i){t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging&&(t._dragBehaviorA.currentDraggingPointerID==t._dragBehaviorB.currentDraggingPointerID?t._dragBehaviorA.releaseDrag():(t._initialScale.copyFrom(e.scaling),t._startDistance=t._getCurrentDistance()))})),this._dragBehaviorB.onDragStartObservable.add((function(i){t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging&&(t._dragBehaviorA.currentDraggingPointerID==t._dragBehaviorB.currentDraggingPointerID?t._dragBehaviorB.releaseDrag():(t._initialScale.copyFrom(e.scaling),t._startDistance=t._getCurrentDistance()))})),[this._dragBehaviorA,this._dragBehaviorB].forEach((function(e){e.onDragObservable.add((function(){if(t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging){var e=t._getCurrentDistance()/t._startDistance;t._initialScale.scaleToRef(e,t._targetScale)}}))})),e.addBehavior(this._dragBehaviorA),e.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=e.getScene().onBeforeRenderObservable.add((function(){if(t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging){var i=t._targetScale.subtract(e.scaling).scaleInPlace(.1);i.length()>.01&&e.scaling.addInPlace(i)}}))},t.prototype.detach=function(){var e=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach((function(t){t.onDragStartObservable.clear(),t.onDragObservable.clear(),e._ownerNode.removeBehavior(t)}))},t}();e.MultiPointerScaleBehavior=t}(s||(s={})),function(e){var t=function(){function t(){this._sceneRenderObserver=null,this._targetPosition=new e.Vector3(0,0,0),this._moving=!1,this._startingOrientation=new e.Quaternion,this.zDragFactor=3,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new e.Observable,this.onDragEndObservable=new e.Observable}return Object.defineProperty(t.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.attach=function(i){var r=this;this._ownerNode=i,this._scene=this._ownerNode.getScene(),t._virtualScene||(t._virtualScene=new e.Scene(this._scene.getEngine()),t._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var n=null,a=new e.Vector3(0,0,0);this._virtualOriginMesh=new e.AbstractMesh("",t._virtualScene),this._virtualOriginMesh.rotationQuaternion=new e.Quaternion,this._virtualDragMesh=new e.AbstractMesh("",t._virtualScene),this._virtualDragMesh.rotationQuaternion=new e.Quaternion;var o=null;this._pointerObserver=this._scene.onPointerObservable.add((function(t,i){if(t.type==e.PointerEventTypes.POINTERDOWN){if(!r.dragging&&t.pickInfo&&t.pickInfo.hit&&t.pickInfo.pickedMesh&&t.pickInfo.ray&&(h=t.pickInfo.pickedMesh,r._ownerNode==h||h.isDescendantOf(r._ownerNode))){r._scene.activeCamera&&r._scene.activeCamera.cameraRigMode==e.Camera.RIG_MODE_NONE&&t.pickInfo.ray.origin.copyFrom(r._scene.activeCamera.position),n=r._ownerNode,e.BoundingBoxGizmo._RemoveAndStorePivotPoint(n),a.copyFrom(t.pickInfo.ray.origin),r._virtualOriginMesh.position.copyFrom(t.pickInfo.ray.origin),r._virtualOriginMesh.lookAt(t.pickInfo.ray.origin.subtract(t.pickInfo.ray.direction)),r._virtualOriginMesh.removeChild(r._virtualDragMesh),n.computeWorldMatrix(),r._virtualDragMesh.position.copyFrom(n.absolutePosition),n.rotationQuaternion||(n.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(n.rotation.y,n.rotation.x,n.rotation.z));var s=n.__uv$setSource(__uv).__uv$parent;n.setParent(null),r._virtualDragMesh.rotationQuaternion.copyFrom(n.rotationQuaternion),n.setParent(s),r._virtualOriginMesh.addChild(r._virtualDragMesh),r._targetPosition.copyFrom(r._virtualDragMesh.absolutePosition),r.dragging=!0,r.currentDraggingPointerID=t.event.pointerId,r.detachCameraControls&&r._scene.activeCamera&&!r._scene.activeCamera.leftCamera&&(r._scene.activeCamera.inputs.attachedElement?(o=r._scene.activeCamera.inputs.attachedElement,r._scene.activeCamera.detachControl(r._scene.activeCamera.inputs.attachedElement)):o=null),e.BoundingBoxGizmo._RestorePivotPoint(n),r.onDragStartObservable.notifyObservers({})}}else if(t.type==e.PointerEventTypes.POINTERUP)r.currentDraggingPointerID==t.event.pointerId&&(r.dragging=!1,r._moving=!1,r.currentDraggingPointerID=-1,n=null,r._virtualOriginMesh.removeChild(r._virtualDragMesh),r.detachCameraControls&&o&&r._scene.activeCamera&&!r._scene.activeCamera.leftCamera&&r._scene.activeCamera.attachControl(o,!0),r.onDragEndObservable.notifyObservers({}));else if(t.type==e.PointerEventTypes.POINTERMOVE&&r.currentDraggingPointerID==t.event.pointerId&&r.dragging&&t.pickInfo&&t.pickInfo.ray&&n){var l=r.zDragFactor;r._scene.activeCamera&&r._scene.activeCamera.cameraRigMode==e.Camera.RIG_MODE_NONE&&(t.pickInfo.ray.origin.copyFrom(r._scene.activeCamera.position),l=0);var c=t.pickInfo.ray.origin.subtract(a);a.copyFrom(t.pickInfo.ray.origin);var u=-e.Vector3.Dot(c,t.pickInfo.ray.direction);r._virtualOriginMesh.addChild(r._virtualDragMesh),r._virtualDragMesh.position.z-=r._virtualDragMesh.position.z<1?u*r.zDragFactor:u*l*r._virtualDragMesh.position.z,r._virtualDragMesh.position.z<0&&(r._virtualDragMesh.position.z=0),r._virtualOriginMesh.position.copyFrom(t.pickInfo.ray.origin),r._virtualOriginMesh.lookAt(t.pickInfo.ray.origin.subtract(t.pickInfo.ray.direction)),r._virtualOriginMesh.removeChild(r._virtualDragMesh),r._targetPosition.copyFrom(r._virtualDragMesh.absolutePosition),n.__uv$setSource(__uv).__uv$parent&&e.Vector3.TransformCoordinatesToRef(r._targetPosition,e.Matrix.Invert(n.__uv$setSource(__uv).__uv$parent.getWorldMatrix()),r._targetPosition),r._moving||r._startingOrientation.copyFrom(r._virtualDragMesh.rotationQuaternion),r._moving=!0}var h}));var s=new e.Quaternion;this._sceneRenderObserver=i.getScene().onBeforeRenderObservable.add((function(){if(r.dragging&&r._moving&&n){e.BoundingBoxGizmo._RemoveAndStorePivotPoint(n),n.position.addInPlace(r._targetPosition.subtract(n.position).scale(r.dragDeltaRatio)),s.copyFrom(r._startingOrientation),s.x=-s.x,s.y=-s.y,s.z=-s.z,r._virtualDragMesh.rotationQuaternion.multiplyToRef(s,s),e.Quaternion.RotationYawPitchRollToRef(s.toEulerAngles("xyz").y,0,0,s),s.multiplyToRef(r._startingOrientation,s);var t=n.__uv$setSource(__uv).__uv$parent;n.setParent(null),e.Quaternion.SlerpToRef(n.rotationQuaternion,s,r.dragDeltaRatio,n.rotationQuaternion),n.setParent(t),e.BoundingBoxGizmo._RestorePivotPoint(n)}}))},t.prototype.detach=function(){this._scene&&this._scene.onPointerObservable.remove(this._pointerObserver),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragStartObservable.clear()},t}();e.SixDofDragBehavior=t}(s||(s={})),function(e){var t=function(t,i,r,n){void 0===i&&(i=new e.Vector3),void 0===r&&(r=0),void 0===n&&(n=!1),this.direction=t,this.rotatedDirection=i,this.diff=r,this.ignore=n},i=function(){function i(i){this.ui=i,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new t(e.Vector3.Up()),new t(e.Vector3.Down()),new t(e.Vector3.Left()),new t(e.Vector3.Right()),new t(e.Vector3.Forward()),new t(e.Vector3.Forward().scaleInPlace(-1))],this._tmpMatrix=new e.Matrix,this._tmpVector=new e.Vector3,this._zeroVector=e.Vector3.Zero(),this._lookAtTmpMatrix=new e.Matrix}return i.prototype.init=function(){},i.prototype._closestFace=function(t){var i=this;return this._faceVectors.forEach((function(r){i._target.rotationQuaternion||(i._target.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(i._target.rotation.y,i._target.rotation.x,i._target.rotation.z)),i._target.rotationQuaternion.toRotationMatrix(i._tmpMatrix),e.Vector3.TransformCoordinatesToRef(r.direction,i._tmpMatrix,r.rotatedDirection),r.diff=e.Vector3.GetAngleBetweenVectors(r.rotatedDirection,t,e.Vector3.Cross(r.rotatedDirection,t))})),this._faceVectors.reduce((function(e,t){return e.ignore?t:t.ignore||e.diff<t.diff?e:t}),this._faceVectors[__uv.$wrap((0))])},i.prototype._lookAtToRef=function(t,i,r){void 0===i&&(i=new e.Vector3(0,1,0)),e.Matrix.LookAtLHToRef(this._zeroVector,t,i,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),e.Quaternion.FromRotationMatrixToRef(this._lookAtTmpMatrix,r)},i.prototype.attach=function(t){var i=this;this._target=t,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add((function(){if(i._scene.activeCamera){var r=i._scene.activeCamera.position;i._scene.activeCamera.devicePosition&&(r=i._scene.activeCamera.devicePosition);var n=i._closestFace(r.subtract(t.position));i._scene.activeCamera.leftCamera?i._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(i._tmpMatrix):i._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(i._tmpMatrix),e.Vector3.TransformCoordinatesToRef(e.Vector3.Up(),i._tmpMatrix,i._tmpVector),i._faceVectors.forEach((function(e){n.direction.x&&e.direction.x&&(e.ignore=!0),n.direction.y&&e.direction.y&&(e.ignore=!0),n.direction.z&&e.direction.z&&(e.ignore=!0)}));var a=i._closestFace(i._tmpVector);i._faceVectors.forEach((function(e){e.ignore=!1})),i.ui.position.copyFrom(t.position),n.direction.x&&(n.rotatedDirection.scaleToRef(t.scaling.x/2+i.distanceAwayFromFace,i._tmpVector),i.ui.position.addInPlace(i._tmpVector)),n.direction.y&&(n.rotatedDirection.scaleToRef(t.scaling.y/2+i.distanceAwayFromFace,i._tmpVector),i.ui.position.addInPlace(i._tmpVector)),n.direction.z&&(n.rotatedDirection.scaleToRef(t.scaling.z/2+i.distanceAwayFromFace,i._tmpVector),i.ui.position.addInPlace(i._tmpVector)),i.ui.rotationQuaternion||(i.ui.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(i.ui.rotation.y,i.ui.rotation.x,i.ui.rotation.z)),n.rotatedDirection.scaleToRef(-1,i._tmpVector),i._lookAtToRef(i._tmpVector,a.rotatedDirection,i.ui.rotationQuaternion),a.direction.x&&i.ui.up.scaleToRef(i.distanceAwayFromBottomOfFace-t.scaling.x/2,i._tmpVector),a.direction.y&&i.ui.up.scaleToRef(i.distanceAwayFromBottomOfFace-t.scaling.y/2,i._tmpVector),a.direction.z&&i.ui.up.scaleToRef(i.distanceAwayFromBottomOfFace-t.scaling.z/2,i._tmpVector),i.ui.position.addInPlace(i._tmpVector)}}))},i.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},i}();e.AttachToBoxBehavior=i}(s||(s={})),function(e){var t=function(){function e(){var e=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(e._ownerNode){if(e._hoverValue+=e._hovered?e._millisecondsPerFrame:-e._millisecondsPerFrame,e._setAllVisibility(e._ownerNode,(e._hoverValue-e.delay)/e.fadeInTime),e._ownerNode.visibility>1)return e._setAllVisibility(e._ownerNode,1),void(e._hoverValue=e.fadeInTime+e.delay);if(e._ownerNode.visibility<0&&(e._setAllVisibility(e._ownerNode,0),e._hoverValue<0))return void(e._hoverValue=0);setTimeout(e._update,e._millisecondsPerFrame)}}}return Object.defineProperty(e.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e){this._ownerNode=e,this._setAllVisibility(this._ownerNode,0)},e.prototype.detach=function(){this._ownerNode=null},e.prototype.fadeIn=function(e){this._hovered=e,this._update()},e.prototype._setAllVisibility=function(e,t){var i=this;e.visibility=t,e.getChildMeshes().forEach((function(e){i._setAllVisibility(e,t)}))},e}();e.FadeInOutBehavior=t}(s||(s={})),function(e){var t=function(){function t(t){void 0===t&&(t=e.UtilityLayerRenderer.DefaultUtilityLayer);var i=this;this.gizmoLayer=t,this.scaleRatio=1,this._tmpMatrix=new e.Matrix,this._customMeshSet=!1,this.updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this._updateScale=!0,this._interactionsEnabled=!0,this._tempVector=new e.Vector3,this._rootMesh=new e.Mesh("gizmoRootNode",t.utilityLayerScene),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add((function(){i._update()})),this.attachedMesh=null}return Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(e){this._attachedMesh=e,this._rootMesh.setEnabled(!!e),this._attachedMeshChanged(e)},enumerable:!0,configurable:!0}),t.prototype.setCustomMesh=function(e){if(e.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach((function(e){e.dispose()})),e.__uv$setSource(__uv).__uv$parent=this._rootMesh,this._customMeshSet=!0},t.prototype._attachedMeshChanged=function(e){},t.prototype._update=function(){if(this.attachedMesh&&(this.updateGizmoRotationToMatchAttachedMesh?(this._rootMesh.rotationQuaternion||(this._rootMesh.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this._rootMesh.rotation.y,this._rootMesh.rotation.x,this._rootMesh.rotation.z)),this._tempVector.copyFrom(this.attachedMesh.scaling),this.attachedMesh.scaling.x<0&&(this.attachedMesh.scaling.x*=-1),this.attachedMesh.scaling.y<0&&(this.attachedMesh.scaling.y*=-1),this.attachedMesh.scaling.z<0&&(this.attachedMesh.scaling.z*=-1),this.attachedMesh.computeWorldMatrix().getRotationMatrixToRef(this._tmpMatrix),this.attachedMesh.scaling.copyFrom(this._tempVector),this.attachedMesh.computeWorldMatrix(),e.Quaternion.FromRotationMatrixToRef(this._tmpMatrix,this._rootMesh.rotationQuaternion)):this._rootMesh.rotationQuaternion&&this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateGizmoPositionToMatchAttachedMesh&&this._rootMesh.position.copyFrom(this.attachedMesh.absolutePosition),this._updateScale&&this.gizmoLayer.utilityLayerScene.activeCamera&&this.attachedMesh)){var t=this.gizmoLayer.utilityLayerScene.activeCamera.position;this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition&&(t=this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition),this._rootMesh.position.subtractToRef(t,this._tempVector);var i=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(i,i,i)}},t.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},t}();e.Gizmo=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n){void 0===r&&(r=e.Color3.Gray()),void 0===n&&(n=e.UtilityLayerRenderer.DefaultUtilityLayer);var a=t.call(this,n)||this;a._pointerObserver=null,a.snapDistance=0,a.onSnapObservable=new e.Observable;var o=new e.StandardMaterial("",n.utilityLayerScene);o.disableLighting=!0,o.emissiveColor=r;var s=new e.StandardMaterial("",n.utilityLayerScene);s.disableLighting=!0,s.emissiveColor=r.add(new e.Color3(.3,.3,.3));var l=new e.AbstractMesh("",n.utilityLayerScene),c=e.MeshBuilder.CreateCylinder("yPosMesh",{diameterTop:0,height:1.5,diameterBottom:.75,tessellation:96},n.utilityLayerScene),u=e.MeshBuilder.CreateLines("yPosMesh",{points:[new e.Vector3(0,0,0),new e.Vector3(0,1.1,0)]},n.utilityLayerScene);u.color=o.emissiveColor,l.addChild(c),l.addChild(u),c.scaling.scaleInPlace(.05),c.material=o,c.rotation.x=Math.PI/2,c.position.z+=.3,u.scaling.scaleInPlace(.26),u.rotation.x=Math.PI/2,u.material=o,l.lookAt(a._rootMesh.position.subtract(i)),l.scaling.scaleInPlace(1/3),a._rootMesh.addChild(l);var h=0,d=new e.Vector3,p={snapDistance:0};a.dragBehavior=new e.PointerDragBehavior({dragAxis:i}),a.dragBehavior.moveAttached=!1,a._rootMesh.addBehavior(a.dragBehavior);var m=new e.Vector3,_=new e.Matrix;return a.dragBehavior.onDragObservable.add((function(t){if(a.attachedMesh)if(a.attachedMesh.__uv$setSource(__uv).__uv$parent?(a.attachedMesh.__uv$setSource(__uv).__uv$parent.computeWorldMatrix().invertToRef(_),_.setTranslationFromFloats(0,0,0),e.Vector3.TransformCoordinatesToRef(t.delta,_,m)):m.copyFrom(t.delta),0==a.snapDistance)a.attachedMesh.position.addInPlace(m);else if(h+=t.dragDistance,Math.abs(h)>a.snapDistance){var i=Math.floor(Math.abs(h)/a.snapDistance);h%=a.snapDistance,m.normalizeToRef(d),d.scaleInPlace(a.snapDistance*i),a.attachedMesh.position.addInPlace(d),p.snapDistance=a.snapDistance*i,a.onSnapObservable.notifyObservers(p)}})),a._pointerObserver=n.utilityLayerScene.onPointerObservable.add((function(e,t){if(!a._customMeshSet){var i=e.pickInfo&&-1!=a._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?s:o;a._rootMesh.getChildMeshes().forEach((function(e){e.material=i,e.color&&(e.color=i.emissiveColor)}))}})),a}return a(i,t),i.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},i.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),t.prototype.dispose.call(this)},i}(e.Gizmo);e.AxisDragGizmo=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n){void 0===r&&(r=e.Color3.Gray()),void 0===n&&(n=e.UtilityLayerRenderer.DefaultUtilityLayer);var a=t.call(this,n)||this;a._pointerObserver=null,a.snapDistance=0,a.onSnapObservable=new e.Observable,a.uniformScaling=!1,a._coloredMaterial=new e.StandardMaterial("",n.utilityLayerScene),a._coloredMaterial.disableLighting=!0,a._coloredMaterial.emissiveColor=r;var o=new e.StandardMaterial("",n.utilityLayerScene);o.disableLighting=!0,o.emissiveColor=r.add(new e.Color3(.3,.3,.3));var s=new e.AbstractMesh("",n.utilityLayerScene),l=e.MeshBuilder.CreateBox("yPosMesh",{size:.4},n.utilityLayerScene),c=e.MeshBuilder.CreateLines("yPosMesh",{points:[new e.Vector3(0,0,0),new e.Vector3(0,1.1,0)]},n.utilityLayerScene);c.color=a._coloredMaterial.emissiveColor,s.addChild(l),s.addChild(c),l.scaling.scaleInPlace(.1),l.material=a._coloredMaterial,l.rotation.x=Math.PI/2,l.position.z+=.3,c.scaling.scaleInPlace(.26),c.rotation.x=Math.PI/2,c.material=a._coloredMaterial,s.lookAt(a._rootMesh.position.subtract(i)),a._rootMesh.addChild(s),s.scaling.scaleInPlace(1/3),a.dragBehavior=new e.PointerDragBehavior({dragAxis:i}),a.dragBehavior.moveAttached=!1,a._rootMesh.addBehavior(a.dragBehavior);var u=0,h=new e.Vector3,d={snapDistance:0};return a.dragBehavior.onDragObservable.add((function(e){if(a.attachedMesh){var t=!1,r=0;a.uniformScaling?(a.attachedMesh.scaling.normalizeToRef(h),h.y<0&&h.scaleInPlace(-1)):h.copyFrom(i),0==a.snapDistance?h.scaleToRef(e.dragDistance,h):(u+=e.dragDistance,Math.abs(u)>a.snapDistance?(r=Math.floor(u/a.snapDistance),u%=a.snapDistance,h.scaleToRef(a.snapDistance*r,h),t=!0):h.scaleInPlace(0)),a.attachedMesh.scaling.addInPlace(h),t&&(d.snapDistance=a.snapDistance*r,a.onSnapObservable.notifyObservers(d))}})),a._pointerObserver=n.utilityLayerScene.onPointerObservable.add((function(e,t){if(!a._customMeshSet){var i=e.pickInfo&&-1!=a._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?o:a._coloredMaterial;a._rootMesh.getChildMeshes().forEach((function(e){e.material=i,e.color&&(e.color=i.emissiveColor)}))}})),a}return a(i,t),i.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},i.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),t.prototype.dispose.call(this)},i.prototype.setCustomMesh=function(e,i){var r=this;void 0===i&&(i=!1),t.prototype.setCustomMesh.call(this,e),i&&(this._rootMesh.getChildMeshes().forEach((function(e){e.material=r._coloredMaterial,e.color&&(e.color=r._coloredMaterial.emissiveColor)})),this._customMeshSet=!1)},i}(e.Gizmo);e.AxisScaleGizmo=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){void 0===r&&(r=e.Color3.Gray()),void 0===n&&(n=e.UtilityLayerRenderer.DefaultUtilityLayer),void 0===a&&(a=32);var o=t.call(this,n)||this;o._pointerObserver=null,o.snapDistance=0,o.onSnapObservable=new e.Observable;var s=new e.StandardMaterial("",n.utilityLayerScene);s.disableLighting=!0,s.emissiveColor=r;var l=new e.StandardMaterial("",n.utilityLayerScene);l.disableLighting=!0,l.emissiveColor=r.add(new e.Color3(.3,.3,.3));for(var c=new e.AbstractMesh("",n.utilityLayerScene),u=new Array,h=0;h<a;h++){var d=2*Math.PI*(h/(a-1));u.push(new e.Vector3(.8*Math.sin(d),0,.8*Math.cos(d)))}var p=e.Mesh.CreateLines("",u,n.utilityLayerScene);p.color=s.emissiveColor,p.scaling.scaleInPlace(.26),p.material=s,p.rotation.x=Math.PI/2,c.addChild(p),c.lookAt(o._rootMesh.position.subtract(i)),o._rootMesh.addChild(c),c.scaling.scaleInPlace(1/3),o.dragBehavior=new e.PointerDragBehavior({dragPlaneNormal:i}),o.dragBehavior.moveAttached=!1,o.dragBehavior.maxDragAngle=9*Math.PI/20,o.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,o._rootMesh.addBehavior(o.dragBehavior);var m=new e.Vector3;o.dragBehavior.onDragStartObservable.add((function(e){o.attachedMesh&&m.copyFrom(e.dragPlanePoint)}));var _=new e.Matrix,f=new e.Vector3,g=new e.Vector3,y={snapDistance:0},v=0,b=new e.Matrix,x=new e.Vector3,S=new e.Quaternion;return o.dragBehavior.onDragObservable.add((function(t){if(o.attachedMesh){o.attachedMesh.rotationQuaternion||(o.attachedMesh.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(o.attachedMesh.rotation.y,o.attachedMesh.rotation.x,o.attachedMesh.rotation.z));var r=t.dragPlanePoint.subtract(o.attachedMesh.absolutePosition).normalize(),a=m.subtract(o.attachedMesh.absolutePosition).normalize(),s=e.Vector3.Cross(r,a),l=e.Vector3.Dot(r,a),c=Math.atan2(s.length(),l);if(f.copyFrom(i),g.copyFrom(i),o.updateGizmoRotationToMatchAttachedMesh&&(o.attachedMesh.rotationQuaternion.toRotationMatrix(_),g=e.Vector3.TransformCoordinates(f,_)),n.utilityLayerScene.activeCamera){var u=n.utilityLayerScene.activeCamera.position.subtract(o.attachedMesh.position);e.Vector3.Dot(u,g)>0&&(f.scaleInPlace(-1),g.scaleInPlace(-1))}e.Vector3.Dot(g,s)>0&&(c=-c);var h=!1;if(0!=o.snapDistance)if(v+=c,Math.abs(v)>o.snapDistance){var d=Math.floor(v/o.snapDistance);v%=o.snapDistance,c=o.snapDistance*d,h=!0}else c=0;b.reset(),o.attachedMesh.__uv$setSource(__uv).__uv$parent&&(o.attachedMesh.__uv$setSource(__uv).__uv$parent.computeWorldMatrix().invertToRef(b),b.getRotationMatrixToRef(b),e.Vector3.TransformCoordinatesToRef(f,b,f));var p=Math.sin(c/2);S.set(f.x*p,f.y*p,f.z*p,Math.cos(c/2)),b.determinant()>0&&(S.toEulerAnglesToRef(x),e.Quaternion.RotationYawPitchRollToRef(x.y,-x.x,-x.z,S)),o.updateGizmoRotationToMatchAttachedMesh?o.attachedMesh.rotationQuaternion.multiplyToRef(S,o.attachedMesh.rotationQuaternion):S.multiplyToRef(o.attachedMesh.rotationQuaternion,o.attachedMesh.rotationQuaternion),m.copyFrom(t.dragPlanePoint),h&&(y.snapDistance=c,o.onSnapObservable.notifyObservers(y))}})),o._pointerObserver=n.utilityLayerScene.onPointerObservable.add((function(e,t){if(!o._customMeshSet){var i=e.pickInfo&&-1!=o._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?l:s;o._rootMesh.getChildMeshes().forEach((function(e){e.material=i,e.color&&(e.color=i.emissiveColor)}))}})),o}return a(i,t),i.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},i.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),t.prototype.dispose.call(this)},i}(e.Gizmo);e.PlaneRotationGizmo=t}(s||(s={})),function(e){var t=function(t){function i(i){void 0===i&&(i=e.UtilityLayerRenderer.DefaultUtilityLayer);var r=t.call(this,i)||this;return r.onDragStartObservable=new e.Observable,r.onDragEndObservable=new e.Observable,r.xGizmo=new e.AxisDragGizmo(new e.Vector3(1,0,0),e.Color3.Red().scale(.5),i),r.yGizmo=new e.AxisDragGizmo(new e.Vector3(0,1,0),e.Color3.Green().scale(.5),i),r.zGizmo=new e.AxisDragGizmo(new e.Vector3(0,0,1),e.Color3.Blue().scale(.5),i),[r.xGizmo,r.yGizmo,r.zGizmo].forEach((function(e){e.dragBehavior.onDragStartObservable.add((function(){r.onDragStartObservable.notifyObservers({})})),e.dragBehavior.onDragEndObservable.add((function(){r.onDragEndObservable.notifyObservers({})}))})),r.attachedMesh=null,r}return a(i,t),Object.defineProperty(i.prototype,"attachedMesh",{set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},i.prototype.setCustomMesh=function(t){e.Tools.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},i}(e.Gizmo);e.PositionGizmo=t}(s||(s={})),function(e){var t=function(t){function i(i,r){void 0===i&&(i=e.UtilityLayerRenderer.DefaultUtilityLayer),void 0===r&&(r=32);var n=t.call(this,i)||this;return n.onDragStartObservable=new e.Observable,n.onDragEndObservable=new e.Observable,n.xGizmo=new e.PlaneRotationGizmo(new e.Vector3(1,0,0),e.Color3.Red().scale(.5),i,r),n.yGizmo=new e.PlaneRotationGizmo(new e.Vector3(0,1,0),e.Color3.Green().scale(.5),i,r),n.zGizmo=new e.PlaneRotationGizmo(new e.Vector3(0,0,1),e.Color3.Blue().scale(.5),i,r),[n.xGizmo,n.yGizmo,n.zGizmo].forEach((function(e){e.dragBehavior.onDragStartObservable.add((function(){n.onDragStartObservable.notifyObservers({})})),e.dragBehavior.onDragEndObservable.add((function(){n.onDragEndObservable.notifyObservers({})}))})),n.attachedMesh=null,n}return a(i,t),Object.defineProperty(i.prototype,"attachedMesh",{set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},i.prototype.setCustomMesh=function(t){e.Tools.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},i}(e.Gizmo);e.RotationGizmo=t}(s||(s={})),function(e){var t=function(t){function i(i){void 0===i&&(i=e.UtilityLayerRenderer.DefaultUtilityLayer);var r=t.call(this,i)||this;r.onDragStartObservable=new e.Observable,r.onDragEndObservable=new e.Observable,r.xGizmo=new e.AxisScaleGizmo(new e.Vector3(1,0,0),e.Color3.Red().scale(.5),i),r.yGizmo=new e.AxisScaleGizmo(new e.Vector3(0,1,0),e.Color3.Green().scale(.5),i),r.zGizmo=new e.AxisScaleGizmo(new e.Vector3(0,0,1),e.Color3.Blue().scale(.5),i),r.uniformScaleGizmo=new e.AxisScaleGizmo(new e.Vector3(0,1,0),e.Color3.Yellow().scale(.5),i),r.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,r.uniformScaleGizmo.uniformScaling=!0;var n=e.Mesh.CreatePolyhedron("",{type:1},r.uniformScaleGizmo.gizmoLayer.utilityLayerScene);n.scaling.scaleInPlace(.02),n.visibility=0;var a=e.Mesh.CreatePolyhedron("",{type:1},r.uniformScaleGizmo.gizmoLayer.utilityLayerScene);return a.scaling.scaleInPlace(.007),n.addChild(a),r.uniformScaleGizmo.setCustomMesh(n,!0),[r.xGizmo,r.yGizmo,r.zGizmo,r.uniformScaleGizmo].forEach((function(e){e.dragBehavior.onDragStartObservable.add((function(){r.onDragStartObservable.notifyObservers({})})),e.dragBehavior.onDragEndObservable.add((function(){r.onDragEndObservable.notifyObservers({})}))})),r.attachedMesh=null,r}return a(i,t),Object.defineProperty(i.prototype,"attachedMesh",{set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e,this.uniformScaleGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(t){t||e.Tools.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported."),this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=t,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=t,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e,this.uniformScaleGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e,this.uniformScaleGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.uniformScaleGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},i}(e.Gizmo);e.ScaleGizmo=t}(s||(s={})),function(e){var t=function(t){function i(r,n){void 0===r&&(r=e.Color3.Gray()),void 0===n&&(n=e.UtilityLayerRenderer.DefaultKeepDepthUtilityLayer);var a=t.call(this,n)||this;a._boundingDimensions=new e.Vector3(1,1,1),a._renderObserver=null,a._pointerObserver=null,a._scaleDragSpeed=.2,a._tmpQuaternion=new e.Quaternion,a._tmpVector=new e.Vector3(0,0,0),a._tmpRotationMatrix=new e.Matrix,a.ignoreChildren=!1,a.includeChildPredicate=null,a.rotationSphereSize=.1,a.scaleBoxSize=.1,a.fixedDragMeshScreenSize=!1,a.fixedDragMeshScreenSizeDistanceFactor=10,a.onDragStartObservable=new e.Observable,a.onScaleBoxDragObservable=new e.Observable,a.onScaleBoxDragEndObservable=new e.Observable,a.onRotationSphereDragObservable=new e.Observable,a.onRotationSphereDragEndObservable=new e.Observable,a.scalePivot=null,a._existingMeshScale=new e.Vector3,a._updateScale=!1,a._anchorMesh=new e.AbstractMesh("anchor",n.utilityLayerScene);var o=new e.StandardMaterial("",n.utilityLayerScene);o.disableLighting=!0,o.emissiveColor=r;var s=new e.StandardMaterial("",n.utilityLayerScene);s.disableLighting=!0,s.emissiveColor=r.clone().add(new e.Color3(.3,.3,.3)),a._lineBoundingBox=new e.AbstractMesh("",n.utilityLayerScene),a._lineBoundingBox.rotationQuaternion=new e.Quaternion;var l=[];l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(0,0,0),new e.Vector3(a._boundingDimensions.x,0,0)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(0,0,0),new e.Vector3(0,a._boundingDimensions.y,0)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(0,0,0),new e.Vector3(0,0,a._boundingDimensions.z)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(a._boundingDimensions.x,0,0),new e.Vector3(a._boundingDimensions.x,a._boundingDimensions.y,0)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(a._boundingDimensions.x,0,0),new e.Vector3(a._boundingDimensions.x,0,a._boundingDimensions.z)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(0,a._boundingDimensions.y,0),new e.Vector3(a._boundingDimensions.x,a._boundingDimensions.y,0)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(0,a._boundingDimensions.y,0),new e.Vector3(0,a._boundingDimensions.y,a._boundingDimensions.z)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(0,0,a._boundingDimensions.z),new e.Vector3(a._boundingDimensions.x,0,a._boundingDimensions.z)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(0,0,a._boundingDimensions.z),new e.Vector3(0,a._boundingDimensions.y,a._boundingDimensions.z)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(a._boundingDimensions.x,a._boundingDimensions.y,a._boundingDimensions.z),new e.Vector3(0,a._boundingDimensions.y,a._boundingDimensions.z)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(a._boundingDimensions.x,a._boundingDimensions.y,a._boundingDimensions.z),new e.Vector3(a._boundingDimensions.x,0,a._boundingDimensions.z)]},n.utilityLayerScene)),l.push(e.MeshBuilder.CreateLines("lines",{points:[new e.Vector3(a._boundingDimensions.x,a._boundingDimensions.y,a._boundingDimensions.z),new e.Vector3(a._boundingDimensions.x,a._boundingDimensions.y,0)]},n.utilityLayerScene)),l.forEach((function(t){t.color=r,t.position.addInPlace(new e.Vector3(-a._boundingDimensions.x/2,-a._boundingDimensions.y/2,-a._boundingDimensions.z/2)),t.isPickable=!1,a._lineBoundingBox.addChild(t)})),a._rootMesh.addChild(a._lineBoundingBox),a._rotateSpheresParent=new e.AbstractMesh("",n.utilityLayerScene),a._rotateSpheresParent.rotationQuaternion=new e.Quaternion;for(var c=function(t){var r=e.MeshBuilder.CreateSphere("",{diameter:1},n.utilityLayerScene);r.rotationQuaternion=new e.Quaternion,r.material=o,(m=new e.PointerDragBehavior({})).moveAttached=!1,m.updateDragPlane=!1,r.addBehavior(m);var s=new e.Vector3(1,0,0),l=0;m.onDragStartObservable.add((function(e){s.copyFrom(r.forward),l=0})),m.onDragObservable.add((function(r){if(a.onRotationSphereDragObservable.notifyObservers({}),a.attachedMesh){i._RemoveAndStorePivotPoint(a.attachedMesh);var n=s,o=r.dragPlaneNormal.scale(e.Vector3.Dot(r.dragPlaneNormal,n)),c=n.subtract(o).normalizeToNew(),u=-e.Vector3.Dot(c,r.delta);u=u/a._boundingDimensions.length()*a._anchorMesh.scaling.length(),a.attachedMesh.rotationQuaternion||(a.attachedMesh.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(a.attachedMesh.rotation.y,a.attachedMesh.rotation.x,a.attachedMesh.rotation.z)),a._anchorMesh.rotationQuaternion||(a._anchorMesh.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(a._anchorMesh.rotation.y,a._anchorMesh.rotation.x,a._anchorMesh.rotation.z)),l+=u,Math.abs(l)<=2*Math.PI&&(t>=8?e.Quaternion.RotationYawPitchRollToRef(0,0,u,a._tmpQuaternion):t>=4?e.Quaternion.RotationYawPitchRollToRef(u,0,0,a._tmpQuaternion):e.Quaternion.RotationYawPitchRollToRef(0,u,0,a._tmpQuaternion),a._anchorMesh.addChild(a.attachedMesh),a._anchorMesh.rotationQuaternion.multiplyToRef(a._tmpQuaternion,a._anchorMesh.rotationQuaternion),a._anchorMesh.removeChild(a.attachedMesh)),a.updateBoundingBox(),i._RestorePivotPoint(a.attachedMesh)}})),m.onDragStartObservable.add((function(){a.onDragStartObservable.notifyObservers({}),a._selectNode(r)})),m.onDragEndObservable.add((function(){a.onRotationSphereDragEndObservable.notifyObservers({}),a._selectNode(null)})),u._rotateSpheresParent.addChild(r)},u=this,h=0;h<12;h++)c(h);a._rootMesh.addChild(a._rotateSpheresParent),a._scaleBoxesParent=new e.AbstractMesh("",n.utilityLayerScene),a._scaleBoxesParent.rotationQuaternion=new e.Quaternion;for(var d=0;d<2;d++)for(var p=0;p<2;p++)for(var m,_=function(){var t=e.MeshBuilder.CreateBox("",{size:1},n.utilityLayerScene);t.material=o;var r=new e.Vector3(0==d?-1:1,0==p?-1:1,0==g?-1:1);(m=new e.PointerDragBehavior({dragAxis:r})).moveAttached=!1,t.addBehavior(m),m.onDragObservable.add((function(r){if(a.onScaleBoxDragObservable.notifyObservers({}),a.attachedMesh){i._RemoveAndStorePivotPoint(a.attachedMesh);var n=r.dragDistance/a._boundingDimensions.length()*a._anchorMesh.scaling.length(),o=new e.Vector3(n,n,n);o.scaleInPlace(a._scaleDragSpeed),a.updateBoundingBox(),a.scalePivot?(a.attachedMesh.getWorldMatrix().getRotationMatrixToRef(a._tmpRotationMatrix),a._boundingDimensions.scaleToRef(.5,a._tmpVector),e.Vector3.TransformCoordinatesToRef(a._tmpVector,a._tmpRotationMatrix,a._tmpVector),a._anchorMesh.position.subtractInPlace(a._tmpVector),a._boundingDimensions.multiplyToRef(a.scalePivot,a._tmpVector),e.Vector3.TransformCoordinatesToRef(a._tmpVector,a._tmpRotationMatrix,a._tmpVector),a._anchorMesh.position.addInPlace(a._tmpVector)):(t.absolutePosition.subtractToRef(a._anchorMesh.position,a._tmpVector),a._anchorMesh.position.subtractInPlace(a._tmpVector)),a._anchorMesh.addChild(a.attachedMesh),a._anchorMesh.scaling.addInPlace(o),(a._anchorMesh.scaling.x<0||a._anchorMesh.scaling.y<0||a._anchorMesh.scaling.z<0)&&a._anchorMesh.scaling.subtractInPlace(o),a._anchorMesh.removeChild(a.attachedMesh),i._RestorePivotPoint(a.attachedMesh)}})),m.onDragStartObservable.add((function(){a.onDragStartObservable.notifyObservers({}),a._selectNode(t)})),m.onDragEndObservable.add((function(){a.onScaleBoxDragEndObservable.notifyObservers({}),a._selectNode(null)})),f._scaleBoxesParent.addChild(t)},f=this,g=0;g<2;g++)_();a._rootMesh.addChild(a._scaleBoxesParent);var y=new Array;return a._pointerObserver=n.utilityLayerScene.onPointerObservable.add((function(e,t){y[__uv.$wrap((e.event.pointerId))]?e.pickInfo&&e.pickInfo.pickedMesh!=y[__uv.$wrap((e.event.pointerId))]&&(y[__uv.$wrap((e.event.pointerId))].material=o,delete y[__uv.$wrap((e.event.pointerId))]):a._rotateSpheresParent.getChildMeshes().concat(a._scaleBoxesParent.getChildMeshes()).forEach((function(t){e.pickInfo&&e.pickInfo.pickedMesh==t&&(y[__uv.$wrap((e.event.pointerId))]=t,t.material=s)}))})),a._renderObserver=a.gizmoLayer.originalScene.onBeforeRenderObservable.add((function(){a.attachedMesh&&!a._existingMeshScale.equals(a.attachedMesh.scaling)&&a.updateBoundingBox()})),a.updateBoundingBox(),a}return a(i,t),i._RemoveAndStorePivotPoint=function(t){t&&0===i._PivotCached&&(t.getPivotPointToRef(i._OldPivotPoint),i._OldPivotPoint.equalsToFloats(0,0,0)||(t.setPivotMatrix(e.Matrix.IdentityReadOnly),i._OldPivotPoint.subtractToRef(t.getPivotPoint(),i._PivotTranslation),i._PivotTmpVector.copyFromFloats(1,1,1),i._PivotTmpVector.subtractInPlace(t.scaling),i._PivotTmpVector.multiplyInPlace(i._PivotTranslation),t.position.addInPlace(i._PivotTmpVector))),i._PivotCached++},i._RestorePivotPoint=function(e){e&&!i._OldPivotPoint.equalsToFloats(0,0,0)&&1===i._PivotCached&&(e.setPivotPoint(i._OldPivotPoint),i._PivotTmpVector.copyFromFloats(1,1,1),i._PivotTmpVector.subtractInPlace(e.scaling),i._PivotTmpVector.multiplyInPlace(i._PivotTranslation),e.position.subtractInPlace(i._PivotTmpVector)),this._PivotCached--},i.prototype._attachedMeshChanged=function(e){e&&(i._RemoveAndStorePivotPoint(e),this._anchorMesh.addChild(e),this._anchorMesh.removeChild(e),i._RestorePivotPoint(e),this.updateBoundingBox())},i.prototype._selectNode=function(e){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach((function(t,i){t.isVisible=!e||t==e}))},i.prototype.updateBoundingBox=function(){if(this.attachedMesh){i._RemoveAndStorePivotPoint(this.attachedMesh),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var t=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);t.max.subtractToRef(t.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2,(t.max.z+t.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector)}for(var r=this._rotateSpheresParent.getChildMeshes(),n=0;n<3;n++)for(var a=0;a<2;a++)for(var o=0;o<2;o++){var s=4*n+2*a+o;if(0==n&&(r[__uv.$wrap((s))].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*a,this._boundingDimensions.z*o),r[__uv.$wrap((s))].position.addInPlace(new e.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),r[__uv.$wrap((s))].lookAt(e.Vector3.Cross(e.Vector3.Right(),r[__uv.$wrap((s))].position.normalizeToNew()).normalizeToNew().add(r[__uv.$wrap((s))].position))),1==n&&(r[__uv.$wrap((s))].position.set(this._boundingDimensions.x*a,this._boundingDimensions.y/2,this._boundingDimensions.z*o),r[__uv.$wrap((s))].position.addInPlace(new e.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),r[__uv.$wrap((s))].lookAt(e.Vector3.Cross(e.Vector3.Up(),r[__uv.$wrap((s))].position.normalizeToNew()).normalizeToNew().add(r[__uv.$wrap((s))].position))),2==n&&(r[__uv.$wrap((s))].position.set(this._boundingDimensions.x*a,this._boundingDimensions.y*o,this._boundingDimensions.z/2),r[__uv.$wrap((s))].position.addInPlace(new e.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),r[__uv.$wrap((s))].lookAt(e.Vector3.Cross(e.Vector3.Forward(),r[__uv.$wrap((s))].position.normalizeToNew()).normalizeToNew().add(r[__uv.$wrap((s))].position))),this.fixedDragMeshScreenSize){this._rootMesh.computeWorldMatrix(),this._rotateSpheresParent.computeWorldMatrix(),r[__uv.$wrap((s))].computeWorldMatrix(),r[__uv.$wrap((s))].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var l=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;r[__uv.$wrap((s))].scaling.set(l,l,l)}else r[__uv.$wrap((s))].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}var c=this._scaleBoxesParent.getChildMeshes();for(n=0;n<2;n++)for(a=0;a<2;a++)for(o=0;o<2;o++){if(c[__uv.$wrap((s=4*n+2*a+o))])if(c[__uv.$wrap((s))].position.set(this._boundingDimensions.x*n,this._boundingDimensions.y*a,this._boundingDimensions.z*o),c[__uv.$wrap((s))].position.addInPlace(new e.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize){this._rootMesh.computeWorldMatrix(),this._scaleBoxesParent.computeWorldMatrix(),c[__uv.$wrap((s))].computeWorldMatrix(),c[__uv.$wrap((s))].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);l=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;c[__uv.$wrap((s))].scaling.set(l,l,l)}else c[__uv.$wrap((s))].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)}this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),i._RestorePivotPoint(this.attachedMesh))},i.prototype.setEnabledRotationAxis=function(e){this._rotateSpheresParent.getChildMeshes().forEach((function(t,i){i<4?t.setEnabled(-1!=e.indexOf("x")):i<8?t.setEnabled(-1!=e.indexOf("y")):t.setEnabled(-1!=e.indexOf("z"))}))},i.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),t.prototype.dispose.call(this)},i.MakeNotPickableAndWrapInBoundingBox=function(t){var i=function(e){e.isPickable=!1,e.getChildMeshes().forEach((function(e){i(e)}))};i(t),t.rotationQuaternion||(t.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(t.rotation.y,t.rotation.x,t.rotation.z));var r=t.position.clone(),n=t.rotationQuaternion.clone();t.rotationQuaternion.set(0,0,0,1),t.position.set(0,0,0);var a=e.MeshBuilder.CreateBox("box",{size:1},t.getScene()),o=t.getHierarchyBoundingVectors();return o.max.subtractToRef(o.min,a.scaling),a.position.set((o.max.x+o.min.x)/2,(o.max.y+o.min.y)/2,(o.max.z+o.min.z)/2),t.addChild(a),t.rotationQuaternion.copyFrom(n),t.position.copyFrom(r),t.removeChild(a),a.addChild(t),a.visibility=0,a},i.prototype.setCustomMesh=function(t){e.Tools.Error("Custom meshes are not supported on this gizmo")},i._PivotCached=0,i._OldPivotPoint=new e.Vector3,i._PivotTranslation=new e.Vector3,i._PivotTmpVector=new e.Vector3,i}(e.Gizmo);e.BoundingBoxGizmo=t}(s||(s={})),function(e){var t=function(){function t(t){var i=this;this.scene=t,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._boundingBoxColor=e.Color3.FromHexString("#0984e3"),this.boundingBoxDragBehavior=new e.SixDofDragBehavior,this.attachableMeshes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new e.UtilityLayerRenderer(t),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=new e.UtilityLayerRenderer(t),this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=t.onPointerObservable.add((function(t,r){if(i.usePointerToAttachGizmos&&t.type==e.PointerEventTypes.POINTERDOWN)if(t.pickInfo&&t.pickInfo.pickedMesh){var n=t.pickInfo.pickedMesh;if(null==i.attachableMeshes)for(;n&&null!=n.__uv$setSource(__uv).__uv$parent;)n=n.__uv$setSource(__uv).__uv$parent;else{var a=!1;i.attachableMeshes.forEach((function(e){n&&(n==e||n.isDescendantOf(e))&&(n=e,a=!0)})),a||(n=null)}n instanceof e.AbstractMesh?i._attachedMesh!=n&&i.attachToMesh(n):i.attachToMesh(null)}else i.attachToMesh(null)}))}return t.prototype.attachToMesh=function(e){for(var t in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=e,this.gizmos){var i=this.gizmos[__uv.$wrap((t))];i&&this._gizmosEnabled[__uv.$wrap((t))]&&(i.attachedMesh=e)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)},Object.defineProperty(t.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(t){t?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new e.PositionGizmo(this._defaultUtilityLayer)),this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedMesh=null),this._gizmosEnabled.positionGizmo=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(t){t?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new e.RotationGizmo(this._defaultUtilityLayer)),this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedMesh=null),this._gizmosEnabled.rotationGizmo=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(t){t?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new e.ScaleGizmo(this._defaultUtilityLayer),this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedMesh=null),this._gizmosEnabled.scaleGizmo=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(t){t?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new e.BoundingBoxGizmo(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh,this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this.gizmos.boundingBoxGizmo.attachedMesh=null),this._gizmosEnabled.boundingBoxGizmo=t},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){for(var e in this.scene.onPointerObservable.remove(this._pointerObserver),this.gizmos){var t=this.gizmos[__uv.$wrap((e))];t&&t.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach()},t}();e.GizmoManager=t}(s||(s={})),function(e){var t=function(){function t(t,i,r){void 0===i&&(i=0),void 0===r&&(r=null),this.name=t,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this.onInfluenceChanged=new e.Observable,this._onDataLayoutChanged=new e.Observable,this._animationPropertiesOverride=null,this._scene=r||e.Engine.LastCreatedScene,this.influence=i}return Object.defineProperty(t.prototype,"influence",{get:function(){return this._influence},set:function(e){if(this._influence!==e){var t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===t||0===e)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e){var t=this.hasPositions;this._positions=e,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},t.prototype.getPositions=function(){return this._positions},t.prototype.setNormals=function(e){var t=this.hasNormals;this._normals=e,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},t.prototype.getNormals=function(){return this._normals},t.prototype.setTangents=function(e){var t=this.hasTangents;this._tangents=e,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},t.prototype.getTangents=function(){return this._tangents},t.prototype.serialize=function(){var t={};return t.name=this.name,t.influence=this.influence,t.positions=Array.prototype.slice.call(this.getPositions()),this.hasNormals&&(t.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(t.tangents=Array.prototype.slice.call(this.getTangents())),e.Animation.AppendSerializedAnimations(this,t),t},t.Parse=function(i){var r=new t(i.name,i.influence);if(r.setPositions(i.positions),i.normals&&r.setNormals(i.normals),i.tangents&&r.setTangents(i.tangents),i.animations)for(var n=0;n<i.animations.length;n++){var a=i.animations[__uv.$wrap((n))];r.animations.push(e.Animation.Parse(a))}return r},t.FromMesh=function(i,r,n){r||(r=i.name);var a=new t(r,n,i.getScene());return a.setPositions(i.getVerticesData(e.VertexBuffer.PositionKind)),i.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&a.setNormals(i.getVerticesData(e.VertexBuffer.NormalKind)),i.isVerticesDataPresent(e.VertexBuffer.TangentKind)&&a.setTangents(i.getVerticesData(e.VertexBuffer.TangentKind)),a},t}();e.MorphTarget=t}(s||(s={})),function(e){var t=function(){function t(t){void 0===t&&(t=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new e.SmartArray(16),this._supportsNormals=!1,this._supportsTangents=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,t||(t=e.Engine.LastCreatedScene),this._scene=t,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsNormals",{get:function(){return this._supportsNormals},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsTangents",{get:function(){return this._supportsTangents},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),t.prototype.getActiveTarget=function(e){return this._activeTargets.data[__uv.$wrap((e))]},t.prototype.getTarget=function(e){return this._targets[__uv.$wrap((e))]},t.prototype.addTarget=function(e){var t=this;this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add((function(e){t._syncActiveTargets(e)}))),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add((function(){t._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)},t.prototype.removeTarget=function(e){var t=this._targets.indexOf(e);t>=0&&(this._targets.splice(t,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[__uv.$wrap((0))]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[__uv.$wrap((0))]),this._syncActiveTargets(!0))},t.prototype.serialize=function(){var e={};e.id=this.uniqueId,e.targets=[];for(var t=0,i=this._targets;t<i.length;t++){var r=i[__uv.$wrap((t))];e.targets.push(r.serialize())}return e},t.prototype._syncActiveTargets=function(t){var i=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._vertexCount=0;for(var r=0,n=this._targets;r<n.length;r++){var a=n[__uv.$wrap((r))];if(0!==a.influence){this._activeTargets.push(a),this._tempInfluences[__uv.$wrap((i++))]=a.influence,this._supportsNormals=this._supportsNormals&&a.hasNormals,this._supportsTangents=this._supportsTangents&&a.hasTangents;var o=a.getPositions();if(o){var s=o.length/3;if(0===this._vertexCount)this._vertexCount=s;else if(this._vertexCount!==s)return void e.Tools.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===i||(this._influences=new Float32Array(i));for(var l=0;l<i;l++)this._influences[__uv.$wrap((l))]=this._tempInfluences[__uv.$wrap((l))];t&&this.synchronize()},t.prototype.synchronize=function(){if(this._scene)for(var e=0,t=this._scene.meshes;e<t.length;e++){var i=t[__uv.$wrap((e))];i.morphTargetManager===this&&i._syncGeometryWithMorphTargetManager()}},t.Parse=function(i,r){var n=new t(r);n._uniqueId=i.id;for(var a=0,o=i.targets;a<o.length;a++){var s=o[__uv.$wrap((a))];n.addTarget(e.MorphTarget.Parse(s))}return n},t}();e.MorphTargetManager=t}(s||(s={})),function(e){var t=function(){function t(t,i,r){void 0===r&&(r=2),this.maxDepth=r,this.dynamicContent=new Array,this._maxBlockCapacity=i||64,this._selectionContent=new e.SmartArrayNoDuplicate(1024),this._creationFunc=t}return t.prototype.update=function(e,i,r){t._CreateBlocks(e,i,r,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},t.prototype.addMesh=function(e){for(var t=0;t<this.blocks.length;t++){this.blocks[__uv.$wrap((t))].addEntry(e)}},t.prototype.select=function(e,t){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++){this.blocks[__uv.$wrap((i))].select(e,this._selectionContent,t)}return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersects=function(e,t,i){this._selectionContent.reset();for(var r=0;r<this.blocks.length;r++){this.blocks[__uv.$wrap((r))].intersects(e,t,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersectsRay=function(e){this._selectionContent.reset();for(var t=0;t<this.blocks.length;t++){this.blocks[__uv.$wrap((t))].intersectsRay(e,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t._CreateBlocks=function(t,i,r,n,a,o,s,l){s.blocks=new Array;for(var c=new e.Vector3((i.x-t.x)/2,(i.y-t.y)/2,(i.z-t.z)/2),u=0;u<2;u++)for(var h=0;h<2;h++)for(var d=0;d<2;d++){var p=t.add(c.multiplyByFloats(u,h,d)),m=t.add(c.multiplyByFloats(u+1,h+1,d+1)),_=new e.OctreeBlock(p,m,n,a+1,o,l);_.addEntries(r),s.blocks.push(_)}},t.CreationFuncForMeshes=function(e,t){var i=e.getBoundingInfo();!e.isBlocked&&i.boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t.CreationFuncForSubMeshes=function(e,t){e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t}();e.Octree=t}(s||(s={})),function(e){var t=function(){function t(e,t,i,r,n,a){this.entries=new Array,this._boundingVectors=new Array,this._capacity=i,this._depth=r,this._maxDepth=n,this._creationFunc=a,this._minPoint=e,this._maxPoint=t,this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors[__uv.$wrap((2))].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[__uv.$wrap((3))].y=t.y,this._boundingVectors.push(e.clone()),this._boundingVectors[__uv.$wrap((4))].z=t.z,this._boundingVectors.push(t.clone()),this._boundingVectors[__uv.$wrap((5))].z=e.z,this._boundingVectors.push(t.clone()),this._boundingVectors[__uv.$wrap((6))].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[__uv.$wrap((7))].y=e.y}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++){this.blocks[__uv.$wrap((t))].addEntry(e)}else this._creationFunc(e,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},t.prototype.addEntries=function(e){for(var t=0;t<e.length;t++){var i=e[__uv.$wrap((t))];this.addEntry(i)}},t.prototype.select=function(t,i,r){if(e.BoundingBox.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var n=0;n<this.blocks.length;n++){this.blocks[__uv.$wrap((n))].select(t,i,r)}return}r?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},t.prototype.intersects=function(t,i,r,n){if(e.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,t,i)){if(this.blocks){for(var a=0;a<this.blocks.length;a++){this.blocks[__uv.$wrap((a))].intersects(t,i,r,n)}return}n?r.concat(this.entries):r.concatWithNoDuplicate(this.entries)}},t.prototype.intersectsRay=function(e,t){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var i=0;i<this.blocks.length;i++){this.blocks[__uv.$wrap((i))].intersectsRay(e,t)}return}t.concatWithNoDuplicate(this.entries)}},t.prototype.createInnerBlocks=function(){e.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},t}();e.OctreeBlock=t}(s||(s={})),function(e){e.Scene.prototype.createOrUpdateSelectionOctree=function(i,r){void 0===i&&(i=64),void 0===r&&(r=2);var n=this._getComponent(e.SceneComponentConstants.NAME_OCTREE);n||(n=new t(this),this._addComponent(n)),this._selectionOctree||(this._selectionOctree=new e.Octree(e.Octree.CreationFuncForMeshes,i,r));var a=this.getWorldExtends();return this._selectionOctree.update(a.min,a.max,this.meshes),this._selectionOctree},Object.defineProperty(e.Scene.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),e.AbstractMesh.prototype.createOrUpdateSubmeshesOctree=function(i,r){void 0===i&&(i=64),void 0===r&&(r=2);var n=this.getScene(),a=n._getComponent(e.SceneComponentConstants.NAME_OCTREE);a||(a=new t(n),n._addComponent(a)),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,i,r)),this.computeWorldMatrix(!0);var o=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(o.minimumWorld,o.maximumWorld,this.subMeshes),this._submeshesOctree};var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new e.Ray(e.Vector3.Zero(),new e.Vector3(1,1,1)),this.scene=t,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return t.prototype.register=function(){var e=this;this.scene.onMeshRemovedObservable.add((function(t){var i=e.scene.selectionOctree;if(null!=i){var r=i.dynamicContent.indexOf(t);-1!==r&&i.dynamicContent.splice(r,1)}})),this.scene.onMeshImportedObservable.add((function(t){var i=e.scene.selectionOctree;null!=i&&i.addMesh(t)}))},t.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},t.prototype.getActiveSubMeshCandidates=function(e){return e._submeshesOctree&&e.useOctreeForRenderingSelection?e._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(e)},t.prototype.getIntersectingSubMeshCandidates=function(t,i){return t._submeshesOctree&&t.useOctreeForPicking?(e.Ray.TransformToRef(i,t.getWorldMatrix(),this._tempRay),t._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(t)},t.prototype.getCollidingSubMeshCandidates=function(e,t){if(e._submeshesOctree&&e.useOctreeForCollisions){var i=t._velocityWorldLength+Math.max(t._radius.x,t._radius.y,t._radius.z);return e._submeshesOctree.intersects(t._basePointWorld,i)}return this.scene._getDefaultSubMeshCandidates(e)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t}();e.OctreeSceneComponent=t}(s||(s={})),function(e){var t=function(e){function t(t,i,r,n,a,o){var s=e.call(this,t,"anaglyph",null,["leftSampler"],i,r[__uv.$wrap((1))],n,a,o)||this;return s._passedProcess=r[__uv.$wrap((0))]._rigPostProcess,s.onApplyObservable.add((function(e){e.setTextureFromPostProcess("leftSampler",s._passedProcess)})),s}return a(t,e),t}(e.PostProcess);e.AnaglyphPostProcess=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("AnaglyphArcRotateCamera",(function(i,r,n){return function(){return new t(i,0,0,1,e.Vector3.Zero(),n.interaxial_distance,r)}}));var t=function(t){function i(i,r,n,a,o,s,l){var c=t.call(this,i,r,n,a,o,l)||this;return c.interaxialDistance=s,c.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:s}),c}return a(i,t),i.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("AnaglyphFreeCamera",(function(i,r,n){return function(){return new t(i,e.Vector3.Zero(),n.interaxial_distance,r)}}));var t=function(t){function i(i,r,n,a){var o=t.call(this,i,r,a)||this;return o.interaxialDistance=n,o.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),o}return a(i,t),i.prototype.getClassName=function(){return"AnaglyphFreeCamera"},i}(e.FreeCamera);e.AnaglyphFreeCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("AnaglyphGamepadCamera",(function(i,r,n){return function(){return new t(i,e.Vector3.Zero(),n.interaxial_distance,r)}}));var t=function(t){function i(i,r,n,a){var o=t.call(this,i,r,a)||this;return o.interaxialDistance=n,o.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),o}return a(i,t),i.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},i}(e.GamepadCamera);e.AnaglyphGamepadCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("AnaglyphUniversalCamera",(function(i,r,n){return function(){return new t(i,e.Vector3.Zero(),n.interaxial_distance,r)}}));var t=function(t){function i(i,r,n,a){var o=t.call(this,i,r,a)||this;return o.interaxialDistance=n,o.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),o}return a(i,t),i.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},i}(e.UniversalCamera);e.AnaglyphUniversalCamera=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o,s){var l=t.call(this,i,"stereoscopicInterlace",["stepSize"],["camASampler"],1,r[__uv.$wrap((1))],a,o,s,n?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return l._passedProcess=r[__uv.$wrap((0))]._rigPostProcess,l._stepSize=new e.Vector2(1/l.width,1/l.height),l.onSizeChangedObservable.add((function(){l._stepSize=new e.Vector2(1/l.width,1/l.height)})),l.onApplyObservable.add((function(e){e.setTextureFromPostProcess("camASampler",l._passedProcess),e.setFloat2("stepSize",l._stepSize.x,l._stepSize.y)})),l}return a(i,t),i}(e.PostProcess);e.StereoscopicInterlacePostProcess=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("StereoscopicArcRotateCamera",(function(i,r,n){return function(){return new t(i,0,0,1,e.Vector3.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,r)}}));var t=function(t){function i(i,r,n,a,o,s,l,c){var u=t.call(this,i,r,n,a,o,c)||this;return u.interaxialDistance=s,u.isStereoscopicSideBySide=l,u.setCameraRigMode(l?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:s}),u}return a(i,t),i.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("StereoscopicFreeCamera",(function(i,r,n){return function(){return new t(i,e.Vector3.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,r)}}));var t=function(t){function i(i,r,n,a,o){var s=t.call(this,i,r,o)||this;return s.interaxialDistance=n,s.isStereoscopicSideBySide=a,s.setCameraRigMode(a?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),s}return a(i,t),i.prototype.getClassName=function(){return"StereoscopicFreeCamera"},i}(e.FreeCamera);e.StereoscopicFreeCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("StereoscopicGamepadCamera",(function(i,r,n){return function(){return new t(i,e.Vector3.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,r)}}));var t=function(t){function i(i,r,n,a,o){var s=t.call(this,i,r,o)||this;return s.interaxialDistance=n,s.isStereoscopicSideBySide=a,s.setCameraRigMode(a?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),s}return a(i,t),i.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},i}(e.GamepadCamera);e.StereoscopicGamepadCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("StereoscopicFreeCamera",(function(i,r,n){return function(){return new t(i,e.Vector3.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,r)}}));var t=function(t){function i(i,r,n,a,o){var s=t.call(this,i,r,o)||this;return s.interaxialDistance=n,s.isStereoscopicSideBySide=a,s.setCameraRigMode(a?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),s}return a(i,t),i.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},i}(e.UniversalCamera);e.StereoscopicUniversalCamera=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){var o=t.call(this,i,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,a.postProcessScaleFactor,r,e.Texture.BILINEAR_SAMPLINGMODE)||this;return o._isRightEye=n,o._distortionFactors=a.distortionK,o._postProcessScaleFactor=a.postProcessScaleFactor,o._lensCenterOffset=a.lensCenterOffset,o.adaptScaleToCurrentViewport=!0,o.onSizeChangedObservable.add((function(){o._scaleIn=new e.Vector2(2,2/o.aspectRatio),o._scaleFactor=new e.Vector2(1/o._postProcessScaleFactor*.5,1/o._postProcessScaleFactor*.5*o.aspectRatio),o._lensCenter=new e.Vector2(o._isRightEye?.5-.5*o._lensCenterOffset:.5+.5*o._lensCenterOffset,.5)})),o.onApplyObservable.add((function(e){e.setFloat2("LensCenter",o._lensCenter.x,o._lensCenter.y),e.setFloat2("Scale",o._scaleFactor.x,o._scaleFactor.y),e.setFloat2("ScaleIn",o._scaleIn.x,o._scaleIn.y),e.setFloat4("HmdWarpParam",o._distortionFactors[__uv.$wrap((0))],o._distortionFactors[__uv.$wrap((1))],o._distortionFactors[__uv.$wrap((2))],o._distortionFactors[__uv.$wrap((3))])})),o}return a(i,t),i}(e.PostProcess);e.VRDistortionCorrectionPostProcess=t}(s||(s={})),function(e){var t=function(){function t(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new e.Quaternion,this._alpha=0,this._beta=0,this._gamma=0,this._orientationChanged=function(){t._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-e.Tools.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=null!==e.alpha?e.alpha:0,t._beta=null!==e.beta?e.beta:0,t._gamma=null!==e.gamma?e.gamma:0},this._constantTranform=new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera=t,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new e.Quaternion)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(e,t){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},t.prototype.detachControl=function(e){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation)},t.prototype.checkInputs=function(){this._alpha&&(e.Quaternion.RotationYawPitchRollToRef(e.Tools.ToRadians(this._alpha),e.Tools.ToRadians(this._beta),-e.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},t.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},t.prototype.getSimpleName=function(){return"deviceOrientation"},t}();e.FreeCameraDeviceOrientationInput=t,e.CameraInputTypes.FreeCameraDeviceOrientationInput=t}(s||(s={})),function(e){var t=function(){function e(){this.alphaCorrection=1,this.betaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(e,t){this.camera.attachControl(e,t),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype._onOrientationEvent=function(e){null!==e.alpha&&(this._alpha=0|+e.alpha),null!==e.gamma&&(this._gamma=0|+e.gamma),this._dirty=!0},e.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},e.prototype.detachControl=function(e){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();e.ArcRotateCameraVRDeviceOrientationInput=t,e.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=t}(s||(s={})),function(e){var t=function(){function t(){this.compensateDistortion=!0}return Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return e.Matrix.Translation(t,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return e.Matrix.Translation(-t,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftPreViewMatrix",{get:function(){return e.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightPreViewMatrix",{get:function(){return e.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}();e.VRCameraMetrics=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("WebVRFreeCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}})),e.Node.AddNodeConstructor("WebVRGamepadCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(t){function i(i,r,n,a){void 0===a&&(a={});var o=t.call(this,i,r,n)||this;o.webVROptions=a,o._vrDevice=null,o.rawPose=null,o._specsVersion="1.1",o._attached=!1,o._descendants=[],o._deviceRoomPosition=e.Vector3.Zero(),o._deviceRoomRotationQuaternion=e.Quaternion.Identity(),o._standingMatrix=null,o.devicePosition=e.Vector3.Zero(),o.deviceRotationQuaternion=e.Quaternion.Identity(),o.deviceScaleFactor=1,o._deviceToWorld=e.Matrix.Identity(),o._worldToDevice=e.Matrix.Identity(),o.controllers=[],o.onControllersAttachedObservable=new e.Observable,o.onControllerMeshLoadedObservable=new e.Observable,o.onPoseUpdatedFromDeviceObservable=new e.Observable,o._poseSet=!1,o.rigParenting=!0,o._defaultHeight=void 0,o._htmlElementAttached=null,o._detachIfAttached=function(){var e=o.getEngine().getVRDevice();e&&!e.isPresenting&&o._htmlElementAttached&&o.detachControl(o._htmlElementAttached)},o._workingVector=e.Vector3.Zero(),o._oneVector=e.Vector3.One(),o._workingMatrix=e.Matrix.Identity(),o._tmpMatrix=new e.Matrix,o._cache.position=e.Vector3.Zero(),a.defaultHeight&&(o._defaultHeight=a.defaultHeight,o.position.y=o._defaultHeight),o.minZ=.1,5===arguments.length&&(o.webVROptions=arguments[__uv.$wrap((4))]),null==o.webVROptions.trackPosition&&(o.webVROptions.trackPosition=!0),null==o.webVROptions.controllerMeshes&&(o.webVROptions.controllerMeshes=!0),null==o.webVROptions.defaultLightingOnControllers&&(o.webVROptions.defaultLightingOnControllers=!0),o.rotationQuaternion=new e.Quaternion,o.webVROptions&&o.webVROptions.positionScale&&(o.deviceScaleFactor=o.webVROptions.positionScale);var s=o.getEngine();return o._onVREnabled=function(e){e&&o.initControllers()},s.onVRRequestPresentComplete.add(o._onVREnabled),s.initWebVR().add((function(t){t.vrDisplay&&o._vrDevice!==t.vrDisplay&&(o._vrDevice=t.vrDisplay,o.setCameraRigMode(e.Camera.RIG_MODE_WEBVR,{parentCamera:o,vrDisplay:o._vrDevice,frameData:o._frameData,specs:o._specsVersion}),o._attached&&o.getEngine().enableVR())})),"undefined"!=typeof VRFrameData&&(o._frameData=new VRFrameData),n.onBeforeCameraRenderObservable.add((function(e){e.__uv$setSource(__uv).__uv$parent===o&&o.rigParenting&&(o._descendants=o.getDescendants(!0,(function(e){var t=o.controllers.some((function(t){return t._mesh===e})),i=-1!==o._rigCameras.indexOf(e);return!t&&!i})),o._descendants.forEach((function(t){t.__uv$setSource(__uv).__uv$parent=e})))})),n.onAfterCameraRenderObservable.add((function(e){e.__uv$setSource(__uv).__uv$parent===o&&o.rigParenting&&o._descendants.forEach((function(e){e.__uv$setSource(__uv).__uv$parent=o}))})),o}return a(i,t),i.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},i.prototype.useStandingMatrix=function(t){var i=this;void 0===t&&(t=function(e){}),this.getEngine().initWebVRAsync().then((function(r){r.vrDisplay&&r.vrDisplay.stageParameters&&r.vrDisplay.stageParameters.sittingToStandingTransform&&i.webVROptions.trackPosition?(i._standingMatrix=new e.Matrix,e.Matrix.FromFloat32ArrayToRefScaled(r.vrDisplay.stageParameters.sittingToStandingTransform,0,1,i._standingMatrix),i.getScene().useRightHandedSystem||[2,6,8,9,14].forEach((function(e){i._standingMatrix&&(i._standingMatrix.m[__uv.$wrap((e))]*=-1)})),t(!0)):t(!1)}))},i.prototype.useStandingMatrixAsync=function(){var e=this;return new Promise((function(t,i){e.useStandingMatrix((function(e){t(e)}))}))},i.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),t.prototype.dispose.call(this)},i.prototype.getControllerByName=function(e){for(var t=0,i=this.controllers;t<i.length;t++){var r=i[__uv.$wrap((t))];if(r.hand===e)return r}return null},Object.defineProperty(i.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),i.prototype.getForwardRay=function(e){return void 0===e&&(e=100),this.leftCamera?t.prototype.getForwardRay.call(this,e,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):t.prototype.getForwardRay.call(this,e)},i.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),t.prototype._checkInputs.call(this)},i.prototype.updateFromDevice=function(e){e&&e.orientation&&(this.rawPose=e,this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[__uv.$wrap((0))],e.orientation[__uv.$wrap((1))],-e.orientation[__uv.$wrap((2))],-e.orientation[__uv.$wrap((3))]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[__uv.$wrap((0))],this.rawPose.position[__uv.$wrap((1))],-this.rawPose.position[__uv.$wrap((2))]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},i.prototype.attachControl=function(i,r){t.prototype.attachControl.call(this,i,r),this._attached=!0,this._htmlElementAttached=i,r=!e.Camera.ForceAttachControlToAlwaysPreventDefault&&r,this._vrDevice&&this.getEngine().enableVR(),window.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},i.prototype.detachControl=function(e){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),t.prototype.detachControl.call(this,e),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},i.prototype.getClassName=function(){return"WebVRFreeCamera"},i.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},i.prototype._updateRigCameras=function(){var e=this._rigCameras[__uv.$wrap((0))],t=this._rigCameras[__uv.$wrap((1))];e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.position.copyFrom(this._deviceRoomPosition),t.position.copyFrom(this._deviceRoomPosition)},i.prototype._correctPositionIfNotTrackPosition=function(t,i){void 0===i&&(i=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(e.Matrix.TranslationToRef(this.rawPose.position[__uv.$wrap((0))],this.rawPose.position[__uv.$wrap((1))],-this.rawPose.position[__uv.$wrap((2))],this._tmpMatrix),i||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(t,t))},i.prototype._updateCache=function(i){var r=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),e.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),e.Matrix.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach((function(e){e._deviceToWorld.copyFrom(r._deviceToWorld),r._correctPositionIfNotTrackPosition(e._deviceToWorld),e.update()}))),i||t.prototype._updateCache.call(this),this.updateCacheCalled=!1},i.prototype._computeDevicePosition=function(){e.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},i.prototype.update=function(){this._computeDevicePosition(),e.Matrix.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),e.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),t.prototype.update.call(this)},i.prototype._getViewMatrix=function(){return e.Matrix.Identity()},i.prototype._getWebVRViewMatrix=function(){var t=this,i=this._cameraRigParams.parentCamera;i._updateCache();var r=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return e.Matrix.FromArrayToRef(r,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||[2,6,8,9,14].forEach((function(e){t._webvrViewMatrix.m[__uv.$wrap((e))]*=-1})),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==i.deviceScaleFactor&&(this._webvrViewMatrix.invert(),i.deviceScaleFactor&&(this._webvrViewMatrix.m[__uv.$wrap((12))]*=i.deviceScaleFactor,this._webvrViewMatrix.m[__uv.$wrap((13))]*=i.deviceScaleFactor,this._webvrViewMatrix.m[__uv.$wrap((14))]*=i.deviceScaleFactor),this._webvrViewMatrix.invert()),i._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),i._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||e.Matrix.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(i.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},i.prototype._getWebVRProjectionMatrix=function(){var t=this,i=this.__uv$setSource(__uv).__uv$parent;i._vrDevice.depthNear=i.minZ,i._vrDevice.depthFar=i.maxZ;var r=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return e.Matrix.FromArrayToRef(r,0,this._projectionMatrix),this.getScene().useRightHandedSystem||[8,9,10,11].forEach((function(e){t._projectionMatrix.m[__uv.$wrap((e))]*=-1})),this._projectionMatrix},i.prototype.initControllers=function(){var t=this;this.controllers=[];var i=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=i.onGamepadDisconnectedObservable.add((function(i){if(i.type===e.Gamepad.POSE_ENABLED){var r=i;r.defaultModel&&r.defaultModel.setEnabled(!1),"right"===r.hand&&(t._rightController=null),"left"===r.hand&&(t._leftController=null);var n=t.controllers.indexOf(r);-1!==n&&t.controllers.splice(n,1)}})),this._onGamepadConnectedObserver=i.onGamepadConnectedObservable.add((function(i){if(i.type===e.Gamepad.POSE_ENABLED){var r=i;if(t.webVROptions.trackPosition||(r._disableTrackPosition(new e.Vector3("left"==r.hand?-.15:.15,-.5,.25)),t._updateCacheWhenTrackingDisabledObserver||(t._updateCacheWhenTrackingDisabledObserver=t._scene.onBeforeRenderObservable.add((function(){t._updateCache()})))),r.deviceScaleFactor=t.deviceScaleFactor,r._deviceToWorld.copyFrom(t._deviceToWorld),t._correctPositionIfNotTrackPosition(r._deviceToWorld),t.webVROptions.controllerMeshes&&(r.defaultModel?r.defaultModel.setEnabled(!0):r.initControllerMesh(t.getScene(),(function(i){if(i.scaling.scaleInPlace(t.deviceScaleFactor),t.onControllerMeshLoadedObservable.notifyObservers(r),t.webVROptions.defaultLightingOnControllers){t._lightOnControllers||(t._lightOnControllers=new e.HemisphericLight("vrControllersLight",new e.Vector3(0,1,0),t.getScene()));var n=function(e,t){var i=e.getChildren();i&&0!==i.length&&i.forEach((function(e){t.includedOnlyMeshes.push(e),n(e,t)}))};t._lightOnControllers.includedOnlyMeshes.push(i),n(i,t._lightOnControllers)}}))),r.attachToPoseControlledCamera(t),-1===t.controllers.indexOf(r)){t.controllers.push(r);for(var n=!1,a=0;a<t.controllers.length;a++)t.controllers[__uv.$wrap((a))].controllerType===e.PoseEnabledControllerType.VIVE&&(n?t.controllers[__uv.$wrap((a))].hand="right":(n=!0,t.controllers[__uv.$wrap((a))].hand="left"));t.controllers.length>=2&&t.onControllersAttachedObservable.notifyObservers(t.controllers)}}}))},i}(e.FreeCamera);e.WebVRFreeCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("DeviceOrientationCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(t){function i(i,r,n){var a=t.call(this,i,r,n)||this;return a._quaternionCache=new e.Quaternion,a.inputs.addDeviceOrientation(),a}return a(i,t),i.prototype.getClassName=function(){return"DeviceOrientationCamera"},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},i.prototype.resetToCurrentRotation=function(t){var i=this;void 0===t&&(t=e.Axis.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new e.Quaternion),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach((function(e){t[__uv.$wrap((e))]?i._initialQuaternion[__uv.$wrap((e))]*=-1:i._initialQuaternion[__uv.$wrap((e))]=0})),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},i}(e.FreeCamera);e.DeviceOrientationCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("VRDeviceOrientationFreeCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(t){function i(i,r,n,a,o){void 0===a&&(a=!0),void 0===o&&(o=e.VRCameraMetrics.GetDefault());var s=t.call(this,i,r,n)||this;return o.compensateDistortion=a,s.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:o}),s}return a(i,t),i.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},i}(e.DeviceOrientationCamera);e.VRDeviceOrientationFreeCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("VRDeviceOrientationFreeCamera",(function(i,r){return function(){return new t(i,0,0,1,e.Vector3.Zero(),r)}}));var t=function(t){function i(i,r,n,a,o,s,l,c){void 0===l&&(l=!0),void 0===c&&(c=e.VRCameraMetrics.GetDefault());var u=t.call(this,i,r,n,a,o,s)||this;return c.compensateDistortion=l,u.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:c}),u.inputs.addVRDeviceOrientation(),u}return a(i,t),i.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},i}(e.ArcRotateCamera);e.VRDeviceOrientationArcRotateCamera=t}(s||(s={})),function(e){e.Node.AddNodeConstructor("VRDeviceOrientationGamepadCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(t){function i(i,r,n,a,o){void 0===a&&(a=!0),void 0===o&&(o=e.VRCameraMetrics.GetDefault());var s=t.call(this,i,r,n,a,o)||this;return s.inputs.addGamepad(),s}return a(i,t),i.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},i}(e.VRDeviceOrientationFreeCamera);e.VRDeviceOrientationGamepadCamera=t}(s||(s={})),function(e){var t=function(){function t(i,r){if(void 0===r&&(r=null),this.scene=i,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=t._idCounter++,r)this._gazeTracker=r.clone("gazeTracker");else{this._gazeTracker=e.Mesh.CreateTorus("gazeTracker",.0035,.0025,20,i,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var n=new e.StandardMaterial("targetMat",i);n.specularColor=e.Color3.Black(),n.emissiveColor=new e.Color3(.7,.7,.7),n.backFaceCulling=!1,this._gazeTracker.material=n}}return t.prototype._getForwardRay=function(t){return new e.Ray(e.Vector3.Zero(),new e.Vector3(0,0,t))},t.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},t.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},t.prototype._activatePointer=function(){this._activePointer=!0},t.prototype._deactivatePointer=function(){this._activePointer=!1},t.prototype._updatePointerDistance=function(e){void 0===e&&(e=100)},t.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},t._idCounter=0,t}(),i=function(t){function i(i,r,n){var a=t.call(this,r,n)||this;a.webVRController=i,a._laserPointer=e.Mesh.CreateCylinder("laserPointer",1,.004,2e-4,20,1,r,!1);var o=new e.StandardMaterial("laserPointerMat",r);if(o.emissiveColor=new e.Color3(.7,.7,.7),o.alpha=.6,a._laserPointer.material=o,a._laserPointer.rotation.x=Math.PI/2,a._laserPointer.position.z=-.5,a._laserPointer.isVisible=!1,a._laserPointer.isPickable=!1,!i.mesh){var s=new e.Mesh("preloadControllerMesh",r),l=new e.Mesh(e.PoseEnabledController.POINTING_POSE,r);l.rotation.x=-.7,s.addChild(l),i.attachToMesh(s)}return a._setLaserPointerParent(i.mesh),a._meshAttachedObserver=i._meshAttachedObservable.add((function(e){a._setLaserPointerParent(e)})),a}return a(i,t),i.prototype._getForwardRay=function(e){return this.webVRController.getForwardRay(e)},i.prototype._activatePointer=function(){t.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},i.prototype._deactivatePointer=function(){t.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},i.prototype._setLaserPointerColor=function(e){this._laserPointer.material.emissiveColor=e},i.prototype._setLaserPointerParent=function(t){var i=function(e){e.isPickable=!1,e.getChildMeshes().forEach((function(e){i(e)}))};i(t);var r=t.getChildMeshes();this.webVRController._pointingPoseNode=null;for(var n=0;n<r.length;n++)if(r[__uv.$wrap((n))].name&&r[__uv.$wrap((n))].name.indexOf(e.PoseEnabledController.POINTING_POSE)>=0){t=r[__uv.$wrap((n))],this.webVRController._pointingPoseNode=t;break}this._laserPointer.__uv$setSource(__uv).__uv$parent=t},i.prototype._updatePointerDistance=function(e){void 0===e&&(e=100),this._laserPointer.scaling.y=e,this._laserPointer.position.z=-e/2},i.prototype.dispose=function(){t.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},i}(t),r=function(t){function i(e,i){var r=t.call(this,i)||this;return r.getCamera=e,r}return a(i,t),i.prototype._getForwardRay=function(t){var i=this.getCamera();return i?i.getForwardRay(t):new e.Ray(e.Vector3.Zero(),e.Vector3.Forward())},i}(t),n=function(){function t(t,n){void 0===n&&(n={});var a=this;if(this.webVROptions=n,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.onEnteringVRObservable=new e.Observable,this.onExitingVRObservable=new e.Observable,this.onControllerMeshLoadedObservable=new e.Observable,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._rotationAllowed=!0,this._teleportBackwardsVector=new e.Vector3(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new e.Vector3(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this.onNewMeshSelected=new e.Observable,this.onNewMeshPicked=new e.Observable,this.onBeforeCameraTeleport=new e.Observable,this.onAfterCameraTeleport=new e.Observable,this.onSelectedMeshUnselected=new e.Observable,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this._onResize=function(){a.moveButtonToBottomRight(),a._fullscreenVRpresenting&&a._webVRready&&a.exitVR()},this._onFullscreenChange=function(){void 0!==document.fullscreen?a._fullscreenVRpresenting=document.fullscreen:void 0!==document.mozFullScreen?a._fullscreenVRpresenting=document.mozFullScreen:void 0!==document.webkitIsFullScreen?a._fullscreenVRpresenting=document.webkitIsFullScreen:void 0!==document.msIsFullScreen?a._fullscreenVRpresenting=document.msIsFullScreen:void 0!==document.msFullscreenElement&&(a._fullscreenVRpresenting=document.msFullscreenElement),!a._fullscreenVRpresenting&&a._canvas&&(a.exitVR(),a._useCustomVRButton||(a._btnVR.style.__uv$setSource(__uv).__uv$top=a._canvas.offsetTop+a._canvas.offsetHeight-70+"px",a._btnVR.style.left=a._canvas.offsetLeft+a._canvas.offsetWidth-100+"px"))},this.beforeRender=function(){a._leftController&&a._leftController._activePointer&&a._castRayAndSelectObject(a._leftController),a._rightController&&a._rightController._activePointer&&a._castRayAndSelectObject(a._rightController),a._noControllerIsActive?a._castRayAndSelectObject(a._cameraGazer):a._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(t){if(t.type!==e.Gamepad.POSE_ENABLED)t.leftStick&&t.onleftstickchanged((function(e){a._teleportationInitialized&&a.teleportationEnabled&&(!a._leftController&&!a._rightController||a._leftController&&!a._leftController._activePointer&&a._rightController&&!a._rightController._activePointer)&&(a._checkTeleportWithRay(e,a._cameraGazer),a._checkTeleportBackwards(e,a._cameraGazer))})),t.rightStick&&t.onrightstickchanged((function(e){a._teleportationInitialized&&a._checkRotate(e,a._cameraGazer)})),t.type===e.Gamepad.XBOX&&(t.onbuttondown((function(t){a._interactionsEnabled&&t===e.Xbox360Button.A&&a._cameraGazer._selectionPointerDown()})),t.onbuttonup((function(t){a._interactionsEnabled&&t===e.Xbox360Button.A&&a._cameraGazer._selectionPointerUp()})));else{var r=t,n=new i(r,a._scene,a._cameraGazer._gazeTracker);"right"===r.hand||a._leftController&&a._leftController.webVRController!=r?a._rightController=n:a._leftController=n,a._tryEnableInteractionOnController(n)}},this._tryEnableInteractionOnController=function(e){a._interactionsRequested&&!e._interactionsEnabled&&a._enableInteractionOnController(e),a._teleportationRequested&&!e._teleportationEnabled&&a._enableTeleportationOnController(e)},this._onNewGamepadDisconnected=function(t){t instanceof e.WebVRController&&("left"===t.hand&&null!=a._leftController&&(a._leftController.dispose(),a._leftController=null),"right"===t.hand&&null!=a._rightController&&(a._rightController.dispose(),a._rightController=null))},this._workingVector=e.Vector3.Zero(),this._workingQuaternion=e.Quaternion.Identity(),this._workingMatrix=e.Matrix.Identity(),this._scene=t,this._canvas=t.getEngine().getRenderingCanvas(),void 0===n.createFallbackVRDeviceOrientationFreeCamera&&(n.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===n.createDeviceOrientationCamera&&(n.createDeviceOrientationCamera=!0),void 0===n.laserToggle&&(n.laserToggle=!0),void 0===n.defaultHeight&&(n.defaultHeight=1.7),n.useCustomVRButton&&(this._useCustomVRButton=!0,n.customVRButton&&(this._btnVR=n.customVRButton)),n.rayLength&&(this._rayLength=n.rayLength),this._defaultHeight=n.defaultHeight,n.positionScale&&(this._rayLength*=n.positionScale,this._defaultHeight*=n.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new e.Vector3(0,this._defaultHeight,0),n.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new e.DeviceOrientationCamera("deviceOrientationVRHelper",this._position.clone(),t),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof e.TargetCamera&&this._scene.activeCamera.rotation)){var o=this._scene.activeCamera;o.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(o.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(e.Quaternion.RotationYawPitchRoll(o.rotation.y,o.rotation.x,o.rotation.z)),this._deviceOrientationCamera.rotation=o.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)}else this._existingCamera=this._scene.activeCamera;if(n.createFallbackVRDeviceOrientationFreeCamera&&(this._vrDeviceOrientationCamera=new e.VRDeviceOrientationFreeCamera("VRDeviceOrientationVRHelper",this._position,this._scene)),this._webVRCamera=new e.WebVRFreeCamera("WebVRHelper",this._position,this._scene,n),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new r((function(){return a.currentVRCamera}),t),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";".babylonVRicon.vrdisplaypresenting { display: none; }";var s=document.createElement("style");s.appendChild(document.createTextNode(".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }.babylonVRicon.vrdisplaypresenting { display: none; }")),document.getElementsByTagName("head")[__uv.$wrap((0))].appendChild(s),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",(function(){a.isInVRMode?a.exitVR():a.enterVR()})),window.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,n.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add((function(e){e.vrDisplay&&a.displayVRButton()})),this._onKeyDown=function(e){27===e.keyCode&&a.isInVRMode&&a.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add((function(e,t){a.isInVRMode&&(a.exitVR(),a._fullscreenVRpresenting&&a._scene.getEngine().switchFullscreen(!0))}),e.PointerEventTypes.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(e){return a.onVRDisplayChanged(e)},this._onVrDisplayPresentChange=function(){return a.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){a._webVRrequesting=!0,a.updateButtonVisibility()},this._onVRRequestPresentComplete=function(e){a._webVRrequesting=!1,a.updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),t.onDisposeObservable.add((function(){a.dispose()})),this._webVRCamera.onControllerMeshLoadedObservable.add((function(e){return a._onDefaultMeshLoaded(e)})),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new e.CircleEase,this._circleEase.setEasingMode(e.EasingFunction.EASINGMODE_EASEINOUT),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes})}return Object.defineProperty(t.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(e){e&&(e.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(e){e&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=e,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(e){this._displayGaze=e,e||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(e){this._displayLaserPointer=e,e?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated},enumerable:!0,configurable:!0}),t.prototype._onDefaultMeshLoaded=function(t){this._leftController&&this._leftController.webVRController==t&&t.mesh&&this._leftController._setLaserPointerParent(t.mesh),this._rightController&&this._rightController.webVRController==t&&t.mesh&&this._rightController._setLaserPointerParent(t.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(t)}catch(t){e.Tools.Warn("Error in your custom logic onControllerMeshLoaded: "+t)}},Object.defineProperty(t.prototype,"isInVRMode",{get:function(){return this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),t.prototype.onVrDisplayPresentChange=function(){var t=this._scene.getEngine().getVRDevice();if(t){var i=this._webVRpresenting;this._webVRpresenting=t.isPresenting,i&&!this._webVRpresenting&&this.exitVR()}else e.Tools.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},t.prototype.onVRDisplayChanged=function(e){this._webVRsupported=e.vrSupported,this._webVRready=!!e.vrDisplay,this._webVRpresenting=e.vrDisplay&&e.vrDisplay.isPresenting,this.updateButtonVisibility()},t.prototype.moveButtonToBottomRight=function(){this._canvas&&!this._useCustomVRButton&&(this._btnVR.style.__uv$setSource(__uv).__uv$top=this._canvas.offsetTop+this._canvas.offsetHeight-70+"px",this._btnVR.style.left=this._canvas.offsetLeft+this._canvas.offsetWidth-100+"px")},t.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},t.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},t.prototype.enterVR=function(){if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(t){e.Tools.Warn("Error in your custom logic onEnteringVR: "+t)}this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone(),this._existingCamera=this._scene.activeCamera),this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().switchFullscreen(!0),this.updateButtonVisibility()),this._scene.activeCamera&&this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._hasEnteredVR=!0)},t.prototype.exitVR=function(){if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(t){e.Tools.Warn("Error in your custom logic onExitingVR: "+t)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),this._hasEnteredVR=!1}},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._scene.activeCamera&&(this._scene.activeCamera.position=e)},enumerable:!0,configurable:!0}),t.prototype.enableInteractions=function(){var e=this;this._interactionsEnabled||(this._interactionsRequested=!0,this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(t){return t.isVisible&&(t.isPickable||t.name===e._floorMeshName)},this.meshSelectionPredicate=function(e){return!0},this._raySelectionPredicate=function(t){return!!(e._isTeleportationFloor(t)||-1===t.name.indexOf("gazeTracker")&&-1===t.name.indexOf("teleportationTarget")&&-1===t.name.indexOf("torusTeleportation"))&&e.raySelectionPredicate(t)},this._interactionsEnabled=!0)},Object.defineProperty(t.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!0,configurable:!0}),t.prototype._isTeleportationFloor=function(e){for(var t=0;t<this._floorMeshesCollection.length;t++)if(this._floorMeshesCollection[__uv.$wrap((t))].id===e.id)return!0;return!(!this._floorMeshName||e.name!==this._floorMeshName)},t.prototype.addFloorMesh=function(e){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(e)>-1||this._floorMeshesCollection.push(e))},t.prototype.removeFloorMesh=function(e){if(this._floorMeshesCollection){var t=this._floorMeshesCollection.indexOf(e);-1!==t&&this._floorMeshesCollection.splice(t,1)}},t.prototype.enableTeleportation=function(t){if(void 0===t&&(t={}),!this._teleportationInitialized){this._teleportationRequested=!0,this.enableInteractions(),t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);var i=new e.ImageProcessingConfiguration;i.vignetteColor=new e.Color4(0,0,0,0),i.vignetteEnabled=!0,this._postProcessMove=new e.ImageProcessingPostProcess("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,i),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},t.prototype._enableInteractionOnController=function(e){var t=this;e.webVRController.mesh&&(e._interactionsEnabled=!0,e._activatePointer(),this.webVROptions.laserToggle&&e.webVRController.onMainButtonStateChangedObservable.add((function(i){t._displayLaserPointer&&1===i.value&&(e._activePointer?e._deactivatePointer():e._activatePointer(),t.displayGaze&&(e._gazeTracker.isVisible=e._activePointer))})),e.webVRController.onTriggerStateChangedObservable.add((function(i){var r=e;t._noControllerIsActive&&(r=t._cameraGazer),r._pointerDownOnMeshAsked?i.value<t._padSensibilityDown&&r._selectionPointerUp():i.value>t._padSensibilityUp&&r._selectionPointerDown()})))},t.prototype._checkTeleportWithRay=function(e,t){this._teleportationRequestInitiated&&!t._teleportationRequestInitiated||(t._teleportationRequestInitiated?Math.sqrt(e.y*e.y+e.x*e.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),t._teleportationRequestInitiated=!1):e.y<-this._padSensibilityUp&&t._dpadPressed&&(t._activatePointer(),t._teleportationRequestInitiated=!0))},t.prototype._checkRotate=function(e,t){t._teleportationRequestInitiated||(t._rotationLeftAsked?e.x>-this._padSensibilityDown&&(t._rotationLeftAsked=!1):e.x<-this._padSensibilityUp&&t._dpadPressed&&(t._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),t._rotationRightAsked?e.x<this._padSensibilityDown&&(t._rotationRightAsked=!1):e.x>this._padSensibilityUp&&t._dpadPressed&&(t._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},t.prototype._checkTeleportBackwards=function(t,i){if(!i._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&i._dpadPressed){if(!i._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var r=e.Quaternion.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),n=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(r=this.currentVRCamera.deviceRotationQuaternion,n=this.currentVRCamera.devicePosition),r.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,e.Quaternion.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),e.Vector3.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var a=new e.Ray(n,this._workingVector),o=this._scene.pickWithRay(a,this._raySelectionPredicate);o&&o.pickedPoint&&o.pickedMesh&&this._isTeleportationFloor(o.pickedMesh)&&o.distance<5&&this.teleportCamera(o.pickedPoint),i._teleportationBackRequestInitiated=!0}}else i._teleportationBackRequestInitiated=!1},t.prototype._enableTeleportationOnController=function(t){var i=this;t.webVRController.mesh&&(t._interactionsEnabled||this._enableInteractionOnController(t),t._interactionsEnabled=!0,t._teleportationEnabled=!0,t.webVRController.controllerType===e.PoseEnabledControllerType.VIVE&&(t._dpadPressed=!1,t.webVRController.onPadStateChangedObservable.add((function(e){t._dpadPressed=e.pressed,t._dpadPressed||(t._rotationLeftAsked=!1,t._rotationRightAsked=!1,t._teleportationBackRequestInitiated=!1)}))),t.webVRController.onPadValuesChangedObservable.add((function(e){i.teleportationEnabled&&(i._checkTeleportBackwards(e,t),i._checkTeleportWithRay(e,t)),i._checkRotate(e,t)})))},t.prototype._createTeleportationCircles=function(){this._teleportationTarget=e.Mesh.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var t=new e.DynamicTexture("DynamicTexture",512,this._scene,!0);t.hasAlpha=!0;var i=t.getContext();i.beginPath(),i.arc(256,256,200,0,2*Math.PI,!1),i.fillStyle=this._teleportationFillColor,i.fill(),i.lineWidth=10,i.strokeStyle=this._teleportationBorderColor,i.stroke(),i.closePath(),t.update();var r=new e.StandardMaterial("TextPlaneMaterial",this._scene);r.diffuseTexture=t,this._teleportationTarget.material=r;var n=e.Mesh.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);n.isPickable=!1,n.__uv$setSource(__uv).__uv$parent=this._teleportationTarget;var a=new e.Animation("animationInnerCircle","position.y",30,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CYCLE),o=[];o.push({frame:0,value:0}),o.push({frame:30,value:.4}),o.push({frame:60,value:0}),a.setKeys(o);var s=new e.SineEase;s.setEasingMode(e.EasingFunction.EASINGMODE_EASEINOUT),a.setEasingFunction(s),n.animations=[],n.animations.push(a),this._scene.beginAnimation(n,0,60,!0),this._hideTeleportationTarget()},t.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[__uv.$wrap((0))].isVisible=!0))},t.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[__uv.$wrap((0))].isVisible=!1))},t.prototype._rotateCamera=function(t){var i=this;if(this.currentVRCamera instanceof e.FreeCamera){t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var r=e.Quaternion.FromRotationMatrix(e.Matrix.RotationY(Math.PI/4*this._rotationAngle)),n=new e.Animation("animationRotation","rotationQuaternion",90,e.Animation.ANIMATIONTYPE_QUATERNION,e.Animation.ANIMATIONLOOPMODE_CONSTANT),a=[];a.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),a.push({frame:6,value:r}),n.setKeys(a),n.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(n),this._postProcessMove.animations=[];var o=new e.Animation("animationPP","vignetteWeight",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:0}),s.push({frame:3,value:4}),s.push({frame:6,value:0}),o.setKeys(s),o.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(o);var l=new e.Animation("animationPP2","vignetteStretch",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT),c=[];c.push({frame:0,value:0}),c.push({frame:3,value:10}),c.push({frame:6,value:0}),l.setKeys(c),l.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(l),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,(function(){i._webVRCamera.detachPostProcess(i._postProcessMove)})),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},t.prototype._moveTeleportationSelectorTo=function(t,i,r){if(t.pickedPoint){i._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint));var n=this._convertNormalToDirectionOfRay(t.getNormal(!0,!1),r);if(n){var a=e.Vector3.Cross(e.Axis.Y,n),o=e.Vector3.Cross(n,a);e.Vector3.RotationFromAxisToRef(o,n,a,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},t.prototype.teleportCamera=function(t){var i=this;if(this.currentVRCamera instanceof e.FreeCamera){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),t.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(t),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector),this.currentVRCamera.animations=[];var r=new e.Animation("animationCameraTeleportation","position",90,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_CONSTANT),n=[{frame:0,value:this.currentVRCamera.position},{frame:11,value:this._workingVector}];r.setKeys(n),r.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(r),this._postProcessMove.animations=[];var a=new e.Animation("animationPP","vignetteWeight",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:0}),o.push({frame:5,value:8}),o.push({frame:11,value:0}),a.setKeys(o),this._postProcessMove.animations.push(a);var s=new e.Animation("animationPP2","vignetteStretch",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT),l=[];l.push({frame:0,value:0}),l.push({frame:5,value:10}),l.push({frame:11,value:0}),s.setKeys(l),this._postProcessMove.animations.push(s),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,11,!1,1,(function(){i._webVRCamera.detachPostProcess(i._postProcessMove)})),this._scene.beginAnimation(this.currentVRCamera,0,11,!1,1,(function(){i.onAfterCameraTeleport.notifyObservers(i._workingVector)})),this._hideTeleportationTarget()}},t.prototype._convertNormalToDirectionOfRay=function(t,i){t&&(Math.acos(e.Vector3.Dot(t,i.direction))<Math.PI/2&&t.scaleInPlace(-1));return t},t.prototype._castRayAndSelectObject=function(t){if(this.currentVRCamera instanceof e.FreeCamera){var i=t._getForwardRay(this._rayLength),r=this._scene.pickWithRay(i,this._raySelectionPredicate);if(r&&(t._laserPointer&&(r.originMesh=t._laserPointer.__uv$setSource(__uv).__uv$parent),this._scene.simulatePointerMove(r,{pointerId:t._id})),t._currentHit=r,r&&r.pickedPoint){if(this._displayGaze){var n=1;t._gazeTracker.isVisible=!0,t._isActionableMesh&&(n=3),this.updateGazeTrackerScale&&(t._gazeTracker.scaling.x=r.distance*n,t._gazeTracker.scaling.y=r.distance*n,t._gazeTracker.scaling.z=r.distance*n);var a=this._convertNormalToDirectionOfRay(r.getNormal(),i);if(a){var o=e.Vector3.Cross(e.Axis.Y,a),s=e.Vector3.Cross(a,o);e.Vector3.RotationFromAxisToRef(s,a,o,t._gazeTracker.rotation)}t._gazeTracker.position.copyFrom(r.pickedPoint),t._gazeTracker.position.x<0?t._gazeTracker.position.x+=.002:t._gazeTracker.position.x-=.002,t._gazeTracker.position.y<0?t._gazeTracker.position.y+=.002:t._gazeTracker.position.y-=.002,t._gazeTracker.position.z<0?t._gazeTracker.position.z+=.002:t._gazeTracker.position.z-=.002}t._updatePointerDistance(r.distance)}else t._updatePointerDistance(),t._gazeTracker.isVisible=!1;if(r&&r.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(r.pickedMesh)&&r.pickedPoint)return t._currentMeshSelected&&!this._isTeleportationFloor(t._currentMeshSelected)&&this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,void(t._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(r,t,i));if(r.pickedMesh!==t._currentMeshSelected)if(this.meshSelectionPredicate(r.pickedMesh)){this.onNewMeshPicked.notifyObservers(r),t._currentMeshSelected=r.pickedMesh,r.pickedMesh.isPickable&&r.pickedMesh.actionManager?(this.changeGazeColor(new e.Color3(0,0,1)),this.changeLaserColor(new e.Color3(.2,.2,1)),t._isActionableMesh=!0):(this.changeGazeColor(new e.Color3(.7,.7,.7)),this.changeLaserColor(new e.Color3(.7,.7,.7)),t._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(r.pickedMesh)}catch(t){e.Tools.Warn("Error in your custom logic onNewMeshSelected: "+t)}}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(new e.Color3(.7,.7,.7)),this.changeLaserColor(new e.Color3(.7,.7,.7))}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(new e.Color3(.7,.7,.7)),this.changeLaserColor(new e.Color3(.7,.7,.7))}},t.prototype._notifySelectedMeshUnselected=function(e){e&&this.onSelectedMeshUnselected.notifyObservers(e)},t.prototype.changeLaserColor=function(e){this._leftController&&this._leftController._setLaserPointerColor(e),this._rightController&&this._rightController._setLaserPointerColor(e)},t.prototype.changeGazeColor=function(e){this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=e,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=e),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=e))},t.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},t.prototype.getClassName=function(){return"VRExperienceHelper"},t}();e.VRExperienceHelper=n}(s||(s={})),function(e){var t;!function(e){e[__uv.$wrap((e.X=0))]="X",e[__uv.$wrap((e.Y=1))]="Y",e[__uv.$wrap((e.Z=2))]="Z"}(t=e.JoystickAxis||(e.JoystickAxis={}));var i=function(){function i(r){var n=this;if(this._leftJoystick=!!r,i._globalJoystickIndex++,this._axisTargetedByLeftAndRight=t.X,this._axisTargetedByUpAndDown=t.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new e.StringDictionary,this.deltaPosition=e.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(e){i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.vjCanvas&&(i.vjCanvas.width=i.vjCanvasWidth,i.vjCanvas.height=i.vjCanvasHeight),i.halfWidth=i.vjCanvasWidth/2},!i.vjCanvas){window.addEventListener("resize",this._onResize,!1),i.vjCanvas=document.createElement("canvas"),i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.vjCanvas.width=window.innerWidth,i.vjCanvas.height=window.innerHeight,i.vjCanvas.style.width="100%",i.vjCanvas.style.height="100%",i.vjCanvas.style.position="absolute",i.vjCanvas.style.backgroundColor="transparent",i.vjCanvas.style.__uv$setSource(__uv).__uv$top="0px",i.vjCanvas.style.left="0px",i.vjCanvas.style.zIndex="5",i.vjCanvas.style.msTouchAction="none",i.vjCanvas.setAttribute("touch-action","none");var a=i.vjCanvas.getContext("2d");if(!a)throw new Error("Unable to create canvas for virtual joystick");i.vjCanvasContext=a,i.vjCanvasContext.strokeStyle="#ffffff",i.vjCanvasContext.lineWidth=2,document.body.appendChild(i.vjCanvas)}i.halfWidth=i.vjCanvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new e.Vector2(0,0),this._joystickPreviousPointerPos=new e.Vector2(0,0),this._joystickPointerStartPos=new e.Vector2(0,0),this._deltaJoystickVector=new e.Vector2(0,0),this._onPointerDownHandlerRef=function(e){n._onPointerDown(e)},this._onPointerMoveHandlerRef=function(e){n._onPointerMove(e)},this._onPointerUpHandlerRef=function(e){n._onPointerUp(e)},i.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),i.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),i.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),i.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),i.vjCanvas.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),requestAnimationFrame((function(){n._drawVirtualJoystick()}))}return i.prototype.setJoystickSensibility=function(e){this._joystickSensibility=e,this._inversedSensibility=1/(this._joystickSensibility/1e3)},i.prototype._onPointerDown=function(e){e.preventDefault(),(!0===this._leftJoystick?e.clientX<i.halfWidth:e.clientX>i.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=e.pointerId,this._joystickPointerStartPos.x=e.clientX,this._joystickPointerStartPos.y=e.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(e.pointerId.toString(),e)):i._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(e.pointerId.toString(),{x:e.clientX,y:e.clientY,prevX:e.clientX,prevY:e.clientY}))},i.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var i=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,i));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,i));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,i))}var r=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,r));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,r));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,r))}}else{var n=this._touches.get(e.pointerId.toString());n&&(n.x=e.clientX,n.y=e.clientY)}},i.prototype._onPointerUp=function(e){if(this._joystickPointerID==e.pointerId)i.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),i.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var t=this._touches.get(e.pointerId.toString());t&&i.vjCanvasContext.clearRect(t.prevX-44,t.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(e.pointerId.toString())},i.prototype.setJoystickColor=function(e){this._joystickColor=e},i.prototype.setActionOnTouch=function(e){this._action=e},i.prototype.setAxisForLeftRight=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByLeftAndRight=e;break;default:this._axisTargetedByLeftAndRight=t.X}},i.prototype.setAxisForUpDown=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByUpAndDown=e;break;default:this._axisTargetedByUpAndDown=t.Y}},i.prototype._drawVirtualJoystick=function(){var e=this;this.pressed&&this._touches.forEach((function(t,r){r.pointerId===e._joystickPointerID?(i.vjCanvasContext.clearRect(e._joystickPointerStartPos.x-64,e._joystickPointerStartPos.y-64,128,128),i.vjCanvasContext.clearRect(e._joystickPreviousPointerPos.x-42,e._joystickPreviousPointerPos.y-42,84,84),i.vjCanvasContext.beginPath(),i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,60,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.arc(e._joystickPointerPos.x,e._joystickPointerPos.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),e._joystickPreviousPointerPos=e._joystickPointerPos.clone()):(i.vjCanvasContext.clearRect(r.prevX-44,r.prevY-44,88,88),i.vjCanvasContext.beginPath(),i.vjCanvasContext.fillStyle="white",i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle="red",i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.arc(r.x,r.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),r.prevX=r.x,r.prevY=r.y)})),requestAnimationFrame((function(){e._drawVirtualJoystick()}))},i.prototype.releaseCanvas=function(){i.vjCanvas&&(i.vjCanvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),i.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),i.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),i.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(i.vjCanvas),i.vjCanvas=null)},i._globalJoystickIndex=0,i}();e.VirtualJoystick=i}(s||(s={})),function(e){e.Node.AddNodeConstructor("VirtualJoysticksCamera",(function(i,r){return function(){return new t(i,e.Vector3.Zero(),r)}}));var t=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.inputs.addVirtualJoystick(),n}return a(t,e),t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(e.FreeCamera);e.VirtualJoysticksCamera=t}(s||(s={})),function(e){var t=function(){function t(){}return t.prototype.getLeftJoystick=function(){return this._leftjoystick},t.prototype.getRightJoystick=function(){return this._rightjoystick},t.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,i=50*t._computeLocalCameraSpeed(),r=e.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),n=e.Vector3.TransformCoordinates(new e.Vector3(this._leftjoystick.deltaPosition.x*i,this._leftjoystick.deltaPosition.y*i,this._leftjoystick.deltaPosition.z*i),r);t.cameraDirection=t.cameraDirection.add(n),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},t.prototype.attachControl=function(t,i){this._leftjoystick=new e.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(e.JoystickAxis.Z),this._leftjoystick.setAxisForLeftRight(e.JoystickAxis.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new e.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(e.JoystickAxis.X),this._rightjoystick.setAxisForLeftRight(e.JoystickAxis.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},t.prototype.detachControl=function(e){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},t.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},t.prototype.getSimpleName=function(){return"virtualJoystick"},t}();e.FreeCameraVirtualJoystickInput=t,e.CameraInputTypes.FreeCameraVirtualJoystickInput=t}(s||(s={})),function(e){var t=function(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i};e.SimplificationSettings=t;var i,r=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach((function(e){i.getSimplifier(t).simplify(e,(function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,e.quality===t.settings[__uv.$wrap((t.settings.length-1))].quality&&t.successCallback&&t.successCallback(),i.executeNext()}))}));else{var r=this.getSimplifier(t);e.AsyncLoop.Run(t.settings.length,(function(e){var i,n;i=t.settings[__uv.$wrap((e.index))],n=function(){e.executeNext()},r.simplify(i,(function(e){t.mesh.addLODLevel(i.distance,e),e.isVisible=!0,n()}))}),(function(){t.successCallback&&t.successCallback(),i.executeNext()}))}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case i.QUADRATIC:default:return new l(e.mesh)}},t}();e.SimplificationQueue=r,function(e){e[__uv.$wrap((e.QUADRATIC=0))]="QUADRATIC"}(i=e.SimplificationType||(e.SimplificationType={}));var n=function(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},a=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new o,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}(),o=function(){function e(e){this.data=new Array(10);for(var t=0;t<10;++t)e&&e[__uv.$wrap((t))]?this.data[__uv.$wrap((t))]=e[__uv.$wrap((t))]:this.data[__uv.$wrap((t))]=0}return e.prototype.det=function(e,t,i,r,n,a,o,s,l){return this.data[__uv.$wrap((e))]*this.data[__uv.$wrap((n))]*this.data[__uv.$wrap((l))]+this.data[__uv.$wrap((i))]*this.data[__uv.$wrap((r))]*this.data[__uv.$wrap((s))]+this.data[__uv.$wrap((t))]*this.data[__uv.$wrap((a))]*this.data[__uv.$wrap((o))]-this.data[__uv.$wrap((i))]*this.data[__uv.$wrap((n))]*this.data[__uv.$wrap((o))]-this.data[__uv.$wrap((e))]*this.data[__uv.$wrap((a))]*this.data[__uv.$wrap((s))]-this.data[__uv.$wrap((t))]*this.data[__uv.$wrap((r))]*this.data[__uv.$wrap((l))]},e.prototype.addInPlace=function(e){for(var t=0;t<10;++t)this.data[__uv.$wrap((t))]+=e.data[__uv.$wrap((t))]},e.prototype.addArrayInPlace=function(e){for(var t=0;t<10;++t)this.data[__uv.$wrap((t))]+=e[__uv.$wrap((t))]},e.prototype.add=function(t){for(var i=new e,r=0;r<10;++r)i.data[__uv.$wrap((r))]=this.data[__uv.$wrap((r))]+t.data[__uv.$wrap((r))];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}(),s=function(e,t){this.vertexId=e,this.triangleId=t},l=function(){function t(t){this._mesh=t,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Epsilon}return t.prototype.simplify=function(t,i){var r=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,(function(e){r.initWithMesh(e.index,(function(){r.runDecimation(t,e.index,(function(){e.executeNext()}))}),t.optimizeMesh)}),(function(){setTimeout((function(){i(r._reconstructedMesh)}),0)}))},t.prototype.runDecimation=function(t,i,r){var n=this,a=~~(this.triangles.length*t.quality),o=0,s=this.triangles.length;e.AsyncLoop.Run(this.decimationIterations,(function(t){var i,r;s-o<=a?t.breakLoop():(i=t.index,r=function(){t.executeNext()},setTimeout((function(){i%5==0&&n.updateMesh(0===i);for(var t=0;t<n.triangles.length;++t)n.triangles[__uv.$wrap((t))].isDirty=!1;var l=1e-9*Math.pow(i+3,n.aggressiveness);e.AsyncLoop.SyncAsyncForLoop(n.triangles.length,n.syncIterations,(function(t){var i=~~((n.triangles.length/2+t)%n.triangles.length),r=n.triangles[__uv.$wrap((i))];if(r&&!(r.error[__uv.$wrap((3))]>l||r.deleted||r.isDirty))for(var a=0;a<3;++a)if(r.error[__uv.$wrap((a))]<l){var s=[],c=[],u=r.vertices[__uv.$wrap((a))],h=r.vertices[__uv.$wrap(((a+1)%3))];if(u.isBorder||h.isBorder)continue;var d=e.Vector3.Zero(),p=e.Vector3.Zero(),m=e.Vector2.Zero(),_=new e.Color4(0,0,0,1);n.calculateError(u,h,d,p,m,_);var f=new Array;if(n.isFlipped(u,h,d,s,r.borderFactor,f))continue;if(n.isFlipped(h,u,d,c,r.borderFactor,f))continue;if(s.indexOf(!0)<0||c.indexOf(!0)<0)continue;var g=new Array;if(f.forEach((function(e){-1===g.indexOf(e)&&(e.deletePending=!0,g.push(e))})),g.length%2!=0)continue;u.q=h.q.add(u.q),u.updatePosition(d);var y=n.references.length;o=n.updateTriangles(u,u,s,o),o=n.updateTriangles(u,h,c,o);var v=n.references.length-y;if(v<=u.triangleCount){if(v)for(var b=0;b<v;b++)n.references[__uv.$wrap((u.triangleStart+b))]=n.references[__uv.$wrap((y+b))]}else u.triangleStart=y;u.triangleCount=v;break}}),r,(function(){return s-o<=a}))}),0))}),(function(){setTimeout((function(){n.reconstructMesh(i),r()}),0)}))},t.prototype.initWithMesh=function(t,i,r){var o=this;this.vertices=[],this.triangles=[];var s=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),l=this._mesh.getIndices(),c=this._mesh.subMeshes[__uv.$wrap((t))],u=[],h=c.verticesCount;e.AsyncLoop.SyncAsyncForLoop(h,this.syncIterations/4>>0,(function(t){if(s){var i=t+c.verticesStart,n=e.Vector3.FromArray(s,3*i),l=function(e){if(r)for(var t=0;t<o.vertices.length;++t)if(o.vertices[__uv.$wrap((t))].position.equals(e))return o.vertices[__uv.$wrap((t))];return null}(n)||new a(n,o.vertices.length);l.originalOffsets.push(i),l.id===o.vertices.length&&o.vertices.push(l),u.push(l.id)}}),(function(){e.AsyncLoop.SyncAsyncForLoop(c.indexCount/3,o.syncIterations,(function(e){if(l){var t=3*(c.indexStart/3+e),i=l[__uv.$wrap((t+0))],r=l[__uv.$wrap((t+1))],a=l[__uv.$wrap((t+2))],s=o.vertices[__uv.$wrap((u[__uv.$wrap((i-c.verticesStart))]))],h=o.vertices[__uv.$wrap((u[__uv.$wrap((r-c.verticesStart))]))],d=o.vertices[__uv.$wrap((u[__uv.$wrap((a-c.verticesStart))]))],p=new n([s,h,d]);p.originalOffset=t,o.triangles.push(p)}}),(function(){o.init(i)}))}))},t.prototype.init=function(t){var i=this;e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,(function(t){var r=i.triangles[__uv.$wrap((t))];r.normal=e.Vector3.Cross(r.vertices[__uv.$wrap((1))].position.subtract(r.vertices[__uv.$wrap((0))].position),r.vertices[__uv.$wrap((2))].position.subtract(r.vertices[__uv.$wrap((0))].position)).normalize();for(var n=0;n<3;n++)r.vertices[__uv.$wrap((n))].q.addArrayInPlace(o.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-e.Vector3.Dot(r.normal,r.vertices[__uv.$wrap((0))].position)))}),(function(){e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,(function(e){for(var t=i.triangles[__uv.$wrap((e))],r=0;r<3;++r)t.error[__uv.$wrap((r))]=i.calculateError(t.vertices[__uv.$wrap((r))],t.vertices[__uv.$wrap(((r+1)%3))]);t.error[__uv.$wrap((3))]=Math.min(t.error[__uv.$wrap((0))],t.error[__uv.$wrap((1))],t.error[__uv.$wrap((2))])}),(function(){t()}))}))},t.prototype.reconstructMesh=function(t){var i,r,n,a=[];for(i=0;i<this.vertices.length;++i)this.vertices[__uv.$wrap((i))].triangleCount=0;for(i=0;i<this.triangles.length;++i)if(!this.triangles[__uv.$wrap((i))].deleted){for(r=this.triangles[__uv.$wrap((i))],n=0;n<3;++n)r.vertices[__uv.$wrap((n))].triangleCount=1;a.push(r)}var o=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],l=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],c=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],u=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),h=this._mesh.getVerticesData(e.VertexBuffer.UVKind),d=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),p=0;for(i=0;i<this.vertices.length;++i){var m=this.vertices[__uv.$wrap((i))];m.id=p,m.triangleCount&&m.originalOffsets.forEach((function(e){u&&(o.push(m.position.x),o.push(m.position.y),o.push(m.position.z),s.push(u[__uv.$wrap((3*e))]),s.push(u[__uv.$wrap((3*e+1))]),s.push(u[__uv.$wrap((3*e+2))]),h&&h.length?(l.push(h[__uv.$wrap((2*e))]),l.push(h[__uv.$wrap((2*e+1))])):d&&d.length&&(c.push(d[__uv.$wrap((4*e))]),c.push(d[__uv.$wrap((4*e+1))]),c.push(d[__uv.$wrap((4*e+2))]),c.push(d[__uv.$wrap((4*e+3))])),++p)}))}var _=this._reconstructedMesh.getTotalIndices(),f=this._reconstructedMesh.getTotalVertices(),g=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var y=this._reconstructedMesh.getIndices(),v=this._mesh.getIndices();for(i=0;i<a.length;++i)r=a[__uv.$wrap((i))],[0,1,2].forEach((function(e){var t=v[__uv.$wrap((r.originalOffset+e))],i=r.vertices[__uv.$wrap((e))].originalOffsets.indexOf(t);i<0&&(i=0),y.push(r.vertices[__uv.$wrap((e))].id+i+f)}));this._reconstructedMesh.setIndices(y),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,o),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,s),l.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,l),c.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,c);var b=this._mesh.subMeshes[__uv.$wrap((t))];t>0&&(this._reconstructedMesh.subMeshes=[],g.forEach((function(t){e.SubMesh.AddToMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())})),e.SubMesh.AddToMesh(b.materialIndex,f,p,_,3*a.length,this._reconstructedMesh))},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.__uv$setSource(__uv).__uv$parent=this._mesh.__uv$setSource(__uv).__uv$parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},t.prototype.isFlipped=function(t,i,r,n,a,o){for(var s=0;s<t.triangleCount;++s){var l=this.triangles[__uv.$wrap((this.references[__uv.$wrap((t.triangleStart+s))].triangleId))];if(!l.deleted){var c=this.references[__uv.$wrap((t.triangleStart+s))].vertexId,u=l.vertices[__uv.$wrap(((c+1)%3))],h=l.vertices[__uv.$wrap(((c+2)%3))];if(u!==i&&h!==i){var d=u.position.subtract(r);d=d.normalize();var p=h.position.subtract(r);if(p=p.normalize(),Math.abs(e.Vector3.Dot(d,p))>.999)return!0;var m=e.Vector3.Cross(d,p).normalize();if(n[__uv.$wrap((s))]=!1,e.Vector3.Dot(m,l.normal)<.2)return!0}else n[__uv.$wrap((s))]=!0,o.push(l)}}return!1},t.prototype.updateTriangles=function(e,t,i,r){for(var n=r,a=0;a<t.triangleCount;++a){var o=this.references[__uv.$wrap((t.triangleStart+a))],s=this.triangles[__uv.$wrap((o.triangleId))];s.deleted||(i[__uv.$wrap((a))]&&s.deletePending?(s.deleted=!0,n++):(s.vertices[__uv.$wrap((o.vertexId))]=e,s.isDirty=!0,s.error[__uv.$wrap((0))]=this.calculateError(s.vertices[__uv.$wrap((0))],s.vertices[__uv.$wrap((1))])+s.borderFactor/2,s.error[__uv.$wrap((1))]=this.calculateError(s.vertices[__uv.$wrap((1))],s.vertices[__uv.$wrap((2))])+s.borderFactor/2,s.error[__uv.$wrap((2))]=this.calculateError(s.vertices[__uv.$wrap((2))],s.vertices[__uv.$wrap((0))])+s.borderFactor/2,s.error[__uv.$wrap((3))]=Math.min(s.error[__uv.$wrap((0))],s.error[__uv.$wrap((1))],s.error[__uv.$wrap((2))]),this.references.push(o)))}return n},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],r=[],n=this.vertices[__uv.$wrap((e))];for(t=0;t<n.triangleCount;++t)for(var a=this.triangles[__uv.$wrap((this.references[__uv.$wrap((n.triangleStart+t))].triangleId))],o=0;o<3;o++){for(var s=0,l=a.vertices[__uv.$wrap((o))];s<i.length&&r[__uv.$wrap((s))]!==l.id;)++s;s===i.length?(i.push(1),r.push(l.id)):i[__uv.$wrap((s))]++}for(t=0;t<i.length;++t)1===i[__uv.$wrap((t))]?this.vertices[__uv.$wrap((r[__uv.$wrap((t))]))].isBorder=!0:this.vertices[__uv.$wrap((r[__uv.$wrap((t))]))].isBorder=!1}},t.prototype.updateMesh=function(e){var t,i,r,n;if(void 0===e&&(e=!1),!e){var a=[];for(t=0;t<this.triangles.length;++t)this.triangles[__uv.$wrap((t))].deleted||a.push(this.triangles[__uv.$wrap((t))]);this.triangles=a}for(t=0;t<this.vertices.length;++t)this.vertices[__uv.$wrap((t))].triangleCount=0,this.vertices[__uv.$wrap((t))].triangleStart=0;for(t=0;t<this.triangles.length;++t)for(i=this.triangles[__uv.$wrap((t))],r=0;r<3;++r)(n=i.vertices[__uv.$wrap((r))]).triangleCount++;var o=0;for(t=0;t<this.vertices.length;++t)this.vertices[__uv.$wrap((t))].triangleStart=o,o+=this.vertices[__uv.$wrap((t))].triangleCount,this.vertices[__uv.$wrap((t))].triangleCount=0;var l=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(i=this.triangles[__uv.$wrap((t))],r=0;r<3;++r)l[__uv.$wrap(((n=i.vertices[__uv.$wrap((r))]).triangleStart+n.triangleCount))]=new s(r,t),n.triangleCount++;this.references=l,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[__uv.$wrap((0))]*i*i+2*e.data[__uv.$wrap((1))]*i*r+2*e.data[__uv.$wrap((2))]*i*n+2*e.data[__uv.$wrap((3))]*i+e.data[__uv.$wrap((4))]*r*r+2*e.data[__uv.$wrap((5))]*r*n+2*e.data[__uv.$wrap((6))]*r+e.data[__uv.$wrap((7))]*n*n+2*e.data[__uv.$wrap((8))]*n+e.data[__uv.$wrap((9))]},t.prototype.calculateError=function(t,i,r,n,a,o){var s=t.q.add(i.q),l=t.isBorder&&i.isBorder,c=0,u=s.det(0,1,2,1,4,5,2,5,7);if(0===u||l){var h=t.position.add(i.position).divide(new e.Vector3(2,2,2)),d=this.vertexError(s,t.position),p=this.vertexError(s,i.position),m=this.vertexError(s,h);(c=Math.min(d,p,m))===d?r&&r.copyFrom(t.position):c===p?r&&r.copyFrom(i.position):r&&r.copyFrom(h)}else r||(r=e.Vector3.Zero()),r.x=-1/u*s.det(1,2,3,4,5,6,5,7,8),r.y=1/u*s.det(0,2,3,1,5,6,2,7,8),r.z=-1/u*s.det(0,1,3,1,4,6,2,5,8),c=this.vertexError(s,r);return c},t}()}(s||(s={})),function(e){Object.defineProperty(e.Scene.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new e.SimplificationQueue;var i=this._getComponent(e.SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE);i||(i=new t(this),this._addComponent(i))}return this._simplificationQueue},set:function(e){this._simplificationQueue=e},enumerable:!0,configurable:!0}),e.Mesh.prototype.simplify=function(t,i,r,n){return void 0===i&&(i=!0),void 0===r&&(r=e.SimplificationType.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:t,parallelProcessing:i,mesh:this,simplificationType:r,successCallback:n}),this};var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE,this.scene=t}return t.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},t}();e.SimplicationQueueSceneComponent=t}(s||(s={})),function(e){var t=function(e,t){this.distance=e,this.mesh=t};e.MeshLODLevel=t}(s||(s={})),function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e}return e.prototype.getDescription=function(){return""},e.prototype.apply=function(e,t){return!0},e}();e.SceneOptimization=t;var i=function(e){function t(t,i,r){void 0===t&&(t=0),void 0===i&&(i=1024),void 0===r&&(r=.5);var n=e.call(this,t)||this;return n.priority=t,n.maximumSize=i,n.step=r,n}return a(t,e),t.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},t.prototype.apply=function(e,t){for(var i=!0,r=0;r<e.textures.length;r++){var n=e.textures[__uv.$wrap((r))];if(n.canRescale&&!n.getContext){var a=n.getSize();Math.max(a.width,a.height)>this.maximumSize&&(n.scale(this.step),i=!1)}}return i},t}(t);e.TextureOptimization=i;var r=function(e){function t(t,i,r){void 0===t&&(t=0),void 0===i&&(i=2),void 0===r&&(r=.25);var n=e.call(this,t)||this;return n.priority=t,n.maximumScale=i,n.step=r,n._currentScale=-1,n._directionOffset=1,n}return a(t,e),t.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},t.prototype.apply=function(e,t){return-1===this._currentScale&&(this._currentScale=e.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,e.getEngine().setHardwareScalingLevel(this._currentScale),1===this._directionOffset?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},t}(t);e.HardwareScalingOptimization=r;var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getDescription=function(){return"Turning shadows on/off"},t.prototype.apply=function(e,t){return e.shadowsEnabled=t.isInImprovementMode,!0},t}(t);e.ShadowsOptimization=n;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getDescription=function(){return"Turning post-processes on/off"},t.prototype.apply=function(e,t){return e.postProcessesEnabled=t.isInImprovementMode,!0},t}(t);e.PostProcessesOptimization=o;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getDescription=function(){return"Turning lens flares on/off"},t.prototype.apply=function(e,t){return e.lensFlaresEnabled=t.isInImprovementMode,!0},t}(t);e.LensFlaresOptimization=s;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},t.prototype.apply=function(e,t){return!this.onApply||this.onApply(e,t)},t}(t);e.CustomOptimization=l;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getDescription=function(){return"Turning particles on/off"},t.prototype.apply=function(e,t){return e.particlesEnabled=t.isInImprovementMode,!0},t}(t);e.ParticlesOptimization=c;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.getDescription=function(){return"Turning render targets off"},t.prototype.apply=function(e,t){return e.renderTargetsEnabled=t.isInImprovementMode,!0},t}(t);e.RenderTargetsOptimization=u;var h=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return!i.isDisposed()&&(!(!i.isVisible||!i.isEnabled())&&(!(i.instances.length>0)&&(!i.skeleton&&!i.hasLODLevels)))},i}return a(i,t),Object.defineProperty(i,"UpdateSelectionTree",{get:function(){return i._UpdateSelectionTree},set:function(e){i._UpdateSelectionTree=e},enumerable:!0,configurable:!0}),i.prototype.getDescription=function(){return"Merging similar meshes together"},i.prototype.apply=function(t,r,n){for(var a=t.meshes.slice(0),o=a.length,s=0;s<o;s++){var l=new Array,c=a[__uv.$wrap((s))];if(this._canBeMerged(c)){l.push(c);for(var u=s+1;u<o;u++){var h=a[__uv.$wrap((u))];this._canBeMerged(h)&&(h.material===c.material&&h.checkCollisions===c.checkCollisions&&(l.push(h),o--,a.splice(u,1),u--))}l.length<2||e.Mesh.MergeMeshes(l,void 0,!0)}}var d=t;return d.createOrUpdateSelectionOctree&&(null!=n?n&&d.createOrUpdateSelectionOctree():i.UpdateSelectionTree&&d.createOrUpdateSelectionOctree()),!0},i._UpdateSelectionTree=!1,i}(t);e.MergeMeshesOptimization=h;var d=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.prototype.addOptimization=function(e){return this.optimizations.push(e),this},e.prototype.addCustomOptimization=function(e,t,i){void 0===i&&(i=0);var r=new l(i);return r.onApply=e,r.onGetDescription=t,this.optimizations.push(r),this},e.LowDegradationAllowed=function(t){var r=new e(t),a=0;return r.addOptimization(new h(a)),r.addOptimization(new n(a)),r.addOptimization(new s(a)),a++,r.addOptimization(new o(a)),r.addOptimization(new c(a)),a++,r.addOptimization(new i(a,1024)),r},e.ModerateDegradationAllowed=function(t){var a=new e(t),l=0;return a.addOptimization(new h(l)),a.addOptimization(new n(l)),a.addOptimization(new s(l)),l++,a.addOptimization(new o(l)),a.addOptimization(new c(l)),l++,a.addOptimization(new i(l,512)),l++,a.addOptimization(new u(l)),l++,a.addOptimization(new r(l,2)),a},e.HighDegradationAllowed=function(t){var a=new e(t),l=0;return a.addOptimization(new h(l)),a.addOptimization(new n(l)),a.addOptimization(new s(l)),l++,a.addOptimization(new o(l)),a.addOptimization(new c(l)),l++,a.addOptimization(new i(l,256)),l++,a.addOptimization(new u(l)),l++,a.addOptimization(new r(l,4)),a},e}();e.SceneOptimizerOptions=d;var p=function(){function t(t,i,r,n){void 0===r&&(r=!0),void 0===n&&(n=!1);var a=this;if(this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2e3,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new e.Observable,this.onNewOptimizationAppliedObservable=new e.Observable,this.onFailureObservable=new e.Observable,this._options=i||new d,this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),r)for(var o=0,s=0,l=this._options.optimizations;s<l.length;s++){l[__uv.$wrap((s))].priority=o++}this._improvementMode=n,this._scene=t||e.Engine.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add((function(){a._sceneDisposeObserver=null,a.dispose()}))}return Object.defineProperty(t.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(e){this._trackerDuration=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!0,configurable:!0}),t.prototype.stop=function(){this._isRunning=!1},t.prototype.reset=function(){this._currentPriorityLevel=0},t.prototype.start=function(){var e=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady((function(){setTimeout((function(){e._checkCurrentState()}),e._trackerDuration)})))},t.prototype._checkCurrentState=function(){var e=this;if(this._isRunning){var t=this._scene,i=this._options;if(this._currentFrameRate=Math.round(t.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var r=!0,n=!0,a=0;a<i.optimizations.length;a++){var o=i.optimizations[__uv.$wrap((a))];o.priority===this._currentPriorityLevel&&(n=!1,r=r&&o.apply(t,this),this.onNewOptimizationAppliedObservable.notifyObservers(o))}if(n)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);r&&this._currentPriorityLevel++,t.executeWhenReady((function(){setTimeout((function(){e._checkCurrentState()}),e._trackerDuration)}))}},t.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},t.OptimizeAsync=function(e,i,r,n){var a=new t(e,i||d.ModerateDegradationAllowed(),!1);return r&&a.onSuccessObservable.add((function(){r()})),n&&a.onFailureObservable.add((function(){n()})),a.start(),a},t}();e.SceneOptimizer=p}(s||(s={})),function(e){e.Scene.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new t(this)),this._outlineRenderer},Object.defineProperty(e.AbstractMesh.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOutline=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.AbstractMesh.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOverlay=e},enumerable:!0,configurable:!0});var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=t,this._engine=t.getEngine(),this.scene._addComponent(this)}return t.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(e.SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t.prototype.render=function(t,i,r){var n=this;void 0===r&&(r=!1);var a=this.scene,o=a.getEngine(),s=o.getCaps().instancedArrays&&null!==i.visibleInstances[__uv.$wrap((t._id))]&&void 0!==i.visibleInstances[__uv.$wrap((t._id))];if(this.isReady(t,s)){var l=t.getRenderingMesh(),c=t.getMaterial();if(c&&a.activeCamera){if(o.enableEffect(this._effect),c.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(a.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",r?0:l.outlineWidth),this._effect.setColor4("color",r?l.overlayColor:l.outlineColor,r?l.overlayAlpha:c.alpha),this._effect.setMatrix("viewProjection",a.getTransformMatrix()),l.useBones&&l.computeBonesUsingShaders&&l.skeleton&&this._effect.setMatrices("mBones",l.skeleton.getTransformMatrices(l)),l._bind(t,this._effect,e.Material.TriangleFillMode),c&&c.needAlphaTesting()){var u=c.getAlphaTestTexture();u&&(this._effect.setTexture("diffuseSampler",u),this._effect.setMatrix("diffuseMatrix",u.getTextureMatrix()))}o.setZOffset(-this.zOffset),l._processRendering(t,this._effect,e.Material.TriangleFillMode,i,s,(function(e,t){n._effect.setMatrix("world",t)})),o.setZOffset(0)}}},t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],a=t.getMesh(),o=t.getMaterial();o&&(o.needAlphaTesting()&&(r.push("#define ALPHATEST"),a.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push("#define UV1")),a.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push("#define UV2"))),o.useLogarithmicDepth&&r.push("#define LOGARITHMICDEPTH")),a.useBones&&a.computeBonesUsingShaders?(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),a.numBoneInfluencers>4&&(n.push(e.VertexBuffer.MatricesIndicesExtraKind),n.push(e.VertexBuffer.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),r.push("#define BonesPerMesh "+(a.skeleton?a.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0"),i&&(r.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"));var s=r.join("\n");return this._cachedDefines!==s&&(this._cachedDefines=s,this._effect=this.scene.getEngine().createEffect("outline",n,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant"],["diffuseSampler"],s)),this._effect.isReady()},t.prototype._beforeRenderingMesh=function(e,t,i){this._savedDepthWrite=this._engine.getDepthWrite(),e.renderOutline&&(this._engine.setDepthWrite(!1),this.render(t,i),this._engine.setDepthWrite(this._savedDepthWrite))},t.prototype._afterRenderingMesh=function(t,i,r){if(t.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(i,r),this._engine.setColorWrite(!0)),t.renderOverlay){var n=this._engine.getAlphaMode();this._engine.setAlphaMode(e.Engine.ALPHA_COMBINE),this.render(i,r,!0),this._engine.setAlphaMode(n)}},t}();e.OutlineRenderer=t}(s||(s={})),function(e){e.AbstractMesh.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},e.AbstractMesh.prototype.enableEdgesRendering=function(e,t){return void 0===e&&(e=.95),void 0===t&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new i(this,e,t),this},Object.defineProperty(e.AbstractMesh.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),e.LinesMesh.prototype.enableEdgesRendering=function(t,i){return void 0===t&&(t=.95),void 0===i&&(i=!1),this.disableEdgesRendering(),this._edgesRenderer=new e.LineEdgesRenderer(this,t,i),this};var t=function(){this.edges=new Array,this.edgesConnectedCount=0},i=function(){function i(e,t,i,r){void 0===t&&(t=.95),void 0===i&&(i=!1),void 0===r&&(r=!0);var n=this;this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this._source=e,this._checkVerticesInsteadOfIndices=i,this._epsilon=t,this._prepareRessources(),r&&this._generateEdgesLines(),this._meshRebuildObserver=this._source.onRebuildObservable.add((function(){n._rebuild()})),this._meshDisposeObserver=this._source.onDisposeObservable.add((function(){n.dispose()}))}return i.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new e.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},i.prototype._rebuild=function(){var t=this._buffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&t._rebuild(),(t=this._buffers[__uv.$wrap((e.VertexBuffer.NormalKind))])&&t._rebuild();var i=this._source.getScene().getEngine();this._ib=i.createIndexBuffer(this._linesIndices)},i.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var t=this._buffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&(t.dispose(),this._buffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=null),(t=this._buffers[__uv.$wrap((e.VertexBuffer.NormalKind))])&&(t.dispose(),this._buffers[__uv.$wrap((e.VertexBuffer.NormalKind))]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},i.prototype._processEdgeForAdjacencies=function(e,t,i,r,n){return e===i&&t===r||e===r&&t===i?0:e===r&&t===n||e===n&&t===r?1:e===n&&t===i||e===i&&t===n?2:-1},i.prototype._processEdgeForAdjacenciesWithVertices=function(e,t,i,r,n){return e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(r)||e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(i)?0:e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(n)||e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(r)?1:e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(i)||e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(n)?2:-1},i.prototype._checkEdge=function(t,i,r,n,a){var o;void 0===i?o=!0:o=e.Vector3.Dot(r[__uv.$wrap((t))],r[__uv.$wrap((i))])<this._epsilon;if(o){var s=this._linesPositions.length/3;n.subtract(a).normalize(),this._linesPositions.push(n.x),this._linesPositions.push(n.y),this._linesPositions.push(n.z),this._linesPositions.push(n.x),this._linesPositions.push(n.y),this._linesPositions.push(n.z),this._linesPositions.push(a.x),this._linesPositions.push(a.y),this._linesPositions.push(a.z),this._linesPositions.push(a.x),this._linesPositions.push(a.y),this._linesPositions.push(a.z),this._linesNormals.push(a.x),this._linesNormals.push(a.y),this._linesNormals.push(a.z),this._linesNormals.push(-1),this._linesNormals.push(a.x),this._linesNormals.push(a.y),this._linesNormals.push(a.z),this._linesNormals.push(1),this._linesNormals.push(n.x),this._linesNormals.push(n.y),this._linesNormals.push(n.z),this._linesNormals.push(-1),this._linesNormals.push(n.x),this._linesNormals.push(n.y),this._linesNormals.push(n.z),this._linesNormals.push(1),this._linesIndices.push(s),this._linesIndices.push(s+1),this._linesIndices.push(s+2),this._linesIndices.push(s),this._linesIndices.push(s+2),this._linesIndices.push(s+3)}},i.prototype._generateEdgesLines=function(){var i=this._source.getVerticesData(e.VertexBuffer.PositionKind),r=this._source.getIndices();if(r&&i){var n,a,o=new Array,s=new Array;for(n=0;n<r.length;n+=3){a=new t;var l=r[__uv.$wrap((n))],c=r[__uv.$wrap((n+1))],u=r[__uv.$wrap((n+2))];a.p0=new e.Vector3(i[__uv.$wrap((3*l))],i[__uv.$wrap((3*l+1))],i[__uv.$wrap((3*l+2))]),a.p1=new e.Vector3(i[__uv.$wrap((3*c))],i[__uv.$wrap((3*c+1))],i[__uv.$wrap((3*c+2))]),a.p2=new e.Vector3(i[__uv.$wrap((3*u))],i[__uv.$wrap((3*u+1))],i[__uv.$wrap((3*u+2))]);var h=e.Vector3.Cross(a.p1.subtract(a.p0),a.p2.subtract(a.p1));h.normalize(),s.push(h),o.push(a)}for(n=0;n<o.length;n++){a=o[__uv.$wrap((n))];for(var d=n+1;d<o.length;d++){var p=o[__uv.$wrap((d))];if(3===a.edgesConnectedCount)break;if(3!==p.edgesConnectedCount)for(var m=r[__uv.$wrap((3*d))],_=r[__uv.$wrap((3*d+1))],f=r[__uv.$wrap((3*d+2))],g=0;g<3;g++){var y=0;if(void 0===a.edges[__uv.$wrap((g))]){switch(g){case 0:y=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(a.p0,a.p1,p.p0,p.p1,p.p2):this._processEdgeForAdjacencies(r[__uv.$wrap((3*n))],r[__uv.$wrap((3*n+1))],m,_,f);break;case 1:y=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(a.p1,a.p2,p.p0,p.p1,p.p2):this._processEdgeForAdjacencies(r[__uv.$wrap((3*n+1))],r[__uv.$wrap((3*n+2))],m,_,f);break;case 2:y=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(a.p2,a.p0,p.p0,p.p1,p.p2):this._processEdgeForAdjacencies(r[__uv.$wrap((3*n+2))],r[__uv.$wrap((3*n))],m,_,f)}if(-1!==y&&(a.edges[__uv.$wrap((g))]=d,p.edges[__uv.$wrap((y))]=n,a.edgesConnectedCount++,p.edgesConnectedCount++,3===a.edgesConnectedCount))break}}}}for(n=0;n<o.length;n++){var v=o[__uv.$wrap((n))];this._checkEdge(n,v.edges[__uv.$wrap((0))],s,v.p0,v.p1),this._checkEdge(n,v.edges[__uv.$wrap((1))],s,v.p1,v.p2),this._checkEdge(n,v.edges[__uv.$wrap((2))],s,v.p2,v.p0)}var b=this._source.getScene().getEngine();this._buffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=new e.VertexBuffer(b,this._linesPositions,e.VertexBuffer.PositionKind,!1),this._buffers[__uv.$wrap((e.VertexBuffer.NormalKind))]=new e.VertexBuffer(b,this._linesNormals,e.VertexBuffer.NormalKind,!1,!1,4),this._ib=b.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i.prototype.isReady=function(){return this._lineShader.isReady()},i.prototype.render=function(){var t=this._source.getScene();if(this.isReady()&&t.activeCamera){var i=t.getEngine();this._lineShader._preBind(),1!==this._source.edgesColor.a?i.setAlphaMode(e.Engine.ALPHA_COMBINE):i.setAlphaMode(e.Engine.ALPHA_DISABLE),i.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),t.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),t.activeCamera.mode===e.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",i.getAspectRatio(t.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),i.drawElementsType(e.Material.TriangleFillMode,0,this._indicesCount),this._lineShader.unbind()}},i}();e.EdgesRenderer=i}(s||(s={})),function(e){var t=function(){this.edges=new Array,this.edgesConnectedCount=0},i=function(i){function r(e,t,r){void 0===t&&(t=.95),void 0===r&&(r=!1);var n=i.call(this,e,t,r,!1)||this;return n._generateEdgesLines(),n}return a(r,i),r.prototype._checkEdge=function(e,t,i,r,n){var a=this._linesPositions.length/3;r.subtract(n).normalize(),this._linesPositions.push(r.x),this._linesPositions.push(r.y),this._linesPositions.push(r.z),this._linesPositions.push(r.x),this._linesPositions.push(r.y),this._linesPositions.push(r.z),this._linesPositions.push(n.x),this._linesPositions.push(n.y),this._linesPositions.push(n.z),this._linesPositions.push(n.x),this._linesPositions.push(n.y),this._linesPositions.push(n.z),this._linesNormals.push(n.x),this._linesNormals.push(n.y),this._linesNormals.push(n.z),this._linesNormals.push(-1),this._linesNormals.push(n.x),this._linesNormals.push(n.y),this._linesNormals.push(n.z),this._linesNormals.push(1),this._linesNormals.push(r.x),this._linesNormals.push(r.y),this._linesNormals.push(r.z),this._linesNormals.push(-1),this._linesNormals.push(r.x),this._linesNormals.push(r.y),this._linesNormals.push(r.z),this._linesNormals.push(1),this._linesIndices.push(a),this._linesIndices.push(a+1),this._linesIndices.push(a+2),this._linesIndices.push(a),this._linesIndices.push(a+2),this._linesIndices.push(a+3)},r.prototype._generateEdgesLines=function(){var i=this._source.getVerticesData(e.VertexBuffer.PositionKind);if(this._source.getIndices()&&i){for(var r,n=new Array,a=new Array,o=0;o<i.length/3-1;o++){var s=new t;s.p0=new e.Vector3(i[__uv.$wrap((3*o))],i[__uv.$wrap((3*o+1))],i[__uv.$wrap((3*o+2))]),s.p1=new e.Vector3(i[__uv.$wrap((3*(o+1)))],i[__uv.$wrap((3*(o+1)+1))],i[__uv.$wrap((3*(o+1)+2))]),n.push(s)}for(r=0;r<n.length;r++){var l=n[__uv.$wrap((r))];this._checkEdge(r,l.edges[__uv.$wrap((0))],a,l.p0,l.p1)}var c=this._source.getScene().getEngine();this._buffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=new e.VertexBuffer(c,this._linesPositions,e.VertexBuffer.PositionKind,!1),this._buffers[__uv.$wrap((e.VertexBuffer.NormalKind))]=new e.VertexBuffer(c,this._linesNormals,e.VertexBuffer.NormalKind,!1,!1,4),this._ib=c.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},r}(e.EdgesRenderer);e.LineEdgesRenderer=i}(s||(s={})),function(e){e.AbstractScene.AddParser(e.SceneComponentConstants.NAME_EFFECTLAYER,(function(t,i,r,n){if(t.effectLayers){r.effectLayers||(r.effectLayers=new Array);for(var a=0;a<t.effectLayers.length;a++){var o=e.EffectLayer.Parse(t.effectLayers[__uv.$wrap((a))],i,n);r.effectLayers.push(o)}}})),e.AbstractScene.prototype.removeEffectLayer=function(e){var t=this.effectLayers.indexOf(e);return-1!==t&&this.effectLayers.splice(t,1),t},e.AbstractScene.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=t,this._engine=t.getEngine(),t.effectLayers=new Array}return t.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(e.SceneComponentConstants.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(e.SceneComponentConstants.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},t.prototype.rebuild=function(){for(var e=0,t=this.scene.effectLayers;e<t.length;e++){t[__uv.$wrap((e))]._rebuild()}},t.prototype.serialize=function(e){e.effectLayers=[];for(var t=0,i=this.scene.effectLayers;t<i.length;t++){var r=i[__uv.$wrap((t))];r.serialize&&e.effectLayers.push(r.serialize())}},t.prototype.addFromContainer=function(e){var t=this;e.effectLayers&&e.effectLayers.forEach((function(e){t.scene.addEffectLayer(e)}))},t.prototype.removeFromContainer=function(e){var t=this;e.effectLayers&&e.effectLayers.forEach((function(e){t.scene.removeEffectLayer(e)}))},t.prototype.dispose=function(){for(var e=this.scene.effectLayers;e.length;)e[__uv.$wrap((0))].dispose()},t.prototype._isReadyForMesh=function(e,t){for(var i=0,r=this.scene.effectLayers;i<r.length;i++){var n=r[__uv.$wrap((i))];if(n.hasMesh(e))for(var a=0,o=e.subMeshes;a<o.length;a++){var s=o[__uv.$wrap((a))];if(!n.isReady(s,t))return!1}}return!0},t.prototype._renderMainTexture=function(t){this._renderEffects=!1,this._needStencil=!1;var i=this.scene.effectLayers;if(i&&i.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var r=0,n=i;r<n.length;r++){var a=n[__uv.$wrap((r))];if(a.shouldRender()&&(!a.camera||a.camera.cameraRigMode===e.Camera.RIG_MODE_NONE&&t===a.camera||a.camera.cameraRigMode!==e.Camera.RIG_MODE_NONE&&a.camera._rigCameras.indexOf(t)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||a.needStencil();var o=a._mainTexture;o._shouldRender()&&(this.scene.incrementRenderId(),o.render(!1,!1))}}this.scene.incrementRenderId()}},t.prototype._setStencil=function(e){this._needStencil&&this._engine.setStencilBuffer(!0)},t.prototype._setStencilBack=function(e){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},t.prototype._draw=function(e){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var t=this.scene.effectLayers,i=0;i<t.length;i++){var r=t[__uv.$wrap((i))];r.renderingGroupId===e&&r.shouldRender()&&r.render()}this._engine.setDepthBuffer(!0)}},t.prototype._drawCamera=function(e){this._renderEffects&&this._draw(-1)},t.prototype._drawRenderingGroup=function(e){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(e)},t}();e.EffectLayerSceneComponent=t}(s||(s={}));o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[__uv.$wrap((i))])Object.prototype.hasOwnProperty.call(t,n)&&(e[__uv.$wrap((n))]=t[__uv.$wrap((n))]);return e}).apply(this,arguments)};!function(e){var t=function(){function t(t,i){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new e.Color4},this.neutralColor=new e.Color4,this.isEnabled=!0,this.onDisposeObservable=new e.Observable,this.onBeforeRenderMainTextureObservable=new e.Observable,this.onBeforeComposeObservable=new e.Observable,this.onAfterComposeObservable=new e.Observable,this.onSizeChangedObservable=new e.Observable,this.name=t,this._scene=i||e.Engine.LastCreatedScene;var r=this._scene._getComponent(e.SceneComponentConstants.NAME_EFFECTLAYER);r||(r=new e.EffectLayerSceneComponent(this._scene),this._scene._addComponent(r)),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._genrateVertexBuffer()}return Object.defineProperty(t.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},enumerable:!0,configurable:!0}),t.prototype._init=function(t){this._effectLayerOptions=o({mainTextureRatio:.5,alphaBlendingMode:e.Engine.ALPHA_COMBINE,camera:null,renderingGroupId:-1},t),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},t.prototype._generateIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._engine.createIndexBuffer(e)},t.prototype._genrateVertexBuffer=function(){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1);var i=new e.VertexBuffer(this._engine,t,e.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=i},t.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},t.prototype._createMainTexture=function(){var t=this;this._mainTexture=new e.RenderTargetTexture("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(e,i,r,n){var a;t.onBeforeRenderMainTextureObservable.notifyObservers(t);var o=t._scene.getEngine();if(n.length){for(o.setColorWrite(!1),a=0;a<n.length;a++)t._renderSubMesh(n.data[__uv.$wrap((a))]);o.setColorWrite(!0)}for(a=0;a<e.length;a++)t._renderSubMesh(e.data[__uv.$wrap((a))]);for(a=0;a<i.length;a++)t._renderSubMesh(i.data[__uv.$wrap((a))]);for(a=0;a<r.length;a++)t._renderSubMesh(r.data[__uv.$wrap((a))])},this._mainTexture.onClearObservable.add((function(e){e.clear(t.neutralColor,!0,!0,!0)}))},t.prototype._isReady=function(t,i,r){var n=t.getMaterial();if(!n)return!1;if(!n.isReady(t.getMesh(),i))return!1;var a=[],o=[e.VertexBuffer.PositionKind],s=t.getMesh(),l=!1,c=!1;if(n&&n.needAlphaTesting()){var u=n.getAlphaTestTexture();u&&(a.push("#define ALPHATEST"),s.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&1===u.coordinatesIndex?(a.push("#define DIFFUSEUV2"),c=!0):s.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(a.push("#define DIFFUSEUV1"),l=!0))}r&&(a.push("#define EMISSIVE"),s.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&1===r.coordinatesIndex?(a.push("#define EMISSIVEUV2"),c=!0):s.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(a.push("#define EMISSIVEUV1"),l=!0)),l&&(o.push(e.VertexBuffer.UVKind),a.push("#define UV1")),c&&(o.push(e.VertexBuffer.UV2Kind),a.push("#define UV2")),s.useBones&&s.computeBonesUsingShaders?(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),s.numBoneInfluencers>4&&(o.push(e.VertexBuffer.MatricesIndicesExtraKind),o.push(e.VertexBuffer.MatricesWeightsExtraKind)),a.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),a.push("#define BonesPerMesh "+(s.skeleton?s.skeleton.bones.length+1:0))):a.push("#define NUM_BONE_INFLUENCERS 0");var h=s.morphTargetManager,d=0;h&&h.numInfluencers>0&&(a.push("#define MORPHTARGETS"),d=h.numInfluencers,a.push("#define NUM_MORPH_INFLUENCERS "+d),e.MaterialHelper.PrepareAttributesForMorphTargets(o,s,{NUM_MORPH_INFLUENCERS:d})),i&&(a.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var p=a.join("\n");return this._cachedDefines!==p&&(this._cachedDefines=p,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",o,["world","mBones","viewProjection","diffuseMatrix","color","emissiveMatrix","morphTargetInfluences"],["diffuseSampler","emissiveSampler"],p,void 0,void 0,void 0,{maxSimultaneousMorphTargets:d})),this._effectLayerMapGenerationEffect.isReady()},t.prototype.render=function(){var e=this._mergeEffect;if(e.isReady()){for(var t=0;t<this._postProcesses.length;t++)if(!this._postProcesses[__uv.$wrap((t))].isReady())return;var i=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),i.enableEffect(e),i.setState(!1),i.bindBuffers(this._vertexBuffers,this._indexBuffer,e);var r=i.getAlphaMode();i.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(e),i.setAlphaMode(r),this.onAfterComposeObservable.notifyObservers(this);var n=this._mainTexture.getSize();this._setMainTextureSize(),n.width===this._mainTextureDesiredSize.width&&n.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},t.prototype.hasMesh=function(e){return-1===this.renderingGroupId||e.renderingGroupId===this.renderingGroupId},t.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},t.prototype._shouldRenderMesh=function(e){return!0},t.prototype._shouldRenderEmissiveTextureForMesh=function(e){return!0},t.prototype._renderSubMesh=function(t){var i=this;if(this.shouldRender()){var r=t.getMaterial(),n=t.getRenderingMesh(),a=this._scene,o=a.getEngine();if(r&&!r.needAlphaBlendingForMesh(n)){o.setState(r.backFaceCulling);var s=n._getInstancesRenderList(t._id);if(!s.mustReturn&&this._shouldRenderMesh(n)){var l=o.getCaps().instancedArrays&&null!==s.visibleInstances[__uv.$wrap((t._id))]&&void 0!==s.visibleInstances[__uv.$wrap((t._id))];if(this._setEmissiveTextureAndColor(n,t,r),this._isReady(t,l,this._emissiveTextureAndColor.texture)){if(o.enableEffect(this._effectLayerMapGenerationEffect),n._bind(t,this._effectLayerMapGenerationEffect,e.Material.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",a.getTransformMatrix()),this._effectLayerMapGenerationEffect.setFloat4("color",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a),r&&r.needAlphaTesting()){var c=r.getAlphaTestTexture();if(c){this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",c);var u=c.getTextureMatrix();u&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",u)}}this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),n.useBones&&n.computeBonesUsingShaders&&n.skeleton&&this._effectLayerMapGenerationEffect.setMatrices("mBones",n.skeleton.getTransformMatrices(n)),e.MaterialHelper.BindMorphTargetParameters(n,this._effectLayerMapGenerationEffect),n._processRendering(t,this._effectLayerMapGenerationEffect,e.Material.TriangleFillMode,s,l,(function(e,t){return i._effectLayerMapGenerationEffect.setMatrix("world",t)}))}else this._mainTexture.resetRefreshCounter()}}}},t.prototype._rebuild=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&t._rebuild(),this._generateIndexBuffer()},t.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var e=0;e<this._postProcesses.length;e++)this._postProcesses[__uv.$wrap((e))]&&this._postProcesses[__uv.$wrap((e))].dispose();this._postProcesses=[];for(e=0;e<this._textures.length;e++)this._textures[__uv.$wrap((e))]&&this._textures[__uv.$wrap((e))].dispose();this._textures=[]},t.prototype.dispose=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&(t.dispose(),this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var i=this._scene.effectLayers.indexOf(this,0);i>-1&&this._scene.effectLayers.splice(i,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},t.prototype.getClassName=function(){return"EffectLayer"},t.Parse=function(t,i,r){return e.Tools.Instantiate(t.customType).Parse(t,i,r)},n([e.serialize()],t.prototype,"name",void 0),n([e.serializeAsColor4()],t.prototype,"neutralColor",void 0),n([e.serialize()],t.prototype,"isEnabled",void 0),n([e.serializeAsCameraReference()],t.prototype,"camera",null),n([e.serialize()],t.prototype,"renderingGroupId",null),t}();e.EffectLayer=t}(s||(s={})),function(e){e.AbstractScene.prototype.getHighlightLayerByName=function(e){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[__uv.$wrap((t))].name===e&&this.effectLayers[__uv.$wrap((t))].getEffectName()===i.EffectName)return this.effectLayers[__uv.$wrap((t))];return null};var t=function(t){function i(i,r,n,a,o,s,l,c){void 0===s&&(s=e.Texture.BILINEAR_SAMPLINGMODE);var u=t.call(this,i,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,a,o,s,l,c)||this;return u.direction=r,u.kernel=n,u.onApplyObservable.add((function(e){e.setFloat2("screenSize",u.width,u.height),e.setVector2("direction",u.direction),e.setFloat("blurWidth",u.kernel)})),u}return a(i,t),i}(e.PostProcess),i=function(i){function r(t,n,a){var s=i.call(this,t,n)||this;return s.name=t,s.innerGlow=!0,s.outerGlow=!0,s.onBeforeBlurObservable=new e.Observable,s.onAfterBlurObservable=new e.Observable,s._instanceGlowingMeshStencilReference=r.GlowingMeshStencilReference++,s._meshes={},s._excludedMeshes={},s.neutralColor=r.NeutralColor,s._engine.isStencilEnable||e.Tools.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new BABYLON.Engine(canvas, antialias, { stencil: true }"),s._options=o({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:e.Engine.ALPHA_COMBINE,camera:null,renderingGroupId:-1},a),s._init({alphaBlendingMode:s._options.alphaBlendingMode,camera:s._options.camera,mainTextureFixedSize:s._options.mainTextureFixedSize,mainTextureRatio:s._options.mainTextureRatio,renderingGroupId:s._options.renderingGroupId}),s._shouldRender=!1,s}return a(r,i),Object.defineProperty(r.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),r.prototype.getEffectName=function(){return r.EffectName},r.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[e.VertexBuffer.PositionKind],["offset"],["textureSampler"],this._options.isStroke?"#define STROKE \n":void 0)},r.prototype._createTextureAndPostProcesses=function(){var i=this,r=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,n=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;r=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(r,this._maxSize):r,n=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(n,this._maxSize):n;var a=0;a=this._engine.getCaps().textureHalfFloatRender?e.Engine.TEXTURETYPE_HALF_FLOAT:e.Engine.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new e.RenderTargetTexture("HighlightLayerBlurRTT",{width:r,height:n},this._scene,!1,!0,a),this._blurTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===e.Engine.ALPHA_COMBINE?(this._downSamplePostprocess=new e.PassPostProcess("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add((function(e){e.setTexture("textureSampler",i._mainTexture)})),this._horizontalBlurPostprocess=new t("HighlightLayerHBP",new e.Vector2(1,0),this._options.blurHorizontalSize,1,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add((function(e){e.setFloat2("screenSize",r,n)})),this._verticalBlurPostprocess=new t("HighlightLayerVBP",new e.Vector2(0,1),this._options.blurVerticalSize,1,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add((function(e){e.setFloat2("screenSize",r,n)})),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new e.BlurPostProcess("HighlightLayerHBP",new e.Vector2(1,0),this._options.blurHorizontalSize/2,{width:r,height:n},null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,a),this._horizontalBlurPostprocess.width=r,this._horizontalBlurPostprocess.height=n,this._horizontalBlurPostprocess.onApplyObservable.add((function(e){e.setTexture("textureSampler",i._mainTexture)})),this._verticalBlurPostprocess=new e.BlurPostProcess("HighlightLayerVBP",new e.Vector2(0,1),this._options.blurVerticalSize/2,{width:r,height:n},null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,a),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add((function(){i.onBeforeBlurObservable.notifyObservers(i);var e=i._blurTexture.getInternalTexture();e&&i._scene.postProcessManager.directRender(i._postProcesses,e,!0),i.onAfterBlurObservable.notifyObservers(i)})),this._postProcesses.map((function(e){e.autoClear=!1}))},r.prototype.needStencil=function(){return!0},r.prototype.isReady=function(e,t){var r=e.getMaterial(),n=e.getRenderingMesh();if(!r||!n||!this._meshes)return!1;var a=null,o=this._meshes[__uv.$wrap((n.uniqueId))];return o&&o.glowEmissiveOnly&&r&&(a=r.emissiveTexture),i.prototype._isReady.call(this,e,t,a)},r.prototype._internalRender=function(t){t.setTexture("textureSampler",this._blurTexture);var i=this._engine,r=i.getStencilBuffer(),n=i.getStencilFunction(),a=i.getStencilMask(),o=i.getStencilOperationPass(),s=i.getStencilOperationFail(),l=i.getStencilOperationDepthFail(),c=i.getStencilFunctionReference();i.setStencilOperationPass(e.Engine.REPLACE),i.setStencilOperationFail(e.Engine.KEEP),i.setStencilOperationDepthFail(e.Engine.KEEP),i.setStencilMask(0),i.setStencilBuffer(!0),i.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(t.setFloat("offset",0),i.setStencilFunction(e.Engine.NOTEQUAL),i.drawElementsType(e.Material.TriangleFillMode,0,6)),this.innerGlow&&(t.setFloat("offset",1),i.setStencilFunction(e.Engine.EQUAL),i.drawElementsType(e.Material.TriangleFillMode,0,6)),i.setStencilFunction(n),i.setStencilMask(a),i.setStencilBuffer(r),i.setStencilOperationPass(o),i.setStencilOperationFail(s),i.setStencilOperationDepthFail(l),i.setStencilFunctionReference(c)},r.prototype.shouldRender=function(){return!!i.prototype.shouldRender.call(this)&&!!this._meshes},r.prototype._shouldRenderMesh=function(e){return(!this._excludedMeshes||!this._excludedMeshes[__uv.$wrap((e.uniqueId))])&&!!i.prototype.hasMesh.call(this,e)},r.prototype._setEmissiveTextureAndColor=function(e,t,i){var r=this._meshes[__uv.$wrap((e.uniqueId))];r?this._emissiveTextureAndColor.color.set(r.color.r,r.color.g,r.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),r&&r.glowEmissiveOnly&&i?(this._emissiveTextureAndColor.texture=i.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},r.prototype.addExcludedMesh=function(e){this._excludedMeshes&&(this._excludedMeshes[__uv.$wrap((e.uniqueId))]||(this._excludedMeshes[__uv.$wrap((e.uniqueId))]={mesh:e,beforeRender:e.onBeforeRenderObservable.add((function(e){e.getEngine().setStencilBuffer(!1)})),afterRender:e.onAfterRenderObservable.add((function(e){e.getEngine().setStencilBuffer(!0)}))}))},r.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var t=this._excludedMeshes[__uv.$wrap((e.uniqueId))];t&&(t.beforeRender&&e.onBeforeRenderObservable.remove(t.beforeRender),t.afterRender&&e.onAfterRenderObservable.remove(t.afterRender)),this._excludedMeshes[__uv.$wrap((e.uniqueId))]=null}},r.prototype.hasMesh=function(e){return!!this._meshes&&(!!i.prototype.hasMesh.call(this,e)&&(void 0!==this._meshes[__uv.$wrap((e.uniqueId))]&&null!==this._meshes[__uv.$wrap((e.uniqueId))]))},r.prototype.addMesh=function(e,t,i){var r=this;if(void 0===i&&(i=!1),this._meshes){var n=this._meshes[__uv.$wrap((e.uniqueId))];n?n.color=t:(this._meshes[__uv.$wrap((e.uniqueId))]={mesh:e,color:t,observerHighlight:e.onBeforeRenderObservable.add((function(e){r._excludedMeshes&&r._excludedMeshes[__uv.$wrap((e.uniqueId))]?r._defaultStencilReference(e):e.getScene().getEngine().setStencilFunctionReference(r._instanceGlowingMeshStencilReference)})),observerDefault:e.onAfterRenderObservable.add(this._defaultStencilReference),glowEmissiveOnly:i},e.onDisposeObservable.add((function(){r._disposeMesh(e)}))),this._shouldRender=!0}},r.prototype.removeMesh=function(e){if(this._meshes){var t=this._meshes[__uv.$wrap((e.uniqueId))];for(var i in t&&(t.observerHighlight&&e.onBeforeRenderObservable.remove(t.observerHighlight),t.observerDefault&&e.onAfterRenderObservable.remove(t.observerDefault),delete this._meshes[__uv.$wrap((e.uniqueId))]),this._shouldRender=!1,this._meshes)if(this._meshes[__uv.$wrap((i))]){this._shouldRender=!0;break}}},r.prototype._defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(r.NormalMeshStencilReference)},r.prototype._disposeMesh=function(e){this.removeMesh(e),this.removeExcludedMesh(e)},r.prototype.dispose=function(){if(this._meshes){for(var e in this._meshes){(t=this._meshes[__uv.$wrap((e))])&&t.mesh&&(t.observerHighlight&&t.mesh.onBeforeRenderObservable.remove(t.observerHighlight),t.observerDefault&&t.mesh.onAfterRenderObservable.remove(t.observerDefault))}this._meshes=null}if(this._excludedMeshes){for(var e in this._excludedMeshes){var t;(t=this._excludedMeshes[__uv.$wrap((e))])&&(t.beforeRender&&t.mesh.onBeforeRenderObservable.remove(t.beforeRender),t.afterRender&&t.mesh.onAfterRenderObservable.remove(t.afterRender))}this._excludedMeshes=null}i.prototype.dispose.call(this)},r.prototype.getClassName=function(){return"HighlightLayer"},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);if(t.customType="BABYLON.HighlightLayer",t.meshes=[],this._meshes)for(var i in this._meshes){var r=this._meshes[__uv.$wrap((i))];r&&t.meshes.push({glowEmissiveOnly:r.glowEmissiveOnly,color:r.color.asArray(),meshId:r.mesh.id})}if(t.excludedMeshes=[],this._excludedMeshes)for(var n in this._excludedMeshes){var a=this._excludedMeshes[__uv.$wrap((n))];a&&t.excludedMeshes.push(a.mesh.id)}return t},r.Parse=function(t,i,n){var a,o=e.SerializationHelper.Parse((function(){return new r(t.name,i,t.options)}),t,i,n);for(a=0;a<t.excludedMeshes.length;a++){(s=i.getMeshByID(t.excludedMeshes[__uv.$wrap((a))]))&&o.addExcludedMesh(s)}for(a=0;a<t.meshes.length;a++){var s,l=t.meshes[__uv.$wrap((a))];(s=i.getMeshByID(l.meshId))&&o.addMesh(s,e.Color3.FromArray(l.color),l.glowEmissiveOnly)}return o},r.EffectName="HighlightLayer",r.NeutralColor=new e.Color4(0,0,0,0),r.GlowingMeshStencilReference=2,r.NormalMeshStencilReference=1,n([e.serialize()],r.prototype,"innerGlow",void 0),n([e.serialize()],r.prototype,"outerGlow",void 0),n([e.serialize()],r.prototype,"blurHorizontalSize",null),n([e.serialize()],r.prototype,"blurVerticalSize",null),n([e.serialize("options")],r.prototype,"_options",void 0),r}(e.EffectLayer);e.HighlightLayer=i}(s||(s={})),function(e){e.AbstractScene.prototype.getGlowLayerByName=function(e){for(var i=0;i<this.effectLayers.length;i++)if(this.effectLayers[__uv.$wrap((i))].name===e&&this.effectLayers[__uv.$wrap((i))].getEffectName()===t.EffectName)return this.effectLayers[__uv.$wrap((i))];return null};var t=function(t){function i(r,n,a){var s=t.call(this,r,n)||this;return s._intensity=1,s._includedOnlyMeshes=[],s._excludedMeshes=[],s.neutralColor=new e.Color4(0,0,0,1),s._options=o({mainTextureRatio:i.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},a),s._init({alphaBlendingMode:e.Engine.ALPHA_ADD,camera:s._options.camera,mainTextureFixedSize:s._options.mainTextureFixedSize,mainTextureRatio:s._options.mainTextureRatio,renderingGroupId:s._options.renderingGroupId}),s}return a(i,t),Object.defineProperty(i.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(e){this._horizontalBlurPostprocess1.kernel=e,this._verticalBlurPostprocess1.kernel=e,this._horizontalBlurPostprocess2.kernel=e,this._verticalBlurPostprocess2.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"intensity",{get:function(){return this._intensity},set:function(e){this._intensity=e},enumerable:!0,configurable:!0}),i.prototype.getEffectName=function(){return i.EffectName},i.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[e.VertexBuffer.PositionKind],["offset"],["textureSampler","textureSampler2"],"#define EMISSIVE \n")},i.prototype._createTextureAndPostProcesses=function(){var t=this,i=this._mainTextureDesiredSize.width,r=this._mainTextureDesiredSize.height;i=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(i,this._maxSize):i,r=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(r,this._maxSize):r;var n=0;n=this._engine.getCaps().textureHalfFloatRender?e.Engine.TEXTURETYPE_HALF_FLOAT:e.Engine.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new e.RenderTargetTexture("GlowLayerBlurRTT",{width:i,height:r},this._scene,!1,!0,n),this._blurTexture1.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var a=Math.floor(i/2),o=Math.floor(r/2);this._blurTexture2=new e.RenderTargetTexture("GlowLayerBlurRTT2",{width:a,height:o},this._scene,!1,!0,n),this._blurTexture2.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new e.BlurPostProcess("GlowLayerHBP1",new e.Vector2(1,0),this._options.blurKernelSize/2,{width:i,height:r},null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,n),this._horizontalBlurPostprocess1.width=i,this._horizontalBlurPostprocess1.height=r,this._horizontalBlurPostprocess1.onApplyObservable.add((function(e){e.setTexture("textureSampler",t._mainTexture)})),this._verticalBlurPostprocess1=new e.BlurPostProcess("GlowLayerVBP1",new e.Vector2(0,1),this._options.blurKernelSize/2,{width:i,height:r},null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,n),this._horizontalBlurPostprocess2=new e.BlurPostProcess("GlowLayerHBP2",new e.Vector2(1,0),this._options.blurKernelSize/2,{width:a,height:o},null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,n),this._horizontalBlurPostprocess2.width=a,this._horizontalBlurPostprocess2.height=o,this._horizontalBlurPostprocess2.onApplyObservable.add((function(e){e.setTexture("textureSampler",t._blurTexture1)})),this._verticalBlurPostprocess2=new e.BlurPostProcess("GlowLayerVBP2",new e.Vector2(0,1),this._options.blurKernelSize/2,{width:a,height:o},null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,n),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add((function(){var e=t._blurTexture1.getInternalTexture();e&&(t._scene.postProcessManager.directRender(t._postProcesses1,e,!0),(e=t._blurTexture2.getInternalTexture())&&t._scene.postProcessManager.directRender(t._postProcesses2,e,!0))})),this._postProcesses.map((function(e){e.autoClear=!1}))},i.prototype.isReady=function(e,i){var r=e.getMaterial(),n=e.getRenderingMesh();if(!r||!n)return!1;var a=r.emissiveTexture;return t.prototype._isReady.call(this,e,i,a)},i.prototype.needStencil=function(){return!1},i.prototype._internalRender=function(t){t.setTexture("textureSampler",this._blurTexture1),t.setTexture("textureSampler2",this._blurTexture2),t.setFloat("offset",this._intensity);var i=this._engine,r=i.getStencilBuffer();i.setStencilBuffer(!1),i.drawElementsType(e.Material.TriangleFillMode,0,6),i.setStencilBuffer(r)},i.prototype._setEmissiveTextureAndColor=function(e,t,i){var r=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,t,i):i?(this._emissiveTextureAndColor.texture=i.emissiveTexture,this._emissiveTextureAndColor.texture&&(r=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(e,t,i,this._emissiveTextureAndColor.color):i.emissiveColor?this._emissiveTextureAndColor.color.set(i.emissiveColor.r*r,i.emissiveColor.g*r,i.emissiveColor.b*r,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},i.prototype._shouldRenderMesh=function(e){return this.hasMesh(e)},i.prototype.addExcludedMesh=function(e){-1===this._excludedMeshes.indexOf(e.uniqueId)&&this._excludedMeshes.push(e.uniqueId)},i.prototype.removeExcludedMesh=function(e){var t=this._excludedMeshes.indexOf(e.uniqueId);-1!==t&&this._excludedMeshes.splice(t,1)},i.prototype.addIncludedOnlyMesh=function(e){-1===this._includedOnlyMeshes.indexOf(e.uniqueId)&&this._includedOnlyMeshes.push(e.uniqueId)},i.prototype.removeIncludedOnlyMesh=function(e){var t=this._includedOnlyMeshes.indexOf(e.uniqueId);-1!==t&&this._includedOnlyMeshes.splice(t,1)},i.prototype.hasMesh=function(e){return!!t.prototype.hasMesh.call(this,e)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(e.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(e.uniqueId))},i.prototype._disposeMesh=function(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)},i.prototype.getClassName=function(){return"GlowLayer"},i.prototype.serialize=function(){var t,i=e.SerializationHelper.Serialize(this);if(i.customType="BABYLON.GlowLayer",i.includedMeshes=[],this._includedOnlyMeshes.length)for(t=0;t<this._includedOnlyMeshes.length;t++){(r=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[__uv.$wrap((t))]))&&i.includedMeshes.push(r.id)}if(i.excludedMeshes=[],this._excludedMeshes.length)for(t=0;t<this._excludedMeshes.length;t++){var r;(r=this._scene.getMeshByUniqueID(this._excludedMeshes[__uv.$wrap((t))]))&&i.excludedMeshes.push(r.id)}return i},i.Parse=function(t,r,n){var a,o=e.SerializationHelper.Parse((function(){return new i(t.name,r,t.options)}),t,r,n);for(a=0;a<t.excludedMeshes.length;a++){(s=r.getMeshByID(t.excludedMeshes[__uv.$wrap((a))]))&&o.addExcludedMesh(s)}for(a=0;a<t.includedMeshes.length;a++){var s;(s=r.getMeshByID(t.includedMeshes[__uv.$wrap((a))]))&&o.addIncludedOnlyMesh(s)}return o},i.EffectName="GlowLayer",i.DefaultBlurKernelSize=32,i.DefaultTextureRatio=.5,n([e.serialize()],i.prototype,"blurKernelSize",null),n([e.serialize()],i.prototype,"intensity",null),n([e.serialize("options")],i.prototype,"_options",void 0),i}(e.EffectLayer);e.GlowLayer=t}(s||(s={})),function(e){var t;!function(e){e[__uv.$wrap((e.INIT=0))]="INIT",e[__uv.$wrap((e.RUNNING=1))]="RUNNING",e[__uv.$wrap((e.DONE=2))]="DONE",e[__uv.$wrap((e.ERROR=3))]="ERROR"}(t=e.AssetTaskState||(e.AssetTaskState={}));var i=function(){function e(e){this.name=e,this._isCompleted=!1,this._taskState=t.INIT}return Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),e.prototype._setErrorObject=function(e,t){this._errorObject||(this._errorObject={message:e,exception:t})},e.prototype.run=function(e,i,r){var n=this;this._taskState=t.RUNNING,this.runTask(e,(function(){n.onDoneCallback(i,r)}),(function(e,t){n.onErrorCallback(r,e,t)}))},e.prototype.runTask=function(e,t,i){throw new Error("runTask is not implemented")},e.prototype.reset=function(){this._taskState=t.INIT},e.prototype.onErrorCallback=function(e,i,r){this._taskState=t.ERROR,this._errorObject={message:i,exception:r},this.onError&&this.onError(this,i,r),e()},e.prototype.onDoneCallback=function(e,i){try{this._taskState=t.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),e()}catch(e){this.onErrorCallback(i,"Task is done, error executing success callback(s)",e)}},e}();e.AbstractAssetTask=i;var r=function(e,t,i){this.remainingCount=e,this.totalCount=t,this.task=i};e.AssetsProgressEvent=r;var n=function(t){function i(e,i,r,n){var a=t.call(this,e)||this;return a.name=e,a.meshesNames=i,a.rootUrl=r,a.sceneFilename=n,a}return a(i,t),i.prototype.runTask=function(t,i,r){var n=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,(function(e,t,r){n.loadedMeshes=e,n.loadedParticleSystems=t,n.loadedSkeletons=r,i()}),null,(function(e,t,i){r(t,i)}))},i}(i);e.MeshAssetTask=n;var o=function(e){function t(t,i){var r=e.call(this,t)||this;return r.name=t,r.url=i,r}return a(t,e),t.prototype.runTask=function(e,t,i){var r=this;e._loadFile(this.url,(function(e){r.text=e,t()}),void 0,!1,!1,(function(e,t){e&&i(e.status+" "+e.statusText,t)}))},t}(i);e.TextFileAssetTask=o;var s=function(e){function t(t,i){var r=e.call(this,t)||this;return r.name=t,r.url=i,r}return a(t,e),t.prototype.runTask=function(e,t,i){var r=this;e._loadFile(this.url,(function(e){r.data=e,t()}),void 0,!0,!0,(function(e,t){e&&i(e.status+" "+e.statusText,t)}))},t}(i);e.BinaryFileAssetTask=s;var l=function(t){function i(e,i){var r=t.call(this,e)||this;return r.name=e,r.url=i,r}return a(i,t),i.prototype.runTask=function(t,i,r){var n=this,a=new Image;e.Tools.SetCorsBehavior(this.url,a),a.onload=function(){n.image=a,i()},a.onerror=function(e){r("Error loading image",e)},a.src=this.url},i}(i);e.ImageAssetTask=l;var c=function(t){function i(i,r,n,a,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE);var s=t.call(this,i)||this;return s.name=i,s.url=r,s.noMipmap=n,s.invertY=a,s.samplingMode=o,s}return a(i,t),i.prototype.runTask=function(t,i,r){this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,(function(){i()}),(function(e,t){r(e,t)}))},i}(i);e.TextureAssetTask=c;var u=function(t){function i(e,i,r,n,a){var o=t.call(this,e)||this;return o.name=e,o.url=i,o.extensions=r,o.noMipmap=n,o.files=a,o}return a(i,t),i.prototype.runTask=function(t,i,r){this.texture=new e.CubeTexture(this.url,t,this.extensions,this.noMipmap,this.files,(function(){i()}),(function(e,t){r(e,t)}))},i}(i);e.CubeTextureAssetTask=u;var h=function(t){function i(e,i,r,n,a,o,s){void 0===n&&(n=!1),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===s&&(s=!1);var l=t.call(this,e)||this;return l.name=e,l.url=i,l.size=r,l.noMipmap=n,l.generateHarmonics=a,l.gammaSpace=o,l.reserved=s,l}return a(i,t),i.prototype.run=function(t,i,r){this.texture=new e.HDRCubeTexture(this.url,t,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,(function(){i()}),(function(e,t){r(e,t)}))},i}(i);e.HDRCubeTextureAssetTask=h;var d=function(){function i(t){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new e.Observable,this.onTaskErrorObservable=new e.Observable,this.onTasksDoneObservable=new e.Observable,this.onProgressObservable=new e.Observable,this.useDefaultLoadingScreen=!0,this._scene=t}return i.prototype.addMeshTask=function(e,t,i,r){var a=new n(e,t,i,r);return this._tasks.push(a),a},i.prototype.addTextFileTask=function(e,t){var i=new o(e,t);return this._tasks.push(i),i},i.prototype.addBinaryFileTask=function(e,t){var i=new s(e,t);return this._tasks.push(i),i},i.prototype.addImageTask=function(e,t){var i=new l(e,t);return this._tasks.push(i),i},i.prototype.addTextureTask=function(t,i,r,n,a){void 0===a&&(a=e.Texture.TRILINEAR_SAMPLINGMODE);var o=new c(t,i,r,n,a);return this._tasks.push(o),o},i.prototype.addCubeTextureTask=function(e,t,i,r,n){var a=new u(e,t,i,r,n);return this._tasks.push(a),a},i.prototype.addHDRCubeTextureTask=function(e,t,i,r,n,a,o){void 0===r&&(r=!1),void 0===n&&(n=!0),void 0===a&&(a=!1),void 0===o&&(o=!1);var s=new h(e,t,i,r,n,a,o);return this._tasks.push(s),s},i.prototype.removeTask=function(e){var t=this._tasks.indexOf(e);t>-1&&this._tasks.splice(t,1)},i.prototype._decreaseWaitingTasksCount=function(i){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,i),this.onProgressObservable.notifyObservers(new r(this._waitingTasksCount,this._totalTasksCount,i))}catch(t){e.Tools.Error("Error running progress callbacks."),console.log(t)}if(0===this._waitingTasksCount){try{this.onFinish&&this.onFinish(this._tasks);for(var n=this._tasks.slice(),a=0,o=n;a<o.length;a++){if((i=o[__uv.$wrap((a))]).taskState===t.DONE){var s=this._tasks.indexOf(i);s>-1&&this._tasks.splice(s,1)}}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(t){e.Tools.Error("Error running tasks-done callbacks."),console.log(t)}this._isLoading=!1,this._scene.getEngine().hideLoadingUI()}},i.prototype._runTask=function(e){var t=this,i=function(i,r){e._setErrorObject(i,r),t.onTaskError&&t.onTaskError(e),t.onTaskErrorObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)};e.run(this._scene,(function(){try{t.onTaskSuccess&&t.onTaskSuccess(e),t.onTaskSuccessObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)}catch(e){i("Error executing task success callbacks",e)}}),i)},i.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},i.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var i=this._tasks[__uv.$wrap((e))];i.taskState===t.INIT&&this._runTask(i)}return this},i}();e.AssetsManager=d}(s||(s={})),function(e){var t=[],i=function(i,r){if(!t[__uv.$wrap((i.id))]&&!i.doNotSerialize){if(i instanceof e.BoxGeometry)r.boxes.push(i.serialize());else if(i instanceof e.SphereGeometry)r.spheres.push(i.serialize());else if(i instanceof e.CylinderGeometry)r.cylinders.push(i.serialize());else if(i instanceof e.TorusGeometry)r.toruses.push(i.serialize());else if(i instanceof e.GroundGeometry)r.grounds.push(i.serialize());else if(i instanceof e.Plane)r.planes.push(i.serialize());else if(i instanceof e.TorusKnotGeometry)r.torusKnots.push(i.serialize());else{if(i instanceof e._PrimitiveGeometry)throw new Error("Unknown primitive type");r.vertexData.push(i.serializeVerticeData())}t[__uv.$wrap((i.id))]=!0}},r=function(e,t){var r={},n=e._geometry;return n&&(e.getScene().getGeometryByID(n.id)||i(n,t.geometries)),e.serialize&&e.serialize(r),r},n=function(){function n(){}return n.ClearCache=function(){t=[]},n.Serialize=function(a){var o,s,l,c={};if(n.ClearCache(),c.useDelayedTextureLoading=a.useDelayedTextureLoading,c.autoClear=a.autoClear,c.clearColor=a.clearColor.asArray(),c.ambientColor=a.ambientColor.asArray(),c.gravity=a.gravity.asArray(),c.collisionsEnabled=a.collisionsEnabled,c.workerCollisions=a.workerCollisions,a.fogMode&&0!==a.fogMode&&(c.fogMode=a.fogMode,c.fogColor=a.fogColor.asArray(),c.fogStart=a.fogStart,c.fogEnd=a.fogEnd,c.fogDensity=a.fogDensity),a.isPhysicsEnabled()){var u=a.getPhysicsEngine();u&&(c.physicsEnabled=!0,c.physicsGravity=u.gravity.asArray(),c.physicsEngine=u.getPhysicsPluginName())}a.metadata&&(c.metadata=a.metadata),c.morphTargetManagers=[];for(var h=0,d=a.meshes;h<d.length;h++){var p=(v=d[__uv.$wrap((h))]).morphTargetManager;p&&c.morphTargetManagers.push(p.serialize())}for(c.lights=[],o=0;o<a.lights.length;o++)(s=a.lights[__uv.$wrap((o))]).doNotSerialize||c.lights.push(s.serialize());for(c.cameras=[],o=0;o<a.cameras.length;o++){var m=a.cameras[__uv.$wrap((o))];m.doNotSerialize||c.cameras.push(m.serialize())}for(a.activeCamera&&(c.activeCameraID=a.activeCamera.id),e.Animation.AppendSerializedAnimations(a,c),c.materials=[],c.multiMaterials=[],o=0;o<a.materials.length;o++)(l=a.materials[__uv.$wrap((o))]).doNotSerialize||c.materials.push(l.serialize());for(c.multiMaterials=[],o=0;o<a.multiMaterials.length;o++){var _=a.multiMaterials[__uv.$wrap((o))];c.multiMaterials.push(_.serialize())}for(a.environmentTexture&&(c.environmentTexture=a.environmentTexture.name),c.skeletons=[],o=0;o<a.skeletons.length;o++){var f=a.skeletons[__uv.$wrap((o))];f.doNotSerialize||c.skeletons.push(f.serialize())}for(c.transformNodes=[],o=0;o<a.transformNodes.length;o++)c.transformNodes.push(a.transformNodes[__uv.$wrap((o))].serialize());c.geometries={},c.geometries.boxes=[],c.geometries.spheres=[],c.geometries.cylinders=[],c.geometries.toruses=[],c.geometries.grounds=[],c.geometries.planes=[],c.geometries.torusKnots=[],c.geometries.vertexData=[],t=[];var g=a.getGeometries();for(o=0;o<g.length;o++){var y=g[__uv.$wrap((o))];y.isReady()&&i(y,c.geometries)}for(c.meshes=[],o=0;o<a.meshes.length;o++){var v;if((v=a.meshes[__uv.$wrap((o))])instanceof e.Mesh){var b=v;b.doNotSerialize||b.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADED&&b.delayLoadState!==e.Engine.DELAYLOADSTATE_NONE||c.meshes.push(r(b,c))}}for(c.particleSystems=[],o=0;o<a.particleSystems.length;o++)c.particleSystems.push(a.particleSystems[__uv.$wrap((o))].serialize());a.actionManager&&(c.actions=a.actionManager.serialize("scene"));for(var x=0,S=a._serializableComponents;x<S.length;x++){S[__uv.$wrap((x))].serialize(c)}return c},n.SerializeMesh=function(t,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1);var s={};if(n.ClearCache(),t=t instanceof Array?t:[t],a||o)for(var l=0;l<t.length;++l)o&&t[__uv.$wrap((l))].getDescendants().forEach((function(i){i instanceof e.Mesh&&t.indexOf(i)<0&&t.push(i)})),a&&t[__uv.$wrap((l))].__uv$setSource(__uv).__uv$parent&&t.indexOf(t[__uv.$wrap((l))].__uv$setSource(__uv).__uv$parent)<0&&t.push(t[__uv.$wrap((l))].__uv$setSource(__uv).__uv$parent);return t.forEach((function(t){!function(t,n){if(t.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||t.delayLoadState===e.Engine.DELAYLOADSTATE_NONE){if(t.material)if(t.material instanceof e.MultiMaterial){if(n.multiMaterials=n.multiMaterials||[],n.materials=n.materials||[],!n.multiMaterials.some((function(e){return e.id===t.material.id}))){n.multiMaterials.push(t.material.serialize());for(var a=function(e){e&&(n.materials.some((function(t){return t.id===e.id}))||n.materials.push(e.serialize()))},o=0,s=t.material.subMaterials;o<s.length;o++){a(s[__uv.$wrap((o))])}}}else n.materials=n.materials||[],n.materials.some((function(e){return e.id===t.material.id}))||n.materials.push(t.material.serialize());var l=t._geometry;l&&(n.geometries||(n.geometries={},n.geometries.boxes=[],n.geometries.spheres=[],n.geometries.cylinders=[],n.geometries.toruses=[],n.geometries.grounds=[],n.geometries.planes=[],n.geometries.torusKnots=[],n.geometries.vertexData=[]),i(l,n.geometries)),t.skeleton&&(n.skeletons=n.skeletons||[],n.skeletons.push(t.skeleton.serialize())),n.meshes=n.meshes||[],n.meshes.push(r(t,n))}}(t,s)})),s},n}();e.SceneSerializer=n}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a){void 0===n&&(n=!0),void 0===a&&(a=!1);var o=this;this.name=t,this._viewMatrix=e.Matrix.Identity(),this._target=e.Vector3.Zero(),this._add=e.Vector3.Zero(),this._invertYAxis=!1,this.position=e.Vector3.Zero(),this._scene=r,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this),this._renderTargetTexture=new e.RenderTargetTexture(t,i,r,n,!0,a?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add((function(t){switch(t){case 0:o._add.copyFromFloats(1,0,0);break;case 1:o._add.copyFromFloats(-1,0,0);break;case 2:o._add.copyFromFloats(0,o._invertYAxis?1:-1,0);break;case 3:o._add.copyFromFloats(0,o._invertYAxis?-1:1,0);break;case 4:o._add.copyFromFloats(0,0,1);break;case 5:o._add.copyFromFloats(0,0,-1)}o._attachedMesh&&o.position.copyFrom(o._attachedMesh.getAbsolutePosition()),o.position.addToRef(o._add,o._target),e.Matrix.LookAtLHToRef(o.position,o._target,e.Vector3.Up(),o._viewMatrix),r.setTransformMatrix(o._viewMatrix,o._projectionMatrix),r._forcedViewPosition=o.position})),this._renderTargetTexture.onAfterUnbindObservable.add((function(){r._forcedViewPosition=null,r.updateTransformMatrix(!0)})),r.activeCamera&&(this._projectionMatrix=e.Matrix.PerspectiveFovLH(Math.PI/2,1,r.activeCamera.minZ,r.activeCamera.maxZ))}return Object.defineProperty(t.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(e){this._renderTargetTexture.samples=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(e){this._renderTargetTexture.refreshRate=e},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},Object.defineProperty(t.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),t.prototype.attachToMesh=function(e){this._attachedMesh=e},t.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderTargetTexture.setRenderingAutoClearDepthStencil(e,t)},t.prototype.dispose=function(){var e=this._scene.reflectionProbes.indexOf(this);-1!==e&&this._scene.reflectionProbes.splice(e,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},t}();e.ReflectionProbe=t}(s||(s={})),function(e){var t=function(){function t(t){this.name=e.SceneComponentConstants.NAME_LAYER,this.scene=t,this._engine=t.getEngine(),t.layers=new Array}return t.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_BEFORECAMERADRAW_LAYER,this,this._drawBackground),this.scene._afterCameraDrawStage.registerStep(e.SceneComponentConstants.STEP_AFTERCAMERADRAW_LAYER,this,this._drawForeground)},t.prototype.rebuild=function(){for(var e=0,t=this.scene.layers;e<t.length;e++){t[__uv.$wrap((e))]._rebuild()}},t.prototype.dispose=function(){for(var e=this.scene.layers;e.length;)e[__uv.$wrap((0))].dispose()},t.prototype._draw=function(e,t){var i=this.scene.layers;if(i.length){this._engine.setDepthBuffer(!1);for(var r=e.layerMask,n=0,a=i;n<a.length;n++){var o=a[__uv.$wrap((n))];o.isBackground===t&&0!=(o.layerMask&r)&&o.render()}this._engine.setDepthBuffer(!0)}},t.prototype._drawBackground=function(e){this._draw(e,!0)},t.prototype._drawForeground=function(e){this._draw(e,!1)},t}();e.LayerSceneComponent=t}(s||(s={})),function(e){var t=function(){function t(t,i,r,n,a){this.name=t,this.scale=new e.Vector2(1,1),this.offset=new e.Vector2(0,0),this.alphaBlendingMode=e.Engine.ALPHA_COMBINE,this.layerMask=268435455,this._vertexBuffers={},this.onDisposeObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,this.texture=i?new e.Texture(i,r,!0):null,this.isBackground=void 0===n||n,this.color=void 0===a?new e.Color4(1,1,1,1):a,this._scene=r||e.Engine.LastCreatedScene;var o=this._scene._getComponent(e.SceneComponentConstants.NAME_LAYER);o||(o=new e.LayerSceneComponent(this._scene),this._scene._addComponent(o)),this._scene.layers.push(this);var s=this._scene.getEngine(),l=[];l.push(1,1),l.push(-1,1),l.push(-1,-1),l.push(1,-1);var c=new e.VertexBuffer(s,l,e.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=c,this._createIndexBuffer(),this._effect=s.createEffect("layer",[e.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=s.createEffect("layer",[e.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),t.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},t.prototype._rebuild=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&t._rebuild(),this._createIndexBuffer()},t.prototype.render=function(){var t=this.alphaTest?this._alphaTestEffect:this._effect;if(t.isReady()&&this.texture&&this.texture.isReady()){var i=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),i.enableEffect(t),i.setState(!1),t.setTexture("textureSampler",this.texture),t.setMatrix("textureMatrix",this.texture.getTextureMatrix()),t.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),t.setVector2("offset",this.offset),t.setVector2("scale",this.scale),i.bindBuffers(this._vertexBuffers,this._indexBuffer,t),this.alphaTest?i.drawElementsType(e.Material.TriangleFillMode,0,6):(i.setAlphaMode(this.alphaBlendingMode),i.drawElementsType(e.Material.TriangleFillMode,0,6),i.setAlphaMode(e.Engine.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},t.prototype.dispose=function(){var t=this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))];t&&(t.dispose(),this._vertexBuffers[__uv.$wrap((e.VertexBuffer.PositionKind))]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null);var i=this._scene.layers.indexOf(this);this._scene.layers.splice(i,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},t}();e.Layer=t}(s||(s={})),function(e){var t=function(){function t(){}return t.CreateResizedCopy=function(t,i,r,n){void 0===n&&(n=!0);var a=t.getScene(),o=a.getEngine(),s=new e.RenderTargetTexture("resized"+t.name,{width:i,height:r},a,!t.noMipmap,!0,t._texture.type,!1,t._samplingMode,!1);s.wrapU=t.wrapU,s.wrapV=t.wrapV,s.uOffset=t.uOffset,s.vOffset=t.vOffset,s.uScale=t.uScale,s.vScale=t.vScale,s.uAng=t.uAng,s.vAng=t.vAng,s.wAng=t.wAng,s.coordinatesIndex=t.coordinatesIndex,s.level=t.level,s.anisotropicFilteringLevel=t.anisotropicFilteringLevel,s._texture.isReady=!1,t.wrapU=e.Texture.CLAMP_ADDRESSMODE,t.wrapV=e.Texture.CLAMP_ADDRESSMODE;var l=new e.PassPostProcess("pass",1,null,n?e.Texture.BILINEAR_SAMPLINGMODE:e.Texture.NEAREST_SAMPLINGMODE,o,!1,e.Engine.TEXTURETYPE_UNSIGNED_INT);return l.getEffect().executeWhenCompiled((function(){l.onApply=function(e){e.setTexture("textureSampler",t)};var e=s.getInternalTexture();e&&(a.postProcessManager.directRender([l],e),o.unBindFramebuffer(e),s.disposeFramebufferObjects(),l.dispose(),e.isReady=!0)})),s},t.GetEnvironmentBRDFTexture=function(t){if(!t._environmentBRDFTexture){var i=e.Texture.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",t,!0,!1,e.Texture.BILINEAR_SAMPLINGMODE);i.wrapU=e.Texture.CLAMP_ADDRESSMODE,i.wrapV=e.Texture.CLAMP_ADDRESSMODE,t._environmentBRDFTexture=i}return t._environmentBRDFTexture},t._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xu19Z7PtTHbW1g3jMMbGmGDAZAMm5xxMLDAU0WSKWOQcCoqccw6eGdtgk4yNbZxnvvAL+Af8Af6AsQl+06ako9X36dXPSi3pnPu+cz/cOntL3S1pq5+w1mrpLs/eud9fvn27rf9evPPwFz+v22S7fGZ/n7/70G79J5/Xv/qzbLP+Pnvvoc/6Tz7jX/15/c62LfeH7fofbpfP3l/ct36Wf+u4+D37+XYb++G26LPsr/zFttnPuh37bm1bt0f7MvtlnOx4uv0H4fty8UUsz77rfn/57u32cgXvDv72eQf0tl0+G38b0Nf9K4Dl704MEfA16KsE8Gw9JgD+DQE8EA0DT2b7GwK4GHnF4a8iguXZt9/vL5/dbisJbEq/uwD5vIK/fbbAv4N9U/8nJIDNCazKvBLBGwdwu62OhajxmQSAx6gqNp5HCg9wPan2nwSNjhLD8ux/3u8vP3y7vbwDAYjtR8AzFyDqLu1Q+YEINnew23rPCYiKb+q/K7o4AVT4tg0t/h4ydJZfkQASQ/d5b9fZ/Z1ENmuPn/cwYCYEELBguKC3nRkCnE0AFOwOKCOAR/sH/L4hgFMpbSWP5dn/uN9ffs7t9mJ5cAHoBLTyszBAFJ/F/xIKdASw5wgaEWDMLySxAk4svf6L+4QAGPiJCziNAPb4f3UZ2dh/m+z7BK4SAPYrxf5FB6ABPgCUAfANAZwKyscc7IEA/vv9/uLzbreXzx9cQCMACAl00m8jAlF7ov6SCMQ8gJsMFFBnCECSg5H6TxJAU3vPAbwhgFfz9AABeOEDBcIbB3AqPzwQwH+731/8sNvt5Ydut5e3B2C/fG9P+jESgGz/RgxG9r9VAwTUUh0goQDafUz+DYnAnSha5l99Z1l/yQVswAZSGIAugNd/9xBgCw9E8aECkHUB22QPHIAVDlQdQAMWAibhBgZAasAVHUAI8Cqg96Tm0bj3VBS9jwd7IIBvuN9ffMHt9vLTbreXy+32QlwAhgMIeuNzKwOqCoB2Aa00KHE+EsIeDuj4H2N+Hf/TfAC6A4nhgQCQDDwiaKDXiq9KgBEJNPArAtCk0AEd2mpAizW3/lYIoANpBPg3BPA+hjs/9eXZV+0E8Bm32wsJA9aEoBCAuAABPiEAC/yDC4gSgRgKRHkAlgsI6v7iEFqJEMgBwb4BGkEfEEDnDlReoAP/SQRgOYIB+IYDMEE/SQBbXoLNr0jhq4qOZc0PHBSf5oKW519xvz//kbfby8+83V68ABfwniIBgwgQ/HoRUMv8w5qAoQqgk4DWQiCw+63eD8k/XAPQgK5s/5a5xzAAqgR6wY9k+ZEMtCOoJABb230hEHMFWQdgAl0Ap/+uc6tKBrrP/n0AuwfiNwTwNKguHHV5/qX3+/M1B/Ddb7cXax7g2e324vaQB3hhkMAW92tHoFb96cVAbimwkgQ0Vv7R+D8iACfuxzKfLvnNlAAjAsBwwP2MwLQAD9sbYJME0AFcg5uBPSAA0x0AobhtcDKDA0j3KYDhk7Hp8uKj9/vzH3C7vfget9uLT9nDgDUZuOYCLBJA8MNKPyGGIftPrL+4gy3eh5p/lwRUYYAs9Fn7tM/E9lvJwCH2DxJ/mPTr4nyyLiDtBgTAGCrgNuPzNuETgN+suEEAFhng9lkCoICMLH7V0isCeEMCxylrefkl9/uzz90J4NNUGLDmAnYXINUBrf5dCCAuQCcCvYVAYPk3G++VAveVfkIAFRLolgbr2F9ifP33pAqAV/fHRF4HcAS7AKlAAEIYFNwITOszs/wMsB6II4BXFZ0QwBsSOEYCDwTw2TsBfPrt9uLlqzCgcwFABI0EVCiANl8Uvq0JWNsi2JPZ/0YKsOiHxftsW4v51ZqAaBWgZf91PsBL/jFHwEqBR1cCiuJ3gAfCmCEA3cf8rmz8AMZHIoA3JDBPAsuHVgL4jNvt+UoCH34ggK0asIYBGArsAB7AD+reQgCl+GwZ8LaNlP3MEEDaSg4ACMGr/+ulwV4JsAEfLH42/vdKgWElAJ4QpBl+LAlKErHwt+oGMgTA2ngE4IUIOH3dGr/hAKT/m/UBdSJYPuVL7vflU26352sScCWAD+0EsCcDVxewKjfmAzAsENVn4EfgdySgnYB81yEAgL4RA8T8mTUASAAYBgylQAkL8K/+zL6rsl8qF6ArAeS7WRGoAB8Sf7isN/VZqTs6jQ5wXlweWfyqpQ8I4I0TmCCAT/3I/b48u92ef9bt9nwNAdZE4FoOFALYXcAGegkDMByAzzQEgJh+cAIs/legH0IA5QTCPADE+7ISkD0TgA/8sBIgLQfOgF/F9kPcr+J8fIYguyCILQRKgV4DNviOzoKqeJS0u4AA3pBAjQSWT//I/b5OmC0MWB3ASgBrGLA+IryvDNxCgRXo+wKhjgwk8bcTwUACsJ09ANRVAALwCxmEoFcrAUsuAJ4M1E8BDuHABAHomJ8RgACrZfQLyT9dBWi2OOEG9NJd/TDQ8HAQuBE97ZhjGKy6o+imnU+4gDckkCeB5cMfud/v6zr9Dz84gOdCAM/3JwQhF9CAD25gBWWz/8wNgMpj3K9Lfy0foMMBVffXyT4r+cceC9bvCcDFP0311QrATPkvWgosYQFLAuoqQEcQuw3v2si25F+M1RkZXLUU+CgBmCBOEsCbvECOBJbP+Oj9fv+u2+3Zp91uz9cy4Kfebs/3ROD6iPD2b10YJCXB+0PyrgsHdtBuRACfBeTN+uM+suJPSEDbfh3/oxPoHgwiC3/06j8Eutj69sAQqj++I0CUfvIpwCEvYCT90O4Pn1XsT5Ve1/+dcp9FBh3woqXBSEJkvjHHEOUPqJPAjUUCeOMGfCJYPvOj9/t7//d2e7YmAlcS2B3A8xcPYcBm/7ULEDIQew+5gS0EIEA31R8Uf6gAoBsgKwBd9ddvBBJAs6XARgLQXQ2o7T8+IETe+9eRACg7rhCMVgCiE8D4O9wOCb2ubOht1/vYd2ubzLlgKbBHEDSnAMfL6durVm8qBPwXWz7rY/f7/X/fbsvL2+3Zqv4QAjzfw4COAMAJbEC3wC8koBJ9lAhgxZ+4hi3Oh/f8dU8EqtV/JhHgWn9cC4CJQZXZp6GAk/1nawMkrrcqAiwPIIA2FwOB2oaAF5UkcX+GADBs0I5gsNbBQqCorJcFJjqWKvhNMjky0Aek7/LZH7vf3/vO2215vruAD91uz/dSYCOAPQzYkoD7vw34sFIQw4LNymNSUKk8Wv0hCYhkoJ74Q6BboO9eDKoWAHXvBiCvAdPZf4nt3QqA924AbfXV8t8uN4Bt2We029WkoErWpSoCSm11TM8AOYA5uRS4RAITIQDDavaYHxCcm5exfM7H7vd3v2N9McDt9uxDD//WKsAG/ue32/M1DEACuO3g1jkBsf57fqCL/7UbIISAio85AAG0VQEYiIC9DJTYfy/+Dx8HlpeDRK8G90IBHQbgWgD2WT8LoOJ7NyeA5JEkAwwxmuqzur5X6y+sBEwDMggrqoBNH7c68Puk/fI9Vwfwvx4e6H724oEA1iSg5AAaAewlweeyLmAnAHQCTfU1CTAH4GyTMt+QDMRFQFEYQB71lXUAOjHYlvTqh4N2xe5yASoh2PpaJUGDBDrLr9cGIDlY1l+vDlQOAQHckYMiA68KMFsGtOy65RCGsMIDT+QqJoD3yUwCy/f+6P3+7koAt50AXrwigM0FrIuEoBrwHMMAUhmQUKAlAwHo7VmAPURo9h/r//ozLv1V7/5v6wGMV4B3rwYPXEBqIZAQwp4TYDE+LQlqtQfw6my/LgsyZaeLg7wVgmDnWQ5AA5ZWCDRx7ECzyn3udgFptFCIgTlyFRMEUCKgA+O/jl2Xz/3o/f7Otz88QvpszQOsLmAPARoBSDVgud02AthdwPZ5BSxUBVr8L3kAVHrvs076KSLQi3/M9QCJ7H/G/rf4n8X41XIgcwHecuBMDgAe+BHA6uQgqnvbF5DB5hwUQM3vQgIWkKOVftH+gAC6cz0RXZ9MjmD5fh/ZCWCd1CsB7CSwhgArAUgIIC5AQoDOCewJwab+CH79WR4C0mQAZT4hEQS9DgfEztNkoEECDfi6FAhZflb6Q1XXqwHDEECpvZX4a0qP1l7bfAS98cQfzQUo9a4mASMC0CsIm6JGK/2i/QkCuFK9PxmIYPm8nQDu795uy3K7LTvwVyJAB7ARwJoAVLkA7QIkJ9A5AQS95Ad2YmgvAJWwQFcBpB38pUuB9wVKbAWgCXwV86Mz2ICKTwUWFgOxMEBicr0eoBwCGBUADfxsDsAiA+zflNay31ZcfnAdAAXgDGkcdAcfZCJYfuCX3O9vf/vtthHAmgcQF7ATwOoAtn9IACsRSDkQ/wqIIUGoXYEQQ/sL5IDJP539776DwodVAGlr5QBgP8sDdApP3gSUXQa8/rZsRaBeHmy+HwDyCI1MUNlZzX9iJSBO9igJGJYCo4RdIqMfJQ4Ztq8C7FXjHuSnQ92XH/yvdwJ4Z68ErOXAlQRW0O9/JRG42v9GBHsuAImAqv+uzDo30C3yAfVHoHeg9xyAp/7wlp+WFCSWv1sOTBb+0EoAZP5DImBrApAUMFHolQG19c+EAkbpjyUEdQ6gm/QEsCzZFxKDlWNwprJVWfBm/1WAvWrcQ0ie7Lz80H91v7/9v263+9sPI2zrAZAEdvXvXMBKBJIIFDcgyUAEvHICg/o7wA/Bvyt35wCc2F9Cg03RvRyAA34N8hD0xsIfXP7bQgDMFSgyYO8GsF4N/hQ5ALak1yUGRQDZZJ5VWXgKEsie8yQuH63b8vn/8oEA3lsJYJ2EQgD73xX4z9bs/74gaHMBQgA7+DsXAJWBBniHCLTtNx2AUnkG/LYNiUCpvX7wp6sIOHF/lwgkNf8UGagwYMgLMBdgLQCyVgOyciCGCs5nz/Jr8EXOQOcQZEbrfjjTU8qaCBseMyx4vxPB8iP+RU8A24Kg9R8Qgaj/av8lDBgcwApQ+QdVgW0bKr3+jsk//AztzBKgtv4K+Kj08rl7JFgt9BnCAIsQcD2AsQAolQj0CAGAqhOFCK5u3cA+84dyIJLCPm6buAgoBa5qDoDF6wzUkZ13iSDKKwTamSKZSf29cuzJUwq7LV/wz18RwH2Nl9dKABLArv6bC5B/+9OBGxmsIIR1AQ3w2gk4RECTfwBulgC0rP96/FYJUOv9SzkAB/xuKTBY/qsTgZ0LILF/s/RW9v81ywEwhbeAwUIH6hRwGp+wEOhqoF49fojqQoPlR/+z+/3t77jd3n3rdru999CzEYAQAYJfXACEAqL8W5lQgA5uoJUK9zxBB3ii9ALiYT2AjvuN72wFILP+XdlP8gLKFeg6f5QM3AC+VlMMZ9ABGuN+VePHWL6tHVD23or3tQPo2iWfBRgShDp0ELcBjmIAbwTWqEzIJvLM6kEDEFcD9erxCzg3my4/9p/e7299x+323lu32+oAtjwAhgE7Cazqv7mAvRLQcgG7A9B5AAwHus87CWBYsIKFfe+eCSBgt2J+7QBQ+VsogOU/9fIPBvLhASEF8AHwlhPQ2wVYFhmo/Wby74QyYLcmQAEbbbue2FcnAb28QTmHQKBwNVCvHv8IESw//h/f7299pyIA7QIE/LsTeIbqL59hPUADvHIBG8jBIWgn0L4rsKMj2Noomz8QgZELsCoAAnh0Caj8lup7ib9tX+ZBoKgUmFkWTGJ8S/UHZa/kAHT+QGaeoeQmMUC/CoAzVYAjYDvSNwPCq8fPnINus/zEfwQE8O7tdt8dwGZjIQQQ9Y9cwAB+RQIC4I4MdvvdLL+O//E7LgLykn6q3Efjf6X8bOUfkoNYcQZ8z/KzBUBYCqT/YQgjBuOBHxPs7JHh7JoAy/IzWz+xEtBKBEYg8fIGw+SeQQQ+CzHZP+oWXWPU/8z9y0/+h/f729/5kAN4791X/6/cpl4SCsDfLRQwHEBLCmJFYH92vssNgBPo7D8qv4CekIHpAjKgx1iffGbKb5UAQwdguIAtz2KsEWj7vIQggNON91lYoIFN2mznYKj9UBmwQgXLLcDstRTdBchEFWAWcLP9MgC9cuzM8aXN8lP//v3+9v/uCUDyAM0FIBFADqAjAsgFiAvYwK3/MfAL8InSd/Yfy37Qpyv3OSTgxf8C5vZXPfF3aB2AA3hJGg5LghMOgCUBo8SgEAyC3Irvh5xAwhW0cT1iQBKYWds/QQLdeVUQcrEjeGoiWH7633sggHfWJOAaAkglYL/wLQyQf3tYsCp9CwmgFIgOgIJ/JwMdBuB3cQTDX4z9wR2whN+WE9idh67761p/F/8bpb8O/OotQCsJDhZfji0qT9p0LsCI83X9H8E9KH8iCSiTrQO29bwAAbvlCipPAw4T/oRKQAVElbaMJ472t7jnqnEjrlt+1t+539/6P4oAxLquawIkF7Bb/40M9hAAHcD2GVzABmBYKSgxfyMGAbROCipl1w6gs/8ZF0Cy/UIOOr7vHAIu9iHP/2v77yX9ROUt29+AHVUCnDJgtvSn8wXsnQGzIUAW3F27qFS4z2CrD07wCogqbR8LtGecUwR4vX/5OX/7FQFsOYC9FCiToBGAEAH83ZwA5AM06BspiPKrNQIt/kcg69iffBegNqVXb/wdQgIMC0DltUuQ+L+Bmz0OrNTdK/91+4JVf15SEPMCYRkwEfc3stBxurMS0AoTMKRocaV8cKw6jpcFsdUn2/8qRT8buGeP55HC8vP+5v3+1v99cADvvfNQBZB4dO24Kv5GAntSUOz/+n1wAis4wAnoMAC/N9svSUKsBABgmwPAbQTwWzsW/2vAI6j14h+1CEjnBYZFQWSxj+sEVFyPjgBBrhf+aOtPY39vRaBVJlQ2vyOGIATQsb6etBguDMSQyAF4IMhUAmZANNNnUNSqBDvtzzif6HSWL/wbuwN4eycA4gDEBQgRYPzfSGC3/BYBdOCHxKBHBAJoAbdWfIz1I9XXsf5g9y0yAJB7iUDPCaC6e2EA2ngMGyIHwAgBldncf4ID0EDXVp1NYmbnrclOtyfDhiPOoCO4CEXB/rOBfOZ4yy/8a7sDAALY1gKAfWMEgOovoNdk0IArKr+7gwH02gWQ2L4t/sEEoLL2IQnoFX96HYC4CIz/jcSgAJSVAtu2RPZ/SPRBHkC7AkYEqceC2fqBfdKaCcHAAeAkpKVBCANcElBVgBQRTC4HngHOTJ+rQo2jhEbP6xf/VU4AmBza7L+EAZgLgGSgxP8dGQDwmQOQbS2xp6oEWAnQn1seIEMCJO4fsv8Q2w/JQU0IJMvPiCCT/NPuQP/noJ0rAFBa23VSr1N/vQhIgxzzB9odMMIAkGvFZPF6JkyIlJeFFl6IcRYYX0ciOOOcll/6l+/3t/7fngPYy4BSCmyT0SGAlgvY4/+BAET10fZjUhAWCg2AV8nBEPQ6D6DJgSUAoQ/G+Dr+T9l/pfg0HxAs/e3WBUhbsihIgHKkHGiGCQHYO/UHomDgdd0BcRkZlYtyAFlgZNtlzqkSJcwc1xr/6FjLL/tLPQG8t+YA3tuXBKPiqISgAB//bjZdkoNE/Rs5EAIYXIAKCwYHYJADlvhalp8RgS4PogNwFN8jgo1A2LoALxRw1gA09TbCAjckQHBZlQEFwEoS0Iv1S3mAYFGPlwOIJn+0v+ocPohEsHzRX9gJYM0BvPvwTyoB2gGsP6iEAowANsBJWAAVgRYeAPCb/WdkAKEAttNJwRbzM+UPQI8K36k9Kf3RagBTe2vhj3o8uAFXLxUGxTdXBrK1AIltTZ2JzUe7Lp/Ralvxvrb5kcWP9nv2fwBzIRF4FRFkx/XcwRljHCGm5Vf++fv9re+63d4xCABVRhOAJoOtRCguQKoCmghwv7L/mBPQwB/KfMQhCEF0ym8RAUkIToUAxrP/gxOwSoDGmn9WCjTzASw3kHQA5poA7Q4g3n+MEMAChiadiopXwHZV26usvB43e/7Lr/pznADakmBdDcB8AFj+5ggcF4AhgAlwwyUM6m+pPgF8U3BS6jOdAAkJ3HUAO5C7ZKBT99/IVDsGhwyY3e8qNfhCERXDa5BrlW/ftaoqe265Ar0U+PIQQCUzqwqYBYfnSK4AcuW8sjmHaMzl1/zZnQDeud3eXRcCrfH/ngNYbyxzAKL8nQNAMiC5gI0gBNz42XIBAnAkBACwqDyWByPlp2BPWP7WD0Crs/5ewq+1JaBnWX8rEajbDiVAlbNpwHRyAJ4D6EqECQcQWfxo/0wI4E3wcPJnUbSLXqH5A26qHaD9kb7ssKaj+nV/ZiSALRG4rwhsJLBfUKt/k3yAJMGwEtCFBGD/PTIY4n6d8ANyaEk/Q/nPUv8h+WeRgXYCVgIwSwbK3osKi4PonEGUC2C2Pngc2LL73Xanlj9bBTg7BIgAFe2vuoxZS14B7wy/DCT8xX/qfn/rrYccwLtrElA7AJkgkrDSJUHJfO/Z/wZ4Kx8g4IXyYKfm0i9QfkoSJK5HghALr51Ce2Jwv0ad9BvAj1WCidKfZf1x3UDnvPQ90HYf7o1WfSQMGbOpU1D3H6oCynpjPE7VfSccpoalMEHNdAxFKkDLgDzTRo5ZaXukz1E34f1Gy2/8kzEB6MUlsjCoCwWMEAAdgOcGTECrnECn+JYTgPyABn0U82vwt7hfJft0rK9DAlHooTSolH94GxBUAnTSL/reAbz6UBADt344SDkIJBIT5E62HgnEAwgFmjq3ChFkAJUFd7Zd9fwsdZ89nnX85Tf/8Z0A1hwAOgDJAxBbuU1usboYCoiCKvWX+L/lAUDlNUG0bD8Bt7dviP9Vf0v9LbV3XQCz/3qbZf2d0h8D+JAPYDb/RAfArL1l92W7Z/OjEICpOZvkw7bES0EisET7M0RxRNkzx78qJGj37rf+MUUA+zoAnQjs1gTAhJNyFy4X7kBtkYHKB0ifDMgrLiADfJMESGa/Cwe0/a+CHsmA5QQ8N6ByAzJZh1IhEobOAegsvwaVDhEKDkCre0cielYbau4SQfIZggyIM0DMtMkc6ywnMHMsduzlt/+R+/2tt2+3d8QBiAtQSUBaEVDxPyYB22cEuiYDQgJtLUFk7539ke1vgAeAR05gC3ekbAclwuaEjEVA3XoAAnLpT6sBCuStrUrIpqsBHhkwcBOVTecFJAteCAFSyk/GzapwBOJofwV0mbEQkNX2p/X9HX9IEcB7eyLw3q8IlPgSbV/LBThEIMreQJkhAeYOIsDrsELV8VmIgHX9ITGo1L+BnxGB5wQY6IvKLzZZCKD7nsj8m+sADjoAVHk9ga19tF1CzSk5GO8T9MCUAdpZbSqEUW17lpNYfucfvN/fBgfwLlQBcEnwdkA9cdGiCjCgGrCpZhACDMSA6wL28dewgKl6GzuI963EXwtf1Nr/wQ0YMb+bCJwAPgKc5gPIPeiImeUC4B5J2zbZnGXBQjI4Mdk2HFNPYqv9MNlJCJByAzPPEezIiUAe7a8ANjPWGYpePc52Db/799/vb7/zKgQQAnhvDwH0cwFWLqBluwkRYJ7AqgoMTiHjApTqR9ZfbLxbCbCUX1wOKQGiO8ASn7XdKgMimL2SoG4nkxGVnqk+OoeBDHR4AN87EmCWnlULBGiBuiNJMFC5RJB8HsACRgYwZ7WpEEY2pNEuYOoYv/f37Q7g3dvtnT3+39YC6BBAv3IK1wVA9p8SAYC5gRDBqz53QDasvag/dQboGMCy0zBA7e/CgoTyszX/VeA35QeH1YGc2Hwr2YchGn5mJNGVd8FdoEOIHEBo9VkeQc3cqFJgEkPhxSBHwoIMCVTAlx1vlggq4y+/7/fe72+tDuDdV2XARgD7isDtd95BpZWjKRUov4Acwa6BT5OEsEjICg1aBUAl8DpwA2kgQeCYbHsjL0zygfKbll9XC5xk3zYGgM1yA0IKERGgI2PJQJ20M13CAQfgWv1kEjBj+Yc2zlqAGdWPgBPtrwI2O16FXMrn8Ad+z04AaxVgTwDiasAtBNgnrK4E6HBgSApichCBBHkBCnQNbmb1iTPoSEXlDXCfTv6x0EAA2OUDtCPA70bMT6sAXjVAlf4sIhieC8BYXy0CYk5gIPKCA8CJGzoAI5QYJqoRzx8NAZ6KCLLgzra7igSWP/i79hzA6gCAAMQFrBMNSUCrFypUm+x78k/cQRffY45AqatOGDJy0CDHkh5dDERielFhWvrTIYHO+icy/jK+qe6sCkCAH70erLsXylXMWv5GFowQrLyACISU6HZ0W+RALX0Qz2ug4NgYUWScRNQ+q6IZ8GbaVMCdHS99jX/4dwIBCAmsoNd5AHAB1sRDArByAV1YgLkBnfRDF6AtPbP4LNY32lkOgMX/tPynSKFzC466Y2JP+mT+mk8BOiVAVP2MA9COgH4nQGcgHxyCAe5uMicqARTcJ+QBIlB5+6O+V4E7c9wMCSx/9HfkCEDyAMPDJiQZ2AABqtZUVwG7s+ZWMlCDO/F9iPFZso9l/IkDaMRgxPqe4g8JQa30yg14pdaM7TddgWHxXcUPVgLqvnqyWw6AqrlT0jPV33AekYJb4IlAdfX+6LwR0BVi8Yhg+WO//X5/e68AyLMAawlwCAEwF2BkpTfgqwlu5QU6G45KrdYNsNi9qwAQMgjBnyEDI77XYGcxfjXut1wAhlfSptsGoNHJPab6XkLwTAeAk1MIidp+mJlRJYCqPxCABwizr0aUDl3I/ogEMsDMjJEZp0oYjECWP/HbSA4ACEDWAbA8gJ6MjADWbYP6i5LqvyRROBBABHgjXEAV14k963s7d0koOkm/s+J+FiaERADqbjkAHKNNrsRCoE7lmYsQ0HjlPm+dgMzKRLmQkkgyBJhR/SPWPwPyTJuriWD5U78FHMB7eyJQ5QDaYiBhXL0mgGWumRNQAO/KbieTASMOL8bvVgUSq2/lAvAaOvDiwiEjs6/BThdZ6bUBJNvfuQN0Z+pzVzI09nXqrT3UMRMAACAASURBVJcKg+J6xKAnLao7Tvruc6ZcyBS6EDpUXUIEvgyAz2oTnQuqe+aYzT386d98v69rALZ1AEIAazVgz/4zBzC8aorlAdS2rkIgC4e8v2TxkOsGMLeA45I6vgZ7ygFg4g8JQhOdl+FPZv+ZnRey0CQhE4PtH1TfCBmkXQd+S+1ZXkCTiQZq0gG4sb6qMHSAKFYQHpsIMoDMtKla/syYy5/9Tb0DWGP/7R8QgOUA2NtnzEw3LhRS6hjlA9CK6/gfS4XU5rOk427p9bg02cfATtS9CwGcSsB6/taTf9Zvx0ItvQ2JgH7WgEYyMMA+5AwmHMBMDsAjAhrPTz5M9H4mggy4M65g+XO/YSeAXf1lLYAsBca/24D7MwKdakBIYOUBxKYyJ0BDAeIOTOW2QI75AgVkXNVH7b+VBFTgDisAQda/gd5LrCrlZpa/WXJrEVBk+cGxNWAkqwDMQWiFNq2/zNKgDOi6A2NFICULRAV8rrSN7HgEzmh/NH4G2MZlDi8qXf78Fz8QgNj/thjIcADtvw9HNcgQwGxIwPIGLHTQVj8BfszWmzkAlZsQwFrlPbcCYOUCjBwKKwl6pUBRWyFhukxY7LmO7414X8f61BVY4YLY9iDBhy6BTX6LPJCoPHtcAXelbQRUD+gZEojGZyCvjrv8hV/fOwArBGBLgnFpcGdJYUJ0gNknxLDNCwm8xKEV6xtqPwt4DWpm92kIQICN7bSNF2Xv/pLfUgNd5wxoCEAA34GbqL0VAmhSuMIBuIqv8wGJRUQWmCzAfNIQwV/8tff7O+9BEhBKgEMiUIUAXjLQinMbAAAcCIruFWMVgBPFX28iLhW2Yvzu+JCo06A21wAQm69XRVJwk+RpaiEQCxeQKEDlaWhgtEWQWEqvt7vhwoQDKAFfjR+5hytdgjf20X1HLH/kIpa//GtUCLATgE4CogOQz628IwzslKx0gosuG1bWnuUGotJhyzUYYUIjBSsnoJKVXZnPCAeYo3EBH1UDDIA38CniiBR/CA1I1r5VEQBUg/1XVt8jjG7iWZUD5WEz5UIK8sRagIhYquQQgfqI/a/aeBYKZMOD5a/86r0MCGsApAqQcQDbgTQBMNuqJ70GE/nuOgMSGjDFj7ZZhNABnxBTIxon459Vfa9yYpUEEfRU5RXounEUkJEgGJlEYNb9O2IQ16hsO07y9nk2ETjzJKG4JIKUSlgQKqyDzgzQM22ic/AcxPLXflXSAew30no8eDsJvBGWyhmJsKojQOAOi3R0yRFtPcvuqxo/tf7qeryYv2T/mZqT0IARgfzmG9Eg6erP8Jvr+4Tk4Sk6IwnWfgA/IxsCPhmfKWuk3ugcqENIgLwC+hl1j4Ac7c+CPDNOd4/++q/ccwCRA1iFHkqAtBrA3ICh/J46Yp7AjM+DHIK27t1aA0YIbKGPIisrw59NAOqSH/0NEKyMCBS4qwnAtNpnk4JGnN8pfKYKoIgiA2R2DEYglW1XE8FZQI6AHu1vv8nf+BUPBNDKgFYOgDkAsHdmQhAnkhP74kNDg72OwgMP0CRuN90GW+CTdCwWoVluQKv3EAYQ1cZjuOpv9JXJNyT49KIgliMwlByVu7kJUFwvPBjcQuaxYSuUOBAGZMjGIxEP1BEQn3z/3/oi4gA0CQD4uxAACMBLCKLNjFSPJd3Q7rtJOWu1oZNcHMgmE+8H5T3P3Xj7OlCzCgEeN+sEVDs8Rpu4Ol9ggd1ScuYWkAQIsDv1lrYqB+BZ/2FfsBqQAe3sbZG6Xwn2aGzr3Ja//cuJA8CnAXfr314SajgBkwBwAs6EAwmwWWFChThY0s8iI297B3DDPYRtCLi3Psb2AdRAHrKvqb9BCEyNtaKXS4OkoqAnomXjKUEo9e/GSjqAs0HvAS8C5WzfaNwKES1/95cZDmAlAbIacPudIRcgi4H0oqBuUirgU6WDSVtJsHnJw8gtZNyGWeJLEJNn61vZzYjzo/3dQ0Ea1DgmUXMWAqTAbil9UOaLynttQj+iAzibCCLQRfstUM+ShJiqqP/y937p7gDuex5gBz5bByD23woDMA9ACeCAG8jkCLTis+8ZUhjCAisZOKvwySw/OoWONFWMrmv4ZsWAqX+wrXMGbLkwnMvgIowEIWuHTsV1CTKz978WeViA88IKDzRnA/Ts8TyCcUng7/+SngC2twFZJLBPljIB4IQ1wgA9waPM+rCfJApN9Tae1beOGZ1LO06CEKj7UbF9A7CVB7AShIa9R3Uf1gOwhF9V6S1iEEQFDqFN3my14IJEYNYRTANNERd+PZMMIsXXp7H8g198v68VgHf2uP9dBX5xAtvbgaUUqEqCg/1HKweAlx9vsLeGIlqxchWojCyqY1RCgXK5jxGHofIsD9B+V92nSAgIxCEkgLEGBU8mAaO4PgoVmEJbOQQG1CzIs+08Msg6kAwRzJBOlgiWf/SLRgewksCq8l0YAKBveQAgBGb/t4vDhJQmAwf4a9dQeZPWnJbiHMfgOYeNlAKlx3BFOxs3L6B+LySS8EUg6rzwuEgQ3luBGugDqx/lCzyCGPbtCBBi05M9Io2OFB4hEXgmGLMgzZDEjIvYruUf/0I7BGgkAJWAbY46SUArGThMyAIZVADH2ppEkiCBir2n5xmpu5ME1I5pUH+LYEnFICKEDpiFEADPSSu0JhQX/MphTBFBIYnI3MRjgLviLs48H9OR/JNf4IcAK9bxPwoV9TerAXgj4T0BOJk9MhAQDZOfACUCNgIy0zbTJpPZpyGAQwTiKug7AYkr0L+N991Vf00gpGyHINbK3yZVMQQwVT2xEMh1BEZ/Nvk1EKsKmgXyGeOeTQQdEf/TL3wggNX2b/H//jqwLRGo1gC0HMCeD9AlQPw+WDqZJEZIoCdaNY6OgOmFAVq5u7ae3Y9AHam7sd8kApUsZHaekclAvrv86eoBcwkZkFvrA1hf1wU4Cu4Btu1T/c8G/hWgrxDEmSFDc0D//OdDCEAqADoPIMnA7a8wrv6LpSEFfJlkoQtAdfKShEmAWlUDN7xgOYYE6DPuBY+Lv0W0HRXdK/cN2X6l0jqcsICubbx2AVeFAK7Sy+zV1YDiasAjgH6MvqZth+vXH6sksfyLn/eKAFaw6yoA5gEE9FYScDsZZfsR8CwhSJNb2Tq5UVLsQO0lE5Pk4bqRiBDU/oEcHFVn9X1T4dFZ6TKhYfWZcltqbm6HsZm6D07QKuGRcqQGgEUKSF5N2QySYPutbZkw4SmJwCIIJIXIYSz/8uf2BEDXAWAosN/w7gUhAHwhge7GY2wGBKFtf5oMGKgcl1Cx/wKwKKQY2hWB3oHbqver7ab6J8t/2L9VbaR6sM8auk4gArlRNbBchQnSaBw5RyV7lRCAgSYCerS/otRZwqiMmSECc7x/9XNUDkCvAyB5AAwDtrlBQgG8KegCOsvolQgrgPKcQKTQSReBhOCquBP3a8LTToXF/vpY8ls2J6AdBFH/rNJfov4YDoL6UzVP5gDc8MBJBFbBnwHrWW08EEcqrvhw+5oNBZZ//bMLBCDqb7kAcAJtUQeyOuQDcGIPnzFeJQClSbJqngBULW3xIzKpkBYe3wGxkISn/u5zASwccLbh5NHhht43ELsFcGeFXwfmA1UAdBsZ9YxU/ej+zDkwJ+RtO5Mkmhh9yc+637cKwJ79lxyAlP/kKcC1IqBzAJgL0K4AQwC0m7hgyAsBrAVEaL0HJU6SQKeiyT6dWictOwsTsqW+9ttosAax/pA3AKJBEqEhQLX+T+J2PG9GEIxEPPC6ag/SNzhOtm/fZo3JABYpfLT/KBFU+leUvxHNR37mSAAC/lYBUDkA76EgIYWOAHASKnXHm4/hwaB8pIxIV8oFFpxlziNws/0diSgF91bwuQQmE7QQ+2fUvwO+pf7KkXRA9db6W6QB1+KCHu1qMgTQE70DoTOG24/Y5qMuIEMOFYBXQ4FM++WjP2MnAFUClGTg5gCEAMhy4M4F7JNou/eZ0qBWELD7qO6D0uNkZXmEwKqb4HXI4wzAa8ejLTYSjb5mfXz8jgCvlP86YrhC/ZH4lfpSFU4SgAfMo88TZFxAlRgyY1aI4Iy2zQF87KfbBLCVAAP199YCaBJAV9AlnAxX0NqwnIBSrHSSziAPa/VeJt/ACMp0AY6l1+CNvofqb6h6NikoJMMUHN2apayZNt3YxRwAPa6Tb2iTXj4cVP2MwkdkUQFz5njsGt1tX/rTHghArwHY7P++DBhdwDanYCWgzgPIfh2TtfUB+6QcJhcBedfGUXoGwAaOyXhdKy4rC1rxPAtlymqfjP0x5h6ArVSdARJdiQa6BWC8t3h8RhQ616AnY+cEigRQdREWUZ1NDBnFz4I5Y+OroMf2y5f9VE4ACH50AS4B7OD28gDtxyEVgW6yOIQwWGlg/Uz8bQLXcBoa/AM56Dq8FcMbCTyx/o3ISF3fsvaMWPRv7JLEPht08nC4TyTDb5UNI1VnwO3coaHQFPBKxa0QwAO/G1LAucwA+2oHkDkny2Vs27/8pygCANUXF9D+h2CdC1CA334rcQf7Z7yxsp8qiFpBOKhPQAiW6jIlN9UdzllAKQBjdtxT9eF8HJLQ5xNae6Lska1nSu+pfyMjb3GOlxwEYrHANwA6sO/abdBxyRiPAf4ZoGf6WOA9y0Es/+YnAwHs4JfsP4v/JSEoTgD/is1veYFZEsB+xAp7gDEX0yRU2asQaHX2wD8QjEEsCDKt0pZqM2LpSqaiiNpteCW7mQSgukc4UTWxsH0Z8EaKT/erRGIW/E/pAo6AOdt35+Pxvwf/t0gA8BKQFfzZMiDmAYakoJ4oUB2gE4UtHDLiYQSa9bnsDEhJj4HfdBYHF/V4Vn8gvh3sh9Rfk60ot7c9Uf+Xc80AkDnCNGng+RrnzCa/RS6Z8zXBJDv0ORnf9bHY96Pbov7LV/ykMQfQrQMgVQABvP67//60BKgXA7UTU9Z/mDgk+TeAndjrBtpCBcEF9Wz23on7j1p9TW74mzaH4jgC/Vtri20uDdakzvIDbTL0y1I9Gx+V8CJHgNeTBfIMEXhjz5LDU5HB8pU/ccwByBOAXQ6AxP9sQVBL5EJGF8uByPYDCehJE1UGAuB7JKD3MadA22iFx9DCiPPpeZAFOZWyH46Jk2cDPiZFRX1IvI7XrMdg2fsOvCRsYGMM25QadgC8KAeQIg5BblAajOL26v5Z4DPrb6m95wKWf/cTxhwAPgJskQAu/aUhAIB5+22J9aelQa0uOuFFQoRBCY2Soc4PNBDBMQVAGJ50amqVI8kYOH4F3FTZsyU9EvuLMs4q/NBP3SNT1Y2FPQyQcs0RYYT7JxYTZQgiAmoE/Ki/8E80DgO+RQYe8Nvx/v2P3wng9updALgAyEoEYrY/ejS4katyBegG2OfOEqpSX7s4K0QohgVUpSft+5VgR7BFsb/nEkxScByD/s31pB2IIOMSIETRE9YLF0wiOGMtwcUu4EoyyIAe79uyEsDwIhAsBSrrT6sAuyJ0i4KU6p9CAkpl9boBNuHT7iCw9vThJBJfe8erKrt2IZZjoWSIcTkLCTwVt6oC6nojwLKYvuoWIsUf1DsZRljn7m3PAPcMBY/GqIK8YU/IHTYs/+HHKQLYAd+tBCQkMIQA7L0AQAxo8bbjI1MXPiOIqMJNOgIEly4HmvsUIaUA7oQ0tD/LuBsAzTqC7XosUnAy/MwBZADtKTl1fjhB2aT19j9RCHAGOWTGyII/Gyos//HHAgEo5c8kAbv4X6m+lRDEmy73EtViSEA5pcFOIVTSMHIEAgTLVuvVceXVeFWwO3F+ByIW5zuxv1ZRRqL6d2TK64E1Y/9dIiDWfVB3veqPEcEThAARcDNgPKtNdC6Dw/lPP+Z+fxcWAOHbgM2FQKDsQ/wP+7TSo+qzsiAqk1apLmGoVUor4kTpcCCDALzZen1EQpbNp+QEjgNdiZWxN8t4pCKQUXeLOChZOFacEoFxTmzsYRIjEZwQAnjjRwCL7Hu0PxofLnVc1IM7gzxGE96vWgkAHwUWF8AWAuGDQOyhIAQ/KwPu+9t5KmVvJwXtMHSgE9BQfU0g7oMy2g4byb9ZMFtkwUCMhNDtJ2VDDVoNLBoSEBLpQBYB18kPpElkv9HM1XRzwFB85gzw2BaArX4uoRRAFYG7up+RQYYgKm5i+aof/RACiPK39wAAEbB3ArSq3v4Bl//qpcAa8Nt3QhAM7N0FE7DTSWc4goEUAAwm8Ky1CNYCG69syWr/BJBWLkArvWflL1H/iDwE2I6dH0hKJkeyYtCRFYCThSdZYLuEwo6hCGwGlE9FBsNx//OP2gkAwwBJBBoVgK4SsE8KyQWwuJ8RAoIdCQJvpMXqVnlQA3z4TpRdjsHA1IEo6hss7JFzQQDQYwaE0AHAUmMrSWgAmJKomuRH7D8DmOVWGMAjgHb7T8oBeORR2XcFOcyMyfps2776C/ocwPr7df8rkEMC23xS/0uQLgVm3IBOAHYni1ldneHVcSMJKdbJEYYOQU7BDR+M8VMZeQZUY1tHVNYxlQJnQgJNKNbk9tzGAFovx0CWDXurDkPF1+MVcgBZhzDbbgaoVWdQsftNaIHcNwLQIYCQgCh9SwaC2jfgQ/lPg92qAnQnokIB6gCUcrlVAqNsZqqco+xMtTM2/FTwVxyBofAsvGGgNe25UxqskgxV+ETIkCaCAgFEzkLmqdXuqZ1ARBam6gMAl6/5kSoEUPYfwa/fBNSeBQBi2MZW7wRox8skBgnYTUfgKLeA11O4KDk3gJ0pWzI00BOYxuhOeU9fhwXWqdg/Io7MfuJKKNhBfRrAJisAFJgH1wF4oPYAF4HxyP6oLwN6xhls/f7Lj7jf5dHf9hdeBNoRgJH5L4UB+2TSpBDmBADsCG5U9izYq+Sg25uKqqsJhnJ64JdrcC13Mfan14tAdDL76MhM0qmOFdh2fRxGJBZQoycKI7BkQZ5tFx0v2h+BPw30BrhXH7bweCOA/eWf+kUgFvjxKcChGqAAbuYADCLQ4N5O14j9I/DjftcGe1UDpn7Ogh2LhCrHfyzw098Hwews/aVkkMzkD8qd7JciggNJQItUjoC0CuAjxMLOMzz3r/3h4ADgLcDM+ktOwKwC4HJg9ZmV/RoXWaGBUv1TiYABO8ofWLHwRDLPBd8JCn8quLMWPeMkiPozK5/dNpBCkAPIgnwWiLP9QqAqBc8of6rN1/3wh4VA8gRg9AxARwI7iFgJUCcAKwlBFg50lQIdDoCbMC1rpYKQrBygW+kUMcjkR+CsxvHus/sReCPQRvsR0A74rPCBnXtK6ZVTsdzgYwK+ovaVthE5zCi/8MnydZ+vQgC1AIiFARveINHnJQMbNlHlAbDbiTj7NBmUiYCoNqsiDBNUT+YjoHaSh3Lz3BDBcivedkaSjvqa8X2ypBe+QEQBVl9vBHrmCCi4H7EKcJban00GFcJYvv6H9UlA+i4AXAuAZT/1WWf/LdXv8G6VAQkxlMHPMsJFJ3CJylugstTaU2FPdT3wZpQ9UZ4LiYvU/TswJ1xDRsWZ88v0a0oIFjtDNt7YEQCPEEc0dnX/AwGQ2P9oDkDCAvld9XdP9dEV4I3tbpaenMZ3V2lIn0yCSlv0wyTh1Nkz9p6ppxVGoFU2VV/UOqn+6NKiMbtzdQgmcgRv1P/hJlXdw/C7/dcfajsAifeFDESU27MB+wa5jzoUaOB3LD4SA4v9NVF4LgAnd3ehgeozAHugHianEx6wCR+FG2YeA294whVQYtjvWQRUMw9BlDIkG7b6j4VmVrusOp9s/y0ncJX6R+POAD4kiI0A4L8BQ+Uf3gfg2H/2MBBTfdP+C7vAzdaPAFfIwLSERHVoIoqUBjNKm3EDGVIwx8kAOFLuaL86hkkkxcU/jDgrSh8CUhG9B6iMzc+0iUB7xO6H4EWszLqBb/ghJARgTwKytwI7OYAhBHBcQDYckOtlTmFYABIA3XILbCEJ3QaE1ampsRItHTbsF+mqqpUryCzZzYA/QzJJN+ICPLFqLwPCI/F/aXy5N4YjiRT6akB7BGmd2/INP/ghBGjJPwL+1QnIfGf2X8CuQ4GGEZXoO9UFEOdwhAxYDiCtXE79ngKh2t7LFWTAHwAbSTEKEby2kaqznEHUJ6XmCUJJjaPUdFbFK4CvtI2IprJ/+caVAHQSkD0ObL0MxCgJbnNNqb7+XlX+KATYLlwdky4NZVaRxY/ZcMGLZwNHkCaXCPwZ1bbOBZXNyS0wkJruSKmll1w9CsrHdACzZOBdYwWwYj7CcAhcijf+8o0/KHYAkgzs/u4Trqm+/g7gKYUDRNG7F4jKhTlAbz+SbgNjdz+g0S5yA0wFO5AQAnHVzwOoZ/vPAn8yMeclKSMlPwOspm1nhO2oeRZEM+0qgH8q9d/O8ZtWAig4AMGQuRDIWQ48JAUBkO3eRcDWuQSi+pETQOBSdpxQ/kjJI7IYljkrVXaBlajpZxbqeGrOQEDzGqA8OoywfvdqHP5+IICznEKFSDJOYhjvm35g0QEkFwIh2Bm4w3AgcAJ6MrV5R+y9BpcmCFQl+oOz8MByE0qNu/EK4UDkJBihWHF7Bvz4m5jAJct+I8Wn+6+I1a8YE0k4+OwBtaLwlbYZwIfjrQQwrP4jK/82+6+2y8q/IQmolR2SiNvvqFUc3x/A9jOwESfAgB6BnxGJFR6E9tWbhJ499ey9FUbIhDT6ejadAjwKMbSVtkgxY7kvAOuZjwFn1fvq0CACeAhucGPycejzzT9gdABYERheCLqDUQhh+0qeC2iYNcBvWf4wMWgQhE7+CdHoC04TAlFy0zkY6+41udAJkyANar8JKVIHEBFEspYfOZLIxofkmSEOr82B+H9WvWcIoALaStuILNj+bdtKAF4JUKu+uQpQx/5AFKj6NBwQeiLOYCCxKEegCELb++GHcCoCA2taYHXU0IrtXTJhjsd5kKcDpziDBEEgQZkkg+MBWVigiYjA/T3gZofjGI4kC+azwTszXgTaqwlgHX/5ls97tRRYVL2tADRCgUH1yYKgDofE4nc4VqDG/EGbE0ZiziMIF/yGYlCHYJEKKzviJLaOEWTbQ5CQpN9AAhcoP5JWGaBA8lmyKYHZI+FgldwMeLNhgncNlX0RWczufyAAWQqcjP2tCgACV+Z+t0RYAUmIpAOxEdtHTmDbTybBsHaAnIMmiuHmatcBk9m8iexcEgrqVgP2c6cxvFL+LMii2HkYJ5Er8H6TaeL4ANj/CKSPofiIowcH8P23COBGnwHQhOBVALxHg1l4kCED0mbIEVjqTIhk+4GT26dJIXAF0yGBQR4U6MR5ZNsNTkIRS0mVsa8ir+o4LnF4ZKvPYXKV3xWK/1o4gG/9/ioJKC8E9dyAAXaM75sDANDp+N8LA7p3CyjF1Y5B3xxKEsZ6AVo5SIDYZHMvGRUlqqLseLCSbzunpBVGMsy6hTA0icAWXf9sIjC45irZyPzKuJUjIH4KxR8cwLd+v50A1PMAmOzTnwXTYvkld7Bth5uM+9uBo3yAodKR8uP4HUEQ5dFtGYEM25QCDwQQqVAEzAgcQdx/JvipC4jICX50Cpxk/wzoorCkAsrM8WbHM0WCEGXU9qr9y0oAWwiglH8LCYz1/w3wqvznqr5BDhqsUwuEqg5BkUwHdgOI2yGsx02tHIHcaGd/pMQIbArMRF7hCGAwFMqAxWwTEdys+sO9zJzfjBuoKPVVba8lgGISsFsApElivyE45wdXADdNhwUdlkm8nnYCCeWXY+l439tecgvG5OxuZqSMjnPoJnwWYJETYUoenWOkaBP9M2C2yDML8my72fg/Am2FLKKxZvZvfb7t+77KAWxOwEj8NXUHp7DNb3QBCvwSAnSCq0MAQhiitugOcCzcbsX71qrAri9OXEY21nMGHUu9GnG4oQVncMg2Z8FPSDEFNMcVHemf6ssIidw3a6wsyM9oVwXhUQLwznkQMVIKbQRAV/45RKDJoAHcIQMhiwjUQwjQscer3hYh0BWBxhhCNCzej/ZZx9FuIsolHLbMFUWfAXIUviAY2ecKOUVjMTIoXH8EmAwhRSA/Cuoj/c255pHot33uQw6A5QFku5cLQGAjMSDmLCcw4BImixUaCDCZkntuwGtPCcABCx6nHBJkVDg7qSuvwEoAcQDIBPi9MTIAKyt59rcKyGWWHCr9IvJ4kv2NAII8gIC1Wwqs1wUAoi0yEABrx82UP+sGziCFDsgkHLDyBN1N80gjqCLg+CkQJOPqdn4BUOhEniENVJtE/2x8TduRa/IAmT1WBMSzxomO8yj7P/65r1YCotIPn0m8j28BFpVvwGdkoCRf2/gOd1k3MNgImIEEyBZZYEKJugVrHYEoi3EsTSzu5HEIZCCFyuQPnMIl4If7kgVMtt0hUkOCMj5XgVex7VM2XU3IlEAQxyPDdP0//n3GlYAh+FWs370OXBbbqWSfblNxAlbbsuUPyMLLBeA9YLafTZruB8+AO2vps+32650Flqem4b4T1d881oyreWICqJLL1e2XjQDkjUDkmX+d5WffEVeWE0CBNJU/qfq6f0eQBdVv/Qw1tdyCBWzGsDJGqBIZgiCAzjqK0kQ6A1hnjOGBNUEwIUmd5AAqxyndB0PFw7nkOAY9R5ePf+9XSUBGBAJudAVt234Ttn37xi4ESGyTE0rnAIBtBqwfAD/+Zl68r8nGdA3RykEsy2TtfJYkKsfWk+wM4GavJwnA2fj/CDCPgqzSPwoLov1HSOUVAeBKwGgtgJH80+AfbL8OC9A66Od0gFy0UiuCa+Sjt0cKboYQRGmHsR0w4vmGE0GRltk+AapuIlTbG9dcDh8mxpkCauL6wt/eUcojfY8AUiv0Wd+tc3ogAA/8xsKfDuykTVP2/YO1GlCLNnUCiii0Cpu7LUfgjUf2WTG/JgXLORwFtbkE2VLQRNKPTgiHjNKASBw7PZZ2J0Vnc+Q4ugsk6gAAG0BJREFUVVKKQH/muZxKCp/4Xv3DQGLn0fI3sEerAPVTghAaaFyllgcDi1Asq43t6yzwI2IIKgHiOFKWjZyjZ3XZBMuAOJqYbTJVwwuDfIb/l8FR2cy5VX6Ts0HmZdunz90i7eClJZnjZdoMv1EjAMcFbLiYAT+x8TpX0DCeAHPXxAA5XTug7YiW7on9NPYPwgLtEEKiSNjcTg2y4YSehCeBv+xUZid98ne5khCmwHaQDGeOGfVZVgKwqgAiiBH4U2XAfTCco1qxNcAZxiOAm+J/kSvwEoYU4Anl325ath0hr5BYNPDYq9Sr4LzY+reJfBZZVa/vhPYRGGf2Z/p4bZZPfM++CmCFAF4YIETR/upnApw3AqUJAQ4ShQPD/ovA3wjdANDwwxvKZbVjN45uSwI427eqnIywpsbIKOT7iAAy4Ix+p5kxMn2kzSsCCKoA+AiwJoOOAJTtF8vPSAK3NSFLhAJdPwLuTKiwHc8jhsx+1YaGBSRxJdeadQgWETBVTJNG0mVEE3TbXww9yg6lmPzL/gapawNSitpXgIdcF40783tlzmUd94EAEiVAuc8m+HWOoCH61fxAy19R/mplAElHicqrryeD3wM1fVkpm1gBkOgxHEV0gZA4VnpiFlQ5MzHNNoXjpM+9APBozKuI59BvpgAwJgE/B0KA6CWgrP7vZP4bWcBJZJYEI1FYQuzlAtw8gTFg2jXs12I+diz7gQA9tu/2GaRkOQvrfYapiZgNR6znyMn1zQCkpG7GOZfG0PenQAAZIM6cS2bcq9osnxAC0C6AgH14+Ie9EIQQwoY5FRo0HAbbKY5In3Yf2QtHEGVWiGEAVhHow1cHPHgeJnAZqAIll3GrSUdKBkdyBmQF41WTsxv3LMK6mAAe5bdwSKt6/AcCMEIAmevrbz88A7Dv1CofVQQ66w9ftAJrMdSuAHD46ucIiEGDeRDcKCwgB43KgZYa47l4biIav0QyybjfOufhWGcRiQHK7nivKQFUATcQ+Ylgnhl7+cT3sEOARgDO038dATjZ/w74AKTM9q05AScjBY8YEHRVy4/Kr4mEKZXbRnaSa/IAvR3HISk3CZkkr3AMOPeM3c2SiTtWAfyzgDyz3+xYZ/6e6XPoCMBZ9tuAboB8cALKIbT5x54H2CeVBrkGOHUFHjFQNlBJ6wnVZ+AWgogA3Fg6cVymuJ1zME/kYQdT0CwgXTUpEFdmUodtCgQQjrVf2NXtMuNn2lTu18x4rxyACgO8sp+n+ts+A+Rs+a+0Z1jFfXS/ASLLGQxjJEAYlgpn1FwdN0UazloDD6wR4aQVH4GTPP+ZCUkn/MmhxtWgsu7H7O9x5fkun/hsFQKw5B+AGsGfjfc9UrDIYjukmmjatlv4taoAFduvyccFWYJIvOSdFvIo7s8Avps0ScBaE606VoVUdFvL9byO4Inc2PvhnEcC2CfL+mf7p+P//ar1dgTsEA7AmJ1gFrZ36k36tXEjV8CshFwT3tEsqBPt2rDQNqX68GNl2kfEUQGmpcQR+VSOkQJIQf2vUMorxkxdd1R+hbl6aLzmAMhCnuEZAKPmrxW+EYAFcGtpsLM9dATgUrSiMvLQbSruYArQCaKIAJxyCjgxnGN6hGLuyy55npicFuEcJZSjAD7aPwvOK46TGfPBAej4nz3959T8B8VXYMR5aK4HIACOLD8DLZvzlp2nZiAB1G1+J9pVbD8jrdR6Awts5PymQL+Pf6j6EBCCNVHN/7iV/lgq6XkWCcn1k2NmwX2UxLLHyQBeLkPGXD7x3cccQGbdP1P9UPmt5CAAqiMLOVvD8re2XkjggHXASALUWfAzl4BzKLT0wblk+kdt0vuNc6lMbBPkhtU9tMpRgfUogGaApfmi8lsdPd9S/44ASLyPQEelZwlATQqIPU/56ctB1MtEGI61slP1NybvU4LfELBXmxMZfzZGxnGkQY8HgB9rxkVM9XkK0imqfYUYqgRYAnHBEelxXzkAJwcg4EOFz9p+5hSasBPlZuGCMgIPIkwmiN50RjWg+22zDsFxHRnwR21cEKtzjADvTUx0OzMgjsY2VbEI/iq4ps+L3JiKslfPszJ2pS2exwMBZHMA+8Re709HAGxxELTtnACgWZNIa5ew/APY9c0xngno+qlBXHxfDP7tBlaOwSZjsn+GFLZJciAMOUQYRQI4dKxHBvWVJDAz9vKJz4rXAYjidiHA/sPRtQDWE4LGOwIt1e+2KxvgEsD7DPyotNPqXwQNO84ApIkxI3IJwXryMcPjnUAAVeCd1f6MaxsJgNX9WXjgKbzlCIwyX7vn3jJhpZCUAGBjRBCKTzjukoraOlfbp04iooTk04mFic4I6QiwvQkvp+XlL44cewYkZwF0uDZ1D2Ztu76VR8ZZPv5ZDxpOwwDr+X9P4ZV9b66B2HodRmgXnHEGrc8Tgz98B4GF4wJp0Bud7B+BqDu9fcxMn6hNaT+5llL/IsnNkMNMn9eZUDYC0M/5I2jXzxqowzaw9l1bZzsCl1p9I1zQJCHkhffeVH+HJBgA9HwysZYE4TA/Z/sZziECi+clPAXOKg62y5xLFHJMjZFU2ciVnA30GRJ4jD7Lxz/zVQ5AwFVa/rt3osAv5gIQ3A+25OFuenbefV6AlBLZeBb4U/hMNSLQC8gonPyzx7Xq7gapyObwfKJx4SfIOJmzjveYQM78VlW7PktU2eseCSCI9wegW5Y/SQwakDpksPYLM1juofVTQHFxE71NKGkJQmyGDTyt9qsFGeCYo8N5ZcfJtnMnsvo9smNm2mWBUHU50bFnjvvYY67H6wiAvvLLyQPgk3xWqKCFRZSdAbdti5KBilws8YrcAd70cgxfJYtAYQPI97uPEog62DbxCmNGE7UKJjx2duwz2kVjXLl/hiAihzEz5isCCFYByhzRCj0A37H92xjE1neuwtmP/V1nQBYKWfMbQ40MCKvtD5EMO6ErgBqMGQGBnWa6z37sdPujoUYUipy4f9a+R0A/c9zl277bXgXYRQABjsDUIK0Anym7DiW0m2CCaS0ZHsggafuzYO6GSwCQNkn0CwnojDESYUwFjDjcTL9osVHZTTwigCMgvu77txCAEkCy7s9IAcHI3IIGNoJwIAV0ppmwYD+4xgn9HoCpAuIQl0aDsF9nH0J6KDWo2v5DKk86zxy/QjCZtq9Tm+hcrtq/EUCn9M4LQIYwYL+x5mpABUgK8H0jgmH47IC/U38Sl1fBnwV+GryzuYILwd+GTl5ENPmyzNONkzx2xg7PklP2ujLtHqtNdJxov3YljQBEibW1t7Y34CVW/Wngt3vv9MXxB4sPd5w5CBY+6PESTvihCUzU7JzF68uCwzrnSnKudCx1MZmJUxo/itWTP+bMeWX7PEW7s46ZGSdq00IA+uYfou4DkEG9vX2W7Weqz8gBccjcAQNPRfnNuUjcCQPB6a7BZIMqBI32SfBVjhZNtm6sxPFL48HglX5XtM2OeWa7zFhWm+VbP6NPAgrYXOX3VH8fwFT9qEqg+rvq76izRxQZfEVlQXcOJ4nDBdgZY6TZKoZ6ZpLFo4iq8JZHj1Htf1X7K8bNjDnTZiCAyPLPxvs4LnUEiaW/HaifCPyReEXEkSGfM22/nO82OaKTTyP4QMOLQo/M5NdnfXWf6viZ9pk263Vm2m0hwOoAUK3NxUCBsrvEkFH9YI1AN3+zFYHki0M6UBog8bCDYcth0SUHOgW3pwxyAPiJ9wvMjp6Z7Gzsx+pXPU62/RntGgFYyt/IQVnS9au3DwHL6vc6RIjWASDIBntvOMvsSkAPwBZuuu0HQBuNUwUFPd+LwZ+diFc4kPSxyQ/52H2rx6u0z7bV7ZZvkRyAEddr694BP3IFmXyAE/NHlt8iAv2fjXju1wJ/Cvhq4AzOzDZO58y4mXxClUxObX/4IvqzyU547xqOjnGkf7VvpX2p7bd8eCIJKIpLXAFTfq322jl0feCOee00qC2HYIHfUt408GFgb26n5v0JawVmiOVUgHuDpX6E+GwqEzseLRcnXz3OzDVV+3jtl5UAEKAIOhO40WO+mZifOA5KBEG7DuCJhUADIcDkZPPUJIQDil21/dP4KXYsNs9g46HNgYGrkz1/UucRwHrMo+c527/abwwBdgLoSIAou1bjSNU98jD/81Ct/t7/IyAuRPocAH9F9be2pEM0x+l+tTEag03u11H55Zy2yTZzURUUH2xbBVDmcEfGfOy+yzfrEMBaCrzfTAbsiBwyYcGg/oSEAOu9sKi2oe2fUP3WJQnacN4XbH84lp6VB9xJZoKn25RPPD3yaQ2PAC5zEkfHP9I/03cjAAbgAegHFv9YBMEsPyqsPgcNbNaWgb+bh4QsNLHgjWV9Q4IxZoZFIubxghmWcRWZSVrgj/xwb8Df/VYZMEY/7hVjPBAAgIIqvKHGkfJ3Y0UEsl99+L4AaQcoxLmm593Z4Gfz2pvrw76kg5giBXIiV+EwHDdsEE336/efAaiZszzzuEfHWr7508k7ARXIEMjMGZhKnnkpKGnDxhu2ESWfAX8K0Jn/ZwBmgjn3E7Y/i5uIWDITM3uszFgdYV01cPVEgvZHwXP0dK46fmXc5Zs+nZcBN8BFqn10v7H8V5NMZ7kTVYHBoicBTMkgqaqhC3AaRHiJ9m8TccJZeBM4dUw2wIHrjABVmdjkJ2nDV8eJzuus/VeelzX2RgCDwnuLghxV74CbedQ3Uy5MvBQkUn53P7odreIJUFnzvdueGKdq+b3xLwF2NqE/zRxnweiDNc6VpLD+Uo0AGnjBWg92f6dVur2yNFhA59h4nEfb5+T6fw2MCPxU9ZV8mG3UXKNzn1yjnqIRZtz9RXIpinaIplkiCgd+08D9Bc4ihuUbMQRQkzXrDBAv4UNBcllR+IDK/Ejgb5MZZnVEIJ7V9J4M9EAdEUI7ZqZhVrkzZJawFslTegPvR/gFMiSxEYBW2PX7oPIROWTe+JsIHzoygS/6fDTwjiq/Bv8s8BmJAOfR2x6BxnMW1dDBIyxrTkbnt/VzGqX6PwIgjhxCX0MGXEeO9xh912t4IIAo5nfAj2o0kAaqeDLb341hHNcDf/QEoAvsI8lCA4nW5D/iAE5558ABxR/O/SDCD3a/DCuZ83q/E8HyDZ/mVAF2pCEoKcizdj5DJEIaVfAnlgJXwT/lApxS3wzoM2DLTNSK8mfHE+UvtS/A9apxM6fwlMeW81vJ5WrnsREAA/W2LQHsVMyfGKez/gr8Q1ignEXm8V8PzFXXYIHJUmY2mWbIwPq/EvWEzkzeTJuQNMgg2XEzIJwJb6rjHgp7zjrYI43D3MryX8EBWHZ+VvUtEmGAbseAGUSPWwT/2apvglntOAv0bRwDWRnAXdYmM/BkEvKpgZm8tEeC7nWH6QhgRvVdkColt9rKcT1ioC4gsP0V8LttjUnMwFkBvjXJhu2EFGcBEk3saL8cN5uHmD3PaMpnzzMax9v/GMc4cn5n9N0IANXXBWnmPQCi0Enwb8AO2mbAXwFw1fJXiKQBxLg7FYJAR8aGiyboZfvVwNFxMhN1ZoyZPplzie5hZYzXve3y9RICEBAOZJAEdQnQxpiuG3DWBWA//RnJhu5TdyskFTIDKwBPtU2qfwQGb3/Ut/utEo0TTUxczPSd6ZMF5pVjZ88hanfkHDcCiAC7HSAqFQJthi4icAlU8YMyImPtAcAOmLBtCHzCHikwR6GEvtMnVxQY6ZFD2vMt8TDTjFN5yj5Xgisa29t/BNSV4y5f/6nj04ADABNZfI8kqJor5XcVPwF+D7RybimSgF/PHDNQ5YhAPCC2vkl3EYF6VvlpP7VxZpJW+lTasntbAYLVduYcKse9evzoXJav+9RX6wBkMnUKfgH4U+VFDcTkcmANCAR/SBIF8M+CPOUUCDnijZwB9UyfDlSJmZpo0s3HTPtMm7McRMkNRcgK9s9e18HDDt03AugArx7qMfftQ0XKP+MmvD4U4HguhDi8PpV9mfUGTJFToJdrMGaGNWHO2u46iYCQjgAwC4RsuyxRZoA0c8xo3CvGjI7p3dvla4kD2Dqom06JIOsOEs8A4A9jOZCzwV9yBKpxBtSZNt01JY5h3cwzicA7p84VZGZech1AFhjZdjPneYTIop+iet7ReGed60YAFuBc9T8R/IPiF2N+Rh6RWtM+xEmIw/EmlEckacA6KnsGuL0JaO5LJv2ykztqF+2fBXV23LNApcc5cnyPCM4Yd/kv6ACyoM62q7wSTD+BaDiQlAuYLBNSIBeAGRGBSQbkTlZAf0bb4dySbqQ62TOTNtPGDVkIarJjnkkCR45Z/V1nHMPa5xUBwEQ/TfnhF3DHJC8TYa7gKPhLqg8Hi4Bd3W9ZbDZhzgB3ZYx2bs7szUzsqM3R/Y/pBqJzPZM0HgP4eD0bAaTi/WxeoBDvD6SQIAzG/K1bslJgEUF3o48+XUhi32EiFev8WYKYAjzOPBCDSFkicHj7o75Zlc+MQy4vurS2vzp+9ryvtveZ81i+5lPGMiBT3zRJ7J3Tig9UHvVxHYC6SxmQm22csVwC2q8lcgTbGGRWHQF4tq83KbYxjNkegWAW6NG4mUk84wYyx50Zt3K+FgFUzu2o+9gIIALeVeBHuxmdQxb8VeAP48IAEZCn9zvHsCZQFuDZdvQ4CeWPJudTE0F0fjNOoDLmEQKoHmfmWjRhLF8dOQA1KVygFpKDrwP4B7IwgDkNdOYIDJBlgXt2O7wPenJEE3IG7DN9qhM9Ou8rx5slgMo5zzoT5hY2AjBBfTL48cfZhs6+OhzOvANtArBpR5AA5mEiIHc5GjPrCLLEcIXyW5O3uj07sTNgybTJgjU7Vna8KtEebe/1X/6z5QAmwT+AnL1g9CD4hTzcsMAiDba9mPCLQEv3G2RlTfoMoDNtvEnZ+quBZlR6Buwzx7lCvTMAz7SZIYDsuFlyZCrvnddGAIMDCMDfgbxCFIkKgUcg2q6m1X3/VWj7yTUD7Ec1iSHhLrJEcAT0dLIVKxHRRKwSQQSAq/dH15PdX2030z76LRj4oz7LV2kHQJRqIAgB1GOD31DRChF0bR3lM8GcKO91fYvuwmJr73y8yeQSRlL5zwL1rOJHk/jo/oxyR8e4GtDZ41fPoyeAQhKvVBk4Q/kD8FdIYLvhCTLxQozIAWzDBwCLQB3tj87BnQwTyl8hgkrbzKSNAHD1/gxJZNtkrhfVPLo2rfyV9hsBlMH8RMpfBjn8MpbyZ8asEEEbT/1GFZWOgB/tD13EBcpfBfwVbiCa+FfvrwA7OpfKWLNksZ7D8p8+lFwI9AS2H1U0A1Rp47YlwLTaTwF/7xSB9Oj+I+pfeX15SCYGyWYm5etGAhlQPmabqxwFjrsRgAaO+f0k5ccTcI+dBGuaHJLjReByCSNQ16PAj/qHgIUBKqrN2h7tH6ncFQQRgSoCeLQ/Gj+65gxxasufPSZrt/zHrAN4jcCfBjyG4RPPCZQdgAOuCLgeqUSEFIIeZt0VQD46pjeBryCBCMRX788CNjqPCplYx9wIIHQAB8GfVvwT3gNAgTQBflflme0l7qJCIDMgzwCvtQmcSZpECi82rTiECBTVsWbHi/pl9kdtzgT20bGW/xA5gNcc/K4bOAh8D8DdD3/kPygplhVLoL9Q+TPnESlUFdTV9rPOIgLw0f1HQRv9rjpE8I63EYDpAF5D8LuAP2j5o7GpSkMn/UNXvlfaZtxCa3Oh8lcAWWk7C9yzjpEFmAes2X3ZY2dIKNNm+feWA3hC8FeASNuS9QxZNbeOTfur38i6edkxI2BnVFc7kyPWPnO8yvhntI0m9WOSwBGQRy7g6P4skWwEMDiASfDjzTFdxX5m3f4CYCNyyCzwicZIkQUBv6fiFYWvtDVB9cjKnyWLqrqfBehZsM4CcbZfFrjR+BFRynGWf6cdwCT4GahSJBCAPwJrtx++6GOnQK3icVO5T3p+oAL0qG13fYScvImVAW/p+CoIzYxfPb8qkUSAuIIgZseMzjWzP9NmPb+NABpYXgPwlwAPE02vZjwT8BHJsMn7ZG6AzLoMAM9qU7H5Z6j7GWNkVLd6nCwAFVe2r5HCn7V/+crVAVSeAUALbyjhrPJ7LsIC9NaHKN4lDsBQVtMpOI7CIyg2ebxjzKr/DOgzfSok8NhtI2CeCfQjID3SN7pG3L985cvEOgAE/ZFXfSceCio7AMO1uIShriflFhySqQL2DMKgx0yofwbAnnupALYCpsx5PUaY8H4ILSoAjxzG8hUvi88C7Ee3VB5PjrZJuA02BgVp4EBSwM7E/cn1BBVV90A2tQ86RQCOCCuz/ygRZAF/lETOBLSnypXz9Igssy8igIp7WP7tTgAhcCfVuyOBE8DfLq4A/shVuERhAGsKpBeFBNH/gmRNqogoov2PRQJHj/MYJDBDDkeAPHs8fcxGAJaiVwHMwLZtS4Df7Kst+8HKgQX44fj7hizYz24XKbH8rmjzItAe3R+dU9WmZ53AB5UEZoE8228ggH+TdQAFADMgpQhGAZ0SAlHkSOGj/VZ4MRNCZPvMtuv6JQgqA9gqKWTBmAV3tl32uGcpvgWy6vZZpT8L5CgQlAA85a2qtwZ6RflDB5AEfwT4aL+21Fb7LIhn+kfAzfzHIhVgR22j8zmq/BVQZc61SgKV41fH9n6bWXI4q9/y5SoJiAMfBb9Xm7ccwXB8cQVE7QayIW8groI0s5KwOmYEHm9Cm/suUP+MEp/V5oiaV8B6VdsZEphR9Jk+FXLYCMAE0oTtb2OpCZoBq+kAjLFMsgDP4x33TOsfugohMnJuEUEM56lmRaSIV+/PnP8RwGfHrxzjyrZnksPlBPBlRhlwxrpnwW8CnWXJC0RymBCS5b4zwV5Wf+hwBNhH+lqW9rHdwVF1P9r/dQZ6ljiWlQC0SjIbPLRRilYFv0cC7Yc9WOrLAFWf94y9n+ljnZurdie8YnzquMS9PAUJHAVshqCs63oMsFeuzzvPaB8eZ/lS7QCU4jJVNckgUGurH1XuiVJfilSYFTdUtUIgR0nA67/tU7OjouBll2GEKVnQZ4EWXUPFps8es3KM15EEskoPt3T7KP02AojUO0UCk+CnoCWAzII7Au2w3yG8o6COzoUBioKCnKPrFBjJqRlQcQLVY2WJIjNuBaCvIwlUVX0G0NVjdATwMXEAAYBdEnhC8Ecgc/efGPNH5xFNdhOQRdt/ptpHCh3tj675CFE8JTFUjv2UriFz7GUlgOp/DNKRwUHwdxPfUeMjDoCCq5BfOOoEZvpr2x+BLavolXEyAM6obnTMzHEqoMuc09HxKv2rbTPAVYZO/ydUbXfkKP4/BnecprBuissAAAAASUVORK5CYII=",t}();e.TextureTools=t}(s||(s={})),function(e){var t=function(){function t(){this._mode=t.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(t.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(e){this._radiusScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positionScale",{get:function(){return this._positionScale},set:function(e){this._positionScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framingTime",{get:function(){return this._framingTime},set:function(e){this._framingTime=e},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.attach=function(i){var r=this;this._attachedCamera=i;var n=this._attachedCamera.getScene();t.EasingFunction.setEasingMode(t.EasingMode),this._onPrePointerObservableObserver=n.onPrePointerObservable.add((function(t){t.type!==e.PointerEventTypes.POINTERDOWN?t.type===e.PointerEventTypes.POINTERUP&&(r._isPointerDown=!1):r._isPointerDown=!0})),this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add((function(e){e&&r.zoomOnMesh(e)})),this._onAfterCheckInputsObserver=i.onAfterCheckInputsObservable.add((function(){r._applyUserInteraction(),r._maintainCameraAboveGround()}))},t.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},t.prototype.zoomOnMesh=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null),e.computeWorldMatrix(!0);var r=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,t,i)},t.prototype.zoomOnMeshHierarchy=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null),e.computeWorldMatrix(!0);var r=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,t,i)},t.prototype.zoomOnMeshesHierarchy=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=0;o<t.length;o++){var s=t[__uv.$wrap((o))].getHierarchyBoundingVectors(!0);e.Tools.CheckExtends(s.min,n,a),e.Tools.CheckExtends(s.max,n,a)}this.zoomOnBoundingInfo(n,a,i,r)},t.prototype.zoomOnBoundingInfo=function(i,r,n,a){var o,s=this;if(void 0===n&&(n=!1),void 0===a&&(a=null),this._attachedCamera){var l=i.y,c=l+(r.y-l)*this._positionScale,u=r.subtract(i).scale(.5);if(n)o=new e.Vector3(0,c,0);else{var h=i.add(u);o=new e.Vector3(h.x,c,h.z)}this._vectorTransition||(this._vectorTransition=e.Animation.CreateAnimation("target",e.Animation.ANIMATIONTYPE_VECTOR3,60,t.EasingFunction)),this._betaIsAnimating=!0;var d=e.Animation.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);d&&this._animatables.push(d);var p=0;if(this._mode===t.FitFrustumSidesMode){var m=this._calculateLowerRadiusFromModelBoundingSphere(i,r);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=u.length()+this._attachedCamera.minZ),p=m}else this._mode===t.IgnoreBoundsSizeMode&&(p=this._calculateLowerRadiusFromModelBoundingSphere(i,r),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var _=r.subtract(i).length();this._attachedCamera.panningSensibility=5e3/_,this._attachedCamera.wheelPrecision=100/p}this._radiusTransition||(this._radiusTransition=e.Animation.CreateAnimation("radius",e.Animation.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),(d=e.Animation.TransitionTo("radius",p,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(function(){s.stopAllAnimations(),a&&a(),s._attachedCamera&&s._attachedCamera.useInputToRestoreState&&s._attachedCamera.storeState()})))&&this._animatables.push(d)}},t.prototype._calculateLowerRadiusFromModelBoundingSphere=function(e,i){var r=i.subtract(e).length(),n=this._getFrustumSlope(),a=.5*r*this._radiusScale,o=a*Math.sqrt(1+1/(n.x*n.x)),s=a*Math.sqrt(1+1/(n.y*n.y)),l=Math.max(o,s),c=this._attachedCamera;return c?(c.lowerRadiusLimit&&this._mode===t.IgnoreBoundsSizeMode&&(l=l<c.lowerRadiusLimit?c.lowerRadiusLimit:l),c.upperRadiusLimit&&(l=l>c.upperRadiusLimit?c.upperRadiusLimit:l),l):0},t.prototype._maintainCameraAboveGround=function(){var i=this;if(!(this._elevationReturnTime<0)){var r=e.Tools.Now-this._lastInteractionTime,n=.5*Math.PI-this._defaultElevation,a=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>a&&r>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=e.Animation.CreateAnimation("beta",e.Animation.ANIMATIONTYPE_FLOAT,60,t.EasingFunction));var o=e.Animation.TransitionTo("beta",n,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(function(){i._clearAnimationLocks(),i.stopAllAnimations()}));o&&this._animatables.push(o)}}},t.prototype._getFrustumSlope=function(){var t=this._attachedCamera;if(!t)return e.Vector2.Zero();var i=t.getScene().getEngine().getAspectRatio(t),r=Math.tan(t.fov/2),n=r*i;return new e.Vector2(n,r)},t.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},t.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=e.Tools.Now,this.stopAllAnimations(),this._clearAnimationLocks())},t.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[__uv.$wrap((0))]&&(this._animatables[__uv.$wrap((0))].onAnimationEnd=null,this._animatables[__uv.$wrap((0))].stop()),this._animatables.shift()},Object.defineProperty(t.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),t.EasingFunction=new e.ExponentialEase,t.EasingMode=e.EasingFunction.EASINGMODE_EASEINOUT,t.IgnoreBoundsSizeMode=0,t.FitFrustumSidesMode=1,t}();e.FramingBehavior=t}(s||(s={})),function(e){var t=function(){function t(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(t.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(e){var t=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var i=this._attachedCamera;i&&(e?this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add((function(e){if(e){e.computeWorldMatrix(!0);var i=e.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=.05*i,t.upperRadiusTransitionRange=.05*i}})):this._onMeshTargetChangedObserver&&i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.attach=function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add((function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))}))},t.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},t.prototype._isRadiusAtLimit=function(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)},t.prototype._applyBoundRadiusAnimation=function(i){var r=this;if(this._attachedCamera){this._radiusBounceTransition||(t.EasingFunction.setEasingMode(t.EasingMode),this._radiusBounceTransition=e.Animation.CreateAnimation("radius",e.Animation.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var n=e.Animation.TransitionTo("radius",this._attachedCamera.radius+i,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(function(){return r._clearAnimationLocks()}));n&&this._animatables.push(n)}},t.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},t.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[__uv.$wrap((0))].onAnimationEnd=null,this._animatables[__uv.$wrap((0))].stop(),this._animatables.shift()},t.EasingFunction=new e.BackEase(.3),t.EasingMode=e.EasingFunction.EASINGMODE_EASEOUT,t}();e.BouncingBehavior=t}(s||(s={})),function(e){var t=function(){function t(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(t.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.attach=function(t){var i=this;this._attachedCamera=t;var r=this._attachedCamera.getScene();this._onPrePointerObservableObserver=r.onPrePointerObservable.add((function(t){t.type!==e.PointerEventTypes.POINTERDOWN?t.type===e.PointerEventTypes.POINTERUP&&(i._isPointerDown=!1):i._isPointerDown=!0})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((function(){var t=e.Tools.Now,r=0;null!=i._lastFrameTime&&(r=t-i._lastFrameTime),i._lastFrameTime=t,i._applyUserInteraction();var n=t-i._lastInteractionTime-i._idleRotationWaitTime,a=Math.max(Math.min(n/i._idleRotationSpinupTime,1),0);i._cameraRotationSpeed=i._idleRotationSpeed*a,i._attachedCamera&&(i._attachedCamera.alpha-=i._cameraRotationSpeed*(r/1e3))}))},t.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},t.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},t.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()},t.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=e.Tools.Now)},t.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},t}();e.AutoRotationBehavior=t}(s||(s={})),function(e){var t=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4};e.NullEngineOptions=t;var i=function(i){function r(r){void 0===r&&(r=new t);var n=i.call(this,null)||this;return void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),n._options=r,n._caps=new e.EngineCapabilities,n._caps.maxTexturesImageUnits=16,n._caps.maxVertexTextureImageUnits=16,n._caps.maxTextureSize=512,n._caps.maxCubemapTextureSize=512,n._caps.maxRenderTextureSize=512,n._caps.maxVertexAttribs=16,n._caps.maxVaryingVectors=16,n._caps.maxFragmentUniformVectors=16,n._caps.maxVertexUniformVectors=16,n._caps.standardDerivatives=!1,n._caps.astc=null,n._caps.s3tc=null,n._caps.pvrtc=null,n._caps.etc1=null,n._caps.etc2=null,n._caps.textureAnisotropicFilterExtension=null,n._caps.maxAnisotropy=0,n._caps.uintIndices=!1,n._caps.fragmentDepthSupported=!1,n._caps.highPrecisionShaderSupported=!0,n._caps.colorBufferFloat=!1,n._caps.textureFloat=!1,n._caps.textureFloatLinearFiltering=!1,n._caps.textureFloatRender=!1,n._caps.textureHalfFloat=!1,n._caps.textureHalfFloatLinearFiltering=!1,n._caps.textureHalfFloatRender=!1,n._caps.textureLOD=!1,n._caps.drawBuffersExtension=!1,n._caps.depthTextureExtension=!1,n._caps.vertexArrayObject=!1,n._caps.instancedArrays=!1,e.Tools.Log("Babylon.js null engine (v"+e.Engine.Version+") launched"),"undefined"==typeof URL&&(URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(Blob=function(){}),n}return a(r,i),r.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},r.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},r.prototype.getHardwareScalingLevel=function(){return 1},r.prototype.createVertexBuffer=function(e){return{capacity:0,references:1,is32Bits:!1}},r.prototype.createIndexBuffer=function(e){return{capacity:0,references:1,is32Bits:!1}},r.prototype.clear=function(e,t,i,r){void 0===r&&(r=!1)},r.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},r.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},r.prototype.setViewport=function(e,t,i){this._cachedViewport=e},r.prototype.createShaderProgram=function(e,t,i,r){return{transformFeedback:null,__SPECTOR_rebuildProgram:null}},r.prototype.getUniforms=function(e,t){return[]},r.prototype.getAttributes=function(e,t){return[]},r.prototype.bindSamplers=function(e){this._currentEffect=null},r.prototype.enableEffect=function(e){this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e)},r.prototype.setState=function(e,t,i,r){void 0===t&&(t=0),void 0===r&&(r=!1)},r.prototype.setIntArray=function(e,t){},r.prototype.setIntArray2=function(e,t){},r.prototype.setIntArray3=function(e,t){},r.prototype.setIntArray4=function(e,t){},r.prototype.setFloatArray=function(e,t){},r.prototype.setFloatArray2=function(e,t){},r.prototype.setFloatArray3=function(e,t){},r.prototype.setFloatArray4=function(e,t){},r.prototype.setArray=function(e,t){},r.prototype.setArray2=function(e,t){},r.prototype.setArray3=function(e,t){},r.prototype.setArray4=function(e,t){},r.prototype.setMatrices=function(e,t){},r.prototype.setMatrix=function(e,t){},r.prototype.setMatrix3x3=function(e,t){},r.prototype.setMatrix2x2=function(e,t){},r.prototype.setFloat=function(e,t){},r.prototype.setFloat2=function(e,t,i){},r.prototype.setFloat3=function(e,t,i,r){},r.prototype.setBool=function(e,t){},r.prototype.setFloat4=function(e,t,i,r,n){},r.prototype.setColor3=function(e,t){},r.prototype.setColor4=function(e,t,i){},r.prototype.setAlphaMode=function(t,i){void 0===i&&(i=!1),this._alphaMode!==t&&(this._alphaState.alphaBlend=t!==e.Engine.ALPHA_DISABLE,i||this.setDepthWrite(t===e.Engine.ALPHA_DISABLE),this._alphaMode=t)},r.prototype.bindBuffers=function(e,t,i){},r.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},r.prototype.draw=function(e,t,i,r){},r.prototype.drawElementsType=function(e,t,i,r){},r.prototype.drawArraysType=function(e,t,i,r){},r.prototype._createTexture=function(){return{}},r.prototype._releaseTexture=function(e){},r.prototype.createTexture=function(t,i,r,n,a,o,s,l,c,u){void 0===a&&(a=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null);var h=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_URL),d=String(t);return h.url=d,h.generateMipMaps=!i,h.samplingMode=a,h.invertY=r,h.baseWidth=this._options.textureSize,h.baseHeight=this._options.textureSize,h.width=this._options.textureSize,h.height=this._options.textureSize,u&&(h.format=u),h.isReady=!0,o&&o(),this._internalTexturesCache.push(h),h},r.prototype.createRenderTargetTexture=function(t,i){var r=new e.RenderTargetCreationOptions;void 0!==i&&"object"==typeof i?(r.generateMipMaps=i.generateMipMaps,r.generateDepthBuffer=void 0===i.generateDepthBuffer||i.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&i.generateStencilBuffer,r.type=void 0===i.type?e.Engine.TEXTURETYPE_UNSIGNED_INT:i.type,r.samplingMode=void 0===i.samplingMode?e.Texture.TRILINEAR_SAMPLINGMODE:i.samplingMode):(r.generateMipMaps=i,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=e.Engine.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=e.Texture.TRILINEAR_SAMPLINGMODE);var n=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET),a=t.width||t,o=t.height||t;return n._depthStencilBuffer={},n._framebuffer={},n.baseWidth=a,n.baseHeight=o,n.width=a,n.height=o,n.isReady=!0,n.samples=1,n.generateMipMaps=!!r.generateMipMaps,n.samplingMode=r.samplingMode,n.type=r.type,n._generateDepthBuffer=r.generateDepthBuffer,n._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(n),n},r.prototype.updateTextureSamplingMode=function(e,t){t.samplingMode=e},r.prototype.bindFramebuffer=function(e,t,i,r,n){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._currentFramebuffer=e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer,this._cachedViewport&&!n&&this.setViewport(this._cachedViewport,i,r)},r.prototype.unBindFramebuffer=function(e,t,i){void 0===t&&(t=!1),this._currentRenderTarget=null,i&&(e._MSAAFramebuffer&&(this._currentFramebuffer=e._framebuffer),i()),this._currentFramebuffer=null},r.prototype.createDynamicVertexBuffer=function(e){return{capacity:1,references:1,is32Bits:!1}},r.prototype.updateDynamicTexture=function(e,t,i,r,n){void 0===r&&(r=!1)},r.prototype.getError=function(){return 0},r.prototype._getUnpackAlignement=function(){return 1},r.prototype._unpackFlipY=function(e){},r.prototype.updateDynamicIndexBuffer=function(e,t,i){void 0===i&&(i=0)},r.prototype.updateDynamicVertexBuffer=function(e,t,i,r){},r.prototype._bindTextureDirectly=function(e,t){return this._boundTexturesCache[__uv.$wrap((this._activeChannel))]!==t&&(this._boundTexturesCache[__uv.$wrap((this._activeChannel))]=t,!0)},r.prototype._bindTexture=function(e,t){e<0||this._bindTextureDirectly(0,t)},r.prototype._releaseBuffer=function(e){return e.references--,0===e.references},r.prototype.releaseEffects=function(){},r.prototype.displayLoadingUI=function(){},r.prototype.hideLoadingUI=function(){},r.prototype._uploadCompressedDataToTextureDirectly=function(e,t,i,r,n,a,o){void 0===a&&(a=0),void 0===o&&(o=0)},r.prototype._uploadDataToTextureDirectly=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0)},r.prototype._uploadArrayBufferViewToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0)},r.prototype._uploadImageToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0)},r}(e.Engine);e.NullEngine=i}(s||(s={})),function(e){var t=function(){function t(t){this.engine=t,this._captureGPUFrameTime=!1,this._gpuFrameTime=new e.PerfCounter,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new e.PerfCounter,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(t.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(e){var t=this;e!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=e,e?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add((function(){t._gpuFrameTimeToken||(t._gpuFrameTimeToken=t.engine.startTimeQuery())})),this._onEndFrameObserver=this.engine.onEndFrameObservable.add((function(){if(t._gpuFrameTimeToken){var e=t.engine.endTimeQuery(t._gpuFrameTimeToken);e>-1&&(t._gpuFrameTimeToken=null,t._gpuFrameTime.fetchNewFrame(),t._gpuFrameTime.addCount(e,!0))}}))):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(e){var t=this;e!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=e,e?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add((function(){t._shaderCompilationTime.fetchNewFrame(),t._shaderCompilationTime.beginMonitoring()})),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add((function(){t._shaderCompilationTime.endMonitoring()}))):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},t}();e.EngineInstrumentation=t}(s||(s={})),function(e){var t=function(){function t(t){var i=this;this.scene=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new e.PerfCounter,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new e.PerfCounter,this._captureFrameTime=!1,this._frameTime=new e.PerfCounter,this._captureRenderTime=!1,this._renderTime=new e.PerfCounter,this._captureInterFrameTime=!1,this._interFrameTime=new e.PerfCounter,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new e.PerfCounter,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new e.PerfCounter,this._capturePhysicsTime=!1,this._physicsTime=new e.PerfCounter,this._captureAnimationsTime=!1,this._animationsTime=new e.PerfCounter,this._captureCameraRenderTime=!1,this._cameraRenderTime=new e.PerfCounter,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add((function(){i._captureActiveMeshesEvaluationTime&&i._activeMeshesEvaluationTime.fetchNewFrame(),i._captureRenderTargetsRenderTime&&i._renderTargetsRenderTime.fetchNewFrame(),i._captureFrameTime&&(e.Tools.StartPerformanceCounter("Scene rendering"),i._frameTime.beginMonitoring()),i._captureInterFrameTime&&i._interFrameTime.endMonitoring(),i._captureParticlesRenderTime&&i._particlesRenderTime.fetchNewFrame(),i._captureSpritesRenderTime&&i._spritesRenderTime.fetchNewFrame(),i._captureAnimationsTime&&i._animationsTime.beginMonitoring(),i.scene.getEngine()._drawCalls.fetchNewFrame(),i.scene.getEngine()._textureCollisions.fetchNewFrame()})),this._onAfterRenderObserver=t.onAfterRenderObservable.add((function(){i._captureFrameTime&&(e.Tools.EndPerformanceCounter("Scene rendering"),i._frameTime.endMonitoring()),i._captureRenderTime&&i._renderTime.endMonitoring(!1),i._captureInterFrameTime&&i._interFrameTime.beginMonitoring()}))}return Object.defineProperty(t.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(t){var i=this;t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add((function(){e.Tools.StartPerformanceCounter("Active meshes evaluation"),i._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add((function(){e.Tools.EndPerformanceCounter("Active meshes evaluation"),i._activeMeshesEvaluationTime.endMonitoring()}))):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(t){var i=this;t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add((function(){e.Tools.StartPerformanceCounter("Render targets rendering"),i._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add((function(){e.Tools.EndPerformanceCounter("Render targets rendering"),i._renderTargetsRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(t){var i=this;t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add((function(){e.Tools.StartPerformanceCounter("Particles"),i._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add((function(){e.Tools.EndPerformanceCounter("Particles"),i._particlesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(t){var i=this;t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,this.scene.spriteManagers&&(t?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add((function(){e.Tools.StartPerformanceCounter("Sprites"),i._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add((function(){e.Tools.EndPerformanceCounter("Sprites"),i._spritesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(t){var i=this;t!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add((function(){e.Tools.StartPerformanceCounter("Physics"),i._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add((function(){e.Tools.EndPerformanceCounter("Physics"),i._physicsTime.endMonitoring()}))):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(e){var t=this;e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add((function(){t._animationsTime.endMonitoring()})):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(e){this._captureFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(e){this._captureInterFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(t){var i=this;t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add((function(){i._renderTime.beginMonitoring(),e.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add((function(){i._renderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter("Main render")}))):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(t){var i=this;t!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=t,t?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add((function(t){i._cameraRenderTime.beginMonitoring(),e.Tools.StartPerformanceCounter("Rendering camera "+t.name)})),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add((function(t){i._cameraRenderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter("Rendering camera "+t.name)}))):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureCollisionsCounter",{get:function(){return this.scene.getEngine()._textureCollisions},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},t}();e.SceneInstrumentation=t}(s||(s={})),function(e){var t=function(){this._timeElapsedQueryEnded=!1};e._TimeToken=t}(s||(s={})),function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.GAMMADIFFUSE=!1,t.DIFFUSEHASALPHA=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONBLUR=!1,t.REFLECTIONFRESNEL=!1,t.REFLECTIONFALLOFF=!1,t.TEXTURELODSUPPORT=!1,t.PREMULTIPLYALPHA=!1,t.USERGBCOLOR=!1,t.USEHIGHLIGHTANDSHADOWCOLORS=!1,t.NOISE=!1,t.REFLECTIONBGR=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.EQUIRECTANGULAR_RELFECTION_FOV=!1,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.SHADOWFLOAT=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.primaryColor=e.Color3.White(),n._primaryColorShadowLevel=0,n._primaryColorHighlightLevel=0,n.reflectionTexture=null,n.reflectionBlur=0,n.diffuseTexture=null,n._shadowLights=null,n.shadowLights=null,n.shadowLevel=0,n.sceneCenter=e.Vector3.Zero(),n.opacityFresnel=!0,n.reflectionFresnel=!1,n.reflectionFalloffDistance=0,n.reflectionAmount=1,n.reflectionReflectance0=.05,n.reflectionReflectance90=.5,n.useRGBColor=!0,n.enableNoise=!1,n._fovMultiplier=1,n.useEquirectangularFOV=!1,n._maxSimultaneousLights=4,n.maxSimultaneousLights=4,n._imageProcessingObserver=null,n.switchToBGR=!1,n._renderTargets=new e.SmartArray(16),n._reflectionControls=e.Vector4.Zero(),n._white=e.Color3.White(),n._primaryShadowColor=e.Color3.Black(),n._primaryHighlightColor=e.Color3.Black(),n._attachImageProcessingConfiguration(null),n.getRenderTargetTextures=function(){return n._renderTargets.reset(),n._diffuseTexture&&n._diffuseTexture.isRenderTarget&&n._renderTargets.push(n._diffuseTexture),n._reflectionTexture&&n._reflectionTexture.isRenderTarget&&n._renderTargets.push(n._reflectionTexture),n._renderTargets},n}return a(r,i),Object.defineProperty(r.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reflectionStandardFresnelWeight",{set:function(e){var t=e;t<.5?(t*=2,this.reflectionReflectance0=r.StandardReflectance0*t,this.reflectionReflectance90=r.StandardReflectance90*t):(t=2*t-1,this.reflectionReflectance0=r.StandardReflectance0+(1-r.StandardReflectance0)*t,this.reflectionReflectance90=r.StandardReflectance90+(1-r.StandardReflectance90)*t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))},enumerable:!0,configurable:!0}),r.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(e){t._computePrimaryColorFromPerceptualColor(),t._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(r.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),r.prototype.needAlphaTesting=function(){return!0},r.prototype.needAlphaBlending=function(){return this.alpha<0||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},r.prototype.isReadyForSubMesh=function(i,r,n){var a=this;if(void 0===n&&(n=!1),r.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;r._materialDefines||(r._materialDefines=new t);var o=this.getScene(),s=r._materialDefines;if(!this.checkReadyOnEveryCall&&r.effect&&s._renderId===o.getRenderId())return!0;var l=o.getEngine();if(e.MaterialHelper.PrepareDefinesForLights(o,i,s,!1,this._maxSimultaneousLights),s._needNormals=!0,s._areTexturesDirty){if(s._needUVs=!1,o.texturesEnabled){if(o.getEngine().getCaps().textureLOD&&(s.TEXTURELODSUPPORT=!0),this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,s,"DIFFUSE"),s.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,s.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,s.OPACITYFRESNEL=this._opacityFresnel}else s.DIFFUSE=!1,s.DIFFUSEHASALPHA=!1,s.GAMMADIFFUSE=!1,s.OPACITYFRESNEL=!1;var c=this._reflectionTexture;if(c&&e.StandardMaterial.ReflectionTextureEnabled){if(!c.isReadyOrNotBlocking())return!1;switch(s.REFLECTION=!0,s.GAMMAREFLECTION=c.gammaSpace,s.RGBDREFLECTION=c.isRGBD,s.REFLECTIONBLUR=this._reflectionBlur>0,s.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!c.invertZ:c.invertZ,s.LODINREFLECTIONALPHA=c.lodLevelInAlpha,s.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,s.REFLECTIONBGR=this.switchToBGR,c.coordinatesMode===e.Texture.INVCUBIC_MODE&&(s.INVERTCUBICMAP=!0),s.REFLECTIONMAP_3D=c.isCube,c.coordinatesMode){case e.Texture.EXPLICIT_MODE:s.REFLECTIONMAP_EXPLICIT=!0;break;case e.Texture.PLANAR_MODE:s.REFLECTIONMAP_PLANAR=!0;break;case e.Texture.PROJECTION_MODE:s.REFLECTIONMAP_PROJECTION=!0;break;case e.Texture.SKYBOX_MODE:s.REFLECTIONMAP_SKYBOX=!0,s.REFLECTIONMAP_SKYBOX_TRANSFORMED=!c.getReflectionTextureMatrix().isIdentity();break;case e.Texture.SPHERICAL_MODE:s.REFLECTIONMAP_SPHERICAL=!0;break;case e.Texture.EQUIRECTANGULAR_MODE:s.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MODE:s.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:s.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:default:s.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(s.REFLECTIONFRESNEL=!0,s.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(s.REFLECTIONFRESNEL=!1,s.REFLECTIONFALLOFF=!1)}else s.REFLECTION=!1,s.REFLECTIONFRESNEL=!1,s.REFLECTIONFALLOFF=!1,s.REFLECTIONBLUR=!1,s.REFLECTIONMAP_3D=!1,s.REFLECTIONMAP_SPHERICAL=!1,s.REFLECTIONMAP_PLANAR=!1,s.REFLECTIONMAP_CUBIC=!1,s.REFLECTIONMAP_PROJECTION=!1,s.REFLECTIONMAP_SKYBOX=!1,s.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,s.REFLECTIONMAP_EXPLICIT=!1,s.REFLECTIONMAP_EQUIRECTANGULAR=!1,s.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,s.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,s.INVERTCUBICMAP=!1,s.REFLECTIONMAP_OPPOSITEZ=!1,s.LODINREFLECTIONALPHA=!1,s.GAMMAREFLECTION=!1,s.RGBDREFLECTION=!1}s.PREMULTIPLYALPHA=this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,s.USERGBCOLOR=this._useRGBColor,s.NOISE=this._enableNoise}if(s._areLightsDirty&&(s.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel)),s._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(s)}if(e.MaterialHelper.PrepareDefinesForMisc(i,o,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(i),s),e.MaterialHelper.PrepareDefinesForFrameBoundValues(o,l,s,n),e.MaterialHelper.PrepareDefinesForAttributes(i,s,!1,!0,!1)&&i&&(o.getEngine().getCaps().standardDerivatives||i.isVerticesDataPresent(e.VertexBuffer.NormalKind)||(i.createNormals(!0),e.Tools.Warn("BackgroundMaterial: Normals have been created for the mesh: "+i.name))),s.isDirty){s.markAsProcessed(),o.resetCachedMaterial();var u=new e.EffectFallbacks;s.FOG&&u.addFallback(0,"FOG"),s.POINTSIZE&&u.addFallback(1,"POINTSIZE"),e.MaterialHelper.HandleFallbacksForShadows(s,u,this._maxSimultaneousLights),s.NUM_BONE_INFLUENCERS>0&&u.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];s.NORMAL&&h.push(e.VertexBuffer.NormalKind),s.UV1&&h.push(e.VertexBuffer.UVKind),s.UV2&&h.push(e.VertexBuffer.UV2Kind),e.MaterialHelper.PrepareAttributesForBones(h,i,s,u),e.MaterialHelper.PrepareAttributesForInstances(h,s);var d=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],p=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],m=["Material","Scene"];e.ImageProcessingConfiguration&&(e.ImageProcessingConfiguration.PrepareUniforms(d,s),e.ImageProcessingConfiguration.PrepareSamplers(p,s)),e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:m,samplers:p,defines:s,maxSimultaneousLights:this._maxSimultaneousLights});var _=s.toString();r.setEffect(o.getEngine().createEffect("background",{attributes:h,uniformsNames:d,uniformBuffersNames:m,samplers:p,defines:_,fallbacks:u,onCompiled:function(e){a.onCompiled&&a.onCompiled(e),a.bindSceneUniformBuffer(e,o.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},l),s),this.buildUniformLayout()}return!(!r.effect||!r.effect.isReady())&&(s._renderId=o.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},r.prototype._computePrimaryColors=function(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},r.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},r.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),i.prototype.unbind.call(this)},r.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),a=r._materialDefines;if(a){var o=r.effect;if(o){this._activeEffect=o,this.bindOnlyWorldMatrix(t),e.MaterialHelper.BindBonesParameters(i,this._activeEffect);var s=this._mustRebind(n,o,i.visibility);if(s){this._uniformBuffer.bindToEffect(o,"Material"),this.bindViewProjection(o);var l=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(n.texturesEnabled&&(this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),e.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),l&&e.StandardMaterial.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",l.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",l.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",l.getSize().width,l.lodGenerationScale,l.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),a.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),n.texturesEnabled&&(this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),l&&e.StandardMaterial.ReflectionTextureEnabled&&(a.REFLECTIONBLUR&&a.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",l):a.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",l._lodTextureMid||l),this._uniformBuffer.setTexture("reflectionSamplerLow",l._lodTextureLow||l),this._uniformBuffer.setTexture("reflectionSamplerHigh",l._lodTextureHigh||l)):this._uniformBuffer.setTexture("reflectionSampler",l),a.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),e.MaterialHelper.BindClipPlane(this._activeEffect,n),e.MaterialHelper.BindEyePosition(o,n)}!s&&this.isFrozen||(n.lightsEnabled&&e.MaterialHelper.BindLights(n,i,this._activeEffect,a,this._maxSimultaneousLights,!1),this.bindView(o),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(i,this._activeEffect)}}},r.prototype.dispose=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),t&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone((function(){return new r(t,i.getScene())}),this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.BackgroundMaterial",t},r.prototype.getClassName=function(){return"BackgroundMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse((function(){return new r(t.name,i)}),t,i,n)},r.StandardReflectance0=.05,r.StandardReflectance90=.5,n([e.serializeAsColor3()],r.prototype,"_primaryColor",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"primaryColor",void 0),n([e.serializeAsColor3()],r.prototype,"__perceptualColor",void 0),n([e.serialize()],r.prototype,"_primaryColorShadowLevel",void 0),n([e.serialize()],r.prototype,"_primaryColorHighlightLevel",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"primaryColorHighlightLevel",null),n([e.serializeAsTexture()],r.prototype,"_reflectionTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionTexture",void 0),n([e.serialize()],r.prototype,"_reflectionBlur",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionBlur",void 0),n([e.serializeAsTexture()],r.prototype,"_diffuseTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"shadowLights",void 0),n([e.serialize()],r.prototype,"_shadowLevel",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"shadowLevel",void 0),n([e.serializeAsVector3()],r.prototype,"_sceneCenter",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"sceneCenter",void 0),n([e.serialize()],r.prototype,"_opacityFresnel",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"opacityFresnel",void 0),n([e.serialize()],r.prototype,"_reflectionFresnel",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionFresnel",void 0),n([e.serialize()],r.prototype,"_reflectionFalloffDistance",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionFalloffDistance",void 0),n([e.serialize()],r.prototype,"_reflectionAmount",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionAmount",void 0),n([e.serialize()],r.prototype,"_reflectionReflectance0",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionReflectance0",void 0),n([e.serialize()],r.prototype,"_reflectionReflectance90",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionReflectance90",void 0),n([e.serialize()],r.prototype,"_useRGBColor",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRGBColor",void 0),n([e.serialize()],r.prototype,"_enableNoise",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"enableNoise",void 0),n([e.serialize()],r.prototype,"_maxSimultaneousLights",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"maxSimultaneousLights",void 0),n([e.serializeAsImageProcessingConfiguration()],r.prototype,"_imageProcessingConfiguration",void 0),r}(e.PushMaterial);e.BackgroundMaterial=i}(s||(s={}));o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[__uv.$wrap((i))])Object.prototype.hasOwnProperty.call(t,n)&&(e[__uv.$wrap((n))]=t[__uv.$wrap((n))]);return e}).apply(this,arguments)};!function(e){var t=function(){function t(i,r){var n=this;this._errorHandler=function(e,t){n.onErrorObservable.notifyObservers({message:e,exception:t})},this._options=o({},t._getDefaultOptions(),i),this._scene=r,this.onErrorObservable=new e.Observable,this._setupBackground(),this._setupImageProcessing()}return t._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new e.Color3(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:e.Engine.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new e.Color3(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:e.Vector3.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(t.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),t.prototype.updateOptions=function(e){var t=o({},this._options,e);this._ground&&!t.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!t.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=t.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!t.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!t.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=t.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!t.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=t.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=t,this._setupBackground(),this._setupImageProcessing()},t.prototype.setMainColor=function(t){this.groundMaterial&&(this.groundMaterial.primaryColor=t),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=t),this.groundMirror&&(this.groundMirror.clearColor=new e.Color4(t.r,t.g,t.b,1))},t.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},t.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof e.BaseTexture)this._scene.environmentTexture=this._options.environmentTexture;else{var t=e.CubeTexture.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=t}},t.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new e.Mesh("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var t=this._getSceneSize();this._options.createGround&&(this._setupGround(t),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(t),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(t),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=t.rootPosition.x,this._rootMesh.position.z=t.rootPosition.z,this._rootMesh.position.y=t.rootPosition.y},t.prototype._getSceneSize=function(){var t=this,i=this._options.groundSize,r=this._options.skyboxSize,n=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:i,skyboxSize:r,rootPosition:n};var a=this._scene.getWorldExtends((function(e){return e!==t._ground&&e!==t._rootMesh&&e!==t._skybox})),o=a.max.subtract(a.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof e.ArcRotateCamera&&this._scene.activeCamera.upperRadiusLimit&&(r=i=2*this._scene.activeCamera.upperRadiusLimit);var s=o.length();s>i&&(r=i=2*s),i*=1.1,r*=1.5,(n=a.min.add(o.scale(.5))).y=a.min.y-this._options.groundYBias}return{groundSize:i,skyboxSize:r,rootPosition:n}},t.prototype._setupGround=function(t){var i=this;this._ground&&!this._ground.isDisposed()||(this._ground=e.Mesh.CreatePlane("BackgroundPlane",t.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.__uv$setSource(__uv).__uv$parent=this._rootMesh,this._ground.onDisposeObservable.add((function(){i._ground=null}))),this._ground.receiveShadows=this._options.enableGroundShadow},t.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new e.BackgroundMaterial("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},t.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture)if(this._options.groundTexture instanceof e.BaseTexture)this._groundMaterial.diffuseTexture=this._options.groundTexture;else{var t=new e.Texture(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);t.gammaSpace=!1,t.hasAlpha=!0,this._groundMaterial.diffuseTexture=t}},t.prototype._setupGroundMirrorTexture=function(t){var i=e.Texture.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new e.MirrorTexture("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,e.Texture.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new e.Plane(0,-1,0,t.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=i,this._groundMirror.wrapV=i,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var r=0;r<this._scene.meshes.length;r++){var n=this._scene.meshes[__uv.$wrap((r))];n!==this._ground&&n!==this._skybox&&n!==this._rootMesh&&this._groundMirror.renderList.push(n)}this._groundMirror.clearColor=new e.Color4(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},t.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},t.prototype._setupSkybox=function(t){var i=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=e.Mesh.CreateBox("BackgroundSkybox",t.skyboxSize,this._scene,void 0,e.Mesh.BACKSIDE),this._skybox.onDisposeObservable.add((function(){i._skybox=null}))),this._skybox.__uv$setSource(__uv).__uv$parent=this._rootMesh},t.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new e.BackgroundMaterial("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},t.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof e.BaseTexture?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new e.CubeTexture(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=e.Texture.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},t.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},t._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",t._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",t._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",t}();e.EnvironmentHelper=t}(s||(s={})),function(e){var t=function(){function t(){this.systems=new Array}return Object.defineProperty(t.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!0,configurable:!0}),t.prototype.setEmitterAsSphere=function(t,i,r){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:t,renderingGroupId:i};var n=e.MeshBuilder.CreateSphere("emitterSphere",{diameter:t.diameter,segments:t.segments},r);n.renderingGroupId=i;var a=new e.StandardMaterial("emitterSphereMaterial",r);a.emissiveColor=t.color,n.material=a;for(var o=0,s=this.systems;o<s.length;o++){s[__uv.$wrap((o))].emitter=n}this._emitterNode=n},t.prototype.start=function(e){for(var t=0,i=this.systems;t<i.length;t++){var r=i[__uv.$wrap((t))];e&&(r.emitter=e),r.start()}},t.prototype.dispose=function(){for(var e=0,t=this.systems;e<t.length;e++){t[__uv.$wrap((e))].dispose()}this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},t.prototype.serialize=function(){for(var e={systems:[]},t=0,i=this.systems;t<i.length;t++){var r=i[__uv.$wrap((t))];e.systems.push(r.serialize())}return this._emitterNode&&(e.emitter=this._emitterCreationOptions),e},t.Parse=function(i,r,n){void 0===n&&(n=!1);var a=new t,o=e.ParticleHelper.BaseAssetsUrl+"/textures/";r=r||e.Engine.LastCreatedScene;for(var s=0,l=i.systems;s<l.length;s++){var c=l[__uv.$wrap((s))];a.systems.push(n?e.GPUParticleSystem.Parse(c,r,o,!0):e.ParticleSystem.Parse(c,r,o,!0))}if(i.emitter){var u=i.emitter.options;switch(i.emitter.kind){case"Sphere":a.setEmitterAsSphere({diameter:u.diameter,segments:u.segments,color:e.Color3.FromArray(u.color)},i.emitter.renderingGroupId,r)}}return a},t}();e.ParticleSystemSet=t}(s||(s={})),function(e){var t=function(){function t(){}return t.CreateDefault=function(t,i,r,n){var a;return void 0===i&&(i=500),void 0===n&&(n=!1),(a=n?new e.GPUParticleSystem("default system",{capacity:i},r):new e.ParticleSystem("default system",i,r)).emitter=t,a.particleTexture=new e.Texture("https://www.babylonjs.com/assets/Flare.png",a.getScene()),a.createConeEmitter(.1,Math.PI/4),a.color1=new e.Color4(1,1,1,1),a.color2=new e.Color4(1,1,1,1),a.colorDead=new e.Color4(1,1,1,0),a.minSize=.1,a.maxSize=.1,a.minEmitPower=2,a.maxEmitPower=2,a.updateSpeed=1/60,a.emitRate=30,a},t.CreateAsync=function(i,r,n){void 0===n&&(n=!1),r||(r=e.Engine.LastCreatedScene);var a={};return r._addPendingData(a),new Promise((function(o,s){if(n&&!e.GPUParticleSystem.IsSupported)return r._removePendingData(a),s("Particle system with GPU is not supported.");e.Tools.LoadFile(t.BaseAssetsUrl+"/systems/"+i+".json",(function(t,i){r._removePendingData(a);var s=JSON.parse(t.toString());return o(e.ParticleSystemSet.Parse(s,r,n))}),void 0,void 0,void 0,(function(e,t){return r._removePendingData(a),s("An error occured while the creation of your particle system. Check if your type '"+i+"' exists.")}))}))},t.ExportSet=function(t){for(var i=new e.ParticleSystemSet,r=0,n=t;r<n.length;r++){var a=n[__uv.$wrap((r))];i.systems.push(a)}return i},t.BaseAssetsUrl="https://assets.babylonjs.com/particles",t}();e.ParticleHelper=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a){var o=t.call(this,i,a)||this;o._useDirectMapping=!1,i=i||"videoDome",n.resolution=0|Math.abs(n.resolution)||32,n.clickToPlay=Boolean(n.clickToPlay),n.autoPlay=void 0===n.autoPlay||Boolean(n.autoPlay),n.loop=void 0===n.loop||Boolean(n.loop),n.size=Math.abs(n.size)||(a.activeCamera?.48*a.activeCamera.maxZ:1e3),void 0===n.useDirectMapping?o._useDirectMapping=!0:o._useDirectMapping=n.useDirectMapping,o._setReady(!1);var s={loop:n.loop,autoPlay:n.autoPlay,autoUpdateTexture:!0,poster:n.poster},l=o._material=new e.BackgroundMaterial(i+"_material",a),c=o._videoTexture=new e.VideoTexture(i+"_texture",r,a,!1,o._useDirectMapping,e.Texture.TRILINEAR_SAMPLINGMODE,s);return o._mesh=e.Mesh.CreateSphere(i+"_mesh",n.resolution,n.size,a,!1,e.Mesh.BACKSIDE),c.onLoadObservable.addOnce((function(){o._setReady(!0)})),l.useEquirectangularFOV=!0,l.fovMultiplier=1,l.opacityFresnel=!1,o._useDirectMapping?(c.wrapU=e.Texture.CLAMP_ADDRESSMODE,c.wrapV=e.Texture.CLAMP_ADDRESSMODE,l.diffuseTexture=c):(c.coordinatesMode=e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,c.wrapV=e.Texture.CLAMP_ADDRESSMODE,l.reflectionTexture=c),o._mesh.material=l,o._mesh.__uv$setSource(__uv).__uv$parent=o,n.clickToPlay&&(a.onPointerUp=function(){o._videoTexture.video.play()}),o}return a(i,t),Object.defineProperty(i.prototype,"videoTexture",{get:function(){return this._videoTexture},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!0,configurable:!0}),i.prototype.dispose=function(e,i){void 0===i&&(i=!1),this._videoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),t.prototype.dispose.call(this,e,i)},i}(e.TransformNode);e.VideoDome=t}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o){void 0===o&&(o=null);var s=t.call(this,i,a)||this;s._useDirectMapping=!1,s.onLoadErrorObservable=new e.Observable,i=i||"photoDome",n.resolution=0|Math.abs(n.resolution)||32,n.size=Math.abs(n.size)||(a.activeCamera?.48*a.activeCamera.maxZ:1e3),void 0===n.useDirectMapping?s._useDirectMapping=!0:s._useDirectMapping=n.useDirectMapping,s._setReady(!1);var l=s._material=new e.BackgroundMaterial(i+"_material",a);return s._mesh=e.Mesh.CreateSphere(i+"_mesh",n.resolution,n.size,a,!1,e.Mesh.BACKSIDE),l.opacityFresnel=!1,l.useEquirectangularFOV=!0,l.fovMultiplier=1,s.photoTexture=new e.Texture(r,a,!0,!s._useDirectMapping,void 0,void 0,(function(e,t){s.onLoadErrorObservable.notifyObservers(e||"Unknown error occured"),o&&o(e,t)})),s.photoTexture.onLoadObservable.addOnce((function(){s._setReady(!0)})),s._mesh.material=l,s._mesh.__uv$setSource(__uv).__uv$parent=s,s}return a(i,t),Object.defineProperty(i.prototype,"photoTexture",{get:function(){return this._photoTexture},set:function(t){this._photoTexture!==t&&(this._photoTexture=t,this._useDirectMapping?(this._photoTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._photoTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._photoTexture):(this._photoTexture.coordinatesMode=e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._photoTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._photoTexture))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!0,configurable:!0}),i.prototype.dispose=function(e,i){void 0===i&&(i=!1),this._photoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this.onLoadErrorObservable.clear(),t.prototype.dispose.call(this,e,i)},i}(e.TransformNode);e.PhotoDome=t}(s||(s={})),function(e){var t=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=e.AbstractMesh.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=e.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE};e.Engine.prototype.createQuery=function(){return this._gl.createQuery()},e.Engine.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},e.Engine.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},e.Engine.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},e.Engine.prototype.beginOcclusionQuery=function(e,t){var i=this._getGlAlgorithmType(e);return this._gl.beginQuery(i,t),this},e.Engine.prototype.endOcclusionQuery=function(e){var t=this._getGlAlgorithmType(e);return this._gl.endQuery(t),this},e.Engine.prototype._createTimeQuery=function(){var e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},e.Engine.prototype._deleteTimeQuery=function(e){var t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(e):this.deleteQuery(e)},e.Engine.prototype._getTimeQueryResult=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)},e.Engine.prototype._getTimeQueryAvailability=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},e.Engine.prototype.startTimeQuery=function(){var t=this.getCaps(),i=t.timerQuery;if(!i)return null;var r=new e._TimeToken;if(this._gl.getParameter(i.GPU_DISJOINT_EXT),t.canUseTimestampForTimerQuery)r._startTimeQuery=this._createTimeQuery(),i.queryCounterEXT(r._startTimeQuery,i.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;r._timeElapsedQuery=this._createTimeQuery(),i.beginQueryEXT?i.beginQueryEXT(i.TIME_ELAPSED_EXT,r._timeElapsedQuery):this._gl.beginQuery(i.TIME_ELAPSED_EXT,r._timeElapsedQuery),this._currentNonTimestampToken=r}return r},e.Engine.prototype.endTimeQuery=function(e){var t=this.getCaps(),i=t.timerQuery;if(!i||!e)return-1;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),i.queryCounterEXT(e._endTimeQuery,i.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;i.endQueryEXT?i.endQueryEXT(i.TIME_ELAPSED_EXT):this._gl.endQuery(i.TIME_ELAPSED_EXT),e._timeElapsedQueryEnded=!0}var r=this._gl.getParameter(i.GPU_DISJOINT_EXT),n=!1;if(e._endTimeQuery?n=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(n=this._getTimeQueryAvailability(e._timeElapsedQuery)),n&&!r){var a=0;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;var o=this._getTimeQueryResult(e._startTimeQuery);a=this._getTimeQueryResult(e._endTimeQuery)-o,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;a=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return a}return-1},e.Engine.prototype._getGlAlgorithmType=function(t){return t===e.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(e.AbstractMesh.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},enumerable:!1,configurable:!0}),Object.defineProperty(e.AbstractMesh.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new t),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(e.AbstractMesh.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.AbstractMesh.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.AbstractMesh.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.AbstractMesh.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),e.AbstractMesh.prototype._checkOcclusionQuery=function(){var t=this._occlusionDataStorage;if(t.occlusionType===e.AbstractMesh.OCCLUSION_TYPE_NONE)return t.isOccluded=!1,!1;var i=this.getEngine();if(i.webGLVersion<2)return t.isOccluded=!1,!1;if(!i.isQueryResultAvailable)return t.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(i.isQueryResultAvailable(this._occlusionQuery)){var r=i.getQueryResult(this._occlusionQuery);t.isOcclusionQueryInProgress=!1,t.occlusionInternalRetryCounter=0,t.isOccluded=1!==r}else{if(t.occlusionInternalRetryCounter++,!(-1!==t.occlusionRetryCount&&t.occlusionInternalRetryCounter>t.occlusionRetryCount))return!1;t.isOcclusionQueryInProgress=!1,t.occlusionInternalRetryCounter=0,t.isOccluded=t.occlusionType!==e.AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC&&t.isOccluded}var n=this.getScene();if(n.getBoundingBoxRenderer){var a=n.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=i.createQuery()),i.beginOcclusionQuery(t.occlusionQueryAlgorithmType,this._occlusionQuery),a.renderOcclusionBoundingBox(this),i.endOcclusionQuery(t.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return t.isOccluded}}(s||(s={})),function(e){var t=function(t){function i(i,r,n,a,o){void 0===r&&(r=256),void 0===n&&(n=e.Engine.LastCreatedScene);var s=t.call(this,i,r,"noise",n,a,o)||this;return s._time=0,s.brightness=.2,s.octaves=3,s.persistence=.8,s.animationSpeedFactor=1,s.autoClear=!1,s._updateShaderUniforms(),s}return a(i,t),i.prototype._updateShaderUniforms=function(){var e=this.getScene();e&&(this._time+=e.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this._time))},i.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},i.prototype.render=function(e){this._updateShaderUniforms(),t.prototype.render.call(this,e)},i.prototype.serialize=function(){var e={customType:"BABYLON.NoiseProceduralTexture"};return e.brightness=this.brightness,e.octaves=this.octaves,e.persistence=this.persistence,e.animationSpeedFactor=this.animationSpeedFactor,e.size=this.getSize().width,e.generateMipMaps=this._generateMipMaps,e},i.Parse=function(e,t,r){var n=new i(e.name,e.size,t,void 0,e.generateMipMaps);return n.brightness=e.brightness,n.octaves=e.octaves,n.persistence=e.persistence,n.animationSpeedFactor=e.animationSpeedFactor,n},i}(e.ProceduralTexture);e.NoiseProceduralTexture=t}(s||(s={}));var s;o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[__uv.$wrap((i))])Object.prototype.hasOwnProperty.call(t,n)&&(e[__uv.$wrap((n))]=t[__uv.$wrap((n))]);return e}).apply(this,arguments)};!function(e){var t=function(){function t(e,i){if(void 0===i&&(i=null),!t.IsSupported(e))throw"Your browser does not support recording so far.";var r=e.getRenderingCanvas();if(!r)throw"The babylon engine must have a canvas to be recorded";this._canvas=r,this._canvas.isRecording=!1,this._options=o({},t._defaultOptions,i);var n=this._canvas.captureStream(this._options.fps);this._mediaRecorder=new MediaRecorder(n,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return t.IsSupported=function(e){var t=e.getRenderingCanvas();return!!t&&"function"==typeof t.captureStream},Object.defineProperty(t.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!0,configurable:!0}),t.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},t.prototype.startRecording=function(e,t){var i=this;if(void 0===e&&(e="babylonjs.webm"),void 0===t&&(t=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return t>0&&setTimeout((function(){i.stopRecording()}),1e3*t),this._fileName=e,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise((function(e,t){i._resolve=e,i._reject=t}))},t.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},t.prototype._handleDataAvailable=function(e){e.data.size>0&&this._recordedChunks.push(e.data)},t.prototype._handleError=function(e){if(this.stopRecording(),!this._reject)throw new e.error;this._reject(e.error)},t.prototype._handleStop=function(){this.stopRecording();var t=new Blob(this._recordedChunks);this._resolve&&this._resolve(t),window.URL.createObjectURL(t),this._fileName&&e.Tools.Download(t,this._fileName)},t._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3e3},t}();e.VideoRecorder=t}(s||(s={})),function(e){e.Scene.prototype.createDefaultLight=function(t){if(void 0===t&&(t=!1),t&&this.lights)for(var i=0;i<this.lights.length;i++)this.lights[__uv.$wrap((i))].dispose();0===this.lights.length&&new e.HemisphericLight("default light",e.Vector3.Up(),this)},e.Scene.prototype.createDefaultCamera=function(t,i,r){if(void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),i&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var n,a=this.getWorldExtends(),o=a.max.subtract(a.min),s=a.min.add(o.scale(.5)),l=1.5*o.length();if(isFinite(l)||(l=1,s.copyFromFloats(0,0,0)),t){var c=new e.ArcRotateCamera("default camera",-Math.PI/2,Math.PI/2,l,s,this);c.lowerRadiusLimit=.01*l,c.wheelPrecision=100/l,n=c}else{var u=new e.FreeCamera("default camera",new e.Vector3(s.x,s.y,-l),this);u.setTarget(s),n=u}n.minZ=.01*l,n.maxZ=1e3*l,n.speed=.2*l,this.activeCamera=n;var h=this.getEngine().getRenderingCanvas();r&&h&&n.attachControl(h)}},e.Scene.prototype.createDefaultCameraOrLight=function(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!1),this.createDefaultLight(t),this.createDefaultCamera(e,t,i)},e.Scene.prototype.createDefaultSkybox=function(t,i,r,n,a){if(void 0===i&&(i=!1),void 0===r&&(r=1e3),void 0===n&&(n=0),void 0===a&&(a=!0),!t)return e.Tools.Warn("Can not create default skybox without environment texture."),null;a&&t&&(this.environmentTexture=t);var o=e.Mesh.CreateBox("hdrSkyBox",r,this);if(i){var s=new e.PBRMaterial("skyBox",this);s.backFaceCulling=!1,s.reflectionTexture=t.clone(),s.reflectionTexture&&(s.reflectionTexture.coordinatesMode=e.Texture.SKYBOX_MODE),s.microSurface=1-n,s.disableLighting=!0,s.twoSidedLighting=!0,o.infiniteDistance=!0,o.material=s}else{var l=new e.StandardMaterial("skyBox",this);l.backFaceCulling=!1,l.reflectionTexture=t.clone(),l.reflectionTexture&&(l.reflectionTexture.coordinatesMode=e.Texture.SKYBOX_MODE),l.disableLighting=!0,o.infiniteDistance=!0,o.material=l}return o},e.Scene.prototype.createDefaultEnvironment=function(t){return e.EnvironmentHelper?new e.EnvironmentHelper(t,this):null},e.Scene.prototype.createDefaultVRExperience=function(t){return void 0===t&&(t={}),new e.VRExperienceHelper(this,t)}}(s||(s={})),s.Effect.ShadersStore={defaultVertexShader:"#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL \nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif \n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n",defaultPixelShader:"#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY \n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n",pbrVertexShader:"precision highp float;\n#include<__decl__pbrVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif \n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(positionUpdated,1.0)).xyz;\n#else\nvPositionUVW=positionUpdated;\n#endif\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=environmentIrradianceJones(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif \n#if defined(ALBEDO) && ALBEDODIRECTUV == 0 \nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0 \nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0 \nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0 \nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0 \nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0 \nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0 \nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0 \nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",pbrPixelShader:"#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n#include<__decl__pbrFragment>\nuniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2;\n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n\n#include<shadowsFragmentFunctions>\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#include<bumpFragment>\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalW.xyz);\nvec3 nDfdy=dFdy(normalW.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\n\nfloat geometricRoughnessFactor=pow(clamp(slopeSquare ,0.,1.),0.333);\n\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\n#else\nfloat geometricRoughnessFactor=0.;\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#endif\n#endif\n#endif\n\nmicroSurface=clamp(microSurface,0.,1.);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=fresnelSchlickEnvironmentGGX(clamp(dot(viewDirectionW,normalForward),0.0,1.0),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=clamp(NdotVUnclamped,0.,1.)+0.00001;\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#ifdef SPECULARAA\n\n\nalphaG+=(0.75*geometricAlphaGFactor);\n#endif\n\n#ifdef REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,1.0);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#else\nfloat lodRefractionNormalized=clamp(refractionLOD/log2(vRefractionMicrosurfaceInfos.x),0.,1.);\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef GAMMAREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef RGBDREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,1.);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x),0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=environmentIrradianceJones(irradianceVector);\n#endif\n#endif\n\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\n\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb;\n#ifdef GAMMALIGHTMAP\nlightmapColor=toLinearSpace(lightmapColor);\n#endif\nlightmapColor*=vLightmapInfos.y;\n#endif\nlightingInfo info;\npointLightingInfo pointInfo;\nspotLightingInfo spotInfo;\nfloat shadow=1.; \nfloat NdotL=-1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec2 brdfSamplerUV=vec2(NdotV,roughness);\n\nvec4 environmentBrdf=texture2D(environmentBrdfSampler,brdfSamplerUV);\nvec3 specularEnvironmentReflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=fresnelSchlickEnvironmentGGX(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#ifdef REFRACTION\nvec3 refractance=vec3(0.0,0.0,0.0);\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedo;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedo*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nenvironmentRefraction.rgb*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=transmission;\n#endif\n\n\n\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance.rgb;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#endif\n\n#ifdef REFRACTION\nvec3 finalRefraction=environmentRefraction.rgb;\nfinalRefraction*=refractance;\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=clamp(alpha+luminanceOverAlpha*luminanceOverAlpha,0.,1.);\n#endif\n#endif\n#endif\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse.rgb+=vAmbientColor;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;\n#endif\n\n\n\nvec4 finalColor=vec4(\nfinalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#endif\n#ifdef REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\ngl_FragColor=finalColor;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n}",rgbdEncodePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void) \n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}",rgbdDecodePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void) \n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}",spritesVertexShader:"\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}",spritesPixelShader:"uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",particlesVertexShader:"\nattribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET \nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD \nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction; \n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET \nuniform vec3 particlesInfos; \n#endif\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition; \n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner; \n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner; \n}\n#endif\nvoid main(void) { \nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD \n\nvec3 rotatedCorner;\n#ifdef BILLBOARDY \nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz; \n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition; \nvec3 worldPos=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz; \n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner; \n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\n\ngl_Position=projection*vec4(viewPos,1.0); \n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(worldPos,1.0); \n#endif \nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset*particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nvec4 worldPos=invView*vec4(viewPos,1.0);\n#endif\n#include<clipPlaneVertex>\n}",particlesPixelShader:"\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\n\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n}",colorVertexShader:"\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}",colorPixelShader:"#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\nvoid main(void) {\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}",gpuRenderParticlesVertexShader:"#version 300 es\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 size;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nin vec3 direction;\n#endif\nin float angle;\n#ifdef ANIMATESHEET\nin float cellIndex;\n#endif\nin vec2 offset;\nin vec2 uv;\nout vec2 vUV;\nout vec4 vColor;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nin vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition; \n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner; \n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else \nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY \nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0)); \n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition; \nvec3 worldPos=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0)); \n#else\n\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nvec4 viewPosition=view*vec4(position,1.0)+rotatedCorner;\n#endif\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\n\nvec4 viewPosition=view*vec4(worldPos,1.0); \n#endif\ngl_Position=projection*viewPosition;\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nvec4 worldPos=invView*viewPosition;\n#endif \n#include<clipPlaneVertex>\n}",gpuRenderParticlesPixelShader:"#version 300 es\nuniform sampler2D textureSampler;\nin vec2 vUV;\nin vec4 vColor;\nout vec4 outFragColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture(textureSampler,vUV);\noutFragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\noutFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha); \n#endif \n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\noutFragColor=applyImageProcessing(outFragColor);\n#endif\n#endif\n}\n",gpuUpdateParticlesVertexShader:"#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\nuniform mat4 emitterWM;\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\n\nin vec3 position;\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\n\nout vec3 outPosition;\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta; \n\nif (newAge>=life && stopFactor != 0.) {\nvec3 position;\nvec3 direction;\n\nvec4 randoms=getRandomVec4(seed.x);\n\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=mod(newAge,outLife);\n\noutSeed=seed;\n\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\n\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n\n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nposition=vec3(0,0,0);\ndirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nposition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\ndirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nposition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\ndirection=position+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nposition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\ndirection=direction1+(direction2-direction1)*randoms3;\n#else\n\ndirection=position+directionRandomizer*randoms3;\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nposition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection=direction1+(direction2-direction1)*randoms3;\n#else\n\nangle=angle+((randoms3.x-0.5)*PI);\ndirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));\ndirection=normalize(direction);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.00001;\n#else\nfloat h=randoms2.y*height.y;\n\nh=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h*height.x;\nposition=vec3(randX,randY,randZ); \n\nif (abs(cos(coneAngle)) == 1.0) {\ndirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\ndirection=position+directionRandomizer*randoms3;\n}\n#else \n\nposition=vec3(0.,0.,0.);\n\ndirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\noutPosition=(emitterWM*vec4(position,1.)).xyz;\nvec3 initial=(emitterWM*vec4(direction,0.)).xyz;\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\noutPosition=position+direction*directionScale;\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nvec3 localPosition=outPosition-emitterWM[3].xyz;\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#endif \nfloat ratio=clamp(mod(offsetAge*cellInfos.z,life)/life,0.,1.0);\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}",gpuUpdateParticlesPixelShader:"#version 300 es\nvoid main() {\ndiscard;\n}\n",postprocessVertexShader:"\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",passPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",shadowMapVertexShader:"\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\nuniform vec3 lightData;\n#endif\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\n#include<helperFunctions>\nuniform mat4 viewProjection;\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvec3 worldNor=normalize(normalWorld*normal);\n#ifdef DIRECTIONINLIGHTDATA\nvec3 worldLightDir=normalize(-lightData.xyz);\n#else\nvec3 directionToLight=lightData.xyz-worldPos.xyz;\nvec3 worldLightDir=normalize(directionToLight);\n#endif\nfloat ndl=dot(worldNor,worldLightDir);\nfloat sinNL=sqrt(1.0-ndl*ndl);\nfloat normalBias=biasAndScale.y*sinNL;\nworldPos.xyz-=worldNor*normalBias;\n#endif\n\ngl_Position=viewProjection*worldPos;\n#ifdef DEPTHTEXTURE\n\ngl_Position.z+=biasAndScale.x*gl_Position.w;\n#endif\n\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",shadowMapPixelShader:"#ifndef FLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=vDepthMetric;\n#ifdef ESM\ndepth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);\n#endif\n#ifdef FLOAT\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depth);\n#endif\n}",depthBoxBlurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}",proceduralVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",depthVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",depthPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(vDepthMetric,vDepthMetric*vDepthMetric,0.0,1.0);\n}",geometryVertexShader:"precision highp float;\nprecision highp int;\n#include<bonesDeclaration>\n#include<instancesDeclaration>\nattribute vec3 position;\nattribute vec3 normal;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nvarying vec2 uv;\n#endif\n#ifdef UV2\nvarying vec2 uv2;\n#endif\n#endif\n\nuniform mat4 viewProjection;\nuniform mat4 view;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 pos=vec4(finalWorld*vec4(position,1.0));\nvNormalV=normalize(vec3((view*finalWorld)*vec4(normal,0.0)));\nvViewPos=view*pos;\n#ifdef POSITION\nvPosition=pos.xyz/pos.w;\n#endif\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",geometryPixelShader:"#extension GL_EXT_draw_buffers : require\nprecision highp float;\nprecision highp int;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef POSITION\n#include<mrtFragmentDeclaration>[3]\n#else\n#include<mrtFragmentDeclaration>[2]\n#endif\nvoid main() {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);\n\ngl_FragData[1]=vec4(normalize(vNormalV),1.0);\n\n#ifdef POSITION\ngl_FragData[2]=vec4(vPosition,1.0);\n#endif\n}",ssaoPixelShader:"\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n",ssao2PixelShader:"\nprecision highp float;\nuniform sampler2D textureSampler;\nuniform float near;\nuniform float far;\nuniform float radius;\nfloat scales[16]=float[16](\n0.1,\n0.11406250000000001,\n0.131640625,\n0.15625,\n0.187890625,\n0.2265625,\n0.272265625,\n0.325,\n0.384765625,\n0.4515625,\n0.525390625,\n0.60625,\n0.694140625,\n0.7890625,\n0.891015625,\n1.0\n);\nvarying vec2 vUV;\nfloat perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {\nreturn ( near*far )/( ( far-near )*invClipZ-far );\n}\nfloat viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( near*far/viewZ+far)/( far-near );\n}\nfloat viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( viewZ+near )/( near-far );\n}\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform sampler2D normalSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float base;\nuniform float xViewport;\nuniform float yViewport;\nuniform float maxZ;\nuniform float minZAspect;\nuniform vec2 texelSize;\nuniform mat4 projection;\nvoid main()\n{\nvec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;\nfloat depth=texture2D(textureSampler,vUV).r;\nfloat depthSign=depth/abs(depth);\ndepth=depth*depthSign;\nvec3 normal=texture2D(normalSampler,vUV).rgb; \nfloat occlusion=0.0;\nfloat correctedRadius=min(radius,minZAspect*depth/near);\nvec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);\nvec3 origin=vViewRay*depth;\nvec3 rvec=random*2.0-1.0;\nrvec.z=0.0;\n\nfloat dotProduct=dot(rvec,normal);\nrvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);\nvec3 tangent=normalize(rvec-normal*dot(rvec,normal));\nvec3 bitangent=cross(normal,tangent);\nmat3 tbn=mat3(tangent,bitangent,normal);\nfloat difference;\nfor (int i=0; i<SAMPLES; ++i) {\n\nvec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];\nsamplePosition=samplePosition*correctedRadius+origin;\n\nvec4 offset=vec4(samplePosition,1.0);\noffset=projection*offset;\noffset.xyz/=offset.w;\noffset.xy=offset.xy*0.5+0.5;\nif (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {\ncontinue;\n}\n\nfloat sampleDepth=abs(texture2D(textureSampler,offset.xy).r);\n\ndifference=depthSign*samplePosition.z-sampleDepth;\nfloat rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);\nocclusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;\n}\nocclusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor=vec4(vec3(result),1.0);\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.3846153846)*direction;\nvec2 off2=vec2(3.2307692308)*direction;\ncolor+=texture2D(image,uv)*0.2270270270;\ncolor+=texture2D(image,uv+(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv-(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv+(off2/resolution))*0.0702702703;\ncolor+=texture2D(image,uv-(off2/resolution))*0.0702702703;\nreturn color;\n}\nvec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\ncolor+=texture2D(image,uv)*0.1964825501511404;\ncolor+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;\ncolor+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;\nreturn color;\n}\nvec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\nfloat compareDepth=abs(texture2D(depthSampler,uv).r);\nfloat sampleDepth;\nfloat weight;\nfloat weightSum=30.0;\ncolor+=texture2D(image,uv)*30.0;\nsampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off3/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off3/resolution))*weight;\nreturn color/weightSum;\n}\nvoid main()\n{\n#if EXPENSIVE\nfloat compareDepth=abs(texture2D(depthSampler,vUV).r);\nfloat texelsize=1.0/outSize;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 direction=vec2(0.0,1.0);\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=abs(texture2D(depthSampler,samplePos).r);\nfloat weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n#else\nvec4 color;\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#else\nvec2 direction=vec2(0.0,1.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#endif\ngl_FragColor.rgb=vec3(color.r);\ngl_FragColor.a=1.0;\n#endif\n}\n#endif\n",ssaoCombinePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nuniform vec4 viewport;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n",lensHighlightsPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",depthOfFieldPixelShader:"\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n",standardPixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(VLS)\n#define PI 3.1415926535897932384626433832795\nuniform mat4 shadowViewProjection;\nuniform mat4 lightWorld;\nuniform vec3 cameraPosition;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform vec2 depthValues;\nuniform float scatteringCoefficient;\nuniform float scatteringPower;\nuniform sampler2D shadowMapSampler;\nuniform sampler2D positionSampler;\nfloat computeScattering(float lightDotView)\n{\nfloat result=1.0-scatteringCoefficient*scatteringCoefficient;\nresult/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));\nreturn result;\n}\nvoid main(void)\n{\n\nvec3 worldPos=texture2D(positionSampler,vUV).rgb;\nvec3 startPosition=cameraPosition;\nvec3 rayVector=worldPos-startPosition;\nfloat rayLength=length(rayVector);\nvec3 rayDirection=rayVector/rayLength;\nfloat stepLength=rayLength/NB_STEPS;\nvec3 stepL=rayDirection*stepLength;\nvec3 currentPosition=startPosition;\nvec3 accumFog=vec3(0.0);\nfor (int i=0; i<int(NB_STEPS); i++)\n{\nvec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);\nfloat depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nworldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;\nworldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);\nfloat shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;\nif (shadowMapValue>shadowPixelDepth)\naccumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));\ncurrentPosition+=stepL;\n}\naccumFog/=NB_STEPS;\nvec3 color=accumFog*scatteringPower;\ngl_FragColor=vec4(color*exp(color) ,1.0);\n}\n#endif\n#if defined(VLSMERGE)\nuniform sampler2D originalSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);\n}\n#endif\n#if defined(LUMINANCE)\nuniform vec2 lumOffsets[4];\nvoid main()\n{\nfloat average=0.0;\nvec4 color=vec4(0.0);\nfloat maximum=-1e20;\nvec3 weight=vec3(0.299,0.587,0.114);\nfor (int i=0; i<4; i++)\n{\ncolor=texture2D(textureSampler,vUV+ lumOffsets[i]);\n\nfloat GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));\n\n#ifdef WEIGHTED_AVERAGE\nfloat GreyValue=dot(color.rgb,weight);\n#endif\n#ifdef BRIGHTNESS\nfloat GreyValue=max(color.r,max(color.g,color.b));\n#endif\n#ifdef HSL_COMPONENT\nfloat GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));\n#endif\n#ifdef MAGNITUDE\nfloat GreyValue=length(color.rgb);\n#endif\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(LUMINANCE_DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLER\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main()\n{\nvec4 color=vec4(0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++)\n{\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifdef FINAL_DOWN_SAMPLER\ngl_FragColor=pack(average);\n#else\ngl_FragColor=vec4(average,average,0.0,1.0);\n#endif\n}\n#endif\n#if defined(HDR)\nuniform sampler2D textureAdderSampler;\nuniform float averageLuminance;\nvoid main()\n{\nvec4 color=texture2D(textureAdderSampler,vUV);\nvec4 adjustedColor=color/averageLuminance;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n#if defined(MOTION_BLUR)\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\nuniform vec2 screenSize;\nuniform float motionScale;\nuniform float motionStrength;\nuniform sampler2D depthSampler;\nvoid main(void)\n{\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n}\n#endif\n",fxaaVertexShader:"\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}",fxaaPixelShader:"uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\n#ifndef MALI\nif(range<rangeMaxClamped) \n{\ngl_FragColor=rgbyM;\nreturn;\n}\n#endif\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan) \n{\nlumaS=lumaE;\n}\nif (horzSpan) \n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan) \n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN) \n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) \n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN) \n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP) \n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan) \n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\n#ifdef MALI\nif(range<rangeMaxClamped) \n{\ngl_FragColor=rgbyM;\n}\nelse\n{\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}\n#else\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n#endif\n}",chromaticAberrationPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float radialIntensity;\nuniform vec2 direction;\nuniform vec2 centerPosition;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);\nvec2 directionOfEffect=direction;\nif(directionOfEffect.x == 0. && directionOfEffect.y == 0.){\ndirectionOfEffect=normalize(centered_screen_pos);\n}\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;\nfloat ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\noriginal.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);\ngl_FragColor=original;\n}",grainPixelShader:"#include<helperFunctions>\n\nuniform sampler2D textureSampler; \n\nuniform float intensity;\nuniform float animatedSeed;\n\nvarying vec2 vUV;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec2 seed=vUV*(animatedSeed);\nfloat grain=dither(seed,intensity);\n\nfloat lum=getLuminance(gl_FragColor.rgb);\nfloat grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;\ngl_FragColor.rgb+=grain*grainAmount;\ngl_FragColor.rgb=max(gl_FragColor.rgb,0.0);\n}",sharpenPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform vec2 sharpnessAmounts;\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 color=texture2D(textureSampler,vUV);\nvec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1)) -\ncolor*4.0;\ngl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);\n}",kernelBlurVertexShader:"\nattribute vec2 position;\n\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n}",kernelBlurPixelShader:"\nuniform sampler2D textureSampler;\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;\nuniform vec2 cameraMinMaxZ;\nfloat sampleDistance(const in vec2 offset) {\nfloat depth=texture2D(circleOfConfusionSampler,offset).g; \nreturn cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth; \n}\nfloat sampleCoC(const in vec2 offset) {\nfloat coc=texture2D(circleOfConfusionSampler,offset).r; \nreturn coc; \n}\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nvoid main(void)\n{\nfloat computedWeight=0.0;\n#ifdef PACKEDFLOAT \nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT; \nfloat factor=0.0;\n\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}",depthOfFieldMergePixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\nuniform sampler2D circleOfConfusionSampler;\nuniform sampler2D blurStep0;\n#if BLUR_LEVEL>0\nuniform sampler2D blurStep1;\n#endif\n#if BLUR_LEVEL>1\nuniform sampler2D blurStep2;\n#endif\nvoid main(void)\n{\nfloat coc=texture2D(circleOfConfusionSampler,vUV).r;\n#if BLUR_LEVEL == 0\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred0=texture2D(blurStep0,vUV);\ngl_FragColor=mix(original,blurred0,coc);\n#endif\n#if BLUR_LEVEL == 1\nif(coc<0.5){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(original,blurred1,coc/0.5);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV); \nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);\n}\n#endif\n#if BLUR_LEVEL == 2\nif(coc<0.33){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(original,blurred2,coc/0.33);\n}else if(coc<0.66){\nvec4 blurred1=texture2D(blurStep1,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);\n}\n#endif\n}\n",circleOfConfusionPixelShader:"\nuniform sampler2D depthSampler;\n\nvarying vec2 vUV;\n\nuniform vec2 cameraMinMaxZ;\n\nuniform float focusDistance;\nuniform float cocPrecalculation;\nvoid main(void)\n{\nfloat depth=texture2D(depthSampler,vUV).r;\nfloat pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0; \nfloat coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));\ncoc=clamp(coc,0.0,1.0);\ngl_FragColor=vec4(coc,depth,coc,1.0);\n}\n",bloomMergePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D bloomBlur;\nvarying vec2 vUV;\nuniform float bloomWeight;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec3 blurred=texture2D(bloomBlur,vUV).rgb;\ngl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight); \n}\n",extractHighlightsPixelShader:"#include<helperFunctions>\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float threshold;\nuniform float exposure;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\nfloat luma=getLuminance(gl_FragColor.rgb*exposure);\ngl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;\n}",refractionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}",blackAndWhitePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float degree;\nvoid main(void) \n{\nvec3 color=texture2D(textureSampler,vUV).rgb;\nfloat luminance=dot(color,vec3(0.3,0.59,0.11)); \nvec3 blackAndWhite=vec3(luminance,luminance,luminance);\ngl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);\n}",convolutionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}",filterPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}",volumetricLightScatteringPixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;\ndataSample*=illuminationDecay*weight;\ncolor+=dataSample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",volumetricLightScatteringPassPixelShader:"#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n",colorCorrectionPixelShader:"\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}",tonemapPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",displayPassPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}",highlightsPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nconst vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvoid main(void) \n{\nvec4 tex=texture2D(textureSampler,vUV);\nvec3 c=tex.rgb;\nfloat luma=dot(c.rgb,RGBLuminanceCoefficients);\n\n\ngl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a); \n}",imageProcessingPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main(void)\n{\nvec4 result=texture2D(textureSampler,vUV);\n#ifdef IMAGEPROCESSING\n#ifndef FROMLINEARSPACE\n\nresult.rgb=toLinearSpace(result.rgb);\n#endif\nresult=applyImageProcessing(result);\n#else\n\n#ifdef FROMLINEARSPACE\nresult=applyImageProcessing(result);\n#endif\n#endif\ngl_FragColor=result;\n}",lensFlareVertexShader:"\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}",lensFlarePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",anaglyphPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}",stereoscopicInterlacePixelShader:"const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}",vrDistortionCorrectionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,0.0);\nelse{\ngl_FragColor=texture2D(textureSampler,tc);\n}\n}",glowBlurPostProcessPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",glowMapGenerationPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\nuniform vec4 color;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUVDiffuse).a<0.4)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive)*color;\n#else\ngl_FragColor=color;\n#endif\n}",glowMapGenerationVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(positionUpdated,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",glowMapMergePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#ifdef EMISSIVE\nuniform sampler2D textureSampler2;\n#endif\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef EMISSIVE\nbaseColor+=texture2D(textureSampler2,vUV);\nbaseColor*=offset;\n#else\nbaseColor.a=abs(offset-baseColor.a);\n#ifdef STROKE\nfloat alpha=smoothstep(.0,.1,baseColor.a);\nbaseColor.a=alpha;\nbaseColor.rgb=baseColor.rgb*alpha;\n#endif\n#endif\ngl_FragColor=baseColor;\n}",glowMapMergeVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",lineVertexShader:"\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",linePixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",outlineVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<logDepthVertex>\n}\n",outlinePixelShader:"#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n}",layerVertexShader:"\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",layerPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",backgroundVertexShader:"precision highp float;\n#include<__decl__backgroundVertex>\n#include<helperFunctions>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normal);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#ifdef EQUIRECTANGULAR_RELFECTION_FOV\nmat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));\nvec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));\nif (fFovMultiplier<=1.0) {\nvDirectionW=normalize(segment);\n} else {\nvDirectionW=normalize(vDirectionW+(vDirectionW-segment));\n}\n#endif\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0 \nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",backgroundPixelShader:"#ifdef TEXTURELODSUPPORT\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__backgroundFragment>\n#define RECIPROCAL_PI2 0.15915494\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2; \n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#ifndef SHADOWONLY\n#define SHADOWONLY;\n#endif\n#include<imageProcessingDeclaration>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<helperFunctions>\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<imageProcessingFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n#ifdef REFLECTIONFRESNEL\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(0.0,1.0,0.0);\n#endif\n\nfloat shadow=1.;\nfloat globalShadow=0.;\nfloat shadowLightCount=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef SHADOWINUSE\nglobalShadow/=shadowLightCount;\n#else\nglobalShadow=1.0;\n#endif\n\nvec4 reflectionColor=vec4(1.,1.,1.,1.);\n#ifdef REFLECTION\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#ifdef REFLECTIONBLUR\nfloat reflectionLOD=vReflectionInfos.y;\n#ifdef TEXTURELODSUPPORT\n\nreflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nreflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD,0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nreflectionColor=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nreflectionSpecularMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nreflectionColor=mix(\nreflectionSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#else\nvec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);\nreflectionColor=reflectionSample;\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef GAMMAREFLECTION\nreflectionColor.rgb=toLinearSpace(reflectionColor.rgb);\n#endif\n#ifdef REFLECTIONBGR\nreflectionColor.rgb=reflectionColor.bgr;\n#endif\n\nreflectionColor.rgb*=vReflectionInfos.x;\n#endif\n\nvec3 diffuseColor=vec3(1.,1.,1.);\nfloat finalAlpha=alpha;\n#ifdef DIFFUSE\nvec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef GAMMADIFFUSE\ndiffuseMap.rgb=toLinearSpace(diffuseMap.rgb);\n#endif\n\ndiffuseMap.rgb*=vDiffuseInfos.y;\n#ifdef DIFFUSEHASALPHA\nfinalAlpha*=diffuseMap.a;\n#endif\ndiffuseColor=diffuseMap.rgb;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 colorBase=diffuseColor;\n#else\nvec3 colorBase=reflectionColor.rgb*diffuseColor;\n#endif\ncolorBase=max(colorBase,0.0);\n\n#ifdef USERGBCOLOR\nvec3 finalColor=colorBase;\n#else\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nvec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);\n#else\nvec3 mainColor=vPrimaryColor.rgb;\n#endif\nvec3 finalColor=colorBase*mainColor;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 reflectionAmount=vReflectionControl.xxx;\nvec3 reflectionReflectance0=vReflectionControl.yyy;\nvec3 reflectionReflectance90=vReflectionControl.zzz;\nfloat VdotN=dot(normalize(vEyePosition),normalW);\nvec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(clamp(VdotN,0.0,1.0),reflectionReflectance0,reflectionReflectance90,1.0);\nreflectionAmount*=planarReflectionFresnel;\n#ifdef REFLECTIONFALLOFF\nfloat reflectionDistanceFalloff=1.0-clamp(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w,0.0,1.0);\nreflectionDistanceFalloff*=reflectionDistanceFalloff;\nreflectionAmount*=reflectionDistanceFalloff;\n#endif\nfinalColor=mix(finalColor,reflectionColor.rgb,clamp(reflectionAmount,0.,1.));\n#endif\n#ifdef OPACITYFRESNEL\nfloat viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));\n\nconst float startAngle=0.1;\nfloat fadeFactor=clamp(viewAngleToFloor/startAngle,0.0,1.0);\nfinalAlpha*=fadeFactor*fadeFactor;\n#endif\n\n#ifdef SHADOWINUSE\nfinalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);\n#endif\n\nvec4 color=vec4(finalColor,finalAlpha);\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\ncolor.rgb=clamp(color.rgb,0.,30.0);\n#else\n\ncolor=applyImageProcessing(color);\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#ifdef NOISE\ncolor.rgb+=dither(vPositionW.xy,0.5);\ncolor=max(color,0.0);\n#endif\ngl_FragColor=color;\n}\n",noisePixelShader:"\n\nuniform float brightness;\nuniform float persistence;\nuniform float timeScale;\n\nvarying vec2 vUV;\n\nvec2 hash22(vec2 p)\n{\np=p*mat2(127.1,311.7,269.5,183.3);\np=-1.0+2.0*fract(sin(p)*43758.5453123);\nreturn sin(p*6.283+timeScale);\n}\nfloat interpolationNoise(vec2 p)\n{\nvec2 pi=floor(p);\nvec2 pf=p-pi;\nvec2 w=pf*pf*(3.-2.*pf);\nfloat f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));\nfloat f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));\nfloat f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));\nfloat f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));\nfloat xm1=mix(f00,f10,w.x);\nfloat xm2=mix(f01,f11,w.x);\nfloat ym=mix(xm1,xm2,w.y); \nreturn ym;\n}\nfloat perlinNoise2D(float x,float y)\n{\nfloat sum=0.0;\nfloat frequency=0.0;\nfloat amplitude=0.0;\nfor(int i=0; i<OCTAVES; i++)\n{\nfrequency=pow(2.0,float(i));\namplitude=pow(persistence,float(i));\nsum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;\n}\nreturn sum;\n}\n\nvoid main(void)\n{\nfloat x=abs(vUV.x);\nfloat y=abs(vUV.y);\nfloat noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);\ngl_FragColor=vec4(noise,noise,noise,1.0);\n}\n"},s.Effect.IncludesShadersStore={depthPrePass:"#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif",bonesDeclaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif",instancesDeclaration:"#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",pointCloudVertexDeclaration:"#ifdef POINTSIZE\nuniform float pointSize;\n#endif",bumpVertexDeclaration:"#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n",clipPlaneVertexDeclaration:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif",fogVertexDeclaration:"#ifdef FOG\nvarying vec3 vFogDistance;\n#endif",morphTargetsVertexGlobalDeclaration:"#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif",morphTargetsVertexDeclaration:"#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#endif",logDepthDeclaration:"#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",morphTargetsVertex:"#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#endif",instancesVertex:"#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",bonesVertex:"#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif",bumpVertex:"#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif",clipPlaneVertex:"#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif",fogVertex:"#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif",shadowsVertex:"#ifdef SHADOWS\n#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif",pointCloudVertex:"#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",logDepthVertex:"#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",helperFunctions:"const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nvec3 applyEaseInOut(vec3 x){\nreturn x*x*(3.0-2.0*x);\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=max(0.0000001,max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D); \n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}",lightFragmentDeclaration:"#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#else\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif",lightsFragmentFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}",lightUboDeclaration:"#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec3 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X}; \n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif",defaultVertexDeclaration:"\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",defaultFragmentDeclaration:"uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_SKYBOX\n#else\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif",defaultUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor; \nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix; \nvec4 vTangentSpaceParams;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nfloat pointSize; \n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};",shadowsFragmentFunctions:"#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#endif\n#endif\n",fresnelFunction:"#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",reflectionFunction:"#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\n#endif\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvec3 direction=normalize(vDirectionW);\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y; \n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nreturn vec3(1.0-s,t,0);\n#else\nreturn vec3(s,t,0);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y; \nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=normalize(worldPos.xyz-vEyePosition.xyz);\n\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,vReflectionSize,vReflectionPosition);\n#endif\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}",imageProcessingDeclaration:"#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif",imageProcessingFunctions:"#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=clamp(color,0.0,1.0);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=clamp(result.rgb,0.0,1.0);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=applyEaseInOut(result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}",bumpFragmentFunctions:"#ifdef BUMP\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=vTangentSpaceParams.x;\nbitangent*=vTangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\nmap=map*2.0-1.0;\n#ifdef NORMALXYSCALE\nmap=normalize(map*vec3(vBumpInfos.y,vBumpInfos.y,1.0));\n#endif\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif",clipPlaneFragmentDeclaration:"#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif",fogFragmentDeclaration:"#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",clipPlaneFragment:"#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif",bumpFragment:"vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else \nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW); \n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif",lightFragment:"#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))\n\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\nspotInfo=computeSpotLightingInfo(light{X}.vLightData);\n#ifdef LIGHT_FALLOFF_GLTF{X}\nspotInfo.attenuation=computeDistanceLightFalloff_GLTF(spotInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\nspotInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\nspotInfo.attenuation=computeDistanceLightFalloff_Physical(spotInfo.lightDistanceSquared);\nspotInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\nspotInfo.attenuation=computeDistanceLightFalloff_Standard(spotInfo.lightOffset,light{X}.vLightFalloff.x);\nspotInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\nspotInfo.attenuation=computeDistanceLightFalloff(spotInfo.lightOffset,spotInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\nspotInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\ninfo=computeSpotLighting(spotInfo,viewDirectionW,normalW,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(POINTLIGHT{X})\npointInfo=computePointLightingInfo(light{X}.vLightData);\n#ifdef LIGHT_FALLOFF_GLTF{X}\npointInfo.attenuation=computeDistanceLightFalloff_GLTF(pointInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npointInfo.attenuation=computeDistanceLightFalloff_Physical(pointInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npointInfo.attenuation=computeDistanceLightFalloff_Standard(pointInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npointInfo.attenuation=computeDistanceLightFalloff(pointInfo.lightOffset,pointInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\ninfo=computePointLighting(pointInfo,viewDirectionW,normalW,light{X}.vLightDiffuse.rgb,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(DIRLIGHT{X})\ninfo=computeDirectionalLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCLOSEESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif\n#endif\n#endif",logDepthFragment:"#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",fogFragment:"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",pbrVertexDeclaration:"uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n",pbrFragmentDeclaration:"uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif",pbrUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec4 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec4 vRefractionInfos;\nuniform vec2 vReflectionInfos;\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 refractionMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float pointSize;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};",pbrFunctions:"\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor)\n{\nroughness=max(roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nvec3 fresnel=fresnelSchlickGGX(VdotH,reflectance0,reflectance90);\nreturn fresnel*specTerm;\n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel*NdotL/PI;\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n\n\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=clamp(reflectance0*25.0,0.0,1.0);\nreturn reflectance90;\n}\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nfloat microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn clamp(square(temp)-1.0+ambientOcclusion,0.0,1.0);\n}\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal) {\n\nvec3 reflection=reflect(view,normal);\nfloat temp=clamp( 1.0+1.1*dot(reflection,normal),0.0,1.0);\nreturn square(temp);\n}",harmonicsFunctions:"#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 quaternionVectorRotation_ScaledSqrtTwo(vec4 Q,vec3 V){\nvec3 T=cross(Q.xyz,V);\nT+=Q.www*V;\nreturn cross(Q.xyz,T)+V;\n}\nvec3 environmentIrradianceJones(vec3 normal)\n{\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif",pbrLightFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nstruct pointLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat attenuation;\n};\nstruct spotLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nvec3 directionToLightCenterW;\nfloat attenuation;\n};\nfloat computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/((lightDistanceSquared+0.001));\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nconst float minDistanceSquared=0.01*0.01;\nfloat lightDistanceFalloff=1.0/(max(lightDistanceSquared,minDistanceSquared));\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=clamp(1.0-factor*factor,0.,1.);\nattenuation*=attenuation;\n\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\n\n\n\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=clamp(cd*lightAngleScale+lightAngleOffset,0.,1.);\n\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}\npointLightingInfo computePointLightingInfo(vec4 lightData) {\npointLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nreturn result;\n}\nspotLightingInfo computeSpotLightingInfo(vec4 lightData) {\nspotLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.directionToLightCenterW=normalize(result.lightOffset);\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nreturn result;\n}\nlightingInfo computePointLighting(pointLightingInfo info,vec3 viewDirectionW,vec3 vNormal,vec3 diffuseColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\nfloat lightDistance=sqrt(info.lightDistanceSquared);\nvec3 lightDirection=normalize(info.lightOffset);\n\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*info.attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor*info.attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(spotLightingInfo info,vec3 viewDirectionW,vec3 vNormal,vec4 lightDirection,vec3 diffuseColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\n\nfloat lightDistance=sqrt(info.lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+info.directionToLightCenterW);\nNdotL=clamp(dot(vNormal,info.directionToLightCenterW),0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*info.attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor*info.attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeDirectionalLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\nfloat lightDistance=length(-lightData.xyz);\nvec3 lightDirection=normalize(-lightData.xyz);\n\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nNdotL=clamp(NdotL,0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}",clipPlaneVertexDeclaration2:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif",clipPlaneFragmentDeclaration2:"#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif",mrtFragmentDeclaration:"#if __VERSION__>=200\nlayout(location=0) out vec4 glFragData[{X}];\n#endif\n",bones300Declaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nin vec4 matricesIndices;\nin vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nin vec4 matricesIndicesExtra;\nin vec4 matricesWeightsExtra;\n#endif\n#endif",instances300Declaration:"#ifdef INSTANCES\nin vec4 world0;\nin vec4 world1;\nin vec4 world2;\nin vec4 world3;\n#else\nuniform mat4 world;\n#endif",kernelBlurFragment:"#ifdef DOF\nfactor=sampleCoC(sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif",kernelBlurFragment2:"#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});\ncomputedWeight=KERNEL_DEP_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif",kernelBlurVaryingDeclaration:"varying vec2 sampleCoord{X};",kernelBlurVertex:"sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",backgroundVertexDeclaration:"uniform mat4 view;\nuniform mat4 viewProjection;\nuniform float shadowLevel;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif",backgroundFragmentDeclaration:" uniform vec4 vPrimaryColor;\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nuniform vec4 vPrimaryColorShadow;\n#endif\nuniform float shadowLevel;\nuniform float alpha;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif",backgroundUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec4 vPrimaryColor;\nuniform vec4 vPrimaryColorShadow;\nuniform vec2 vDiffuseInfos;\nuniform vec2 vReflectionInfos;\nuniform mat4 diffuseMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\nuniform float pointSize;\nuniform float shadowLevel;\nuniform float alpha;\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};"};var l="undefined"!=typeof global?global:"undefined"!=typeof window?[]:this;return l.BABYLON=s,void 0!==i&&(l.Earcut={earcut:i}),s}));var t,i,r,n,a,o,s,l,c,u,h,d,p,m,_,f,g,y,v,x,S,T,E,P,A,M,C,R,w,I,O=void 0,D=!1,k=!1,B=!1,F="",L={},N=!1,V=!1,G=null,U=null,z=!1,H=null,W={},j=!1,X=null,Y={},K=!1,Q=!1,Z=!1,q=null,J=null,$=null,ee=!1,te=!1,ie=[],re={},ne=0,ae=null,oe=null,se=!1,le=[],ce=document.createElement("canvas"),ue=!1,he=!0,de=navigator.language;const pe=parsedUrl.query.debug;let me=null;var _e=!0,fe="",ge=!1,ye=null,ve=!1;var be=!1,xe=null,Se=!1,Te=!1,Ee=!1,Pe=null;let Ae;var Me=!1;let Ce;var Re,we=!1,Ie=!1,Oe=null,De={discord:0,ticTok:0};const ke={},Be=["midMonthGiveMeEggs","newYolkerSignupReward","newYolkerItemReward","newYolkerWelcomeBack","WelcomeBack","mercZoneFinalGift"],Fe={premFeatOne:0,premFeatTwo:0};var Le={text:["rgba(254,216,56,1)","rgba(64, 224, 255, 1)","rgba(255, 192, 160, 1)"],meBackground:["rgba(255, 192, 64, 0.75)","rgba(0, 192, 255, 0.8)","rgba(192, 64, 32, 0.8)"],themBackground:["rgba(0, 0, 0, 0.25)","rgba(0, 64, 192, 0.3)","rgba(192, 64, 32, 0.3)"],summaryBackground:["rgba(64, 64, 64, 0.75)","rgba(0, 64, 192, 0.75)","rgba(192, 64, 32, 0.75)"],outline:[new t.Color4(1,1,1,0),new t.Color4(0,.75,1,1),new t.Color4(1,.25,.25,1)],textColor:[new t.Color4(1,1,1,1),new t.Color4(0,.75,1,1),new t.Color4(1,.25,.25,1)],meClass:["playerSlot-me","playerSlot-me-blue","playerSlot-me-red"],themClass:["playerSlot-them","playerSlot-them-blue","playerSlot-them-red"]};const Ne={isCaseSensitive:!1,includeScore:!0,shouldSort:!0,includeMatches:!0,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.2,distance:100,useExtendedSearch:!0,keys:["name","unlock","item_data.tags","item_data.meshName"]},Ve=[{version:"0.46.1",date:"October 16",content:["It's time for the latest update! It's time to Get Ghosted!","Shock - More long awaited and fearsome Halloween skins have been added to your candy shop","Horror - Edits have been made to the chat filter to keep the ghouls at bay","This is Halloween - The Skellington RPEGG has been added to the store & free to VIPs","Congrats to Infinite Smasher - Their amazing Blue Wizard Logo Pumpkin Design placed in a discord comp & is now in the game!","Spooktacular versions of MORE of your favourite maps are haunting the servers!","Moved Jailbreak, Palace Seige, Backstage, and Castle to the public map pool","Moved Stage, Aqueduct, 4 Quarters, Shipyard, Two Towers, Crowsnest and Quarry to the private map pool"]}],Ge=Ve[__uv.$wrap((0))].version;var Ue=[{itemIds:null,sku:"egg_pack_small",name:"Small Pack",price:3,salePrice:5,flagText:"",type:"currency",inStore:1,currency:3e4,isActive:!0},{itemIds:null,sku:"egg_pack_medium",name:"Medium Pack",price:6,salePrice:10,flagText:"",type:"currency",inStore:1,currency:65e3,isActive:!0},{itemIds:null,sku:"egg_pack_large",name:"Large Pack",price:12,salePrice:20,flagText:"",type:"currency",inStore:1,currency:15e4,isActive:!0},{itemIds:null,sku:"egg_pack_giant",name:"Giant Pack",price:50,salePrice:25,flagText:"p_egg_shop_bestvalue",type:"currency",inStore:0,currency:5e4,isActive:!0},{itemIds:null,sku:"golden_chicken_pass",name:"Golden Chicken Pass",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1},{itemIds:null,sku:"chicken_nugget_pass",name:"Chicken Nugget Pass",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1},{itemIds:null,sku:"test_nugget_pass",name:"Test Nugget",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1},{itemIds:[4223],sku:"item_gun_m24_techno",name:"Untz Untz Gun",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1112],sku:"item_hat_yolk_arms",name:"Yolk Arms",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1105],sku:"item_hat_cape",name:"Magic Cape",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1092],sku:"item_hat_dragon",name:"GoE Dragon",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1110],sku:"item_hat_space_gladi",name:"Space Gladiator",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1126],sku:"item_hat_zombie_mask",name:"Zombie Mask",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3016],sku:"item_gun_9mm_space",name:"Cluck 9mm Space Egg",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1125],sku:"item_hat_oni",name:"Oni Hat",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3416],sku:"item_gun_csg1_space",name:"CSG1 Space Egg Skin",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1160],sku:"item_hat_galeggsy",name:"Galeggsy Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3025],sku:"item_gun_9mm_techno",name:"Cluck 9mm Techno",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1171],sku:"item_hat_rooter_wing",name:"Rooster Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4026],sku:"item_gun_smg_techno",name:"Tuh SMG",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1174],sku:"item_hat_demon_wings",name:"Demon Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3627],sku:"gun_gauge_techno",name:"Badoosh Dozen Gauge",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1184],sku:"item_hat_fallen_wing",name:"Fallen Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3426],sku:"item_gun_csg1_techno",name:"CSG1 Techno Catz",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1185,2204,16011],sku:"1oOnkjL7",name:"1 month membership",price:699,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!0},{itemIds:[1185,2204,16011],sku:"K5JjxL1z",name:"3 month membership",price:1499,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!0},{itemIds:[1185,2204,16011],sku:"TymKKdoQ",name:"12 month membership",price:4999,salePrice:null,flagText:"p_egg_shop_bestvalue",type:"subscription",inStore:0,currency:0,isActive:!0},{itemIds:[1185,2204,16011],sku:"item_hat_golden_wing",name:"Golden Wings",price:null,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1186],sku:"item_hat_chrome_wing",name:"Chrome Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3126],sku:"gun_eggk47_techno",name:"Eggk Poggers",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1193],sku:"item_hat_steamWings",name:"Steampunk Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3828],sku:"item_gun_rpeggTechno",name:"RPEGGTechno",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3029],sku:"item_gun_retro_9mm",name:"Retro Skin Cluck9mm",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1195],sku:"item_hat_pixel_wings",name:"Angel Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16014],sku:"item_gre_skullnado",name:"Skullnado",price:7,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1202],sku:"item_hat_skull_wings",name:"Skull Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4512],sku:"item_gun_aug_retro",name:"Retro TriHard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1215],sku:"item_hat_robot_wings",name:"Robot Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16019],sku:"item_gre_unicorn",name:"Unicorn Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1222],sku:"item_hat_uni_wing",name:"Unicorn Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4229],sku:"item_gun_m24_retro",name:"M2DZ Retro Skin",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1226],sku:"item_hat_fairy_wings",name:"Fairy Pixel Wings",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16023],sku:"item_gre_toilet_papr",name:"Grenade Toilet Paper",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1232],sku:"item_hat_toilet_papr",name:"Hat Toilet Paper",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3431],sku:"item_gun_csg1_retro",name:"CSG1 Retro",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1235],sku:"item_hat_pixel_fire",name:"Fire Pixel Wings",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16027],sku:"item_gre_glitterbomb",name:"Grenade Glitterbomb",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1241],sku:"item_hat_glitch_wing",name:"Glitch Wings",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3634],sku:"item_gun_crack_retro",name:"Scrambler Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1245],sku:"item_hat_moth_wings",name:"Moth Pixel Wings",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16032],sku:"item_gre_thermal",name:"Grenade Thermal Detonator",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1248],sku:"hat_thermal_wings",name:"Thermal Wings",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4032],sku:"item_gun_smg_retro",name:"SMEGG Retro",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1269],sku:"item_hat_pixel_butt",name:"Pixel Butterfly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1272],sku:"item_hat_pixel_bird",name:"Pixel Bird Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16036],sku:"item_gre_supernova",name:"Grenade Supernova",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16038],sku:"item_gre_octopus",name:"Grenade Octopus",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3835],sku:"item_gun_rpegg_retro",name:"RPEGG Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1212],sku:"item_hat_dog_cap",name:"Dog Cap",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1044],sku:"item_hat_egg_glasses",name:"Egg Glasses",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1288],sku:"item_hat_luckywings",name:"Lucky Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1290],sku:"item_hat_ukraine",name:"Ukraine Bandana",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3637],sku:"item_gun_bros",name:"Dozen Gauge Bros",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4528],sku:"item_gun_valk_aug",name:"Trihard Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16041],sku:"item_gre_diablo",name:"Grenade Diablo",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3134],sku:"item_gun_ak_retro",name:"Eggk47 Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3136],sku:"item_gun_ak_valkyrie",name:"Eggk47 Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1312],sku:"item_hat_dinowings",name:"Dino Pterodactyl Win",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1316],sku:"item_hat_airplane",name:"Airplane Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1320],sku:"item_hat_crosswing",name:"Cross Fighter",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16044],sku:"item_gre_bumble",name:"Grenade Bumblebee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3642],sku:"item_gauge_valk",name:"Valkyrie Scrambler",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16046],sku:"item_gre_football",name:"Grenade Football",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16048],sku:"item_gre_valk",name:"Grenade Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3439],sku:"item_csg1_rubchick",name:"CSG1 Rubber Chicken",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16049],sku:"item_gre_milk",name:"Grenade Milk",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4240],sku:"item_gun_m24_scav",name:"Crackshot Scavenger",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3045],sku:"item_gun_9mm_valk",name:"Cluck 9mm Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1341],sku:"item_hat_rainbow",name:"Rainbow Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3441],sku:"item_range_valk",name:"Free-Ranger Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1349],sku:"item_hat_teggtris",name:"Teggtris wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16054],sku:"item_gre_blood",name:"Grenade Blood",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1356],sku:"item_hat_bloodwing",name:"Blood Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3843],sku:"item_gun_rpegg_valk",name:"RPEGG Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4040],sku:"item_gun_smg_turk",name:"Turkey-Supreme Whipp",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4242],sku:"item_gun_m24_valk",name:"Crackshot Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1363],sku:"item_hat_fall",name:"Fall Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3844],sku:"item_rpegg_christ",name:"RPEGG Santa Boot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1369],sku:"item_holy_wings",name:"Holly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4042],sku:"item_gun_smg_valk",name:"Whipper Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1372,3650],sku:"item_jan_2023",name:"Jan2023 Bundle",price:10,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[3443],sku:"item_csg1_fusion",name:"Free-Ranger Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1372],sku:"item_hat_soundwave",name:"Sound Wave Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3650],sku:"item_gauge_octopus",name:"Octopus Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3050],sku:"item_9mm_cloud",name:"Cluck 9mm Clouds",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3142],sku:"item_ak47_fusion",name:"Eggk47 Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16059],sku:"item_gre_pail",name:"Slop Bucket Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1389],sku:"item_hat_harp",name:"Harp Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4044],sku:"item_smg_fusion",name:"Whipper Fusion",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1394],sku:"item_hat_hooped",name:"Hooped",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3654],sku:"item_gauge_monster",name:"Beholder Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1400],sku:"item_qwings",name:"Question Block Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3054],sku:"item_9mm_fusion",name:"Cluck 9mm Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[15023],sku:"item_melee_stone",name:"Stone Hammer Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3445],sku:"item_csg1_shellpreme",name:"Free-Ranger Shellpre",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3655],sku:"item_gauge_fusion",name:"Fusion Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3055],sku:"item_9mm_camera",name:"Cluck 9mm Camera",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1417],sku:"item_hat_surf",name:"Octopus Surfboard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[15013],sku:"item_melee_valk",name:"Melee Valkyrie",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[15030],sku:"item_melee_fusion",name:"The Fusion Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1423],sku:"item_hat_scales",name:"Scales of Justice",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1225,3420,4208,16013],sku:"bun_master_items",name:"Master items",price:10,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[4540],sku:"item_aug_fusion",name:"Fusion Trihard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1428],sku:"item_hat_glider",name:"Glider Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16064],sku:"item_gre_timebomb",name:"Timebomb Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1349,2157,3029,4039],sku:"bun_gamer",name:"Gamer Bundle",price:8,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[1185,2204,16011],sku:"kD7geYv2",name:"12 month membership",price:4999,salePrice:null,flagText:"p_egg_shop_bestvalue",type:"subscription",inStore:0,currency:0,isActive:!1},{itemIds:[1185,2204,16011],sku:"gCLa2qqV",name:"1 month membership",price:699,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!1},{itemIds:[1185,2204,16011],sku:"x0iYBjs4",name:"3 month membership",price:1499,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!1},{itemIds:[15037],sku:"item_melee_cat",name:"Harrison Cat Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3059],sku:"item_9mm_mega",name:"Megaphone Cluck 9mm",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1118,2242,3060,15040],sku:"bun_cat",name:"Cats Pajamas Bundle",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[1445],sku:"item_hat_wbs",name:"The Grand Entrance W",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4248],sku:"item_m24_fusion",name:"The Fusion Crackshot",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1450],sku:"item_hat_demonpixel",name:"Demon Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3951],sku:"item_rpegg_fusion",name:"Fusion RPEGG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1031,2454,3035,16054],sku:"bun_demon",name:"Demonic Bundle",price:4,salePrice:null,flagText:"",type:"bundle",inStore:1,currency:0,isActive:!0},{itemIds:[3952],sku:"item_rpegg_skele",name:"Skellington RPEGG",price:5,salePrice:null,flagText:"",type:"item",inStore:1,currency:0,isActive:!0},{itemIds:[3149],sku:"item_ak_infernal",name:"Infernal Eggk47",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0}],ze=[{id:1001,name:"Ball Cap",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ballCap",tags:["Green","White"]},is_available:!0,unlock:"default"},{id:1002,name:"Boat Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boatHat",tags:["Blue","Yellow"]},is_available:!0,unlock:"default"},{id:1003,name:"Top Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_topHat",tags:["Black","Grey","Gray"]},is_available:!0,unlock:"default"},{id:1004,name:"Derby Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_derby",tags:["Orange","Brown"]},is_available:!0,unlock:"default"},{id:1005,name:"Mountie Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mounty",tags:["Brown","Police"]},is_available:!0,unlock:"default"},{id:1006,name:"Pablo Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowSheriff",tags:["Orange","Brown","Police","Meme"]},is_available:!0,unlock:"default"},{id:1007,name:"Blue Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaBlue",tags:["Blue"]},is_available:!0,unlock:"purchase"},{id:1008,name:"Hero Mask",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batman",tags:["Black","Brown","Blue"]},is_available:!0,unlock:"purchase"},{id:1009,name:"Cop Hat",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cop",tags:["Blue","Gold","Black"]},is_available:!0,unlock:"purchase"},{id:1010,name:"Robber Mask",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg2",tags:["Black","Purple"]},is_available:!1,unlock:"purchase"},{id:1011,name:"Red Bandana",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaRed",tags:["Red"]},is_available:!0,unlock:"purchase"},{id:1012,name:"Pink Bow",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bowPink",tags:["Pink"]},is_available:!0,unlock:"purchase"},{id:1013,name:"Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glasses",tags:["Black"]},is_available:!0,unlock:"purchase"},{id:1014,name:"Pompadour",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pompadour",tags:["Black","Hair"]},is_available:!0,unlock:"purchase"},{id:1015,name:"Plague Doctor Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_plagueDoctor",tags:["Black"]},is_available:!0,unlock:"purchase"},{id:1016,name:"Poop Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_poop",tags:["Brown","Yellow","Gold","Poop"]},is_available:!0,unlock:"purchase"},{id:1017,name:"Unicorn Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_unicorn",tags:["Red","Orange","Yellow","Green","Blue","Silver","Rainbow"]},is_available:!0,unlock:"purchase"},{id:1018,name:"Baws Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pimp",tags:["Black","White","Grey","Gray","Purple"]},is_available:!0,unlock:"purchase"},{id:1019,name:"Pirate Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pirateHat",tags:["Black","Red"]},is_available:!0,unlock:"purchase"},{id:1023,name:"Hunting Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hunting",tags:["Red"]},is_available:!0,unlock:"purchase"},{id:1024,name:"Hunting Bear Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_huntingBear",tags:["Pink","Heart","Cute"]},is_available:!0,unlock:"purchase"},{id:1025,name:"Crown",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crown",tags:["Gold","Red","Royal"]},is_available:!0,unlock:"purchase"},{id:1020,name:"ShellShockers Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shellshockers",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_hat",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/splat-hat",tags:["White","Brown","Egg"]},is_available:!1,unlock:"physical"},{id:1021,name:"Frying Pan",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fryingPan",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_pan",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/no-pans-tee",tags:["Black","Silver"]},is_available:!1,unlock:"physical"},{id:1022,name:"Viking Horns",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_horns",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_shirt",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/logo-tee",tags:["Brown","Bone"]},is_available:!1,unlock:"physical"},{id:1026,name:"Jack O' Lantern Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkin",tags:["Halloween","Oct23","Orange"]},is_available:!0,unlock:"purchase"},{id:1027,name:"Bat Wings",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batWings",tags:["Halloween","Oct23","Black"]},is_available:!0,unlock:"purchase"},{id:1028,name:"Witch Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_witch",tags:["Halloween","Purple","Gold","Oct23","Black"]},is_available:!0,unlock:"purchase"},{id:1029,name:"Axe-in-head",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_axe",tags:["Halloween","Oct23","Red","Brown","Wood"]},is_available:!0,unlock:"purchase"},{id:1030,name:"Executioner's Cowl",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_executioner",tags:["Halloween","Oct23","Red","Black"]},is_available:!0,unlock:"purchase"},{id:1031,name:"Devil Horns",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_devilHorns",tags:["Halloween","Oct23","Red"]},is_available:!0,unlock:"purchase"},{id:1032,name:"Angel Wings & Halo",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angel",tags:["Halloween","Oct23","Gold","White"]},is_available:!0,unlock:"purchase"},{id:1033,name:"Hockey Mask",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hockeyMask",tags:["Halloween","Oct23","Black","White"]},is_available:!0,unlock:"purchase"},{id:1034,name:"Pilgrim Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pilgrim",tags:["Thanksgiving","Black","Brown","Gold"]},is_available:!1,unlock:"purchase"},{id:1035,name:"Cooked Turkey Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turkeyDead",tags:["Thanksgiving","Brown"]},is_available:!1,unlock:"purchase"},{id:1036,name:"Turkey Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turkeyAlive",tags:["Thanksgiving","Brown","Red"]},is_available:!1,unlock:"purchase"},{id:1037,name:"Golden Chicken Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_Top1Percent",tags:["Reward","RewardTopPercent","Gold"]},is_available:!1,unlock:"manual"},{id:1038,name:"Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier1",tags:["Reward","RewardKills","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:1039,name:"Bronze Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier2",tags:["Reward","RewardKills","Red","Brown"]},is_available:!1,unlock:"manual"},{id:1040,name:"Silver Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier3",tags:["Reward","RewardKills","Gray","Blue"]},is_available:!1,unlock:"manual"},{id:1041,name:"Gold Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier4",tags:["Reward","RewardKills","Gold","Yellow"]},is_available:!1,unlock:"manual"},{id:1042,name:"Cracked Egg Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier1",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual"},{id:1043,name:"Egg Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier2",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual"},{id:1044,name:"Egg Glasses",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier3",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_egg_glasses"]},{id:1045,name:"Cracked Egg Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier4",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual"},{id:1046,name:"Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier1",tags:["Reward","RewardKDR","Bone"]},is_available:!1,unlock:"manual"},{id:1047,name:"Bronze Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier2",tags:["Reward","RewardKDR","Red","Brown"]},is_available:!1,unlock:"manual"},{id:1048,name:"Silver Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier3",tags:["Reward","RewardKDR","Silver","Blue"]},is_available:!1,unlock:"manual"},{id:1049,name:"Gold Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier4",tags:["Reward","RewardKDR","Yellow","Gold"]},is_available:!1,unlock:"manual"},{id:1050,name:"Golden Egg Trophy",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier1",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1051,name:"Golden Faberge Egg Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier2",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1052,name:"Dollar Sign Glasses",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier3",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1053,name:"Golden Baws Hat",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier4",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1054,name:"Nate's Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headphones",tags:["Nate","Green","Black"]},is_available:!1,unlock:"manual"},{id:1055,name:"Reindeer Antlers",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_reindeer",tags:["Christmas","Green","Red","Brown"]},is_available:!1,unlock:"purchase"},{id:1056,name:"Elf Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_elf",tags:["Christmas","Green","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:1057,name:"Santa Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santa",tags:["Christmas","White","Red"]},is_available:!1,unlock:"purchase"},{id:1058,name:"Party Hat 2019",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party",tags:["NewYears2019","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase"},{id:1059,name:"Headband 2019",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2019",tags:["NewYears2019","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase"},{id:1060,name:"Happy New Yolk Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_newYolk",tags:["NewYears","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase"},{id:1061,name:"Ski Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg1",tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:1062,name:"Pirate Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaPirate",tags:["Newsletter","Red"]},is_available:!1,unlock:"manual"},{id:1063,name:"Colander Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_colander",tags:["Newsletter","Red"]},is_available:!1,unlock:"manual"},{id:1064,name:"Hamburger Earmuffs",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_earmuffsHamburger",tags:["Newsletter","Brown","Pickles"]},is_available:!1,unlock:"manual"},{id:1065,name:"Fez Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fez",tags:["Newsletter","Red","Gold"]},is_available:!1,unlock:"manual"},{id:1066,name:"Blue Wizard Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_blueWizard",tags:["Newsletter","Blue"]},is_available:!1,unlock:"manual"},{id:1067,name:"Chef Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chef",tags:["Newsletter","White"]},is_available:!1,unlock:"manual"},{id:1068,name:"Jester Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_jester",tags:["Newsletter","Black","Gold"]},is_available:!1,unlock:"manual"},{id:1069,name:"Straw Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_straw",tags:["Newsletter","Blue","Gold"]},is_available:!1,unlock:"manual"},{id:1070,name:"Spring Sapling Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spring",tags:["Groundhog","Feb23","Green","Brown"]},is_available:!1,unlock:"purchase"},{id:1071,name:"Winter Sapling Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winter",tags:["Groundhog","Feb23","White","Brown"]},is_available:!1,unlock:"purchase"},{id:1072,name:"Groundhog Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:1073,name:"Skull Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaSkull",tags:["Promotional","Black"]},is_available:!1,unlock:"manual"},{id:1074,name:"Firefighter Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fireFighter",tags:["Promotional","Red"]},is_available:!1,unlock:"manual"},{id:1075,name:"Sunglasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sunglasses",tags:["Promotional","Black"]},is_available:!1,unlock:"manual"},{id:1076,name:"Monocle",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_monocle",tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:1077,name:"Gas Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gasMask",tags:["Promotional","Black","Green"]},is_available:!1,unlock:"manual"},{id:1078,name:"Aviator Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_aviator",tags:["Promotional","Brown"]},is_available:!1,unlock:"manual"},{id:1079,name:"Red Goggles",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gogglesRed",tags:["Promotional","Black"]},is_available:!1,unlock:"manual"},{id:1080,name:"Astronaut Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_astronaut",tags:["Promotional","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:1081,name:"Heart Glasses",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesHeart",tags:["ValentinesDay","Pink","Red"]},is_available:!1,unlock:"purchase"},{id:1082,name:"Baws Fedora",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fedoraPimp",tags:["ValentinesDay","Pink","Brown"]},is_available:!1,unlock:"purchase"},{id:1083,name:"Valentine's Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_valentines",tags:["ValentinesDay","Red"]},is_available:!1,unlock:"purchase"},{id:1084,name:"Shamrock Glasses",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesShamrock",tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:1085,name:"Pot O' Gold Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_potOfGold",tags:["StPatricksDay","MarM23","Black","Gold"]},is_available:!1,unlock:"purchase"},{id:1086,name:"Leprechaun Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leprechaun",tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:1087,name:"Bunny Ears",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bunnyEars",tags:["Easter","White","Pink"]},is_available:!1,unlock:"purchase"},{id:1088,name:"Egg Nest",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggNest",tags:["Easter","Brown","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:1089,name:"Egg Basket",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggBasket",tags:["Easter","Brown"]},is_available:!1,unlock:"purchase"},{id:1090,name:"Egg Crown",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggCrown",tags:["Easter","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1091,name:"GoE Ice Crown",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_iceCrown",tags:["GameOfEggs","Blue"]},is_available:!0,unlock:"purchase"},{id:1092,name:"GoE Dragon",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dragon",tags:["GameOfEggs","May23"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_dragon"]},{id:1093,name:"Green Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaGreen",tags:["Green"]},is_available:!0,unlock:"purchase"},{id:1094,name:"Mohawk Hair",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_moHawk",tags:["Purple","Pink"]},is_available:!0,unlock:"purchase"},{id:1095,name:"Bihawk Hair",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_biHawk",tags:["Green","Yellow"]},is_available:!0,unlock:"purchase"},{id:1096,name:"Trihawk Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_triHawk",tags:["Red","Yellow"]},is_available:!0,unlock:"purchase"},{id:1097,name:"Pigtails Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pigtails",tags:["Yellow","Blue"]},is_available:!0,unlock:"purchase"},{id:1098,name:"Side Pony",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sidePony",tags:["Black","Pink","Hair"]},is_available:!0,unlock:"purchase"},{id:1099,name:"Egg Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggHelmet",tags:["Aveggers","Gold","Bone"]},is_available:!1,unlock:"purchase"},{id:1100,name:"Fohawk Wig",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_arrow",tags:["Aveggers","Brown","Black"]},is_available:!1,unlock:"purchase"},{id:1101,name:"American Bandana",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaAmerica",tags:["Aveggers","JulyM23","Red","White","Blue"]},is_available:!1,unlock:"purchase"},{id:1102,name:"Bike Helmet",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bikeHelmet",tags:["Aveggers","Red","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1103,name:"Bucket Hero Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bucketMan",tags:["Aveggers","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1104,name:"Bug Mask",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bugMask",tags:["Aveggers","Jun23","Red","Brown"]},is_available:!1,unlock:"purchase"},{id:1105,name:"Magic Cape",price:1,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cape",tags:["Aveggers","Jun23","Red","Purple","Pink"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_cape"]},{id:1106,name:"Eyepatch",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eyepatch",tags:["Aveggers","May23","Black"]},is_available:!1,unlock:"purchase"},{id:1107,name:"Panther Mask",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pantherMask",tags:["Aveggers","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:1108,name:"Red Hair Wig",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_redHair",tags:["Aveggers","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1109,name:"Helmet of Sight",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sightHelmet",tags:["Aveggers","Purple","Black"]},is_available:!1,unlock:"purchase"},{id:1110,name:"Space Gladiator Hat",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceGladiator",tags:["Aveggers","JunM23","Red","Brown"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_space_gladi"]},{id:1111,name:"Spider Mask",price:12e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spiderMask",tags:["Aveggers","Sep23","Red","Black","White"]},is_available:!1,unlock:"purchase"},{id:1112,name:"Yolk Arms Hat",price:1,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_yolkArms",tags:["Aveggers","Mar23","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_yolk_arms"]},{id:1113,name:"Guy Fawkes Mask",price:1105,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fawkes",tags:["Bone"]},is_available:!0,unlock:"purchase"},{id:1114,name:"Birthday Hat 1",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_birthday1",tags:["HappyBirthday","Yellow","Red","Blue"]},is_available:!0,unlock:"purchase"},{id:1115,name:"Birthday Hat 2",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_birthday2",tags:["HappyBirthday","Red","Blue"]},is_available:!0,unlock:"purchase"},{id:1116,name:"Birthday Cake Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cake",tags:["HappyBirthday","Red","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:1117,name:"League Staff Sash",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leagueStaff",tags:["League","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:1118,name:"Cat Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cat",tags:["Orange","Black","Cat"]},is_available:!0,unlock:"purchase"},{id:1119,name:"Egg Shell Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggshell",tags:["Bone"]},is_available:!0,unlock:"purchase"},{id:1120,name:"Dino Shell Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinoShell",tags:["Orange","Brown"]},is_available:!1,unlock:"purchase"},{id:1121,name:"Penguin Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_penguin",tags:["Black","White"]},is_available:!0,unlock:"purchase"},{id:1122,name:"Pot Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pot",tags:["Black","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:1123,name:"Tiny Tophat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tophatTiny",tags:["Black","Red"]},is_available:!0,unlock:"purchase"},{id:1124,name:"Nurse Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_nurse",tags:["White","Red"]},is_available:!0,unlock:"purchase"},{id:1125,name:"Oni Hat",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oni",tags:["Sidearms","White","Red","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_oni"]},{id:1126,name:"Zombie Mask",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_zombieMask",tags:["July23","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_zombie_mask"]},{id:1127,name:"Cinnamon Bun Hair",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cinnamonBun",tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:1128,name:"Bounty Egger",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bountyEgger",tags:["Eggwalker","Green","Black"]},is_available:!1,unlock:"purchase"},{id:1129,name:"Good Robes Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goodRobes",tags:["Eggwalker","Brown","Red"]},is_available:!1,unlock:"purchase"},{id:1130,name:"Bad Robes Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badRobes",tags:["Eggwalker","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1131,name:"Space Emo Hair",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceEmo",tags:["Eggwalker","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1132,name:"Space Monk Cloak",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceMonk",tags:["Eggwalker","Blue","Bone"]},is_available:!1,unlock:"purchase"},{id:1133,name:"Eggperor Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggperor",tags:["Eggwalker","Black","Yellow","Meme"]},is_available:!1,unlock:"purchase"},{id:1134,name:"BBEgg Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bbEgg",tags:["Eggwalker","Orange","White"]},is_available:!1,unlock:"purchase"},{id:1135,name:"C3PYolk Mask",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c3pYolk",tags:["Eggwalker","Rainbow","Gold"]},is_available:!1,unlock:"purchase"},{id:1136,name:"2020 Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2020",tags:["NewYears2020","Yellow","White"]},is_available:!1,unlock:"purchase"},{id:1137,name:"Eggy Cash Ensemble",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggyCash",tags:["EggyCash","Brown","Black"]},is_available:!0,unlock:"purchase"},{id:1138,name:"Soda Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_drinkdew",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1139,name:"Surgical Mask",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalMask",tags:["Surgical","Green"]},is_available:!0,unlock:"purchase"},{id:1140,name:"Surgical Mask White",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalWhite",tags:["Surgical","White"]},is_available:!0,unlock:"purchase"},{id:1141,name:"Surgical Mask Smile",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalSmile",tags:["Surgical","Black"]},is_available:!0,unlock:"purchase"},{id:1142,name:"Falcon Hunter Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_falconHunter",tags:["RaidLand","Yellow"]},is_available:!1,unlock:"purchase"},{id:1143,name:"Shadow Hunter Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shadowHunter",tags:["RaidLand","Mar23","Purple"]},is_available:!1,unlock:"purchase"},{id:1144,name:"Frost Berserker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frostBerserker",tags:["RaidLand","Blue"]},is_available:!1,unlock:"purchase"},{id:1145,name:"Grim Berserker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_grimBerserker",tags:["RaidLand","Blue","Gray"]},is_available:!1,unlock:"purchase"},{id:1146,name:"Golem Warrior Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_golemWarrior",tags:["RaidLand","Green"]},is_available:!1,unlock:"purchase"},{id:1147,name:"Immortal Warrior Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_immortalWarrior",tags:["RaidLand","Blue","Gray"]},is_available:!1,unlock:"purchase"},{id:1148,name:"Sheep Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sheep",tags:["Newsletter","White","Brown"]},is_available:!1,unlock:"manual"},{id:1149,name:"Blue Toxic  Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicBlue",tags:["Rotten","Blue","Green"]},is_available:!0,unlock:"purchase"},{id:1150,name:"Green Toxic Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicGreen",tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:1151,name:"Orange Toxic Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicOrange",tags:["Rotten","Orange","Green"]},is_available:!0,unlock:"purchase"},{id:1152,name:"Double Filter Gas Mask",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_doubleFilter",tags:["Black","Red"]},is_available:!0,unlock:"purchase"},{id:1153,name:"Brown Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar1",tags:["Rockstar","JanM23","Brown","Music"]},is_available:!1,unlock:"purchase"},{id:1154,name:"Black & Red Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar3",tags:["Rockstar","JanM23","Black","Red","Music"]},is_available:!1,unlock:"purchase"},{id:1155,name:"Black & White Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar2",tags:["Rockstar","JanM23","Black","White","Music"]},is_available:!1,unlock:"purchase"},{id:1156,name:"Umbrella Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_umbrella",tags:["Newsletter","Rainbow"]},is_available:!1,unlock:"manual"},{id:1157,name:"Star Glasses",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesStar",tags:["Galeggsy","AprM23","Pink"]},is_available:!1,unlock:"purchase"},{id:1158,name:"Star Bandana",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaStars",tags:["Galeggsy","AprM23","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:1159,name:"Alien Antennae",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headbandAlien",tags:["Galeggsy","AprM23","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:1160,name:"Galeggsy Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premiumButterfly",tags:["Galeggsy","AprM23","Purple","Pink"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_galeggsy"]},{id:1161,name:"Black Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZoneBlack",tags:["MercZone","Black","Suit"]},is_available:!1,unlock:"manual"},{id:1162,name:"Red Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZoneRed",tags:["MercZone","Red","Suit"]},is_available:!1,unlock:"manual"},{id:1163,name:"Pink Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZonePink",tags:["MercZone","Pink","Suit"]},is_available:!1,unlock:"manual"},{id:1164,name:"Academic Cap",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academic",tags:["Newsletter","Black","Yellow"]},is_available:!1,unlock:"manual"},{id:1166,name:"Fuzzy Earmuffs",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_earmuffs",tags:["Newsletter","Pink"]},is_available:!1,unlock:"manual"},{id:1167,name:"Chains Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chains",tags:["Newsletter","Gray"]},is_available:!1,unlock:"manual"},{id:1168,name:"Hen Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hen",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:1169,name:"Rooster Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rooster",tags:["Chicken","Brown","Red"]},is_available:!1,unlock:"purchase"},{id:1170,name:"Rooster Tail Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roosterTail",tags:["Chicken","Green"]},is_available:!1,unlock:"purchase"},{id:1171,name:"Rooster Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RoosterWings",tags:["MayM23","Chicken","Green","Red"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_rooter_wing"]},{id:1172,name:"Bee Wings",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_BeeWings",tags:["Rainbow","Pink","Green","Yellow"]},is_available:!0,unlock:"purchase"},{id:1173,name:"Jason Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_F13",tags:["f13","Bone","Red"]},is_available:!1,unlock:"manual"},{id:1174,name:"Demon Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DemonWings",tags:["Premium","Red","OctM23","premFeatOne"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_hat_demon_wings"]},{id:1175,name:"Among Egg Hat 1",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_01",tags:["AmongEgg","Blue","White","Meme"]},is_available:!0,unlock:"purchase"},{id:1176,name:"Among Egg Hat 2",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_02",tags:["AmongEgg","Blue","Meme"]},is_available:!1,unlock:"purchase"},{id:1177,name:"Among Egg Hat 3",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_03",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1178,name:"Among Egg Hat 4",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_04",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1179,name:"Among Egg Hat 5",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_05",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1180,name:"Among Egg Hat 6",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_06",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1181,name:"Among Egg Hat 7",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_07",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1182,name:"Eggolorian Helmet",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggolorianBig",tags:["Eggolorian","Brown"]},is_available:!0,unlock:"purchase"},{id:1183,name:"Toadstool Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toadstool",tags:["Newsletter","Red","White"]},is_available:!1,unlock:"manual"},{id:1184,name:"Fallen Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_FallenWings",tags:["Premium","FebM23","Gray","Brown"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_fallen_wing"]},{id:1185,name:"Golden Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_GoldenWings",tags:["Premium","vipItem","Gray","Silver"]},is_available:!1,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"]},{id:1186,name:"Chrome Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ChromeWings",tags:["July23","Gold","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_chrome_wing"]},{id:1187,name:"Wero Viking Hair",price:4e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wero",tags:["Wero","Brown"]},is_available:!0,unlock:"purchase"},{id:1188,name:"Mech Energy Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_MechEnergyWings",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1189,name:"Egg Sandwich Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sandwich",tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:1190,name:"Party Hat 2021",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2021",tags:["NewYears","2021","Red","Green"]},is_available:!1,unlock:"purchase"},{id:1191,name:"Headband 2021",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2021",tags:["NewYears","2021","Green"]},is_available:!1,unlock:"purchase"},{id:1192,name:"Hindsight Glasses",price:23e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesHindsight",tags:["NewYears","Black","Purple"]},is_available:!1,unlock:"purchase"},{id:1193,name:"Steampunk Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SteampunkWings",tags:["Premium","JulyM23","Gold"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_steamWings"]},{id:1194,name:"Thee_Owl Hat",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_theeowl",tags:["TheeOwl","Red","Orange","Green","Blue","Hair"]},is_available:!0,unlock:"purchase"},{id:1195,name:"Angel Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelAngel",tags:["Jun23","Blue","Yellow","White"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_wings"]},{id:1196,name:"C4bra Hair",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c4bra",tags:["C4bra","Brown"]},is_available:!0,unlock:"purchase"},{id:1197,name:"C4bra Ram Hat",price:35e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c4brahorn",tags:["C4bra","Brown"]},is_available:!0,unlock:"purchase"},{id:1198,name:"Hazmatt Mask",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hazmat",tags:["Hazmat","Yellow","Gold"]},is_available:!0,unlock:"purchase"},{id:1199,name:"Slashy Camp Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slashy",tags:["SlashyCamp","White","Bone","Red","Brown","Skullface","Slayaway"]},is_available:!1,unlock:"manual"},{id:1200,name:"Discord Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_discord",tags:["Discord","Black","Purple","White"]},is_available:!1,unlock:"manual"},{id:1201,name:"Funny Glasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_funnyGlasses",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1202,name:"Skull Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SkullWings",tags:["premFeatTwo","Red","Brown","Black","Bone","Oct23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_skull_wings"]},{id:1203,name:"Egg Earpods",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_airpods",tags:["White"]},is_available:!0,unlock:"purchase"},{id:1204,name:"Paper Bag Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bag",tags:["Brown"]},is_available:!0,unlock:"purchase"},{id:1205,name:"Backwards Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hipster",tags:["White","Black"]},is_available:!0,unlock:"purchase"},{id:1206,name:"Beret",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beret",tags:["White","Red","Egg"]},is_available:!0,unlock:"purchase"},{id:1207,name:"Spike Hat",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spike",tags:["Gold","Black","Yellow"]},is_available:!0,unlock:"purchase"},{id:1208,name:"TikTok Bowler",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tiktok",tags:["Pink","Blue","Black","Gray"]},is_available:!1,unlock:"manual"},{id:1209,name:"Propeller Beanie",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beanie",tags:["Newsletter","Rainbow","Blue"]},is_available:!1,unlock:"manual"},{id:1210,name:"Riddler Bowler",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_riddler",tags:["Purple","Yellow","Green"]},is_available:!1,unlock:"manual"},{id:1211,name:"Miner Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_miner",tags:["Yellow","Black"]},is_available:!1,unlock:"manual"},{id:1212,name:"Dog Ears",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dog",tags:["sale","Mar23","Brown"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_dog_cap"]},{id:1213,name:"Satellite Headgear",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_satellite",tags:["Gray","Grey"]},is_available:!1,unlock:"manual"},{id:1214,name:"Diablo Hat",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_evilpablo",tags:["EGGORG","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1215,name:"Robot Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelRobot",tags:["Aug23","Green","Gray","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_robot_wings"]},{id:1216,name:"Train Conductor",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_conductor",tags:["Trains","Cars","Yellow","Black"]},is_available:!0,unlock:"purchase"},{id:1217,name:"Train Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_train",tags:["Trains","Cars","Red","Gray"]},is_available:!0,unlock:"purchase"},{id:1218,name:"Bindle Hat",price:4500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bindle",tags:["Trains","Cars","Red","Brown"]},is_available:!0,unlock:"purchase"},{id:1219,name:"Instagram Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_instagram",tags:["Purple","Orange","Gray"]},is_available:!1,unlock:"manual"},{id:1220,name:"UFO Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ufo",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1221,name:"RandomLife Headgear",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_randomlife",tags:["Random","Red","Brown","Hair"]},is_available:!0,unlock:"purchase"},{id:1222,name:"Unicorn Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_UnicornWings",tags:["Mar23","Pink","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_uni_wing"]},{id:1223,name:"Steam Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_steam",tags:["Pink"]},is_available:!1,unlock:"manual"},{id:1224,name:"Ice Cream Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_icecream",tags:["Newsletter","Blue","Brown"]},is_available:!1,unlock:"manual"},{id:1225,name:"Ethan Gamer Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ethangamer",tags:["EthanGamer","Brown","Green","Hair"]},is_available:!0,unlock:"purchase"},{id:1226,name:"Fairy Pixel Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelFairy",tags:["Premium","Pink","Blue"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_fairy_wings"]},{id:1227,name:"Facebook Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_facebook",tags:["Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:1228,name:"Sun Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sun",tags:["Summer","JunM23","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:1229,name:"Picnic Basket Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_picnic",tags:["Summer","JunM23","Brown","White","Red"]},is_available:!1,unlock:"purchase"},{id:1230,name:"Beehive Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beehive",tags:["Summer","JunM23","Yellow","Black"]},is_available:!1,unlock:"purchase"},{id:1231,name:"Parrot Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_parrot",tags:["Newsletter","Red","Green"]},is_available:!1,unlock:"manual"},{id:1232,name:"Toilet Paper Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ToiletPaperWings",tags:["Premium","White","Brown"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_toilet_papr"]},{id:1233,name:"Watermelon Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_watermelon",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1234,name:"Twitter Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_twitter",tags:["Blue","White"]},is_available:!1,unlock:"manual"},{id:1235,name:"Fire Pixel Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelFire",tags:["Premium","Red","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_pixel_fire"]},{id:1236,name:"Backpack Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_backpack",tags:["Pencil","Sep23","Red"]},is_available:!1,unlock:"purchase"},{id:1237,name:"Backpack Rainbow Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_backpackrainbow",tags:["Pencil","Sep23","Rainbow","White"]},is_available:!1,unlock:"purchase"},{id:1238,name:"Round Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roundglasses",tags:["Pencil","Sep23","Black"]},is_available:!1,unlock:"purchase"},{id:1239,name:"Books Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_books",tags:["Newsletter","Yellow","Brown","Red"]},is_available:!1,unlock:"manual"},{id:1240,name:"Wero Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weroShort",tags:["Wero","Brown","Hair"]},is_available:!0,unlock:"purchase"},{id:1241,name:"Glitch Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_GlitchWings",tags:["Premium","Purple","Pink","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_glitch_wing"]},{id:1242,name:"Sherlock Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sherlock",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1243,name:"Grave Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_RIP",tags:["Halloween2","Oct23","Grey","Gray","Egg"]},is_available:!0,unlock:"purchase"},{id:1244,name:"Ghost Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ghost",tags:["Halloween2","Oct23","White"]},is_available:!0,unlock:"purchase"},{id:1245,name:"Moth Pixel Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelMoth",tags:["Premium"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_moth_wings"]},{id:1246,name:"Android Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_android",tags:["Mobile","Green"]},is_available:!1,unlock:"purchase"},{id:1247,name:"Bravo Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bravo",tags:["Newsletter","Yellow","Hair"]},is_available:!1,unlock:"manual"},{id:1248,name:"Thermal Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ThermalWings",tags:["sale"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["hat_thermal_wings"]},{id:1249,name:"Apple Pie Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_applepie",tags:["Food","Brown"]},is_available:!1,unlock:"purchase"},{id:1250,name:"Pumpkin Pie Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkinpie",tags:["Food","Brown"]},is_available:!1,unlock:"purchase"},{id:1251,name:"Cheese Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cheese",tags:["Food","Yellow"]},is_available:!1,unlock:"purchase"},{id:1252,name:"Gravy hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gravy",tags:["Food","Brown","Yellow"]},is_available:!1,unlock:"purchase"},{id:1253,name:"Dollar Sign Glasses Black",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_PremiumEggTier3",tags:["Black Fryday","MayM23","Black"]},is_available:!1,unlock:"purchase"},{id:1254,name:"Pink Hair",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkwarrior",tags:["Eggs of Legends","Pink"]},is_available:!0,unlock:"purchase"},{id:1255,name:"Blue Braids",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bluebraids",tags:["Eggs of Legends","Blue","Hair"]},is_available:!0,unlock:"purchase"},{id:1256,name:"Weather Vane",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weathervane",tags:["KotC","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:1257,name:"Red Crown Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winnerRed",tags:["KotC","Gold","Red"]},is_available:!0,unlock:"purchase"},{id:1258,name:"Blue Crown Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winnerBlue",tags:["KotC","Gold","Blue"]},is_available:!0,unlock:"purchase"},{id:1259,name:"Bison Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bison",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1260,name:"Egg Cluster Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcluster",tags:["KotC","Brown"]},is_available:!0,unlock:"purchase"},{id:1261,name:"Party Hat 2022",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2022",tags:["NewYears","2022","Brown","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:1262,name:"Headband 2022",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2022",tags:["NewYears","2022","Red","Brown"]},is_available:!1,unlock:"purchase"},{id:1263,name:"Nervous Elf Belt",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_nervouself",tags:["Christmas","Elf","Brown","Gold","Green","Red"]},is_available:!1,unlock:"purchase"},{id:1264,name:"Bugs Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bluehair",tags:["Meggtrix","JulyM23","Blue"]},is_available:!1,unlock:"purchase"},{id:1265,name:"Meggtrix Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_clampglasses",tags:["Meggtrix","Black"]},is_available:!1,unlock:"purchase"},{id:1266,name:"Agent Smithe Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_smith",tags:["Meggtrix","Black"]},is_available:!1,unlock:"purchase"},{id:1267,name:"Dreadlocks Hair",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_twins",tags:["Meggtrix","Gray"]},is_available:!1,unlock:"purchase"},{id:1268,name:"Twitch Bits",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bits",tags:["Purple","Green","Red"]},is_available:!1,unlock:"manual"},{id:1269,name:"Butterfly Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelButterfly",tags:["Premium"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_pixel_butt"]},{id:1270,name:"Mandrake Glasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mandrake",tags:["Drops","Blue","Black","Gray"]},is_available:!1,unlock:"manual"},{id:1271,name:"Lyerpald Wolf Helmut",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lyerpald",tags:["Drops","Gray"]},is_available:!1,unlock:"manual"},{id:1272,name:"Pixel Bird Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelBird",tags:["Premium","AugM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_bird"]},{id:1273,name:"xSerpius Hair",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_xserpiusbeard",tags:["Drops","Yellow"]},is_available:!1,unlock:"manual"},{id:1274,name:"Blue & Yellow Toque ",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toque",tags:["Chilly","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1275,name:"Purple & Red Toque",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pufftoque",tags:["Chilly","Purple","Red"]},is_available:!1,unlock:"purchase"},{id:1276,name:"Ear Flaps Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_greenearhat",tags:["Chilly","Sep23","Green"]},is_available:!1,unlock:"purchase"},{id:1277,name:"Bow Headband",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkbow",tags:["Kawaii","Blue","Pink","Hair"]},is_available:!0,unlock:"purchase"},{id:1278,name:"Cute Ponytail",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkpony",tags:["Kawaii","Pink","Hair"]},is_available:!0,unlock:"purchase"},{id:1279,name:"High Pigtails",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hightails",tags:["Kawaii","Purple","Hair"]},is_available:!0,unlock:"purchase"},{id:1280,name:"Orange Hair Buns",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spacebuns",tags:["Kawaii","Orange"]},is_available:!0,unlock:"purchase"},{id:1281,name:"Cat Braids",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_catbraids",tags:["Kawaii","Brown","Hair"]},is_available:!0,unlock:"purchase"},{id:1282,name:"Sashimi Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sushi",tags:["Kawaii","Pink","White"]},is_available:!0,unlock:"purchase"},{id:1283,name:"Big Cat Ears",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bigears",tags:["Kawaii","Brown"]},is_available:!0,unlock:"purchase"},{id:1284,name:"Spiky Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spikyband",tags:["Kawaii","White","Black"]},is_available:!0,unlock:"purchase"},{id:1285,name:"Gamer Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerhair",tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:1286,name:"Purple Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purplehair",tags:["Purple"]},is_available:!0,unlock:"purchase"},{id:1287,name:"Mmm Donut Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_donut",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1288,name:"Lucky Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_LuckyWings",tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_luckywings"]},{id:1289,name:"Turtle Power Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turtle",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1290,name:"Ukraine Bandana",price:3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaUkraine",tags:["UA","Blue","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_ukraine"]},{id:1291,name:"Sweatband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sweatband",tags:["Bros","Egg","Purple","Gold"]},is_available:!1,unlock:"purchase"},{id:1292,name:"Spartan Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spartan",tags:["Bros","Green"]},is_available:!1,unlock:"purchase"},{id:1293,name:"Gators Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gators",tags:["Bros","Blue","Orange"]},is_available:!1,unlock:"purchase"},{id:1294,name:"Rams Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rams",tags:["Bros","Aug23","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1295,name:"Knight Hat",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knight",tags:["EGGORG","Blue","Red"]},is_available:!1,unlock:"purchase"},{id:1296,name:"Viking Helmet",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_viking",tags:["EGGORG","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1297,name:"Egg Cape",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcape",tags:["EGGORG","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1298,name:"Joker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_joker",tags:["EGGORG","Blue","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1299,name:"Shield Hat",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shield",tags:["EGGORG","Apr23","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1300,name:"Valkyrie Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_valkyrie",tags:["Newsletter","Blue","Gray"]},is_available:!1,unlock:"manual"},{id:1301,name:"Tattered Cape",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcapeRust",tags:["Relic","Drops2","Brown","Gold"]},is_available:!1,unlock:"manual"},{id:1302,name:"Gold Joker Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_jokerGold",tags:["Relic","Drops2","Yellow"]},is_available:!1,unlock:"manual"},{id:1303,name:"Rusty Viking Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_vikingRust",tags:["Relic","Drops2","Brown","Gold"]},is_available:!1,unlock:"manual"},{id:1304,name:"Rusty Knight Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knightRust",tags:["Relic","Drops2","Brown","Red"]},is_available:!1,unlock:"manual"},{id:1305,name:"JWBerry3D Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerglasses",tags:["Relic","Red","Black"]},is_available:!0,unlock:"purchase"},{id:1306,name:"Ocean Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oceanglasses",tags:["Relic","Blue"]},is_available:!0,unlock:"purchase"},{id:1307,name:"Tooth Survivor Bandana",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toothbandana",tags:["Dino","May23","Gray"]},is_available:!1,unlock:"purchase"},{id:1308,name:"Steggasauras Scales",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_stego",tags:["Dino","May23","Orange","Green"]},is_available:!1,unlock:"purchase"},{id:1309,name:"Red Dino Tail",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailred",tags:["Dino","May23","Yellow","Red"]},is_available:!1,unlock:"purchase"},{id:1310,name:"Green Dino Tail",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailgreen",tags:["Dino","May23","Green"]},is_available:!1,unlock:"purchase"},{id:1311,name:"Dino Mouth Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinomouth",tags:["Dino","May23","Red"]},is_available:!1,unlock:"purchase"},{id:1312,name:"Dino Pterodactyl Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DinoWings",tags:["Dino","May23","Green"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_dinowings"]},{id:1313,name:"Dino Triceratops Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dino",tags:["Dino","Newsletter","Orange"]},is_available:!1,unlock:"manual"},{id:1314,name:"Tablet Backpack",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tabletpack",tags:["Mobile","SepM23","Red","Egg"]},is_available:!1,unlock:"purchase"},{id:1315,name:"Telephone Hat ",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_telephone",tags:["Mobile","AugM23","Red"]},is_available:!1,unlock:"purchase"},{id:1316,name:"Airplane Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Airplane",tags:["Sep23","Premium","White","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_airplane"]},{id:1317,name:"Head Tail",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headtails",tags:["Eggwalker2","White","Green","Black"]},is_available:!1,unlock:"purchase"},{id:1318,name:"Eggpire Cap",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_imperial",tags:["Eggwalker2","Green"]},is_available:!1,unlock:"purchase"},{id:1319,name:"Sci-fi Visor",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_obiwan",tags:["Eggwalker2","Black"]},is_available:!1,unlock:"purchase"},{id:1320,name:"Cross Fighter Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_CrossWing",tags:["Eggwalker2","Premium","White","Grey","Gray","Red","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_crosswing"]},{id:1321,name:"Pineapple Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pineapple",tags:["Summer","JunM23","Green","White"]},is_available:!1,unlock:"purchase"},{id:1322,name:"Kite Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kite",tags:["Summer","JunM23","Rainbow","Yellow"]},is_available:!1,unlock:"purchase"},{id:1323,name:"UK Bucket Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_buckethat",tags:["Summer","Newsletter","Yellow"]},is_available:!1,unlock:"manual"},{id:1324,name:"Baseball Helmet",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_baseball",tags:["Sports","JulyM23","Black"]},is_available:!1,unlock:"purchase"},{id:1325,name:"Football Helmet",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_football",tags:["Sports","JulyM23","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1326,name:"Swim Cap",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_swimcap",tags:["Sports","Blue","premFeatTwo","JulyM23","Oct23"]},is_available:!1,unlock:"purchase"},{id:1327,name:"Frisbee Damage Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frisbee",tags:["Sports","JulyM23","Red"]},is_available:!1,unlock:"purchase"},{id:1328,name:"SPORTS headband",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headband",tags:["Sports","JulyM23","Green","Egg"]},is_available:!1,unlock:"purchase"},{id:1329,name:"Cone Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cone",tags:["Newsletter","Sports","JulyM23","Orange"]},is_available:!1,unlock:"manual"},{id:1330,name:"Egg Yolk Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggyolk",tags:["Breakfast","Egg","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:1331,name:"Waffles Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_waffles",tags:["Breakfast","Brown","Yellow"]},is_available:!1,unlock:"purchase"},{id:1332,name:"Pancakes Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pancakes",tags:["Breakfast","Brown","Yellow"]},is_available:!1,unlock:"purchase"},{id:1333,name:"Teacup Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_teacup",tags:["Breakfast","White","Red"]},is_available:!1,unlock:"purchase"},{id:1334,name:"Captain Breakfast Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_captaincrunch",tags:["Breakfast","Newsletter","Blue"]},is_available:!1,unlock:"manual"},{id:1335,name:"Keyhole Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_keyhole",tags:["Scavenger","Black"]},is_available:!1,unlock:"purchase"},{id:1336,name:"Distinguished Gentlemen Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pipe",tags:["Scavenger","Brown","Hair"]},is_available:!1,unlock:"purchase"},{id:1337,name:"Wizskull Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wizskull",tags:["Scavenger","Blue","White","Bone","BWD"]},is_available:!1,unlock:"purchase"},{id:1338,name:"Tucked Pencil Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pencilhair",tags:["Pencil2","Sep23","Yellow","Hair"]},is_available:!1,unlock:"purchase"},{id:1339,name:"Slide Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slide",tags:["Pencil2","Sep23","Blue","Red"]},is_available:!1,unlock:"purchase"},{id:1340,name:"Scavenger Hunt Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scavenger",tags:["Pencil2","Sep23","Red","Black"]},is_available:!1,unlock:"manual"},{id:1341,name:"Rainbow Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RainbowWings",tags:["Pencil2","Premium"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_rainbow"]},{id:1342,name:"Paper Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paper",tags:["Newsletter","Pencil2","Blue","White"]},is_available:!1,unlock:"manual"},{id:1343,name:"Albino Book Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snake",tags:["Sep22","Drops3","ABHS"]},is_available:!1,unlock:"manual"},{id:1344,name:"Heart Backpack",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_heartpack",tags:["Sep22","Drops3","Red","Pink"]},is_available:!1,unlock:"manual"},{id:1345,name:"Deal with it Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_deal",tags:["Sep22","Drops3","Black","Meme"]},is_available:!1,unlock:"manual"},{id:1346,name:"Kilzomatic Hat",price:6e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kilzomatic",tags:["Sep22","Yellow","Blue"]},is_available:!0,unlock:"purchase"},{id:1347,name:"Sharkbucks Hat",price:6900,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sharkbucks",tags:["Sep22","Pink","Blue"]},is_available:!0,unlock:"purchase"},{id:1348,name:"The cap cap",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cap",tags:["Newsletter","Blue"]},is_available:!1,unlock:"manual"},{id:1349,name:"Teggtris wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Tetris",tags:["Sep22","Premium","Rainbow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_teggtris"]},{id:1350,name:"Scary Balloon Hat",price:1990,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_balloon",tags:["Halloween3","OctM23","Blue"]},is_available:!0,unlock:"purchase"},{id:1351,name:"Witch Cobwebs Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cobweb",tags:["Halloween3","Newsletter","OctM23","Purple","Black"]},is_available:!1,unlock:"manual"},{id:1352,name:"Cauldron Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cauldron",tags:["Halloween3","OctM23","Black"]},is_available:!0,unlock:"purchase"},{id:1353,name:"Mummy Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mummy",tags:["Halloween3","OctM23","White"]},is_available:!0,unlock:"purchase"},{id:1354,name:"Black Cat Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kitten",tags:["Halloween3","OctM23","Black"]},is_available:!0,unlock:"purchase"},{id:1355,name:"Dracula Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dracula",tags:["Halloween3","OctM23","White","Grey","Gray","Black"]},is_available:!0,unlock:"purchase"},{id:1356,name:"Blood Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_BloodWings",tags:["Halloween3","Jun23","Red"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_bloodwing"]},{id:1357,name:"It's Corn Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_corn",tags:["Thanksgiving","Meme","Yellow","Food"]},is_available:!1,unlock:"purchase"},{id:1358,name:"NPS Clan Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_NPS",tags:["League"]},is_available:!1,unlock:"manual"},{id:1359,name:"Drone Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_drone",tags:["Badegg","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1360,name:"Tactical Vest",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tacticalvest",tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:1361,name:"Medbox Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_medbox",tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:1362,name:"Crash Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crash",tags:["Badegg","Red"]},is_available:!1,unlock:"purchase"},{id:1363,name:"Fall Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Fall",tags:["Badegg","SepM23","Orange","Brown"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fall"]},{id:1364,name:"Ribbon Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ribbon",tags:["Christmas","Red"]},is_available:!1,unlock:"purchase"},{id:1365,name:"Santa hat & Beard",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santabeard",tags:["Christmas","Newsletter","Red","White"]},is_available:!1,unlock:"manual"},{id:1366,name:"Sailor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sailor",tags:["Newsletter","White"]},is_available:!1,unlock:"manual"},{id:1367,name:"Party Hat 2023",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1368,name:"2023 Headband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1369,name:"Holly Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Holly",tags:["Premium","Red","Green"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_holy_wings"]},{id:1370,name:"Piano Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_piano",tags:["Rockstar","JanM23","Black","Music"]},is_available:!1,unlock:"purchase"},{id:1371,name:"Gramophone Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gramaphone",tags:["Rockstar","JanM23","Gold","Yellow","Brown","Music"]},is_available:!1,unlock:"purchase"},{id:1372,name:"Sound Wave Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Music",tags:["Rockstar","Premium","JanM23","Blue","Purple","Blurple","Music"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_soundwave"]},{id:1373,name:"Fancy Band Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fancyband",tags:["Rockstar","JanM23","Blue","Green","Gold","Music"]},is_available:!1,unlock:"purchase"},{id:1374,name:"Winter Scarf",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarf",tags:["Groundhog","Feb23","Red"]},is_available:!1,unlock:"purchase"},{id:1375,name:"Bull hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bull",tags:["farm","FebM23","Bone","Brown","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:1376,name:"Farmer Shirt",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_farmer",tags:["farm","FebM23","Red"]},is_available:!1,unlock:"purchase"},{id:1377,name:"Cowbell Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowbell",tags:["farm","FebM23","Silver"]},is_available:!1,unlock:"purchase"},{id:1378,name:"Barrel Eye",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_barrel",tags:["Drops4","Mar23","AugM23","Brown","Silver","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:1379,name:"Kiwi Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kiwi",tags:["Drops4","Mar23","AugM23","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:1380,name:"Eggscellent Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggscellent",tags:["Drops4","Mar23","AugM23","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1381,name:"KJs Dad",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oldman",tags:["Drops4","Mar23","Old","Grey","Gray","Meme","Hair"]},is_available:!1,unlock:"purchase"},{id:1382,name:"Novosuper Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_novo",tags:["Drops4","Mar23","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:1383,name:"Bracket Shell",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_banana",tags:["Drops4","Mar23","Yellow","Blue","Bananas"]},is_available:!1,unlock:"manual"},{id:1384,name:"The Mask of Paradise",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paradise",tags:["Drops4","Mar23","Black"]},is_available:!1,unlock:"manual"},{id:1385,name:"xQc Hair",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_xhair",tags:["Drops4","Mar23","White","Black","Red","Meme"]},is_available:!1,unlock:"manual"},{id:1386,name:"Marshmallow Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_marshmallow",tags:["Drops4","Mar23","White","Red"]},is_available:!1,unlock:"manual"},{id:1387,name:"Big Brain Hat",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_brain",tags:["Drops4","Mar23","AugM23","OctM23","Pink","premFeatOne"]},is_available:!0,unlock:"purchase"},{id:1388,name:"Fusion Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fusion",tags:["Newsletter","Mar23","White","Blue"]},is_available:!1,unlock:"manual"},{id:1389,name:"Harp Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Harp",tags:["Premium","Mar23","Gold"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_harp"]},{id:1390,name:"Longhorn Bros",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_longhorns",tags:["Bros","MarM23","Bone","Yellow","White"]},is_available:!1,unlock:"purchase"},{id:1391,name:"Purdue Bros",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purdue",tags:["Bros","MarM23","Yellow","White","Black"]},is_available:!1,unlock:"purchase"},{id:1392,name:"Scoreboard Bros",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scoreboard",tags:["Bros","MarM23","Blue","Red"]},is_available:!1,unlock:"purchase"},{id:1393,name:"Drenched Bros",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerjuice",tags:["Bros","MarM23","Blue","Grey","Gray","Orange","Electrolytes"]},is_available:!1,unlock:"purchase"},{id:1394,name:"Hooped Hat",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Hoop",tags:["Bros","MarM23","White","Red"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_hooped"]},{id:1395,name:"Brown Wizard Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_brownwizard",tags:["Heroes","Apr23","Brown"]},is_available:!1,unlock:"purchase"},{id:1396,name:"Elf Ears Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_elfear",tags:["Heroes","Apr23","Grey","Gray","Hair"]},is_available:!1,unlock:"purchase"},{id:1397,name:"Dwarf Beard",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dwarf",tags:["Heroes","Apr23","Orange"]},is_available:!1,unlock:"purchase"},{id:1398,name:"Gelatinous Cube Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cube",tags:["Monsters","Apr23","Green"]},is_available:!1,unlock:"purchase"},{id:1399,name:"Purple Worm Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wurm",tags:["Monsters","Apr23","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:1400,name:"Question Block Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_MysteryWings",tags:["AprM23","Aug23","White","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_qwings"]},{id:1401,name:"Green Dino Head",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_greendino",tags:["Dino2","May23","Green"]},is_available:!1,unlock:"purchase"},{id:1402,name:"Blue Dino Tail",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailblue",tags:["Dino2","May23","Blue"]},is_available:!1,unlock:"purchase"},{id:1403,name:"Caveman Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_caveman",tags:["Dino2","May23","Brown"]},is_available:!1,unlock:"purchase"},{id:1404,name:"Leopard Sash",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skinsash",tags:["Dino2","May23","Orange","Black"]},is_available:!1,unlock:"purchase"},{id:1405,name:"Tiger Sash",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tigersash",tags:["Dino2","May23","Newsletter","Orange","Black"]},is_available:!1,unlock:"manual"},{id:1406,name:"Egg Chest Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goldchest",tags:["Eggflation","MayM23","Gold","Brown"]},is_available:!0,unlock:"purchase"},{id:1407,name:"Golden Nugget Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goldnugget",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1408,name:"Photobooth Top Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothtophat",tags:["Photo","Jun23","Black"]},is_available:!1,unlock:"purchase"},{id:1409,name:"Photobooth Bow",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothbow",tags:["Photo","Jun23","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1410,name:"Photobooth Crown",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothcrown",tags:["Photo","Jun23","Gold"]},is_available:!1,unlock:"purchase"},{id:1411,name:"Photobooth Cake",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothcake",tags:["Newsletter","Photo","Jun23","White"]},is_available:!1,unlock:"manual"},{id:1412,name:"Red Snorkel",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snorkelred",tags:["Summer2","JunM23","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1413,name:"Blue Snorkel",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snorkelblue",tags:["Summer2","JunM23","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:1414,name:"Beach Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beach",tags:["Summer2","JunM23","Yellow","Green","Brown"]},is_available:!1,unlock:"purchase"},{id:1415,name:"Sandcastle Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sandcastle",tags:["Summer2","JunM23","Gold","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:1416,name:"Crab Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crab",tags:["Summer2","JunM23","Red","Meme"]},is_available:!1,unlock:"purchase"},{id:1417,name:"Octopus Surfboard",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Octopus",tags:["Summer2","JunM23","Brown"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_surf"]},{id:1418,name:"Equinox Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinox",tags:["Equinox","July23","Gold","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1419,name:"Equinox Sun Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinoxSun",tags:["Equinox","July23","Gold","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1420,name:"Equinox Moon Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinoxMoon",tags:["Equinox","July23","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1421,name:"Bonsai Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bonsai",tags:["Equinox","July23","Blue","Yellow","Green","Brown"]},is_available:!1,unlock:"purchase"},{id:1422,name:"Skull Trio Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skulls",tags:["Newsletter","July23","Bone","Brown"]},is_available:!1,unlock:"manual"},{id:1423,name:"Scales of Justice Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Scales",tags:["July23","Gold"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_scales"]},{id:1424,name:"Biker Helmet",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremehelm",tags:["Sports2","JulyM23","Black","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:1425,name:"Climbing Gear Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremeclimb",tags:["Sports2","JulyM23","Blue"]},is_available:!1,unlock:"purchase"},{id:1426,name:"Ski Bum Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremeskis",tags:["Sports2","JulyM23","Rainbow"]},is_available:!1,unlock:"purchase"},{id:1427,name:"Stickers Helmet",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_stickers",tags:["Sports2","JulyM23","Black","Egg"]},is_available:!1,unlock:"purchase"},{id:1428,name:"Hang Glider Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Glider",tags:["Sports2","JulyM23","Rainbow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_glider"]},{id:1429,name:"Red Kart",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartRed",tags:["Kart","Aug23","Red"]},is_available:!1,unlock:"purchase"},{id:1430,name:"Green Kart",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartGreen",tags:["Kart","Aug23","Green"]},is_available:!1,unlock:"purchase"},{id:1431,name:"Pink Kart",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartPink",tags:["Kart","Aug23","Pink"]},is_available:!1,unlock:"purchase"},{id:1432,name:"Yellow Kart",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartYellow",tags:["Kart","Aug23","Yellow"]},is_available:!1,unlock:"purchase"},{id:1433,name:"Piranha Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_piranha",tags:["Kart","Aug23","Red","White","Green"]},is_available:!1,unlock:"purchase"},{id:1434,name:"Big Biter Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chomp",tags:["Kart","Aug23","Blue","Chomp"]},is_available:!1,unlock:"purchase"},{id:1435,name:"Gang Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gang",tags:["SL","Blue"]},is_available:!1,unlock:"manual"},{id:1436,name:"Fluffly Meteor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fluffy",tags:["Drops5","AugM23","Blue"]},is_available:!1,unlock:"manual"},{id:1437,name:"King Hayden Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hayden",tags:["Drops5","AugM23","Gold"]},is_available:!1,unlock:"manual"},{id:1438,name:"Anarchy Arden",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academymale",tags:["Sep23","Pencil3","Egg","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1439,name:"Anarchy Ashley",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academyfemale",tags:["Sep23","Pencil3","Egg","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1440,name:"Dunce Cap",price:4e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dunce",tags:["Sep23","Pencil3","White"]},is_available:!1,unlock:"purchase"},{id:1441,name:"The Toolbelt",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toolbelt",tags:["Sep23","Pencil3","Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1442,name:"Wrestle Shoes Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shoetie",tags:["SepM23","WBs","Black"]},is_available:!1,unlock:"purchase"},{id:1443,name:"Wrestling Belt",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wrestlebelt",tags:["SepM23","WBs","Gold","Black"]},is_available:!1,unlock:"purchase"},{id:1444,name:"Wrestling Ring Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wrestlering",tags:["SepM23","WBs","White","Black","Red","White","Blue"]},is_available:!1,unlock:"purchase"},{id:1445,name:"The Grand Entrance Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Firework",tags:["SepM23","WBs","Red","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_wbs"]},{id:1446,name:"Angler Fish Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angler",tags:["Oct23","Halloween4","Brown"]},is_available:!0,unlock:"purchase"},{id:1447,name:"Hungry Shark Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shark",tags:["Oct23","Halloween4","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:1448,name:"Baby Ghost Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_babyghost",tags:["Oct23","Halloween4","White"]},is_available:!0,unlock:"purchase"},{id:1449,name:"Captain Inksalot Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_squidpatch",tags:["Oct23","Halloween4","Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1450,name:"Demon Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelDemon",tags:["Oct23","Halloween4","Black"]},is_available:!0,unlock:"premium",activeProduct:!1,sku:["item_hat_demonpixel"]},{id:1451,name:"Purple Witch's Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purplewitch",tags:["OctM23","Halloween4","Purple"]},is_available:!0,unlock:"purchase"},{id:1452,name:"Wednesday Morning Hair",price:2020,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_addams",tags:["OctM23","Halloween4","Black"]},is_available:!0,unlock:"purchase"},{id:1453,name:"Ectoplasmic Goo",price:1980,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slime",tags:["OctM23","Halloween4","Green"]},is_available:!0,unlock:"purchase"},{id:1454,name:"Stapled Bear Friend",price:2010,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bear",tags:["OctM23","Halloween4","Brown"]},is_available:!0,unlock:"purchase"},{id:2001,name:"Target Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:0,tags:["Default","Red","Blue","Yellow"]},is_available:!0,unlock:"default"},{id:2002,name:"No Sign Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:0,tags:["Default","Red"]},is_available:!0,unlock:"default"},{id:2003,name:"Question Mark Stamp?",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:0,tags:["Default","Black","?"]},is_available:!0,unlock:"default"},{id:2004,name:"Peace Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:0,tags:["Default","Black"]},is_available:!0,unlock:"default"},{id:2005,name:"Thumbs Up Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:0,tags:["Default","White"]},is_available:!0,unlock:"default"},{id:2006,name:"Pablo Smile Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:0,tags:["Default","Happy","Face","Yellow"]},is_available:!0,unlock:"default"},{id:2007,name:"Skull & Crossbones Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2008,name:"Tyrant Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:3,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2009,name:"Shifty Eye Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:5,tags:["Purple"]},is_available:!0,unlock:"purchase"},{id:2010,name:"Arrow & Heart Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:6,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2011,name:"Grade A Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:1,tags:["Red","USDA"]},is_available:!0,unlock:"purchase"},{id:2012,name:"Anarchy Sign Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:1,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2013,name:"Derp Face Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:2,tags:["Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2014,name:"Wolf Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2015,name:"Chicken Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:6,tags:["Brown"]},is_available:!0,unlock:"purchase"},{id:2016,name:"Phoenix Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:7,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2017,name:"Alien Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:7,tags:["Green"]},is_available:!0,unlock:"purchase"},{id:2018,name:"Dapper Mustache Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2019,name:"Happy Bear Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:8,tags:["Pink","Smile"]},is_available:!0,unlock:"purchase"},{id:2020,name:"Ghost Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:8,tags:["Halloween","Oct23","Black"]},is_available:!0,unlock:"purchase"},{id:2021,name:"Jack Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:8,tags:["Halloween","Oct23","Black"]},is_available:!0,unlock:"purchase"},{id:2022,name:"Cracks Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:9,tags:["Halloween","Oct23","Black"]},is_available:!0,unlock:"purchase"},{id:2023,name:"Bat Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:9,tags:["Halloween","Oct23","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2024,name:"Cthulhu Fhtagn Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:9,tags:["Halloween","Oct23","Green"]},is_available:!0,unlock:"purchase"},{id:2025,name:"Elder Sign Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:9,tags:["Halloween","Oct23","Red"]},is_available:!0,unlock:"purchase"},{id:2026,name:"Scary Teeth Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:9,tags:["Halloween","Oct23","Smile","Green"]},is_available:!0,unlock:"purchase"},{id:2027,name:"Monster Tongue Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:9,tags:["Halloween","Oct23","Face"]},is_available:!0,unlock:"purchase"},{id:2028,name:"Spooky Lady Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:9,tags:["Halloween","Oct23","Face"]},is_available:!0,unlock:"purchase"},{id:2029,name:"Clown Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:10,tags:["Halloween","Oct23","Smile"]},is_available:!0,unlock:"purchase"},{id:2030,name:"Stitch Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:10,tags:["Halloween","Oct23","Black"]},is_available:!0,unlock:"purchase"},{id:2031,name:"Devil Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:10,tags:["Halloween","Oct23","Smile"]},is_available:!0,unlock:"purchase"},{id:2032,name:"Face Mask Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:10,tags:["Halloween","Oct23","Black"]},is_available:!0,unlock:"purchase"},{id:2033,name:"Hand Turkey Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:10,tags:["Thanksgiving"]},is_available:!1,unlock:"purchase"},{id:2034,name:"Turkey Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:10,tags:["Thanksgiving"]},is_available:!1,unlock:"purchase"},{id:2035,name:"Turkey Crossbones Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:10,tags:["Thanksgiving","Brown"]},is_available:!1,unlock:"purchase"},{id:2036,name:"Reindeer Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:11,tags:["Christmas","Red"]},is_available:!1,unlock:"purchase"},{id:2037,name:"Gingerbread Cookie Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:11,tags:["Christmas","Brown"]},is_available:!1,unlock:"purchase"},{id:2038,name:"Santa Skull Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:11,tags:["Christmas","Red"]},is_available:!1,unlock:"purchase"},{id:2039,name:"2019 Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:11,tags:["NewYears2019","Yellow","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2040,name:"Fireworks Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:11,tags:["NewYears","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2041,name:"Midnight Clock Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:11,tags:["NewYears"]},is_available:!1,unlock:"purchase"},{id:2042,name:"Stressed Out Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:7,tags:["Newsletter","Face"]},is_available:!1,unlock:"manual"},{id:2043,name:"Chicken Finger Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:8,tags:["Newsletter"]},is_available:!1,unlock:"manual"},{id:2044,name:"Lyerpald Stamp ",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:8,tags:["Contentcreator"]},is_available:!1,unlock:"manual"},{id:2045,name:"Groundhog Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:11,tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:2046,name:"Winter Snowflake Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:12,tags:["Groundhog","Feb23","Blue"]},is_available:!1,unlock:"purchase"},{id:2047,name:"Spring Flower Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:12,tags:["Groundhog","Feb23","Pink"]},is_available:!1,unlock:"purchase"},{id:2048,name:"Broken Heart Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:12,tags:["ValentinesDay","Red"]},is_available:!1,unlock:"purchase"},{id:2049,name:"Rose Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:12,tags:["ValentinesDay","Red"]},is_available:!1,unlock:"purchase"},{id:2050,name:"Anatomical Heart Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:12,tags:["ValentinesDay","Heart"]},is_available:!1,unlock:"purchase"},{id:2051,name:"Shamrock Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:12,tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:2052,name:"Ginger Beard Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:12,tags:["StPatricksDay","MarM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2053,name:"Pot of Gold Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:13,tags:["StPatricksDay","MarM23"]},is_available:!1,unlock:"purchase"},{id:2054,name:"Bunny Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:13,tags:["Easter","AprM23","Heart"]},is_available:!0,unlock:"purchase"},{id:2055,name:"Easter Egg Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:13,tags:["Easter","AprM23","Blue","White"]},is_available:!1,unlock:"purchase"},{id:2056,name:"Golden Easter Egg Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:13,tags:["Easter"]},is_available:!1,unlock:"purchase"},{id:2057,name:"Shell League Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:13,tags:["League"]},is_available:!0,unlock:"purchase"},{id:2058,name:"TXC Clan Logo Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:13,tags:["Green","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:2071,name:"GOD Clan Logo",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:15,tags:["Blue"]},is_available:!0,unlock:"purchase"},{id:2059,name:"Sherrif Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:6,tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:2060,name:"Rainbow Cloud Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:5,tags:["Cute"]},is_available:!0,unlock:"purchase"},{id:2061,name:"Angel Wings Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:6,tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:2062,name:"GoE Sigil - Wolf Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:13,tags:["GameOfEggs","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2063,name:"GoE Sigil - Lion Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:14,tags:["GameOfEggs","Red"]},is_available:!0,unlock:"purchase"},{id:2064,name:"GoE Sigil - Bird Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:14,tags:["GameOfEggs","Blue"]},is_available:!0,unlock:"purchase"},{id:2065,name:"GoE Sigil - Stag Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:14,tags:["GameOfEggs","Yellow"]},is_available:!0,unlock:"purchase"},{id:2066,name:"GoE Sigil - Fish Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:14,tags:["GameOfEggs","Orange"]},is_available:!0,unlock:"purchase"},{id:2067,name:"GoE Sigil - Squid Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:14,tags:["GameOfEggs","Black"]},is_available:!0,unlock:"purchase"},{id:2068,name:"GoE Sigil - Sun Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:14,tags:["GameOfEggs","Orange","Red"]},is_available:!0,unlock:"purchase"},{id:2069,name:"GoE Sigil - Flower Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:14,tags:["GameOfEggs","Green","Yellow"]},is_available:!0,unlock:"purchase"},{id:2070,name:"GoE Sigil - Dragon Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:15,tags:["GameOfEggs","Red"]},is_available:!0,unlock:"purchase"},{id:2072,name:"4th of July Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:15,tags:["July4","Red","Blue","Fireworks"]},is_available:!1,unlock:"purchase"},{id:2073,name:"SL MVP Division A Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:15,tags:["League"]},is_available:!1,unlock:"manual"},{id:2074,name:"SL MVP Division B Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:15,tags:["League"]},is_available:!1,unlock:"manual"},{id:2075,name:"CRGI Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:15,tags:["League","Dog"]},is_available:!1,unlock:"manual"},{id:2076,name:"Robot Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:6,tags:["Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2077,name:"Poop Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:7,tags:["Brown","Poop"]},is_available:!0,unlock:"purchase"},{id:2078,name:"Heart Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:1,tags:["Cards","Red"]},is_available:!1,unlock:"purchase"},{id:2079,name:"Spade Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:1,tags:["Cards","Black"]},is_available:!1,unlock:"purchase"},{id:2080,name:"Club Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:1,tags:["Cards","Black"]},is_available:!1,unlock:"purchase"},{id:2081,name:"Diamond Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:1,tags:["Cards","Red"]},is_available:!1,unlock:"purchase"},{id:2082,name:"What Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2083,name:"Yes Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2084,name:"No Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2085,name:"Ribcage Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2086,name:"Angry Cartridge Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:8,tags:["Grey","Gray","Mouth"]},is_available:!0,unlock:"purchase"},{id:2087,name:"DXG Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:0,tags:["League"]},is_available:!1,unlock:"manual"},{id:2088,name:"Tired Space Goblin Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:2,tags:["Eggwalker","Green"]},is_available:!1,unlock:"purchase"},{id:2089,name:"Angry Space Dog Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:3,tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:2090,name:"No Trying Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:4,tags:["Eggwalker","Red"]},is_available:!1,unlock:"purchase"},{id:2091,name:"Disgruntled Space Weasel Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:5,tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:2092,name:"White Beard Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:1,tags:["Newsletter","Christmas","Santa"]},is_available:!1,unlock:"manual"},{id:2093,name:"Strong Egg Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:5,tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:2094,name:"New Years 2020 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:6,tags:["NewYears2020","Yellow","White"]},is_available:!1,unlock:"purchase"},{id:2095,name:"Bad Eggs For Life Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:8,tags:["BadEggsForLife","Jun23"]},is_available:!1,unlock:"purchase"},{id:2096,name:"Pixel Heart Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:9,tags:["Newsletter","Red"]},is_available:!1,unlock:"manual"},{id:2097,name:"Eggy Cash Face Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:15,tags:["EggyCash","Face","Black"]},is_available:!0,unlock:"purchase"},{id:2098,name:"DXG Clan Logo 2 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:10,tags:["League"]},is_available:!1,unlock:"manual"},{id:2099,name:"Raid Land Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:11,tags:["RaidLand"]},is_available:!1,unlock:"purchase"},{id:2100,name:"Egg Org Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:12,tags:["AprilFools","Black"]},is_available:!1,unlock:"purchase"},{id:2101,name:"MVP 2020 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:13,tags:["League"]},is_available:!1,unlock:"manual"},{id:2102,name:"TXC Skull Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:14,tags:["League","Purple"]},is_available:!1,unlock:"manual"},{id:2103,name:"Toxic Skull Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:15,tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:2104,name:"Toxic Nuke Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:0,tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:2105,name:"Toxic Derp Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:1,tags:["Rotten","Green","Smile"]},is_available:!0,unlock:"purchase"},{id:2106,name:"Facepaint Heart Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:5,tags:["Rockstar","JanM23","Pink","Music"]},is_available:!1,unlock:"purchase"},{id:2107,name:"Facepaint Star Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:6,tags:["Rockstar","JanM23","Black","Music"]},is_available:!1,unlock:"purchase"},{id:2108,name:"Facepaint Lightning Bolt Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:4,tags:["Rockstar","JanM23","Yellow","Music"]},is_available:!1,unlock:"purchase"},{id:2109,name:"Pink Starburst Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:7,tags:["Galeggsy","AprM23"]},is_available:!1,unlock:"purchase"},{id:2110,name:"Alien Eyes 1 Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:8,tags:["Galeggsy","AprM23","Face"]},is_available:!1,unlock:"purchase"},{id:2111,name:"Alien Eyes 2 Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:9,tags:["Galeggsy","AprM23","Face","Cute"]},is_available:!1,unlock:"purchase"},{id:2112,name:"Flame Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:7,tags:["Newsletter","Fire","Red","Orange","Yellow"]},is_available:!1,unlock:"manual"},{id:2113,name:"Discord Mod Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:13,tags:["mod"]},is_available:!1,unlock:"manual"},{id:2114,name:"Black Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:14,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2115,name:"Red Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:15,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2116,name:"Pink Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:0,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2117,name:"Killstreak Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:1,tags:["Killstreak","Smile","Red"]},is_available:!1,unlock:"manual"},{id:2118,name:"Red Rooster Wings Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:10,tags:["Chicken"]},is_available:!1,unlock:"purchase"},{id:2119,name:"White Rooster Wings Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:11,tags:["Chicken"]},is_available:!1,unlock:"purchase"},{id:2120,name:"Gold Rooster Wings Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:12,tags:["Chicken","July23"]},is_available:!1,unlock:"purchase"},{id:2121,name:"Ugly Jason Face Stamp",price:1300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:2,tags:["f13"]},is_available:!0,unlock:"purchase"},{id:2122,name:"Little Happy Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:3,tags:["Stampede","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2123,name:"Angry Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:4,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2124,name:"Why Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:5,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2125,name:"Influenced Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:6,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2126,name:"Nervous Crush Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:7,tags:["Stampede","Face","Red"]},is_available:!0,unlock:"purchase"},{id:2127,name:"Girly Eyes Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:8,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2128,name:"Big Smile Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:9,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2129,name:"Cyclops Face Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:10,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2130,name:"Grumpy Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:11,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2131,name:"Big Happy Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:12,tags:["Stampede","Smile","Face"]},is_available:!0,unlock:"purchase"},{id:2132,name:"Scared Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:13,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2133,name:"This Guy Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:14,tags:["Stampede","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2134,name:"Tumble Dude Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:15,tags:["Stampede","White","Face"]},is_available:!0,unlock:"purchase"},{id:2135,name:"Thee_Owl Angry Face Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:0,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2136,name:"Blow Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:1,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2137,name:"Whip Em Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:2,tags:["Stampede","Blue","Whisk"]},is_available:!0,unlock:"purchase"},{id:2138,name:"Baby on Board Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:3,tags:["Stampede","Chick","Yellow"]},is_available:!0,unlock:"purchase"},{id:2139,name:"Thee_Owl Scared Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:4,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2140,name:"Yin Yang Chicken Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:5,tags:["Stampede","Black","White"]},is_available:!0,unlock:"purchase"},{id:2141,name:"Blue Wizard Guy Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:8,tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:2142,name:"God Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:6,tags:["League","Red","Orange"]},is_available:!1,unlock:"manual"},{id:2143,name:"Wero Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:7,tags:["Wero","Beard"]},is_available:!0,unlock:"purchase"},{id:2144,name:"New Years 2021 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:8,tags:["NewYears","2021","Green"]},is_available:!1,unlock:"purchase"},{id:2145,name:"Thee_Owl Logo Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:9,tags:["ThreeOwl","Green"]},is_available:!0,unlock:"purchase"},{id:2146,name:"Biggest Mouth Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:5,tags:["Newsletter","Ahh"]},is_available:!1,unlock:"manual"},{id:2147,name:"C4bra Ram Outfit Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:7,tags:["C4bra"]},is_available:!0,unlock:"purchase"},{id:2148,name:"Hazmatt Thumbs Up Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:8,tags:["Hazmat","Yellow"]},is_available:!0,unlock:"purchase"},{id:2149,name:"Hazmatt POG Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:9,tags:["Hazmat","Yellow"]},is_available:!0,unlock:"purchase"},{id:2150,name:"Pixel Tech Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:10,tags:["Pixel","Green"]},is_available:!0,unlock:"purchase"},{id:2151,name:"Pixel Chicken Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:11,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2152,name:"Pixel Gun Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:12,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2153,name:"Pixel Robot Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:13,tags:["Pixel","Blue"]},is_available:!0,unlock:"purchase"},{id:2154,name:"Pixel Shield Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:14,tags:["Pixel","Eggs"]},is_available:!0,unlock:"purchase"},{id:2155,name:"Pixel Egg Splat Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:15,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2156,name:"Pixel Swords Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:0,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2157,name:"Pixel Happy Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:1,tags:["Pixel","Smile"]},is_available:!0,unlock:"purchase"},{id:2158,name:"Pixel Angry Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:2,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2159,name:"Pixel Annoyed Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:3,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2160,name:"Pixel Dead Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:4,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2161,name:"Pixel Deal With It Sunglasses Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:5,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2162,name:"Angry Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:12,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2163,name:"Cat Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:13,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2164,name:"Crazy Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:14,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2165,name:"Dog Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:15,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2166,name:"Evil Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:0,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2167,name:"Grinning Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:1,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2168,name:"Happy Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:2,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2169,name:"Laughing Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:3,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2170,name:"Pirate Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:4,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2171,name:"Sick Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:5,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2172,name:"Smiling Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:6,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2173,name:"Tongue-Out Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:7,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2174,name:"Upset Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:8,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2175,name:"Dead BW Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:10,tags:["EGGORG","Wizard","Blue"]},is_available:!1,unlock:"purchase"},{id:2176,name:"Egg Org Spokesperson Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:11,tags:["EGGORG"]},is_available:!1,unlock:"purchase"},{id:2177,name:"Aries Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:12,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2178,name:"Diablo Frown Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:9,tags:["EGGORG"]},is_available:!1,unlock:"purchase"},{id:2179,name:"Train Ticket Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:11,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2180,name:"Train Engine Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:13,tags:["Trains","Cars","Black"]},is_available:!0,unlock:"purchase"},{id:2181,name:"All Aboard Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:14,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2182,name:"Pain Train's Comin Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:15,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2183,name:"Random Life Logo Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:0,tags:["Random","RL"]},is_available:!0,unlock:"purchase"},{id:2184,name:"Shell Mobile QR Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:5},is_available:!0,unlock:"purchase"},{id:2185,name:"Ethan Gamer Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:4,tags:["EthanGamer","Red"]},is_available:!0,unlock:"purchase"},{id:2186,name:"Red Aries Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:10,tags:["League"]},is_available:!1,unlock:"manual"},{id:2187,name:"Toilet Paper Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:6,tags:["TP","Poop"]},is_available:!1,unlock:"purchase"},{id:2188,name:"Water Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:8,tags:["Summer","JunM23","Blue","Water"]},is_available:!1,unlock:"purchase"},{id:2189,name:"Popsicle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:6,tags:["Summer","JunM23","Pink","Food"]},is_available:!1,unlock:"purchase"},{id:2190,name:"Sun Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:7,tags:["Summer","JunM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2191,name:"Postage Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:9,tags:["Summer","JunM23"]},is_available:!1,unlock:"purchase"},{id:2192,name:"Blue Wizard Skull Stamp",price:1200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:6,tags:["BWD"]},is_available:!0,unlock:"purchase"},{id:2193,name:"Lyerpald Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:8,tags:["Dog","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2194,name:"SL NA#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:1,tags:["League","Yellow"]},is_available:!1,unlock:"manual"},{id:2195,name:"SL EU#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:2,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2196,name:"SL OCE#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:3,tags:["League","Green"]},is_available:!1,unlock:"manual"},{id:2197,name:"I <3 New Yolker Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:11,tags:["Newsletter","Heart","NY"]},is_available:!1,unlock:"manual"},{id:2198,name:"Egg Heart Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:12,tags:["White"]},is_available:!1,unlock:"manual"},{id:2199,name:"Chantigg Face Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:13,tags:["Chantigg","Smile"]},is_available:!0,unlock:"purchase"},{id:2200,name:"Chantigg Cake Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:14,tags:["Chantigg","Food"]},is_available:!0,unlock:"purchase"},{id:2201,name:"Grade A+ Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:0,tags:["Pencil","Sep23","Red"]},is_available:!1,unlock:"purchase"},{id:2202,name:"Globe Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:1,tags:["Pencil","Sep23","Earth","Green","Blue"]},is_available:!1,unlock:"purchase"},{id:2203,name:"Nerd Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:15,tags:["Pencil","Sep23","Smile"]},is_available:!1,unlock:"purchase"},{id:2204,name:"Gold Beak Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:13,tags:["vipItem","Premium"]},is_available:!0,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"]},{id:2205,name:"Zombie Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:10,tags:["Halloween2","Oct23","Yellow"]},is_available:!0,unlock:"purchase"},{id:2206,name:"Werewolf Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:9,tags:["Halloween2","Oct23","Pink"]},is_available:!0,unlock:"purchase"},{id:2207,name:"Vampire Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:8,tags:["Halloween2","Oct23","Red"]},is_available:!0,unlock:"purchase"},{id:2208,name:"Sasquatch Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:7,tags:["Halloween2","Oct23","Brown"]},is_available:!0,unlock:"purchase"},{id:2209,name:"Medusa Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:6,tags:["Halloween2","Oct23","Green"]},is_available:!0,unlock:"purchase"},{id:2210,name:"Blue Cyclops Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:5,tags:["Halloween2","Oct23","Blue"]},is_available:!0,unlock:"purchase"},{id:2211,name:"Cthulu Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:4,tags:["Halloween2","Oct23","Green"]},is_available:!0,unlock:"purchase"},{id:2212,name:"Baldwiz Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:3,tags:["Halloween2","Oct23","Skull"]},is_available:!0,unlock:"purchase"},{id:2213,name:"Fang Pablo Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:11,tags:["Halloween2","Oct23","Smile"]},is_available:!0,unlock:"purchase"},{id:2214,name:"Jack'o'lantern Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:12,tags:["Halloween2","Oct23","Face","Black"]},is_available:!0,unlock:"purchase"},{id:2215,name:"Circle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:0,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2216,name:"Square Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:15,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2217,name:"Umbrella Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:1,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2218,name:"Triangle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:14,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2219,name:"NACL Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:2,tags:["League","Yellow","Blue"]},is_available:!1,unlock:"manual"},{id:2220,name:"RBL Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:3,tags:["League","Black","Red"]},is_available:!1,unlock:"manual"},{id:2221,name:"Sheesh Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:11},is_available:!0,unlock:"purchase"},{id:2222,name:"Black Eggs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:10,tags:["Black Fryday"]},is_available:!1,unlock:"purchase"},{id:2223,name:"Black Fries Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:9,tags:["Black Fryday"]},is_available:!1,unlock:"purchase"},{id:2224,name:"Red Wins Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:4,tags:["KotC","Red"]},is_available:!0,unlock:"purchase"},{id:2225,name:"Blue Wins Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:5,tags:["KotC","Blue"]},is_available:!0,unlock:"purchase"},{id:2226,name:"I put the OP in Coop Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:6,tags:["KotC"]},is_available:!0,unlock:"purchase"},{id:2227,name:"I rule the Roost Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:7,tags:["KotC"]},is_available:!0,unlock:"purchase"},{id:2228,name:"2022 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:12,tags:["2022","Blue"]},is_available:!1,unlock:"purchase"},{id:2229,name:"Nervous Elf Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:14,tags:["Christmas","Face","Smile"]},is_available:!1,unlock:"purchase"},{id:2230,name:"Pro Plays Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:13,tags:["Drops","White"]},is_available:!1,unlock:"manual"},{id:2231,name:"Ganbaru Okan Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:15,tags:["Drops","Black","Pink"]},is_available:!1,unlock:"manual"},{id:2232,name:"Cold Face Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:0,tags:["Chilly","Ice"]},is_available:!1,unlock:"purchase"},{id:2233,name:"Snowman Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:1,tags:["Chilly","Smile","Face"]},is_available:!1,unlock:"purchase"},{id:2234,name:"Hockey Sticks Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:2,tags:["Chilly","Brown","Canada"]},is_available:!1,unlock:"purchase"},{id:2235,name:"Happy Aww Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:3,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2236,name:"Sad Aww Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:4,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2237,name:"Heart Eyes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:5,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2238,name:"Star Eyes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:6,tags:["Kawaii","Cute","Face","Yellow"]},is_available:!0,unlock:"purchase"},{id:2239,name:"Shocked Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:7,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2240,name:"Ecstatic Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:8,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2241,name:"Pleased Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:9,tags:["Kawaii","Cute","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2242,name:"Cat Wink Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:10,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2243,name:"Nate's Monies Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:11,tags:["Nate","MayM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2244,name:"Nate's Bomb Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:12,tags:["Nate","Black"]},is_available:!1,unlock:"purchase"},{id:2245,name:"Nate's Eel Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:13,tags:["Nate","Black","premFeatTwo","Oct23"]},is_available:!1,unlock:"purchase"},{id:2246,name:"Nate's Skypunch Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:14,tags:["Nate","MarM23","Pixel"]},is_available:!1,unlock:"purchase"},{id:2247,name:"Nate's Stonks Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:15,tags:["Nate","Yellow","Ahh"]},is_available:!1,unlock:"purchase"},{id:2248,name:"Nate's Dead Jason Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:15,tags:["Nate","Black","White"]},is_available:!1,unlock:"purchase"},{id:2249,name:"Nate's Alive Jason Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:14,tags:["Nate","Black","White"]},is_available:!1,unlock:"purchase"},{id:2250,name:"Nate's Noodly Appendages Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:13,tags:["Nate","Smile"]},is_available:!1,unlock:"purchase"},{id:2251,name:"Phoenix BLZ Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:10,tags:["SL","Orange","Yellow"]},is_available:!1,unlock:"manual"},{id:2252,name:"Navi Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:9,tags:["SL","Blue","Red"]},is_available:!1,unlock:"manual"},{id:2253,name:"NCR Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:8,tags:["SL","Black","Purple"]},is_available:!1,unlock:"manual"},{id:2254,name:"Ukraine Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:7,tags:["UA","Blue","Yellow","Heart"]},is_available:!1,unlock:"purchase"},{id:2255,name:"Nothin' but Net Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:11,tags:["Bros","Basketball"]},is_available:!1,unlock:"purchase"},{id:2256,name:"On Fire Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:12,tags:["Bros","Basketball","Orange"]},is_available:!1,unlock:"purchase"},{id:2257,name:"Diamonds Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:6,tags:["EGGORG","Red"]},is_available:!1,unlock:"purchase"},{id:2258,name:"Clubs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:5,tags:["EGGORG","Black"]},is_available:!1,unlock:"purchase"},{id:2259,name:"Spades Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:4,tags:["EGGORG","Black"]},is_available:!1,unlock:"purchase"},{id:2260,name:"Hearts Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:3,tags:["EGGORG","Red"]},is_available:!1,unlock:"purchase"},{id:2261,name:"Egg Org Shield Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:2,tags:["EGGORG","Apr23","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2262,name:"Polarized Moon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:1,tags:["Relic","White"]},is_available:!0,unlock:"purchase"},{id:2263,name:"Shattered EGG ORG Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:0,tags:["Relic","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:2264,name:"Wizard Neko Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:15,tags:["Relic","Mar23","AugM23","Dog"]},is_available:!1,unlock:"purchase"},{id:2265,name:"Jason Eyes Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:14,tags:["Relic","Mar23","AugM23"]},is_available:!1,unlock:"purchase"},{id:2266,name:"Wizard Cheer Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:13,tags:["Relic","Mar23","AugM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2267,name:"Egg Love Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:12,tags:["Relic","Mar23","AugM23","Heart"]},is_available:!1,unlock:"purchase"},{id:2268,name:"Going Eggstinct Stamp",price:350,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:11,tags:["Dino","May23","Black"]},is_available:!1,unlock:"purchase"},{id:2269,name:"No Tar Pits Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:10,tags:["Dino","May23","Red"]},is_available:!1,unlock:"purchase"},{id:2270,name:"Clutch Up! Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:9,tags:["Dino","May23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2271,name:"No Meteors Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:8,tags:["Dino","May23","Red"]},is_available:!1,unlock:"purchase"},{id:2272,name:"No Volcanos Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:7,tags:["Dino","May23","Red"]},is_available:!1,unlock:"purchase"},{id:2273,name:"RAWR Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:6,tags:["Dino","MarM23","Yellow","Purple"]},is_available:!1,unlock:"purchase"},{id:2274,name:"Baby Dino Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:5,tags:["Dino","May23","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:2275,name:"Bluetooth Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:0,tags:["Mobile","JunM23","Smile"]},is_available:!1,unlock:"purchase"},{id:2276,name:"Happy Phone Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:1,tags:["Mobile","Green"]},is_available:!1,unlock:"purchase"},{id:2277,name:"Mad Phone Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:2,tags:["Mobile","Red"]},is_available:!1,unlock:"purchase"},{id:2278,name:"Signal Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:3,tags:["Mobile","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2279,name:"Charging! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:4,tags:["Mobile","Black"]},is_available:!1,unlock:"purchase"},{id:2280,name:"Eggy-wan Beard Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:0,tags:["Eggwalker2","Face","Brown"]},is_available:!1,unlock:"purchase"},{id:2281,name:"Control Panel Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:1,tags:["Eggwalker2","Red","Black"]},is_available:!1,unlock:"purchase"},{id:2282,name:"Evader face Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:2,tags:["Eggwalker2","Red"]},is_available:!1,unlock:"purchase"},{id:2283,name:"Ladybug Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:3,tags:["Summer","JunM23","Red"]},is_available:!1,unlock:"purchase"},{id:2284,name:"Camper Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:4,tags:["Summer","JunM23","Green","Tent"]},is_available:!1,unlock:"purchase"},{id:2285,name:"Oasis Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:5,tags:["Summer","JunM23","Black","Red","Blue","Tree"]},is_available:!1,unlock:"purchase"},{id:2286,name:"Hot Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:6,tags:["Summer","JunM23","Orange"]},is_available:!1,unlock:"purchase"},{id:2287,name:"Sun's out Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:7,tags:["Summer","JunM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2288,name:"Blue's #1 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:8,tags:["Sports","JulyM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2289,name:"Red's #1 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:9,tags:["Sports","JulyM23","Red"]},is_available:!1,unlock:"purchase"},{id:2290,name:"Football Laces Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:10,tags:["Sports","JulyM23","White"]},is_available:!1,unlock:"purchase"},{id:2291,name:"Hockey crossed sticks Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:11,tags:["Sports","JulyM23","Black"]},is_available:!1,unlock:"purchase"},{id:2292,name:"Trophy #1 Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:12,tags:["Sports","JulyM23","Yellow","Gold"]},is_available:!1,unlock:"purchase"},{id:2293,name:"What's the play? Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:13,tags:["Sports","JulyM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2294,name:"Whistle Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:14,tags:["Sports","JulyM23","Red"]},is_available:!1,unlock:"purchase"},{id:2295,name:"Go Team Eggs Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:15,tags:["Sports","JulyM23"]},is_available:!1,unlock:"purchase"},{id:2296,name:"GOAL Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:0,tags:["Sports","JulyM23"]},is_available:!1,unlock:"purchase"},{id:2297,name:"Cooked Chicken Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:1,tags:["Chicken","Food"]},is_available:!1,unlock:"purchase"},{id:2298,name:"Lil Nugz Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:2,tags:["Chicken"]},is_available:!1,unlock:"purchase"},{id:2299,name:"Toast Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:3,tags:["Breakfast","Eggs"]},is_available:!1,unlock:"purchase"},{id:2300,name:"Butter believe it Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:4,tags:["Breakfast","Food"]},is_available:!1,unlock:"purchase"},{id:2301,name:"Sour Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:5,tags:["Breakfast","July23"]},is_available:!1,unlock:"purchase"},{id:2302,name:"Pancakes Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:6,tags:["Breakfast","Brown","Food"]},is_available:!1,unlock:"purchase"},{id:2303,name:"Hard Boiled Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:7,tags:["Breakfast","Eggs"]},is_available:!1,unlock:"purchase"},{id:2304,name:"Coffee makes me happy! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:8,tags:["Breakfast","Smile"]},is_available:!1,unlock:"purchase"},{id:2305,name:"Bacon Bacon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:9,tags:["Breakfast","Red","Food"]},is_available:!1,unlock:"purchase"},{id:2306,name:"Scavenger Statue Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:10,tags:["Scavenger","Blue","Wizard"]},is_available:!1,unlock:"purchase"},{id:2307,name:"Scavenger Map Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:11,tags:["Scavenger","Wizard"]},is_available:!1,unlock:"purchase"},{id:2308,name:"Scavenger Magnifeye Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:12,tags:["Scavenger","Blue"]},is_available:!1,unlock:"purchase"},{id:2309,name:"Scavenger Compass Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:13,tags:["Scavenger","Blue"]},is_available:!1,unlock:"purchase"},{id:2310,name:"Scavenger Monocle Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:14,tags:["Scavenger","Yellow"]},is_available:!1,unlock:"purchase"},{id:2311,name:"Paint Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:15,tags:["Pencil2","Sep23","Rainbow"]},is_available:!1,unlock:"purchase"},{id:2312,name:"Science Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:0,tags:["Pencil2","Sep23","Blue","Purple","Red"]},is_available:!1,unlock:"purchase"},{id:2313,name:"Schoolbus Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:1,tags:["Pencil2","Sep23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2314,name:"Math Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:2,tags:["Pencil2","Sep23","Black"]},is_available:!1,unlock:"purchase"},{id:2315,name:"Sharkbucks Stamp",price:6900,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:3,tags:["Sep22","Green","Face"]},is_available:!0,unlock:"purchase"},{id:2316,name:"Kilzomatic Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:4,tags:["Sep22","Drops3","Blue","Eggs"]},is_available:!1,unlock:"manual"},{id:2317,name:"Diablo Sticker Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:5,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2318,name:"Pablo Sticker Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:6,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2319,name:"The Jaw Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:8,tags:["Sep22","Drops3","Face","Black"]},is_available:!1,unlock:"manual"},{id:2320,name:"Pablo GG Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:7,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2321,name:"Trick Or Treat Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:9,tags:["Halloween3","OctM23","Orange"]},is_available:!0,unlock:"purchase"},{id:2322,name:"Scary Clown Face Stamp",price:1990,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:10,tags:["Halloween3","OctM23","It"]},is_available:!0,unlock:"purchase"},{id:2323,name:"KJDCitsme Jacko Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:14,tags:["Halloween3","OctM23","Face"]},is_available:!0,unlock:"purchase"},{id:2324,name:"KJDCitsme Shock Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:11,tags:["Halloween3","OctM23","Face"]},is_available:!0,unlock:"purchase"},{id:2325,name:"Thee_Owl Breakout Yolk Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:13,tags:["Halloween3","OctM23","Yellow","Face"]},is_available:!0,unlock:"purchase"},{id:2326,name:"Thee_Owl Peekout Yolk Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:9,tags:["Halloween3","OctM23","Yellow","Face"]},is_available:!0,unlock:"purchase"},{id:2327,name:"Waldoh Scratch Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:12,tags:["Halloween3","OctM23","Face","Black"]},is_available:!0,unlock:"purchase"},{id:2328,name:"Artshocks Half Asleep Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:10,tags:["Halloween3","OctM23","Face"]},is_available:!0,unlock:"purchase"},{id:2329,name:"Scared Stupid Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:8,tags:["Halloween3","OctM23","Face","Black"]},is_available:!0,unlock:"purchase"},{id:2330,name:"One Cluck Man Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:7,tags:["Halloween3","OctM23","Face"]},is_available:!0,unlock:"purchase"},{id:2331,name:"Skullface Kills Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:6,tags:["Halloween3","OctM23","Eggs"]},is_available:!0,unlock:"purchase"},{id:2332,name:"Witches Broom Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:15,tags:["Halloween3","OctM23","Brown"]},is_available:!0,unlock:"purchase"},{id:2333,name:"Fall Leaf Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:11,tags:["Thanksgiving","Brown"]},is_available:!1,unlock:"purchase"},{id:2334,name:"Turkey head on Stamp",price:400,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:12,tags:["Thanksgiving","Brown"]},is_available:!1,unlock:"purchase"},{id:2335,name:"Forest Shroom Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:13,tags:["Thanksgiving","Red","Food"]},is_available:!1,unlock:"purchase"},{id:2336,name:"Apple Core Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:14,tags:["Thanksgiving","Food"]},is_available:!1,unlock:"purchase"},{id:2337,name:"Drumstick Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:15,tags:["Thanksgiving","Brown","Food"]},is_available:!1,unlock:"purchase"},{id:2338,name:"It's Corn Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:4,tags:["Thanksgiving","Yellow","Green","Food"]},is_available:!1,unlock:"purchase"},{id:2339,name:"Corntastic Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:5,tags:["Thanksgiving","Yellow","Orange"]},is_available:!1,unlock:"purchase"},{id:2340,name:"You won a 1v1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:3,tags:["Badegg","Purple","Blue","Eggs"]},is_available:!1,unlock:"manual"},{id:2341,name:"Wizard Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:2,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2342,name:"Reload the clip Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:1,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2343,name:"Regeneration Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:0,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2344,name:"Upgrade Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:0,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2345,name:"Health Drop Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:1,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2346,name:"Sleeps Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:2,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2347,name:"Marksman Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:3,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2348,name:"Restocked Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:4,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2349,name:"Rambod Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:5,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2350,name:"Surprise! Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:6,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2351,name:"Goose Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:7,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2352,name:"New year 2023 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:8,tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2353,name:"Mixtape Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:9,tags:["Rockstar","JanM23","Grey","Gray","Music"]},is_available:!1,unlock:"purchase"},{id:2354,name:"Treble clef Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:10,tags:["Rockstar","JanM23","Black","Music"]},is_available:!1,unlock:"purchase"},{id:2355,name:"Rock on Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:11,tags:["Rockstar","JanM23","Yellow","Music"]},is_available:!1,unlock:"purchase"},{id:2356,name:"Buck Teeth",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:13,tags:["Groundhog","Feb23","Face"]},is_available:!1,unlock:"purchase"},{id:2357,name:"Alarm Clock Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:12,tags:["Groundhog","Newsletter","Feb23","White","Silver"]},is_available:!1,unlock:"manual"},{id:2358,name:"Horseshoe Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:15,tags:["farm","FebM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2359,name:"Sunflower Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:14,tags:["farm","FebM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2360,name:"CEO Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:0,tags:["League","Red"]},is_available:!1,unlock:"manual"},{id:2361,name:"LEV Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:1,tags:["League","Green"]},is_available:!1,unlock:"manual"},{id:2362,name:"RTV Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:2,tags:["League","Blue","Purple"]},is_available:!1,unlock:"manual"},{id:2363,name:"Shell Tournaments Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:3,tags:["League","Orange"]},is_available:!0,unlock:"purchase"},{id:2364,name:"NPS Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:4,tags:["League","White"]},is_available:!1,unlock:"manual"},{id:2365,name:"Shell Tournaments #1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:5,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2366,name:"Hello my name is Pablo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:6,tags:["Drops4","Mar23","AugM23","Red"]},is_available:!1,unlock:"purchase"},{id:2367,name:"Happily Fried Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:7,tags:["Drops4","Mar23","AugM23","White","Eggs"]},is_available:!1,unlock:"purchase"},{id:2368,name:"Game Of The Year Stamp",price:350,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:8,tags:["Drops4","Mar23","Yellow","GOTY"]},is_available:!1,unlock:"purchase"},{id:2369,name:"Wizards on Fire! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:9,tags:["Drops4","Mar23","Blue","BWD"]},is_available:!1,unlock:"purchase"},{id:2370,name:"Banned Aid Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:10,tags:["Drops4","Mar23","Brown"]},is_available:!1,unlock:"purchase"},{id:2371,name:"xQc Ape Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:11,tags:["Drops4","Mar23","White"]},is_available:!1,unlock:"manual"},{id:2372,name:"Shell Shockers Logo Stamp",price:50,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:12,tags:["Drops4","Mar23","Eggs","White"]},is_available:!1,unlock:"purchase"},{id:2373,name:"Griffen Chin Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:13,tags:["Drops4","Mar23","Face","Black"]},is_available:!1,unlock:"manual"},{id:2374,name:"That's a Fowl Stamp",price:150,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:14,tags:["Bros","MarM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2375,name:"Stuffed Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:15,tags:["Bros","MarM23"]},is_available:!1,unlock:"purchase"},{id:2376,name:"Bear Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:0,tags:["Bros","MarM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2377,name:"Tiger Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:1,tags:["Bros","MarM23","Tiger","Cat"]},is_available:!1,unlock:"purchase"},{id:2378,name:"Basket Bros Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:2,tags:["Bros","MarM23","Orange"]},is_available:!1,unlock:"purchase"},{id:2379,name:"Hydrate! Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:3,tags:["Bros","MarM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2380,name:"Egg Jordan Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:4,tags:["Bros","MarM23","Black","Eggs"]},is_available:!1,unlock:"purchase"},{id:2381,name:"Kiss me I'm Irish Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:5,tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:2382,name:"Monster Talisman Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:6,tags:["Monsters","Apr23"]},is_available:!1,unlock:"purchase"},{id:2383,name:"Hero Talisman Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:7,tags:["Heroes","Apr23"]},is_available:!1,unlock:"purchase"},{id:2384,name:"Judgement arrow Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:8,tags:["Apr23","Gold","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:2385,name:"Critical Hit Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:9,tags:["Apr23","Red","Gold","D20","Yellow"]},is_available:!1,unlock:"purchase"},{id:2386,name:"Breath Weapon Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:10,tags:["Apr23","Red","Gold","Dragon"]},is_available:!1,unlock:"purchase"},{id:2387,name:"Egg Org & Eggventure Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:11,tags:["Apr23","Red","Gold","Dragon"]},is_available:!1,unlock:"purchase"},{id:2388,name:"Heroes Potion Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:12,tags:["Heroes","Apr23","Green","Heart"]},is_available:!1,unlock:"manual"},{id:2389,name:"Monsters Potion Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:13,tags:["Apr23","Monsters","Red","Skull"]},is_available:!1,unlock:"manual"},{id:2390,name:"Monobrow Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:14,tags:["May23","Dino2","Black","Face"]},is_available:!1,unlock:"purchase"},{id:2391,name:"Slay the Beast Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:15,tags:["May23","Dino2","Black"]},is_available:!1,unlock:"purchase"},{id:2392,name:"Caveman Classic Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:0,tags:["May23","Dino2","Face","Smile"]},is_available:!1,unlock:"purchase"},{id:2393,name:"Stone Tools Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:1,tags:["May23","Dino2","Brown"]},is_available:!1,unlock:"purchase"},{id:2394,name:"Chart Stamp",price:10,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:3,tags:["MayM23","Eggflation","Red"]},is_available:!0,unlock:"purchase"},{id:2395,name:"Money Tree Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:4,tags:["MayM23","Eggflation","Green"]},is_available:!0,unlock:"purchase"},{id:2396,name:"Eggflation Rollercoaster Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:2,tags:["MayM23","Eggflation","Red"]},is_available:!0,unlock:"purchase"},{id:2397,name:"HODL Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:5,tags:["MayM23","Eggflation"]},is_available:!0,unlock:"purchase"},{id:2398,name:"Polaroid Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:6,tags:["Jun23","Photo","Eggs"]},is_available:!1,unlock:"purchase"},{id:2399,name:"Wedding Crasher Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:7,tags:["Jun23","Photo","Blue"]},is_available:!1,unlock:"purchase"},{id:2400,name:"Apature Stamp",price:825,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:8,tags:["Jun23","Photo","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2401,name:"Dour Mustache Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:9,tags:["Jun23","Photo","Brown"]},is_available:!1,unlock:"purchase"},{id:2402,name:"Starfish Stamp",price:505,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:10,tags:["JunM23","Summer2","Red"]},is_available:!1,unlock:"purchase"},{id:2403,name:"Jellyfish Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:11,tags:["JunM23","Summer2","White"]},is_available:!1,unlock:"purchase"},{id:2404,name:"Beach Vibes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:12,tags:["JunM23","Summer2"]},is_available:!1,unlock:"purchase"},{id:2405,name:"Beach Ball Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:13,tags:["JunM23","Summer2","White","Blue","Yellow","Red"]},is_available:!1,unlock:"purchase"},{id:2406,name:"Equinox Sun Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:0,tags:["July23","Equinox","Yellow"]},is_available:!1,unlock:"purchase"},{id:2407,name:"Equinox Moon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:1,tags:["July23","Equinox","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2408,name:"Equinox YinYang Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:14,tags:["July23","Equinox","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2409,name:"Pablodala Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:15,tags:["July23","Equinox","Mandala","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2410,name:"Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:2,tags:["JulyM23","Sports2"]},is_available:!1,unlock:"purchase"},{id:2411,name:"Grind Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:4,tags:["JulyM23","Sports2","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2412,name:"Fellow Kids Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:3,tags:["JulyM23","Sports2","Red","Skateboard"]},is_available:!1,unlock:"purchase"},{id:2413,name:"Safety Team Approved Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:5,tags:["JulyM23","Sports2"]},is_available:!1,unlock:"purchase"},{id:2414,name:"The MenoXD Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:6,tags:["JulyM23","Red","xd"]},is_available:!0,unlock:"purchase"},{id:2415,name:"Red S-tier Racing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:7,tags:["Aug23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2416,name:"Green S-tier Racing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:8,tags:["Aug23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2417,name:"Question block Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:9,tags:["Aug23","Yellow","?"]},is_available:!1,unlock:"purchase"},{id:2418,name:"Racing Flags Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:10,tags:["Aug23","Black","White"]},is_available:!1,unlock:"purchase"},{id:2419,name:"Stopwatch Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:11,tags:["Newsletter","Aug23","White","Clock"]},is_available:!1,unlock:"manual"},{id:2420,name:"Shy Egg Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:12,tags:["Aug23","White"]},is_available:!1,unlock:"purchase"},{id:2421,name:"Banana Peel Stamp",price:1200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:13,tags:["Aug23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2422,name:"Respawn Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:14,tags:["Aug23","Mushroom","Green","1up"]},is_available:!1,unlock:"purchase"},{id:2423,name:"Om Nom Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:15,tags:["AugM23","Drops5","Yellow"]},is_available:!1,unlock:"purchase"},{id:2424,name:"Harrison Cat Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:0,tags:["AugM23","Drops5","Thumb","Black"]},is_available:!1,unlock:"purchase"},{id:2425,name:"Flushed Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:1,tags:["AugM23","Drops5"]},is_available:!1,unlock:"purchase"},{id:2426,name:"Albino Snake Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:2,tags:["AugM23","Drops5","Grey","Gray","ABHS"]},is_available:!1,unlock:"manual"},{id:2427,name:"Shell Wiki Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:3,tags:["AugM23","Drops5","Egg","White"]},is_available:!1,unlock:"purchase"},{id:2428,name:"Wiz Ears Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:4,tags:["AugM23","Drops5","Blue","BWD"]},is_available:!1,unlock:"purchase"},{id:2429,name:"r/place Pablo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:5,tags:["AugM23","Drops5","Yellow","Orange","Smile"]},is_available:!1,unlock:"manual"},{id:2430,name:"r/place BWD skull Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:6,tags:["AugM23","Drops5","Blue"]},is_available:!1,unlock:"manual"},{id:2431,name:"r/place BWD logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:7,tags:["AugM23","Drops5","Blue"]},is_available:!1,unlock:"manual"},{id:2432,name:"Solve for X Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:8,tags:["Sep23","Pencil3","Orange"]},is_available:!1,unlock:"purchase"},{id:2433,name:"Anarchy Academy",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:9,tags:["Sep23","Pencil3","Red"]},is_available:!1,unlock:"purchase"},{id:2434,name:"Egg-lectrons Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:10,tags:["Sep23","Pencil3","Science","Black"]},is_available:!1,unlock:"purchase"},{id:2435,name:"Blue Wizard Wrestling Federation Logo",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:12,tags:["SepM23","WBs","Wrestle","BWD","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2436,name:"Bron Lester Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:13,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2437,name:"Jan Seeya Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:14,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2438,name:"Rocky Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:15,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2439,name:"Brogan Paw Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:0,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2440,name:"Romeo Rain Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:1,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2441,name:"Nacho Mann Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:2,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2442,name:"Death Brawlin Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:3,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2443,name:"Bulk Logan Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:4,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2444,name:"Ray Mystery Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:5,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2445,name:"Binky Flinch Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:6,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2446,name:"Bonka Beware Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:7,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2447,name:"Wrestlebros 1v1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:11,tags:["SepM23","WBs","Blue","Purple"]},is_available:!1,unlock:"manual"},{id:2448,name:"Rotting Zombie Fish Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:8,tags:["Oct23","Halloween4","Blue"]},is_available:!0,unlock:"purchase"},{id:2449,name:"Shark Chomp Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:9,tags:["Oct23","Halloween4","Blue"]},is_available:!0,unlock:"purchase"},{id:2450,name:"Squiddy Friend Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:10,tags:["Oct23","Halloween4","Pink"]},is_available:!0,unlock:"purchase"},{id:2451,name:"Venomous Sea Snake Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:11,tags:["Oct23","Halloween4","Green"]},is_available:!0,unlock:"purchase"},{id:2452,name:"Bait Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:12,tags:["Oct23","Halloween4","Pink"]},is_available:!0,unlock:"purchase"},{id:2453,name:"Wilson. Wilson... WILSON!",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:13,tags:["Oct23","Halloween4","Red"]},is_available:!0,unlock:"purchase"},{id:2454,name:"Demonic Face Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:14,tags:["Oct23","Face"]},is_available:!1,unlock:"manual"},{id:2455,name:"Boo Crew Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:15,tags:["OctM23","Text","Purple"]},is_available:!0,unlock:"purchase"},{id:2456,name:"Cool Maid Face",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:0,tags:["OctM23","Face"]},is_available:!0,unlock:"purchase"},{id:2457,name:"Ghoul Power Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:1,tags:["OctM23","Text","Pink"]},is_available:!0,unlock:"purchase"},{id:2458,name:"Ghost Malone",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:2,tags:["OctM23","Meme","White"]},is_available:!0,unlock:"purchase"},{id:2459,name:"Seen too much Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:3,tags:["OctM23","Purple"]},is_available:!0,unlock:"purchase"},{id:2460,name:"Pumpkin Wizard Digital",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:4,tags:["OctM23","Orange","BWD","Infinite Smasher"]},is_available:!0,unlock:"purchase"},{id:2461,name:"Get Ghosted Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:5,tags:["OctM23","Black","Ghost","Text"]},is_available:!0,unlock:"purchase"},{id:3100,name:"The Eggk-47",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47",tags:["default","Blue","Purple"]},is_available:!0,unlock:"default"},{id:3101,name:"GOLD Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3102,name:"Happy Bear Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3103,name:"Halloween Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!0,unlock:"purchase"},{id:3104,name:"Thanksgiving Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Turkey",tags:["Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3105,name:"Christmas Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3106,name:"New Year 2019 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear",tags:["NewYears2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3107,name:"Groundhog Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3108,name:"Buck Rogers Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3109,name:"Valentines Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3110,name:"St Patricks Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3111,name:"Easter Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Easter",tags:["Easter","Red","Eggs"]},is_available:!1,unlock:"purchase"},{id:3112,name:"Flame Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3113,name:"Rainbow Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3114,name:"Steampunk Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3115,name:"Memphis Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Memphis",tags:["Memphis","Blue","Orange","Purple"]},is_available:!0,unlock:"purchase"},{id:3116,name:"Eggwalker Eggk-47",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3117,name:"Nuke Zone Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NukeZone",tags:["NukeZone","Black","Neon","Pink"]},is_available:!0,unlock:"purchase"},{id:3118,name:"New Year 2020 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2020",tags:["NewYears2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3119,name:"Country Singer Eggk-47",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3120,name:"Albino Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3121,name:"Raid Land Eggk-47",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_RaidLand",tags:["RaidLand","Blue","Black"]},is_available:!1,unlock:"purchase"},{id:3122,name:"Toxic Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3123,name:"Music Eggk-47",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Music",tags:["Rockstar","JanM23","Black"]},is_available:!1,unlock:"purchase"},{id:3124,name:"Galeggsy Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3125,name:"Chicken Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3126,name:"Techno Eggk-47",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Techno",tags:["Premium","sale","Blue","Yellow","Black","Pog"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["gun_eggk47_techno"]},{id:3127,name:"New Year 2021 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3128,name:"Car Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_car",tags:["Cars","Trains","Blue"]},is_available:!0,unlock:"purchase"},{id:3129,name:"Merc Zone Eggk-47",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Merc",tags:["Merc","Suit","Black","Tie","Blue"]},is_available:!0,unlock:"purchase"},{id:3130,name:"Summer Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3131,name:"Pencil Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Pencil",tags:["Pencil","Sep23","Yellow"]},is_available:!1,unlock:"purchase"},{id:3132,name:"New Year 2022 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3133,name:"Cards Eggk-47",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3134,name:"Retro Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Retro",tags:["Retro","Premium","Pixel","FebM23","Blue","Purple","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_ak_retro"]},{id:3135,name:"Dino Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Dino",tags:["Dino","May23","Red","Brown"]},is_available:!1,unlock:"purchase"},{id:3136,name:"Valkyrie Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_ak_valkyrie"]},{id:3137,name:"Eggwalker Alt Eggk-47",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:3138,name:"SPORTS Eggk-47",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Sports",tags:["Sports","JulyM23","Brown","Orange","Cricket","Bat"]},is_available:!1,unlock:"purchase"},{id:3139,name:"Breakfast Eggk-47",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Breakfast",tags:["Breakfast","Food","Brown","Syrup","Waffles"]},is_available:!1,unlock:"purchase"},{id:3140,name:"New Year 2023 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3141,name:"Farm Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Farm",tags:["Farm","FebM23","Food","Orange","Green","Carrot"]},is_available:!1,unlock:"purchase"},{id:3142,name:"Fusion Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Fusion",tags:["Premium","fusion","FebM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak47_fusion"]},{id:3143,name:"Hero Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Fantasy",tags:["Heroes","Apr23","Sword","Silver"]},is_available:!1,unlock:"purchase"},{id:3144,name:"Monster Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_FantasyEvil",tags:["Monsters","Apr23","Purple","Sword"]},is_available:!1,unlock:"purchase"},{id:3145,name:"Equinox Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3146,name:"Paintball Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Paintball",tags:["Sports2","JulyM23","Grey","Gray","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:3147,name:"Kart Eggk-47",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Kart",tags:["Kart","Aug23","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3148,name:"BWD Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Wizard",tags:["Drops5","AugM23","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3149,name:"Infernal Eggk-47",price:4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Infernal",tags:["OctM23","Red","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak_infernal"]},{id:3400,name:"The Free Ranger",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1",tags:["default","Orange","Green","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3401,name:"GOLD Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3402,name:"Happy Bear Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3403,name:"Halloween Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!0,unlock:"purchase"},{id:3404,name:"Thanksgiving Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Turkey",tags:["Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3405,name:"Christmas Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3406,name:"New Year 2019 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear",tags:["NewYears2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3407,name:"Groundhog Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3408,name:"Buck Rogers Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3409,name:"Valentines Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3410,name:"St Patricks Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3411,name:"Easter Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Easter",tags:["Easter","Blue","Eggs"]},is_available:!1,unlock:"purchase"},{id:3412,name:"Flame Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3413,name:"Rainbow Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3414,name:"Steampunk Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3415,name:"Memphis Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Memphis",tags:["Memphis","Blue","Orange","Purple"]},is_available:!0,unlock:"purchase"},{id:3416,name:"Eggwalker Free Ranger",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_spaceEgg",tags:["sale","Eggwalker","July23","Black","Grey","Gray","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_csg1_space"]},{id:3417,name:"Nuke Zone Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NukeZone",tags:["NukeZone","Yellow","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:3418,name:"New Year 2020 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2020",tags:["NewYears2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3419,name:"Country Singer Free Ranger",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3420,name:"Albino Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3421,name:"Raid Land Free Ranger",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RaidLand",tags:["RaidLand","Blue","Yellow","Brown","Wings"]},is_available:!1,unlock:"purchase"},{id:3422,name:"Toxic Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3423,name:"Music Free Ranger",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Music",tags:["Rockstar","JanM23","Black","Guitar"]},is_available:!1,unlock:"purchase"},{id:3424,name:"Galeggsy Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3425,name:"Chicken Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3426,name:"Techno Free Ranger",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Techno",tags:["Premium","Techno","Cats","Catz","Purple","Yellow","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_csg1_techno"]},{id:3427,name:"New Year 2021 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3428,name:"Car Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_car",tags:["Cars","Trains","Red","Firetruck"]},is_available:!0,unlock:"purchase"},{id:3429,name:"Merc Zone Free Ranger",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Merc",tags:["Merc","Suit","Black","Tie","Yellow"]},is_available:!0,unlock:"purchase"},{id:3430,name:"Summer Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3431,name:"Retro Free Ranger",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Retro",tags:["Retro","Premium","Pixel","Green","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_csg1_retro"]},{id:3432,name:"Pencil Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Pencil",tags:["Pencil","Sep23","Yellow","Paintbrush"]},is_available:!1,unlock:"purchase"},{id:3433,name:"New Year 2022 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3434,name:"BWD Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Wizard",tags:["Drops","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3435,name:"Cards Free Ranger",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3436,name:"Dino Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Dino",tags:["Dino","May23","Green","Orange"]},is_available:!1,unlock:"purchase"},{id:3437,name:"Eggpire Free Ranger",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3438,name:"SPORTS Free Ranger",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Sports",tags:["Sports","JulyM23","Brown","White","Baseball"]},is_available:!1,unlock:"purchase"},{id:3439,name:"Rubber Chicken Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RubberChicken",tags:["Aug23","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_csg1_rubchick"]},{id:3440,name:"Breakfast Free Ranger",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Breakfast",tags:["Breakfast","Food","Toast","Brown","Eggs","Bread"]},is_available:!1,unlock:"purchase"},{id:3441,name:"Valkyrie Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Valkyrie",tags:["Valkyrie","Premium","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_range_valk"]},{id:3442,name:"New Year 2023 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3443,name:"Fusion Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Fusion",tags:["Premium","JanM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_csg1_fusion"]},{id:3444,name:"Farm Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Farm",tags:["Farm","FebM23","Food","Yellow","Green","Corn"]},is_available:!1,unlock:"purchase"},{id:3445,name:"Shellpreme Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Shellpreme",tags:["MayM23","Eggflation","Premium","Red"]},is_available:!0,unlock:"premium",activeProduct:!1,sku:["item_csg1_shellpreme"]},{id:3446,name:"Equinox Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3447,name:"Kart Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Kart",tags:["Aug23","Kart","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:3448,name:"lifeofnurse Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Nurse",tags:["AugM23","Drops5","Blue","Purple","Heart"]},is_available:!1,unlock:"manual"},{id:3449,name:"Bone Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bones",tags:["OctM23","Halloween4","Bone","White"]},is_available:!0,unlock:"purchase"},{id:3600,name:"The Scrambler",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge",tags:["default","Orange","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3601,name:"GOLD Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3602,name:"Happy Bear Scrambler ",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3603,name:"Halloween Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!0,unlock:"purchase"},{id:3604,name:"Thanksgiving Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Turkey",tags:["Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3605,name:"Christmas Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3606,name:"New Year 2019 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear",tags:["NewYears2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3607,name:"Groundhog Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3608,name:"Buck Rogers Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3609,name:"Valentines Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3610,name:"St Patricks Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3611,name:"Easter Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Easter",tags:["Easter","Yellow","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:3612,name:"Flame Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3613,name:"Rainbow Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3614,name:"Steampunk Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3615,name:"Memphis Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Memphis",tags:["Memphis","Yellow","Green","Black","White"]},is_available:!0,unlock:"purchase"},{id:3616,name:"Eggwalker Scrambler",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3617,name:"Nuke Zone Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NukeZone",tags:["NukeZone","Black","Blue","Neon"]},is_available:!0,unlock:"purchase"},{id:3618,name:"New Year 2020 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2020",tags:["NewYears2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3619,name:"Country Singer Scrambler",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3620,name:"Albino Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3621,name:"Raid Land Scrambler",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_RaidLand",tags:["RaidLand","Brown","White"]},is_available:!1,unlock:"purchase"},{id:3622,name:"Toxic Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3623,name:"Music Scrambler",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Music",tags:["Rockstar","JanM23","Red","Gold","Guitar"]},is_available:!1,unlock:"purchase"},{id:3624,name:"Galeggsy Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3625,name:"Killstreak Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Killstreak",tags:["Killstreak","Smile","Yellow","Brown","Blue"]},is_available:!1,unlock:"manual"},{id:3626,name:"Chicken Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3627,name:"Techno Scrambler",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Techno",tags:["Techno","premium","SepM23","Badoosh","Red","Purple","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["gun_gauge_techno"]},{id:3628,name:"New Year 2021 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3629,name:"Car Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_car",tags:["Cars","Trains","Yellow"]},is_available:!0,unlock:"purchase"},{id:3630,name:"Merc Zone Scrambler",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Merc",tags:["Merc","Suit","Black","Tie","Orange"]},is_available:!0,unlock:"purchase"},{id:3631,name:"Summer Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3632,name:"Pencil Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Pencil",tags:["Pencil","Sep23","Highlighter"]},is_available:!1,unlock:"purchase"},{id:3633,name:"BWD Fan-art Scrambler",price:15e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_BWD",tags:["Kids","Wizard","Blue","Rainbow"]},is_available:!0,unlock:"purchase"},{id:3634,name:"Retro Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Retro",tags:["Retro","Premium","Pixel","Grey","Gray","Orange","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_crack_retro"]},{id:3635,name:"New Year 2022 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3636,name:"Thee_Owl Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_TheeOwl",tags:["Relic","Drops2","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3637,name:"Basket Bros Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Basketball",tags:["Bros","JulyM23","Orange","Hoops"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_bros"]},{id:3638,name:"Cards Scrambler",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3639,name:"JWBerry3D Scrambler",price:75e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_JWBerry",tags:["Relic","Black","Red","Glasses"]},is_available:!0,unlock:"purchase"},{id:3640,name:"Dino Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Dino",tags:["Dino","May23","Blue"]},is_available:!1,unlock:"purchase"},{id:3641,name:"Eggpire Scrambler",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3642,name:"Valkyrie Scrambler",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Valkyrie",tags:["Eggwalker2","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_valk"]},{id:3643,name:"SPORTS Scrambler",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Sports",tags:["Sports","JulyM23","Black","White","Green","Soccer","Football"]},is_available:!1,unlock:"purchase"},{id:3644,name:"Breakfast Scrambler",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Breakfast",tags:["Breakfast","Food","Red","Ketchup"]},is_available:!1,unlock:"purchase"},{id:3645,name:"Sharkbucks Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Sharkbucks",tags:["Sep22","Drops3","Blue","Smile"]},is_available:!1,unlock:"manual"},{id:3646,name:"Kilzomatic Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Kilzomatic",tags:["Sep22","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:3647,name:"Badegg Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Badegg",tags:["Badegg","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3648,name:"New Year 2023 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3649,name:"Sleigh Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Christmas",tags:["Newsletter","Red","White","Gold","Sleigh"]},is_available:!1,unlock:"manual"},{id:3650,name:"Octopus Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Octopus",tags:["premFeatTwo","JanM23","Oct23","Blue","Pink"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gauge_octopus"]},{id:3651,name:"Farm Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Farm",tags:["Farm","FebM23","Food","Yellow","Gold","Wheat"]},is_available:!1,unlock:"purchase"},{id:3652,name:"BWD Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Wizard",tags:["Drops4","Mar23","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3653,name:"Green Snake Scrambler",price:15e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SnakePatrick",tags:["Mar23","StPatricksDay","Snek"]},is_available:!1,unlock:"purchase"},{id:3654,name:"Beholder Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Fantasy",tags:["Monsters","Apr23","Purple","Yellow","Eyes"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gauge_monster"]},{id:3655,name:"Fusion Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Fusion",tags:["Premium","MidM23","Fusion","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_fusion"]},{id:3656,name:"Equinox Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3657,name:"Kart Scrambler",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Kart",tags:["Aug23","Kart","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3e3,name:"The Cluck 9mm",price:0,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm",tags:["Red","Grey","Gray","Silver"]},is_available:!0,unlock:"default"},{id:3001,name:"GOLD Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3002,name:"Happy Bear Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3003,name:"Halloween Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!0,unlock:"purchase"},{id:3004,name:"Thanksgiving Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Turkey",tags:["Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3005,name:"Christmas Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3006,name:"New Years 2019 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear",tags:["NewYears2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3007,name:"Groundhog Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3008,name:"Buck Rogers Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Buck",tags:["Promotional","Gray","Grey","Silver"]},is_available:!1,unlock:"manual"},{id:3009,name:"Valentines Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3010,name:"St Patricks Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3011,name:"Easter Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Easter",tags:["Easter","Pink","Blue","Eggs"]},is_available:!1,unlock:"purchase"},{id:3012,name:"Flame Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3013,name:"Rainbow Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3014,name:"Steampunk Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3015,name:"Memphis Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Memphis",tags:["Memphis","White","Black","Pink"]},is_available:!0,unlock:"purchase"},{id:3016,name:"Eggwalker Cluck 9mm",price:4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_space"]},{id:3017,name:"Nuke Zone Skin Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NukeZone",tags:["NukeZone","Yellow","Black","Neon"]},is_available:!1,unlock:"manual"},{id:3018,name:"New Years 2020 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2020",tags:["NewYears2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3019,name:"Country Singer Cluck 9mm",price:1e5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3020,name:"Albino Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_SnakeAlbino",tags:["EggyCashAlbino","Snek","White","Gray","Grey","Red","ABHS"]},is_available:!1,unlock:"manual"},{id:3021,name:"Raid Land Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_RaidLand",tags:["RaidLand","Newsletter","Rabbit","Wabbit","Heart","Green","Brown"]},is_available:!1,unlock:"manual"},{id:3022,name:"Toxic Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3023,name:"Music Cluck 9mm",price:8e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Music",tags:["Rockstar","JanM23","Grey","Gray","Harmonica"]},is_available:!1,unlock:"purchase"},{id:3024,name:"Galeggsy Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3025,name:"Techno Cluck 9mm",price:10,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Techno",tags:["AprM23","Red","Orange","Yellow","Pop","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_9mm_techno"]},{id:3026,name:"Cubic Castles Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_CubicCastles",tags:["CubicCastles","White","Black","Red","Skull"]},is_available:!1,unlock:"manual"},{id:3027,name:"Chicken Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3028,name:"New Years 2021 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3029,name:"Retro Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Retro",tags:["Retro","Premium","Pixel","Red","Gray","Grey","Silver","Wings","OctM23","premFeatOne"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_retro_9mm"]},{id:3030,name:"Car Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_car",tags:["Cars","Trains","Red"]},is_available:!0,unlock:"purchase"},{id:3031,name:"Merc Zone Cluck 9mm",price:7e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Merc",tags:["Merc","Suit","Black","Tie","Red"]},is_available:!0,unlock:"purchase"},{id:3032,name:"Summer Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3033,name:"Lyerpald Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_lyerpald",tags:["Dog","Grey","Gray","Purple"]},is_available:!0,unlock:"purchase"},{id:3034,name:"Pencil Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Pencil",tags:["Pencil","Sep23","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3035,name:"Devilish Cluck 9mm",price:15e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Devilish",tags:["Kids","Red","Black","Purple","Fork"]},is_available:!0,unlock:"purchase"},{id:3036,name:"Bone Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bones",tags:["Halloween2","Oct23"]},is_available:!0,unlock:"purchase"},{id:3037,name:"New Years 2022 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3038,name:"Eggsmas Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Christmas",tags:["Christmas","Newsletter","Red","Yellow","Green","Gold","Sleigh"]},is_available:!1,unlock:"manual"},{id:3039,name:"Cards Cluck 9mm",price:1520,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Cards",tags:["EGGORG","Apr23"]},is_available:!1,unlock:"purchase"},{id:3040,name:"BWD Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Wizard",tags:["Relic","Drops2","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3041,name:"Dino Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Dino",tags:["Dino","May23","Brown","Yellow"]},is_available:!1,unlock:"purchase"},{id:3042,name:"Eggpire Cluck 9mm",price:12500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3043,name:"SPORTS Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Sports",tags:["Sports","JulyM23","White","Bowling","Pin"]},is_available:!1,unlock:"purchase"},{id:3044,name:"Breakfast Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Breakfast",tags:["Breakfast","Food","Apple","Juice","Red"]},is_available:!1,unlock:"purchase"},{id:3045,name:"Valkyrie Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Valkyrie",tags:["Scavenger","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_valk"]},{id:3046,name:"Protractor Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Protractor",tags:["Pencil2","Sep23","Grey","Gray","Black"]},is_available:!1,unlock:"purchase"},{id:3047,name:"Badegg Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Badegg",tags:["Badegg","Yellow"]},is_available:!1,unlock:"purchase"},{id:3048,name:"New Year 2023 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3049,name:"Aquarius Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Aquarius",tags:["Groundhog","Feb23","Blue","Stars"]},is_available:!1,unlock:"purchase"},{id:3050,name:"Cloudkicker Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Clouds",tags:["Premium","Feb23","Clouds","Rainbow","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_9mm_cloud"]},{id:3051,name:"Farm Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Farm",tags:["Farm","FebM23","Food","Red","Tomato"]},is_available:!1,unlock:"purchase"},{id:3052,name:"Thee_Owl Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_TheeOwl",tags:["Drops4","Mar23","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3053,name:"Merc Zone Final Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_MercF",tags:["Merc","Suit","Black","Tie"]},is_available:!1,unlock:"manual"},{id:3054,name:"Fusion Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Fusion",tags:["Premium","AprM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_9mm_fusion"]},{id:3055,name:"Camera Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Camera",tags:["Jun23","Photo","Smile","Meme"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_9mm_camera"]},{id:3056,name:"Equinox Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3057,name:"Kart Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Kart",tags:["Aug23","Kart","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:3058,name:"Slingshot Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Slingshot",tags:["Sep23","Pencil3"]},is_available:!1,unlock:"purchase"},{id:3059,name:"Megaphone Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Megaphone",tags:["Sep23","Red","White"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_9mm_mega"]},{id:3060,name:"Mouse Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Mouse",tags:["Sep23","Grey","Gray","Yellow","Cheese"]},is_available:!1,unlock:"purchase"},{id:3800,name:"The RPEGG",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg",tags:["default","Yellow","Green","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3801,name:"GOLD RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3802,name:"Happy Bear RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3804,name:"Thanksgiving RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Turkey",tags:["Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3805,name:"Christmas RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3806,name:"New Year 2019 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear",tags:["NewYears2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3807,name:"Groundhog RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3808,name:"Buck Rogers RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3809,name:"Valentines RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3810,name:"St Patricks RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3811,name:"Easter RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Easter",tags:["Easter","Orange","Eggs"]},is_available:!1,unlock:"purchase"},{id:3812,name:"Flame RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3813,name:"Rainbow RPEGG",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3814,name:"Steampunk RPEGG",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3815,name:"Memphis RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Memphis",tags:["Memphis","Black","White"]},is_available:!0,unlock:"purchase"},{id:3816,name:"Halloween Skin RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!0,unlock:"purchase"},{id:3817,name:"Eggwalker RPEGG",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3818,name:"Nuke Zone RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NukeZone",tags:["NukeZone","Black","Green","Neon"]},is_available:!0,unlock:"purchase"},{id:3819,name:"New Year 2020 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2020",tags:["NewYears2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3820,name:"Country Singer RPEGG",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3821,name:"Albino RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3822,name:"Raid Lands RPEGG",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_RaidLand",tags:["RaidLand","Silver","Grey","Gray","Green"]},is_available:!1,unlock:"purchase"},{id:3823,name:"Toxic RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3824,name:"Music RPEGG",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Music",tags:["Rockstar","JanM23","Yellow","Gold","Tuba"]},is_available:!1,unlock:"purchase"},{id:3825,name:"Galeggsy RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3826,name:"Chicken RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3827,name:"New Year 2021 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3828,name:"Techno RPEGG",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Techno",tags:["Techno","Premium","JunM23","Yeet","Rainbow","Red","Yellow","Green","Blue","Purple"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_rpeggTechno"]},{id:3829,name:"Car RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_car",tags:["Cars","Trains","Silver"]},is_available:!0,unlock:"purchase"},{id:3830,name:"Merc Zone RPEGG",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Merc",tags:["Merc","Suit","Black","Tie","Green"]},is_available:!0,unlock:"purchase"},{id:3831,name:"Summer RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3832,name:"Pencil RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Pencil",tags:["Pencil","Sep23","Yellow","Tape"]},is_available:!1,unlock:"purchase"},{id:3833,name:"Bone RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bones",tags:["Halloween2","Oct23"]},is_available:!0,unlock:"purchase"},{id:3834,name:"New Year 2022 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3835,name:"Retro RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Retro",tags:["Retro","Premium","Pixel","Mar23","Green","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_rpegg_retro"]},{id:3836,name:"Cards RPEGG",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3837,name:"Dino RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Dino",tags:["Dino","May23","Orange"]},is_available:!1,unlock:"purchase"},{id:3838,name:"Eggpire RPEGG",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3839,name:"SPORTS RPEGG",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Sports",tags:["Sports","JulyM23","Brown","Football"]},is_available:!1,unlock:"purchase"},{id:3840,name:"Breakfast RPEGG",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Breakfast",tags:["Breakfast","Food","Sausage"]},is_available:!1,unlock:"purchase"},{id:3841,name:"Scavenger RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Scavenger",tags:["Scavenger","Black","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:3842,name:"Egg Carton RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Eggs",tags:["Sep22","Drops3","Purple","Grey","Gray","Food"]},is_available:!1,unlock:"manual"},{id:3843,name:"Valkyrie RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Valkyrie",tags:["Valkyrie","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_rpegg_valk"]},{id:3844,name:"Santa Boot RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Christmas",tags:["Christmas","Premium","Red","White","Hohoho"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_rpegg_christ"]},{id:3845,name:"New Year 2023 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3846,name:"Farm RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Farm",tags:["Farm","FebM23","Barn","Red"]},is_available:!1,unlock:"purchase"},{id:3947,name:"Equinox RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3948,name:"MenoXD RPEGG",price:75e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Meno",tags:["JulyM23","Red","Black","xd"]},is_available:!0,unlock:"purchase"},{id:3949,name:"Kart RPEGG",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Kart",tags:["Kart","Aug23","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3950,name:"Thee_Owl RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_TheeOwl",tags:["Drops5","AugM23","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3951,name:"Fusion RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Fusion",tags:["Oct23","Premium","Blue","White","Gray","Grey"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_rpegg_fusion"]},{id:3952,name:"Skellington RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Skeleton",tags:["OctM23","Premium","Black","White"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_rpegg_skele"]},{id:4e3,name:"The Whipper",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg",tags:["default","Grey","Gray","Purple"]},is_available:!0,unlock:"default"},{id:4001,name:"GOLD Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4002,name:"Happy Bear Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4003,name:"Halloween Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!0,unlock:"purchase"},{id:4004,name:"Thanksgiving Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Turkey",tags:["Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:4005,name:"Christmas Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4006,name:"New Year 2019 Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear",tags:["NewYears2019","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:4007,name:"Groundhog Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:4008,name:"Buck Rogers Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4009,name:"Valentines Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:4010,name:"St Patricks Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:4011,name:"Easter Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Easter",tags:["Easter","Eggs","Purple"]},is_available:!1,unlock:"purchase"},{id:4012,name:"Flame Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:4013,name:"Rainbow Whipper",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4014,name:"Steampunk Whipper",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4015,name:"Memphis Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Memphis",tags:["Memphis","White","Black","Pink"]},is_available:!0,unlock:"purchase"},{id:4016,name:"Eggwalker Whipper",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:4017,name:"Nuke Zone Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NukeZone",tags:["NukeZone","Red","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:4018,name:"New Year 2020 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2020",tags:["NewYears2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:4019,name:"Country Singer Whipper",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4020,name:"Albino Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4021,name:"Raid Land Whipper",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_RaidLand",tags:["RaidLand","Blue"]},is_available:!1,unlock:"purchase"},{id:4022,name:"Toxic Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4023,name:"Music Whipper",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Music",tags:["Rockstar","JanM23","Red","Orange","Keytar","Piano"]},is_available:!1,unlock:"purchase"},{id:4024,name:"Galeggsy Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:4025,name:"Chicken Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:4026,name:"Techno Whipper",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Techno",tags:["Techno","AugM23","Tuh","Green","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_techno"]},{id:4027,name:"New Year 2021 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:4028,name:"Car Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_car",tags:["Cars","Trains","Purple"]},is_available:!0,unlock:"purchase"},{id:4029,name:"Merc Zone Whipper",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Merc",tags:["Merc","Suit","Black","Tie","Purple"]},is_available:!0,unlock:"purchase"},{id:4030,name:"Summer Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:4031,name:"Pencil Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Pencil",tags:["Pencil","Sep23","Yellow","Crayons"]},is_available:!1,unlock:"purchase"},{id:4032,name:"Retro Whipper",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Retro",tags:["Retro","Premium","Pixel","Purple","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_smg_retro"]},{id:4033,name:"New Year 2022 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4034,name:"Cards Whipper",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4035,name:"Dino Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Dino",tags:["Dino","May23","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:4036,name:"Eggpire Whipper",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4037,name:"SPORTS Whipper",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Sports",tags:["Sports","JulyM23","Red","Brown","Badminton"]},is_available:!1,unlock:"purchase"},{id:4038,name:"Breakfast Whipper",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Breakfast",tags:["Breakfast","Food","Brown","Red","Eggs","Bacon"]},is_available:!1,unlock:"purchase"},{id:4039,name:"Teggtris Whipper",price:1980,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Teggtris",tags:["Sep22","Mar23","Red","Orange","Yellow","Blue","Grey","Gray","Tetris","GameBoy"]},is_available:!1,unlock:"purchase"},{id:4040,name:"Turkey-Supreme Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SpecialTurkey",tags:["premium","Thanksgiving","Brown","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_smg_turk"]},{id:4041,name:"New Year 2023 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4042,name:"Valkyrie Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_valk"]},{id:4043,name:"Farm Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Farm",tags:["Farm","FebM23","Food","Green","Peas"]},is_available:!1,unlock:"purchase"},{id:4044,name:"Fusion Whipper",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Fusion",tags:["Premium"," Fusion","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_smg_fusion"]},{id:4045,name:"Eggflation Whipper",price:8e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Eggflation",tags:["Eggflation","MayM23","Gold","Yellow","Eggs"]},is_available:!0,unlock:"purchase"},{id:4046,name:"Equinox Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:4047,name:"Kart Whipper",price:3500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Kart",tags:["Kart","Aug23","Pink","Yellow","Princess","Peach"]},is_available:!1,unlock:"purchase"},{id:4048,name:"KJDCitsme Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_KJ",tags:["Drops5","AugM23","Pink","Purple","Blue"]},is_available:!1,unlock:"manual"},{id:4049,name:"Wrestlebros Whipper",price:3500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Wrestlebros",tags:["WBs","SepM23","Gold","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:4200,name:"The Crackshot",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24",tags:["default","Blue","Grey","Gray"]},is_available:!0,unlock:"default"},{id:4201,name:"GOLD Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4202,name:"Happy Bear Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4203,name:"Halloween Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!0,unlock:"purchase"},{id:4204,name:"Thanksgiving Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Turkey",tags:["Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:4205,name:"Christmas Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4206,name:"New Year 2019 Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear",tags:["NewYears2019","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:4207,name:"Groundhog Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:4208,name:"Buck Rogers Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4209,name:"Valentines Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:4210,name:"St Patricks Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:4211,name:"Easter Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Easter",tags:["Easter","Eggs","Green"]},is_available:!1,unlock:"purchase"},{id:4212,name:"Flame Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:4213,name:"Rainbow Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4214,name:"Steampunk Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4215,name:"Memphis Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Memphis",tags:["Memphis","Yellow","Black","White"]},is_available:!0,unlock:"purchase"},{id:4216,name:"Eggwalker Crackshot",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:4217,name:"Nuke Zone Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NukeZone",tags:["NukeZone","Black","Purple","Neon"]},is_available:!0,unlock:"purchase"},{id:4218,name:"New Year 2020 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2020",tags:["NewYears2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:4219,name:"Country Singer Crackshot",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4220,name:"Albino Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4221,name:"Raid Land Crackshot",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_RaidLand",tags:["RaidLand","May23","Purple","Brown"]},is_available:!1,unlock:"purchase"},{id:4222,name:"Toxic Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4223,name:"Techno Crackshot",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Techno",tags:["Premium","MayM23","Untz","Pink","Blue","Purple"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_techno"]},{id:4224,name:"Music Crackshot",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Music",tags:["Rockstar","JanM23","Red","Guitar"]},is_available:!1,unlock:"purchase"},{id:4225,name:"Galeggsy Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:4226,name:"Chicken Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:4227,name:"New Year 2021 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:4228,name:"Car Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_car",tags:["Cars","Trains","Blue","White","Limosine"]},is_available:!0,unlock:"purchase"},{id:4229,name:"Retro Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Retro",tags:["Retro","Premium","Pixel","Blue","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_m24_retro"]},{id:4230,name:"Merc Zone Crackshot",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Merc",tags:["Merc","Suit","Black","Tie","Blue","Teal"]},is_available:!0,unlock:"purchase"},{id:4231,name:"Summer Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:4232,name:"Pencil Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Pencil",tags:["Pencil","Sep23","Yellow","Stapler"]},is_available:!1,unlock:"purchase"},{id:4233,name:"New Year 2022 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4234,name:"Graysocean Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Graysocean",tags:["Drops","Blue"]},is_available:!1,unlock:"manual"},{id:4235,name:"Cards Crackshot",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4236,name:"Dino Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Dino",tags:["Dino","May23","Brown"]},is_available:!1,unlock:"purchase"},{id:4237,name:"Eggpire Crackshot",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4238,name:"SPORTS Crackshot",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Sports",tags:["Sports","JulyM23","Silver","Golf","Clubs"]},is_available:!1,unlock:"purchase"},{id:4239,name:"Breakfast Crackshot",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Breakfast",tags:["Breakfast","Food","Fork","Red","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:4240,name:"Scavenger Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Scavenger",tags:["Scavenger","Premium","Black","White","OctM23","premFeatOne"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_scav"]},{id:4241,name:"BWD Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Wizard",tags:["Sep22","Drops3","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:4242,name:"Valkyrie Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_valk"]},{id:4243,name:"New Year 2023 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4244,name:"Farm Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Farm",tags:["Farm","FebM23","Food","Green","Asparagus"]},is_available:!1,unlock:"purchase"},{id:4245,name:"MenoXD Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Meno",tags:["Drops4","Mar23","Red","Black","xd"]},is_available:!1,unlock:"manual"},{id:4246,name:"Equinox Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:4247,name:"Kart Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Kart",tags:["Kart","Aug23","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:4248,name:"The Fusion Crackshot",price:6,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Fusion",tags:["Fusion","SepM23","Blue","White","Black"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_fusion"]},{id:4249,name:"The Pablo Rifle",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Badegg",tags:["Badegg","Premium"]},is_available:!1,unlock:"premium"},{id:16e3,name:"Grenade",price:0,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade",tags:["default","green"]},is_available:!0,unlock:"default"},{id:16001,name:"GOLD Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:16002,name:"Happy Bear Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:16003,name:"Rainbow Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Rainbow",tags:["boom","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:16004,name:"Steampunk Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:16005,name:"Memphis Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Memphis",tags:["Memphis","pink","blue"]},is_available:!0,unlock:"purchase"},{id:16006,name:"Nuke Zone Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NukeZone",tags:["NukeZone","Green","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:16007,name:"Country Singer Grenade",price:1e5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:16008,name:"Raid Land Grenade",price:6500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaidLand",tags:["SepM23","brown"]},is_available:!1,unlock:"purchase"},{id:16009,name:"Toxic Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:16010,name:"Albino Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_SnakeAlbino",tags:["countrysinger","EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:16011,name:"Holy Hand Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Holy",tags:["Premium","vipItem","Blue","Yellow"],sound:"grenade_holy",cell:3,smokeColors:"white",fireColors:"gold"},is_available:!1,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"]},{id:16012,name:"Groundhog Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Groundhog",tags:["Groundhog","Feb23","Brown","Smile"]},is_available:!1,unlock:"purchase"},{id:16013,name:"Corrupted Grenade",price:75e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Corrupted",tags:["Brown","Eye"],sound:"grenade_corrupt",cell:4,smokeColors:"corrupt",fireColors:"corrupt"},is_available:!0,unlock:"purchase"},{id:16014,name:"Skullnado Grenade",price:7,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Skull",tags:["SepM23","OctM23","White","Halloween"],sound:"grenade_skullnado",cell:2,smokeColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_skullnado"]},{id:16015,name:"Saint Patricks Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_SaintPaddy",tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:16016,name:"Easter Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Easter",tags:["Easter","Blue","Pink","Eggs"]},is_available:!1,unlock:"purchase"},{id:16017,name:"Pablo Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Pablo",tags:["Brown","Yellow","Hat","Smile"]},is_available:!0,unlock:"purchase"},{id:16018,name:"Diablo Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Diablo",tags:["EGGORG","Apr23","Brown","Frown"]},is_available:!1,unlock:"purchase"},{id:16019,name:"Unicorn Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Unicorn",tags:["FebM23","Sep23","Pink"],sound:"grenade_unicorn",cell:1,smokeColors:"white",fireColors:"rainbow"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_unicorn"]},{id:16020,name:"Phone Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Phone",tags:["Mobile","Fire","Red"],sound:"grenade_cellphone",cell:5,smokeColors:"white"},is_available:!1,unlock:"manual"},{id:16021,name:"Merc Zone Grenade",price:7e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Merc",tags:["Merc","Suit","Black","Tie"]},is_available:!0,unlock:"purchase"},{id:16022,name:"Summer Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Coconut",tags:["Summer","JunM23","Food","Brown","Drink","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:16023,name:"Toilet Paper Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_ToiletPaper",tags:["Premium","AugM23","Poop","White"],sound:"grenade_tp",cell:6,smokeColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_toilet_papr"]},{id:16024,name:"Buck Rogers Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:16025,name:"Galeggsy Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:16026,name:"ChantiGG Booth Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Booth",tags:["Chantigg","Red","Phone"]},is_available:!0,unlock:"purchase"},{id:16027,name:"Glitterbomb Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Glitterbomb",tags:["Pencil","Premium","Pink","Disco"],sound:"grenade_glitterbomb",smokeColors:"white",fireColors:"gold",cell:7},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_glitterbomb"]},{id:16028,name:"Apple Grenade",price:750,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Apple",tags:["Pencil","Sep23","Red","Food"]},is_available:!1,unlock:"purchase"},{id:16029,name:"Wero Grenade",price:1250,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Wero",tags:["Wero","Chicken","Yellow"]},is_available:!0,unlock:"purchase"},{id:16030,name:"Halloween Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Halloween",tags:["Halloween","Oct23","Pumpkin","Jack","Orange","Smile"]},is_available:!0,unlock:"purchase"},{id:16031,name:"Thanksgiving Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Turkey",tags:["Thanksgiving","Eye","Yellow"]},is_available:!1,unlock:"purchase"},{id:16032,name:"Thermal Detonator Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Thermal",tags:["Premium","JunM23","Red","Black"],sound:"grenade_thermal",cell:8,smokeColors:"thermal",fireColors:"thermal"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_thermal"]},{id:16033,name:"Christmas Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:16034,name:"Eggs of Legends Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Crystal",tags:["Eggteam","Blue"]},is_available:!0,unlock:"purchase"},{id:16035,name:"New Year 2022 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:16036,name:"Supernova Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Supernova",tags:["AprM23","Rainbow","White"],sound:"grenade_supernova",cell:9,smokeColors:"supernova",fireColors:"thermal"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_supernova"]},{id:16037,name:"Valentines Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Valentines",tags:["Valentines","Heart","Red"]},is_available:!1,unlock:"purchase"},{id:16038,name:"Octopus Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Octopus",tags:["premFeatTwo","May23","Oct23","White","Cute"],sound:"grenade_octopus",cell:10,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_octopus"]},{id:16039,name:"Bros Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_BBros",tags:["Premium","Bros","Orange"],sound:"grenade_bbros",cell:11,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"manual"},{id:16040,name:"Cards Grenade",price:1520,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:16041,name:"Diablo Frown Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_DiabloCannon",tags:["Mar23","EGGORG","Blue","Face"],sound:"grenade_diablocannon",cell:12,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_diablo"]},{id:16042,name:"Yoyo Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Yoyo",tags:["Relic","Drops2","Blue","White"]},is_available:!1,unlock:"manual"},{id:16043,name:"Dino Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Dino",tags:["Dino","May23","Orange"]},is_available:!1,unlock:"purchase"},{id:16044,name:"Bumblebee Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Bee",tags:["Premium","Summer","Mar23","Yellow","Black","Cute"],sound:"grenade_bees",cell:13,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_bumble"]},{id:16045,name:"Soccer Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Soccer",tags:["Sports","JulyM23","Black","White"]},is_available:!1,unlock:"purchase"},{id:16046,name:"Football Helmet Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Football",tags:["Premium","Sports","JulyM23","Red"],sound:"grenade_football",cell:14,smokeColors:"softblack",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_football"]},{id:16047,name:"Unhatched Chicken Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Chicken",tags:["Chicken","Eggs"]},is_available:!1,unlock:"purchase"},{id:16048,name:"Valkyrie Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"],sound:"grenade_valkyrie",cell:15,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_valk"]},{id:16049,name:"Milk Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Milk",tags:["Premium","Breakfast","MayM23","Pink","Food"],sound:"grenade_milk",cell:16,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_milk"]},{id:16050,name:"Breakfast Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Breakfast",tags:["Breakfast","Food","Eggs","Bacon"]},is_available:!1,unlock:"purchase"},{id:16051,name:"Eyeball Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Eyeball",tags:["Scavenger","AugM23","Blue"]},is_available:!1,unlock:"purchase"},{id:16052,name:"Padlock Grenade",price:4200,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Padlock",tags:["Pencil2","Sep23","Grey","Gray","Locker"]},is_available:!1,unlock:"purchase"},{id:16053,name:"Barrel Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Barrel",tags:["Sep22","Mar23","Brown"]},is_available:!1,unlock:"purchase"},{id:16054,name:"Bloodonade Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Blood",tags:["Premium","Halloween3","Red"],sound:"grenade_bloodonade",cell:17,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_blood"]},{id:16055,name:"Nutcracker Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Nutcracker",tags:["Christmas","Red","White","Face"]},is_available:!1,unlock:"purchase"},{id:16056,name:"New Year 2023 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2023",tags:["NewYears","2023","Red","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:16057,name:"Tambourine Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Tambourine",tags:["Rockstar","JanM23","Aug23","Music"]},is_available:!1,unlock:"purchase"},{id:16058,name:"Blue Shell Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Turtle",tags:["Community","BWD"],sound:"grenade_blueshell",cell:20,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"manual"},{id:16059,name:"Slop Bucket Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Pail",tags:["Premium","farm","FebM23","Food"],sound:"grenade_milkbucket",cell:16,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_pail"]},{id:16060,name:"Green Shell Grenade",price:3500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TurtleGreen",tags:["Kart","AprM23","Turtle"]},is_available:!1,unlock:"purchase"},{id:16061,name:"Red Shell Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TurtleRed",tags:["Kart","AprM23","Turtle"]},is_available:!1,unlock:"purchase"},{id:16062,name:"Equinox Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:16063,name:"Kart Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Kart",tags:["Kart","Aug23","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:16064,name:"Timebomb Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Timebomb",tags:["Kart","Aug23","Blue","Yellow"],sound:"grenade_Timebomb",cell:18,smokeColors:"blue",fireColors:"blue"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_timebomb"]},{id:16065,name:"Luchador Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Luchador",tags:["WBs","SepM23","Wrestle","Face"]},is_available:!1,unlock:"purchase"},{id:16066,name:"Smooth Brain Grenade",price:2100,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Brain",tags:["Oct23","Halloween4","Pink"]},is_available:!0,unlock:"purchase"},{id:4500,name:"The TriHard",price:0,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug",tags:["Default","Red"]},is_available:!0,unlock:"default"},{id:4501,name:"GOLD TriHard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4502,name:"Happy Bear TriHard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4503,name:"Rainbow TriHard",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Rainbow",tags:["White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4504,name:"Steampunk TriHard",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Steampunk",tags:["Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4505,name:"Memphis TriHard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Memphis",tags:["Memphis","Black","Green"]},is_available:!0,unlock:"purchase"},{id:4506,name:"Nuke Zone TriHard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NukeZone",tags:["Purple","Blue","Black","Blurple","Neon"]},is_available:!0,unlock:"purchase"},{id:4507,name:"Country Singer Tri-Hard",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4508,name:"Raid Land Tri-Hard",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_RaidLand",tags:["RaidLand","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:4509,name:"Toxic Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4510,name:"Albino Snake Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4511,name:"Saint Patricks Skin Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:4512,name:"Retro Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Retro",tags:["Retro","Premium","Sep23","Red","Green","Pixel","Wings"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_aug_retro"]},{id:4513,name:"Easter Tri-Hard",price:1e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Easter",tags:["Easter","JunM23","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:4514,name:"Car Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_car",tags:["Cars","Trains","Truck","Green","Red","Yellow"]},is_available:!0,unlock:"purchase"},{id:4515,name:"Merc Zone Tri-Hard",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Merc",tags:["Merc","Suit","Pink","Black"]},is_available:!0,unlock:"purchase"},{id:4516,name:"Summer Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:4517,name:"Buck Rogers Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4518,name:"Galeggsy Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:4519,name:"Pencil Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Pencil",tags:["Pencil","Sep23","Smile","Yellow","Blue","Scissors"]},is_available:!1,unlock:"purchase"},{id:4520,name:"Halloween Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!0,unlock:"purchase"},{id:4521,name:"Thanksgiving Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Turkey",tags:["Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:4522,name:"Christmas Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4523,name:"New Year 2022 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4524,name:"ChantiGG Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Chantigg",tags:["Drops","Red","Phone","Booth"]},is_available:!1,unlock:"manual"},{id:4525,name:"Valentines Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:4526,name:"Kawaii Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cutesy",tags:["Kawaii","Pink","Yellow","Blue"]},is_available:!0,unlock:"purchase"},{id:4527,name:"Cards Tri-Hard",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4528,name:"Valkyrie Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_valk_aug"]},{id:4529,name:"Dino Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Dino",tags:["Dino","May23","Orange"]},is_available:!1,unlock:"purchase"},{id:4530,name:"Eggpire Tri-Hard",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4531,name:"SPORTS Tri-Hard",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Sports",tags:["Sports","JulyM23","Green","Blue","Tennis"]},is_available:!1,unlock:"purchase"},{id:4532,name:"Chicken Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:4533,name:"Breakfast Tri-Hard",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Breakfast",tags:["Breakfast","Food","Spoon","Red","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:4534,name:"Bone Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Bones",tags:["Halloween3","OctM23"]},is_available:!0,unlock:"purchase"},{id:4535,name:"New Year 2023 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4536,name:"Music Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Music",tags:["Rockstar","JanM23","Gold","Yellow","Saxaphone","Saxamaphone"]},is_available:!1,unlock:"purchase"},{id:4537,name:"Groundhog Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:4538,name:"Farm Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Farm",tags:["Farm","FebM23","Food","Red","Yellow","Orange","Peppers"]},is_available:!1,unlock:"purchase"},{id:4539,name:"Equinox Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:4540,name:"Fusion Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Fusion",tags:["Premium","Fusion","JulyM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_aug_fusion"]},{id:4541,name:"Kart Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Kart",tags:["Kart","Aug23","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:15e3,name:"The Whisk Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"whisk",tags:["Silver"]},is_available:!0,unlock:"default"},{id:15001,name:"Corn Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_corn",tags:["Yellow","Green","Food","Meme"]},is_available:!0,unlock:"default"},{id:15002,name:"Club Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_stick",tags:["Brown"]},is_available:!0,unlock:"default"},{id:15003,name:"Gold Melee",price:2500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_gold",tags:["Brown","Gold","Whisk"]},is_available:!0,unlock:"purchase"},{id:15004,name:"Pink Bear Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_bear",tags:["Pink","Cute","Heart","Whisk"]},is_available:!0,unlock:"purchase"},{id:15005,name:"Steampunk Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_steampunk",tags:["Brown","Gold","Whisk"]},is_available:!0,unlock:"purchase"},{id:15006,name:"Rainbow Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rainbow",tags:["Red","Orange","Yellow","Green","Blue","Clouds","Whisk"]},is_available:!0,unlock:"purchase"},{id:15007,name:"Memphis Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_memphis",tags:["Black","White","Rainbow","Whisk"]},is_available:!0,unlock:"purchase"},{id:15008,name:"Rotten Melee",price:15e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_toxic",tags:["Pipe","Green","Black"]},is_available:!0,unlock:"purchase"},{id:15009,name:"Car Melee",price:2e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_shift",tags:["Black","Silver","Gear"]},is_available:!0,unlock:"purchase"},{id:15010,name:"Brown Snake Melee",price:1e5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_snake",tags:["Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:15011,name:"Hoe Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hoe",tags:["FebM23","farm","Tools"]},is_available:!1,unlock:"purchase"},{id:15012,name:"Flame Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_flame",tags:["Orange","Yellow","Fire"]},is_available:!1,unlock:"manual"},{id:15013,name:"Valkyrie Melee",price:6,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_valkyrie",tags:["Gold","Blue","Yellow","Premium"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_valk"]},{id:15014,name:"BWD Wizard Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wizard",tags:["Drops4","Mar23","Blue","Brown","Staff"]},is_available:!1,unlock:"manual"},{id:15015,name:"Sneaker Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_sneaker",tags:["Bros","MarM23","White","Blue","Shoe"]},is_available:!1,unlock:"purchase"},{id:15016,name:"Fiddle Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fiddle",tags:["StPatricksDay","MarM23","Music","Brown"]},is_available:!1,unlock:"purchase"},{id:15017,name:"Medieval Key Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_key",tags:["Apr23","Newsletter","Gold","Yellow"]},is_available:!1,unlock:"manual"},{id:15018,name:"Galeggsy Whisk",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_galaxy",tags:["AprM23","Galeggsy","Blue","Purple","Planets","OctM23","premFeatOne"]},is_available:!0,unlock:"purchase"},{id:15019,name:"Giant Spoon Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_spoon",tags:["AprM23","Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15020,name:"Albino Snake Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_albino",tags:["Giveaway","White","ABHS","Snek"]},is_available:!1,unlock:"manual"},{id:15021,name:"Forkin' Fork! Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fork",tags:["Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15022,name:"Bone Bonker",price:4500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_bone",tags:["May23","Dino2","Caveman"]},is_available:!1,unlock:"purchase"},{id:15023,name:"Stone Hammer Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rock",tags:["May23","Dino2"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_stone"]},{id:15024,name:"Eggflation Whisk",price:8e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_eggflation",tags:["MayM23","Eggflation","Gold","Yellow","80k"]},is_available:!0,unlock:"purchase"},{id:15025,name:"Butterknife Melee",price:6500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_butterknife",tags:["MayM23","Eggflation","Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15026,name:"Shellfie Stick Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_selfiestick",tags:["Jun23","Photo","Cheese"]},is_available:!1,unlock:"purchase"},{id:15027,name:"Spatula Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_spatula",tags:["Jun23","Silver"]},is_available:!0,unlock:"purchase"},{id:15028,name:"Popsicle Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_popsicle",tags:["JunM23","Summer2","Pink","Food"]},is_available:!1,unlock:"purchase"},{id:15029,name:"Wrench Melee",price:4500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wrench",tags:["JunM23","Summer2","Blue","Yellow","Tools"]},is_available:!0,unlock:"purchase"},{id:15030,name:"Fusion Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fusion",tags:["JunM23","Blue","White","Gray","Grey"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_fusion"]},{id:15031,name:"Equinox Melee",price:3e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_equinox",tags:["July23","Equinox","Blue","Yellow","Sun","Moon","Whisk"]},is_available:!1,unlock:"purchase"},{id:15032,name:"Crowbar Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_crowbar",tags:["July23","Blue","Yellow","Red","Tools"]},is_available:!0,unlock:"purchase"},{id:15033,name:"Hockey Melee",price:8e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hockey",tags:["JulyM23","Sports2","Stick"]},is_available:!1,unlock:"purchase"},{id:15034,name:"Shovel Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_shovel",tags:["JulyM23","Pink","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:15035,name:"MenoXD Katana",price:125e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_meno",tags:["JulyM23","Red","Black"]},is_available:!0,unlock:"purchase"},{id:15036,name:"Kart Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_kart",tags:["Aug23","Kart","Red","Blue","Whisk"]},is_available:!1,unlock:"purchase"},{id:15037,name:"Harrison Cat Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_harrison",tags:["AugM23","Drops5","Black","White","Cat"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_cat"]},{id:15039,name:"Ruler Melee",price:6500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ruler",tags:["Sep23","Pencil3","Brown"]},is_available:!1,unlock:"purchase"},{id:15040,name:"Fighting Fish Slapper",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fish",tags:["Sep23","Bundle","Food"]},is_available:!1,unlock:"premium"},{id:15041,name:"Folding Chair Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_chair",tags:["SepM23","WBs","Wrestle","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:15042,name:"Pitchfork Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_devil",tags:["Oct23","Halloween4","Red","Black"]},is_available:!0,unlock:"purchase"},{id:15043,name:"Rolling Pin Whalloper",price:8e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rollingpin",tags:["Oct23","Brown"]},is_available:!0,unlock:"purchase"}];const He=[1012,1023,1115,1256,1257,1258,2017,2394,1118,2007,2396,1284,2395,2085,2132,2201,2184,1260,2153,1282,2104,1121,1017,3034,3402,3802,1175,2100,2354,1179,2065,3113,4003,2266,2315,1237,1206,4201,2135,2086,2126,2134,2168,2247,2209,1203,3833,4017,2155,15015,2117,1263,1205,1150,1225,3117,1172,4213,3639,1198,1127,1220,1224,1323,4216,1137,15024,3820,16013,1183,3017,15010,3645,1101,3437,1078,1167,1076,1210,1211,1213,3625,1080,1079,1075,1074,1073,1066,4524,3012,3020,4212,4008,4220,3821,3620,3420,4006,3108,3612,3020,16010,4020,4206,4208,15012];var We={gameNotFound:0,gameFull:0,badName:0,mainMenu:0,gameIdleExceeded:0,corruptedLoginData0:0,corruptedLoginData1:0,corruptedLoginData2:0,corruptedLoginData3:0,corruptedLoginData4:0,corruptedLoginData5:0,gameMaxPlayersExceeded:0,gameDestroyUser:0,joinGameOutOfOrder:0,gameShuttingDown:0,readyBeforeReady:0,booted:0,gameErrorOnUserSocket:0,uuidNotFound:0,sessionNotFound:0,clusterFullCpu:0,clusterFullMem:0,noClustersAvailable:0},je=4e3;Object.keys(We).forEach(e=>{We[__uv.$wrap((e))]=je++});var Xe={gameJoined:0,socketReady:0,addPlayer:0,removePlayer:0,chat:0,syncThem:0,syncAmmo:0,die:0,hitThem:0,hitMe:0,collectItem:0,spawnItem:0,respawn:0,swapWeapon:0,joinGame:0,observeGame:0,ping:0,pong:0,clientReady:0,requestRespawn:0,joinPublicGame:0,joinPrivateGame:0,createPrivateGame:0,switchTeam:0,changeCharacter:0,pause:0,announcement:0,updateBalance:0,reload:0,refreshGameState:0,switchTeamFail:0,expireUpgrade:0,bootPlayer:0,banPlayer:0,loginRequired:0,gameLocked:0,reportPlayer:0,banned:0,metaGameState:0,syncMe:0,explode:0,keepAlive:0,musicInfo:0,hitMeHardBoiled:0,beginShellStreak:0,endShellStreak:0,startReload:0,fire:0,melee:0,throwGrenade:0,info:0,eventModifier:0,playerInfo:0};je=0;Object.keys(Xe).forEach(e=>{Xe[__uv.$wrap((e))]=je++});var Ye=1,Ke=2,Qe={ffa:0,teams:1,ctf:2,king:3},Ze=[{shortName:"FFA",longName:"Free For All"},{shortName:"Teams",longName:"Teams"},{shortName:"Spatula",longName:"Captula the Spatula"},{shortName:"King",longName:"King of the Coop"}],qe=[{name:"Eggk47"},{name:"Scrambler"},{name:"FreeRanger"},{name:"Cluck9mm"},{name:"Rpegg"},{name:"Whipper"},{name:"Crackshot"},{name:"TriHard"},{name:"Grenade"},{name:"Melee"}],Je=Math.ceil(3),$e={perKill:10,video:100,perKillModTwo:20,discord:"rew_1200",tiktok:"rew_1208",Instagram:"rew_1219",Steam:"rew_1223",Facebook:"rew_1227",Twitter:"rew_1234",Twitch:"rew_twitch_social"},et=7,tt={HardBoiled:1,EggBreaker:2};const it=3,rt=240,nt=86400;var at=0,ot=1,st={Hat:1,Stamp:2,Primary:3,Secondary:4,Grenade:6,Melee:7},lt={Soldier:0,Scrambler:1,Ranger:2,Eggsploder:3,Whipper:4,Crackshot:5,TriHard:6};lt.length=Object.keys(lt).length;const ct=["kills","deaths","streak","killsCluck9mm","killsGrenade","killsRpegg","killsEggk47","killsScrambler","killsFreeRanger","killsWhipper","killsCrackshot","killsTriHard","killsMelee","killsPrivate","killsPublic","killsKing","killsSpatula","killsTeams","killsFFA","deathsCluck9mm","deathsGrenade","deathsRpegg","deathsEggk47","deathsScrambler","deathsFreeRanger","deathsWhipper","deathsCrackshot","deathsTriHard","deathsMelee","deathsPrivate","deathsPublic","deathsKing","deathsSpatula","deathsTeams","deathsFFA","kotcCaptured","kotcWins"];function ut(e,t,i,r){let n=Sa.cloneMesh(e,t,i);return t.addMesh(n),r?n.material=r:n.material&&n.material._scene!=t&&(n.material=dt(n.material.name,t)),n}function ht(e,t){let i=Sa.cloneSkeleton(e,t);return t.addSkeleton(i),i}function dt(e,t){let i=t.getMaterialByName(e);return i||(i=Sa.getMaterialByName(e).clone(e,t),t.addMaterial(i)),i}function pt(e){this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.active=!1,this.player=null,this.damage=20,this.range=0,this.velocity=0,this.hitsMap=!1,this.origin=new t.Vector3,this.direction=new t.Vector3,this.end=new t.Vector3,this.meshName="",this.weaponClassId=0,void 0!==yi&&(this.actor=new yi(this))}t.Skeleton.prototype.disableBlending=function(){this.bones.forEach((function(e){e.animations.forEach((function(e){e.enableBlending=!1}))}))},t.Scene.prototype.cloneMesh=function(e,i,r){var n=this.getMeshByName(e);return new t.Mesh(e,i,r,n)},t.chrome84BugWorkaround=!1,t.Scene.prototype.cloneSkeleton=function(e,t){var i=this.getSkeletonByName(e).clone();return i.name=e+Date.now(),i._scene=t,i},t.DynamicTexture.prototype.clearRect=function(e,t,i,r){this._context.clearRect(e,t,i,r)},t.AbstractMesh.prototype.setLayerMask=function(e){this.layerMask=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[__uv.$wrap((i))].setLayerMask(e)},t.AbstractMesh.prototype.setRenderingGroupId=function(e){this.renderingGroupId=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[__uv.$wrap((i))].setRenderingGroupId(e)},t.TransformNode.prototype.setVisible=function(e){this.isVisible=e,this._isWorldMatrixFrozen=!e;for(var t=this.getChildTransformNodes(),i=0;i<t.length;i++)t[__uv.$wrap((i))].setVisible(e)},t.AbstractMesh.prototype.setMaterial=function(e){this.material=e;for(var t=this.getChildMeshes(),i=0;i<t.length;i++)t[__uv.$wrap((i))].setMaterial(e)},t.Vector3.ClampToRef=function(e,t,i,r){var n=e.x;n=(n=n>i.x?i.x:n)<t.x?t.x:n;var a=e.y;a=(a=a>i.y?i.y:a)<t.y?t.y:a;var o=e.z;o=(o=o>i.z?i.z:o)<t.z?t.z:o,r.copyFromFloats(n,a,o)},pt.damageExp=4,pt.v1=new t.Vector3,pt.v2=new t.Vector3,pt.v3=new t.Vector3,pt.position=new t.Vector3,pt.fire=function(e,t,i,r){Sr.bulletPool.retrieve().fireThis(e,t,i,r)},pt.prototype.fireThis=function(e,i,r,n){this.player=e,this.x=i.x,this.y=i.y,this.z=i.z,this.origin.set(this.x,this.y,this.z),this.direction.copyFrom(r).normalize().scaleInPlace(n.velocity),this.dx=this.direction.x,this.dy=this.direction.y,this.dz=this.direction.z,this.weaponClass=n,this.damage=n.damage,this.active=!0,this.range=n.range,this.velocity=n.velocity,this.hitsMap=!1,this.powerful=!1,this.dmgTypeId=n.dmgTypeId;var a=ft.rayCollidesWithMap(i,r,ft.projectileCollidesWithCell);a&&(this.end.copyFrom(a.pick.pickedPoint),this.range=t.Vector3.Distance(i,a.pick.pickedPoint),this.hitsMap=!0),e.activeShellStreaks&tt.EggBreaker&&(this.powerful=!0,this.damage*=1.5),this.actor&&(0==this.player.weapon.tracer?this.actor.fire(this.powerful):this.actor.delayFrames=Number.MAX_SAFE_INTEGER)},pt.prototype.remove=function(){Sr.bulletPool.recycle(this),this.actor&&this.actor.remove()},pt.prototype.update=function(){if(pt.position.set(this.x,this.y,this.z),this.range<this.velocity&&this.direction.scaleInPlace(this.range/this.velocity),!ft.rayCollidesWithPlayer(pt.position,this.direction,this))if(this.x+=this.dx,this.y+=this.dy,this.z+=this.dz,this.range-=this.velocity,this.range<=0){if(this.actor&&this.hitsMap){var e=this.end,t=.1*-this.dx,i=.1*-this.dy,r=.1*-this.dz;!function(e,t,i,r,n,a){var o=Ei.getSprite(0);o.animLength=20*Math.random()+30,o.easing=Dt,o.position.x=e,o.position.y=t,o.position.z=i,o.dx=.1*r,o.dy=.1*n,o.dz=.1*a,o.startSize=.1,o.endSize=.2*Math.random()+.4,o.angle=Math.random()*Math.PI2,o.rotate=.08*Math.random()-.04,o.animColors=zr}(e.x,e.y,e.z,t,i,r)}this.remove()}else;},pt.prototype.collidesWithPlayer=function(e,i){pt.v1.x=this.dx,pt.v1.y=this.dy,pt.v1.z=this.dz,pt.v1.normalize();var r=.8*-t.Vector3.Dot(pt.v1,i)+.2;var n=this.damage*Math.pow(r,pt.damageExp+1*Math.pow(r,pt.damageExp));isNaN(n)&&console.error("Bullet.collidesWithPlayer damage is NaN",r,pt.damageExp,1,pt.v1,i),yn(e,this,n,pt.v1.x,pt.v1.z),this.remove()};class mt{constructor(){var e=new t.Vector3(0,0,0),i=new t.Vector3(er.width,er.height,er.depth);this.world=new t.BoundingBox(e,i),this.bvh=this.createNode(this.world,2),this.checkTick=0}add(e,i){i=i||this.bvh;for(var r=0;r<i.length;r++){var n=i[__uv.$wrap((r))];t.BoundingBox.Intersects(e.bb,n)&&(n.maximumWorld.x-n.minimumWorld.x>.5*(e.bb.maximumWorld.x-e.bb.minimumWorld.x)&&n.maximumWorld.y-n.minimumWorld.y>.5*(e.bb.maximumWorld.y-e.bb.minimumWorld.y)&&n.maximumWorld.z-n.minimumWorld.z>.5*(e.bb.maximumWorld.z-e.bb.minimumWorld.z)?(0==n.bvh.length&&(n.bvh=this.createNode(n,2)),e.checkTick=0,this.add(e,n.bvh)):n.objects.push(e))}}createNode(e,i){var r=[],n=(e.maximumWorld.x-e.minimumWorld.x)/i,a=(e.maximumWorld.z-e.minimumWorld.z)/i;if(n>er.height)var o=0,s=er.height,l=er.height;else o=e.minimumWorld.y,l=((s=e.maximumWorld.y)-o)/i;for(var c=e.minimumWorld.x;c<e.maximumWorld.x;c+=n)for(var u=o;u<s;u+=l)for(var h=e.minimumWorld.z;h<e.maximumWorld.z;h+=a){var d=new t.Vector3(c,u,h),p=new t.Vector3(c+n,u+l,h+a),m=new t.BoundingBox(d,p);m.bvh=[],m.objects=[],r.push(m)}return r}getObjects(e,t){this.checkTick++,this.recurseObjects(e,this.bvh,t)}recurseObjects(e,i,r){for(var n=0;n<i.length;n++){var a=i[__uv.$wrap((n))];if(t.BoundingBox.Intersects(e,a)){for(var o=0;o<a.objects.length;o++){var s=a.objects[__uv.$wrap((o))];s.checkTick!=this.checkTick&&t.BoundingBox.Intersects(e,s.bb)&&(s.checkTick=this.checkTick,r(a.objects[__uv.$wrap((o))]))}this.recurseObjects(e,a.bvh,r)}}}getObjectsWithRay(e,t,i){this.checkTick++,this.recurseObjectsWithRay(e,t,this.bvh,i)}recurseObjectsWithRay(e,i,r,n){for(var a=0;a<r.length;a++){var o=r[__uv.$wrap((a))];if(t.BoundingBox.IntersectsRay(o,e,i)){for(var s=0;s<o.objects.length;s++){var l=o.objects[__uv.$wrap((s))];l.checkTick!=this.checkTick&&t.BoundingBox.IntersectsRay(l.bb,e,i)&&(l.checkTick=this.checkTick,n(o.objects[__uv.$wrap((s))]))}this.recurseObjectsWithRay(e,i,o.bvh,n)}}}}if(!G)G=new _t;function _t(){if(null==ze)throw"Items is undefined or null, cannot create Catalog";this.isSetup=!1,this.filterItems=function(e,t){for(var i=[],r=0;r<e.length;r++)t(e[__uv.$wrap((r))])&&i.push(e[__uv.$wrap((r))]);return i},this.findItemInListById=function(e,t){for(var i=0;i<t.length;i++)if(t[__uv.$wrap((i))]&&t[__uv.$wrap((i))].id===e)return t[__uv.$wrap((i))];return null},this.findItemsByIds=function(e){return ze.filter(t=>e.includes(t.id))},this.findItemById=function(e){return this.findItemInListById(e,ze)},this.findItemBy8BitItemId=function(e,t,i){if(!1===this.isSetup&&this.setupCatalog(),void 0===t||t>=lt.length)return null;var r=i;switch(e){case st.Hat:return 0===i?null:this.findItemInListById(r,this.hats);case st.Stamp:return 0===i?null:this.findItemInListById(r,this.stamps);case st.Primary:return this.findItemInListById(r,this.forClass[__uv.$wrap((t))].forWeaponSlot[__uv.$wrap((at))]);case st.Secondary:return this.findItemInListById(r,this.forClass[__uv.$wrap((t))].forWeaponSlot[__uv.$wrap((ot))]);case st.Grenade:return this.findItemInListById(r,this.grenades);case st.Melee:return this.findItemInListById(r,this.melee)}},this.addWeaponFunctions=function(e){e.instantiateNew=function(e){var t;return t=null===this.exclusive_for_class?new Tt(e,this.item_data.meshName):new Nt[__uv.$wrap((this.exclusive_for_class))].weapon(e,this.item_data.meshName),e.actor&&e.actor.setWeaponSkeleton(t.actor.skeleton),t}},this.addGrenadeFunctions=function(e){e.instantiateNew=function(e){let t=ut(this.item_data.meshName,e.scene),i={scene:e.scene,player:e,actor:{mesh:t,dispose:()=>{t.dispose()}}};return t.position.y=.5,t.position.z=1,i}},this.addMeleeFunctions=function(e){e.instantiateNew=function(e){let t=ut(this.item_data.meshName,e.scene),i={scene:e.scene,player:e,actor:{weaponMesh:t,skeleton:ht("melee_skeleton",e.scene),dispose:()=>{t.dispose()}}};return e.actor&&e.actor.setWeaponSkeleton(i.actor.skeleton),i}},this.getTaggedItems=function(e,t){if(!e)return[];const i=(e=e.replace(/\s/g,"")).split(",");return this.filterItems(ze,(function(e){if(void 0!==e.item_data.tags&&null!==e.item_data.tags&&e.item_data.tags.length>0){if(void 0!==t&&e.item_type_name!==getKeyByValue(st,t))return!1;let r=!1;return e.item_data.tags.forEach(e=>{i.forEach(t=>{t===e&&(r=!0)})}),r}return!1}))},this.getTaggedItemsWithItemType=(e,t)=>{},this.premiumSoundValid=function(e){return e.hasOwnProperty("unlock")&&"premium"===e.unlock||"manual"===e.unlock&&"gun_cluck9mm_CubicCastles"===e.item_data.meshName},this.getPremiumGunMeshNames=function(){Object.keys(lt).forEach(e=>{"Soldier"!==e&&(ke[__uv.$wrap((e))]=ze.filter(t=>hasValue(t.exclusive_for_class)&&t.exclusive_for_class===lt[__uv.$wrap((e))]&&this.premiumSoundValid(t)).map(e=>e.item_data.meshName))}),Object.keys(st).forEach(e=>{"Primary"!==e?ke[__uv.$wrap((e))]=ze.filter(t=>hasValue(t.item_type_id)&&t.item_type_id===st[__uv.$wrap((e))]&&this.premiumSoundValid(t)).map(e=>e.item_data.meshName):"Primary"===e&&(ke.Soldier=ze.filter(e=>hasValue(e.item_type_id)&&e.item_type_id===st.Primary&&!hasValue(e.exclusive_for_class)&&this.premiumSoundValid(e)).map(e=>e.item_data.meshName))})},this.setupCatalog=function(){this.hats=[],this.stamps=[],this.primaryWeapons=[],this.secondaryWeapons=[],this.grenades=[],this.melee=[],this.forClass=[];for(var e=0;e<ze.length;e++)switch(ze[__uv.$wrap((e))].item_type_id){case st.Hat:this.hats.push(ze[__uv.$wrap((e))]);break;case st.Stamp:this.stamps.push(ze[__uv.$wrap((e))]);break;case st.Primary:this.primaryWeapons.push(ze[__uv.$wrap((e))]),this.addWeaponFunctions(ze[__uv.$wrap((e))]);break;case st.Secondary:this.secondaryWeapons.push(ze[__uv.$wrap((e))]),this.addWeaponFunctions(ze[__uv.$wrap((e))]);break;case st.Grenade:this.grenades.push(ze[__uv.$wrap((e))]),this.addGrenadeFunctions(ze[__uv.$wrap((e))]);break;case st.Melee:this.melee.push(ze[__uv.$wrap((e))]),this.addMeleeFunctions(ze[__uv.$wrap((e))])}for(var t=0;t<lt.length;t++){var i=function(e){return 0===e.price&&null===e.exclusive_for_class},r=function(e){return 0===e.price&&e.exclusive_for_class===t},n=function(e){return e.price>0&&null===e.exclusive_for_class},a=function(e){return e.price>0&&e.exclusive_for_class===t},o=this,s=function(e){return e=o.filterItems(e,i).concat(o.filterItems(e,r)).concat(o.filterItems(e,n)).concat(o.filterItems(e,a))},l={primaryWeapons:s(this.primaryWeapons),secondaryWeapons:s(this.secondaryWeapons)};l.forWeaponSlot=[l.primaryWeapons,l.secondaryWeapons],this.forClass.push(l)}this.isSetup=!0},this.isSetup||this.setupCatalog()}var ft={init:function(e){ft.playerCollisionMesh=t.MeshBuilder.CreateBox("pc",{size:.5,height:.6},e),ft.playerCollisionMesh.position.y=.3,ft.playerCollisionMesh.bakeCurrentTransformIntoVertices(),ft.playerCollisionMesh.setEnabled(!1),ft.wedgeCollisionMesh=t.MeshBuilder.CreateBox("",{size:1.5},e),ft.wedgeCollisionMesh.position.y=-.75,ft.wedgeCollisionMesh.bakeCurrentTransformIntoVertices(),ft.wedgeCollisionMesh.rotation.x=-Math.PI/4,ft.wedgeCollisionMesh.bakeTransformIntoVertices(ft.wedgeCollisionMesh.getWorldMatrix()),ft.wedgeCollisionMesh.setEnabled(!1),ft.iwedgeCollisionMesh=t.MeshBuilder.CreateBox("",{size:1.5},e),ft.iwedgeCollisionMesh.position.y=.75,ft.iwedgeCollisionMesh.bakeCurrentTransformIntoVertices(),ft.iwedgeCollisionMesh.rotation.x=-Math.PI/4,ft.iwedgeCollisionMesh.bakeTransformIntoVertices(ft.iwedgeCollisionMesh.getWorldMatrix()),ft.iwedgeCollisionMesh.setEnabled(!1),ft.fullCollisionMesh=t.MeshBuilder.CreateBox("",{size:1},e),ft.fullCollisionMesh.setEnabled(!1)},v1:new t.Vector3,v2:new t.Vector3,v3:new t.Vector3,v4:new t.Vector3,v5:new t.Vector3,ray:new t.Ray(t.Vector3.Zero(),t.Vector3.Zero(),1),matrix:new t.Matrix,meshCollidesWithMap:function(e,t){var i={};if(isNaN(t.x)||isNaN(t.y)||isNaN(t.z))return!0;for(var r=e.getBoundingInfo().boundingBox,n=0;n<r.vectors.length;n++){var a=Math.floor(t.x+r.vectors[__uv.$wrap((n))].x),o=Math.floor(t.y+r.vectors[__uv.$wrap((n))].y),s=Math.floor(t.z+r.vectors[__uv.$wrap((n))].z);if(a<0||a>=$i.width||s<0||s>=$i.depth||o<0)return!0;var l=a+1e3*o+1e6*s;if(o<$i.height&&!i[__uv.$wrap((l))]){var c=ft.meshCollidesWithCell(e,t,a,o,s);if(c)return c;i[__uv.$wrap((l))]=!0}}return!1},meshCollidesWithCell:function(e,t,i,r,n,a){var o=$i.data[__uv.$wrap((i))][__uv.$wrap((r))][__uv.$wrap((n))];if(o.idx){var s=Ft[__uv.$wrap((o.idx))];if(a&&s.softness)return!1;switch(s.colliderType){case"full":return{x:i,y:r,z:n,cell:o,mesh:ft.fullCollisionMesh};case"ladder":if("pc"!=e.name)return!1;break;case"none":return!1}e.position.x=t.x-i-.5,e.position.y=t.y-r-.5,e.position.z=t.z-n-.5,ft.v1.set(-e.position.x,-e.position.y,-e.position.z),e.setPivotPoint(ft.v1),e.rotation.x=-o.rx,e.rotation.y=-o.ry,e.rotation.z=-o.rz,e.computeWorldMatrix();var l=o.colliderMesh.intersectsMesh(e,o.colliderPrecise,o.colliderChildren);if(l)return{x:i,y:r,z:n,cell:o,mesh:l}}return!1},rayCollidesWithMap:function(e,t,i){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))return!1;if(e.x<0||e.x>=$i.width||e.z<0||e.z>=$i.depth||e.y<0||e.y>=$i.height)return!1;var r=t.length(),n=Math.floor(e.x),a=Math.floor(e.y),o=Math.floor(e.z),s=t.x,l=t.y,c=t.z,u=Math.sign(s),h=Math.sign(l),d=Math.sign(c),p=ft.intbound(e.x,s),m=ft.intbound(e.y,l),_=ft.intbound(e.z,c),f=u/s,g=h/l,y=d/c;if(0===s&&0===l&&0===c)return!1;for(r/=Math.sqrt(s*s+l*l+c*c);(u>0?n<$i.width:n>=0)&&(h>0?a<$i.height:a>=0)&&(d>0?o<$i.depth:o>=0);){if(!(n<0||a<0||o<0||n>=$i.width||a>=$i.height||o>=$i.depth)){var v=i(e,t,{x:n,y:a,z:o});if(v&&"verysoft"!=Ft[__uv.$wrap((v.cell.idx))].softness)return v}if(p<m)if(p<_){if(p>r)break;n+=u,p+=f}else{if(_>r)break;o+=d,_+=y}else if(m<_){if(m>r)break;a+=h,m+=g}else{if(_>r)break;o+=d,_+=y}}},intbound:function(e,t){return t<0?ft.intbound(-e,-t):(1-(e=(e%1+1)%1))/t},getCellForRay:function(e){try{var t=$i.data[__uv.$wrap((e.x))][__uv.$wrap((e.y))][__uv.$wrap((e.z))]}catch(t){console.log(e)}if(!t||!t.mesh)return!1;switch(t.mesh.colliderType){case"none":case"ladder":return!1}return t},projectileCollidesWithCell:function(e,i,r){var n=ft.getCellForRay(r);if(!n)return!1;if(n.mesh.softness)return!1;colliderMesh=n.colliderMesh,ft.matrix.copyFrom(n.colliderMatrix),ft.v4.set(r.x+.5,r.y+.5,r.z+.5),ft.v1.set(e.x,e.y,e.z),ft.v2.copyFrom(i),ft.v1.subtractInPlace(ft.v4),ft.ray.origin.copyFrom(ft.v1),ft.ray.direction.copyFrom(ft.v2),ft.ray.length=1,t.Ray.TransformToRef(ft.ray,ft.matrix,ft.ray);var a=ft.intersectsColliderMesh(colliderMesh,!1);if(colliderMesh=a.pickedMesh,a.hit){if(colliderMesh!=ft.fullCollisionMesh&&(Math.abs(a.pickedPoint.x)>.5||Math.abs(a.pickedPoint.y)>.5||Math.abs(a.pickedPoint.z)>.5)){var o=t.Vector3.DistanceSquared(ft.ray.origin,t.Vector3.Zero());t.Vector3.DistanceSquared(ft.ray.origin,a.pickedPoint)<o&&(a=ft.ray.intersectsMesh(ft.fullCollisionMesh,!1))}if(a.hit){var s=t.Vector3.TransformCoordinates(a.pickedPoint,ft.matrix.invert());return s.addInPlace(ft.v4),a.pickedPoint=s,{cell:n,pick:a}}}return!1},grenadeCollidesWithCell:function(e,i,r,n){var a=ft.getCellForRay(r);if(!a)return!1;colliderMesh=a.colliderMesh,ft.matrix.copyFrom(a.colliderMatrix),ft.v4.set(r.x+.5,r.y+.5,r.z+.5),ft.v1.set(e.x,e.y,e.z),ft.v2.copyFrom(i);var o=i.length();ft.v2.normalize().scaleInPlace(10),ft.v1.subtractInPlace(ft.v4),ft.ray.origin.copyFrom(ft.v1),ft.ray.direction.copyFrom(ft.v2),ft.ray.length=1,t.Ray.TransformToRef(ft.ray,ft.matrix,ft.ray);var s=ft.intersectsColliderMesh(colliderMesh,!1);if(colliderMesh=s.pickedMesh,s.hit){if(t.Vector3.Distance(ft.ray.origin,s.pickedPoint)<=o)return ft.matrix.invert(),(c=t.Vector3.TransformCoordinates(s.pickedPoint,ft.matrix)).addInPlace(ft.v4),s.pickedPoint=c,{cell:a,pick:s,normal:l=t.Vector3.TransformCoordinates(s.normal,ft.matrix),dot:t.Vector3.Dot(i,l)};if(!s.insideMesh)return!1;var l=s.normal;if((s=ft.ray.intersectsMesh(ft.fullCollisionMesh,!1)).hit){var c;ft.matrix.invert(),(c=t.Vector3.TransformCoordinates(s.pickedPoint,ft.matrix)).addInPlace(ft.v4),s.pickedPoint=c;l=s.getNormal(!0,!1);return{cell:a,pick:s,normal:l=t.Vector3.TransformCoordinates(l,ft.matrix),dot:t.Vector3.Dot(i,l)}}}return!1},intersectsColliderMesh:function(e,i){var r=1e5,n=ft.ray.intersectsMesh(e,i),a=null,o=!1;n.hit&&(a=n.getNormal(!0,!1),(u=t.Vector3.Dot(ft.ray.direction,a))>0&&(o=!0),r=t.Vector3.DistanceSquared(ft.ray.origin,n.pickedPoint));for(var s=e.getChildMeshes(),l=0;l<s.length;l++){var c=ft.ray.intersectsMesh(s[__uv.$wrap((l))],i);if(c.hit){var u,h=t.Vector3.DistanceSquared(ft.ray.origin,c.pickedPoint),d=c.getNormal(!0,!1);(u=t.Vector3.Dot(ft.ray.direction,d))>0&&(o=!0),h<r&&(r=h,n=c,a=d,u>0&&(o=!0))}}return n.normal=a,n.insideMesh=o,n},rayCollidesWithPlayer:function(e,t,i,r){for(var n=i?i.player.team:null,a=i?i.player.id:null,o=0;o<playerLimit;o++){var s=ar[__uv.$wrap((o))];if(s&&(s.playing||s.pauseTargetTime>0)&&s.id!=a&&(0==s.team||s.team!=n)){if(ft.ray.origin.copyFrom(e),ft.ray.direction.copyFrom(t),ft.ray.length=1,i.actor)var l=ft.rayCollidesWithPlayerHelper(ft.ray,s,r);else{var c=i.player.serverStateIdx;Math.diff(serverStateIdx,c,Vt)>15&&(c=Math.mod(serverStateIdx-15,Vt));l=ft.rayCollidesWithPlayerHelper(ft.ray,s.stateBuffer[__uv.$wrap((c))],r)}l&&i&&i.collidesWithPlayer(s,l)}}return!1},rayCollidesWithPlayerHelper:function(e,i,r){var n=e.origin,a=r||.3,o=ft.v1;o.copyFrom(n).addInPlace(e.direction);var s=ft.v5;s.set(i.x,i.y+.32,i.z);var l=ft.v2;l.copyFrom(e.origin),l.subtractInPlace(s);var c=t.Vector3.Dot(e.direction,e.direction),u=2*t.Vector3.Dot(e.direction,l),h=t.Vector3.Dot(l,l)-a*a,d=Math.pow(u,2)-4*c*h,p=ft.v3,m=ft.v4;if(d<0)return!1;if(0==d)return t.Vector3.LerpToRef(n,o,d,p),p.subtractToRef(s,m),m.normalize(),m;var _=(-u-Math.sqrt(d))/(2*c);Math.sqrt(d);return _>=0&&_<=1&&(t.Vector3.LerpToRef(n,o,_,p),p.subtractToRef(s,m),m.normalize(),m)}};class gt{static init(){gt.bvh=new mt}static pointCollidesWithStructure(e){var t=gt.box;t.minimumWorld.copyFrom(e),t.maximumWorld.copyFrom(e);let i=!1;return gt.bvh.getObjects(t,t=>{gt.pointCollidesWithBox(e,t)&&(i=!0)}),i}static pointCollidesWithBox(e,i){var r=gt.v3,n=gt.mtx2;return r.copyFrom(e),r.subtractInPlace(i.position),i.matrix.invertToRef(n),t.Vector3.TransformNormalToRef(r,n,r),r.x>=i.minimumWorld.x&&r.x<=i.maximumWorld.x&&r.y>=i.minimumWorld.y&&r.y<=i.maximumWorld.y&&r.z>=i.minimumWorld.z&&r.z<=i.maximumWorld.z}static sphereCollidesWithStructure(e,t,i,r){var n=gt.box,a=gt.v1,o=gt.v2;n.minimumWorld.copyFrom(e),n.minimumWorld.x-=t,n.minimumWorld.y-=t,n.minimumWorld.z-=t,n.maximumWorld.copyFrom(e),n.maximumWorld.x+=t,n.maximumWorld.y+=t,n.maximumWorld.z+=t,i.copyFromFloats(0,0,0);var s=0,l=!1;return gt.bvh.getObjects(n,n=>{gt.sphereCollidesWithBox(e,t,n,a,o)&&(o.y<-.707&&(a.y=a.length(),a.x=0,a.z=0),a.length()>i.length()&&(i.copyFrom(a),r.copyFrom(o),l=n),s++)}),s>0&&l}static sphereCollidesWithBox(e,i,r,n,a){var o=gt.v3,s=gt.v4,l=gt.mtx2;if(o.copyFrom(e),o.subtractInPlace(r.position),r.matrix.invertToRef(l),t.Vector3.TransformNormalToRef(o,l,o),t.Vector3.ClampToRef(o,r.minimumWorld,r.maximumWorld,s),(c=t.Vector3.Distance(o,s))<i){s.subtractInPlace(o),t.Vector3.TransformNormalToRef(s,r.matrix,s),s.addInPlace(e),s.subtractInPlace(r.position),t.Vector3.ClampToRef(s,gt.vmin,gt.vmax,s),s.addInPlace(r.position);var c=t.Vector3.Distance(e,s);if(s.subtractInPlace(e).normalize(),c<(i*=.16*Math.abs(s.y)+.84))return a.copyFrom(s),s.scaleInPlace(c-i-.001),n.copyFrom(s),!0}return!1}static add(e){gt.bvh.add(e)}}function yt(e){this.dmgTypeId=qe.findIndex(e=>"Grenade"===e.name),this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.ttl=0,this.resting=!1,this.active=!1,this.player=null,void 0!==Mo&&(this.actor=new Mo(this))}gt.v1=new t.Vector3,gt.v2=new t.Vector3,gt.v3=new t.Vector3,gt.v4=new t.Vector3,gt.v5=new t.Vector3,gt.v6=new t.Vector3,gt.v7=new t.Vector3,gt.mtx1=new t.Matrix,gt.mtx2=new t.Matrix,gt.vmin=new t.Vector3(-.5,-.5,-.5),gt.vmax=new t.Vector3(.5,.5,.5),gt.box=new t.BoundingBox(t.Vector3.Zero(),t.Vector3.Zero()),gt.Type={full:1,wedge:2,iwedge:4,aabb:8,obb:16,ladder:32},gt.aabbMask=gt.Type.full|gt.Type.aabb|gt.Type.ladder,yt.v1=new t.Vector3,yt.v2=new t.Vector3,yt.v3=new t.Vector3,yt.v4=new t.Vector3,yt.matrix=new t.Matrix,yt.prototype.update=function(){if(this.ttl<=0){if(this.remove(),!this.actor){var e=bi.getBuffer();e.packInt8(Xe.explode),e.packInt8(st.Grenade),e.packInt16(this.player.grenadeItem?this.player.grenadeItem.id:16e3),e.packFloat(this.x),e.packFloat(this.y),e.packFloat(this.z),e.packInt8(this.damage),e.packFloat(this.radius),sendToAll(e),checkExplosionCollisions(this)}}else{if(!this.resting){var t=this.dx,i=this.dy,r=this.dz,n=.5*(this.dx+t),a=.5*(this.dy+i),o=.5*(this.dz+r);Math.length3(n,a,o);this.collidesWithMap()||(this.x+=n,this.y+=a,this.z+=o,this.dy-=.012),this.dx*=.96,this.dz*=.96}this.ttl-=1}},yt.prototype.remove=function(){Sr.grenadePool.recycle(this),this.actor&&this.actor.remove()},yt.prototype.collidesWithMap=function(){yt.v1.set(this.x,this.y-.07,this.z),yt.v2.set(this.dx,this.dy,this.dz),yt.v3.set(this.dx,this.dy,this.dz);var e=ft.rayCollidesWithMap(yt.v1,yt.v2,ft.grenadeCollidesWithCell);if(e){if(!(1==e.normal.y&&yt.v3.length()<.05))return yt.v3.subtractInPlace(e.normal.scale(1.6*e.dot)),this.dx=.98*yt.v3.x,this.dy=yt.v3.y,this.dz=.98*yt.v3.z,this.actor&&this.actor.bounce(),e;this.resting=!0}return!1},yt.prototype.throw=function(e,t,i){this.player=e,this.x=t.x,this.y=t.y,this.z=t.z,this.dx=i.x,this.dy=i.y,this.dz=i.z,this.ttl=75,this.damage=150,this.radius=3,this.resting=!1,this.active=!0,this.actor&&this.actor.throw()};class vt{constructor(e){this.dmgTypeId=0,this.player=e,this.scene=this.player.scene,this.highPrecision=!1,this.equipTime=13,this.stowWeaponTime=13,this.accuracy=this.constructor.accuracyMax,this.shootingAccuracy=this.constructor.accuracyMax,this.movementAccuracy=this.constructor.accuracyMax,this.accuracyMax=this.constructor.accuracyMax,this.accuracyMin=this.constructor.accuracyMin,this.accuracyLoss=this.constructor.accuracyLoss,this.accuracyRecover=this.constructor.accuracyRecover,this.tracer=0,this.burstQueue=0,this.adsMod=this.constructor.adsMod||.5,this.movementAccuracyMod=this.constructor.movementAccuracyMod||1}update(){this.burstQueue>0&&(this.burstQueue%this.constructor.burstRof==0&&this.fire(),this.burstQueue--),this.player.scope&&0===this.player.scopeDelay?this.accuracyMod=this.adsMod:this.accuracyMod=1;let e=14.41*Math.length2(this.player.dx,this.player.dz),t=Math.min(1,14.41*Math.abs(this.player.dy)),i=this.constructor.reloadBloom&&this.player.reloadCountdown>0||this.player.swapWeaponCountdown>0||this.player.grenadeCountdown>0,r=this.player.scope&&0===this.player.scopeDelay,n=(e+t+(i?1:0))*this.constructor.accuracyMin;this.movementAccuracy<n?this.movementAccuracy=n:this.movementAccuracy=Math.max(this.movementAccuracy-this.constructor.accuracyRecover,n),r?(this.accuracyMax=this.constructor.accuracyMax*this.adsMod,this.accuracyMin=this.constructor.accuracyMin*this.adsMod,this.accuracyLoss=this.constructor.accuracyLoss*this.adsMod):(this.accuracyMax=this.constructor.accuracyMax,this.accuracyMin=this.constructor.accuracyMin,this.accuracyLoss=this.constructor.accuracyLoss),this.accuracyRecover=Math.min(this.accuracyRecover+this.constructor.accuracyRecover,this.constructor.accuracyRecover);let a=Math.max(this.accuracyRecover,0);this.shootingAccuracy=Math.max(this.shootingAccuracy-a,this.accuracyMax),this.accuracy=this.movementAccuracy*this.movementAccuracyMod+this.shootingAccuracy,this.constructor.absoluteMinAccuracy&&(this.accuracy=Math.min(this.accuracy,this.constructor.absoluteMinAccuracy))}collectAmmo(){return(this.actor||this.ammo.store<this.ammo.storeMax)&&(this.ammo.store=Math.min(this.ammo.storeMax,this.ammo.store+this.ammo.pickup),!0)}fire(){var e=t.Matrix.RotationYawPitchRoll(this.player.yaw,this.player.pitch,0),i=t.Matrix.Translation(0,0,this.constructor.range).multiply(e),r=i.getTranslation();this.shootingAccuracy=Math.min(this.shootingAccuracy+this.accuracyLoss,this.accuracyMin),this.accuracyRecover=8*-this.constructor.accuracyRecover;let n=this.accuracy;if(isNaN(n)&&(n=0),this.constructor.burst&&this.burstQueue<=0&&(this.burstQueue=(this.constructor.burst-1)*this.constructor.burstRof),this.constructor!==xt){let e=n,r=t.Matrix.RotationYawPitchRoll((this.player.randomGen.getFloat()-.5)*e,(this.player.randomGen.getFloat()-.5)*e,(this.player.randomGen.getFloat()-.5)*e);i=i.multiply(r)}r=i.getTranslation();var a=t.Matrix.Translation(0,.1,0),o=(a=(a=a.multiply(e)).add(t.Matrix.Translation(this.player.x,this.player.y+.3,this.player.z))).getTranslation();if(o.x=Math.floor(256*o.x)/256,o.y=Math.floor(256*o.y)/256,o.z=Math.floor(256*o.z)/256,r.x=Math.floor(256*r.x)/256,r.y=Math.floor(256*r.y)/256,r.z=Math.floor(256*r.z)/256,this.ammo.rounds--,this.actor)return this.player.id==u&&Mn(),this.actor.fire(),this.fireMunitions(o,r),void(--this.tracer<0&&(this.tracer=this.constructor.tracer));var s=bi.getBuffer();s.packInt8(Xe.fire),s.packInt8(this.player.id),s.packFloat(o.x),s.packFloat(o.y),s.packFloat(o.z),s.packFloat(r.x),s.packFloat(r.y),s.packFloat(r.z),sendToAll(s),this.fireMunitions(o,r)}equip(e){this.player.weaponIdx=this.player.equipWeaponIdx,this.player.weapon=this.player.weapons[__uv.$wrap((this.player.weaponIdx))],this.player.weapon.actor.equip(e),this.player.id==u&&Mn(),this.player.lastWeaponChange=0}}vt.reloadBloom=!0,vt.reloadTimeMod=1;class bt extends vt{constructor(e,t){super(e),this.ammo={rounds:30,capacity:30,reload:30,store:240,storeMax:240,pickup:30},this.longReloadTime=205,this.shortReloadTime=160,void 0!==Ro&&(this.actor=new Ro(this,t))}fireMunitions(e,t){pt.fire(this.player,e,t,bt)}}bt.dmgTypeId=qe.findIndex(e=>"Eggk47"===e.name),bt.weaponName="EggK-47",bt.standardMeshName="eggk47",bt.rof=3,bt.recoil=7,bt.automatic=!0,bt.damage=20,bt.totalDamage=20,bt.range=20,bt.velocity=1.5,bt.tracer=1;class xt extends vt{constructor(e,i){super(e),this.ammo={rounds:2,capacity:2,reload:2,store:24,storeMax:24,pickup:8},this.longReloadTime=155,this.shortReloadTime=155,this.v1=new t.Vector3,void 0!==wo&&(this.actor=new wo(this,i))}fireMunitions(e,t){for(var i=this.accuracy,r=.6*i,n=0;n<20;n++)this.v1.set(t.x+this.player.randomGen.getFloat(-i,i)*xt.range,t.y+this.player.randomGen.getFloat(-r,r)*xt.range,t.z+this.player.randomGen.getFloat(-i,i)*xt.range),pt.fire(this.player,e,this.v1,xt)}}xt.dmgTypeId=qe.findIndex(e=>"Scrambler"===e.name),xt.weaponName="Dozen Gauge",xt.standardMeshName="dozenGauge",xt.rof=8,xt.recoil=10,xt.automatic=!1,xt.damage=8,xt.totalDamage=20*xt.damage,xt.range=8,xt.velocity=1,xt.tracer=0;class St extends vt{constructor(e,t){super(e),this.ammo={rounds:15,capacity:15,reload:15,store:60,storeMax:60,pickup:15},this.hasScope=!0,this.longReloadTime=225,this.shortReloadTime=165,this.highPrecision=!0,void 0!==Io&&(this.actor=new Io(this,t))}fireMunitions(e,t){pt.fire(this.player,e,t,St)}}St.dmgTypeId=qe.findIndex(e=>"FreeRanger"===e.name),St.weaponName="CSG-1",St.standardMeshName="csg1",St.rof=13,St.recoil=13,St.automatic=!1,St.damage=110,St.totalDamage=110,St.range=50,St.velocity=1.75,St.tracer=0;class Tt extends vt{constructor(e,t){super(e),this.ammo={rounds:15,capacity:15,reload:15,store:60,storeMax:60,pickup:15},this.longReloadTime=195,this.shortReloadTime=160,void 0!==Oo&&(this.actor=new Oo(this,t))}fireMunitions(e,t){pt.fire(this.player,e,t,Tt)}}Tt.dmgTypeId=qe.findIndex(e=>"Cluck9mm"===e.name),Tt.weaponName="Cluck 9mm",Tt.standardMeshName="cluck9mm",Tt.rof=4,Tt.recoil=6,Tt.automatic=!1,Tt.damage=25,Tt.totalDamage=25,Tt.range=15,Tt.velocity=1,Tt.tracer=0;class Et extends vt{constructor(e,t){super(e),this.ammo={rounds:1,capacity:1,reload:1,store:3,storeMax:3,pickup:1},this.hasScope=!0,this.longReloadTime=170,this.shortReloadTime=170,void 0!==Do&&(this.actor=new Do(this,t))}fireMunitions(e,t){if(ei.fire(this.player,e,t,Et),this.actor)for(var i=0;i<10;i++){var r=.04*Math.random()-.02,n=.04*Math.random()-.02,a=.04*Math.random()-.02;Nr(Ei,10,e.x,e.y,e.z,r,n,a,.4,!1,0)}}}Et.dmgTypeId=qe.findIndex(e=>"Rpegg"===e.name),Et.weaponName="RPEGG",Et.standardMeshName="rpegg",Et.rof=40,Et.recoil=60,Et.automatic=!1,Et.damage=140,Et.radius=2.75,Et.totalDamage=Et.damage*Et.radius*.5,Et.range=45,Et.minRange=3,Et.velocity=.4;class Pt extends vt{constructor(e,t){super(e),this.ammo={rounds:40,capacity:40,reload:40,store:200,storeMax:200,pickup:40},this.longReloadTime=225,this.shortReloadTime=190,void 0!==ko&&(this.actor=new ko(this,t))}fireMunitions(e,t){pt.fire(this.player,e,t,Pt)}}Pt.dmgTypeId=qe.findIndex(e=>"Whipper"===e.name),Pt.weaponName="SMEGG",Pt.standardMeshName="smg",Pt.rof=2,Pt.recoil=7,Pt.automatic=!0,Pt.damage=15,Pt.totalDamage=15,Pt.range=20,Pt.velocity=1.25,Pt.tracer=2;class At extends vt{constructor(e,t){super(e),this.ammo={rounds:1,capacity:1,reload:1,store:20,storeMax:20,pickup:4},this.hasScope=!0,this.longReloadTime=144,this.shortReloadTime=144,void 0!==Bo&&(this.actor=new Bo(this,t))}fireMunitions(e,t){pt.fire(this.player,e,t,At)}}At.dmgTypeId=qe.findIndex(e=>"Crackshot"===e.name),At.weaponName="M2DZ",At.standardMeshName="m24",At.rof=15,At.recoil=20,At.automatic=!1,At.damage=200,At.totalDamage=15,At.range=60,At.velocity=2,At.tracer=0;class Mt extends vt{constructor(e,t){super(e),this.ammo={rounds:24,capacity:24,reload:24,store:150,storeMax:150,pickup:24},this.longReloadTime=205,this.shortReloadTime=160,void 0!==Fo&&(this.actor=new Fo(this,t))}fireMunitions(e,t){pt.fire(this.player,e,t,Mt)}}Mt.dmgTypeId=qe.findIndex(e=>"TriHard"===e.name),Mt.weaponName="TriHard",Mt.standardMeshName="aug",Mt.rof=15,Mt.recoil=18,Mt.automatic=!1,Mt.movementInstability=2,Mt.damage=20,Mt.totalDamage=20,Mt.range=20,Mt.velocity=1.5,Mt.tracer=0,Mt.burst=3,Mt.burstRof=3,bt.damage=30,bt.accuracyMax=.03,bt.accuracyMin=.15,bt.accuracyLoss=.05,bt.accuracyRecover=.025,bt.totalDamage=30,xt.damage=8.5,xt.accuracyMax=.14,xt.accuracyMin=.17,xt.accuracyLoss=.17,xt.accuracyRecover=.02,xt.totalDamage=170,xt.adsMod=.6,xt.movementAccuracyMod=.2,St.damage=105,St.accuracyMax=.004,St.accuracyMin=.3,St.accuracyLoss=.3,St.accuracyRecover=.025,St.totalDamage=105,Et.accuracyMax=.015,Et.accuracyMin=.3,Et.accuracyLoss=.3,Et.accuracyRecover=.02,Et.absoluteMinAccuracy=.3,Pt.damage=23,Pt.accuracyMax=.06,Pt.accuracyMin=.19,Pt.accuracyLoss=.045,Pt.accuracyRecover=.05,Pt.totalDamage=23,Pt.adsMod=.6,Pt.movementAccuracyMod=.7,At.damage=170,At.accuracyMax=0,At.accuracyMin=.35,At.accuracyLoss=.1,At.accuracyRecover=.023,At.totalDamage=170,At.movementAccuracyMod=.85,At.reloadBloom=!1,At.reloadTimeMod=.8,Tt.damage=26,Tt.accuracyMax=.035,Tt.accuracyMin=.15,Tt.accuracyLoss=.09,Tt.accuracyRecover=.08,Tt.totalDamage=26,Tt.adsMod=.8,Tt.movementAccuracyMod=.6,Mt.damage=35,Mt.accuracyMax=.03,Mt.accuracyMin=.15,Mt.accuracyLoss=.04,Mt.accuracyRecover=.03,Mt.totalDamage=34,Mt.adsMod=.6,Mt.movementAccuracyMod=.8;var Ct=[{filename:"aqueduct",hash:"keinoli3vk",name:"Aqueduct",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"backstage",hash:"2f16w9cv0h5",name:"Backstage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"bastion",hash:"1baur79xgrl",name:"Bastion",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"bedrock",hash:"12ady3jkjc8",name:"Bedrock",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"biohazard",hash:"y8ehej9rzp",name:"BioHazard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"blender",hash:"1ubjlw9byd0",name:"Blender",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"blueh",hash:"2as7ewi6ma1",name:"Blue Up",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"bridge",hash:"1xnykouv80w",name:"Bridge",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"castle",hash:"19u9khg7eu5",name:"Castle",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"castleArena",hash:"2atu97hhga2",name:"Castle Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"8"},{filename:"catacombs",hash:"110a2pbuftg",name:"Catacombs",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"cluckgroundsh",hash:"ftblp6r5pi",name:"Cluckgrounds",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"16"},{filename:"crowsnesth",hash:"23jdjzpz0nm",name:"Crowsnest",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"8"},{filename:"deathpit",hash:"1o1egq7amvh",name:"Death Pit",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"dirt",hash:"1thvvow5cq1",name:"Dirt",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"dirt2",hash:"1syyqxnf3xs",name:"Dirt 2",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"dirtbase",hash:"1tuuh5gfnef",name:"Dirt Base",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"downfall",hash:"156fnaug1pc",name:"Downfall",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"duelPyramid",hash:"11qg5h712ai",name:"DuelPyramid",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"eggcrates",hash:"25340eipbpz",name:"Eggcrates",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"6"},{filename:"enchanted",hash:"pflyna5tq5",name:"Enchanted",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"exposure",hash:"11qa66i0mq5",name:"Exposure",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"feedlot",hash:"tklfm1chph",name:"Feedlot",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"field",hash:"11bounxctqm",name:"Field",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"fortFlip",hash:"2eum2kvxgmi",name:"Fort Flip",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"fourQuarters",hash:"1scs5vej59j",name:"Four Quarters",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"both",numPlayers:"10"},{filename:"growler",hash:"nsbphj928m",name:"Growler",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"haunted",hash:"3ygypcx8ew",name:"Haunted",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"16"},{filename:"helix",hash:"1aqp7c8qnlt",name:"Helix",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"jailbreak",hash:"1xipg7iwgal",name:"Jail Break",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"jinx",hash:"277lyg65e23",name:"Jinx",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"junction",hash:"68j04g1gq8",name:"Junction",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"kingsCourt",hash:"2ef4g97ohhv",name:"King's Court",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mansion",hash:"14dg0n2rc2",name:"Mansion",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"moonbase",hash:"z1owwq4ja0",name:"Moonbase",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mudGulch",hash:"1ntsg206jrw",name:"Mud Gulch",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"outer",hash:"h6kltwngva",name:"Outer Reach",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"overcooked",hash:"1srsvkyazcn",name:"Overcooked",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"palaceSiege",hash:"p9lif6tunb",name:"Palace Siege",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"quarryh",hash:"2436yd85sx1",name:"Quarry",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"raceway",hash:"qv03k4z4d8",name:"Raceway",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"rameses",hash:"1ilxnmjlawc",name:"Rameses",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"16"},{filename:"rats",hash:"1f8bnpkxzm",name:"Rats",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"rivals",hash:"1y904men7at",name:"Rivals",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"roadh",hash:"26mccpfq3mf",name:"Road",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"ruins",hash:"2fdbhhk7q8d",name:"Ruins",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"scales",hash:"plwjtkhlbd",name:"Scales",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"shellville",hash:"20nmg1h9xzg",name:"Shellville",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"16"},{filename:"shipyard",hash:"1fkj1u6xjny",name:"Shipyard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"skyScratcher",hash:"25i0ulupygc",name:"Sky Scratcher",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"spaceFactory",hash:"1arztxf6te8",name:"Space Factory",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"10"},{filename:"spacearena",hash:"1p1eqcwt0b3",name:"Space Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"14"},{filename:"sparta",hash:"1dx76stx4qh",name:"Sparta",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"spellbound",hash:"g8nt9vk40r",name:"Spellbound",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"stage",hash:"xhf2vb001g",name:"Stage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"staxarena",hash:"19t57lht2nr",name:"Stax Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"teggtris",hash:"hbzaqu5bpo",name:"Teggtris",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"temple",hash:"mxz7rzn32b",name:"Temple",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"timetwist",hash:"1kdjrlkkof4",name:"Timetwist",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"trainyard",hash:"1zhr7qfd37r",name:"Trainyard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"treefort",hash:"vd0q23m1z2",name:"Tree Fort",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"twoTowersh",hash:"v7cj4omo4n",name:"Two More Towers",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"vert",hash:"11fslgkx7ox",name:"Vert",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"wimble",hash:"pc9fh1efu0",name:"Wimble",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"wreckage",hash:"o4ob7n8068",name:"Wreckage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"}];function Rt(){this.seed=100}Math.PI2=2*Math.PI,Math.PI90=Math.PI/2,Math.mod=function(e,t){var i=e%t;return i>=0?i:i+t},Math.length2=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},Math.length3=function(e,t,i){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(i,2))},Math.capVector2=function(e,t){var i=Math.length2(e.x,e.y);return i>t&&(e.x*=t/i,e.y*=t/i),e},Math.capVector3=function(e,t){var i=Math.length3(e.x,e.y,e.z);return i>t&&(e.x*=t/i,e.y*=t/i,e.z*=t/i),e},Math.normalize2=function(e,t){t=t||1;var i=Math.length2(e.x,e.y);return e.x*=t/i,e.y*=t/i,e},Math.normalize3=function(e,t){t=t||1;var i=Math.length3(e.x,e.y,e.z);return e.x*=t/i,e.y*=t/i,e.z*=t/i,e},Math.clamp=function(e,t,i){return Math.max(Math.min(e,i),t)},Math.radAdd=function(e,t){return Math.floor(8192*Math.mod(e+t,Math.PI2))/8192},Math.radSub=function(e,t){return Math.floor(8192*Math.mod(e-t,Math.PI2))/8192},Math.radRange=function(e){return Math.mod(e,Math.PI2)},Math.radDifference=function(e,t){var i=(e-t+Math.PI)%Math.PI2-Math.PI;return i=i<-Math.PI?i+Math.PI2:i},Math.cardVals=[0,Math.PI90,Math.PI,3*Math.PI90],Math.cardToRad=function(e){return Math.cardVals[__uv.$wrap((e))]},Math.randomInt=function(e,t){return Math.floor(Math.random()*(t-e)+e)},Math.diff=function(e,t,i){return e<t?i-e+t:e-t},Rt.prototype.setSeed=function(e){this.seed=e},Rt.prototype.getFloat=function(e,t){return e=e||0,t=t||1,this.seed=(9301*this.seed+49297)%233280,e+this.seed/233280*(t-e)},Rt.prototype.getInt=function(e,t){return Math.floor(this.getFloat(e,t))};var wt=function(e){return e},It=function(e){return e*e},Ot=function(e){return e<.5?2*e*e:(4-2*e)*e-1},Dt=function(e){return 1+--e*e*e*e*e};class kt{constructor(e){this.player=e,this.scene=this.player.scene,this.collisionCountdown=0,this.dmgTypeId=qe.findIndex(e=>"Melee"===e.name),e.actor&&(this.actor=new jo(this,this.player.meleeItem.item_data.meshName)),this.dir=new t.Vector3}attack(){this.collisionCountdown=5}checkCollisions(){var e=t.Matrix.RotationYawPitchRoll(this.player.yaw,this.player.pitch,0),i=t.Matrix.Translation(0,0,.8).multiply(e);this.dir=i.getTranslation(),kt.v1.set(this.player.x-.25*this.dir.x,this.player.y-.25*this.dir.y+.3,this.player.z-.25*this.dir.z),ft.rayCollidesWithPlayer(kt.v1,this.dir,this,.475)}collidesWithPlayer(e){let t=40;this.player.activeShellStreaks&tt.EggBreaker&&(t=255),yn(e,this,t,this.dir.x,this.dir.z)}update(){this.collisionCountdown>0&&0==--this.collisionCountdown&&this.checkCollisions()}}function Bt(e){this.bulletPool=new Ut((function(){return new pt(e)}),200),this.rocketPool=new Ut((function(){return new ei(e)}),20),this.grenadePool=new Ut((function(){return new yt(e)}),10)}kt.v1=new t.Vector3,kt.v2=new t.Vector3,Bt.prototype.updateLogic=function(){this.bulletPool.forEachActive((function(e){e.update()})),this.rocketPool.forEachActive((function(e){e.update()})),this.grenadePool.forEachActive((function(e){e.update()}))},Bt.prototype.updateActors=function(e){this.bulletPool.forEachActive((function(t){t.actor.update(e)})),this.rocketPool.forEachActive((function(t){t.actor.update(e)})),this.grenadePool.forEachActive((function(t){t.actor.update(e)}))},Bt.prototype.removeAll=function(){this.bulletPool.forEachActive((function(e){e.remove()})),this.rocketPool.forEachActive((function(e){e.remove()})),this.grenadePool.forEachActive((function(e){e.remove()}))},Bt.prototype.throwGrenade=function(e,t,i){this.grenadePool.retrieve().throw(e,t,i)},Bt.prototype.getMapIntersectionPoint=function(e,i){if(i&&!Ft[__uv.$wrap((i.cell.idx))].softness&&i.cell&&i.cell.idx){var r=Ft[__uv.$wrap((i.cell.idx))],n=new t.Ray(new t.Vector3(e.x-e.dx-i.x-.5,e.y-e.dy-i.y-.5,e.z-e.dz-i.z-.5),new t.Vector3(2*e.dx,2*e.dy,2*e.dz),1);r.rotation.x=i.cell.rx,r.rotation.y=i.cell.ry,r.rotation.z=i.cell.rz;var a=n.intersectsMesh(r,!1);if(a.hit){var o=new t.Vector3(-e.dx,-e.dy,-e.dz).normalize().scale(.005);return{x:a.pickedPoint.x+i.x+.5+o.x,y:a.pickedPoint.y+i.y+.5+o.y,z:a.pickedPoint.z+i.z+.5+o.z}}}return!1};var Ft,Lt={up:1,down:2,left:4,right:8,jump:16,fire:32,melee:64,scope:128,ascend:256,descend:512},Nt=[{name:"Soldier",weapon:bt},{name:"Scrambler",weapon:xt},{name:"Free Ranger",weapon:St},{name:"Eggsploder",weapon:Et},{name:"Whipper",weapon:Pt},{name:"Crackshot",weapon:At},{name:"TriHard",weapon:Mt}],Vt=256;function Gt(e,t){this.id=e.id,this.uniqueId=e.uniqueId,this.name=e.name,this.normalName=e.normalName,this.safeName=e.safeName,this.charClass=e.charClass,this.team=e.team,this.primaryWeaponItem=e.primaryWeaponItem,this.secondaryWeaponItem=e.secondaryWeaponItem,this.shellColor=e.shellColor,this.hatItem=e.hatItem,this.stampItem=e.stampItem,this.grenadeItem=e.grenadeItem,this.meleeItem=e.meleeItem,this.x=e.x,this.y=e.y,this.z=e.z,this.dx=e.dx,this.dy=e.dy,this.dz=e.dz,this.controlKeys=e.controlKeys,this.yaw=e.yaw,this.pitch=e.pitch,this.speed=0,this.scope=!1,this.scopeDelay=0,this.score=e.score,this.totalKills=0,this.totalDeaths=0,this.bestGameStreak=e.bestGameStreak,this.bestOverallStreak=e.bestOverallStreak,this.stats={streak:e.stats.streak,kills:e.stats.kills,killsCluck9mm:e.stats.killsCluck9mm,killsGrenade:e.stats.killsGrenade,killsRpegg:e.stats.killsRpegg,killsEggk47:e.stats.killsEggk47,killsScrambler:e.stats.killsScrambler,killsFreeRanger:e.stats.killsFreeRanger,killsWhipper:e.stats.killsWhipper,killsCrackshot:e.stats.killsCrackshot,killsTriHard:e.stats.killsTriHard,killsMelee:e.stats.killsMelee,killsPrivate:e.stats.killsPrivate,killsPublic:e.stats.killsPublic,killsKing:e.stats.killsKing,killsSpatula:e.stats.killsSpatula,killsTeams:e.stats.killsTeams,killsFFA:e.stats.killsFFA,deaths:e.stats.deaths,deathsCluck9mm:e.stats.deathsCluck9mm,deathsGrenade:e.stats.deathsGrenade,deathsRpegg:e.stats.deathsRpegg,deathsEggk47:e.stats.deathsEggk47,deathsScrambler:e.stats.deathsScrambler,deathsFreeRanger:e.stats.deathsFreeRanger,deathsWhipper:e.stats.deathsWhipper,deathsCrackshot:e.stats.deathsCrackshot,deathsTriHard:e.stats.deathsTriHard,deathsMelee:e.stats.deathsMelee,deathsPrivate:e.stats.deathsPrivate,deathsPublic:e.stats.deathsPublic,deathsKing:e.stats.deathsKing,deathsSpatula:e.stats.deathsSpatula,deathsTeams:e.stats.deathsTeams,deathsFFA:e.stats.deathsFFA,kotcCaptured:e.stats.kotcCaptured,kotcWins:e.stats.kotcWins},this.gameData=e.gameData,this.shield=e.shield,this.hp=e.hp,this.playing=e.playing,this.weaponIdx=e.weaponIdx,this.upgradeProductId=e.upgradeProductId,this.mobileMultiplier=1,this.isGameOwner=e.isGameOwner,this.capturing=!1,this.activeShellStreaks=e.activeShellStreaks,this.adminRoles=e.adminRoles,this.muted=e.muted,this.scene=t,this.corrected={dx:0,dy:0,dz:0,pitch:0,yaw:0},this.corrections=0,this.totalCorrections=2,this.resetCountdowns(),this.equipWeaponIdx=this.weaponIdx,this.grenadeCount=1,this.grenadeCapacity=3,this.lastWeaponChange=0,this.jumpQueued=0,this.jumping=!1,this.onGround=4,this.climbing=!1,this.bobble=0,this.hardBoiledValue=0,this.eggBreakerValue=0,this.stateIdx=0,this.clientStateIdx=0,this.serverStateIdx=0,this.respawnTargetTime=0,this.pauseTargetTime=0,this.ready=!1,this.chatLineCap=3,this.respawnQueued=!1,this.canTakeTeamBonus=!0,this.lastDamageTakenType=0,this.lastDamageGivenType=0,this.lastDmgType=0,this.damageMod=e.damageMod,this.abBucket=e.abBucket,void 0!==Jo&&(this.actor=new Jo(this)),this.changeWeaponLoadout(this.primaryWeaponItem,this.secondaryWeaponItem),this.stateBuffer=[],this.resetStateBuffer(),this.randomGen=new Rt,this.social=e.social,this.hideBadge=e.hideBadge}function Ut(e,t){this.size=0,this.originalSize=t,this.constructorFn=e,this.objects=[],this.idx=0,this.numActive=0,this.expand(t)}if(Gt.v1=new t.Vector3,Gt.v2=new t.Vector3,Gt.v3=new t.Vector3,Gt.v4=new t.Vector3,Gt.v5=new t.Vector2,Gt.v6=new t.Vector2,Gt.v7=new t.Vector3,Gt.v8=new t.Vector3,Gt.ray=new t.Ray,Gt.matrix=new t.Matrix,Gt.prototype.changeWeaponLoadout=function(e,t){this.actor&&this.weapons&&(this.weapons[__uv.$wrap((0))].actor.dispose(),this.weapons[__uv.$wrap((1))].actor.dispose(),this.meleeWeapon.actor.dispose()),this.meleeWeapon=new kt(this),this.primaryWeaponItem=e,this.secondaryWeaponItem=t,this.weapons=[e.instantiateNew(this),t.instantiateNew(this)],this.weapon=this.weapons[__uv.$wrap((this.weaponIdx))],this.actor&&this.weapon.actor.equip()},Gt.prototype.update=function(e){var i=0,r=0,n=0;if(!e&&this.actor&&this.id==u&&(this.controlKeys=Wi),!this.actor||this.id!=u){var a=this.stateIdx;this.actor&&(a=Math.min(a,Je-1)),this.controlKeys=this.stateBuffer[__uv.$wrap((a))].controlKeys,this.yaw=this.stateBuffer[__uv.$wrap((a))].yaw,this.pitch=this.stateBuffer[__uv.$wrap((a))].pitch,this.stateBuffer[__uv.$wrap((a))].controlKeys=0}var o=this.stateBuffer[__uv.$wrap((this.stateIdx))];if(this.actor)o.controlKeys=this.controlKeys,o.yaw=this.yaw,o.pitch=this.pitch;else{this.shotsQueued+=o.shots,o.shots=0;a=Math.mod(this.stateIdx+1,Vt);this.stateBuffer[__uv.$wrap((a))].yaw=this.yaw,this.stateBuffer[__uv.$wrap((a))].pitch=this.pitch}this.controlKeys&Lt.left&&(i-=Math.cos(this.yaw),n+=Math.sin(this.yaw)),this.controlKeys&Lt.right&&(i+=Math.cos(this.yaw),n-=Math.sin(this.yaw)),this.controlKeys&Lt.up&&(this.climbing?r+=1:(i+=Math.sin(this.yaw),n+=Math.cos(this.yaw))),this.controlKeys&Lt.down&&(this.climbing?r-=1:(i-=Math.sin(this.yaw),n-=Math.cos(this.yaw))),this.controlKeys&Lt.jump&&(this.jumpQueued=10,this.controlKeys^=this.controlKeys&Lt.jump,this.actor&&this.id==u&&(Wi^=Wi&Lt.jump)),this.controlKeys&Lt.scope?this.scope||this.scopeIn():this.scope&&this.scopeOut(),this.jumpQueued>0&&(this.jumpQueued--,this.jump());let s=this.scope&&0===this.scopeDelay;if(this.climbing){this.setJumping(!1);var l=this.dy;this.corrections&&(l+=this.corrected.dy/this.totalCorrections,this.corrections--),this.dy+=.028*r;var c=.5*(this.dy+l);this.y+=c,this.dy*=.5,Math.floor(this.y)>=$i.height&&(this.climbing=!1),this.move(0,c,0)}else{var h=new t.Vector3(i,r,n).normalize();s&&(h.x*=.5,h.z*=.5),this.dx+=.025*h.x,this.dz+=.025*h.z,this.dy-=.012,this.dy=Math.max(-.29,this.dy);var d=Gt.v4;if(d.copyFromFloats(this.x,this.y,this.z),this.move(this.dx,this.dy,this.dz),this.dx=this.x-d.x,this.dy=this.y-d.y,this.dz=this.z-d.z,this.onGround&&this.dy>0){var p=1-.5*Gt.v7.copyFromFloats(this.dx,this.dy,this.dz).normalize().y;this.dx*=p,this.dz*=p}!e&&this.corrections&&(l=0,pdx=this.corrected.dx/this.totalCorrections,this.climbing&&(l=this.corrected.dy/this.totalCorrections),pdz=this.corrected.dz/this.totalCorrections,this.corrections--,this.move(pdx,l,pdz))}if(!e){this.shield>0&&this.playing&&(this.shield-=2,(0!=i||0!=r||this.shield<=0)&&this.disableShield()),this.scopeDelay=Math.max(0,this.scopeDelay-1),this.lastWeaponChange++;var m=Math.max(0,Math.length3(this.dx,this.dy,this.dz)-.012);if(this.speed=m,(this.climbing||this.jumping)&&(m*=2),this.bobble=(this.bobble+7*(m+.01))%Math.PI2,this.weapon&&this.weapon.update(),this.meleeWeapon.update(),this.meleeCountdown>0&&0==--this.meleeCountdown&&(this.swapWeaponCountdown=.5*this.weapon.equipTime,this.actor&&(this.actor.wieldGun(),this.id===ir&&Bi.show())),this.hp>0&&(this.hp=Math.min(100,this.hp+.1)),this.swapWeaponCountdown>0&&(this.swapWeaponCountdown--,this.swapWeaponCountdown<=0&&(this.actor?this.id==u&&Bi.show():(this.swapWeaponCountdown=0,this.weaponIdx=this.equipWeaponIdx,this.weapon=this.weapons[__uv.$wrap((this.weaponIdx))]))),this.reloadCountdown>0&&(this.lastWeaponChange=0,this.reloadCountdown-=2,this.reloadCountdown<=0&&(this.reloadCountdown=0,this.reloaded())),this.rofCountdown>0&&(this.rofCountdown=Math.max(this.rofCountdown-1,0)),this.recoilCountdown>0&&(this.recoilCountdown=Math.max(this.recoilCountdown-2,0)),this.grenadeCountdown>0&&(this.grenadeCountdown-=2,this.grenadeCountdown<=0&&this.grenadesQueued>0&&!this.actor&&this.throwGrenade()),this.actor){if(this.id==u){this.triggerPulled&&this.fire(),this.activeShellStreaks&tt.EggBreaker&&(this.eggBreakerValue=Math.max(0,this.eggBreakerValue-1));var _=Math.floor(this.eggBreakerValue/30),f=document.getElementById("eggBreakerTimer");_!=parseInt(f.innerText)&&(f.innerText=_)}}else if(this.shotsQueued>0?(this.lastActivity=qi,this.fire()):this.meleeQueued>0&&(this.lastActivity=qi,this.melee()&&this.meleeQueued--),this.activeShellStreaks&tt.EggBreaker&&--this.eggBreakerValue<=0){this.endShellStreak(tt.EggBreaker);var g=bi.getBuffer();g.packInt8(Xe.endShellStreak),g.packInt8(this.id),g.packInt8(tt.EggBreaker),sendToAll(g)}this.stateIdx=Math.mod(this.stateIdx+1,Vt);o=this.stateBuffer[__uv.$wrap((this.stateIdx))];this.saveState(o),this.actor&&va&&this.id==u&&ir.stateIdx%Je==0&&va.readyState==va.OPEN&&ir.playing&&!K&&function(){if(ir){var e=bi.getBuffer();e.packInt8(Xe.syncMe),e.packInt8(Math.mod(ir.stateIdx-Je,Vt)),e.packInt8(ir.serverStateIdx);for(var t=Math.mod(ir.stateIdx-Je,Vt),i=0;i<Je;i++){var r=Math.mod(t+i,Vt);e.packInt8(ir.stateBuffer[__uv.$wrap((r))].controlKeys),e.packInt8(ir.stateBuffer[__uv.$wrap((r))].shots),e.packRadU(ir.stateBuffer[__uv.$wrap((r))].yaw),e.packRad(ir.stateBuffer[__uv.$wrap((r))].pitch),ir.stateBuffer[__uv.$wrap((Math.mod(r-Vt/2,Vt)))].shots=0}e.send(va)}}()}this.dx*=.64,this.dz*=.64,this.climbing&&(this.dy*=.64),this.actor&&this.id==u||(this.reloadsQueued>0&&this.reload(),this.weaponSwapsQueued>0&&this.swapWeapon(this.equipWeaponIdx))},Gt.prototype.saveState=function(e){e.x=this.x,e.y=this.y,e.z=this.z,e.dx=this.dx,e.dy=this.dy,e.dz=this.dz,e.jumping=this.jumping,e.climbing=this.climbing,e.weaponIdx=this.weaponIdx,e.rounds=this.weapon.ammo.rounds,e.store=this.weapon.ammo.store},Gt.prototype.move=function(e,t,i){var r,n=Gt.v1,a=Gt.v8,o=Gt.v2,s=Gt.v3;this.onGround=Math.max(--this.onGround,0),this.y+=.31,a.copyFromFloats(e,t,i),Math.capVector3(a,.29),n.copyFromFloats(this.x,this.y,this.z),n.addInPlace(a),n.x=Math.clamp(n.x,.1,$i.width-.1),n.z=Math.clamp(n.z,.1,$i.depth-.1);for(var l=0;l<8;l++){var c=gt.sphereCollidesWithStructure(n,.31,o,s);if(!c)break;s.y<-.707&&(this.onGround=4),this.climbing||c.colliderType&gt.Type.ladder&&this.tryToClimbLadder(c,s),n.addInPlace(o),this.onGround&&(this.jumping?(this.setJumping(!1),this.dy=0):this.controlKeys&Lt.down&&(this.climbing=!1))}if(8==l&&(a.scaleInPlace(.9),n.subtractInPlace(a)),this.x=n.x,this.y=n.y,this.z=n.z,!this.climbing||this.actor&&this.id!=u){p=Math.floor(this.x);var h=Math.floor(this.y);m=Math.floor(this.z);if(this.playing&&(r=$t(p,h,m))){var d=r.zone;d?this.actor||(this.capturing=d):this.capturing=!1}(r=$t(p,Math.floor(this.y-.5),m))&&(mesh=r.mesh,mesh&&"jump-pad"==mesh.shortName&&this.canJump()&&Math.length2(p+.5-this.x,m+.5-this.z)<.3&&(this.y+=.26,this.setJumping(!0)))}else{var p=this.climbX,m=this.climbZ;this.climbing=!1,this.capturing=!1,(r=$t(p,Math.floor(this.y-.25),m))&&Math.floor(r.ry/Math.PI90)==this.climbRY&&r.mesh&&"ladder"==r.mesh.colliderType&&(this.climbing=!0),(r=$t(p,Math.floor(this.y+.25),m))&&Math.floor(r.ry/Math.PI90)==this.climbRY&&r.mesh&&"ladder"==r.mesh.colliderType&&(this.climbing=!0)}this.y-=.31},Gt.prototype.tryToClimbLadder=function(e,i){if(this.controlKeys&Lt.up&&!(Math.abs(e.position.y-(this.y+.18))>.9)){var r=Math.round(this.yaw/Math.PI90)%4,n=e.cell.ry;if(r==n||(r+2)%4==n){var a=Gt.v5.set(i.x,i.z).normalize(),o=Gt.v6.set(Math.cos(this.yaw),-Math.sin(this.yaw)),s=t.Vector2.Dot(o,a);Math.abs(s)<.4&&(this.climbing=!0,this.climbX=Math.clamp(Math.floor(e.position.x),0,$i.width-1),this.climbZ=Math.clamp(Math.floor(e.position.z),0,$i.depth-1),this.climbRY=e.cell.ry,this.dy=0,this.setJumping(!1))}}},Gt.prototype.scopeIn=function(){this.isAtReady()&&(this.weapon.actor&&this.weapon.actor.restPose(),this.scope=!0,this.scopeDelay=7)},Gt.prototype.scopeOut=function(){this.scope=!1},Gt.prototype.disableShield=function(){this.shield=0,this.actor&&(this.actor.bodyMesh.renderOverlay=!1,this.actor.hands.renderOverlay=!1)},Gt.prototype.enableShield=function(){this.shield=120,this.actor&&(this.actor.bodyMesh.overlayColor=Gt.OverlayColor.green,this.actor.hands.overlayColor=Gt.OverlayColor.green,this.actor.bodyMesh.renderOverlay=!0,this.actor.hands.renderOverlay=!0)},Gt.prototype.resetStateBuffer=function(){for(var e=0;e<Vt;e++)this.stateBuffer[__uv.$wrap((e))]={yaw:this.yaw,pitch:this.pitch,fire:!1,jumping:this.jumping,climbing:this.climbing,x:this.x,y:this.y,z:this.z,dx:this.dx,dy:this.dy,dz:this.dz,controlKeys:this.controlKeys,shots:0,rounds:[0,0],store:[0,0]}},Gt.prototype.canJump=function(){return this.climbing|this.onGround},Gt.prototype.jump=function(){this.climbing&&(this.dy=.065,this.climbing=!1,this.setJumping(!0)),this.canJump()&&(this.dy=.13,this.scope&&0===this.scopeDelay&&(this.dy*=.66),this.setJumping(!0))},Gt.prototype.setJumping=function(e){this.jumpQueued=!1,this.onGround=0,this.jumping=e,this.stateBuffer[__uv.$wrap((this.stateIdx))].jumping=e},Gt.prototype.changeCharacter=function(e,t,i,r,n,a,o,s){var l=function(e,t){return e&&!t||!e&&t||null!==e&&null!==t&&e.id!==t.id};if(e!==this.charClass||t.id!==this.primaryWeaponItem.id||i.id!==this.secondaryWeaponItem.id||r!==this.shellColor||l(this.hatItem,n)||l(this.stampItem,a)||this.grenadeItem!==o||this.meleeItem!==s){if(this.charClass=e,this.primaryWeaponItem=t,this.secondaryWeaponItem=i,this.shellColor=r,this.hatItem=n,this.stampItem=a,this.grenadeItem=o,this.meleeItem=s,this.actor)this.actor.setShellColor(r),this.id==u||(this.actor.wearHat(this.hatItem),this.actor.applyStamp(this.stampItem));else{var c=bi.getBuffer();c.packInt8(Xe.changeCharacter),c.packInt8(this.id),c.packInt8(e),c.packInt16(this.primaryWeaponItem.id),c.packInt16(this.secondaryWeaponItem.id),c.packInt8(r),c.packInt16(this.hatItem?this.hatItem.id:0),c.packInt16(this.stampItem?this.stampItem.id:0),c.packInt16(this.grenadeItem?this.grenadeItem.id:16e3),c.packInt16(this.meleeItem?this.meleeItem.id:15e3),sendToOthers(c,this.id)}this.changeWeaponLoadout(t,i)}},Gt.prototype.swapWeapon=function(e){if(this.actor&&this.id!=u||this.canSwapOrReload()&&e<2){var t;if(this.equipWeaponIdx=e,this.releaseTrigger(),this.swapWeaponCountdown=this.weapon.stowWeaponTime+this.weapons[__uv.$wrap((e))].equipTime,this.actor){if(this.id==u&&Bi.hide(),this.actor.wieldingMelee=!1,this.weapon.actor.stow(),this.id==u)(t=bi.getBuffer()).packInt8(Xe.swapWeapon),t.packInt8(e),t.send(va)}else this.shotsQueued=0,this.swapWeaponCountdown*=.9,this.weaponSwapsQueued--,(t=bi.getBuffer()).packInt8(Xe.swapWeapon),t.packInt8(this.id),t.packInt8(e),sendToOthers(t,this.id);return!0}return!1},Gt.prototype.collectItem=function(e,t){switch(e){case zo.AMMO:return!!this.weapons[__uv.$wrap((t))].collectAmmo()&&(this.actor&&(Ti.play("pickup",this.actor.bodyMesh.absolutePosition,this.id==u),Mn()),!0);case zo.GRENADE:return this.grenadeCount<this.grenadeCapacity&&(this.grenadeCount++,this.actor&&(Ti.play("pickup",this.actor.bodyMesh.absolutePosition,this.id==u),Mn()),!0)}},Gt.prototype.isAtReady=function(){return!(!(this.playing&&this.weapon&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.grenadeCountdown<=0&&this.meleeCountdown<=0)||this.actor&&0!=Ii)},Gt.prototype.canMelee=function(){return!!(this.playing&&this.weapon&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&(this.actor||this.grenadeCountdown<=0)&&this.shotsQueued<=0)},Gt.prototype.canSwapOrReload=function(){return!(!(this.playing&&this.weapon&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.grenadeCountdown<=0&&this.shotsQueued<=0&&this.meleeQueued<=0)||this.actor&&0!=Ii)},Gt.prototype.fire=function(){this.shield>0?this.releaseTrigger():this.isAtReady()&&this.rofCountdown<=0&&(this.weapon.ammo.rounds>0?(this.recoilCountdown=this.weapon.constructor.recoil,this.rofCountdown=this.weapon.constructor.rof,this.actor?this.actor.fire():(this.recoilCountdown-=.1*this.recoilCountdown+2,this.rofCountdown-=.1*this.rofCountdown+1,this.shotsQueued--),this.weapon.fire(),this.actor&&this.id==u&&(this.stateBuffer[__uv.$wrap((this.stateIdx))].shots++,this.lastWeaponChange=0),0==this.weapon.constructor.automatic&&this.releaseTrigger()):(this.shotsQueued=0,this.weapon.actor&&(this.weapon.actor.dryFire(),this.releaseTrigger())))},Gt.prototype.pullTrigger=function(){if(1==Ii&&ir.grenadeCountdown<=0)this.cancelGrenade();else if(this.isAtReady()&&this.rofCountdown<=0)return this.weapon.ammo.rounds>0?(this.triggerPulled=!0,this.fire()):this.weapon.ammo.store>0?this.reload():this.weapon.actor.dryFire(),!0;return!1},Gt.prototype.releaseTrigger=function(){this.triggerPulled=!1,this.weapon.tracer=0},Gt.prototype.melee=function(){if(this.actor&&1==Ii&&ir.grenadeCountdown<=0&&this.cancelGrenade(),this.shield>0||!this.canMelee())return!1;var e;(this.meleeCountdown=17,this.recoilCountdown=40,this.actor)?(this.id===u&&Bi.hide(),this.actor.melee(),(e=bi.getBuffer()).packInt8(Xe.melee),e.send(va)):((e=bi.getBuffer()).packInt8(Xe.melee),e.packInt8(this.id),sendToOthers(e,this.id));return this.meleeWeapon.attack(),!0},Gt.prototype.reload=function(){if(!this.actor||this.id==u){if(this.weapon.ammo.rounds==this.weapon.ammo.capacity||0==this.weapon.ammo.store||!this.canSwapOrReload())return!1;var e,t=Math.min(Math.min(this.weapon.ammo.capacity,this.weapon.ammo.reload)-this.weapon.ammo.rounds,this.weapon.ammo.store);if(this.roundsToReload=t,this.scopeOut(),this.actor)this.id===u&&Bi.hide(),this.weapon.actor.reload(),this.actor.wieldingMelee&&this.actor.wieldGun(),this.releaseTrigger(),(e=bi.getBuffer()).packInt8(Xe.reload),e.send(va);else(e=bi.getBuffer()).packInt8(Xe.reload),e.packInt8(this.id),sendToOthers(e,this.id),this.reloadsQueued--,this.shotsQueued=0;return 0==this.weapon.ammo.rounds?this.reloadCountdown=this.weapon.longReloadTime:this.reloadCountdown=this.weapon.shortReloadTime,!0}this.weapon.actor.reload()},Gt.prototype.reloaded=function(){var e=this.weapon.ammo;e.rounds+=this.roundsToReload,e.store-=this.roundsToReload,this.actor&&this.id==u&&(Bi.show(),Mn())},Gt.prototype.queueGrenade=function(e){this.grenadeCountdown>0||(this.grenadesQueued++,this.grenadeThrowPower=Math.clamp(e,0,1),this.grenadeCountdown=20,this.actor||(this.grenadeCountdown*=.9))},Gt.prototype.cancelGrenade=function(){Ii=!1,ir.grenadeCountdown=30,this.id==u&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),this.actor&&(this.actor.gripBone._frozen=!1)},Gt.prototype.throwGrenade=function(){if(this.shield>0&&this.disableShield(),this.actor)(e=bi.getBuffer()).packInt8(Xe.throwGrenade),e.packFloat(Math.clamp(nr,0,1)),e.send(va),ir.grenadeCountdown=80,this.actor.reachForGrenade();else if(this.isAtReady()&&this.grenadeCount>0){this.grenadeCount--,this.grenadesQueued--,this.grenadeCountdown=1;var e,i=t.Matrix.RotationYawPitchRoll(this.yaw,this.pitch,0),r=t.Matrix.Translation(0,.1,1).multiply(i).getTranslation(),n=t.Matrix.Translation(0,-.05,.2),a=(n=(n=n.multiply(i)).add(t.Matrix.Translation(this.x,this.y+.3,this.z))).getTranslation(),o=.26*this.grenadeThrowPower+.16;r.x*=o,r.y*=o,r.z*=o,a.x=Math.floor(256*a.x)/256,a.y=Math.floor(256*a.y)/256,a.z=Math.floor(256*a.z)/256,r.x=Math.floor(256*r.x)/256,r.y=Math.floor(256*r.y)/256,r.z=Math.floor(256*r.z)/256,(e=bi.getBuffer()).packInt8(Xe.throwGrenade),e.packInt8(this.id),e.packFloat(a.x),e.packFloat(a.y),e.packFloat(a.z),e.packFloat(r.x),e.packFloat(r.y),e.packFloat(r.z),sendToAll(e),Sr.throwGrenade(this,a,r)}},Gt.prototype.removeFromPlay=function(){this.playing=!1,this.controlKeys=0,this.jumping=!1,this.jumpQueued=0,this.scope=!1,this.climbing=!1,this.hardBoiledValue=0,this.eggBreakerValue=0,this.activeShellStreaks=0,this.pauseTargetTime=0,this.lastDmgType=0,this.meleeWeapon.collisionCountdown=0,this.actor&&(this.actor.removeFromPlay(),this.id==u&&un())},Gt.prototype.setStats=function(e){let t=this.gameData.private?"Private":"Public";this.stats[__uv.$wrap((e+t))]++;let i=e+Ze[__uv.$wrap((this.gameData.gameType))].shortName;this.stats[__uv.$wrap((i))]++;let r=e+qe[__uv.$wrap((this.lastDmgType))].name;"deaths"!==e&&(r=e+qe[__uv.$wrap((this.lastDamageGivenType))].name),this.stats[__uv.$wrap((r))]++},Gt.prototype.resetStats=function(){return Object.keys(this.stats).forEach(e=>{if("streak"!=e)return this.stats[__uv.$wrap((e))]=0})},Gt.prototype.scoreKill=function(){if(this.stats.kills++,this.totalKills++,this.stats.streak++,this.bestGameStreak=Math.max(this.bestGameStreak,this.stats.streak),this.bestOverallStreak=Math.max(this.bestOverallStreak,this.stats.streak),this.setStats("kills"),this.lastDmgType=0,this.score=this.stats.streak,this.activeShellStreaks&tt.EggBreaker&&(this.eggBreakerValue=Math.min(this.eggBreakerValue+90,450)),!this.actor){var e=0;if(this.stats.streak>0)switch(this.stats.streak){case 5:e=tt.HardBoiled;break;case 10:e=tt.EggBreaker}if(e){this.beginShellStreak(e);var t=bi.getBuffer();t.packInt8(Xe.beginShellStreak),t.packInt8(this.id),t.packInt8(e),sendToAll(t)}}},Gt.prototype.kotcStatScoreCapture=function(){this.stats.kotcCaptured++},Gt.prototype.kotcStatScoreWin=function(){this.stats.kotcWins++},Gt.prototype.die=function(){this.score=0,this.stats.streak=0,this.stats.deaths++,this.totalDeaths++,this.setStats("deaths"),this.lastDmgType=0,this.hp=0,this.removeFromPlay()},Gt.prototype.beginShellStreak=function(e){switch(this.activeShellStreaks|=e,e){case tt.HardBoiled:this.hardBoiledValue=100;break;case tt.EggBreaker:this.eggBreakerValue=450}this.actor&&(this.actor.beginShellStreak(e),Ti.play("shellstreak_start",this.actor.mesh.position,!0))},Gt.prototype.endShellStreak=function(e){switch(this.activeShellStreaks^=this.activeShellStreaks&e,e){case tt.HardBoiled:this.hardBoiledValue=0}this.actor&&(this.actor.endShellStreak(e),Ti.play("shellstreak_end",this.actor.mesh.position,!0))},Gt.prototype.respawn=function(e,t,i){this.yaw=Math.floor(Math.random()*Math.PI2*8192)/8192,this.pitch=0,this.x=e,this.y=t,this.z=i,this.dx=0,this.dy=0,this.dz=0,this.respawnQueued=!1,this.playing=!0,this.onGround=4,this.climbing=!1,this.jumping=!1,this.controlKeys=0,this.capturing=!1,this.weapons[__uv.$wrap((0))].burstQueue=0,this.hp<=0?(this.hp=100,this.resetWeaponState()):this.resetWeaponState(!0),this.actor&&(this.id==u&&(R=u),this.corrections=0,this.actor.resetLerp(),this.actor.restoreToPlay(),this.weapon.equip(),this.id==R&&(qo=0,Bi.show(),Bi.showDot(),Mn())),this.enableShield(),this.resetStateBuffer()},Gt.prototype.resetWeaponState=function(e){this.resetCountdowns(),this.releaseTrigger(),this.weaponIdx=0,this.equipWeaponIdx=0,this.weapon=this.weapons[__uv.$wrap((0))],this.actor&&(this.weapons[__uv.$wrap((0))].actor.gunMesh.setEnabled(!1),this.weapons[__uv.$wrap((1))].actor.gunMesh.setEnabled(!1));for(var t=0;t<this.weapons.length;t++)this.weapons[__uv.$wrap((t))]&&(this.weapons[__uv.$wrap((t))].ammo.rounds=this.weapons[__uv.$wrap((t))].ammo.capacity,this.weapons[__uv.$wrap((t))].ammo.store=this.weapons[__uv.$wrap((t))].ammo.storeMax);this.grenadeCount=Math.max(this.grenadeCount,1);var i=this.weapons[__uv.$wrap((0))];i.burstQueue=0,i.constructor.burst&&(i.ammo.rounds=Math.ceil(i.ammo.rounds/i.constructor.burst)*i.constructor.burst,i.ammo.store=Math.ceil(i.ammo.store/i.constructor.burst)*i.constructor.burst)},Gt.prototype.isDead=function(){return this.hp<=0},Gt.prototype.resetCountdowns=function(){this.rofCountdown=0,this.triggerPulled=!1,this.shotsQueued=0,this.meleeQueued=0,this.meleeCountdown=0,this.roundsToReload=0,this.recoilCountdown=0,this.reloadCountdown=0,this.reloadsQueued=0,this.swapWeaponCountdown=0,this.weaponSwapsQueued=0,this.grenadeCountdown=0,this.grenadesQueued=0},Ut.prototype.expand=function(e){for(var t=0;t<e;t++){var i=this.constructorFn();i.id=t+this.size,i.active=!1,this.objects.push(i)}this.size+=e},Ut.prototype.retrieve=function(e){if(null!=e){for(;e>=this.size;)this.expand(this.originalSize);return this.numActive++,this.objects[__uv.$wrap((e))].active=!0,this.objects[__uv.$wrap((e))]}var t=this.idx;do{t=(t+1)%this.size;var i=this.objects[__uv.$wrap((t))];if(!i.active)return this.idx=t,this.numActive++,i.active=!0,i}while(t!=this.idx);return this.expand(this.originalSize),console.log("Expanding pool for: "+this.objects[__uv.$wrap((0))].constructor.name+" to: "+this.size),this.retrieve()},Ut.prototype.recycle=function(e){e.active=!1,this.numActive--},Ut.prototype.forEachActive=function(e){for(var t=0;t<this.size;t++){var i=this.objects[__uv.$wrap((t))];!0===i.active&&e(i,t)}},"undefined"==typeof window){var zt=require("fs");Ht=void 0}else var Ht=window.Loader;if(void 0===Ht)Ht={addTask:()=>{},progress:()=>{},finish:()=>{}};var Wt,jt=!1;function Xt(e){var i;if((i=new t.StandardMaterial("bullet",e)).emissiveColor=new t.Color3(1,1,1),n){var a=["#define RECEIVESHADOWS"];r.textureFloat&&a.push("#define SHADOWFULLFLOAT")}else a=[];if(a.push("#define MAP"),i=new t.ShaderMaterial("map",e,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor"],defines:a}),n){i.setTexture("shadowSampler",n.getShadowMapForRendering()),i.setMatrix("shadowLightMat",n.getTransformMatrix());var o=n.getShadowMap();null!==o&&i.setVector3("shadowParams",n.getDarkness(),o.getSize().width,n.bias)}i.onBind=function(t){var i=t.material.getEffect();i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),i.setColor3("vFogColor",e.fogColor)},(i=new t.ShaderMaterial("mapNoShadow",e,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor"],defines:["#define MAP"]})).onBind=function(e){var t=e.material.getEffect(),i=e.getScene();t.setFloat4("vFogInfos",i.fogMode,i.fogStart,i.fogEnd,i.fogDensity),t.setColor3("vFogColor",i.fogColor)},(i=new t.ShaderMaterial("standard",e,"standard",{attributes:["position","normal","color","uv",t.VertexBuffer.MatricesIndicesKind,t.VertexBuffer.MatricesWeightsKind],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","colorMult","sunDirection","sunColor"],defines:["#define COLORMULT"]})).onBind=function(e){var i=e.material.getEffect(),r=e.getScene();if(i.setFloat4("vFogInfos",r.fogMode,r.fogStart,r.fogEnd,r.fogDensity),i.setColor3("vFogColor",r.fogColor),i.setColor3("colorMult",e.colorMult||t.Color3.White()),i.setFloat3("sunDirection",r.sunLight.direction.x,r.sunLight.direction.y,r.sunLight.direction.z),i.setFloat3("sunColor",r.sunLight.diffuse.r,r.sunLight.diffuse.g,r.sunLight.diffuse.b),e.useBones&&e.computeBonesUsingShaders&&e.skeleton){var n=e.skeleton.getTransformMatrices(e);n&&i&&i.setMatrices("mBones",n)}},(i=new t.ShaderMaterial("standardInstanced",e,"standard",{attributes:["position","normal","color","uv","world0","world1","world2","world3"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","sunDirection","sunColor"],defines:["#define INSTANCES"]})).onBind=function(e){var t=e.material.getEffect(),i=e.getScene();t.setFloat4("vFogInfos",i.fogMode,i.fogStart,i.fogEnd,i.fogDensity),t.setColor3("vFogColor",i.fogColor),t.setFloat3("sunDirection",i.sunLight.direction.x,i.sunLight.direction.y,i.sunLight.direction.z),t.setFloat3("sunColor",i.sunLight.diffuse.r,i.sunLight.diffuse.g,i.sunLight.diffuse.b)},(i=new t.ShaderMaterial("eggShell",e,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","hp","cameraPosition","outlineColor","colorMult","stampOffset","sunDirection","sunColor"],defines:["#define EGGSHELL"]})).onBind=function(e){var i=e.material.getEffect(),r=e.getScene();i.setFloat4("vFogInfos",r.fogMode,r.fogStart,r.fogEnd,r.fogDensity),i.setColor3("vFogColor",r.fogColor),i.setFloat("hp",e.player.hp/100),i.setColor3("colorMult",e.colorMult||t.Color3.White()),i.setFloat3("cameraPosition",r.activeCamera.globalPosition.x,r.activeCamera.globalPosition.y,r.activeCamera.globalPosition.z),i.setColor4("outlineColor",e.outlineColor,e.outlineColor.a),i.setFloat2("stampOffset",e.stampU,e.stampV),i.setFloat3("sunDirection",r.sunLight.direction.x,r.sunLight.direction.y,r.sunLight.direction.z),i.setFloat3("sunColor",r.sunLight.diffuse.r,r.sunLight.diffuse.g,r.sunLight.diffuse.b)},(i=new t.ShaderMaterial("emissive",e,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","emissiveColor","sunDirection","sunColor"],defines:["#define FLASH"]})).onBind=function(e){var i=e.material.getEffect(),r=e.getScene();i.setFloat4("vFogInfos",r.fogMode,r.fogStart,r.fogEnd,r.fogDensity),i.setColor3("vFogColor",r.fogColor),i.setColor3("emissiveColor",e.emissiveColor||t.Color3.Black()),i.setFloat3("sunDirection",r.sunLight.direction.x,r.sunLight.direction.y,r.sunLight.direction.z),i.setFloat3("sunColor",r.sunLight.diffuse.r,r.sunLight.diffuse.g,r.sunLight.diffuse.b)},(i=new t.ShaderMaterial("colorized",e,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","colorMult"],defines:["#define COLORIZE","#define MAP"]})).onBind=function(e){var i=e.material.getEffect(),r=e.getScene();i.setFloat4("vFogInfos",r.fogMode,r.fogStart,r.fogEnd,r.fogDensity),i.setColor3("vFogColor",r.fogColor),i.setColor3("colorMult",e.colorMult||t.Color3.Black())},(i=new t.StandardMaterial("wireframe",e)).wireframe=!0,(i=new t.StandardMaterial("normalBackface",e)).diffuseColor=new t.Color3(.5,.5,.5),i.ambientColor=new t.Color3(.5,.5,.5),i.specularColor=new t.Color3(0,0,0),i.backFaceCulling=!1,i.twoSidedLighting=!0,(i=new t.StandardMaterial("muzzleFlash",e)).emissiveColor=t.Color3.White(),(i=new t.StandardMaterial("ui",e)).disableLighting=!0,i.emissiveColor=t.Color3.White(),i.fogEnabled=!1}function Yt(e,i,r,n){for(var a=i.length,o=this,s=e.getMaterialByName("standard"),l=0,c=0,u=0;u<a;u++){var h="models/",d=i[__uv.$wrap((u))]+".babylon";if("undefined"==typeof window){var p=zt.readFileSync(d,"utf8");p=p.replace(/\r?\n|\r/g,""),d="data:"+p,h=""}let m=Ht.addTask();t.SceneLoader.ImportMesh("",h,d,e,(function(e,t,i){try{for(var u=0;u<e.length;u++){var h=e[__uv.$wrap((u))];"egg"==h.name&&l++,"hands"==h.name&&c++,!jt&&(l>1||c>1)&&(jt=!0,alert("Duplicate egg and/or hand models detected in "+d+".\n\nOpen the weapon models in Blender and make sure egg/hands layers are turned off, then re-export.")),h.setMaterial&&h.setMaterial(s),h.setEnabled(!1),h.isPickable=!1,r&&r(h)}0==--a&&n&&n.call(o)}catch(e){console.log(e)}Ht.finish(m)}),(function(e){m=Ht.progress(m,e.loaded,e.total)}))}}var Kt=[];function Qt(e){gt.init(),($i={width:er.width,height:er.height+1,depth:er.depth,surfaceArea:er.surfaceArea}).data=function(e,t,i,r){for(var n=Array(e),a=0;a<e;a++){n[__uv.$wrap((a))]=Array(t);for(var o=0;o<t;o++){n[__uv.$wrap((a))][__uv.$wrap((o))]=Array(i);for(var s=0;s<i;s++)n[__uv.$wrap((a))][__uv.$wrap((o))][__uv.$wrap((s))]=r||{}}}return n}($i.width,$i.height,$i.depth),Wt=0;for(var i={},r=1;r<Ft.length;r++){var n=Ft[__uv.$wrap((r))];i[__uv.$wrap((n.name))]=r}var a={};"undefined"==typeof window&&(spawnPoints=[[],[],[]]),Object.keys(er.data).forEach((function(e){var r=er.data[__uv.$wrap((e))],n=i[__uv.$wrap((e))],o=Ft[__uv.$wrap((n))];if(n){var s,l,c,u=e.split(".");if(o.theme=u[__uv.$wrap((0))],o.shortName=u[__uv.$wrap((1))],o.colliderType=u[__uv.$wrap((2))],o.softness=u[__uv.$wrap((3))],"undefined"==typeof window&&"SPECIAL"==o.theme){if(o.shortName.startsWith("spawn")){for(let e of r)spawnPoints[__uv.$wrap((0))].push({x:e.x,y:e.y,z:e.z}),"spawn-blue"==o.shortName?spawnPoints[__uv.$wrap((Ye))].push({x:e.x,y:e.y,z:e.z}):spawnPoints[__uv.$wrap((Ke))].push({x:e.x,y:e.y,z:e.z});return}if("spatula"==o.shortName){for(let e of r)spatulaSpawnPoints.push({x:e.x+.5,y:e.y+.1,z:e.z+.5});return}}switch(o.colliderType){case"full":s=ft.fullCollisionMesh,l=!1,c=!1;break;case"wedge":s=ft.wedgeCollisionMesh,l=!0,c=!1;break;case"iwedge":s=ft.iwedgeCollisionMesh,l=!0,c=!1;break;case"ladder":s=o.colliderMesh,l=!1,c=!1;break;case"aabb":s=o.colliderMesh,l=!1,c=!0;break;case"obb":s=o.colliderMesh,l=!0,c=!0}for(let e of r){void 0===e.ry&&(e.ry=0);var h=e.rx*Math.PI90||0,d=e.ry*Math.PI90||0,p=e.rz*Math.PI90||0;$i.data[__uv.$wrap((e.x))][__uv.$wrap((e.y))][__uv.$wrap((e.z))]={item:void 0,mesh:o,idx:n,colliderMesh:s,colliderPrecise:l,colliderChildren:c,colliderMatrix:t.Matrix.RotationYawPitchRoll(-d,-h,-p),rx:h,ry:d,rz:p},s&&Jt(s,gt.Type[__uv.$wrap((o.colliderType))],e)}if("capture-zone"==o.shortName)for(let e of r)if(!$i.data[__uv.$wrap((e.x))][__uv.$wrap((e.y))][__uv.$wrap((e.z))].zone){var m;e.zone=++Wt,$i.data[__uv.$wrap((e.x))][__uv.$wrap((e.y))][__uv.$wrap((e.z))].zone=e.zone,0==e.y&&(console.log("INVALID ZONE",e),Kt.push(e.zone));do{m=0;let t=[{x:-1,z:0},{x:1,z:0},{x:0,z:-1},{x:0,z:1}];for(let i of r)if(!$i.data[__uv.$wrap((i.x))][__uv.$wrap((i.y))][__uv.$wrap((i.z))].zone)for(let r of t){let t=$t(i.x+r.x,i.y,i.z+r.z);if(t&&t.zone==e.zone){m++,i.zone=e.zone,$i.data[__uv.$wrap((i.x))][__uv.$wrap((i.y))][__uv.$wrap((i.z))].zone=e.zone;break}}}while(m>0)}}else a[__uv.$wrap((e))]=!0}));var o="";return Object.keys(a).forEach((function(e){o+=e+"\n"})),""!=o&&(console.log("buildMapData error",o),e&&e(o)),i}var Zt=new t.Vector3,qt=new t.Vector3;new t.Vector3(.5,.5,.5);function Jt(e,i,r){var n=r.rx*Math.PI90||0,a=r.ry*Math.PI90||0,o=r.rz*Math.PI90||0;qt.copyFrom(e.position),Zt.copyFrom(e.rotation),e.unfreezeWorldMatrix(),e.rotation.copyFromFloats(0,0,0),e.computeWorldMatrix();var s=e.getBoundingInfo().boundingBox.minimumWorld.clone(),l=e.getBoundingInfo().boundingBox.maximumWorld.clone(),c=new t.BoundingBox(s,l);c.matrix=t.Matrix.RotationYawPitchRoll(Zt.y,Zt.x,Zt.z),t.Matrix.RotationYawPitchRollToRef(a,n,o,ft.matrix),c.matrix.multiplyToRef(ft.matrix,c.matrix),c.position=new t.Vector3(r.x+.5,r.y+.5,r.z+.5),c.colliderType=i,c.cell=r;var u=new t.BoundingBox(new t.Vector3(r.x,r.y,r.z),new t.Vector3(r.x+1,r.y+1,r.z+1));c.bb=u,gt.add(c),e.position.copyFrom(qt),e.rotation.copyFrom(Zt),e.computeWorldMatrix(),e.freezeWorldMatrix();for(var h=e.getChildMeshes(),d=0;d<h.length;d++)Jt(h[__uv.$wrap((d))],i,r)}function $t(e,t,i){return e<0||e>$i.width-1||i<0||i>$i.depth-1||t<0||t>$i.height-1?null:$i.data[__uv.$wrap((e))][__uv.$wrap((t))][__uv.$wrap((i))]}function ei(e){this.scene=e,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.active=!1,this.player=null,this.damage=150,this.origin=new t.Vector3,this.direction=new t.Vector3,this.end=new t.Vector3,this.dmgTypeId="",void 0!==us&&(this.actor=new us(this))}function ti(e,t){this.scene=e,this.x=t.x,this.y=t.y,this.z=t.z,this.dy=0,this.controlledBy=255,this.controlledByTeam=255,this.lastControlTeam=255,void 0!==As&&(this.actor=new As(this))}function ii(e){var t=(e=" "+e+" ").toLowerCase().replace(/[^a-zA-Z0-9|!\|@|$|;|¬°]/g,"").replace(/6|g/g,"9").replace(/b/g,"6").replace(/\||l|i|1|;|¬°/g,"!").replace(/e/g,"3").replace(/a|@/g,"4").replace(/o/g,"0").replace(/s|\$/g,"5").replace(/t/g,"7").replace(/z/g,"2").replace(/7h3|my|y0ur|7h3!r|h!5|h3r/g,""),i=t.search(/( 94y | 455 )/),r=/(n421|5chu72574ff3!|n994|m457ur647|n!qq4|fck|cn7|57urm4673!!un9|!uf7w4ff3|k!4n|66c|n993r|n!443r|n!99r|m4y473|64ch!ch4|64ch!ch3|c474!uf0|fr4nchu7|fr!j0!3r0|9464ch0|94chup!n|m0r0m!3rd4|54!74mur05|pu74|j0d3r|m0n90|c0n0|c4r4j0|m!3rd4|20rr4|chup4m3!|cu!0|p3nd3j0|c46r0n|0r70|pu70|p!r06|qu33f|455h47|ch04d|cum|k0ck|k0ch|pu74|n!94|n3993r|4fr!c4n|kn336r0|5ch00!5h007|n!qq3r|73rr0r!5t|qu33r|d!ck|w4nk|p!55|7357!c|735735|64!!5|nu75|nu72|j3w|k!k3|r374r|4u7!5|d0wn55|6006|8d|p0rn|5w4!!0w|347m3|347my|d!k|0r4!|5p0093|fuk|j!2|5u!c!d|m4573r6|5p0063|5p3rm|p3nu5|pu55y|6u7753x|fux|6u77h0!3|4n4!|4nu5|k!!!b!4ck5|murd3rb!4ck5|h!7!3r|w3764ck|49!n4|94y|455h0!3|5uck|j3w|5p!c|ch!nk|n!994|n!993|n!663|n!994|n!664|5h!7|6!7ch|fuck|cun7|kkk|wh0r3|f49|7w47|p3n!|r4p3w0m|r4p39!r|r4p!57|r4p3r|r4p3|r4p!n|n!93r|!d!07|c0ck|dum6|5!4v3|7!75|@|455|pu5y|ju!cy|nud3|fk|v!49r4|64n9|53x|h03|d473|h473|d47!n9|d473r|h4ck|h4ck3r|h4ck!n9|60yfr!3nd|9!r!fr!3nd|900k|gf|bf|m0nk3y|m0nk!35|d4ddy|5!u7|pr057!7u7|nud3|33m4!!|d!ckh34d|r374rd|73rr0r!57|5h!4d|60!!0ck5|7r4n5|64!!649|n!9993r|ky5|60yfr!3nd|9!r!fr!3nd|d0uch3)/g,n=(t=t.replace(/ /g,"")).search(r),a=(t=t.replace(/(.)(?=\1)/g,"")).search(r);return i>-1||n>-1||a>-1}ei.position=new t.Vector3,ei.fire=function(e,t,i,r){Sr.rocketPool.retrieve().fireThis(e,t,i,r)},ei.prototype.fireThis=function(e,i,r,n){this.x=i.x,this.y=i.y,this.z=i.z,this.origin.set(this.x,this.y,this.z),this.direction.copyFrom(r).normalize().scaleInPlace(n.velocity),this.dx=this.direction.x,this.dy=this.direction.y,this.dz=this.direction.z,this.radius=n.radius,this.player=e,this.weaponClass=n,this.damage=n.damage,this.active=!0,this.range=n.range,this.minRange=n.minRange,this.velocity=n.velocity,this.dmgTypeId=n.dmgTypeId;var a=ft.rayCollidesWithMap(i,r,ft.projectileCollidesWithCell);a&&(this.end.copyFrom(a.pick.pickedPoint),this.range=t.Vector3.Distance(i,a.pick.pickedPoint)),this.actor&&this.actor.fire()},ei.prototype.remove=function(){Sr.rocketPool.recycle(this),this.actor&&this.actor.remove()},ei.prototype.update=function(){if(ei.position.set(this.x,this.y,this.z),this.range<this.velocity&&this.direction.scaleInPlace(this.range/this.velocity),!ft.rayCollidesWithPlayer(ei.position,this.direction,this)){this.x+=this.dx,this.y+=this.dy,this.z+=this.dz;var e=this.velocity;return this.range-=e,this.minRange-=e,this.range<=0?(this.x-=this.dx,this.y-=this.dy,this.z-=this.dz,void(this.minRange<=0?this.explode():this.poof())):void 0}},ei.prototype.collidesWithPlayer=function(e){this.minRange<=0?(this.actor||yn(e,this,255,_r.x,_r.z),this.explode()):(this.actor||yn(e,this,10,_r.x,_r.z),this.poof())},ei.prototype.explode=function(){if(!this.actor){var e=bi.getBuffer();e.packInt8(Xe.explode),e.packInt8(st.Primary),e.packInt16(0),e.packFloat(this.x),e.packFloat(this.y),e.packFloat(this.z),e.packInt8(this.damage),e.packFloat(this.radius),sendToAll(e),checkExplosionCollisions(this)}this.remove()},ei.prototype.poof=function(){if(this.actor){ei.position.set(this.x,this.y,this.z),Ti.play("gun_rpegg_rocket_poof",ei.position);for(var e=0;e<10;e++){var t=.2*Math.random()-.1,i=.2*Math.random()-.1,r=.2*Math.random()-.1;Nr(Ei,10,this.x,this.y,this.z,t,i,r,.4,!1,0)}}this.remove()},ti.prototype.capture=function(e){this.actor&&ir.id==e.id&&(document.getElementById("spatulaPlayer").className="capture");if(e.team!=this.lastControlTeam&&(ba.teamScore[__uv.$wrap((e.team))]=0),this.controlledBy=e.id,this.controlledByTeam=e.team,this.lastControlTeam=e.team,this.actor){fi.play("capture_spatula"),document.getElementById("teamScoreNum"+e.team).innerText=ba.teamScore[__uv.$wrap((e.team))]}else{for(var t=0;t<playerLimit;t++){var i=ar[__uv.$wrap((t))];i&&i.team==e.team&&(i.canTakeTeamBonus=!0)}let r=bi.getBuffer();ba.packState(r),sendToAll(r)}},ti.prototype.drop=function(){this.actor&&ir.id==this.controlledBy&&(document.getElementById("spatulaPlayer").className="drop");var e=ar[__uv.$wrap((this.controlledBy))];if(this.controlledBy=255,this.controlledByTeam=255,this.x=e.x,this.y=e.y,this.z=e.z,this.dy=e.dy+.05,this.actor)this.actor.drop();else{for(var t=0;t<playerLimit;t++){(e=ar[__uv.$wrap((t))])&&(e.canTakeTeamBonus=!1)}let i=bi.getBuffer();ba.packState(i),sendToAll(i)}},ti.prototype.update=function(){if(255==this.controlledBy){var e=this.dy;this.dy-=.012;var t=.5*(this.dy+e),i=this.y;if(this.y+=t,this.collidesWithMap()&&(this.y=i,this.dy*=-.5),!this.actor)for(var r=0;r<playerLimit;r++){if((n=ar[__uv.$wrap((r))])&&n.playing&&Math.abs(this.x-n.x)<.35&&Math.abs(this.y-n.y)<.35&&Math.abs(this.z-n.z)<.35){this.capture(n);break}}}else{var n;(n=ar[__uv.$wrap((this.controlledBy))])&&(this.x=n.x-.3*Math.sin(n.yaw),this.y=n.y,this.z=n.z-.3*Math.cos(n.yaw))}},ti.v1=new t.Vector3,ti.prototype.collidesWithMap=function(){return ti.v1.set(this.x,this.y,this.z),ft.meshCollidesWithMap(ft.playerCollisionMesh,ti.v1)};class ri{constructor(){this.kills=0,this.deaths=0,this.suicides=0,this.streak=0,this.weapons={},this.sessionStart=0,this.sessionEnd=0,this.endTime=0,this.playTime=0,this.ratio=0,this.charClass={},this.init()}init(){this.setupWeapons(),this.start()}start(){this.sessionStart=Date.now()}end(){this.endTime=this.getPlayTimeInGame(),this.getPlayTime()}setupWeapons(){qe.forEach(e=>this.weapons[__uv.$wrap((e.name))]={deaths:0,kills:0}),Object.keys(lt).forEach(e=>this.charClass[__uv.$wrap((e))]=JSON.parse(JSON.stringify(this.weapons))),Object.keys(this.charClass).forEach(e=>{this.charClass[__uv.$wrap((e))].kills=0,this.charClass[__uv.$wrap((e))].deaths=0}),console.log(this.charClass)}getRatio(){this.ratio=Math.floor(this.kills/Math.max(this.kills+this.deaths,1)*100)}getPlayTime(){this.sessionEnd=Date.now()-this.sessionStart;const e=(this.sessionEnd%6e4/1e3).toFixed(0);this.playTime=Math.floor(this.sessionEnd/6e4)+":"+(e<10?"0":"")+e}getPlayTimeInGame(){if(!this.sessionStart)return"0:00";const e=Date.now()-this.sessionStart,t=(e%6e4/1e3).toFixed(0);return Math.floor(e/6e4)+":"+(t<10?"0":"")+t}updateTerminus(e,t,i,r){this.charClass[__uv.$wrap((e))][__uv.$wrap((t))][__uv.$wrap((i))]++,this.charClass[__uv.$wrap((e))][__uv.$wrap((i))]++,this.weapons[__uv.$wrap((t))][__uv.$wrap((i))]++,this[__uv.$wrap((i))]++,r&&this.suicides++}getStats(){return{kills:this.kills,deaths:this.deaths,suicides:this.suicides,weapons:this.weapons,charClass:this.charClass,playTime:this.getPlayTimeInGame(),endTime:this.endTime,ratio:this.ratio}}set kills(e){this._kills=e,this.getRatio()}get kills(){return this._kills}set deaths(e){this._deaths=e,this.getRatio()}get deaths(){return this._deaths}}const ni=(e,t)=>{console.log("%c%s","color: white; background: #006700; padding: 2px 6px; border-radius: 3px; margin-right: 5px;","Chick'n Winner",e,t||"")};function ai(){let e=Math.trunc(Date.now()/1e3)+1,t=it,i=0;xe=new vi(e,t,i),ni("checkStartChicknWinner() start"),function(e,t){hi({cmd:"chicknWinnerReady",id:H.id,sessionId:H.sessionId},e,t)}(r=>{ni("checkStartChicknWinner() success");const n=r.limitData;console.log("api_chicknWinnerPlayerRewardCheck data",r.limitData);const a=Math.trunc(Date.now()/1e3);vueApp.chicknWinnerError(!1),Object.keys(n).length>0?(i=n.limit,n.limit<=it?(e=n.hasOwnProperty("span")?a+n.span:a+1,t=rt):(e=a+n.period,t=nt)):(e=a+1,t=rt),xe=new vi(e,t,i)},e=>si("checkStartChicknWinner()",e.error))}function oi(){Oe.isChwRequest?_i(e=>{Oe.isChwRequest=!1;const t=e.result;if(ni("getIncetivizedReward() response "+t),"SUCCESS"!==t)return void("SESSION_EXPIRED"===t&&si("getIncetivizedReward",t));const i=xe.count?xe.count:"free";if(e.reward.itemIds.length>0){const t=extern.catalog.findItemById(e.reward.itemIds[__uv.$wrap((0))]);H.addToInventory(t,!0),t&&(ga("send","event","Chickn Winner","Reward",i+" - item"),(e.reward_lvl||e.reward.rewardTier)&&ga("send","event","Chickn Winner","Reward item",`${t.name} - ${e.reward.rewardTier?e.reward.rewardTier:e.reward_lvl}`))}e.reward.eggsGiven&&e.reward.eggsGiven>0&&(ga("send","event","Chickn Winner","Reward",`${i} - ${e.reward.eggsGiven}`),ga("send","event","Chickn Winner","Reward amount",""+e.reward.eggsGiven)),vueApp.chw.reward.ownedItem=e.ownedItemId,vueApp.chw.reward.eggs=e.reward.eggsGiven,e.reward.itemIds.forEach(e=>vueApp.chw.reward.itemIds.push(e)),vueApp.chicknWinnerError(!1),vueApp.showChicknWinnerPopup()},e=>si("getIncetivizedReward",e.error)):ni("getIncetivizedReward() Request called directly. CHW not played")}function si(e,t){vueApp.chicknWinnerError(!0),vueApp.chwOnClick(!1),hasValue(t)&&("SESSION_EXPIRED"===t?vueApp.showGenericPopup("session_expired","session_expired_msg","ok"):vueApp.showGenericPopup("uh_oh","purchase_disabled","ok"),e&&console.log(e+" fail: ",t))}function li(e,t){!function(e,t){hi({cmd:"checkUpgrade",firebase_id:H.firebaseId,session:H.session,sessionId:H.sessionId},e,t)}((function(t){H.setUpgrade(t),!H.isUpgraded()&&V&&(document.getElementById("chickenBadge").style.display="none"),ge=H.isUpgraded(),e&&e(t)}),(function(e){t&&t(e),console.log("Error checking account upgrade status")}))}class ci{static init(){ci.inputs=[0,0,0,0,0]}static add(e){ci.inputs[__uv.$wrap((e))]=Date.now()}static update(){for(var e=0;e<ci.inputs.length;e++){var t=ci.inputs[__uv.$wrap((e))];if(Date.now()-t<100)switch(e){case ci.jump:break;case ci.fire:ir.pullTrigger()&&ci.remove(e);break;case ci.swap:ir.swapWeapon(0==ir.weaponIdx?1:0)&&ci.remove(e);break;case ci.reload:ir.reload()&&ci.remove(e);break;case ci.melee:ir.melee()&&(yr||(ga("send","event","weapon","triggered","Melee"),yr=!0),ci.remove(e))}}!ir.triggerPulled||Wi&Lt.fire||ir.releaseTrigger()}static remove(e){ci.inputs[__uv.$wrap((e))]=0}}ci.jump=0,ci.fire=1,ci.swap=2,ci.reload=3,ci.melee=4,parsedUrl.query.adTest&&(se=!0);class ui{constructor(){this.rewardedAdPlayed=!1,this.didVideoPlay=!1,this.adsBlocked=!1,this.isPlayingVideoAd=!1,this.callback=null,this.adUnit=null,this.isChwRequest=!1,this.cgAdType="midgame",this.cgErr=!1,this.cgErrTxt="CG video ad"}init(){if(pokiActive||crazyGamesActive)return this.adInPlayActive=!1,void console.log("initAdInPlay Cancelled. Is portal?",pokiActive||crazyGamesActive);let e=this;try{e.ADSLOG("F79520","Shell Shockers AIP","AIP init success!"),e.adInPlayActive=!testCrazy,aiptag.cmd.player.push((function(){x=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!1,AD_CENTERPLAYER:!0,LOADING_TEXT:"loading advertisement",PREROLL_ELEM:function(){return document.getElementById("preroll")},AIP_COMPLETE:function(t){e.afterVideoAdComplete(t),e.ADSLOG("F79520","Shell Shockers AIP Complete",t),ga("send","event","aip-complete","regular",t)},AIP_REMOVE:function(){},AIP_REWARDEDCOMPLETE:function(t){e.ADSLOG("F79520","Shell Shockers AIP Reward Complete",t),e.afterVideoAdComplete(t),ga("send","event","aip-complete","reward",t)},AIP_REWARDEDGRANTED:function(t){e.ADSLOG("F79520","Shell Shockers AIP Reward Granted",t),e.rewardedAdPlayed=!0,ga("send","event","aip-complete","reward-granted",t)}}),e.checkAdBlocker()}))}catch(t){e.ADSLOG("F79520","Shell Shockers AIP","AIP error message: "+t),e.error()}}set adBlocker(e){this.adsBlocked=e,this.adsBlocked&&!ge&&this.adBlockerDetected()}get adBlocker(){return this.adsBlocked}checkAdBlocker(){this.adBlocker=aipAPItag&&aipAPItag.hasOwnProperty("sdkBlocked")&&aipAPItag.sdkBlocked}adBlockerDetected(){vueApp.chwAdBlockerDetected(),this.adInPlayActive=!1}play(e,t){if(this.adUnit=e,this.callback=t,se&&this.ADSLOG("F79520","Shell Shockers AIP","AD test active"),testCrazy&&this.ADSLOG("3C1E6E","CG video ad","Crazy Games test ads"),this.ADSLOG("F79520","Shell Shockers AIP","Play video ads Ad unit: "+this.adUnit),this.isChwRequest||this.setAdVideoLocalStorage(),crazyGamesActive)return this.ADSLOG("3C1E6E",this.cgErrTxt,"Crazy Game video ad request."),this.isChwRequest&&(this.cgAdType="rewarded"),void this.cgAdRequested();vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame),Ss(0),this.isPlayingVideoAd=!0,this.preroll()}preroll(){if(this.adBlocker)this.ADSLOG("F79520","Shell Shockers AIP","Ad blocker detected."),this.showAdBlockerVideo();else{let e=this;void 0!==x?aiptag.cmd.player.push((function(){try{e.ADSLOG("F79520","Shell Shockers AIP","Play: "+e.adUnit),vueApp.gameUiAddClassForNoScroll(),V&&(vueApp.hideGameMenu(),vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame)),x.startPreRoll(e.adUnit)}catch(t){e.error(t)}})):e.error("aipPrerollPlayer undefined")}}afterVideoAdComplete(e){this.ADSLOG("F79520","Shell Shockers AIP","AIP_COMPLETE"),this.isChwRequest||vueApp.setDarkOverlay(!1),e&&!["video-ad-skipped","video-ad-completed"].includes(e)?this.error(e):this.didVideoPlay=!0,this.onVideoAdCompleted("F79520","Shell Shockers AIP")}onVideoAdCompleted(e,t){this.ADSLOG(e,t,"is getting chickn winner: "+this.isChwRequest),this.isChwRequest?this.didVideoPlay?oi():(this.isChwRequest=!1,vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok")):(V&&(vueApp.disableRespawnButton(!1),vueApp.showGameMenu()),vueApp.gameUiRemoveClassForNoScroll()),Ss(),this.didVideoPlay=!1,this.rewardedAdPlayed=!1,this.callback&&(this.callback(),this.callback=null),this.adUnit=null}error(e){e&&this.ADSLOG("F79520","Shell Shockers AIP video error: ",e);const t=this.isChwRequest,i=this.isPlayingVideoAd;"user-has-adblock"===e&&this.adBlockerDetected(),vueApp.chwOnClick(!1),this.didVideoPlay=!1,this.isChwRequest=!1,this.isPlayingVideoAd=!1,i&&t&&li(()=>{H.isUpgraded()||t&&(vueApp.showGenericPopup("chw_video_error_title","chw_video_error_msg","ok"),ai())})}isAdBlocking(){return crazyGamesActive?crazysdk.hasAdblock:this.adBlocker}showAdBlockerVideo(){vueApp.showAdBlockerVideo(),setTimeout(()=>{vueApp.hideAdBlockerVideo(),vueApp.gameUiRemoveClassForNoScroll(),crazyGamesActive||testCrazy?this.onVideoAdCompleted():this.afterVideoAdComplete()},1e4)}ADSLOG(e,t,i){console.log("%c%s",`color: white; background: #${e}; padding: 2px 6px; border-radius: 3px; margin-right: 5px;`,t,i)}setAdVideoLocalStorage(){localStore.setItem("lastPreRoll",Date.now())}cgAdRequested(){if(this.ADSLOG("3C1E6E",this.cgErrTxt,"requested."),crazysdk.hasAdblock)return this.showAdBlockerVideo(),void setTimeout(()=>this.cgRequestAd(),1e4);this.cgRequestAd()}cgRequestAd(){this.cgListeners(),crazysdk.requestAd(this.cgAdType),this.cgAdType="midgame"}cgListeners(){this.ADSLOG("3C1E6E",this.cgErrTxt,"add eventListeners"),this.cgAdStarted=this.cgAdStarted.bind(this),this.cgAdError=this.cgAdError.bind(this),this.cgAdFinished=this.cgAdFinished.bind(this),crazysdk.addEventListener("adStarted",this.cgAdStarted),crazysdk.addEventListener("adError",this.cgAdError),crazysdk.addEventListener("adFinished",this.cgAdFinished)}cgRmListeners(){this.ADSLOG("3C1E6E",this.cgErrTxt,"remove eventListeners"),vueApp.setDarkOverlay(!1),crazysdk.removeEventListener("adStarted",this.cgAdStarted),crazysdk.removeEventListener("adError",this.cgAdError),crazysdk.removeEventListener("adFinished",this.cgAdFinished)}cgAdStarted(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"started.",e),V&&vueApp.hideGameMenu(),vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame),this.isPlayingVideoAd=!0,this.didVideoPlay=!0,Ss(0)}cgAdFinished(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"ended.",e),vueApp.setDarkOverlay(!1),this.cgErr&&(this.didVideoPlay=!1,this.rewardedAdPlayed=!1),this.onVideoAdCompleted("3C1E6E",this.cgErrTxt),this.cgRmListeners(),this.cgErr=!1,crazysdk.hasAdblock&&vueApp.hideAdBlockerVideo()}cgAdError(e){this.ADSLOG("3C1E6E",this.cgErrTxt,"error.",e),this.cgErr=!0,this.didVideoPlay=!1,this.cgAdFinished()}}pe&&console.log("adTagDebug debug is on");function hi(e,t,i,r){console.log("'{0}' api command".format(e.cmd));try{console.log("services server: "+ms);var n=new WebSocket(ms)}catch(e){console.log(e)}n.onopen=function(t){n.send(JSON.stringify(e)),console.log("servicesWs opened, and "+e.cmd+" request sent")},n.onmessage=function(r){var a=null;try{a=JSON.parse(r.data)}catch(r){return console.log("Invalid data returned from services API",r.data),void i(r)}a.error?(console.log(e.cmd+" error: "+JSON.stringify(a.error)),i(a)):t(a),n.close()},n.onclose=function(t){console.log(e.cmd+" servicesWs closed, code: "+t.code,"reason: "+t.reason,"clean: "+t.wasClean),r&&r(t.code)},n.onerror=function(t){console.log(e.cmd+" servicesWs error: "+JSON.stringify(t)),Ht.hide(),i(t)}}function di(){hi({cmd:"checkBalance",firebaseId:H.firebaseId},(function(e){console.log("Check Balance response: "+JSON.stringify(e)),e.error?console.log("Check Balance call failed: "+JSON.stringify(e.error)):H.setEggBalances(e.currentBalance)}),(function(){console.log("Error running check balance call")}))}function pi(e,t,i,r){hi({cmd:"reward",firebaseId:H.firebaseId,rewardTag:e.tag},t,i)}function mi(e,t){hi({cmd:"getScheduledEventData"},e,t)}function _i(e,t){if(!Oe.isChwRequest)return void console.log("api_incentivizedVideoRewardRequest() API called directly. chw not played");hi({cmd:"incentivizedVideoReward",token:null,id:H.id,firebaseId:H.firebaseId,sessionId:H.sessionId},e,t)}class fi{static init(){console.log("BAWK! initializing...");var e=new AudioContext;this.audioCtx=e,this.children=[],this.sounds={},this.position={x:0,y:0,z:0},this.orientation={x:0,y:0,z:-1},this.detectFormats(),this.gainNode=e.createGain(),this.compNode=e.createDynamicsCompressor(),this.compNode.connect(this.gainNode),this.gainNode.connect(e.destination),this.inputNode=this.compNode,null!=this.volume&&(this.gainNode.gain.value=this.volume)}static dispose(){this.audioCtx.close()}static setFormats(e){this.formats=e}static detectFormats(){var e=fi.formats||{webm:"audio/webm",ogg:"audio/ogg",mp3:"audio/mpeg"};/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&delete e.webm;var t=document.createElement("audio"),i=Object.keys(e);for(var r of i){var n=t.canPlayType(e[__uv.$wrap((r))]);if(console.log("BAWK! testing "+r,n),n){fi.format=r,console.log("BAWK! selected "+r);break}}}static suspend(){fi.audioCtx&&fi.audioCtx.suspend()}static resume(){fi.audioCtx&&fi.audioCtx.resume()}static async load(e,t){fi.audioCtx||fi.init();var i=e.match(/[^/\\&\?]+\..{1,4}(?=([\?\#&].*$|$))/)[__uv.$wrap((0))],r=i.match(/[^\.]*$/).join(""),n=i.replace("."+r,"");"json"==r?await fi.loadSprite(e):await fi.loadSound(e,t||n)}static async loadSound(e,t){e=e.replace("*",fi.format);var i=await fi.getAudioBuffer(e);i&&(fi.sounds[__uv.$wrap((t))]&&console.warn('BAWK! duplicate sound name, "'+t+'" will be over-written'),fi.sounds[__uv.$wrap((t))]={buffer:i})}static async loadSprite(e){var t=await fetch(e),i=await t.json(),r=await fi.loadSpriteBuffer(e,i);Object.keys(i.spritemap).forEach(e=>{var t=i.spritemap[__uv.$wrap((e))];fi.sounds[__uv.$wrap((e))]={buffer:r,start:t.start,end:t.end}})}static async loadSpriteBuffer(e,t){for(var i of t.resources)if(i.endsWith(fi.format))break;var r=e.match(/.+\//)+i;return console.log("BAWK! loading "+r),await fi.getAudioBuffer(r+"?"+Ge)}static async getAudioBuffer(e){var t=await fi.request(e);return await new Promise((e,i)=>{fi.audioCtx.decodeAudioData(t,e,i)})}static request(e){return new Promise((t,i)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer";let n=Ht.addTask();r.onprogress=e=>{n=Ht.progress(n,e.loaded,e.total)},r.onload=()=>{200!=r.status?(console.log("ERROR"),i()):t(r.response),Ht.finish(n)},r.send()})}static setVolume(e){fi.volume=e,fi.gainNode&&(fi.gainNode.gain.value=e)}static getVolume(){return fi.volume}static play(e,t,i){var r=fi.audioCtx;t=t||fi.inputNode,"suspended"===r.state&&fi.resume();var n=fi.sounds[__uv.$wrap((e))];if(!n){let t;if(i&&(t=" or "+i,n=fi.sounds[__uv.$wrap((i))]),!n)return console.error(`BAWK! ${e} ${t} not found. Did you wait for it to load?`),!1}if(n.end)var a=n.start,o=n.end-a;var s=r.createBufferSource();return s.buffer=n.buffer,s.connect(t),o?s.start(0,a,o):s.start(),s}static attach(e,t){fi.position=e,fi.orientation=t}static detach(){fi.position={x:fi.position.x,y:fi.position.y,z:fi.position.z},fi.orientation={x:fi.orientation.x,y:fi.orientation.y,z:fi.orientation.z}}static setPosition(e){var t=fi.audioCtx.listener;t.positionX?(t.positionX.value=e.x,t.positionY.value=e.y,t.positionZ.value=e.z):t.setPosition(e.x,e.y,e.z)}static setOrientation(e){var t=fi.audioCtx.listener;t.forwardX?(t.forwardX.value=e.x,t.forwardY.value=e.y,t.forwardZ.value=e.z):t.setOrientation(e.x,e.y,e.z,0,1,0)}static addChild(e){fi.children.push(e)}static removeChild(e){fi.children.splice(fi.children.indexOf(e),1)}static update(){for(var e of(fi.position&&fi.setPosition(fi.position),fi.orientation&&fi.setOrientation(fi.orientation),fi.children))e.update()}}class gi{constructor(e,t){fi.addChild(this),e=e||{},this.numChannels=e.numChannels||16,this.numPlaying=0,this.channels=[],this.nextChannelIdx=0,this.gainNode=fi.audioCtx.createGain(),this.gainNode.connect(fi.inputNode);for(var i=0;i<this.numChannels;i++){var r=fi.audioCtx.createPanner(t);r.connect(this.gainNode),this.channels.push({parent:this,source:null,position:{x:0,y:0,z:0},follow:!1,node:r})}}dispose(){this.gainNode.disconnect(),fi.removeChild(this)}setVolume(e){this.gainNode.gain.value=e}getVolume(){return this.gainNode.gain.value}play(e,t,i){if(fi.sounds[__uv.$wrap((e))]){var r=this.findFreeChannel(t);r.source&&r.source.stop();var n=r.node;r.position=t,r.follow=i,gi.setNodePosition(n,t),r.source=fi.play(e,n),r.source.channel=r,r.source.onended=gi.onEnded,this.numPlaying++}else console.error("BAWK! "+e+" not found. Did you wait for it to load?")}update(){for(var e of this.channels)e.source&&e.follow&&gi.setNodePosition(e.node,e.position)}static setNodePosition(e,t){var i=fi.position.y+4*(t.y-fi.position.y);e.positionX?(e.positionX.value=t.x,e.positionY.value=i,e.positionZ.value=t.z):e.setPosition(t.x,i,t.z)}findFreeChannel(e){var t=this.channels,i=this.numChannels,r=fi.position;if(this.numPlaying<i)for(var n of t)if(!n.source)return n;var a,o=-1;for(var n of t){var s=Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)+Math.pow(e.z-r.z,2);s>o&&(o=s,a=n)}return a}static onEnded(e){e.target.channel.__uv$setSource(__uv).__uv$parent.numPlaying--,e.target.channel.source=null,e.target.channel=null}}function yi(e){this.scene=e.scene,this.bullet=e,this.delayFrames=0,this.mesh=this.scene.getMeshByName("bullet").createInstance(""),this.mesh.setEnabled(!1)}window.BAWK=fi,yi.prototype.fire=function(e){this.delayFrames=3,e?(this.mesh.scaling.x=2,this.mesh.scaling.y=2):(this.mesh.scaling.x=1,this.mesh.scaling.y=1),this.mesh.position.x=this.bullet.x,this.mesh.position.y=this.bullet.y,this.mesh.position.z=this.bullet.z,this.mesh.lookAt(new t.Vector3(this.bullet.x+this.bullet.dx,this.bullet.y+this.bullet.dy,this.bullet.z+this.bullet.dz)),this.mesh.scaling.z=.5},yi.prototype.update=function(e){this.delayFrames>0?this.delayFrames--:this.mesh.setEnabled(!0),this.mesh.position.x+=.5*(this.bullet.x-this.mesh.position.x),this.mesh.position.y+=.5*(this.bullet.y-this.mesh.position.y),this.mesh.position.z+=.5*(this.bullet.z-this.mesh.position.z),this.bullet.player.id!=u&&(this.mesh.scaling.z=Math.min(this.mesh.scaling.z+.03,3))},yi.prototype.remove=function(){this.mesh.setEnabled(!1)};class vi{constructor(e,t,i){this.watchedCount=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0,this.progress=1,this.timer=null,this.gap=0,this.end=e,this.span=t,this.limitReached=!1,this.ready=!1,this.count=i}set count(e){this.watchedCount!==e&&(this.watchedCount=e,this.watchedCount>it?this.limitReached=!0:this.limitReached=!1),this.chwTimer()}get count(){return this.watchedCount}chwClearTimer(){null!==this.timer&&this.ready&&(clearInterval(this.timer),this.timer=null)}chwTimer(){null===this.timer&&(this.timer=setInterval(()=>this.chwData(),1e3))}chwData(){this.gap=Math.floor(this.end-Math.trunc(Date.now()/1e3)),this.progress=Math.floor((this.span-this.gap)/this.span*100),this.gap<0&&(this.gap=0,this.progress=100);let e=0,t=0;this.progress<100?(this.days=Math.floor(this.gap/24/60/60),e=Math.floor(this.gap-86400*this.days),this.hours=Math.floor(e/3600),t=Math.floor(e-3600*this.hours),this.minutes=Math.floor(t/60),this.seconds=this.gap%60):(this.ready=!0,this.chwClearTimer()),vueApp.chwUiTimerUpdate(this.hours,this.minutes,this.seconds,this.progress,this.ready,this.limitReached,this.watchedCount)}}var bi={buffer:null,bufferPool:new Ut((function(){return new xi(16384)}),2),getBuffer:function(){var e=this.bufferPool.retrieve();return e.idx=0,e}};function xi(e){this.idx=0,this.arrayBuffer=new ArrayBuffer(e),this.buffer=new Uint8Array(this.arrayBuffer,0,e)}xi.prototype.send=function(e){var t=new Uint8Array(this.arrayBuffer,0,this.idx);e.send(t),bi.bufferPool.recycle(this)},xi.prototype.packInt8=function(e){this.buffer[__uv.$wrap((this.idx))]=255&e,this.idx++},xi.prototype.packInt16=function(e){this.buffer[__uv.$wrap((this.idx))]=255&e,this.buffer[__uv.$wrap((this.idx+1))]=e>>8&255,this.idx+=2},xi.prototype.packInt24=function(e){this.buffer[__uv.$wrap((this.idx))]=255&e,this.buffer[__uv.$wrap((this.idx+1))]=e>>8&255,this.buffer[__uv.$wrap((this.idx+2))]=e>>16&255,this.idx+=3},xi.prototype.packInt32=function(e){this.buffer[__uv.$wrap((this.idx))]=255&e,this.buffer[__uv.$wrap((this.idx+1))]=e>>8&255,this.buffer[__uv.$wrap((this.idx+2))]=e>>16&255,this.buffer[__uv.$wrap((this.idx+3))]=e>>24&255,this.idx+=4},xi.prototype.packRadU=function(e){this.packInt24(2097152*e)},xi.prototype.packRad=function(e){this.packInt16(8192*(e+Math.PI))},xi.prototype.packFloat=function(e){this.packInt16(256*e)},xi.prototype.packDouble=function(e){this.packInt32(1048576*e)},xi.prototype.packString=function(e){"string"!=typeof e&&(e=""),this.packInt8(e.length);for(var t=0;t<e.length;t++)this.packInt16(e.charCodeAt(t))},xi.prototype.packLongString=function(e){"string"!=typeof e&&(e=""),this.packInt16(e.length);for(var t=0;t<e.length;t++)this.packInt16(e.charCodeAt(t))};var Si,Ti,Ei,Pi,Ai,Mi,Ci,Ri,wi,Ii,Oi,Di,ki,Bi,Fi,Li,Ni,Vi,Gi,Ui,zi,Hi,Wi,ji,Xi,Yi,Ki,Qi,Zi,qi,Ji,$i,er,tr,ir,rr,nr,ar,or,sr,lr,cr,ur,hr,dr,pr,mr={buffer:null,idx:0,init:function(e){this.buffer=new Uint8Array(e),this.idx=0},isMoreDataAvailable:function(){return Math.max(0,this.buffer.length-this.idx)},peekInt8U:function(){return this.buffer[__uv.$wrap((this.idx))]},unPackInt8U:function(){var e=this.idx;return this.idx++,this.buffer[__uv.$wrap((e))]},unPackInt8:function(){return(this.unPackInt8U()+128)%256-128},unPackInt16U:function(){var e=this.idx;return this.idx+=2,this.buffer[__uv.$wrap((e))]+256*this.buffer[__uv.$wrap((e+1))]},unPackInt24U:function(){var e=this.idx;return this.idx+=3,this.buffer[__uv.$wrap((e))]+256*this.buffer[__uv.$wrap((e+1))]+65536*this.buffer[__uv.$wrap((e+2))]},unPackInt32U:function(){var e=this.idx;return this.idx+=4,this.buffer[__uv.$wrap((e))]+256*this.buffer[__uv.$wrap((e+1))]+65536*this.buffer[__uv.$wrap((e+2))]+16777216*this.buffer[__uv.$wrap((e+3))]},unPackInt16:function(){return(this.unPackInt16U()+32768)%65536-32768},unPackInt32:function(){return(this.unPackInt32U()+2147483648)%4294967296-2147483648},unPackRadU:function(){return this.unPackInt24U()/2097152},unPackRad:function(){return this.unPackInt16U()/8192-Math.PI},unPackFloat:function(){return this.unPackInt16()/256},unPackDouble:function(){return this.unPackInt32()/1048576},unPackString:function(e){e=e||255;var t=Math.min(this.unPackInt8U(),e);return this.unPackStringHelper(t)},unPackLongString:function(e){e=e||16383;var t=Math.min(this.unPackInt16U(),e);return this.unPackStringHelper(t)},unPackStringHelper:function(e){if(this.isMoreDataAvailable()<e)return 0;for(var t=new String,i=0;i<e;i++){var r=this.unPackInt16U();r>0&&(t+=String.fromCodePoint(r))}return t}},_r=new t.Vector3,fr=new t.Vector3,gr=0,yr=!1,vr=!1,br=[0,0,0],xr=!1;var Sr,Tr,Er=new t.Vector3;Ze=[{shortName:"FFA",longName:"Free For All",value:0},{shortName:"Teams",longName:"Teams",value:1},{shortName:"Spatula",longName:"Captula the Spatula",value:2},{shortName:"King",longName:"King of the Coop",value:3}];function Pr(){console.log("startGame()");var e=document.getElementById("onesignal-bell-container");dr=Date.now(),e&&(e.style.display="none"),ar=[],pr=[],{},Ri=-1,vueApp.game.respawnTime=0,ir=null,yr=!1,rr=null,Ii=!1,ur=null,Wi=0,he=!0,vr=!1,Li=!1,Ni=new Ms,Ui=performance.now(),0,ping=0,ne=0,_=0,f=0,g=-1,y=0,0,zi=0,ji=0,Xi=0,Yi=0,o=Date.now(),Date.now()+1e3,i.clear(t.Color3.Black()),i.stopRenderLoop(),Ji=new t.Scene(i),L.autoDetail||(Ji.shadowsEnabled=L.shadowsEnabled),Ji.autoClear=!0,Ji.autoClearDepthAndStencil=!0,Ji.clearColor=t.Color3.Black(),(tr=new t.DirectionalLight("",new t.Vector3(0,-1,0),Ji)).lightmapMode=t.Light.LIGHTMAP_SHADOWSONLY,tr.intensity=1.2,tr.autoUpdateExtends=!1,tr.shadowMinZ=.05,tr.shadowMaxZ=40,tr.shadowFrustumSize=15,(n=new t.ShadowGenerator(1024,tr)).forceBackFacesOnly=!0,a=new t.TargetCamera("camera",t.Vector3.Zero(),Ji),Ji.activeCameras.push(a),a.maxZ=100,a.fov=1.25,a.minZ=.05,fi.attach(a.globalPosition,Er),(wi=new t.FreeCamera("uiCamera",new t.Vector3(0,0,-1),Ji)).mode=t.Camera.ORTHOGRAPHIC_CAMERA,wi.layerMask=536870912,wi.autoClear=!1,Ji.activeCameras.push(wi),or=new t.DynamicTexture("",2048,Ji,!0,2),(sr=new t.SpriteManager("","",18,{width:512,height:256},Ji)).fogEnabled=!1,sr.texture=or,(lr=new t.SpriteManager("","img/particles.png?"+Ge,18,128,Ji)).fogEnabled=!0,Xt(Ji),window.onfocus=function(){Ui=performance.now(),ir&&function(){if(!V)return;ba.suppressSound=!0;var e=bi.getBuffer();e.packInt8(Xe.refreshGameState),e.send(va)}()},window.onblur=function(){},document.onpointerlockchange=function(){ir&&!document.pointerLockElement&&(Rn=null,Wi=0,ir.controlKeys=0,ir.releaseTrigger(),setTimeout(()=>{var e=bi.getBuffer();e.packInt8(Xe.pause),e.send(va),ir.resetCountdowns(),Rr(!N||ge||pokiActive?5:10)},100),vueApp.statsLoading(),$a.set((function(){ir.removeFromPlay(),_o()}),3e3),console.log("pausing game via pointerlock exit"),Mr(),rs(),crazyGamesActive&&crazysdk.gameplayStop())},function(){S=document.getElementById("chatIn"),T=document.getElementById("chatOut"),E=document.getElementById("killTicker");var e=document.getElementById("playerList");!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(e);for(var t=document.getElementById("playerSlot"),i=0;i<20;i++){var r=t.cloneNode(!0);e.appendChild(r)}T.innerHTML="",1==L.enableChat&&(Nn(),T.style.display="block",S.style.display="block");E.innerHTML="",T.value="",document.getElementById("killBox").style.display="none",document.getElementById("deathBox").style.display="none",document.getElementById("scopeBorder").style.display="none",document.getElementById("spatulaPlayer").className="drop",document.getElementById("spectate").style.display="none",document.getElementById("teamScores").style.display=h==Qe.ctf?"block":"none",document.getElementById("captureContainer").style.display=h==Qe.king?"block":"none",document.getElementById("captureIconContainer").style.display="none",document.getElementById("shellStreakMessage").classList.remove("appear"),document.getElementById("shellStreakMessage").classList.add("disappear"),document.getElementById("shellStreakCaption").style.visibility="hidden",document.getElementById("eggBreakerContainer").className="off",document.getElementById("playerList").style.pointerEvents="auto",Bi&&Bi.setPowerful(!1);console.log("resetGameUI")}(),document.body.style.overflow="hidden",ci.init(),async function(e,i){if(console.log("loadMap()"),ft.init(Ji),z)er=JSON.parse(localStore.getItem("mapBackup"));else{var r=Ct[__uv.$wrap((e))].filename,n=await fetch("maps/"+r+".json?"+Ct[__uv.$wrap((e))].hash);er=await n.json(),console.log("MAP: "+r),vueApp.setGameDataUi(er.name)}vueApp.showSpinner("building_map","ui_game_waitforit",!0),er.sun?Ji.sunLight={direction:new t.Vector3(er.sun.direction.x,er.sun.direction.y,er.sun.direction.z),diffuse:t.Color3.FromHexString(er.sun.color)}:Ji.sunLight={direction:new t.Vector3(.2,1,.1),diffuse:new t.Color3.White};er.ambient?Ji.ambientColor=t.Color3.FromHexString(er.ambient):Ji.ambientColor=new t.Color3(.2,.2,.2);er.fog?(console.log("FOG:",er.fog),er.fog.density>0?(Ji.fogMode=t.Scene.FOGMODE_EXP2,Ji.fogColor=t.Color3.FromHexString(er.fog.color),Ji.fogDensity=er.fog.density,Ji.fogEnabled=!0):(Ji.fogEnabled=!1,Ji.fogDensity=0)):(Ji.fogMode=t.Scene.FOGMODE_EXP2,Ji.fogColor=new t.Color4(.5,.55,.6,1),Ji.fogDensity=.01);er.extents.x.min=0,er.extents.y.min=0,er.extents.z.min=0;var a=Qt(er);if(Os.createMapCells(Ji,a,er,null,null,(i,n)=>{vueApp.showSpinner("building_map","ui_game_lights"),(cr=Os.stripTris($i.data,Ft,i,n)).position.set(.5,.5,.5),cr.receiveShadows=!0,async function(){var i;z?(i=localStorage.getItem("lightmap"),i=JSON.parse(i)):i=await mn("maps/"+r+".lightmap?"+Ct[__uv.$wrap((e))].hash,(e,t)=>{vueApp.showSpinnerLoadProgress(Math.ceil(e/t*100))});if(i){for(var n=cr.getVerticesData(t.VertexBuffer.ColorKind),a=0,o=0;a<i.length;a+=3,o+=4)n[__uv.$wrap((o))]=i[__uv.$wrap((a))]/255,n[__uv.$wrap((o+1))]=i[__uv.$wrap((a+1))]/255,n[__uv.$wrap((o+2))]=i[__uv.$wrap((a+2))]/255;cr.updateVerticesData(t.VertexBuffer.ColorKind,n)}if(cr.material=Ji.getMaterialByName("map"),cr.freezeWorldMatrix(),!Q){var l=er.skybox||"default",c=t.MeshBuilder.CreateBox("skyBox",{size:100},Ji);c.infiniteDistance=!0;var u=new t.StandardMaterial("skyBox",Ji);u.backFaceCulling=!1,u.fogEnabled=!1,u.reflectionTexture=new t.CubeTexture("img/skyboxes/"+l+"/skybox",Ji),u.reflectionTexture.coordinatesMode=t.Texture.SKYBOX_MODE,u.diffuseColor=new t.Color3(0,0,0),u.specularColor=new t.Color3(0,0,0),c.material=u}let h=Date.now()-dr;h>3e3?s():setTimeout(()=>s(),3e3-h)}()}),Si=[],h==Qe.king)for(var o=1;o<=Wt;o++)Os.createMapCells(Ji,a,er,"DYNAMIC.capture-zone.none",o,(e,i)=>{if(e){let r=new t.Vector3;for(let e of i)r.x+=e.x,r.y+=e.y,r.z+=e.z;r.scaleInPlace(1/i.length),r.x+=.5,r.y+=.6,r.z+=.5,e.capIconPosition=r,e.position.set(.5,.5,.5),e.material=Ji.getMaterialByName("colorized"),Si.push(e)}});function s(){console.log("Now complete"),z&&Ht.hide(),setTimeout(()=>{vueApp.hideSpinner()},600),vueApp.hideLoadingScreenAd(),ga("send","timing","load","mapLoaded",Math.round(performance.now())-Math.round(F),er.name),i()}}(p,Zr),Me&&(vueApp.setDarkOverlay(!0),Me=!1)}function Ar(){document.pointerLockElement?(console.log("pausing game and breaking pointerlock"),document.exitPointerLock()):(console.log("pausing game via esc key"),Mr())}function Mr(){if(vueApp.showScreen===vueApp.screens.equip)return;he=!0,Li=!1,Ja.clear(Vi),hr=!0,dn(),Zn(),vueApp.setPause(he),vueApp.showGameMenu(),document.getElementById("grenadeThrowContainer").style.visibility="hidden",document.getElementById("weaponBox").style.display="none",document.getElementById("healthContainer").style.display="none",document.getElementById("hardBoiledContainer").style.display="none",document.getElementById("killTicker").style.display="none",document.getElementById("spectate").style.display="none",document.getElementById("serverAndMapInfo").style.display="block",document.getElementById("captureIconContainer").style.display="none",document.getElementById("playerList").style.pointerEvents="auto";const e=document.getElementById("gameAdContainer");e&&(e.style.display="block"),Bi.hide(),Bi.hideDot(),Oi&&S.focus(),!1,Hi||(Hi=document.querySelector(".chat-container")),setTimeout(()=>{Hi.scrollTop=Hi.scrollHeight,La()},300)}function Cr(){if(console.log("resumeGame called"),ir){vueApp.hideGameMenu(),document.getElementById("deathBox").style.display="none",document.getElementById("killTicker").style.display="block",document.getElementById("serverAndMapInfo").style.display="none",h==Qe.king&&(document.getElementById("captureIconContainer").style.display="block"),document.getElementById("playerList").style.pointerEvents="none",Li?document.getElementById("spectate").style.display="block":(document.getElementById("weaponBox").style.display="block",document.getElementById("healthContainer").style.display="block",document.getElementById("hardBoiledContainer").style.display="block",vn());const e=document.getElementById("gameAdContainer");e&&(e.style.display="block"),console.log("Event listeners added"),canvas.focus(),canvas.style.pointerEvents="all",canvas.addEventListener("mousedown",Or,!1),canvas.addEventListener("mouseup",Dr,!1),canvas.addEventListener("pointermove",kr),canvas.addEventListener("wheel",Br),addEventListener("gamepadbuttondown",qn),Oi&&S.focus(),setTimeout(()=>{La()},300),Wa()}}function Rr(e){Ri=Math.max(e,Ri),vueApp.game.respawnTime=Ri,Qi&&Ja.clear(Qi),Qi=Ja.set((function(){Ri--,vueApp.game.respawnTime=Math.min(Ri,e),Ri<=0&&V&&(Ri=-1,Ja.clear(Qi),Jr())}),1200)}var wr={};var Ir=!1;function Or(e){Dn("keyboard","MOUSE "+e.button),1==e.button&&e.preventDefault()}function Dr(e){Bn("keyboard","MOUSE "+e.button)}function kr(e){if(document.pointerLockElement&&!hr&&ir&&(ir.hp>0||Li)){var t=Math.pow(.001*L.mouseSpeed,2);ir.scope&&(t*=ir.weapon.actor.scopeFov);var i=e.movementX,r=e.movementY,n=window.innerWidth/3,a=window.innerHeight/3;if(L.fastPollMouse&&void 0!==wr.x&&Math.abs(i)>n||void 0!==wr.y&&Math.abs(r)>a)return;wr.x&&Math.sign(i)!=Math.sign(wr.x)&&(i=0),wr.y&&Math.sign(r)!=Math.sign(wr.y)&&(r=0),wr.x=i,wr.y=r,ir.yaw=Math.radAdd(ir.yaw,i*t),ir.pitch=Math.clamp(ir.pitch+r*L.mouseInvert*t,-1.5,1.5)}hr=!1}function Br(e){e.wheelDelta>0?(Dn("keyboard","WHEEL UP"),Bn("keyboard","WHEEL UP")):(Dn("keyboard","WHEEL DOWN"),Bn("keyboard","WHEEL DOWN"))}var Fr=new t.Color4(1,1,1,1);function Lr(e,i,r,n,a){for(var o=new t.SpriteManager("","img/"+e+"?"+Ge,i,128,a),s=0;s<i;s++){new t.Sprite("",o).isVisible=!1}return o.nextIdx=0,o.getSprite=function(e){var t=this.sprites[__uv.$wrap((this.nextIdx))];return t.cellIndex=void 0!==e?r+e:Math.randomInt(r,n),t.isVisible=!0,t.easing=wt,t.startSize=-1,t.endSize=-1,t.gravity=0,t.dx=0,t.dy=0,t.dz=0,t.float=0,t.anim=0,t.slow=0,t.angle=0,t.rotate=0,t.stopped=!1,t.animColors=null,t.collide=!1,t.color.copyFrom(Fr),this.nextIdx=++this.nextIdx%this.sprites.length,t},o}function Nr(e,t,i,r,n,a,o,s,l,c,u){let h=0,d=0,p="default",m="default";u&&(h=u.item_data.cell||0,e==Ei&&h&&(d=u.item_data.smokeCell,isNaN(d)&&(d=h)),p=u.item_data.fireColors||"default",m=u.item_data.smokeColors||"default");var _=e.getSprite(h);return _.animLength=t,_.easing=Ot,_.position.x=i,_.position.y=r,_.position.z=n,_.size=l,_.dx=a,_.dy=o,_.dz=s,_.slow=.7,_.angle=Math.random()*Math.PI2,_.rotate=.04*Math.random()-.02,_.animColors=e==Pi?Gr[__uv.$wrap((p))]:Ur[__uv.$wrap((m))],_}function Vr(e,t,i,r,n,a){for(var o=0;o<Math.floor(r/4);o++){var s=80*Math.random()+80,l=1*Math.random()+.5,c=.5*(.9-l),u=(2*Math.random()-1)*c,h=(2*Math.random()-1)*c+.1,d=(2*Math.random()-1)*c,p=Nr(Ei,s,e,t,i,u,h,d,l,0,a);p.float=.015*Math.random()+.001,p.collide=!0,(p=Nr(Pi,.075*s,e,t,i,1.5*u,1.5*h,1.5*d,l,0,a)).collide=!0}if(ir){var m=Math.length3(ir.x-e,ir.y-t,ir.z-i);if(m<(n*=1.5)){var _=Math.max(0,(n-m)/n);qo=Math.min(7,qo+6*_)}}}var Gr={default:[{pos:0,color:new t.Color4(1,.9,.8,1)},{pos:.2,color:new t.Color4(1,.5,.1,1)},{pos:.4,color:new t.Color4(.6,.2,.1,1)},{pos:.7,color:new t.Color4(0,0,0,0)},{pos:1,color:new t.Color4(0,0,0,0)}],rainbow:[{pos:0,color:new t.Color4(1,.1,.1,1)},{pos:.2,color:new t.Color4(1,1,.1,1)},{pos:.4,color:new t.Color4(.1,1,.1,1)},{pos:.7,color:new t.Color4(.1,.1,1,.5)},{pos:1,color:new t.Color4(1,.1,1,0)}],gold:[{pos:0,color:new t.Color4(1,1,.3,1)},{pos:.4,color:new t.Color4(1,.8,.2,1)},{pos:1,color:new t.Color4(1,.6,.1,0)}],corrupt:[{pos:0,color:new t.Color4(1,.1,.1,1)},{pos:.3,color:new t.Color4(1,1,1,1)},{pos:.6,color:new t.Color4(1,.1,.1,1)},{pos:1,color:new t.Color4(1,1,1,0)}],thermal:[{pos:0,color:new t.Color4(1,.9,.8,1)},{pos:.2,color:new t.Color4(1,.5,.1,1)},{pos:.4,color:new t.Color4(.6,.2,.1,1)},{pos:.5,color:new t.Color4(1,1,1,1)},{pos:.6,color:new t.Color4(1,1,1,0)},{pos:.7,color:new t.Color4(1,1,1,1)},{pos:1,color:new t.Color4(0,0,0,0)}],black:[{pos:0,color:new t.Color4(0,0,0,1)},{pos:1,color:new t.Color4(0,0,0,0)}],red:[{pos:0,color:new t.Color4(1,.7,.3,1)},{pos:1,color:new t.Color4(0,0,0,0)}],blue:[{pos:0,color:new t.Color4(.3,.7,1,1)},{pos:1,color:new t.Color4(0,0,0,0)}]},Ur={default:[{pos:0,color:new t.Color4(.3,.3,.3,1)},{pos:1,color:new t.Color4(.7,.7,.7,0)}],white:[{pos:0,color:new t.Color4(1,1,1,.5)},{pos:1,color:new t.Color4(1,1,1,0)}],corrupt:[{pos:0,color:new t.Color4(1,1,1,.6)},{pos:.5,color:new t.Color4(1,.1,.1,.4)},{pos:1,color:new t.Color4(0,0,0,0)}],thermal:[{pos:0,color:new t.Color4(.5,.1,.01,.3)},{pos:.3,color:new t.Color4(.7,.4,0,.1)},{pos:1,color:new t.Color4(0,0,0,0)}],supernova:[{pos:0,color:new t.Color4(1,1,1,.5)},{pos:1,color:new t.Color4(1,0,1,0)}],black:[{pos:0,color:new t.Color4(0,0,0,1)},{pos:1,color:new t.Color4(0,0,0,0)}],softblack:[{pos:0,color:new t.Color4(0,0,0,.5)},{pos:1,color:new t.Color4(0,0,0,0)}],red:[{pos:0,color:new t.Color4(1,.7,.3,1)},{pos:.5,color:new t.Color4(1,.3,0,.6)},{pos:1,color:new t.Color4(0,0,0,0)}],blue:[{pos:0,color:new t.Color4(.3,.7,1,1)},{pos:.5,color:new t.Color4(0,.3,1,.6)},{pos:1,color:new t.Color4(0,0,0,0)}]},zr=[{pos:0,color:new t.Color4(1,1,1,1)},{pos:.2,color:new t.Color4(.7,.7,.7,.7)},{pos:1,color:new t.Color4(.7,.7,.7,0)}],Hr=[{pos:0,color:new t.Color4(1,1,1,1)},{pos:.8,color:new t.Color4(1,1,1,1)},{pos:1,color:new t.Color4(1,1,1,0)}];function Wr(e,i,r){for(var n=e.length-2;n>=0;n--)if(i>=e[__uv.$wrap((n))].pos)return void t.Color4.LerpToRef(e[__uv.$wrap((n))].color,e[__uv.$wrap((n+1))].color,(i-e[__uv.$wrap((n))].pos)*(1/(e[__uv.$wrap((n+1))].pos-e[__uv.$wrap((n))].pos)),r)}function jr(e,t,i,r){for(var n=0;n<t;n++){var a=Math.random()*r+.5*r,o=n/(.5*t)*i+.5*i,s=.08/(o+1),l=(2*Math.random()-1)*s,c=(2*Math.random()-.5)*s,u=(2*Math.random()-1)*s,h=Mi.getSprite();h.animLength=a,h.easing=It,h.position.x=e.actor.mesh.position.x,h.position.y=e.actor.mesh.position.y+.3,h.position.z=e.actor.mesh.position.z,h.startSize=o,h.endSize=0,h.gravity=.003,h.dx=l,h.dy=c,h.dz=u,h.angle=Math.random()*Math.PI2,h.rotate=.2*Math.random()-.1,h.collide=!0,h.color.r=e.actor.bodyMesh.colorMult.r,h.color.g=e.actor.bodyMesh.colorMult.g,h.color.b=e.actor.bodyMesh.colorMult.b}}function Xr(e){for(var t=0;t<10;t++){var i=80*Math.random()+80,r=t/5*.2+.2,n=.05/(r+1),a=(2*Math.random()-1)*n,o=(2*Math.random()-.25)*n*1.5,s=(2*Math.random()-1)*n,l=yolkManager.getSprite();l.animLength=i,l.easing=It,l.position.x=e.actor.mesh.position.x,l.position.y=e.actor.mesh.position.y+.3,l.position.z=e.actor.mesh.position.z,l.startSize=r,l.endSize=0,l.gravity=.005,l.dx=a,l.dy=o,l.dz=s,l.slow=.9,l.angle=Math.random()*Math.PI2,l.rotate=.2*Math.random()-.1,l.collide=!0}}function Yr(e,t){for(var i=Math.floor(t/33)+1,r=0;r<i;r++){var n=9*Math.random()+9,a=.03/1.8,o=(2*Math.random()-1)*a,s=(2*Math.random()-.25)*a*1.5,l=(2*Math.random()-1)*a;_r.set(ir.x,ir.y,ir.z),fr.set(e.x,e.y,e.z),_r.subtractInPlace(fr).normalize().scaleInPlace(.26);var c=Ci.getSprite();c.animLength=n,c.easing=wt,c.position.x=e.actor.mesh.position.x,c.position.y=e.actor.mesh.position.y+.3,c.position.z=e.actor.mesh.position.z,c.startSize=.8*.2,c.endSize=.8,c.gravity=.003,c.dx=o+e.dx,c.dy=s,c.dz=l+e.dz,c.slow=.95,c.angle=Math.random()*Math.PI2,c.rotate=.02*Math.random()-.001,c.collide=!1,c.animColors=Hr}}function Kr(e,t){for(var i=Math.floor(t/33)+1,r=0;r<i;r++){var n=9*Math.random()+9,a=.03/1.8,o=(2*Math.random()-1)*a,s=(2*Math.random()-.25)*a*1.5,l=(2*Math.random()-1)*a;_r.set(ir.x,ir.y,ir.z),fr.set(e.x,e.y,e.z),_r.subtractInPlace(fr).normalize().scaleInPlace(.26);var c=Ai.getSprite();c.animLength=n,c.easing=wt,c.position.x=e.actor.mesh.position.x,c.position.y=e.actor.mesh.position.y+.3,c.position.z=e.actor.mesh.position.z,c.startSize=.8*.2,c.endSize=.8,c.gravity=.003,c.dx=o+e.dx,c.dy=s,c.dz=l+e.dz,c.slow=.95,c.angle=Math.random()*Math.PI2,c.rotate=.02*Math.random()-.001,c.collide=!1,c.animColors=Hr}}function Qr(e,t){for(var i=0;i<e.sprites.length;i++){var r=e.sprites[__uv.$wrap((i))];if(r.isVisible){var n=r.easing(r.anim);if(r.endSize>=0&&(r.size=r.startSize+n*(r.endSize-r.startSize)),r.animColors&&Wr(r.animColors,n,r.color),!r.stopped){r.position.x+=r.dx*t,r.position.y+=r.dy*t+r.float,r.position.z+=r.dz*t,r.rotate&&(r.angle+=r.rotate*t);var a=!1;r.collide&&(_r.set(r.position.x,r.position.y,r.position.z),a=gt.pointCollidesWithStructure(_r,!0)),a?(r.stopped=!0,r.position.x-=r.dx*t,r.position.y-=r.dy*t,r.position.z-=r.dz*t):r.gravity&&(r.dy-=r.gravity*t),r.slow&&(r.dx*=Math.pow(r.slow,t),r.dy*=Math.pow(r.slow,t),r.dz*=Math.pow(r.slow,t))}r.anim+=t/r.animLength,r.anim>=1&&(r.isVisible=!1)}}}function Zr(){console.log("onLoadingComplete"),Ti=new gi({numChannels:24},{distanceModel:"exponential"});try{ki=new Wn,Fi=new jn,(Bi=new Xn).hide(),Bi.hideDot(),ut("muzzleFlash",Ji,null,Ji.getMaterialByName("muzzleFlash")).setEnabled(!1),ut("bullet",Ji,null,Ji.getMaterialByName("bullet")).setEnabled(!1),ut("rocket",Ji,null,Ji.getMaterialByName("standardInstanced")).setEnabled(!1),ut("ammo",Ji,null,Ji.getMaterialByName("standardInstanced")).setEnabled(!1),ut("grenadeItem",Ji,null,Ji.getMaterialByName("standardInstanced")).setEnabled(!1),ut("meleeItem",Ji,null,Ji.getMaterialByName("standardInstanced")).setEnabled(!1),ut("spatula",Ji,null,Ji.getMaterialByName("emissive")).setEnabled(!1);for(let e=0;e<G.grenades.length;e++){ut(G.grenades[__uv.$wrap((e))].item_data.meshName,Ji,null,Ji.getMaterialByName("emissive")).setEnabled(!1)}if(Sr=new Bt(Ji),Tr=new zo,(Ei=Lr("particles.png",300,16,23,Ji)).fogEnabled=!0,Ei.noAlphaTest=!0,(Pi=Lr("particles.png",300,16,23,Ji)).fogEnabled=!0,Pi.blendMode=t.Engine.ALPHA_ADD,(Mi=Lr("particles.png",400,3,6,Ji)).fogEnabled=!0,yolkManager=Lr("particles.png",100,2,2,Ji),yolkManager.fogEnabled=!0,vueApp.switchToGameUi(),H.isUpgraded()&&(document.getElementById("chickenBadge").style.display="block"),(Ai=Lr("particles.png",20,0,0,Ji)).fogEnabled=!0,(Ci=Lr("particles.png",20,7,7,Ji)).fogEnabled=!0,z){u=0,xa={update:()=>{},render:()=>{}},ba={update:()=>{}};var e={id:0,uniqueId:0,name:"Test",charClass:0,team:0,primaryWeaponItem:H.getPrimaryWeapon(),secondaryWeaponItem:H.getSecondaryWeapon(),shellColor:0,hatItem:null,stampItem:null,score:0,kills:0,deaths:0,streak:0,totalKills:0,totalDeaths:0,bestGameStreak:0,bestOverallStreak:0,x:Y.x+.5,y:Y.y-.32,z:Y.z+.5,dx:0,dy:0,dz:0,frame:0,pitch:Y.pitch,yaw:Y.yaw,shield:0,hp:0,playing:!1,weaponIdx:0,controlKeys:0,randomSeed:0,upgradeProductId:void 0!==H.upgradeProductId&&null!==H.upgradeProductId?H.upgradeProductId:0,activeShellStreaks:0,social:[],hideBadge:0,damageMod:1,stats:{}};ct.forEach(t=>e.stats[__uv.$wrap((t))]=0),bn(e),ar[__uv.$wrap((u))].hp=100,$r(),rn(),nn(),Ar(),Bi.show(),Bi.showDot(),Ri=-1,g=0,vueApp.delayTheCracking=!0}else{Di=!0,va.onmessage=function(e){for(mr.init(e.data);mr.isMoreDataAvailable();){var i=mr.unPackInt8U();switch(i){case Xe.playerInfo:var r=mr.unPackInt8U(),n=mr.unPackString(128),o=mr.unPackString(32);if(q=ar[__uv.$wrap((r))]){q.dbId=n,q.ip=o;for(var s=0;s<pr.length;s++)if(pr[__uv.$wrap((s))].id===r){pr[__uv.$wrap((s))].dbId=n,pr[__uv.$wrap((s))].ip=o;break}}break;case Xe.musicInfo:var l=mr.unPackLongString();cn(l);break;case Xe.pause:r=mr.unPackInt8U(),(q=ar[__uv.$wrap((r))])&&q.removeFromPlay();break;case Xe.eventModifier:console.log("eventModifier"),(c=bi.getBuffer()).packInt8(Xe.eventModifier),c.send(va);break;case Xe.clientReady:var c;!0,Ri=-1,g=0,rn(),nn(),vueApp.delayInGamePlayButtons(),ue?setTimeout(()=>{vueApp.onGamePauseUi(),Yn()},200):Ar(),L.autoDetail?Na():(Ga(L.highRes),Ua(L.shadowsEnabled)),(c=bi.getBuffer()).packInt8(Xe.ping),c.send(va);break;case Xe.addPlayer:var h=mr.unPackInt8U(),d=mr.unPackString(),p=mr.unPackString(),m=mr.unPackInt8U(),y={id:h,uniqueId:d,name:p=ro(p,80),charClass:m,team:mr.unPackInt8U(),primaryWeaponItem:G.findItemById(mr.unPackInt16U()),secondaryWeaponItem:G.findItemById(mr.unPackInt16U()),shellColor:mr.unPackInt8U(),hatItem:G.findItemById(mr.unPackInt16U()),stampItem:G.findItemById(mr.unPackInt16U()),grenadeItem:G.findItemById(mr.unPackInt16U()),meleeItem:G.findItemById(mr.unPackInt16U()),x:mr.unPackFloat(),y:mr.unPackFloat(),z:mr.unPackFloat(),dx:mr.unPackFloat(),dy:mr.unPackFloat(),dz:mr.unPackFloat(),yaw:mr.unPackRadU(),pitch:mr.unPackRad(),score:mr.unPackInt32U(),kills:mr.unPackInt16U(),deaths:mr.unPackInt16U(),streak:mr.unPackInt16U(),totalKills:mr.unPackInt32U(),totalDeaths:mr.unPackInt32U(),bestGameStreak:mr.unPackInt16U(),bestOverallStreak:mr.unPackInt16U(),shield:mr.unPackInt8U(),hp:mr.unPackInt8U(),playing:mr.unPackInt8U(),weaponIdx:mr.unPackInt8U(),controlKeys:mr.unPackInt8U(),upgradeProductId:mr.unPackInt8U(),activeShellStreaks:mr.unPackInt8U(),social:mr.unPackLongString(),hideBadge:mr.unPackInt8U(),gameData:{}};if(y.gameData.mapIdx=mr.unPackInt8U(),y.gameData.private=mr.unPackInt8U(),y.gameData.gameType=mr.unPackInt8U(),y.stats={},ct.forEach(e=>y.stats[__uv.$wrap((e))]=0),y.stats.kills=y.kills,y.stats.deaths=y.deaths,y.stats.streak=y.streak,y.name=ao(y.name),!ar[__uv.$wrap((y.id))]){u==y.id||j?(y.normalName=y.name,y.safeName=y.name):(y.normalName=y.name.replace(/<|>/g,""),y.safeName=Ba(),(0==y.normalName.length||ii(y.normalName))&&(y.normalName=y.safeName),L.safeNames?y.name=y.safeName:y.name=y.normalName);let e=En(d);e?(y.muted=e.muted,y.muted&&!L.safeNames&&(y.name=y.safeName)):y.muted=!1,bn(y)}break;case Xe.removePlayer:xn(r=mr.unPackInt8U());break;case Xe.spawnItem:h=mr.unPackInt16U();var v=mr.unPackInt8U(),b=mr.unPackFloat(),x=mr.unPackFloat(),E=mr.unPackFloat();Tr.spawnItem(h,v,b,x,E);break;case Xe.collectItem:r=mr.unPackInt8U(),v=mr.unPackInt8U();var P=mr.unPackInt8U();h=mr.unPackInt16U(),Tr.collectItem(v,h),r==u&&ir.collectItem(v,P);break;case Xe.die:var A,M,C=mr.unPackInt8U(),I=mr.unPackInt8U(),O=mr.unPackInt8U(),D=ar[__uv.$wrap((C))],k=ar[__uv.$wrap((I))],B=mr.unPackInt8U(),F=mr.unPackInt8U();if(k.lastDmgType=B,D.lastDmgType=F,C==u&&I!=u?Ce.updateTerminus(getKeyByValue(lt,D.charClass),qe[__uv.$wrap((F))].name,"deaths"):I==u&&C==u&&(Ce.updateTerminus(getKeyByValue(lt,D.charClass),"Grenade","deaths",!0),ga("send","event","weapon","deathBy","Suicide")),D){ba.scoreKill(k,D)&&Qn(),A=D.name;var U=new t.Vector3(D.x,D.y+.32,D.z);Ti.play("shell_burst",U);var z=Math.randomInt(0,10)+1;Ti.play("death_scream"+z,U),Kr(D,100),Yr(D,100),jr(D,80,.2,40),Xr(D),D.die(),D.actor.mesh.position.x=D.x,D.actor.mesh.position.y=D.y,D.actor.mesh.position.z=D.z}else A="N/A";if(k?(I===u&&C!==I&&(Ce.streak=k.bestGameStreak,Ce.updateTerminus(getKeyByValue(lt,k.charClass),qe[__uv.$wrap((F))].name,"kills"),"Grenade"!==qe[__uv.$wrap((F))].name&&"Melee"!==qe[__uv.$wrap((F))].name||ga("send","event","weapon","killedWith",qe[__uv.$wrap((F))].name)),M=k.name,k.isDead()||(k.scoreKill(),I==u&&((it=document.getElementById("bestStreak")).innerText="x"+k.bestOverallStreak),I==u&&(ji++,Yi=Math.max(Yi,k.stats.streak)))):M="N/A",C!=u){if(I==u){en&&clearTimeout(en);var W=document.getElementById("killBox");W.style.display="block",vueApp.killedName=A;var X=document.getElementById("KILL_STREAK");ir.stats.streak>1?X.innerText=ir.stats.streak+"-KILL STREAK":X.innerText="";var Y=1.5,K=Ja.set((function(){W.style.transform="scale("+Y+","+Y+")",(Y-=.05)<=1&&(Y=1,Ja.clear(K))}),33);en=setTimeout(()=>{V&&(W.style.display="none")},4e3)}}else{a.__uv$setSource(__uv).__uv$parent=null,a.position=new t.Vector3(rr.actor.mesh.position.x,rr.actor.mesh.position.y+.2,rr.actor.mesh.position.z),k&&(a.lockedTarget=k.actor.head);var Q=document.getElementById("deathBox");Q.style.display="block",vueApp.killName=M,Y=2,K=Ja.set((function(){Q.style.transform="scale("+Y+","+Y+")",(Y-=.05)<=1&&V&&(Ja.clear(K),Y=1)}),33),Xi++,Rr(!N||ge||pokiActive?O-1:12),Zn(),$a.set((function(){V&&(Q.style.display="none",R==u&&Ar())}),3e3)}k&&D&&Ln(k,D),An();break;case Xe.chat:r=mr.unPackInt8U();var Z=mr.unPackString(),q=ar[__uv.$wrap((r))];r>253?(255===r?Z='<span style="color: #ff0">SERVER: </span>'+Z:254===r&&(Z='<span style="color: #0f0">MOD: </span>'+Z),(T.innerHTML.match(/<br>/g)||[]).length>5&&(T.innerHTML=T.innerHTML.substr(T.innerHTML.search("<br>")+4)),T.innerHTML+=Z+"<br>"):q.muted||(an.innerHTML=Z,Z=an.textContent.trim(),q&&Z.length>0&&!ii(Z)&&Z.indexOf("<")<0&&Vn(Z,q));break;case Xe.metaGameState:ba._unPackState(mr);break;case Xe.syncMe:h=mr.unPackInt8U();var J=mr.unPackInt8U(),$=mr.unPackInt8U(),ee=(b=mr.unPackFloat(),x=mr.unPackFloat(),E=mr.unPackFloat(),mr.unPackInt8U()),te=mr.unPackInt8U(),ie=mr.unPackInt8U();(q=ar[__uv.$wrap((h))]).serverStateIdx=$;var re=q.x,ne=q.y,ae=q.z,oe=q.dx,se=q.dy,le=q.dz,ce=q.yaw,de=q.pitch,pe=(s=J,q.stateBuffer[__uv.$wrap((s))]),me=Math.mod(q.stateIdx-J,Vt)+8*Je;if(q.lastWeaponChange>me&&(te!==pe.rounds||ie!==pe.store)){for(var _e=J;_e!=q.stateIdx;_e=Math.mod(_e+1,Vt)){var fe=q.stateBuffer[__uv.$wrap((_e))];te-=fe.shots,fe.rounds=te}q.weapon.ammo.rounds=te,q.weapon.ammo.store=ie,Mn()}if(ee)var ye=Math.length3(pe.x-b,pe.y-x,pe.z-E);else ye=Math.length2(pe.x-b,pe.z-E);if(0!=Wi){if(ye<.1){var ve=2*Je;q.totalCorrections=ve,q.corrections=ve,q.corrected.dx=b-pe.x,q.corrected.dy=x-pe.y,q.corrected.dz=E-pe.z;break}ve=2*Je}else{if(ye<.02)break;ve=2*Je}q.totalCorrections=ve,q.x=b,q.y=x,q.z=E,q.dx=pe.dx,q.dy=pe.dy,q.dz=pe.dz,q.climbing=pe.climbing,q.jumping=pe.jumping;for(var be=ir.controlKeys;s!=q.stateIdx;s=Math.mod(s+1,Vt))pe=q.stateBuffer[__uv.$wrap((s))],q.controlKeys=pe.controlKeys,q.yaw=pe.yaw,q.update(!0);(ye=q.climbing?Math.length3(q.x-re,q.y-ne,q.z-ae):Math.length2(q.x-re,q.z-ae))<.2?(q.corrections=ve,q.corrected.dx=q.x-re,q.corrected.dy=q.y-ne,q.corrected.dz=q.z-ae,q.x=re,q.y=ne,q.z=ae,q.dx=oe,q.dy=se,q.dz=le):q.corrections=0,q.yaw=ce,q.pitch=de,q.controlKeys=be;break;case Xe.syncThem:if(h=mr.unPackInt8U(),b=mr.unPackFloat(),x=mr.unPackFloat(),E=mr.unPackFloat(),ee=mr.unPackInt8U(),!(q=ar[__uv.$wrap((h))])||q.id==u){for(s=0;s<Je;s++)mr.unPackInt8U(),mr.unPackRadU(),mr.unPackRad();break}for(q.stateIdx=0,s=0;s<Je;s++)q.stateBuffer[__uv.$wrap((s))].controlKeys=mr.unPackInt8U(),q.stateBuffer[__uv.$wrap((s))].yaw=mr.unPackRadU(),q.stateBuffer[__uv.$wrap((s))].pitch=mr.unPackRad();q.x=b,(!q.jumping||Math.abs(q.y-x)>.5)&&(q.y=x),q.z=E,q.stateBuffer[__uv.$wrap((0))].x=b,q.stateBuffer[__uv.$wrap((0))].y=x,q.stateBuffer[__uv.$wrap((0))].z=E,q.climbing=ee;break;case Xe.fire:if(h=mr.unPackInt8U(),_r.x=mr.unPackFloat(),_r.y=mr.unPackFloat(),_r.z=mr.unPackFloat(),fr.x=mr.unPackFloat(),fr.y=mr.unPackFloat(),fr.z=mr.unPackFloat(),!(q=ar[__uv.$wrap((h))]))break;h!=u&&(q.weapon.actor.fire(),q.weapon.fireMunitions(_r,fr),--q.weapon.tracer<0&&(q.weapon.tracer=q.weapon.constructor.tracer)),mathSeed=Oe;break;case Xe.melee:h=mr.unPackInt8U(),ar[__uv.$wrap((h))]&&(ar[__uv.$wrap((h))].meleeCountdown=17,ar[__uv.$wrap((h))].actor.melee());break;case Xe.throwGrenade:h=mr.unPackInt8U(),b=mr.unPackFloat(),x=mr.unPackFloat(),E=mr.unPackFloat();var xe=mr.unPackFloat(),Se=mr.unPackFloat(),Te=mr.unPackFloat();if(!(q=ar[__uv.$wrap((h))]))break;q.grenadeCount--,h!=u?(q.actor.head.rotation.x=q.pitch,q.actor.mesh.rotation.y=q.yaw):Mn(),q.actor.throwGrenade(),Sr.throwGrenade(q,{x:b,y:x,z:E},{x:xe,y:Se,z:Te});break;case Xe.explode:var Ee=mr.unPackInt8U(),Pe=mr.unPackInt16U(),Ae=(b=mr.unPackFloat(),x=mr.unPackFloat(),E=mr.unPackFloat(),mr.unPackInt8U()),Me=mr.unPackFloat();let e=null;Ee>0&&(e=G.findItemById(Pe)),Vr(b,x,E,Ae,Me,e),_r.set(b,x,E),Ee==st.Grenade?Ti.play(e.item_data.sound||"grenade",_r):Ti.play("gun_rpegg_rocket_hit",_r);break;case Xe.reload:h=mr.unPackInt8U(),ar[__uv.$wrap((h))]&&ar[__uv.$wrap((h))].reload();break;case Xe.swapWeapon:h=mr.unPackInt8U();var Re=mr.unPackInt8U();ar[__uv.$wrap((h))]&&ar[__uv.$wrap((h))].swapWeapon(Re);break;case Xe.hitMe:var we=mr.unPackInt8U();xe=mr.unPackFloat(),Te=mr.unPackFloat(),ir.hp=we,ir.actor.hit(),Fi.hit(xe,Te);break;case Xe.hitMeHardBoiled:var Ie=mr.unPackInt8U();we=mr.unPackInt8U(),xe=mr.unPackFloat(),Te=mr.unPackFloat(),ir.hp=we,ir.hardBoiledValue=Ie,ir.actor.hit(),Fi.hit(xe,Te),vn();break;case Xe.hitThem:if(h=mr.unPackInt8U(),we=mr.unPackInt8U(),!(q=ar[__uv.$wrap((h))]))break;q.hp=we,q.lastDmgType=q.weapon.constructor.id,q.actor.hit(),we>0&&Yr(q,Math.clamp(q.hp-we,0,100));break;case Xe.respawn:Ki=!1,h=mr.unPackInt8U();var Oe=mr.unPackInt16U(),De=(b=mr.unPackFloat(),x=mr.unPackFloat(),E=mr.unPackFloat(),mr.unPackInt8U()),ke=mr.unPackInt8U(),Be=mr.unPackInt8U(),Fe=mr.unPackInt8U(),Le=mr.unPackInt8U();(q=ar[__uv.$wrap((h))])&&(q.actor.removeFromPlay(),q.randomGen.setSeed(Oe),q.weapons[__uv.$wrap((0))].ammo.rounds=De,q.weapons[__uv.$wrap((0))].ammo.store=ke,q.weapons[__uv.$wrap((1))].ammo.rounds=Be,q.weapons[__uv.$wrap((1))].ammo.store=Fe,q.grenades=Le,q.respawn(b,x,E),h==u?(Cr(),un(),canvas.requestPointerLock(),he=!1,console.log("CommCode.respawn received from server for this player"),ci.init(),$r(),Bi.show(),Bi.showDot(),Oi&&S.focus()):An());break;case Xe.changeCharacter:h=mr.unPackInt8U();var Ne=mr.unPackInt8U(),Ve=mr.unPackInt16U(),Ge=mr.unPackInt16U(),Ue=mr.unPackInt8U(),ze=mr.unPackInt16U(),He=mr.unPackInt16U(),We=mr.unPackInt16U(),je=mr.unPackInt16U(),Ye=G.findItemById(Ve),Ke=G.findItemById(Ge),Qe=G.findItemById(ze),Ze=G.findItemById(He),$e=G.findItemById(We),et=G.findItemById(je);(q=ar[__uv.$wrap((h))])&&q.changeCharacter(Ne,Ye,Ke,Ue,Qe,Ze,$e,et);break;case Xe.switchTeam:h=mr.unPackInt8U();var tt=mr.unPackInt8U();(q=ar[__uv.$wrap((h))])&&(h==u&&(w=tt,vueApp.setTeam(w),ba.teamScore[__uv.$wrap((tt))]>=ba.teamScore[__uv.$wrap((q.team))]&&ba.teamScore[__uv.$wrap((tt))]>0&&(q.canTakeTeamBonus=!1)),q.team=tt,q.score=0,q.stats.kills=0,q.stats.streak=0,q.bestGameStreak=0,mr.isMoreDataAvailable()&&mr.peekInt8U()===Xe.switchTeam||(dn(),An()));break;case Xe.switchTeamFail:vueApp.showGenericPopup("ui_game_fairteams_header","ui_game_fairteams_text","ok");break;case Xe.ping:ping=Date.now()-fn,_+=ping,f++;var it=document.getElementById("ping");ping<100?it.style.color="#0f0":ping<150?it.style.color="#ff0":ping<200?it.style.color="#f90":it.style.color="#f00",it.innerText=ping+"ms",setTimeout((function(){if(va){var e=bi.getBuffer();e.packInt8(Xe.ping),e.send(va),fn=Date.now()}}),1e3);break;case Xe.gameLocked:notify(vueApp.loc.ui_game_locked,1e4);break;case Xe.updateBalance:var rt=mr.unPackInt32U();console.log("updating balance from server: "+rt),H.currentBalance=rt;break;case Xe.expireUpgrade:console.log("upgrade has expired"),li();break;case Xe.beginShellStreak:h=mr.unPackInt8U();var nt=mr.unPackInt8U();(q=ar[__uv.$wrap((h))]).beginShellStreak(nt);break;case Xe.endShellStreak:h=mr.unPackInt8U(),nt=mr.unPackInt8U(),(q=ar[__uv.$wrap((h))]).endShellStreak(nt);break;default:console.log("CommCode error: "+i+"/"+String.fromCharCode(i)+" - previous cmd: "+JSON.stringify(on))}on.push(i),on.length>4&&on.shift()}},va.onclose=e=>{qa(e.code)};var i=bi.getBuffer();i.packInt8(Xe.clientReady),i.send(va),fn=Date.now(),os();Vn(`${ka("ingame_chat_msg")} <br /> ${ka("ingame_chat_msg_2")}`,null,qr)}}catch(e){console.log(e)}}function qr(){ga("send","event","game","click","openShareLinkChat"),Yn()}function Jr(){a.__uv$setSource(__uv).__uv$parent=null,a.position=new t.Vector3(0,$i.height+1,0),a.lockedTarget=null,a.setTarget(new t.Vector3($i.width/2,$i.height/4,$i.depth/2)),Di=!0,rr=ir,R=u,Ji.autoClear=!0,Ji.autoClearDepthAndStencil=!0}function $r(e){a.position=t.Vector3.Zero(),a.rotation=t.Vector3.Zero(),a.__uv$setSource(__uv).__uv$parent=e?e.actor.eye:ir.actor.eye,a.lockedTarget=null,Di=!1,Ji.autoClear=!1,Ji.autoClearDepthAndStencil=!1}var en,tn=!1;function rn(e){hasValue(e)||La(),i.runRenderLoop((function(){!function(){var e=performance.now(),r=Math.min((e-gn)/(1e3/60),8);if(gn=e,g>=0){var n=i.getFps();g+=n,y++}if(y%10==0){g/y,document.getElementById("FPS").innerText=Math.floor(n+.5),!rr||rr.activeShellStreaks&tt.HardBoiled||vn()}f>10&&(ne=Math.max(ne,ping));if(K)ir.actor.update(r);else{for(var o=0;o<playerLimit;o++){var s=ar[__uv.$wrap((o))];s&&(s.chatLineCap=Math.min(s.chatLineCap+r/120,3),s.playing&&(s.actor.handsToWeaponSkeleton(),s.actor&&s.actor.update(r)))}ur&&ur.actor.update(r)}ir&&(Fi.update(r),Bi.update(r));K||(Sr.updateActors(r),Tr.update(r),Qr(Ei,r),Qr(Pi,r),Qr(Ai,r),Qr(Mi,r),Qr(yolkManager,r),Qr(Ci,r));Di&&(gr+=.002*r,a.position.x=Math.sin(gr)*$i.height+$i.width/2,a.position.z=Math.cos(gr)*$i.height+$i.depth/2,a.setTarget(new t.Vector3($i.width/2,$i.height/4,$i.depth/2)));Li&&Ni.update(r)}(),rr&&(tr.position.x=rr.x,tr.position.y=rr.y+2,tr.position.z=rr.z),Ji.render(),xa.render()}))}function nn(){wn(),Di&&Jr(),Zi=setInterval(_n,1e3/30)}var an=document.createElement("DIV"),on=[],sn="",ln=!1;const cn=e=>{if(!ln&&e?(ln=!0,vueApp.musicWidget(!0)):ln&&!e&&(ln=!1,vueApp.musicWidget(!1)),sn!==e){sn=e;var t=decodeURI(e);console.log("Music metadata",t),data=JSON.parse(t),vueApp.music.serverTracks=data,"localhost"==__uv.$get(location).host||"localshelldev.bluewizard.com"==__uv.$get(location).host?vueApp.music.serverTracks.albumArt="https://shellshock.io/data/img/albumArt/"+data.id+data.albumExt+"?"+data.query:vueApp.music.serverTracks.albumArt=dynamicContentPrefix+"data/img/albumArt/"+data.id+data.albumExt+"?"+data.query,vueApp.songChanged=!0}};function un(){Bi.hide(),Bi.hideDot(),ki.hide(),Bi.setPowerful(!1),a.fov=1.25,Ii=!1,document.getElementById("grenadeThrowContainer").style.visibility="hidden",document.getElementById("eggBreakerContainer").className="off"}function hn(e){var t;(t=document.getElementById("shellStreakMessage")).innerText=e,t.className="appear",(t=document.getElementById("shellStreakCaption")).innerText="x"+ir.stats.streak+" Shellstreak",t.style.visibility="visible",setTimeout(()=>{document.getElementById("shellStreakMessage").className="disappear",document.getElementById("shellStreakCaption").style.visibility="hidden"},3e3)}function dn(){for(var e=0;e<playerLimit;e++){var t=ar[__uv.$wrap((e))];t&&t.actor&&t.actor.updateTeam()}}var pn=Math.PI/2;async function mn(e,t){for(var i=await fetch(e),r=i.body.getReader(),n=+i.headers.get("Content-Length"),a=0,o=[];;){var{done:s,value:l}=await r.read();if(s)break;o.push(l),a+=l.length,t&&t(a,n)}var c=new Uint8Array(a),u=0;for(var h of o)c.set(h,u),u+=h.length;return lightmap=new Uint8Array(c),lightmap}function _n(){var e=performance.now();if(qi=e,!vr){f>10&&(ne=Math.max(ne,ping));for(ci.update();Ui<e;){if(Ui+=1e3/30,K)ir.actor.updateLerp(),ir.update();else{for(var i=0;i<playerLimit;i++){var r=ar[__uv.$wrap((i))];r&&(r.chatLineCap=Math.min(r.chatLineCap+2/120,3),r.playing&&(r.actor.updateLerp(),r.update()))}ur&&ur.update()}ir&&(ir.weapon&&0==ir.weapon.ammo.rounds&&(ir.stateIdx%20==0?document.getElementById("ammo").style.color="#f00":ir.stateIdx%20==10&&(document.getElementById("ammo").style.color="#fff")),1==Ii&&(nr=Math.min(nr+.03,1))>0&&(document.getElementById("grenadeThrowContainer").style.visibility="visible",document.getElementById("grenadeThrow").style.height=100*nr+"%")),K||Sr.updateLogic(),ba.update()}var n=t.Matrix.Invert(a.getViewMatrix());Er.copyFrom(t.Vector3.TransformNormal(new t.Vector3(0,0,-1),n)),Er.normalize(),fi.update(),xa.update()}}var fn,gn=performance.now();function yn(e,t,i,r,n){(t.player.lastDamageGivenType=t.dmgTypeId,e.lastDamageTakenType=t.dmgTypeId,!e.playing||e.shield>0)||Math.max(0,Math.floor(e.hp-i))>0&&Kr(e,Math.clamp(i,0,100))}function vn(){if(rr.activeShellStreaks&tt.HardBoiled){"visible"!=(t=document.getElementById("hardBoiledContainer")).style.visibility&&(t.style.visibility="visible",document.getElementById("healthContainer").style.visibility="hidden");var e=Math.floor(rr.hardBoiledValue);document.getElementById("hardBoiledValue").innerText=e,(t=document.getElementById("hardBoiledShieldFill")).style.clipPath="inset("+(100-e)+"% 0 0 0)"}else{var t;"visible"!=(t=document.getElementById("healthContainer")).style.visibility&&(t.style.visibility="visible",document.getElementById("hardBoiledContainer").style.visibility="hidden");var i=document.getElementById("healthBar"),r=document.getElementById("healthHp"),n=2.3-rr.hp/43.478;i.setAttribute("stroke-dashoffset",6.2832*n+"em");e=Math.floor(rr.hp);r.innerText=e}}function bn(e){e.id==u&&(R=e.id);var t=new Gt(e,Ji);if(t.id==u)rr=t,(ir=t).ws=va,Mn();else{let t=pr.findIndex(t=>t.uniqueId===e.uniqueId);t>=0&&pr.splice(t,1),pr.push({id:e.id,uniqueId:e.uniqueId,name:e.name,muted:e.muted,isGameOwner:e.isGameOwner}),pr.length>50&&pr.shift()}t.playing||t.actor.removeFromPlay(),ar[__uv.$wrap((e.id))]=t,An()}function xn(e){var t=ar[__uv.$wrap((e))];e!=u?t&&(t.actor.remove(),R===e&&Ni.unlock(),delete ar[__uv.$wrap((e))],An()):console.log("Tried to remove ME")}function Sn(e){if(e){try{const t=JSON.parse(e);if(t.length>0&&hasValue(t[__uv.$wrap((0))]))return t.find(e=>e.active)}catch(e){}return!1}return!1}function Tn(e){return!e.hideBadge&&(e.upgradeProductId&&e.upgradeProductId>0||e.social.length>2&&e.social.includes('"active": true'))}function En(e){for(let t=0;t<playerLimit;t++)if(ar[__uv.$wrap((t))]&&ar[__uv.$wrap((t))].uniqueId===e)return ar[__uv.$wrap((t))];return pr.find(t=>t.uniqueId===e)}function Pn(e,t,i){let r=En(e);if(r)return function(){var n={uniqueId:e,isGameOwner:r.isGameOwner,muted:r.muted,playerName:r.name,muteFunc:function(){!function(e){for(let i=0;i<playerLimit;i++){if((t=ar[__uv.$wrap((i))])&&t.id!==u&&t.uniqueId===e){t.muted?(t.muted=!1,L.safeNames||(t.name=t.normalName)):(t.muted=!0,L.safeNames||(t.name=t.safeName)),t.actor.setupNameSprite(),An();break}}var t;(t=pr.find(t=>t.id!==u&&t.uniqueId===e))&&(t.muted=!t.muted)}(e)},bootFunc:function(){!function(e){var t=bi.getBuffer();t.packInt8(Xe.bootPlayer),t.packString(e),t.send(va)}(e)},banFunc:function(t,i){!function(e,t,i){var r=bi.getBuffer();r.packInt8(Xe.banPlayer),r.packString(e),r.packString(t),r.packInt8(i),r.send(va)}(e,t,i)},infoFunc:function(){!function(e){let t=En(e);if(!t)return;let i=new BroadcastChannel("ShellShockersAdmin");i.__uv$setSource(__uv).postMessage({cmd:"getPlayer",id:t.dbId,ip:t.ip}),i.close()}(e)},reportFunc:function(t){!function(e,t){var i=bi.getBuffer();i.packInt8(Xe.reportPlayer),i.packString(e),i.packInt8(t),i.send(va),vueApp.showGenericPopup("report_confirm_title","report_confirm_message","ok")}(e,t)},social:t,vipMember:i};vueApp.showPlayerActionsPopup(n)}}function An(){br[__uv.$wrap((0))]=0,br[__uv.$wrap((1))]=0,br[__uv.$wrap((2))]=0;for(var e=[],t=0;t<playerLimit;t++)ar[__uv.$wrap((t))]&&(e.push(t),br[__uv.$wrap((ar[__uv.$wrap((t))].team))]++);xa.sortPlayerList(e);var i=document.getElementById("playerList").children;for(t=0;t<e.length;t++){var r=ar[__uv.$wrap((e[__uv.$wrap((t))]))],n=i[__uv.$wrap((t))],a=n.children[__uv.$wrap((0))],o=a.children[__uv.$wrap((0))],s=a.children[__uv.$wrap((1))],l=n.children[__uv.$wrap((1))];if(o.classList.add("playerSlot--name"),s.classList.add("playerSlot--score"),l.classList.add("playerSlot--icons"),n.style.display="block",n.style.opacity=1,o.innerText=r.name,r.id!=u){const e=!r.hideBadge&&Sn(r.social),t=r.upgradeProductId&&r.upgradeProductId>0&&!r.hideBadge;n.onclick=Pn(r.uniqueId,e,t),n.style.pointerEvents="all",n.style.cursor="pointer",r.playing||(n.style.opacity=.3)}s.innerText=r.score,a.classList.add("playerSlot--name-score");let c="playerSlot--name-score",h="playerSlot-player-is-me",d="playerSlot-player-is-them",p="";Li&&Gi===Cs.firstPerson&&r.id===Ni.playerIdx&&(p="playerSlot-spectating"),r.id==u?a.className=`${c} ${h} ${Le.meClass[__uv.$wrap((r.team))]}`:a.className=`${p} ${c} ${d} ${Le.themClass[__uv.$wrap((r.team))]}`,l.innerText="";const m=document.createElement("i"),_=document.createElement("i"),f=document.createElement("i");m.className="fas fa-egg hidden text_gold vip-egg";const g=Sn(r.social);g&&(m.className=`fab ${SOCIALMEDIA[__uv.$wrap((g.id))]} hidden`),_.className="fas fa-ban hidden",Tn(r)&&m.classList.remove("hidden"),r.muted&&_.classList.remove("hidden"),f.className="fas fa-exclamation-triangle red hidden",X===r.uniqueId&&f.classList.remove("hidden"),l.appendChild(m),l.appendChild(_),l.appendChild(f)}for(;t<playerLimit;)i[__uv.$wrap((t))].style.display="none",t++}function Mn(){if(ir){var e=document.getElementById("weaponName");e.innerHTML=ir.weapon.constructor.weaponName,(e=document.getElementById("ammo")).style.color="#fff";var t=ir.weapon.ammo,i=Math.max(Math.min(t.rounds,t.capacity),0),r=Math.max(Math.min(t.store,t.storeMax),0);e.innerHTML=i+"/"+r;for(var n=1;n<=3;n++)ir.grenadeCount>=n?document.getElementById("grenade"+n).src="img/ico_grenade.png?v=1":document.getElementById("grenade"+n).src="img/ico_grenadeEmpty.png?v=1"}}var Cn,Rn=null;function wn(){Rn=null,document.addEventListener("keydown",zn),document.addEventListener("keyup",Hn)}function In(){document.removeEventListener("keydown",zn),document.removeEventListener("keyup",Hn)}function On(e,t){if(Li)(i=W[__uv.$wrap((e))].spectate[__uv.$wrap((t))])||(i=W[__uv.$wrap((e))].game[__uv.$wrap((t))]),Gi===Cs.firstPerson&&("ARROWUP"===t&&(i="up"),"ARROWDOWN"===t&&(i="down"));else var i=W[__uv.$wrap((e))].game[__uv.$wrap((t))];return i}function Dn(e,t){(Li||ir.playing&&document.pointerLockElement)&&kn(On(e,t))}function kn(e){switch(e){case"up":case"down":case"left":case"right":case"jump":case"ascend":case"descend":Wi|=t=Lt[__uv.$wrap((e))];break;case"inspect":document.pointerLockElement&&ir&&ir.actor.inspect();break;case"melee":document.pointerLockElement&&ir&&ci.add(ci.melee),Wi|=t=Lt[__uv.$wrap((e))];break;case"fire":document.pointerLockElement&&ir&&ci.add(ci.fire),Wi|=t=Lt[__uv.$wrap((e))];break;case"grenade":document.pointerLockElement&&ir&&!Ii&&ir.canSwapOrReload()&&ir.grenadeCount>0&&(Ii=!0,nr=-.15);break;case"scope":var t=Lt[__uv.$wrap((e))];L.holdToAim?Wi|=t:ir.scope?Wi^=Wi&t:Wi|=t;break;case"reload":ci.add(ci.reload);break;case"swap_weapon":ci.add(ci.swap);break;case"toggle_freecam":Li&&(Gi===Cs.freeCamera?(Gi=Cs.firstPerson,Ni.firstPerson()):(Gi=Cs.freeCamera,Ni.freeCamera()))}}function Bn(e,t){(Li||ir.playing&&document.pointerLockElement)&&Fn(On(e,t))}function Fn(e){switch(e){case"fire":Wi^=Wi&Lt[__uv.$wrap((e))];break;case"scope":if(L.holdToAim)ir.scopeOut(),Wi^=Wi&Lt[__uv.$wrap((e))];break;case"grenade":document.pointerLockElement&&ir&&Ii&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden",Ii=!1,ir.throwGrenade(nr));break;case"up":if(Li&&Gi===Cs.firstPerson){Ni.spectateNextPlayer(-1),Wi=0;break}case"down":if(Li&&Gi===Cs.firstPerson){Ni.spectateNextPlayer(1),Wi=0;break}case"left":case"right":case"jump":case"melee":case"ascend":case"descend":Wi^=Wi&Lt[__uv.$wrap((e))]}}function Ln(e,t){var i=[` ${ka("ingame_kill_text_scrambled")} `,` ${ka("ingame_kill_text_beat")} `,` ${ka("ingame_kill_text_poached")} `,` ${ka("ingame_kill_text_whipped")} `,` ${ka("ingame_kill_text_fried")} `,` ${ka("ingame_kill_text_cracked")} `],r='<span style="color: '+Le.text[__uv.$wrap((e.team))]+'">'+e.name+"</span>"+i[__uv.$wrap((Math.randomInt(0,i.length)))]+'<span style="color: '+Le.text[__uv.$wrap((t.team))]+'">'+t.name+"</span>";(E.innerHTML.match(/<br>/g)||[]).length>4&&(E.innerHTML=E.innerHTML.substr(E.innerHTML.search("<br>")+4)),E.innerHTML+=r+"<br>"}function Nn(){canvas.focus(),S.style.display="block",S.value=ka("ingame_press_enter_to_chat"),S.style.background="transparent",S.blur(),Oi=!1}function Vn(e,t,i){const r=document.createElement("div"),n=document.createElement("span"),a=document.createElement("div"),o=document.createElement("span"),s=document.createElement("i");let l=!1,c=!1,u=!1;r.classList.add("chat-item"),a.style.display="inline-block",t&&(l=!!(t.upgradeProductId&&t.upgradeProductId>0),c=Sn(t.social),c&&!t.hideBadge?(s.classList.add("fab",SOCIALMEDIA[__uv.$wrap((c.id))]),s.classList.add("ss_marginright_xs")):l&&!t.hideBadge&&(s.classList.add("fas","fa-egg","hidden","text_gold","vip-egg"),s.classList.add("ss_marginright_xs")),u=t.uniqueId,o.classList.add("chat-player-name","ss_marginright_xs"),o.textContent=t.name+": ",a.style.color=Le.text[__uv.$wrap((t.team))],a.appendChild(s),a.appendChild(o));const h=T.querySelectorAll(".chat-item");h.length>4&&h[__uv.$wrap((0))].remove(),n.innerHTML=e,r.appendChild(a),r.appendChild(n),i&&r.classList.add("clickme"),r.classList.add("clickme"),r.onclick=()=>{u!=ir.uniqueId&&(o.classList.add("clickme"),Pn(u,c,l)()),i&&i()},T.appendChild(r),Hi&&(Hi.scrollTop=Hi.scrollHeight)}function Gn(){ir.chatLineCap>0&&(In(),S.style.background="rgba(0, 0, 0, 0.5)",S.value="",S.focus(),Rn=null,Oi=!0)}function Un(){Nn(),wn()}function zn(e){var t=(e=e||window.event).key;if(t!=Rn)if(Rn=t,Ii||0!=Wi||"Enter"!=t||!L.enableChat){Oi||"Tab"==t&&(i="ESCAPE",e.preventDefault(),function(e){Oi||V&&!he&&document.pointerLockElement&&(document.exitPointerLock(),console.log("pausing game on key: ",e))}("down"));var i=(""+t).toLocaleUpperCase();if(" "==i&&(i="SPACE",e.preventDefault()),hs){if("`"==i)return void function(){if(Cn){for(var e=0;e<playerLimit;e++){var t=ar[__uv.$wrap((e))];if(t){var i={name:t.name,hp:t.hp,playing:t.playing,posX:t.x,posY:t.y,posZ:t.z,actorX:t.actor.mesh.position.x,actorY:t.actor.mesh.position.y,actorZ:t.actor.mesh.position.z,transformEnabled:t.actor.mesh.isEnabled(),transformVisible:t.actor.mesh.isVisible,transformFrozen:t.actor.mesh.isWorldMatrixFrozen,shellEnabled:t.actor.bodyMesh.isEnabled(),shellVisible:t.actor.bodyMesh.isVisible,shellFrozen:t.actor.bodyMesh.isWorldMatrixFrozen,weaponEnabled:t.weapon.actor.gunMesh.isEnabled(),weaponVisible:t.weapon.actor.gunMesh.isVisible};Cn.document.write(JSON.stringify(i)+"\n")}}Cn.document.write("<hr>")}else(Cn=window.open("","","name=Debug")).document.write("<pre>")}();if("\\"==i){K=!0;for(var r=0;r<Ji.particleSystems.length;r++)Ji.particlesPaused=!0;for(r=0;r<playerLimit;r++)ar[__uv.$wrap((r))]&&ar[__uv.$wrap((r))].actor&&(ar[__uv.$wrap((r))].actor.mesh.setVisible(!0),ar[__uv.$wrap((r))].actor.showNameSprite(),ar[__uv.$wrap((r))].actor.positionNameSprite());va.close()}}Dn("keyboard",i)}else Gn()}function Hn(e){var t=(e=e||window.event).key;t==Rn&&(Rn=null);var i=(""+t).toLocaleUpperCase();" "==i&&(i="SPACE",e.preventDefault()),Bn("keyboard",i)}function Wn(){this.crosshairs=new t.AbstractMesh("",Ji),this.crosshairs.setEnabled(!1),this.crosshairs.position.z=2;var e=[new t.Vector3(-1,0,0),new t.Vector3(1,0,0)],i=t.MeshBuilder.CreateLines("",{points:e},Ji);i.layerMask=536870912,i.color=t.Color3.Black(),i.__uv$setSource(__uv).__uv$parent=this.crosshairs,e=[new t.Vector3(0,-1,0),new t.Vector3(0,1,0)],(i=t.MeshBuilder.CreateLines("",{points:e},Ji)).layerMask=536870912,i.color=t.Color3.Black(),i.__uv$setSource(__uv).__uv$parent=this.crosshairs}function jn(){this.mesh=new t.Mesh("hitIndicator",Ji),this.mesh.updatable=!0,this.mesh.hasVertexAlpha=!0,this.positions=[0,0,0,0,.5,0,.5,.5,0,.5,0,0,.5,-.5,0,0,-.5,0,-.5,-.5,0,-.5,0,0,-.5,.5,0];this.colors=new Array(48).fill(0);for(var e=0;e<48;e+=4)this.colors[__uv.$wrap((e))]=1,this.colors[__uv.$wrap((e+1))]=.9,this.colors[__uv.$wrap((e+2))]=0,this.colors[__uv.$wrap((e+3))]=-.5;var i=new t.VertexData;i.positions=this.positions,i.indices=[0,1,8,0,2,1,0,2,1,0,3,2,0,3,2,0,4,3,0,4,3,0,5,4,0,5,4,0,6,5,0,6,5,0,7,6,0,7,6,0,8,7,0,8,7,0,1,8],i.colors=this.colors,i.applyToMesh(this.mesh,!0),this.mesh.layerMask=536870912,this.mesh.material=Ji.getMaterialByName("ui"),this.resize()}function Xn(){this.crosshairs=[],this.shotBrackets=[];for(var e=0;e<4;e++)this.crosshairs.push(document.getElementById("crosshair"+e)),this.shotBrackets.push(document.getElementById("shotBracket"+e));this.crosshairReticle=document.getElementById("crosshairContainer"),this.readyBrackets=document.getElementById("readyBrackets"),this.shotReticle=document.getElementById("shotReticleContainer"),this.redDotReticle=document.getElementById("redDotReticle"),this.reticleDot=document.getElementById("reticleDot")}function Yn(){var e=(""==dynamicContentPrefix?parsedUrl.root:dynamicContentPrefix)+"#"+d;const t=crazysdk.inviteLink({crazyShare:d}),i=crazyGamesActive?t:e;vueApp.showShareLinkPopup(i),ue=!1}Wn.prototype.show=function(){var e=i.getRenderHeight();this.crosshairs.scaling.x=e/2,this.crosshairs.scaling.y=e/2,this.crosshairs.setEnabled(!0),document.getElementById("scopeBorder").style.display="flex",a.viewport.width=e/i.getRenderWidth(),a.viewport.x=.5-.5*a.viewport.width},Wn.prototype.hide=function(){this.crosshairs.setEnabled(!1),document.getElementById("scopeBorder").style.display="none",a.viewport.width=1,a.viewport.x=0},jn.prototype.resize=function(){this.mesh.scaling.x=i.getRenderWidth(),this.mesh.scaling.y=i.getRenderHeight()},jn.prototype.update=function(e){for(var i=7;i<48;i+=4)this.colors[__uv.$wrap((i))]-=(this.colors[__uv.$wrap((i))]+.5)/10*e;var r=Math.pow(.9,e);ir&&ir.playing&&(a.position.x*=r,a.position.z*=r),this.mesh.updateVerticesData(t.VertexBuffer.ColorKind,this.colors,!0)},jn.prototype.hit=function(e,i){var r=-Math.atan2(e,-i),n=Math.radRange(r-ir.yaw+.393);n=Math.floor(n/Math.PI2*8);var o=new t.Vector2(-this.positions[__uv.$wrap((3*n+3))],-this.positions[__uv.$wrap((3*n+4))]).normalize();a.position.x=.03*o.x,a.position.z=.03*o.y,this.colors[__uv.$wrap((4*n+7))]=2},Xn.prototype.show=function(){if(document.getElementById("reticleContainer").className="",ir.weapon.constructor.readySpread){this.readyBrackets.className="notReady";this.readyBrackets.style.width="62.5vw",this.readyBrackets.style.height="62.5vw"}else this.readyBrackets.className="hideme";this.redDotReticle.className="hideme",this.crosshairReticle.className=ir.weapon.constructor===xt?"hideme":"",this.shotReticle.className=ir.weapon.constructor===xt?"":"hideme"},Xn.prototype.hide=function(){document.getElementById("reticleContainer").className="hideme"},Xn.prototype.hideDot=function(){this.reticleDot.className="hideme"},Xn.prototype.showDot=function(){L.centerDot&&(this.reticleDot.className="")},Xn.prototype.fireDenied=function(){this.readyBrackets.className="";var e=this;setTimeout((function(){e.readyBrackets.className="notReady"}),10)},Xn.prototype.setPowerful=function(e){for(var t=0;t<4;t++){var i=this.crosshairs[__uv.$wrap((t))],r=this.shotBrackets[__uv.$wrap((t))];e?(i.classList.remove("normal"),i.classList.add("powerful"),r.classList.remove("normal"),r.classList.add("powerful")):(i.classList.add("normal"),i.classList.remove("powerful"),r.classList.add("normal"),r.classList.remove("powerful"))}},Xn.prototype.update=function(e){if(a.forwardRay=a.getForwardRay(),a.forwardRay.origin=ir.actor.eye.getAbsolutePosition(),ir.weapon){var i=ir.weapon.accuracy;if(ir.weapon.constructor===xt){var r=i*(200/a.fov);this.shotReticle.style.width=r+"vh",this.shotReticle.style.height=r+"vh"}else{r=i*(50/a.fov);for(var n=0;n<4;n++){this.crosshairs[__uv.$wrap((n))].style.transform="rotate("+90*n+"deg) translateY(calc("+r+"vh + 0.12em))"}}a.forwardRay.direction.scaleInPlace(1e3);var o=ft.rayCollidesWithMap(a.forwardRay.origin,a.forwardRay.direction,ft.projectileCollidesWithCell);if(o){var s=t.Vector3.Distance(a.forwardRay.origin,o.pick.pickedPoint);a.forwardRay.range=s,ir.weapon.constructor.minRange&&(s-.01>=ir.weapon.constructor.minRange?this.readyBrackets.className="ready":this.readyBrackets.className="notReady")}else ir.weapon.constructor.minRange&&(this.readyBrackets.className="ready"),a.forwardRay.range=1e6;ir.weapon.constructor.burst&&(a.fov-ir.weapon.actor.scopeFov<.006?this.redDotReticle.className="":this.redDotReticle.className="hideme")}},Xn.prototype.resize=function(){};function Kn(e,t){if(K)return!0;for(var i=t||e.getBoundingInfo().boundingBox.center.z,r=e.position.x-a.globalPosition.x,n=e.position.y+i-a.globalPosition.y,o=e.position.z-a.globalPosition.z,s=Math.length3(r,n,o),l=Math.normalize3({x:r,y:n,z:o},.9),c=a.globalPosition.x,u=a.globalPosition.y,h=a.globalPosition.z,d=0,p=0;p<s-.9&&(c+=l.x,u+=l.y,h+=l.z,!(c<0||c>=$i.width||h<0||h>=$i.depth||u<0||u>=$i.height));p+=.9){var m=$i.data[__uv.$wrap((Math.floor(c)))][__uv.$wrap((Math.floor(u)))][__uv.$wrap((Math.floor(h)))];if(m.idx){var _=Ft[__uv.$wrap((m.idx))];if("full"==_.colliderType&&!_.softness&&2==++d)return!1}}return!0}function Qn(){for(var e=1;e<=2;e++){document.getElementById("teamScoreNum"+e).innerText=ba.teamScore[__uv.$wrap((e))];var t=document.getElementById("teamScore"+e);ur&&(ur.controlledByTeam==e?t.classList.replace("inactive","active"):ur.lastControlTeam!=e&&t.classList.replace("active","inactive"))}}function Zn(){console.log("Event listeners removed"),canvas.style.pointerEvents="none",canvas.removeEventListener("mousedown",Or),canvas.removeEventListener("mouseup",Dr),canvas.removeEventListener("pointermove",kr),canvas.removeEventListener("wheel",Br),removeEventListener("gamepadbuttondown",qn)}function qn(e){8==e.detail&&document.exitPointerLock()}class Jn{constructor(){this.teamScore=[0,0,0],this.suppressSound=!0,this.lastLeadingTeam=1}update(){}scoreKill(e,t){}_unPackState(e){this.unPackState(e),this.suppressSound=!1}playSound(e){this.suppressSound||fi.play(e)}resetRound(){ir&&(ir.canTakeTeamBonus=!0)}getTeamWithMostKills(){let e=this.lastLeadingTeam,t=[0,0,0];for(let e=0;e<playerLimit;e++){let i=ar[__uv.$wrap((e))];i&&(t[__uv.$wrap((i.team))]+=i.score)}return t[__uv.$wrap((1))]>t[__uv.$wrap((2))]?e=1:t[__uv.$wrap((2))]>t[__uv.$wrap((1))]&&(e=2),this.lastLeadingTeam=e,e}getTeamWithHighestScore(){let e=this.lastLeadingTeam;return this.teamScore[__uv.$wrap((1))]>this.teamScore[__uv.$wrap((2))]?e=1:this.teamScore[__uv.$wrap((2))]>this.teamScore[__uv.$wrap((1))]&&(e=2),this.lastLeadingTeam=e,e}static otherTeam(e){return 1==e.team?2:1}}class $n{constructor(){}update(){}render(){}sortPlayerList(){}sortPlayerListByKills(e){e.sort((e,t)=>ar[__uv.$wrap((t))].score-ar[__uv.$wrap((e))].score)}sortPlayerListByTeamKills(e){this.sortPlayerListByKills(e);let t=ba.getTeamWithMostKills();this.sortPlayerListByLeadingTeam(e,t)}sortPlayerListByTeamScore(e){this.sortPlayerListByKills(e);let t=ba.getTeamWithHighestScore();this.sortPlayerListByLeadingTeam(e,t)}sortPlayerListByLeadingTeam(e,t){e.sort((e,i)=>ar[__uv.$wrap((i))].team==t?1:ar[__uv.$wrap((e))].team==t?-1:0)}timeToPlayVideoAd(){return null}playSound(e){ba.suppressSound||fi.play(e)}}class ea extends Jn{constructor(){super(),this.activeZone=null,this.teams=null,this.progress=null,this.numCapturing=null,this.teamsBalanced=!1,this.state=ea.state.capturing}update(){if(this.activeZone)if(this.state==ea.state.takeover)this.progress>0&&(this.progress-=ea.takeOverSpeed);else if(this.state==ea.state.capturing&&(1==this.teams||2==this.teams)){let e=ea.captureSpeeds[__uv.$wrap((this.numCapturing-1))];this.progress+=e}}unPackState(e){let t=this.activeZone;switch(this.state=e.unPackInt8U(),this.activeZone=e.unPackInt8U(),this.teams=e.unPackInt8U(),this.progress=e.unPackInt16U(),this.numCapturing=e.unPackInt8U(),this.teamScore[__uv.$wrap((1))]=e.unPackInt8U(),this.teamScore[__uv.$wrap((2))]=e.unPackInt8U(),this.state){case ea.state.win:Sr.removeAll(),vr=!0,xa.win(),this.playSound("kotc_roundend");break;case ea.state.start:if(vr&&(vr=!1,this.resetRound(),br[__uv.$wrap((1))]+br[__uv.$wrap((2))]>2)){var i=document.getElementById("gameMessage");i.innerHTML=ka("ingame_coop_shuffle"),i.className="show",setTimeout((function(){document.getElementById("gameMessage").className="hide"}),3e3)}break;case ea.state.score:this.playSound("kotc_pointscore");break;case ea.state.contested:this.playSound("kotc_contested")}this.activeZone&&this.activeZone!=t&&this.playSound("kotc_zonespawn"),xa.setCaptureState(this.teams)}}class ta extends $n{constructor(){super(),this.captureBarEl=document.getElementById("captureBar"),this.captureBarTextEl=document.getElementById("captureBarText"),this.captureIconContainer=document.getElementById("captureIconContainer"),this.captureIcon=document.getElementById("captureIcon"),this.captureRingContainer=document.getElementById("captureRingContainer"),this.captureRing=document.getElementById("captureRing"),this.captureIconCaption=document.getElementById("captureIconCaption"),this.previousCapturingTeam=0,this.teamScoreEl=[null,document.getElementById("captureScoreBlue"),document.getElementById("captureScoreRed")]}update(){if(0!=ba.activeZone){if(ba.state==ea.state.takeover){let e=Math.max(ba.progress,0);this.setBarProgress(1-e/ea.takeOverTime);let i=.5*Math.cos(qi/100%(2*Math.PI))+.5;t.Color3.LerpToRef(na[__uv.$wrap((1==ba.teams?2:1))].lightZone,ta.zoneColor.takeover,i,ta.color),Si[__uv.$wrap((ba.activeZone-1))].colorMult=ta.color}else if(1==ba.teams||2==ba.teams){let e=Math.min(ba.progress,1200);this.setBarProgress(e/1200)}if(ba.state==ea.state.contested){let e=.5*Math.cos(qi/100%(2*Math.PI))+.5;t.Color3.LerpToRef(na[__uv.$wrap((1))].lightZone,na[__uv.$wrap((2))].lightZone,e,ta.color),Si[__uv.$wrap((ba.activeZone-1))].colorMult=ta.color}if(ir&&ba.activeZone){let e=Si[__uv.$wrap((ba.activeZone-1))].capIconPosition,t=Math.length3(ir.x-e.x,ir.y-e.y,ir.z-e.z),i=Math.max(0,Math.min(.5*t-1+.5*Math.abs(ir.y-e.y+.4),.6));this.captureIconContainer.style.opacity=i,this.captureIconCaption.innerText=Math.floor(2*t)+"M"}}else"&nbsp;"!=this.captureBarTextEl.innerHTML||0!=br[__uv.$wrap((1))]&&0!=br[__uv.$wrap((2))]||(this.captureBarTextEl.innerText=ka("ingame_coop_waiting"))}render(){let e=this.captureIconContainer;if(!ba.activeZone)return void e.classList.remove("on");e.classList.add("on");let r=a.getViewMatrix().multiply(a.getProjectionMatrix()),n=Si[__uv.$wrap((ba.activeZone-1))].capIconPosition,o=i.getHardwareScalingLevel(),s=i.getRenderWidth()*o,l=i.getRenderHeight()*o,c=t.Vector3.TransformCoordinates(n,r);c.y*=-1;let u,h,d=a.getDirection(t.Vector3.Forward()),p=a.globalPosition,m=n.x-p.x,_=n.y-p.y,f=n.z-p.z,g=Math.length3(m,_,f),y=(d.x*m+d.y*_+d.z*f)/g,v=c.x,b=c.y;if(y<0){v*=-1,b*=-1,u=Math.min(1,1/Math.abs(v)),h=Math.min(1,1/Math.abs(b)),v*=h,b*=u,Math.abs(v)>Math.abs(b)?v=Math.sign(v):b=Math.sign(b)}else u=Math.min(1,1/Math.abs(v)),h=Math.min(1,1/Math.abs(b)),v*=h,b*=u;v=v*(s/2)+s/2,b=b*(l/2)+l/2,v=Math.max(Math.min(v,.9*s),.1*s),b=Math.max(Math.min(b,.9*l),.1*l),e.style.transform="translate("+v+"px,"+b+"px)"}setCaptureState(e){this.teamScoreEl[__uv.$wrap((1))].innerText=ba.teamScore[__uv.$wrap((1))]+" / "+ea.goalScore,this.teamScoreEl[__uv.$wrap((2))].innerText=ba.teamScore[__uv.$wrap((2))]+" / "+ea.goalScore;let t=null;switch(ba.activeZone&&(t=Si[__uv.$wrap((ba.activeZone-1))]),ba.state){case ea.state.win:this.captureBarTextEl.innerText=ka("ingame_coop_nextround"),this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.previousCapturingTeam=0;break;case ea.state.score:case ea.state.start:this.captureBarTextEl.innerHTML="&nbsp;",this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.previousCapturingTeam=0;break;case ea.state.unclaimed:this.captureBarTextEl.innerText=ka("ingame_coop_find"),this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),t.colorMult=ta.zoneColor.unclaimed;break;case ea.state.capturing:var i=["","blue","red"];this.captureBarTextEl.innerText=ka(na[__uv.$wrap((e))].name).toUpperCase()+" "+ka("ingame_coop_capturing")+" ("+ba.numCapturing+"X)",this.captureBarEl.className=i[__uv.$wrap((e))],this.captureRing.className=i[__uv.$wrap((e))],this.captureIcon.setAttribute("class",i[__uv.$wrap((e))]),e>0&&e!=this.previousCapturingTeam&&(this.previousCapturingTeam=e,ir.team==e?this.playSound("kotc_capturing_player"):this.playSound("kotc_capturing_opponents")),t.colorMult=na[__uv.$wrap((e))].lightZone;break;case ea.state.abandoned:i=["","blueAbandoned","redAbandoned"];this.captureBarTextEl.innerText=ka(na[__uv.$wrap((e))].name).toUpperCase()+" "+ka("ingame_coop_capturing"),this.captureBarEl.className=i[__uv.$wrap((e))],this.captureRing.className=i[__uv.$wrap((e))],this.captureIcon.setAttribute("class",i[__uv.$wrap((e))]),t.colorMult=na[__uv.$wrap((e))].darkZone;break;case ea.state.contested:this.captureBarTextEl.innerText=ka("ingame_coop_contested"),this.captureBarEl.className="contested",this.captureRing.className="contested",this.captureIcon.setAttribute("class","contested");break;case ea.state.takeover:this.captureBarTextEl.innerText=ka("ingame_coop_takeover"),this.captureBarEl.className="takeover",this.captureRing.className="takeover",this.captureIcon.setAttribute("class","takeover")}for(let e=0;e<Si.length;e++){Si[__uv.$wrap((e))].visibility=ba.activeZone==e+1}}setBarProgress(e){this.captureBarEl.style.transform="scaleX("+e+")";let t=100*(1-e);this.captureRingContainer.style.transform="translateY("+t+"%)",this.captureRing.style.transform="translateY("+-t+"%)"}win(){this.setCaptureState(0);let e=document.getElementById("bigMessageContainer");e.style.display="block";let t=ba.teamScore[__uv.$wrap((1))]>ba.teamScore[__uv.$wrap((2))]?1:2;document.documentElement.style.setProperty("--ss-big-message-border-color",na[__uv.$wrap((t))].lightColor),document.getElementById("bigMessage").innerHTML='<span class="bigMessageText" style="color: var(--ss-big-message-border-color)">'+ka(na[__uv.$wrap((t))].name).toUpperCase()+'</span><span class="bigMessageText">&nbsp;'+ka("ingame_coop_win")+"</span>",t==ir.team&&ir.canTakeTeamBonus?document.getElementById("bigMessageCaption").innerHTML=ka("ingame_coop_bonus")+' +250 <img src="img/ico_goldenEgg.png" style="height: 2em; vertical-align: text-top" />':document.getElementById("bigMessageCaption").innerHTML=ka("ingame_coop_nextroundbig"),setTimeout(()=>{e.style.display="none"},5e3)}timeToPlayVideoAd(){return 4!==ba.teamScore[__uv.$wrap((1))]&&4!==ba.teamScore[__uv.$wrap((2))]&&null}sortPlayerList(e){this.sortPlayerListByTeamScore(e)}}function ia(e){return getComputedStyle(document.documentElement).getPropertyValue(e)}function ra(e){let i=ia(e);return i=i.match(/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(,\s*\d+\.*\d+)?\)\s*$/),t.Color3.FromInts(i[__uv.$wrap((1))],i[__uv.$wrap((2))],i[__uv.$wrap((3))])}ta.zoneColor={unclaimed:new t.Color3(.3,.3,.3),takeover:new t.Color3(.8,.8,.8)},ta.color=new t.Color3;const na=[null,{name:"team_blue",lightColor:ia("--ss-team-blue-light"),darkColor:ia("--ss-team-blue-dark"),lightZone:ra("--ss-team-blue-light"),darkZone:ra("--ss-team-blue-dark")},{name:"team_red",lightColor:ia("--ss-team-red-light"),darkColor:ia("--ss-team-red-dark"),lightZone:ra("--ss-team-red-light"),darkZone:ra("--ss-team-red-dark")}];var aa=[{logic:class extends Jn{constructor(){super()}},ui:class extends $n{constructor(){super()}sortPlayerList(e){this.sortPlayerListByKills(e)}}},{logic:class extends Jn{constructor(){super()}scoreKill(e){this.teamScore[__uv.$wrap((e))]++}unPackState(e){this.teamScore[__uv.$wrap((1))]=e.unPackInt16U(),this.teamScore[__uv.$wrap((2))]=e.unPackInt16U()}},ui:class extends $n{constructor(){super()}sortPlayerList(e){this.sortPlayerListByTeamKills(e)}}},{logic:class extends Jn{constructor(){super()}scoreKill(e,t){ur.actor||ur.controlledBy!=t.id||ur.drop();var i=Jn.otherTeam(t);ur.controlledByTeam==i&&(this.teamScore[__uv.$wrap((i))]++,Qn())}unPackState(e){this.teamScore[__uv.$wrap((1))]=e.unPackInt16U(),this.teamScore[__uv.$wrap((2))]=e.unPackInt16U();let t={x:e.unPackFloat(),y:e.unPackFloat(),z:e.unPackFloat()},i=e.unPackInt8U(),r=e.unPackInt8U();if(ur){if(ur.controlledBy!=i){var n=["",'<h1 class="blueTeam">'+vueApp.loc.team_blue+"</h1>",'<h1 class="redTeam">'+vueApp.loc.team_red+"</h1>"];if(255==i){if(ir.playing)(a=document.getElementById("gameMessage")).innerHTML=n[__uv.$wrap((ur.controlledByTeam))],a.innerHTML+=ka("ingame_dropped_the_spatula"),a.className="show",setTimeout((function(){document.getElementById("gameMessage").className="hide"}),3e3);ur.drop(t)}else{var a;if(ir.playing)(a=document.getElementById("gameMessage")).innerHTML=n[__uv.$wrap((r))],a.innerHTML+=ka("ingame_captured_the_spatula"),a.className="show",setTimeout((function(){document.getElementById("gameMessage").className="hide"}),3e3);ur.capture(ar[__uv.$wrap((i))])}}}else(ur=new ti(Ji,t)).controlledBy=i,ur.controlledByTeam=r;Qn()}},ui:class extends $n{constructor(){super()}sortPlayerList(e){this.sortPlayerListByTeamScore(e)}}},{logic:ea,ui:ta}];function oa(e){return H.isItemOwned(e)}function sa(){let e=H.getEquippedItems();e[__uv.$wrap((st.Grenade))]=null,e[__uv.$wrap((st.Melee))]=null,U.posingItems={[st.Primary]:null,[st.Secondary]:null,[st.Grenade]:null,[st.Melee]:null,[st.Hat]:null,[st.Stamp]:null},U.poseWithItems(e),U.poseWithColor(H.colorIdx)}function la(){new Date,H=new Zo;const e=localStore.getItem("localLoadOut");if(e){const t=JSON.parse(e);vueApp.$nextTick(()=>H.applyLocalLoadout(t.items))}console.log("Start account search with Firebase..."),parsedUrl.query.sandbox&&firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION),firebase.auth().onAuthStateChanged((function(e){te&&!hasValue(e)||(e?(($=e).isAnonymous?(console.log("Firebase: anonymous user"),J=$,_e||!0):(console.log("Firebase: auth provider: "+$.providerData[__uv.$wrap((0))].providerId),$.emailVerified||"password"!=$.providerData[__uv.$wrap((0))].providerId||(console.log("Firebase: email not yet verified"),Ie=!0)),ca()):(console.log("Firebase: no account found"),console.log("No account created yet :("),ee=!1,k=!0,_e=!1,Oa(),vueApp.authCompleted()))}))}function ca(){if(!ee&&(ee=!0,te=!1,_e=!0,$.getIdToken(!0).then(e=>{!function(e,t,i,r){hi({cmd:"auth",firebaseToken:e},t,i,r)}(e,da,pa,ma)}).catch((function(e){console.log(e),ee=!1})),$.providerData.length>0&&$.providerData[__uv.$wrap((0))].providerId,$.photoURL&&$.providerData&&$.providerData.length>0)){var e=$.photoURL;vueApp.photoUrl=e}}window.console=function(e){window.console&&e||(e={});var t=[];return{dir:function(){e.dir&&e.dir.apply(e,arguments)},log:function(){this.addLog(arguments),e.log&&e.log.apply(e,arguments)},warn:function(){this.addLog(arguments),e.warn&&e.warn.apply(e,arguments)},error:function(){this.addLog(arguments),e.error&&e.error.apply(e,arguments)},info:function(){this.addLog(arguments),e.info&&e.info.apply(e,arguments)},addLog:function(e){var i=e[__uv.$wrap((0))];"object"==typeof i&&(i=JSON.stringify(i)),t.push(i),t.length>100&&t.shift()},logArray:function(){return t},clearLog:function(){t=[]},debug:function(t){e.log(t)}}}(window.console);let ua=null;function ha(){console.log("sending Firebase email verification"),$.sendEmailVerification()}function da(e){if(e.hasOwnProperty("banRemaining")){let t,i=e.banRemaining.split(":"),r=parseInt(i[__uv.$wrap((0))]),n=parseInt(i[__uv.$wrap((1))]);t=r>24?`${Math.floor(r/24)} ${ka("time_days")}`:r>0?`${r} ${ka("time_hours")}`:`${n} ${ka("time_minutes")}`,vueApp.showBannedPopup(t)}else e.error?console.log("accountDataResponse Error: "+JSON.stringify(accountDataResponse.error)):(H.signedIn($,e),vueApp.authCompleted(),k=!0,setTimeout(()=>H.syncToServer(),1e3),ai(),be&&(we&&(Ca(),we=!1),Oa()),null!==J?ga("set","vip_status","NoVIP"):(parsedUrl.query.signInPrompt&&parsedUrl.query.closeAfterSign&&window.close(),function(e,t){hi({cmd:"getPlayerSubStatus",playerId:H.id},t=>{e&&e(t)},e=>{t&&t()})}(e=>{null===e.outData?ga("set","vip_status","NoVIP"):e.outData[__uv.$wrap((0))].hasOwnProperty("active")&&e.outData[__uv.$wrap((0))].active?ga("set","vip_status","IsVIP"):ga("set","vip_status","WasVIP")},e=>console.log("api_getPlayerSubStatus error",e)),function(e,t){hi({cmd:"checkTwitchEntitlements",playerId:H.id,firebaseId:H.firebaseId},e,t)}(e=>{switch(console.log("Twitch Entitlements status",e),e.status){case"SUCCESS":e.eggsGiven>0&&di();let t=[];hasValue(e.itemIds)&&e.itemIds.length>0&&(t=G.findItemsByIds(e.itemIds),t.forEach(e=>{H.isItemOwned(e)||(H.inventory.push(e),console.log("Reward item given, id: "+e.id))})),vueApp.showGiveStuffPopup("give_stuff_twitch_title",e.eggsGiven,t,e.type);break;case"ACCOUNT_DEACTIVATED":console.log("Twitch ACCOUNT_DEACTIVATED")}},e=>console.log("api_twitchPlayerEntitlements error",e))),console.log("Signed in"),_e||null===ua||(console.log("Nonaccount is now anon. Time for play"),_e=!0,ja(!1),Xa(ua)));!1}function pa(){console.log("authorization failed"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.signIn,vueData.googleAnalytics.label.signInAuthFailed),Ht.hide(),vueApp.authCompleted()}function ma(e){console.log("auth ws closed, code: "+e),1006!==e?ee=!1:vueApp.showGenericPopup("signin_failed_title","signin_failed","ok")}function _a(){q||(q=new firebaseui.auth.AuthUI(firebase.auth()));var e={autoUpgradeAnonymousUsers:!0,callbacks:{signInSuccessWithAuthResult:fa,signInFailure:ya,uiShown:function(e){console.log("UI: showed firebase UI");const t=document.querySelector(".firebaseui-idp-list");if(t){const e=document.createElement("li"),i=document.createElement("button"),r=document.createElement("span"),n=document.createElement("img"),a=document.createElement("span");i.onclick=()=>{vueApp.fbTransferAccountSignin()},i.className="firebaseui-idp-button mdl-button mdl-js-button mdl-button--raised firebaseui-idp-facebook firebaseui-id-idp-button",i.style.backgroundColor="#3b5998",a.className="firebaseui-idp-text firebaseui-idp-text-long",a.textContent="Sign in with Facebook",r.className="firebaseui-idp-icon-wrapper",n.className="firebaseui-idp-icon",n.src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg",e.className="firebaseui-list-item",r.appendChild(n),i.appendChild(r),i.appendChild(a),e.appendChild(i),t.appendChild(e)}}},credentialHelper:firebaseui.auth.CredentialHelper.NONE,signInFlow:"popup",signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1},firebase.auth.GoogleAuthProvider.PROVIDER_ID],tosUrl:"http://www.bluewizard.com/terms"};q.start("#firebaseui-auth-container",e),be=!0}function fa(e,t){var i=($=e.user).emailVerified,r=(e.credential,e.additionalUserInfo.isNewUser,e.additionalUserInfo.providerId);e.operationType;return vueApp.hideFirebaseSignIn(),"password"!=r||i||ha(),console.log("Authing Firebase ID"),ca(),!1}function ya(e){if(vueApp.hideFirebaseSignIn(),console.log("Firebase: sign in failure, error code: "+e.code),"firebaseui/anonymous-upgrade-merge-conflict"!==e.code)return Promise.resolve();te=!0,firebase.auth().signInWithCredential(e.credential),J.delete(),setTimeout(()=>{vueApp.$nextTick(()=>{vueApp.urlParamSet=!!vueApp.urlParams||null,vueApp.shellShockUrlParamaterEvents()})},2e3)}var va,ba,xa,Sa;function Ta(e){let t="",i=document.createElement("canvas").getContext("webgl");t+=i.getParameter(i.VERSION);let r=i.getExtension("WEBGL_debug_renderer_info");null!=r&&(t+=i.getParameter(r.UNMASKED_RENDERER_WEBGL),t+=i.getParameter(r.UNMASKED_VENDOR_WEBGL)),t+=navigator.userAgent+navigator.language,Pe=1;for(let e in t)Pe=Pe*t.charCodeAt(e)%Number.MAX_SAFE_INTEGER;Pe+=(navigator.hardwareConcurrency+navigator.maxTouchPoints)%Number.MAX_SAFE_INTEGER;firebase.initializeApp({apiKey:"AIzaSyDP4SIjKaw6A4c-zvfYxICpbEjn1rRnN50",authDomain:"shellshockio-181719.firebaseapp.com",databaseURL:"https://shellshockio-181719.firebaseio.com",projectId:"shellshockio-181719",storageBucket:"shellshockio-181719.appspot.com",messagingSenderId:"68327206324"}),parsedUrl.query.testMap&&(z=!0),l=getStoredString("lastVersionPlayed",Ge),localStore.setItem("lastVersionPlayed",Ge),I=getStoredString("languageSelected",null);const n=hasValue(I)?I:Ea();h=getStoredNumber("gameType",Ze.filter(e=>"Spatula"===e.shortName)[__uv.$wrap((0))].value),l&&l!=Ge?za():(La(),(ye=new ls).init(),(G=new _t).getPremiumGunMeshNames(),Wo.connect(),es(),Ma(),function(){let e=getStoredString("selectedLanguage",null);if(!hasValue(e))return;let t=Ea();"en"!==e&&e===t&&(console.log("Updating to new localStore for language setting"),localStore.setItem("languageSelected",t),ga("send","event",{eventCategory:vueData.googleAnalytics.cat.playerStats,eventAction:vueData.googleAnalytics.action.langBeforeUpdate,eventLabel:e}));localStore.removeItem("selectedLanguage"),console.log("selectedLanguage item removed")}(),vueData.maps=Ct,Da(n,startVue))}function Ea(){let e=de.includes("-")?de.split("-")[__uv.$wrap((0))].toLowerCase():de,t=vueData.languages,i=null;for(let r=0;r<t.length;r++)if(t[__uv.$wrap((r))].code===e){i=!0;break}return hasValue(i)?e:"en"}function Pa(){(Oe=new ui).init()}function Aa(){return hasValue(vueApp)&&vueApp.ready&&D&&k&&B}function Ma(){Aa()?function(){if(z)return;var e=document.getElementById("onesignal-bell-container");e&&(e.style.display="none");(function(){const e=document.getElementById("changelog-link");e&&e.addEventListener("click",e=>{e.preventDefault(),vueApp.hideChangelogPopup(),vueApp.showScavengerHuntPopup(),ga("send","event","changelog","clicked","showScavengerHuntPopup")})})(),Pa(),N=Oe.isAdBlocking(),ga("send","event","ads","ad blocker",N.toString()),sa(),Wo.getRegions().then(()=>{var t;Ko(),!0,function e(){if(!isFromEU)return;if(xo>8)return;"undefined"!=typeof googletag?((O=localStore.getItem("consent"))?(O=JSON.parse(O),googletag.consented=O&&O.ofAge&&O.targetedAds||!isFromEU,vueApp.setPrivacySettings(O.ofAge,O.targetedAds)):(O={ofAge:!1,targetedAds:!1},vueApp.showGdprNotification()),console.log("AIP consent: "+googletag.consented)):setTimeout(()=>{xo++,e()},1e3)}(),t=getStoredString("lastUsername",Ba()),vueApp.setPlayerName(t),function(){parsedUrl.hash&&parsedUrl.query.observe?(console.log("TRYING TO JOIN GAME AUTOMATICALLY",parsedUrl.hash),j=!0,X=parsedUrl.query.watchPlayer):j=!1;const e="crazyShare"in parsedUrl.query;if(!parsedUrl.hash&&!e)return!1;const t=e?parsedUrl.query.crazyShare:parsedUrl.hash;return vueApp.showJoinPrivateGamePopup(t),!0}()||Ra()||function(){var e=new URLSearchParams(document.__uv$setSource(__uv).__uv$location.search);if(!e.has("invoice_id")&&!localStore.getItem("xsollaPurchase"))return!1;localStore.removeItem("xsollaPurchase"),window.history.replaceState(null,null,"/"),t=e.get("invoice_id"),i=e=>{if("SUCCESS"===e.result&&(e.details.item_id||e.details.amount)){let t=null;if(e.details.item_id){const i=G.findItemById(e.details.item_id);t=H.isItemOwned(i)?i:null}return t&&vueApp.showItem(t),vueApp.showGiveStuffPopup("give_stuff_twitch_title",e.details.amount,hasValue(t)?[t]:t),!0}return!1},r=e=>!1,hi({cmd:"checkAfterStorePurchase",playerId:H.id,transactionId:t},i,r);var t,i,r}()||function(){if(!1===new URLSearchParams(document.__uv$setSource(__uv).__uv$location.search).has("signInPrompt"))return!1;return _a(),vueApp.$refs.firebaseSignInPopup.show(),!0}()||function(){let e;const t=new URLSearchParams(document.__uv$setSource(__uv).__uv$location.search);if(Be.forEach(i=>{t.has(i)&&(e=i)}),!hasValue(e))return!1;console.log("tryUrlParam reward",e);let i=Date.now();const r=localStore.getItem(e);if(hasValue(r)){const t=Number(r)+432e6;if(i<t)return console.log(e+" reward already given!"),!1}function n(t){uo(t,{success(){localStore.setItem(e,i)},prevGiven(){this.success()},expired(){this.succces()},playerNotFound(){vueApp.showGenericPopup("player_not_found_title","player_not_found_desc","ok")},error(){this.playerNotFound()},default(){this.playerNotFound()}})}return function(e,t,i){hi({cmd:"urlRewardParams",reward:e,firebaseId:H.firebaseId},t,i)}(e,n,(function(){console.log(e,"error")})),!0}()||function(){var e=new URLSearchParams(document.__uv$setSource(__uv).__uv$location.search);if(!1===e.has("showItem"))return!1;var t=parseInt(e.get("showItem"));if(!1===(Number.isInteger(t)&&null!==G.findItemById(t)&&!0))return!1;var i=G.findItemById(t);return vueApp.showItemOnEquipScreen(i),!0}()||wa()||function(){if(ve)return vueApp.vipEndedPopup(),!0;return!1}()||Ia()||function(){var e=new URLSearchParams(document.__uv$setSource(__uv).__uv$location.search);if(!e.has("purchase"))return!1;if(H.isAnonymous)return vueApp.showGenericPopup("uh_oh","anon_account","ok"),!1;var t=e.get("purchase");return vueApp.showPopupEggStoreSingle(t),!0}()||function(){var e=new URLSearchParams(document.__uv$setSource(__uv).__uv$location.search);if(!1===e.has("storeItem"))return!1;vueApp.showPopupEggStoreSingle(e.get("storeItem"))}(),function(){if(!_e)return!0;if(H.isItemOwned({id:16020}))return vueApp.hasMobileReward=!0,!0}(),mi(e=>{e.length>0&&1===e[__uv.$wrap((0))].type&&(vueApp.doubleEggWeekend=!0)},()=>console.log("scheduledEventError")),vueApp.hideSpinner(),Ht.hide(),e&&(e.style.display="none"),console.log("After Game Ready"),vueApp.shellShockUrlParamaterEvents(),function(e,t){hi({cmd:"player_notifications",firebase_id:H.firebaseId},e,t)}(e=>{if("SUCCESS"===e.result&&!e.read){const t=()=>setTimeout(()=>function(e,t){hi({cmd:"notify_mark_as_complete",firebase_id:H.firebaseId},e,t)}(()=>console.log("Notifications: SUCCESS"),()=>console.log("Notification: ERROR")),500),i=[];Object.entries(e.data.type).forEach(t=>{const r=e.data.type[__uv.$wrap((t[__uv.$wrap((0))]))].ids,n=e.data.type[__uv.$wrap((t[__uv.$wrap((0))]))].eggs;(r.length>0||n>0)&&(e.data.type[__uv.$wrap((t[__uv.$wrap((0))]))].items=r.length>0?G.findItemsByIds([...new Set(r)]):[],i.push({type:t[__uv.$wrap((0))],data:e.data.type[__uv.$wrap((t[__uv.$wrap((0))]))]}))}),i.length>0&&!e.data.read&&vueApp.showPurchasesPopup(i,t)}},(e,t)=>{t&&console.log("Notification check error",t,e)}),ga("send","timing","load","homeLoaded",Math.round(performance.now()),"home"),vueApp.showTitleScreenAd()})}():setTimeout(Ma,200)}function Ca(){return!!we&&(vueApp.ui.bonus.showing=!0,vueApp.showPurchasesPopup([{type:"currency",data:{ids:[],items:[],eggs:vueApp.ui.bonus.amount}}]),!0)}function Ra(){if(Ie)return Ie=!1,void vueApp.showResendEmail();Ca()}function wa(e){return null!==(ae=e||ae)&&(vueApp.showTaggedItemsOnEquipScreen(ae),!0)}function Ia(){if(null===oe||H.isUpgraded())return!1;vueApp.showChicknWinnerPopup(),oe=null}function Oa(){const e=["lastPreRoll","localLoadOut","showBigAd","lastUsername"];vueApp.ui.socialMedia.footer.forEach(t=>e.push(t.reward+"Rewarded")),e.push(...Be),e.forEach(e=>{localStore.getItem(e)&&localStore.removeItem(e)})}function Da(e,t){fetch(("language/{0}.json?"+Ge).format(e)).then((function(i){i.json().then((function(i){t(e,i)}))}))}function ka(e){return vueData.loc[__uv.$wrap((e))]||"["+e+"]"}function Ba(){var e,t=["Captain","Lord","Supreme","Master","Pro","Noob"],i=["Egg","Yolk","Shell","Cluck","Chick","Bird"];do{e=Math.randomInt(1,99)}while(69==e);return 0==Math.randomInt(0,2)?t[__uv.$wrap((Math.randomInt(0,t.length)))]+i[__uv.$wrap((Math.randomInt(0,i.length)))]+e:i[__uv.$wrap((Math.randomInt(0,i.length)))]+t[__uv.$wrap((Math.randomInt(0,t.length)))]+e}let Fa=null;function La(){clearTimeout(Fa),Fa=setTimeout(()=>(Fa=null,console.log("%cSTOP!","color:red; font-size:60px; font-weight: bold; text-shadow: 0 0 2px black;"),void console.log("%cThis is a browser feature intended for developers. If someone told you to copy and paste something here, there is a good chance that they are attempting to gain access to your account and personal information!","font-size: 18px;")),500),canvas&&(canvas.style.width="100%",canvas.style.height="100%"),i&&(i.resize(),L&&L.highRes&&i.setHardwareScalingLevel(L.highRes)),V&&(Fi&&Fi.resize(),Bi&&Bi.resize())}function Na(){s&&Ja.clear(s),console.log("Auto detail enabled"),s=Ja.set(()=>{g/y<40&&i.getFps()<40&&(Ji.shadowsEnabled?(Ua(!1),L.shadows=!1):(Ga(!1),L.highRes=!1,Va()),bs())},4e3)}function Va(){s&&(Ja.clear(s),s=null)}function Ga(e){console.log("setting high resolution: "+e),i.setHardwareScalingLevel(e?1:2),function(){Bi&&Bi.resize();Fi&&Fi.resize();ki&&ki.crosshairs.isEnabled()&&ki.show()}()}function Ua(e){console.log("setting shadows: "+e),Ji.shadowsEnabled=e,e?cr&&V&&(cr.material=Ji.getMaterialByName("map")):cr&&V&&(cr.material=Ji.getMaterialByName("mapNoShadow"))}function za(){var e=window.indexedDB.deleteDatabase("babylonjs");e.onerror=function(e){window.__uv$setSource(__uv).__uv$location.reload(!0)},e.onsuccess=function(e){window.__uv$setSource(__uv).__uv$location.reload(!0)}}function Ha(){i.resize()}function Wa(e){H.syncToServer(e)}function ja(e){Se=e,vueApp.disablePlayButton(e)}function Xa(e){if(!Se){if(ja(!0),U.scale(),m=getStoredNumber("timesPlayed",0),_e&&localStore.setItem("timesPlayed",m+1),!ge){var t=getStoredNumber("lastPreRoll",0);0==t&&(t=Date.now(),localStore.setItem("lastPreRoll",t));const i=pokiActive?0:24e4;if(se&&!pwaBlockAds||Date.now()>t+i&&m>1&&!pwaBlockAds)return console.log("play() calls PVA"),Oe.play("shellshock.io_preroll",()=>Ya(e)),void vueApp.hideTitleScreenAd()}Ya(e)}}function Ya(e){if(console.log("play(): "+JSON.stringify(e)),vueApp.setDarkOverlay(!1),vueApp.showSpinner("connecting","please_wait",!0),vueApp.showLoadingScreenAd(),!_e)return console.log("Create account now."),Me=!0,vueApp.onTutorialPopupClick(),ga("send","event","tutorial","newUserPopup"),void function(e){vueApp.showSpinner("connecting","please_wait"),firebase.auth().signInAnonymously().then(()=>{firebase.auth().onAuthStateChanged(t=>{_e=!0,!0,null!==t&&e&&t.isAnonymous&&(_e=!1,ua=e)})}).catch((function(e){console.debug("Failed Firebase anonymous signin, code: {0}, msg: {1}".format(e.code,e.message))}))}(e);hasValue(e.playerName)&&0!==e.playerName.length&&!/^ *$/.test(e.playerName)||(e.playerName=Ba(),vueApp.setPlayerName(e.playerName)),localStore.setItem("lastUsername",e.playerName),e.playType===vueApp.playTypes.joinPrivate?Wo.joinPrivateGame(e).then(t=>{P=t.private,e.subdomain=t.subdomain,e.id=t.id,d=t.id,e.uuid=t.uuid,vueApp.currentRegionId=t.region,Ka(e)}).catch(e=>qa(e)):Wo.findGame(e).then(t=>{P=t.private,e.subdomain=t.subdomain,e.id=t.id,d=t.id,e.uuid=t.uuid,vueApp.currentRegionId=t.region,Ka(e)}).catch(e=>{Wo.getRegions().then(()=>Ko()),qa(e)})}function Ka(e){console.log("prepareToJoinGame",e),document.body.scrollTop=document.documentElement.scrollTop=0,F=performance.now(),vueApp.hideTitleScreenAd(),function(e){vueApp.mediaTabsCancelRotate(),console.log("joinGame(), params: "+JSON.stringify(e)),Za=null,e.playerName=ro(e.playerName,80),ue=!1,e.playType===vueApp.playTypes.createPrivate?(console.log("create private game"),ue=!0):e.playType===vueApp.playTypes.joinPrivate&&console.log("join private game");e.playType;let t=0;!function i(){let r=(isHttps()?"wss":"ws")+"://"+Qa(e.subdomain)+"/game/"+e.id;console.log("Connecting to: "+r),(va=new WebSocket(r)).binaryType="arraybuffer",va.onopen=function(e){console.log("WebSocket opened")},va.onclose=function(e){e.code===We.sessionNotFound?(console.log(`Connect attempt #${t} - code: ${e.code}`),++t>10?qa(e.code):setTimeout(i,1e3)):qa(e.code)},va.onmessage=function(t){switch(mr.init(t.data),cmd=mr.unPackInt8U(),cmd){case Xe.socketReady:ga("send","event","play game","class",Nt[__uv.$wrap((H.classIdx))].name);const t=getStoredBool("hideBadge",0)?1:0;!function(){ho("primaryGun",H.getPrimaryWeapon().name),ho("SecondaryGun",H.getSecondaryWeapon().name),"undefined"!=typeof EGGCOLOR&&ho("eggColor",Object.keys(EGGCOLOR).find(e=>EGGCOLOR[__uv.$wrap((e))]===H.colorIdx));null!==H.hatItem&&ho("hat",H.hatItem.name);null!==H.stampItem&&ho("stamp",H.stampItem.name);null!==H.grenadeItem&&H.grenadeItem.hasOwnProperty("name")&&ho("grenade",H.grenadeItem.name)}();var i=bi.getBuffer();j?i.packInt8(Xe.observeGame):i.packInt8(Xe.joinGame),i.packInt8(H.classIdx),i.packString(e.playerName),i.packString(e.uuid),i.packInt8(t),H.firebaseId&&(i.packInt32(H.session),i.packString(H.firebaseId),i.packString(H.sessionId)),i.send(va);break;case Xe.musicInfo:var r=mr.unPackLongString();cn(r);break;case Xe.gameJoined:console.log("CommCode.gameJoined received"),teamScore=[0,0,0],u=mr.unPackInt8U(),w=mr.unPackInt8U(),h=mr.unPackInt8U(),p=mr.unPackInt8U(),playerLimit=mr.unPackInt8U(),C=1==mr.unPackInt8U();mr.unPackInt8U(),mr.unPackInt8U();let n=aa[__uv.$wrap((h))];ba=new n.logic,xa=new n.ui,Qn(),h==Qe.teams||h==Qe.ctf,console.log("game joined: game type:  "+h),vueApp.gameJoined(h,w),console.log("is game owner: "+C),V=!0,vueApp.setInGame(V);const a=vueData.gameTypes.find(({value:e})=>e===h);A=e.playType===vueApp.playTypes.createPrivate?"createPrivate":P?"joinPrivate":""!==e.joinCode?"joinPublicByInvite":"joinPublic",Ce=new ri,eo=!1,ga("send","event",vueData.googleAnalytics.cat.play,A,"Map - "+Ct[__uv.$wrap((p))].name),ga("send","event",vueData.googleAnalytics.cat.play,A,"Game type - "+a.locKey),ga("send","event",vueData.googleAnalytics.cat.play,A,vueData.googleAnalytics.action.playerLimit,playerLimit),ga("send","event",vueData.googleAnalytics.cat.play,A,vueData.googleAnalytics.action.timesPlayed,m),Pr()}}}()}(e)}function Qa(e){let t=dynamicContentRoot||window.__uv$setSource(__uv).__uv$location.hostname;return t=t.split("."),t.length>2&&(t=t.slice(-2)),t=t.join("."),`${e}.${t}`}document.onfullscreenchange=Ha,document.onmsfullscreenchange=Ha,document.onmozfullscreenchange=Ha,document.onwebkitfullscreenchange=Ha;var Za=null;function qa(e){if(ja(!1),vueApp.mediaTabsStartRotate(),mi(e=>{0===e.length?vueApp.doubleEggWeekend=!1:e[__uv.$wrap((0))].type},()=>console.log("scheduledEventError")),K)return;let t=!1;switch(Object.keys(We).forEach(i=>{We[__uv.$wrap((i))]===e&&(console.log("Socket Closed: "+i),t=!0)}),t||console.log("Socket Closed: "+e),e){case We.uuidNotFound:console.log("UUID invalid"),ga("send","event","Websocket","onclose","UUID not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect","session_expired_msg","ok");break;case We.sessionNotFound:console.log("Session not found"),ga("send","event","Websocket","onclose","Session not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect","session_expired_msg","ok");break;case We.gameNotFound:console.log("Game not found"),ga("send","event","Websocket","onclose","Game not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_not_found","game_not_found_msg","ok");break;case We.gameFull:case We.gameMaxPlayersExceeded:console.log("Game full"),ga("send","event","Websocket","onclose","Game full"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_full","game_full_msg","ok");break;case We.mainMenu:ga("send","event","Websocket","onclose","Return to main menu");break;case We.regionFull:ga("send","event","Websocket","onclose","Region full"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case We.clusterFullCpu:ga("send","event","Websocket","onclose","Game Cluster max CPU"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case We.clusterFullMem:ga("send","event","Websocket","onclose","Game Cluster max RAM"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case We.booted:V?vueApp.leaveGame():vueApp.hideSpinner(),vueApp.showGenericPopup("connection_lost","booted","ok");break;case We.gameIdleExceeded:vueApp.leaveGame(),vueApp.showGenericPopup("connection_lost","inactivity","ok");break;default:if(V)ga("send","event","Websocket","onclose","Connection Lost"),vueApp.leaveGame(),vueApp.showGenericPopup("connection_lost","connection_lost_msg","ok");else{var i="";switch(Za){case Xe.loginRequired:i="login_required";break;default:i="generic_conn_failed"}vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect",i,"ok")}}}var Ja={intervals:{},set:function(e,t){var i=setInterval.apply(window,[e,t].concat([].slice.call(arguments,2)));return Ja.intervals[__uv.$wrap((i))]=!0,i},clear:function(e){return delete Ja.intervals[__uv.$wrap((e))],clearInterval(e)},clearAll:function(){for(var e=Object.keys(Ja.intervals),t=e.length;t-- >0;)clearInterval(e.shift());Ja.intervals={}}},$a={timeouts:{},set:function(e,t){var i=setTimeout.apply(window,[e,t].concat([].slice.call(arguments,2)));return $a.timeouts[__uv.$wrap((i))]=!0,i},clear:function(e){return delete $a.timeouts[__uv.$wrap((e))],clearTimeout(e)},clearAll:function(){for(var e=Object.keys($a.timeouts),t=e.length;t-- >0;)clearTimeout(e.shift());$a.timeouts={}}};var eo=!1;function to(e){if(ir&&(Ce.kills>0||Ce.deaths>0)){const t="player stats",i=Nt[__uv.$wrap((ir.charClass))].name;0===Ce.kills&&Ce.deaths>0?ga("send","event",t,"rageQuit",i,Ce.deaths):ga("send","event",t,"best kill streak",i,Yi),e&&e()}}function io(){f>10&&(ga("send","timing","game","ping",Math.floor(_/f),vueData.currentRegionId),ga("send","event","game","stats","fps",Math.ceil(g/y)))}function ro(e,t){t=t||80;var i=ce.getContext("2d");for(i.font="1em Nunito, sans-serif";;){if(i.measureText(e).width<t)break;e=e.substr(0,e.length-1)}return e}const no=[{start:688,end:879},{start:6832,end:6911},{start:7424,end:7679},{start:8352,end:11263},{start:43392,end:43487},{start:57344,end:63743},{start:64256,end:65023},{start:65056,end:65071},{start:65136,end:65279},{start:65520,end:65535}];function ao(e){let t="";for(let i of e){let e=i.codePointAt(0),r=!0;if(e>65535||21325==e||21328==e)r=!1;else for(let t of no)e>=t.start&&e<=t.end&&(r=!1);r&&(t+=i)}return t}var oo,so,lo=["dGV4dENvbnRlbnQ=","b2JzZXJ2ZQ==","TXV0YXRpb25PYnNlcnZlcg==","bGVuZ3Ro","dGFyZ2V0","b3V0ZXJUZXh0"];oo=lo,so=458,function(e){for(;--e;)oo.push(oo.shift())}(++so);var co=function(e,t){var i,r=lo[__uv.$wrap((e-=0))];void 0===co.IFPkJC&&((i=function(){var e;try{e=Function('return (function() {}.constructor("return this")( ));')()}catch(t){e=window}return e}()).atob||(i.atob=function(e){for(var t,i,r=String(e).replace(/=+$/,""),n="",a=0,o=0;i=r.charAt(o++);~i&&(t=a%4?64*t+i:i,a++%4)?n+=String.fromCharCode(255&t>>(-2*a&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return n}),co.vaQvzy=function(e){for(var t=atob(e),i=[],r=0,n=t.length;r<n;r++)i+="%"+("00"+t.charCodeAt(r).toString(16)).slice(-2);return decodeURIComponent(i)},co.QEYrQv={},co.IFPkJC=!0);var n=co.QEYrQv[__uv.$wrap((e))];return void 0===n?(r=co.vaQvzy(r),co.QEYrQv[__uv.$wrap((e))]=r):r=n,r};function uo(e,t,i){let r=i||"reward_title";if(hasValue(t.name)||(t.name="Game reward"),e.error)console.log(t.name+" Error: "+JSON.stringify(e.error));else switch(console.log(t.name+" response: "+e.result),e.result){case"SUCCESS":void 0!==t.success&&t.success();var n=0;hasValue(e.eggsGiven)&&e.eggsGiven>0&&(n=e.eggsGiven,di());var a=[];hasValue(e.itemIds)&&e.itemIds.length>0&&(a=G.findItemsByIds(e.itemIds)).forEach(e=>{H.isItemOwned(e)||(H.inventory.push(e),console.log(t.name+" Reward item given, id: "+e.id))}),vueApp.showGiveStuffPopup(r,n,a,i);break;case"REWARD_PREV_GIVEN":void 0!==t.prevGiven&&t.prevGiven(),vueApp.showGenericPopup("uh_oh","reward_already","ok");break;case"REWARD_EXPIRED":void 0!==t.expired&&t.expired(),vueApp.showGenericPopup("uh_oh","reward_expired","ok");break;case"REWARD_NOT_FOUND":void 0!==t.notFound&&t.notFound(),vueApp.showGenericPopup("uh_oh","reward_not_found","ok");break;case"PLAYER_NOT_FOUND":void 0!==t.playerNotFound&&t.playerNotFound();break;case"ERROR":void 0!==t.error&&t.error(),console.log(t.name+" error: "+e.error),vueApp.showGenericPopup("uh_oh","error","ok");break;default:void 0!==t.default&&allbacks.default(),vueApp.showGenericPopup("uh_oh","error","ok")}}function ho(e,t){return ga("send","event","play game",e,t)}new(window[__uv.$wrap((co("0x0")))])(e=>{for(var t=0;t<e[__uv.$wrap((co("0x1")))];t++){var i=e[__uv.$wrap((t))];(i[__uv.$wrap((co("0x2")))][__uv.$wrap((co("0x3")))][__uv.$wrap((co("0x1")))]>3e6||i.target[__uv.$wrap((co("0x4")))].length>3e6)&&255}})[__uv.$wrap((co("0x5")))](document,{childList:!0,subtree:!0});const po=()=>window.self===window.__uv$setSource(__uv).__uv$top,mo=()=>{const e=window.__uv$setSource(__uv).__uv$location!=window.__uv$setSource(__uv).__uv$parent.__uv$setSource(__uv).__uv$location?document.referrer:document.__uv$setSource(__uv).__uv$location.href,t=new URL(e).hostname.replace(/(www.)/,"").split(".");if(!Array.isArray(t)&&!t.length)return!1;return{domain:t,index:t.length-2}};function _o(){!function(e,t){hi({cmd:"updatePlayerStats",playerId:H.id},e,t)}((function(e){e&&(H.setStats(e.statsLifetime,e.statsCurrent),H.eggsSpent=e.eggsSpent,H.eggsSpentMonthly=e.eggsSpentMonthly),vueApp.statsLoading()}),(function(e){console.log("Player stats error",e),vueApp.statsLoading()}))}function fo(e,t,i,r){H.isItemOwned({id:e})?console.log(t,"already owned!!!"):((e,t,i)=>{hi({cmd:"urlRewardParams",reward:e,firebaseId:H.firebaseId},t,i)})(t,e=>{uo(e,{name:t,success(){i&&i()},error(){r&&r()}},t)},e=>{console.log(t," error",e)})}function go(){return Ce?Ce.getStats():{}}function yo(){vueApp.openPhotoBooth()}var vo;vo=0;class bo{static init(){this.getGamepads=(navigator.getGamepads||navigator.webkitGetGamepads).bind(navigator),this.getGamepads?(this.index=null,this.buttonThreshold=.1,this.assist=1,bo.detectControllerType(getStoredString("controllerId",ka("p_settings_nocontroller"))),addEventListener("gamepadconnected",e=>{this.buttonState=[],this.lastMoveX=0,this.lastMoveZ=0,this.index=e.gamepad.index;var t=navigator.getGamepads()[__uv.$wrap((e.gamepad.index))];console.log("Gamepad connected at index: "+t.index+": "+t.id+". It has "+t.buttons.length+" buttons and "+t.axes.length+" axes."),ga("send","event","game","settings","controller connected",t.id),addEventListener("gamepadbuttondown",this.onButtonDown),addEventListener("gamepadbuttonup",this.onButtonUp),bo.detectControllerType(t.id),this.poll(),this.assistInterval=setInterval(bo.calculateAssist,67)}),addEventListener("gamepaddisconnected",e=>{e.gamepad.index==this.index&&(cancelAnimationFrame(this.pollLoop),clearInterval(this.assistInterval),this.index=null,removeEventListener("gamepadbuttondown",this.onButtonDown),removeEventListener("gamepadbuttonup",this.onButtonUp),console.log("Gamepad disconnected"),bo.detectControllerType(ka("p_settings_nocontroller")))})):console.log("Gamepad API not detected")}static detectControllerType(e){/xbox|xinput/i.test(e)?vueData.controllerType="xbox":/54c/i.test(e)?vueData.controllerType="ps":/pro controller/i.test(e)?vueData.controllerType="switchpro":vueData.controllerType="generic",vueData.controllerId=e,localStore.setItem("controllerId",e)}static applyDeadZone(e){if(isNaN(e))return 0;var t=L.deadzone,i=(Math.abs(e)-t)/(1-t);return i<0&&(i=0),i*(e>0?1:-1)}static poll(){var e=bo.getGamepads()[__uv.$wrap((bo.index))];if(e){if(ir&&ir.playing&&document.pointerLockElement||Li){var t=bo.calculateAssist(),i=.0025*L.controllerSpeed+.005;ir.scope&&(i*=.2,t*=2);var r=bo.applyDeadZone(e.axes[__uv.$wrap((2))]),n=bo.applyDeadZone(e.axes[__uv.$wrap((3))]);Math.length2(r,n);i*=t,ir.yaw=Math.radAdd(ir.yaw,r*i),ir.pitch=Math.max(Math.min(ir.pitch+n*L.controllerInvert*i,1.5),-1.5);var a=bo.applyDeadZone(e.axes[__uv.$wrap((0))]),o=bo.applyDeadZone(e.axes[__uv.$wrap((1))]);a<0&&bo.lastMoveX>=0?kn("left"):a>=0&&bo.lastMoveX<0&&Fn("left"),a>0&&bo.lastMoveX<=0?kn("right"):a<=0&&bo.lastMoveX>0&&Fn("right"),o<0&&bo.lastMoveZ>=0?kn("up"):o>=0&&bo.lastMoveZ<0&&Fn("up"),o>0&&bo.lastMoveZ<=0?kn("down"):o<=0&&bo.lastMoveZ>0&&Fn("down"),bo.lastMoveX=a,bo.lastMoveZ=o}for(var s in e.buttons)e.buttons[__uv.$wrap((s))].value>bo.buttonThreshold&&!bo.buttonState[__uv.$wrap((s))]?(bo.buttonState[__uv.$wrap((s))]=!0,dispatchEvent(new CustomEvent("gamepadbuttondown",{detail:s}))):e.buttons[__uv.$wrap((s))].value<=bo.buttonThreshold&&bo.buttonState[__uv.$wrap((s))]&&(bo.buttonState[__uv.$wrap((s))]=!1,dispatchEvent(new CustomEvent("gamepadbuttonup",{detail:s})))}bo.pollLoop=requestAnimationFrame(bo.poll)}static calculateAssist(){if(!ir||!ir.playing)return 1;var e=bo.v1,i=bo.v2,r=a.forwardRay.origin,n=a.forwardRay.direction,o=null,s=null,l=1e7;for(var c of ar)if(c&&c.id!=u&&c.playing&&c.actor&&c.actor.mesh.isVisible&&(0==c.team||c.team!=ir.team)){var h=t.Vector3.Distance(c.actor.mesh.position,r);e.copyFrom(c.actor.mesh.position),e.y+=.3,e.subtractToRef(r,i),i.normalize(),n.normalize();var d=(1-t.Vector3.Dot(i,n))*h*.5;h<a.forwardRay.range+1&&d<=.05&&h<l&&(o=c,l=h,s=d)}return o?Math.max(20*s,.2):1}static onButtonDown(e){ir&&Dn("gamepad",e.detail)}static onButtonUp(e){ir&&Bn("gamepad",e.detail)}}bo.v1=new t.Vector3,bo.v2=new t.Vector3;let xo=0;!function(e,t,i,r,n,a,o){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,a=t.createElement(i),o=t.getElementsByTagName(i)[__uv.$wrap((0))],a.async=1,a.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(a,o),a.onload=function(){window.ga&&ga.create&&(So=window.ga,window.ga=To)}}(window,document,"script",0,"ga");var So=window.ga,To=function(){So.apply(window,arguments);var e=arguments[__uv.$wrap((0))];switch(e){case"create":break;case"set":var t=arguments[__uv.$wrap((1))],i=arguments[__uv.$wrap((2))],r={};r[__uv.$wrap((t))]=i,gtag("set","user_properties",r);break;case"send":var n={hitType:arguments[__uv.$wrap((1))]};switch(n.hitType){case"pageview":gtag("pageview",{page_location:__uv.$get(location).href});break;case"event":"object"==typeof arguments[__uv.$wrap((2))]?n=Object.assign(n,arguments[__uv.$wrap((2))]):(n.eventCategory=arguments[__uv.$wrap((2))],n.eventAction=arguments[__uv.$wrap((3))],n.eventLabel=arguments[__uv.$wrap((4))],n.eventValue=arguments[__uv.$wrap((5))],"object"==typeof arguments[__uv.$wrap((6))]&&(n=Object.assign(n,arguments[__uv.$wrap((6))]))),gtag("event",n.eventAction,n);break;case"timing":n.timingCategory=arguments[__uv.$wrap((2))],n.timingVar=arguments[__uv.$wrap((3))],n.timingValue=arguments[__uv.$wrap((4))],n.timingLabel=arguments[__uv.$wrap((5))],gtag("event","timing_complete",n)}}};window.ga=To,ga("set","anonymizeIp",!isFromEU),ga("create","UA-105800112-1",{cookieDomain:"auto",siteSpeedSampleRate:10,cookieFlags:"samesite=none;secure"}),ga("send","pageview"),ga("set","account","web");const Eo=(e,t)=>{t=t||"event",e.forEach(e=>{ga("send",t,{eventCategory:e[__uv.$wrap((0))],eventAction:e[__uv.$wrap((1))],eventLabel:e[__uv.$wrap((2))],eventValue:e[__uv.$wrap((3))]})})},Po=(e,t)=>{t=t||"";let i=Date.now()-e;ga("send","timing","game","play time",i),fbq("trackCustom","EndGame",{timePlayed:i}),t&&ga("send","timing","Maps",t,i)};var Ao=[new t.Color3(1,1,0),new t.Color3(0,.5,1),new t.Color3(1,0,0)];function Mo(e){this.grenade=e,this.scene=e.scene,this.meshes={};for(let e=0;e<G.grenades.length;e++){let t=G.grenades[__uv.$wrap((e))],i=ut(t.item_data.meshName,this.scene);i.material=this.scene.getMaterialByName("emissive"),this.meshes[__uv.$wrap((t.id))]=i,i.setEnabled(!1)}this.mesh=null,this.beep=!1,this.flashColor=null}Mo.prototype.dispose=function(){for(let e of Object.values(this.meshes))e.dispose()},Mo.prototype.throw=function(){this.mesh=this.meshes[__uv.$wrap((this.grenade.player.grenadeItem.id))],this.mesh.setEnabled(!0),this.mesh.position.x=this.grenade.x,this.mesh.position.y=this.grenade.y,this.mesh.position.z=this.grenade.z,this.grenade.player.id==u?this.flashColor=Ao[__uv.$wrap((0))]:this.flashColor=Ao[__uv.$wrap((this.grenade.player.team))],Ti.play("grenade_pin",this.mesh.position),this.bounce()},Mo.prototype.update=function(e){this.grenade.resting||(this.mesh.position.x+=.5*(this.grenade.x-this.mesh.position.x),this.mesh.position.y+=.5*(this.grenade.y-this.mesh.position.y),this.mesh.position.z+=.5*(this.grenade.z-this.mesh.position.z),this.mesh.rotation.x+=this.rx,this.mesh.rotation.y+=this.ry,this.mesh.rotation.z+=this.rz),Math.sqrt(2*this.grenade.ttl)%2>1?(0==this.beep&&(Ti.play("grenade_beep",this.mesh.position),this.beep=!0),this.mesh.emissiveColor=this.flashColor):(this.mesh.emissiveColor=t.Color3.Black(),this.beep=!1)},Mo.prototype.remove=function(){this.mesh.setEnabled(!1)},Mo.prototype.bounce=function(){var e=Math.length3(this.grenade.dx,this.grenade.dy,this.grenade.dz);this.rx=(2*Math.random()-1)*e,this.ry=(2*Math.random()-1)*e,this.rz=(2*Math.random()-1)*e},Mo.prototype.stop=function(){this.rx=0,this.ry=0,this.rz=0};class Co{constructor(e,t){this.gun=e,this.meshName=t,this.scene=e.scene,this.standardMeshName=e.constructor.standardMeshName,this.playerActor=e.player.actor,this.skeleton=ht("gun_"+this.standardMeshName+"_skeleton",this.scene),this.roundsFired=0,this.dryFireSound="gun_eggk47_dry_fire"}setup(e){this.gunMesh=ut(this.meshName,this.scene,this.playerActor.gunContainer),this.gunMesh.material=dt("standard",this.scene),this.gunMesh.skeleton=this.skeleton,this.gunMesh.setEnabled(!1),e&&(this.muzzleFlash=ut("muzzleFlash",this.scene,this.playerActor.gunContainer),this.muzzleFlash.material=dt("muzzleFlash",this.scene),this.muzzleFlash.setEnabled(!1),this.muzzleFlash.position.x=.25,this.muzzleFlash.position.z=e,this.muzzleFlash.scaling.copyFromFloats(.7,.7,.7)),this.gun.player.id==u&&(this.gunMesh.setRenderingGroupId(2),this.muzzleFlash&&this.muzzleFlash.setRenderingGroupId(2))}addSoundEvent(e,i,r){i+=this.skeleton.getAnimationRange(e).from;var n=new t.AnimationEvent(i,function(e,t){return function(){Ti.play(e,t,!0)}}(r,this.gun.player.actor.mesh.position));this.skeleton.bones[__uv.$wrap((0))].animations[__uv.$wrap((0))].addEvent(n)}dispose(){this.gunMesh.dispose()}inspect(){this.skeleton.beginAnimation("inspect")}restPose(){let e=this.skeleton;var t=e.getAnimationRange("fire");void 0!==Ji&&Ji.beginAnimation(e,t.from,t.from)}stow(){Ti.play("weapon_swap",this.gun.player.actor.mesh.position,!0),this.scene.beginAnimation(this.playerActor.gunContainer,0,25,!1,1,()=>{this.gunMesh.setEnabled(!1),this.gun.equip()})}equip(e){this.gun.player.meleeWeapon.actor.weaponMesh.setEnabled(!1),this.playerActor.setWeaponSkeleton(this.skeleton),this.playerActor.gunContainer.setEnabled(!1),this.scene.beginAnimation(this.playerActor.gunContainer,30,55,!1,e||1),this.gunMesh.setEnabled(!0),this.roundsFired=0,setTimeout(()=>{this.playerActor.gunContainer.setEnabled(!0)},1)}dryFire(){Ti.play(this.dryFireSound,this.gun.player.actor.mesh.position,!0)}denyFire(){Bi.fireDenied(),Ti.play(this.dryFireSound,this.gun.player.actor.mesh.position,!0),Ti.play(this.denyFireSound,this.gun.player.actor.mesh.position,!0)}fire(){if(this.gun.constructor.burst&&this.roundsFired%this.gun.constructor.burst!=0||(this.fireSound&&Ti.play(this.fireSound,this.gun.player.actor.mesh.position,!0),this.skeleton.beginAnimation("fire")),this.roundsFired++,this.muzzleFlash){this.muzzleFlash.rotation.z=3.141*Math.random(),this.muzzleFlash.setEnabled(!0);var e=this;setTimeout((function(){e.muzzleFlash.setEnabled(!1)}),33)}}reload(){this.gun.longReloadTime==this.gun.shortReloadTime?this.skeleton.beginAnimation("reload",!1,this.gun.constructor.reloadTimeMod):this.gun.ammo.rounds>0?this.skeleton.beginAnimation("shortReload",!1,this.gun.constructor.reloadTimeMod):this.skeleton.beginAnimation("longReload",!1,this.gun.constructor.reloadTimeMod)}getFireSound(e,t,i){if(ke[__uv.$wrap((e))].includes(t)){const e=t+"_fire";return fi.sounds[__uv.$wrap((e))]?e:i}return i}update(){}}class Ro extends Co{constructor(e,t){super(e,t),this.scopeFov=.9,this.scopeY=.0438,this.setup(.6),this.fireSound=this.getFireSound("Soldier",t,"gun_eggk47_fire"),this.addSoundEvent("shortReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",123,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",123,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",155,"gun_eggk47_full_cycle")}}class wo extends Co{constructor(e,t){super(e,t),this.scopeFov=1,this.scopeY=.072,this.setup(.6),this.fireSound=this.getFireSound("Scrambler",t,"gun_dozenGauge_fire"),this.addSoundEvent("reload",0,"gun_dozenGauge_open"),this.addSoundEvent("reload",80,"gun_dozenGauge_load"),this.addSoundEvent("reload",115,"gun_dozenGauge_close")}}class Io extends Co{constructor(e,t){super(e,t),this.scopeFov=.5,this.scopeY=.0345,this.setup(.6),this.fireSound=this.getFireSound("Ranger",t,"gun_csg1_fire"),this.addSoundEvent("shortReload",25,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",125,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_csg1_pull_action"),this.addSoundEvent("longReload",75,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",160,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",190,"gun_csg1_release_action")}}class Oo extends Co{constructor(e,t){super(e,t),this.scopeFov=1.1,this.scopeY=.069,this.setup(.48),this.fireSound=this.getFireSound("Secondary",t,"gun_cluck9mm_fire"),this.addSoundEvent("shortReload",15,"gun_cluck9mm_remove_mag"),this.addSoundEvent("shortReload",110,"gun_cluck9mm_insert_mag"),this.addSoundEvent("longReload",15,"gun_cluck9mm_remove_mag"),this.addSoundEvent("longReload",110,"gun_cluck9mm_insert_mag"),this.addSoundEvent("longReload",155,"gun_eggk47_full_cycle")}}class Do extends Co{constructor(e,t){super(e,t),this.scopeFov=.9,this.scopeY=.1-.0862,this.setup(.51),this.fireSound=this.getFireSound("Eggsploder",t,"gun_rpegg_fire"),this.denyFireSound="gun_rpegg_deny_fire",this.addSoundEvent("reload",115,"gun_rpegg_load")}}class ko extends Co{constructor(e,t){super(e,t),this.scopeFov=1,this.scopeY=.1-.09635,this.setup(.55),this.fireSound=this.getFireSound("Whipper",t,"gun_smg_fire"),this.addSoundEvent("shortReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",150,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",150,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",185,"gun_smg_cycle")}}class Bo extends Co{constructor(e,t){super(e,t),this.scopeFov=.4,this.scopeY=.1-.03507,this.setup(.6),this.fireSound=this.getFireSound("Crackshot",t,"gun_m24_fire"),this.addSoundEvent("reload",10,"gun_m24_bolt_open"),this.addSoundEvent("reload",75,"gun_eggk47_insert_mag"),this.addSoundEvent("reload",94,"gun_m24_bolt_close")}}class Fo extends Co{constructor(e,t){super(e,t),this.scopeFov=.7,this.scopeY=.0385,this.setup(.6),this.fireSound=this.getFireSound("TriHard",t,"gun_aug_fire"),this.addSoundEvent("shortReload",28,"gun_aug_remove_mag"),this.addSoundEvent("shortReload",118,"gun_aug_insert_mag"),this.addSoundEvent("longReload",28,"gun_aug_remove_mag"),this.addSoundEvent("longReload",118,"gun_aug_insert_mag"),this.addSoundEvent("longReload",153,"gun_aug_cycle")}}function Lo(e,t){getRequest(e+"?"+Date.now(),(e,i)=>{let r=[];if(404===e)console.log("Accept it and move on.");else try{const e=JSON.parse(i);e.length>0&&e.forEach(e=>r.push(e))}catch(e){console.log("News request error: ",e)}t(r)})}function No(e){if(e.link&&window.open(e.link,"_window"),e.linksToTaggedItems&&(ae=e.linksToTaggedItems,wa()),e.linksToItemId){isString(e.linksToItemId)&&(e.linksToItemId=parseInt(e.linksToItemId,10));var t=G.findItemById(e.linksToItemId);vueApp.showItemOnEquipScreen(t)}e.linksToNugget&&(oe=!0,Ia()),e.linksToPhotoBooth&&yo(),e.linksToEggStoreItem&&(vueApp.eggStoreReferral="Splash ad ref",vueApp.showPopupEggStoreSingle(e.linksToEggStoreItem)),e.linksToVipStore&&vueApp.showSubStorePopup(),e.linksToKotc&&vueApp.showKotcInstrucPopup()}function Vo(e){this.kind=e,this.scene=Ji}function Go(){Vo.call(this,zo.AMMO),this.mesh=this.scene.getMeshByName("ammo").createInstance(""),this.mesh.setEnabled(!1),n&&n.getShadowMap().renderList.push(this.mesh)}function Uo(){Vo.call(this,zo.GRENADE),this.mesh=this.scene.getMeshByName("grenadeItem").createInstance(""),this.mesh.setEnabled(!1),n&&n.getShadowMap().renderList.push(this.mesh)}function zo(){this.pools=[new Ut((function(){return new zo.Constructors[__uv.$wrap((zo.AMMO))]}),100),new Ut((function(){return new zo.Constructors[__uv.$wrap((zo.GRENADE))]}),20)]}function Ho(){this.scene=new t.Scene(i),this.scene.clearColor=new t.Color4(0,0,0,0),this.canvas=i.getRenderingCanvas(),this.scene.sunLight={direction:new t.Vector3(.2,1,.1),diffuse:new t.Color3.White},this.meshRenderStaging={},Xt(this.scene),this.camera=new t.ArcRotateCamera("",0,0,0,new t.Vector3(0,0,0),this.scene),this.scene.activeCameras.push(this.camera),this.camera.fov=.5,this.camera.maxZ=100,this.camera.minZ=.01,this.stampSprites=new t.SpriteManager("","img/stamps.png?v="+Ge,1024,128,this.scene),this.stampSprite=new t.Sprite("",this.stampSprites),this.stampSprite.size=1}Vo.prototype.update=function(e){this.mesh.rotation.y+=.03*e},Vo.prototype.remove=function(){this.mesh.setEnabled(!1)},Go.prototype=Object.create(Vo.prototype),Go.prototype.constructor=Vo,Uo.prototype=Object.create(Vo.prototype),Uo.prototype.constructor=Vo,zo.AMMO=0,zo.GRENADE=1,zo.Constructors=[Go,Uo],zo.prototype.update=function(e){for(var t=0;t<this.pools.length;t++)this.pools[__uv.$wrap((t))].forEachActive((function(t){t.update(e),t.mesh.isVisible=Kn(t.mesh)}))},zo.prototype.spawnItem=function(e,t,i,r,n){var a=this.pools[__uv.$wrap((t))].retrieve(e);a.mesh.setEnabled(!0),a.mesh.position.x=i,a.mesh.position.y=r,a.mesh.position.z=n,Z&&a.mesh.freezeWorldMatrix()},zo.prototype.collectItem=function(e,t){var i=this.pools[__uv.$wrap((e))];i.recycle(i.objects[__uv.$wrap((t))]),i.objects[__uv.$wrap((t))].remove()},zo.prototype.recycleAllItems=function(){for(var e=this,t=0;t<this.pools.length;t++)this.pools[__uv.$wrap((t))].forEachActive((function(i){e.pools[__uv.$wrap((t))].recycle(i),i.remove()}))},Ho.prototype.renderToCanvas=function(e,t,i){let r=e.item_data.meshName;this.camera.alpha=0,this.camera.beta=Math.PI90;var n=ut(r,this.scene);n.layerMask=1,this.camera.layerMask=1,n.computeWorldMatrix(),this.camera.computeWorldMatrix();let a=this.meshRenderStaging[__uv.$wrap((r))];n.position.copyFrom(a.position),n.rotation.copyFrom(a.rotation),this.camera.radius=a.radius,this.scene.render(),n.dispose();var o=t.getContext("2d");o.clearRect(0,0,256,256),o.drawImage(this.canvas,(this.canvas.width-this.canvas.height)/2,0,this.canvas.height,this.canvas.height,0,0,256,256),this.camera.layerMask=0,this.scene.render(),i&&i()},Ho.prototype.renderStampToCanvas=function(e,t,i){var r=e.item_data.x,n=e.item_data.y;this.stampSprites.layerMask=2,this.camera.layerMask=2,this.stampSprite.cellIndex=r+32*n,this.camera.alpha=0,this.camera.beta=0,this.camera.radius=2.5,this.scene.render();var a=t.getContext("2d");a.clearRect(0,0,256,256),a.drawImage(this.canvas,(this.canvas.width-this.canvas.height)/2,0,this.canvas.height,this.canvas.height,0,0,256,256),this.camera.layerMask=0,this.scene.render(),i&&i()},Ho.prototype.calculateItemAlignments=function(){let e=[...G.hats,...G.grenades,...G.melee];for(let t=0;t<lt.length;t++)e.push(...G.forClass[__uv.$wrap((t))].forWeaponSlot[__uv.$wrap((at))]),e.push(...G.forClass[__uv.$wrap((t))].forWeaponSlot[__uv.$wrap((ot))]);this.camera.alpha=0,this.camera.beta=Math.PI90,this.camera.radius=1,i.setSize(256,256);for(let u of e){let e=u.item_data.meshName,h=ut(e,this.scene);var r=h.getVerticesData(t.VertexBuffer.PositionKind);if(!r){alert(h.name+" is referenced in items.js, but is missing mesh data");continue}let d;switch(u.item_type_id){case st.Hat:d={radius:1.3,rotation:new t.Vector3(.25,2,0),position:new t.Vector3(0,-.25,0)};break;case st.Grenade:d={radius:.4,rotation:new t.Vector3(0,-1.3,0),position:new t.Vector3(0,-.01,0)};break;case st.Melee:d={radius:.4,rotation:new t.Vector3(-.5,4,-1.2),position:new t.Vector3(0,.02,.12)};break;case st.Primary:d={radius:1.3,rotation:new t.Vector3(-.7,0,0),position:new t.Vector3(0,-.1,-.1)};break;case st.Secondary:d={radius:1,rotation:new t.Vector3(0,0,0),position:new t.Vector3(0,.05,-.32)}}if(h.position.copyFrom(d.position),h.rotation.copyFrom(d.rotation),h.computeWorldMatrix(),this.camera.radius=d.radius,u.item_type_id!==st.Grenade){this.scene.updateTransformMatrix();for(var n={x:1e4,y:1e4},a={x:-1e4,y:-1e4},o=0;o<r.length;o+=3){var s=t.Vector3.Project(new t.Vector3(r[__uv.$wrap((o))],r[__uv.$wrap((o+1))],r[__uv.$wrap((o+2))]),h.getWorldMatrix(),this.scene.getTransformMatrix(),this.camera.viewport.toGlobal(i));n.x=Math.min(n.x,s.x),a.x=Math.max(a.x,s.x),n.y=Math.min(n.y,s.y),a.y=Math.max(a.y,s.y)}var l=(a.x+n.x)/2-128,c=(a.y+n.y)/2-128;d.position.z-=l/512,d.position.y+=c/512}h.dispose(),this.meshRenderStaging[__uv.$wrap((e))]=d}La()};class Wo{static connect(){return new Promise((e,t)=>{var i=dynamicContentRoot||__uv.$get(location).host,r=(isHttps()?"wss":"ws")+"://"+i+"/matchmaker/";this.ws=new cs(r),this.ws.onopen=()=>{e(this.ws)},this.ws.onmessage=e=>this.handleMatchmakerMessage(e),this.ws.onerror=()=>{}})}static getRegions(){return new Promise((e,t)=>{this.ws.send('{ "command": "regionList" }'),this.ws.onmessage=t=>{let i=JSON.parse(t.data);switch(i.command){case"regionList":this.ws.onerror=e=>{},this.regionList=i.regionList;for(let e of this.regionList)e.locKey="server_"+e.id,e.ping=null;vueApp.regionList=this.regionList,e();break;default:this.handleMatchmakerMessage(t)}},this.ws.onerror=e=>{t(e),this.handleError(e)}})}static joinPrivateGame(e){return new Promise((t,i)=>{let r={command:"joinGame",id:e.joinCode.toUpperCase(),observe:e.observe,sessionId:H.sessionId};this.ws.send(JSON.stringify(r)),this.ws.onmessage=e=>{let r=JSON.parse(e.data);if(r.error)i(We[__uv.$wrap((r.error))]);else switch(r.command){case"gameFound":this.ws.onerror=e=>{},t(r);break;default:this.handleMatchmakerMessage(e)}},this.ws.onerror=e=>{i(e),this.handleError(e)}})}static findGame(e){return new Promise((t,i)=>{let r={command:"findGame",region:vueApp.currentRegionId,playType:e.playType,gameType:e.gameType,sessionId:H.sessionId};e.playType===vueData.playTypes.createPrivate&&(r.map=e.mapIdx),this.ws.send(JSON.stringify(r)),this.ws.onmessage=e=>{let r=JSON.parse(e.data);if(r.error)i(We[__uv.$wrap((r.error))]);else switch(r.command){case"gameFound":this.ws.onerror=e=>{},t(r);break;default:this.handleMatchmakerMessage(e)}},this.ws.onerror=e=>{i(e),this.handleError(e)}})}static handleMatchmakerMessage(e){let t=JSON.parse(e.data);switch(t.command){case"notice":this.handleNotices(t.notices)}}static handleNotices(e){Object.keys(e).forEach(t=>{switch(t){case"announcement":vueData.announcementMessage=e[__uv.$wrap((t))];break;case"version":if(e[__uv.$wrap((t))]!==Ge)if(localStorage.getItem("cacheNuked")){console.log("Wrong client version");let e=setInterval(()=>{vueApp&&(clearInterval(e),vueApp.showGenericPopup("wrong_version","wrong_version_msg","ok"))},100)}else localStorage.setItem("cacheNuked",!0),za();else localStorage.removeItem("cacheNuked")}})}static handleError(e){this.ws.onerror=e=>{},Ht.hide(),vueApp.hideSpinner(),console.log("Failed to connect to Matchmaker",e),vueApp.showGenericPopup("matchmaker_offline","matchmaker_offline_msg","ok")}}class jo{constructor(e,t){this.weapon=e,this.meshName=t,this.scene=e.scene,this.player=e.player,this.playerActor=e.player.actor,this.skeleton=ht("melee_skeleton",this.scene),this.weaponMesh=ut(this.meshName,this.scene,this.playerActor.gunContainer),this.weaponMesh.skeleton=this.skeleton,this.weaponMesh.material=dt("standard",this.scene),this.weaponMesh.setEnabled(!1),this.swingSounds=this.getSwingSounds(t),this.weapon.player.id==u&&this.weaponMesh.setRenderingGroupId(2)}getSwingSounds(e){return ke.Melee.includes(e)?Object.keys(fi.sounds).filter(t=>t.match(/(\w+)/g)[__uv.$wrap((0))]==e):["melee_whisk_a","melee_whisk_b"]}dispose(){this.weaponMesh.dispose()}stow(){this.weaponMesh.setEnabled(!1)}attack(){this.skeleton.beginAnimation("melee"),setTimeout(()=>{let e=Math.randomInt(0,this.swingSounds.length);Ti.play(this.swingSounds[__uv.$wrap((e))],this.playerActor.mesh.position,!0)},68)}}function Xo(){this.posingItems={[st.Primary]:null,[st.Secondary]:null,[st.Grenade]:null,[st.Melee]:null,[st.Hat]:null,[st.Stamp]:null},this.grenadeOnHip=!1,this.camX=0,this.camY=.35,this.camRadius=3.4,this.rotY=0,this.rotX=0,this.jump=0,this.turnCountdown=60,this.buyingItem=null,this.autoUpdate=!0,this.scaleSizes=[1,1.25,1.5],this.dmg=100,this.setupScene(),this.onResourcesLoaded()}Xo.prototype.onResourcesLoaded=function(){var e=this;this.startRendering();try{var i=H.getPrimaryWeapon().item_data.meshName;function r(t){this.scene=e.scene,this.id=-1,this.name="",this.x=0,this.y=0,this.z=0,this.hp=100,this.hatItem=H.hatItem,this.stampItem=H.stampItem,this.shellColor=H.colorIdx,this.meleeItem=H.meleeItem,this.actor=new Jo(this),this.actor.mesh.rotation.y=e.rotY,this.meleeWeapon=new kt(this),this.weapon=new Nt[__uv.$wrap((t))].weapon(this,i)}this.dualAvatar=new r(H.classIdx),this.dualAvatar.actor.bodyMesh.setEnabled(!1),this.dualAvatar.actor.hands.material.backFaceCulling=!1,this.dualAvatar.actor.foreBone.setScale(t.Vector3.Zero()),this.dualAvatar.actor.setupStowAnims(0,!0),this.dualAvatar.weapon.actor.equip(),this.avatar=new r(H.classIdx),this.avatar.actor.foreBone.setScale(t.Vector3.Zero()),this.avatar.actor.setupStowAnims(0),this.avatar.weapon.actor.equip();var n=Date.now();this.scene.registerBeforeRender((function(){var t=Date.now(),i=t-n;n=t,i/=17,e.update(i)}))}catch(e){console.log(e)}this.manualOrientation=!1,this.isMouseDown=!1,this.drag=!1,this.equipContainer=document.getElementById("equip_purchase_top"),this.dollContainer=document.getElementById("paper_doll_container"),this.equipContainer.addEventListener("mousemove",e=>{if(this.manualOrientation=!0,"equip_purchase_top"!==e.target.id)return!1;this.drag=!1,this.pointEggEvent(e)}),this.dollContainer.addEventListener("mousemove",e=>{this.manualOrientation=!0,this.drag=!1,this.pointEggEvent(e)}),this.equipContainer.addEventListener("pointerleave",e=>{this.manualOrientation=!1,this.isMouseDown=!1}),this.dollContainer.addEventListener("pointerleave",e=>{this.manualOrientation=!1,this.isMouseDown=!1}),this.equipContainer.addEventListener("mousedown",e=>{this.autoUpdate||(this.isMouseDown=!0,this.drag=!0)}),this.dollContainer.addEventListener("mousedown",e=>{this.autoUpdate||(this.isMouseDown=!0,this.drag=!0)}),this.equipContainer.addEventListener("mouseup",e=>{this.isMouseDown=!1,clearInterval(this.mouseIntval)}),this.dollContainer.addEventListener("mouseup",e=>{this.isMouseDown=!1,clearInterval(this.mouseIntval)}),this.dollContainer.addEventListener("click",e=>{this.autoUpdate||this.eggDamage()}),this.equipContainer.addEventListener("click",e=>{this.autoUpdate||this.eggDamage()})},Xo.prototype.pointEggEvent=function(e){(this.autoUpdate&&!this.isMouseDown||!this.autoUpdate&&this.isMouseDown)&&this.pointEgg(e)},Xo.prototype.pointEgg=function(e){var t=e.target.getBoundingClientRect();this.rotY=-(e.x-t.left)/t.width*4+2,this.rotX=1.5*((e.y-t.__uv$setSource(__uv).__uv$top)/t.height-.5)},Xo.prototype.startRendering=function(){var e=this;i.runRenderLoop((function(){e.scene.render()}))},Xo.prototype.avatars=function(e){e(this.avatar),e(this.dualAvatar)},Xo.prototype.update=function(e){if(this.camera.target.x+=(this.camX-this.camera.target.x)/5,this.camera.target.y+=(this.camY-this.camera.target.y)/5,this.camera.radius+=(this.camRadius-this.camera.radius)/5,this.jump-=.002*e,this.avatars(t=>{t.actor.head.rotation.x+=(this.rotX-t.actor.head.rotation.x)/5,t.actor.mesh.rotation.y+=(this.rotY-t.actor.mesh.rotation.y)/5,t.actor.mesh.rotation.x=.5*t.actor.head.rotation.x,t.actor.mesh.position.x=.1*-t.actor.mesh.rotation.y,t.actor.mesh.position.y=Math.max(0,t.actor.mesh.position.y+this.jump*e)}),!this.manualOrientation&&this.autoUpdate&&(this.turnCountdown-=e,this.turnCountdown<=0)){var t=.6*Math.random()-.4,i=2*Math.random()-1+.5*this.camX,r=Math.length2(t-this.rotX,i-this.rotY);this.rotX=t,this.rotY=i,this.jump=Math.min(.01,r/100),this.turnCountdown=90*Math.random()+30}this.fakeShadow.position.x=this.avatar.actor.mesh.position.x,this.fakeShadow.position.z=this.avatar.actor.mesh.position.z},Xo.prototype.setupScene=function(){this.scene=new t.Scene(i),Xt(this.scene),this.scene.autoClear=!0,this.scene.clearColor=new t.Color4(0,0,0,0),this.scene.fogMode=t.Scene.FOGMODE_EXP2,this.scene.fogDensity=.06;var e=new t.Color3(.35,.65,.8);this.scene.fogColor=e,this.scene.sunLight={direction:new t.Vector3(.2,1,.1),diffuse:new t.Color3.White},this.camera=new t.ArcRotateCamera("",.5*Math.PI,1.5,this.camRadius,new t.Vector3(this.camX,this.camY,0),this.scene),this.scene.activeCameras.push(this.camera),this.camera.maxZ=10,this.camera.fov=.5,this.camera.minZ=.1;var r=new t.StandardMaterial("shadowMat",this.scene);r.emissiveColor=new t.Color3(.07,.57,.74),r.alpha=.5,this.fakeShadow=t.MeshBuilder.CreateDisc("fakeShadow",{radius:.25},this.scene),this.fakeShadow.material=r,this.fakeShadow.rotation.x=Math.PI/2,this.fakeShadow.position.y=0,this.scene.render(),c=new t.Texture("img/stamps.png?v="+Ge,this.scene)},Xo.prototype.poseWithItems=function(e){this.poseWithHat(e[__uv.$wrap((st.Hat))]),this.poseWithStamp(e[__uv.$wrap((st.Stamp))]),this.poseWithPrimaryWeapon(e[__uv.$wrap((st.Primary))]),this.poseWithSecondaryWeapon(e[__uv.$wrap((st.Secondary))]),this.poseWithGrenade(e[__uv.$wrap((st.Grenade))]),this.poseWithMelee(e[__uv.$wrap((st.Melee))])},Xo.prototype.poseWithPrimaryWeapon=function(e){if(void 0!==e&&(null===e||this.posingItems[__uv.$wrap((st.Primary))]!==e)){if(this.avatar.weapon.actor.dispose(),null!==e){let i=e.instantiateNew(this.avatar);this.avatar.weapon=i;let r=this.avatar.actor;r.setWeaponSkeleton(i.actor.skeleton),r.gripBone.setScale(new t.Vector3(1,-1,1)),r.gripBone.position=r.weaponGripBone.position,r.gripBone.setRotationQuaternion(r.weaponGripBone.rotationQuaternion),this.dualAvatar.actor.foreBone.setScale(t.Vector3.Zero()),i.actor.gunMesh.setEnabled(!0)}this.posingItems[__uv.$wrap((st.Primary))]=e,null!==this.posingItems[__uv.$wrap((st.Melee))]&&this.poseWithMelee(this.posingItems[__uv.$wrap((st.Melee))],!0)}},Xo.prototype.poseWithSecondaryWeapon=function(e){if(void 0!==e&&(null===e||this.posingItems[__uv.$wrap((st.Secondary))]!==e)){if(this.dualAvatar.weapon.actor.dispose(),null!==e){let i=e.instantiateNew(this.dualAvatar);this.dualAvatar.weapon=i;let r=this.dualAvatar.actor;if(r.setWeaponSkeleton(i.actor.skeleton),r.gripBone.position=r.weaponGripBone.position,r.gripBone.setRotationQuaternion(r.weaponGripBone.rotationQuaternion),i.actor.gunMesh.setEnabled(!0),r.gripBone.setScale(new t.Vector3(1,-1,1)),this.avatar.actor.foreBone.setScale(t.Vector3.Zero()),null!==this.posingItems[__uv.$wrap((st.Grenade))]&&!this.grenadeOnHip){let e=this.dualAvatar.grenade.actor.mesh;e.__uv$setSource(__uv).__uv$parent=this.dualAvatar.actor.mesh,e.position.set(.29,.17,-.08),e.rotation.y=Math.PI+.3,e.rotation.z=-.3,this.grenadeOnHip=!0}}this.posingItems[__uv.$wrap((st.Secondary))]=e,null!==this.posingItems[__uv.$wrap((st.Grenade))]&&this.poseWithGrenade(this.posingItems[__uv.$wrap((st.Grenade))],!0)}},Xo.prototype.poseWithGrenade=function(e,i){if(void 0!==e&&(i||null===e||this.posingItems[__uv.$wrap((st.Grenade))]!==e)){if(this.dualAvatar.grenade&&this.dualAvatar.grenade.actor.dispose(),null!==e){this.dualAvatar.grenade=e.instantiateNew(this.dualAvatar);let i=this.dualAvatar.grenade.actor.mesh;if(i.setEnabled(!0),null!==this.posingItems[__uv.$wrap((st.Secondary))])i.__uv$setSource(__uv).__uv$parent=this.dualAvatar.actor.mesh,i.position.set(.29,.17,-.08),i.rotation.y=Math.PI+.3,i.rotation.z=-.3,this.grenadeOnHip=!0;else{i.position.set(-.25,0,.3),i.rotation.y=Math.PI;let e=this.avatar.actor;this.dualAvatar.actor.gripBone.setScale(t.Vector3.Zero()),e.foreBone.setScale(new t.Vector3(-1,1,1)),this.grenadeOnHip=!1,e.foreBone.position=new t.Vector3(-.25,-.11,.28),e.foreBone.setRotation(new t.Vector3(-1.7,3,0)),i.__uv$setSource(__uv).__uv$parent=e.head}}this.posingItems[__uv.$wrap((st.Grenade))]=e}},Xo.prototype.poseWithMelee=function(e,i){if(void 0!==e&&(i||null===e||this.posingItems[__uv.$wrap((st.Melee))]!==e)){if(this.avatar.meleeWeapon&&this.avatar.meleeWeapon.actor.dispose(),null!==e){let i=e.instantiateNew(this.avatar);this.avatar.meleeWeapon=i;let r=i.actor.weaponMesh;r.setEnabled(!0),null!==this.posingItems[__uv.$wrap((st.Primary))]?(r.__uv$setSource(__uv).__uv$parent=this.avatar.actor.mesh,r.position.set(-.53,-.02,.07),r.rotation.x=-2.1,r.rotation.y=-.3):(r.__uv$setSource(__uv).__uv$parent=this.avatar.actor.gunContainer,this.avatar.actor.gripBone.setScale(new t.Vector3(1,-1,1)),this.avatar.actor.gripBone.position=this.avatar.actor.weaponGripBone.position,this.avatar.actor.gripBone.setRotationQuaternion(this.avatar.actor.weaponGripBone.rotationQuaternion),this.dualAvatar.actor.foreBone.setScale(t.Vector3.Zero()),this.avatar.actor.wieldMelee())}this.posingItems[__uv.$wrap((st.Melee))]=e}},Xo.prototype.poseWithHat=function(e){void 0!==e&&(null!==e&&this.posingItems[__uv.$wrap((st.Hat))]===e||(this.avatar.actor.removeHat(),null!==e&&this.avatar.actor.wearHat(e),this.posingItems[__uv.$wrap((st.Hat))]=e))},Xo.prototype.poseWithStamp=function(e){void 0!==e&&(null!==e&&this.posingItems[__uv.$wrap((st.Stamp))]===e||(this.avatar.actor.removeStamp(),null!==e&&this.avatar.actor.applyStamp(e),this.posingItems[__uv.$wrap((st.Stamp))]=e))},Xo.prototype.poseWithColor=function(e){e>=7&&!H.isSubscriber&&(e=0,vueApp.equip.colorIdx=0),this.avatar.actor.setShellColor(e),this.dualAvatar.actor.setShellColor(e),vueApp.setShellColor(e)},Xo.prototype.photoBoothHideItem=function(e){switch(e.value){case st.Hat:hasValue(this.posingItems[__uv.$wrap((e.value))])?this.poseWithHat(null):this.poseWithHat(H.hatItem);break;case st.Stamp:this.posingItems[__uv.$wrap((e.value))]?this.poseWithStamp(null):this.poseWithStamp(H.stampItem);break;case st.Grenade:this.posingItems[__uv.$wrap((e.value))]?this.poseWithGrenade(null):this.poseWithGrenade(H.grenadeItem);break;case st.Melee:this.posingItems[__uv.$wrap((e.value))]?this.poseWithMelee(null):this.poseWithMelee(H.meleeItem);break;case st.Primary:this.posingItems[__uv.$wrap((e.value))]?this.poseWithPrimaryWeapon(null):this.poseWithPrimaryWeapon(H.getPrimaryWeapon());break;case st.Secondary:this.posingItems[__uv.$wrap((e.value))]?this.poseWithSecondaryWeapon(null):this.poseWithSecondaryWeapon(H.getSecondaryWeapon())}null===this.posingItems[__uv.$wrap((st.Grenade))]&&null===this.posingItems[__uv.$wrap((st.Secondary))]&&(this.dualAvatar.actor.gripBone.setScale(t.Vector3.Zero()),this.avatar.actor.foreBone.setScale(new t.Vector3(1,-1,1)),this.avatar.actor.foreBone.position=new t.Vector3(-.34,-.12,.1),this.avatar.actor.foreBone.setRotation(new t.Vector3(.3,1.5,-1.2))),null===this.posingItems[__uv.$wrap((st.Primary))]&&null===this.posingItems[__uv.$wrap((st.Melee))]?(this.avatar.actor.gripBone.setScale(t.Vector3.Zero()),this.dualAvatar.actor.foreBone.setScale(new t.Vector3(1,-1,1)),this.dualAvatar.actor.foreBone.position=new t.Vector3(-.34,-.12,.1),this.dualAvatar.actor.foreBone.setRotation(new t.Vector3(.3,1.5,-1.2))):(this.avatar.actor.gripBone.setScale(new t.Vector3(1,-1,1)),this.dualAvatar.actor.foreBone.setScale(t.Vector3.Zero()))},Xo.prototype.scale=function(e){void 0===e&&(e=0),this.avatar.actor.mesh.scaling=new t.Vector3(this.scaleSizes[__uv.$wrap((e))],this.scaleSizes[__uv.$wrap((e))],this.scaleSizes[__uv.$wrap((e))]),this.dualAvatar.actor.mesh.scaling=new t.Vector3(this.scaleSizes[__uv.$wrap((e))],this.scaleSizes[__uv.$wrap((e))],this.scaleSizes[__uv.$wrap((e))]),this.fakeShadow.scaling=new t.Vector3(this.scaleSizes[__uv.$wrap((e))],this.scaleSizes[__uv.$wrap((e))],this.scaleSizes[__uv.$wrap((e))])},Xo.prototype.eggDamage=function(e){e?this.avatar.hp=100:Ae.open&&this.drag&&(this.avatar.hp=this.dmg>0?this.dmg-=25:this.dmg+=100)},Xo.prototype.photoBoothOpen=function(){this.poseWithItems(H.getEquippedItems()),this.autoUpdate=!1,this.fakeShadow.material.emissiveColor=new t.Color3(0,0,0)},Xo.prototype.photoBoothClose=function(){this.autoUpdate=!0,this.fakeShadow.material.emissiveColor=new t.Color3(.07,.57,.74),this.eggDamage(!0),sa()};class Yo{constructor(){this.isOpen=!1,this.zoomMsgRead=!1}hideItem(e){V&&!this.isOpen&&(e=null),U.photoBoothHideItem(e)}eggDollSize(e){V&&!this.isOpen&&(e=0),U.scale(e)}zoooMsg(){this.zoomMsgRead||(localStore.setItem("photoBoothZooming",!0),this.zoomMsgRead=localStore.getItem("photoBoothZooming"),vueApp.showGenericPopup("screen_photo_booth_zoom_title","screen_photo_booth_zoom_msg","ok"))}getScreenshot(e){this.zoooMsg(),!this.isOpen&&V||(e?this.getScreenshotWithCrop():html2canvas(document.body,{allowTaint:!1,logging:!1,backgroundColor:null}).then(e=>vueApp.screenGrabDone(e.toDataURL())))}getScreenshotWithCrop(){if(this.zoooMsg(),!this.isOpen&&V)return;const e=document.createElement("canvas").getContext("2d"),t={allowTaint:!1,logging:!1,backgroundColor:null},i=window.innerWidth,r=i/2,n=window.innerHeight;return t.height=n,t.width=i,t.x=Math.round(t.x),html2canvas(document.body,t).then(a=>{e.canvas.width=r,e.canvas.height=n,e.drawImage(a,-Math.max(0,(i-r)/2||0),-(+t.y||0)),vueApp.screenGrabDone(e.canvas.toDataURL())})}open(){V?this.close():(this.isOpen=!0,this.zoomMsgRead=localStorage.getItem("photoBoothZooming"),vueApp.$refs.photoBooth.open(),U.photoBoothOpen())}close(){this.isOpen=!1,this.eggDollSize(0),vueApp.$refs.photoBooth.close(),U.photoBoothClose()}}function Ko(e){console.log("Pinging regions");var t=1e6;document.__uv$setSource(__uv).__uv$location.protocol;for(let e of Wo.regionList)!function(i){let r=(isHttps()?"wss":"ws")+"://"+Qa(i.sub)+"/game/";var n,a=new WebSocket(r);a.onopen=e=>{console.log("Pinging "+i.id),a.send(JSON.stringify({command:"ping"})),n=Date.now()},a.onmessage=i=>{clearTimeout(o),e.ping=Date.now()-n,vueApp.regionList=Wo.regionList.filter(e=>null!==e.ping).sort((e,t)=>e.ping<t.ping?-1:e.ping>t.ping?1:0),e.ping<t&&(t=e.ping,vueApp.currentRegionId=e.id)},a.onerror=t=>{clearTimeout(o),e.ping=null};var o=setTimeout(()=>{e.ping=null,a.close()},4e3)}(e)}class Qo{constructor(){this.statStateTemp={total:0,mode:{public:0,private:0},dmgType:{pistol:0,grenade:0,rpegg:0,eggk:0,scrambler:0,ranger:0,whipper:0,crackshot:0,trihard:0,melee:0},gameType:{kotc:0,spatula:0,team:0,ffa:0},kdr:{private:0,public:0,ffa:0,teams:0,kotc:0,spatula:0}},this.kills=Object.create(this.statStateTemp),this.deaths=Object.create(this.statStateTemp),this.gameType={kotc:{captured:0,wins:0}},this.streak=0,this.dateReset=null}get(){return{kills:this.kills,deaths:this.deaths,gameType:this.gameType,streak:this.streak,dateReset:this.dateReset}}set(e){if(!e||void 0!==e.error)return vueApp.showGenericPopup("uh_oh","auth_stat_error_msg","ok");void 0!==e.kills&&(this.kills=this.updateStats(e.kills,"kills")),void 0!==e.deaths&&(this.deaths=this.updateStats(e.deaths,"deaths")),void 0!==e.gameType&&(this.gameType={kotc:{captured:void 0!==e.gameType.kotc.captured?e.gameType.kotc.captured:this.gameType.kotc.captured,wins:void 0!==e.gameType.kotc.wins?e.gameType.kotc.wins:this.gameType.kotc.wins}}),e.streak&&(this.streak=void 0!==e.streak?e.streak:this.streak)}updateStats(e,t){return{total:void 0!==e.total?e.total:this[__uv.$wrap((t))].deaths,mode:{public:void 0!==e.mode.public?e.mode.public:this[__uv.$wrap((t))].mode.public,private:void 0!==e.mode.private?e.mode.private:this[__uv.$wrap((t))].mode.private},dmgType:{pistol:void 0!==e.dmgType.pistol?e.dmgType.pistol:this[__uv.$wrap((t))].dmgType.pistol,grenade:void 0!==e.dmgType.grenade?e.dmgType.grenade:this[__uv.$wrap((t))].dmgType.grenade,rpegg:void 0!==e.dmgType.rpegg?e.dmgType.rpegg:this[__uv.$wrap((t))].dmgType.rpegg,eggk:void 0!==e.dmgType.eggk?e.dmgType.eggk:this[__uv.$wrap((t))].dmgType.eggk,scrambler:void 0!==e.dmgType.scrambler?e.dmgType.scrambler:this[__uv.$wrap((t))].dmgType.scrambler,ranger:void 0!==e.dmgType.ranger?e.dmgType.ranger:this[__uv.$wrap((t))].dmgType.ranger,whipper:void 0!==e.dmgType.whipper?e.dmgType.whipper:this[__uv.$wrap((t))].dmgType.whipper,crackshot:void 0!==e.dmgType.crackshot?e.dmgType.crackshot:this[__uv.$wrap((t))].dmgType.crackshot,trihard:void 0!==e.dmgType.trihard?e.dmgType.trihard:this[__uv.$wrap((t))].dmgType.trihard,melee:void 0!==e.dmgType.melee?e.dmgType.melee:this[__uv.$wrap((t))].dmgType.melee},gameType:{kotc:void 0!==e.gameType.kotc?e.gameType.kotc:this[__uv.$wrap((t))].gameType.kotc,spatula:void 0!==e.gameType.spatula?e.gameType.spatula:this[__uv.$wrap((t))].gameType.spatula,team:void 0!==e.gameType.team?e.gameType.team:this[__uv.$wrap((t))].gameType.team,ffa:void 0!==e.gameType.ffa?e.gameType.ffa:this[__uv.$wrap((t))].gameType.ffa}}}}function Zo(){this.loggedOut=function(){this.firebaseId=null,this.id=null,this.session=null,this.sessionId=null,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.classIdx=0,this.inventory=[],this.pickedWeapons=[],this.stampItem=null,this.grenadeItem=G.findItemById(16e3),this.meleeItem=G.findItemById(15e3),this.hatItem=null,this.colorIdx=0,this.killMultiplier=1,this.hideAds=!1,this.maybeSchoolEmail=!1,this.isAnonymous=!0,this.upgradeIsExpired=null,this.upgradeExpiryDate=null,this.upgradeName="",this.isSubscriber=!1,this.twitchLinked=!1,this.twitchName="",this.contentCreator=!1,this.dateCreated=null,this.eggsSpent=0,this.eggsSpentMonthly=0,this.eggsEarnedBalance=0,this.statsCurrent=new Qo,this.statsLifetime=new Qo;for(var e=0;e<lt.length;e++){var t=[G.forClass[__uv.$wrap((e))].primaryWeapons[__uv.$wrap((0))],G.forClass[__uv.$wrap((e))].secondaryWeapons[__uv.$wrap((0))]];this.pickedWeapons.push(t)}ys.__uv$setSource(__uv).postMessage({sessionId:null}),M=0},this.loggingOut=function(){this.loggedOut(),this.applyLoadoutObject(),this.getPrimaryWeapon(),this.getSecondaryWeapon(),this.setClass(this.classIdx),vueApp.signOut()},this.setClass=function(e){e>=Nt.length&&(e=0),this.classIdx=e,vueApp.classIdx=this.classIdx},this.pickWeapon=function(e,t){t.item_type_id===st.Primary&&this.setClass(t.exclusive_for_class),!1===G.findItemInListById(t,G.forClass[__uv.$wrap((this.classIdx))].forWeaponSlot[__uv.$wrap((e))])&&(t=G.forClass[__uv.$wrap((this.classIdx))].forWeaponSlot[__uv.$wrap((e))][__uv.$wrap((0))]),this.pickedWeapons[__uv.$wrap((this.classIdx))][__uv.$wrap((e))]=t},this.calculateKdr=function(){this.kdr=Math.floor(this.statsCurrent.kills/Math.max(this.statsCurrent.deaths,1)*100)/100,this.kdrLifetime=Math.floor(this.statslifetime.kills/Math.max(this.statslifetime.deaths,1)*100)/100},this._firebaseId,Object.defineProperty(this,"firebaseId",{get:function(){return this._firebaseId},set:function(e){this._firebaseId=e,vueApp.firebaseId=this._firebaseId}}),this._id,Object.defineProperty(this,"id",{get:function(){return this._id},set:function(e){this._id=e,vueApp.id=this._id}}),this._isAnonymous,Object.defineProperty(this,"isAnonymous",{get:function(){return this._isAnonymous},set:function(e){this._isAnonymous=e,vueApp.isAnonymous=this._isAnonymous,vueApp.googleAnalytics.isUser=this._isAnonymous?"Unclaimed":"Claimed",ga("set","dimension1",vueData.googleAnalytics.isUser)}}),this._currentBalance,Object.defineProperty(this,"currentBalance",{get:function(){return this._currentBalance},set:function(e){this._currentBalance=e,vueApp.eggs=this._currentBalance}}),this._kills,Object.defineProperty(this,"kills",{get:function(){return this._kills},set:function(e){this._kills=e,vueApp.kills=this._kills}}),this._deaths,Object.defineProperty(this,"deaths",{get:function(){return this._deaths},set:function(e){this._deaths=e,vueApp.deaths=this._deaths}}),this._kdr,Object.defineProperty(this,"kdr",{get:function(){return this._kdr},set:function(e){this._kdr=e,vueApp.kdr=this._kdr}}),this._kdrLifetime,Object.defineProperty(this,"kdrLifetime",{get:function(){return this._kdrLifetime},set:function(e){this._kdrLifetime=e,vueApp.kdrLifetime=this._kdrLifetime}}),this._streak,Object.defineProperty(this,"streak",{get:function(){return this._streak},set:function(e){this._streak=e,vueApp.streak=this._streak}}),this._statsCurrent=new Qo,Object.defineProperty(this,"statsCurrent",{get:function(){return this._statsCurrent},set:function(e){this._statsCurrent.set(e),this.kills=this._statsCurrent.kills.total,this.deaths=this._statsCurrent.deaths.total,this.streak=this._statsCurrent.streak,this.kdr=Math.floor(this._statsCurrent.kills.total/Math.max(this._statsCurrent.deaths.total,1)*100)/100,vueApp.statsCurrent=this._statsCurrent}}),this._statsLifetime=new Qo,Object.defineProperty(this,"statsLifetime",{get:function(){return this._statsLifetime},set:function(e){this._statsLifetime.set(e),this.kdrLifetime=Math.floor(this._statsLifetime.kills.total/Math.max(this._statsLifetime.deaths.total,1)*100)/100,vueApp.statsLifetime=this._statsLifetime}}),this._eggsSpent,Object.defineProperty(this,"eggsSpent",{get:function(){return this._eggsSpent},set:function(e){this._eggsSpent=null===e?0:e,vueApp.eggsSpent=this._eggsSpent}}),this._eggsSpentMonthly,Object.defineProperty(this,"eggsSpentMonthly",{get:function(){return this._eggsSpentMonthly},set:function(e){this._eggsSpentMonthly=e,vueApp.eggsSpentMonthly=this._eggsSpentMonthly}}),this._eggsEarnedBalance,Object.defineProperty(this,"eggsEarnedBalance",{get:function(){return this._eggsEarnedBalance},set:function(e){void 0!==e&&(this._eggsEarnedBalance=null===e?0:e,vueApp.eggsEarnedBalance=this._eggsEarnedBalance)}}),this._playerName,Object.defineProperty(this,"playerName",{get:function(){return this._playerName},set:function(e){this._playerName=e,vueApp.playerName=this._playerName}}),this._maskedEmail,Object.defineProperty(this,"maskedEmail",{get:function(){return this._maskedEmail},set:function(e){this._maskedEmail=e,vueApp.maskedEmail=this._maskedEmail}}),this._isEmailVerified,Object.defineProperty(this,"isEmailVerified",{get:function(){return this._isEmailVerified},set:function(e){this._isEmailVerified=e,vueApp.isEmailVerified=this._isEmailVerified}}),this._isSubscriber,Object.defineProperty(this,"isSubscriber",{get:function(){return this._isSubscriber},set:function(e){this._isSubscriber=e,vueApp.isSubscriber=e}}),this._upgradeName,Object.defineProperty(this,"upgradeName",{get:function(){return this._upgradeName},set:function(e){this._upgradeName=e,vueApp.upgradeName=e}}),this._hideAds,Object.defineProperty(this,"hideAds",{get:function(){return this._hideAds},set:function(e){vueApp.hideAds=!!e}}),this._twitchLinked,Object.defineProperty(this,"twitchLinked",{get(){return this._twitchLinked},set(e){this._twitchLinked=e,vueApp.twitchLinked=e}}),this._twitchName,Object.defineProperty(this,"twitchName",{get(){return this._twitchName},set(e){this._twitchName=e,vueApp.twitchName=e}}),this.isItemOwned,Object.defineProperty(this,"isItemOwned",{value:function(e){if(!e)return!1;for(var t=0;t<this.inventory.length;t++)if(this.inventory[__uv.$wrap((t))]&&this.inventory[__uv.$wrap((t))].id===e.id)return!0;return!1}}),this._contentCreator,Object.defineProperty(this,"contentCreator",{get(){return this._contentCreator},set(e){e&&(this._contentCreator=!0,vueApp.contentCreator=this._contentCreator)}}),this._dateCreated,Object.defineProperty(this,"dateCreated",{get(){return this._dateCreated},set(e){if(e){const t=new Date(e).toLocaleDateString();this._dateCreated=t,vueApp.accountCreated=t}else vueApp.accountCreated=null}}),this.getPickedWeaponInSlot=function(e){return this.pickedWeapons[__uv.$wrap((this.classIdx))][__uv.$wrap((e))]},this.getPrimaryWeapon=function(){return this.getPickedWeaponInSlot(at)},this.getSecondaryWeapon=function(){return this.getPickedWeaponInSlot(ot)},this.isUpgraded=function(){return hasValue(this.upgradeProductId)&&!this.upgradeIsExpired},this.addToInventory=function(e,t){this.isItemOwned(e)||this.inventory.push(e),!0===t&&this.tryEquipItem(e)},this.tryEquipItem=function(e){if(this.isItemOwned(e))switch(e.item_type_id){case st.Hat:this.hatItem=e;break;case st.Stamp:this.stampItem=e;break;case st.Primary:e.exclusive_for_class!==this.classIdx&&this.setClass(e.exclusive_for_class),this.pickWeapon(at,e);break;case st.Secondary:this.pickWeapon(ot,e);break;case st.Grenade:this.grenadeItem=e;break;case st.Melee:this.meleeItem=e}},this.signedIn=function(e,t){if(e.uid===t.firebaseId){if(this.isAnonymous=e.isAnonymous,this.isEmailVerified=!this.isAnonymous&&t.emailVerified,this.id=t.id,this.firebaseId=t.firebaseId,this.sessionId=t.sessionId,this.session=t.session,this.maskedEmail=t.maskedEmail,this.kills=t.kills,this.deaths=t.deaths,this.streak=t.streak,this.currentBalance=t.currentBalance,this.upgradeProductId=t.upgradeProductId,this.killMultiplier=hasValue(t.upgradeMultiplier)?t.upgradeMultiplier:1,this.upgradeExpiryDate=hasValue(t.upgradeExpiryDate)?t.upgradeExpiryDate:null,this.upgradeIsExpired=hasValue(t.upgradeExpiryDate)?t.upgradeIsExpired:null,this.hideAds=!(!hasValue(t.upgradeAdFree)||this.upgradeIsExpired)&&t.upgradeAdFree,this.isSubscriber="subscription"===t.upgradeType&&!t.upgradeIsExpired,this.upgradeName=t.upgradeName,this.maybeSchoolEmail=t.maybeSchoolEmail,this.subscriptionEnded=t.subscriptionEnded,this.twitchLinked=t.twitchLinked,this.twitchName=t.twitchName,this.contentCreator=t.social,this.setStats(t.statsLifetime,t.statsCurrent),this.dateCreated=t.dateCreated,this.eggsSpent=t.eggsSpent,this.eggsSpentMonthly=t.eggsSpentMonthly,this.eggsEarnedBalance=this.setEggBalances(this.currentBalance),M=t.adminRoles,hasValue(t.ownedItemIds))for(var i=0;i<t.ownedItemIds.length;i++){var r=G.findItemById(t.ownedItemIds[__uv.$wrap((i))]);this.inventory.push(r)}this.isUpgraded()&&li(),this.subscriptionEnded&&(ve=!0),t.firstSignin&&(we=!0),this.applyLoadoutObject(t.loadout),this.applyLocalLoadout(t.loadout),ys.__uv$setSource(__uv).postMessage({servicesServer:ms,sessionId:this.sessionId})}else console.log("Firebase user ID does not match account returned from API")},this.convertLoadout=e=>{e||(e=this.generateLoadoutObject());return{primaryId:[e.soldier_primary_item_id,e.scrambler_primary_item_id,e.ranger_primary_item_id,e.eggsploder_primary_item_id,e.whipper_primary_item_id,e.crackshot_primary_item_id,e.trihard_primary_item_id],secondaryId:[e.soldier_secondary_item_id,e.scrambler_secondary_item_id,e.ranger_secondary_item_id,e.eggsploder_secondary_item_id,e.whipper_secondary_item_id,e.crackshot_secondary_item_id,e.trihard_secondary_item_id],hatId:e.hat_id,stampId:e.stamp_id,grenadeId:e.grenade_id,meleeId:e.melee_id,classIdx:e.class_idx,colorIdx:e.color}},this.setUpgrade=function(e){this.upgradeProductId=e.upgradeProductId,this.multiplier=e.multiplier,this.hideAds=e.hideAds,this.upgradeIsExpired=e.isExpired,this.upgradeName=e.upgradeName;var t=this.isUpgraded(),i=t?this.upgradeExpiryDate:null;this.colorIdx>=7&&!t&&(this.colorIdx=0),vueApp.setAccountUpgraded(t,i)},this.generateLoadoutObject=function(){return{classIdx:this.classIdx,hatId:hasValue(this.hatItem)?H.hatItem.id:null,stampId:hasValue(this.stampItem)?H.stampItem.id:null,grenadeId:hasValue(this.grenadeItem)?H.grenadeItem.id:null,meleeId:hasValue(this.meleeItem)?H.meleeItem.id:null,colorIdx:this.colorIdx,primaryId:this.pickedWeapons.map(e=>e[__uv.$wrap((at))].id),secondaryId:this.pickedWeapons.map(e=>e[__uv.$wrap((ot))].id)}},this.applyLocalLoadout=function(e){if(!hasValue(e))return;let t=e;e.hasOwnProperty("primaryId")||(t=this.convertLoadout(e)),lsLoadout={items:t,kills:this.kills?this.kills:0,deaths:this.deaths?this.deaths:0,kdr:this.kdr?this.kdr:0,streak:this.streak?this.streak:0,balance:this._currentBalance},localStore.setItem("localLoadOut",JSON.stringify(lsLoadout))},this.applyLoadoutObject=function(e){if(hasValue(e)){void 0!==e.classIdx&&null!==e.classIdx&&this.setClass(e.classIdx);for(var t=this,i=function(e,i,r){var n=G.forClass[__uv.$wrap((i))].forWeaponSlot[__uv.$wrap((r))][__uv.$wrap((0))];if(hasValue(e)){let t=G.findItemById(e);t&&(n=t)}t.pickedWeapons[__uv.$wrap((i))][__uv.$wrap((r))]=n},r=0;r<lt.length;r++)i(e.primaryId[__uv.$wrap((r))],r,at),i(e.secondaryId[__uv.$wrap((r))],r,ot);if(hasValue(e.hatId)){var n=G.findItemById(e.hatId);this.isItemOwned(n)||(this.hatItem=null),this.hatItem=n}if(hasValue(e.stampId)){var a=G.findItemById(e.stampId);this.isItemOwned(a)||(this.stampItem=null),this.stampItem=a}if(hasValue(e.grenadeId)){var o=G.findItemById(e.grenadeId);this.isItemOwned(o)||(o=G.findItemById(16e3)),this.grenadeItem=o}if(hasValue(e.meleeId)){var s=G.findItemById(e.meleeId);this.isItemOwned(s)||(s=G.findItemById(15e3)),this.meleeItem=s}hasValue(e.colorIdx)&&(this.colorIdx=e.colorIdx,this.colorIdx>=7&&!1===this.isUpgraded()&&(this.colorIdx=0))}sa()},this.getEquippedItems=function(){return{[st.Primary]:this.pickedWeapons[__uv.$wrap((this.classIdx))][__uv.$wrap((at))],[st.Secondary]:this.pickedWeapons[__uv.$wrap((this.classIdx))][__uv.$wrap((ot))],[st.Hat]:this.hatItem,[st.Stamp]:this.stampItem,[st.Grenade]:this.grenadeItem,[st.Melee]:this.meleeItem}},this.syncToServer=function(e){var t=this.generateLoadoutObject();!function(e,t){var i,r={cmd:"saveLoadout",firebaseId:H.firebaseId,save:"undefined"==typeof checkStatus||checkStatus(),loadout:e};t&&(i=setTimeout(()=>{t()},5e3)),hi(r,(function(e){console.log("Save Loadout response: "+JSON.stringify(e)),e.error?console.log("Save Loadout call failed: "+JSON.stringify(e.error)):console.log("Successfully saved player loadout"),t&&(clearTimeout(i),t())}),(function(){console.log("Error running save loadout call")}))}(t,e),null!==t&&this.applyLocalLoadout(t)},this.setEggBalances=function(e){this.currentBalance=e,this.eggsEarnedBalance=this.eggsSpent+this.currentBalance},this.pickedWeapons=[];for(var e=0;e<lt.length;e++){var t=[G.forClass[__uv.$wrap((e))].primaryWeapons[__uv.$wrap((0))],G.forClass[__uv.$wrap((e))].secondaryWeapons[__uv.$wrap((0))]];this.pickedWeapons.push(t)}this.setStats=function(e,t){this.statsLifetime=e,this.statsCurrent=t},this.firebaseId=null,this.session=null,this.maskedEmail=null,this.classIdx=0,this.inventory=[],this.hatItem=null,this.stampItem=null,this.grenadeItem=G.grenades[__uv.$wrap((0))],this.meleeItem=G.melee[__uv.$wrap((0))],this.colorIdx=0,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.upgradeProductId=null,this.killMultiplier=1,this.hideAds=!1,this.maybeSchoolEmail=!1,this.upgradeExpiryDate=null,this.upgradeIsExpired=null,this.upgradeName="",this.isSubscriber=!1,this.twitchLinked=!1,this.twitchName="",this.contentCreator=!1,this.dateCreated=null,this.statsCurrent=new Qo,this.statsLifetime=new Qo,this.eggsSpent=0,this.eggsSpentMonthly=0,this.eggsEarnedBalance=0}var qo;function Jo(e){this.player=e,this.scene=e.scene,this.mesh=new t.TransformNode,this.hat=null,this.bodyMesh=ut("egg",this.scene,this.mesh),this.bodyMesh._scene=this.scene,this.bodyMesh.position.y=.32,this.bodyMesh.player=this.player,this.lerpToPosition=new t.Vector3,this.positionLerp=0,this.lerpFromPosition=new t.Vector3,this.lerpTargetPosition=new t.Vector3,this.bodyMesh.material=dt("eggShell",this.scene),this.bodyMesh.material.setTexture("textureSampler",c),this.head=new t.TransformNode,this.head.__uv$setSource(__uv).__uv$parent=this.mesh,this.head.position.y=.3,this.head.position.z=0,this.gunContainer=new t.TransformNode,this.gunContainer.__uv$setSource(__uv).__uv$parent=this.head,this.gunContainer.rotation.y=-.14,this.gunContainer.rotation.x=-.035,this.setupStowAnims(),this.eye=new t.TransformNode,this.eye.position.y=.1,this.eye.position.x=0,this.eye.__uv$setSource(__uv).__uv$parent=this.head,this.hands=ut("hands",this.scene,this.gunContainer),this.hands.skeleton=ht("hands_skeleton",this.scene),this.hands.material=dt("standard",this.scene),this.gripBone=this.hands.skeleton.bones[__uv.$wrap((this.hands.skeleton.getBoneIndexByName("gripHand")))],this.foreBone=this.hands.skeleton.bones[__uv.$wrap((this.hands.skeleton.getBoneIndexByName("foreHand")))],this.player.shield>0&&(this.bodyMesh.overlayColor=Gt.OverlayColor.green,this.hands.overlayColor=Gt.OverlayColor.green,this.bodyMesh.renderOverlay=!0,this.hands.renderOverlay=!0),this.setShellColor(this.player.shellColor),qo=0,this.mesh.position.x=this.player.x,this.mesh.position.y=this.player.y,this.mesh.position.z=this.player.z,this.player.id!=u&&(this.wearHat(this.player.hatItem),this.applyStamp(this.player.stampItem)),z&&this.hands.setEnabled(!1),this.bobbleIntensity=0,this.zoomed=!1,this.hitSoundDelay=0,this.auraSprite=null,this.auraSpriteFrame=0;for(var i=0;i<Object.keys(tt).length;i++){var r=Math.pow(2,i);this.player.activeShellStreaks&r&&this.beginShellStreak(r)}V?(n&&n.getShadowMap().renderList.push(this.bodyMesh),this.player.id==u?this.hands.setRenderingGroupId(2):(this.setupNameSprite(),this.showSprites()),V&&this.updateTeam()):this.bodyMesh.outlineColor=Le.outline[__uv.$wrap((0))]}Jo.prototype.wearHat=function(e){this.removeHat(),null!==e&&(this.hat=ut(e.item_data.meshName,this.scene,this.bodyMesh),this.hat.position.y=-.02)},Jo.prototype.removeHat=function(){void 0!==this.hat&&null!==this.hat&&this.hat.dispose()},Jo.prototype.applyStamp=function(e){this.removeStamp(),null!==e&&(this.bodyMesh.stampU=e.item_data.x/32,this.bodyMesh.stampV=1-e.item_data.y/32)},Jo.prototype.removeStamp=function(){this.bodyMesh.stampU=0,this.bodyMesh.stampV=1},Jo.prototype.drawTextOnNameTexture=function(e,t,i,r,n,a){var o=[{x:0,y:-4},{x:-4,y:0},{x:4,y:0},{x:0,y:4}],s=[{x:0,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1}];t+=this.player.id%4*512,i=-i+(2048-256*Math.floor(this.player.id/4)),a&&(t+=256-function(e,t){var i=ce.getContext("2d");return i.font="bold "+t+"px Nunito, sans-serif",i.measureText(e).width}(e,r)/2);for(var l=0;l<4;l++)or.drawText(e,t+o[__uv.$wrap((l))].x,i+o[__uv.$wrap((l))].y,"bold "+r+"px Nunito, sans-serif","rgba(0, 0, 0, 0.5)","transparent");for(l=0;l<4;l++)or.drawText(e,t+s[__uv.$wrap((l))].x,i+s[__uv.$wrap((l))].y,"bold "+r+"px Nunito, sans-serif",n,"transparent")},Jo.prototype.setupNameSprite=function(){var e=this.player.id%4*512,t=2048-256*Math.floor(this.player.id/4);or.clearRect(e,t-256,512,256),this.drawTextOnNameTexture(this.player.name,0,32,60,"white",!0)},Jo.prototype.updateTeam=function(){this.player.team==w||Li?this.bodyMesh.outlineColor=Le.outline[__uv.$wrap((this.player.team))]:this.bodyMesh.outlineColor=Le.outline[__uv.$wrap((0))],this.nameSprite&&(this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.color=Le.textColor[__uv.$wrap((this.player.team))])},Jo.prototype.update=function(e){var i=Math.cos(this.player.bobble)*this.bobbleIntensity,r=Math.abs(Math.sin(this.player.bobble)*this.bobbleIntensity),n=Math.sin(2*this.player.bobble)*this.bobbleIntensity;if(this.player.shield>0){var o=.7*Math.random()+.2;this.bodyMesh.overlayAlpha=o,this.hands.overlayAlpha=o}if(this.player.activeShellStreaks&tt.EggBreaker){o=.5*Math.cos(qi/100)+.5;this.bodyMesh.overlayAlpha=o,this.hands.overlayAlpha=o}var s,l=.333*(e=Math.min(e,1));if(this.player.id==u)if(this.player.scope&&this.player.isAtReady(!0))a.fov=a.fov+(this.player.weapon.actor.scopeFov-a.fov)*l,this.gunContainer.rotation.y*=l,this.gunContainer.rotation.x*=l,this.gunContainer.position.x+=(-.24999999-this.gunContainer.position.x)*l,this.gunContainer.position.y+=(this.player.weapon.actor.scopeY-this.gunContainer.position.y)*l,this.gunContainer.position.z+=(-.05-this.gunContainer.position.z)*l,this.player.weapon.hasScope&&!this.zoomed&&a.fov<this.player.weapon.actor.scopeFov+.05&&(ki.show(),this.gunContainer.setEnabled(!1),this.zoomed=!0);else{a.fov=a.fov+(1.25-a.fov)*l;var c=1-l;this.gunContainer.rotation.y+=(2*i-.14-this.gunContainer.rotation.y)*l,this.gunContainer.rotation.x+=(.75*n-.035-this.gunContainer.rotation.x)*l,this.gunContainer.position.x*=c,this.gunContainer.position.y*=c,this.gunContainer.position.z*=c,this.zoomed&&a.fov>this.player.weapon.actor.scopeFov+.05&&(ki.hide(),this.gunContainer.setEnabled(!0),this.zoomed=!1)}else if(this.gunContainer.rotation.y+=(2*i-.14-this.gunContainer.rotation.y)*l,this.gunContainer.rotation.x+=(.75*n-.035-this.gunContainer.rotation.x)*l,this.player.team>0&&(this.player.team==w||Li)&&this.nameSprite){var h=Math.length3(this.player.x-ir.x,this.player.y-ir.y,this.player.z-ir.z),d=Math.pow(h,1.25);this.nameSprite.width=d/10+.6,this.nameSprite.height=d/20+.3}if(this.lerpToPosition.copyFromFloats(this.player.x,this.player.y,this.player.z),t.Vector3.LerpToRef(this.lerpFromPosition,this.lerpToPosition,Math.min(this.positionLerp,1),this.lerpTargetPosition),this.positionLerp+=e/2,this.mesh.position.x+=.5*(this.lerpTargetPosition.x-this.mesh.position.x),this.mesh.position.y+=.5*(this.lerpTargetPosition.y-this.mesh.position.y),this.mesh.position.z+=.5*(this.lerpTargetPosition.z-this.mesh.position.z),this.player.id!==u){var p=Math.radDifference(this.player.yaw,this.mesh.rotation.y),m=Math.radDifference(this.player.pitch,this.head.rotation.x);this.mesh.rotation.y+=p/2*e,this.head.rotation.x+=m/2*e}else this.mesh.rotation.y=this.player.yaw,this.head.rotation.x=this.player.pitch;if(this.bodyMesh.rotation.x=this.head.rotation.x/4,s=this.player.onGround||this.player.climbing?Math.length3(this.player.dx,this.player.dy,this.player.dz):0,this.bobbleIntensity+=(s-this.bobbleIntensity)/10,this.bodyMesh.rotation.z=5*i,this.bodyMesh.position.y=1.5*r+.32,qo>0)if((qo*=.9)<.001)qo=0;else{var _=Math.random()*qo-.5*qo,f=Math.random()*qo-.5*qo,g=Math.random()*qo-.5*qo;this.eye.rotation.x+=(_-this.eye.rotation.x)/10,this.eye.rotation.y+=(f-this.eye.rotation.y)/10,this.eye.rotation.z+=(g-this.eye.rotation.z)/10}else this.eye.rotation.x*=.9,this.eye.rotation.y*=.9,this.eye.rotation.z*=.9;if(this.player.id!=R){var y=Kn(this.mesh,.31);this.mesh.setVisible(y),y?this.showSprites():this.hideSprites(),this.nameSprite&&this.positionSprites()}this.hitSoundDelay=Math.max(this.hitSoundDelay-e,0),this.player.weapon.actor&&this.player.weapon.actor.update(e)},Jo.prototype.updateLerp=function(){this.positionLerp=0,this.lerpFromPosition.copyFromFloats(this.player.x,this.player.y,this.player.z)},Jo.prototype.resetLerp=function(){this.mesh.position.x=this.player.x,this.mesh.position.y=this.player.y,this.mesh.position.z=this.player.z,this.positionLerp=0,this.lerpToPosition.copyFromFloats(this.player.x,this.player.y,this.player.z),this.lerpFromPosition.copyFromFloats(this.player.x,this.player.y,this.player.z),this.lerpTargetPosition.copyFromFloats(this.player.x,this.player.y,this.player.z)},Jo.v3_1=new t.Vector3,Jo.v3_2=new t.Vector3,Jo.prototype.positionSprites=function(){var e,t;this.nameSprite&&((e=Jo.v3_1).copyFrom(this.mesh.position),e.y+=.5*this.nameSprite.height+.65,(t=this.nameSprite.position).copyFrom(a.globalPosition),t.subtractInPlace(e),t.normalize(),t.scaleInPlace(.4),t.addInPlace(e));this.auraSprite&&((e=Jo.v3_1).copyFrom(this.mesh.position),e.y+=.35,(t=this.auraSprite.position).copyFrom(a.globalPosition),t.subtractInPlace(e),t.normalize(),t.scaleInPlace(.4),t.addInPlace(e))},Jo.prototype.showSprites=function(){this.player.playing&&(this.nameSprite||(this.nameSprite=new t.Sprite("",sr),this.nameSprite.invertV=!0,this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.cellIndex=this.player.id,this.nameSprite.color=Le.textColor[__uv.$wrap((this.player.team))],this.player.team==w||Li?this.bodyMesh.outlineColor=Le.outline[__uv.$wrap((this.player.team))]:this.bodyMesh.outlineColor=Le.outline[__uv.$wrap((0))]),!this.auraSprite&&this.player.activeShellStreaks&tt.HardBoiled&&(this.auraSprite=new t.Sprite("",lr),this.auraSprite.invertV=!0,this.auraSprite.width=.7,this.auraSprite.height=.7,this.auraSprite.playAnimation(this.auraSpriteFrame,this.auraSpriteFrame+7,!0,67)))},Jo.prototype.hideSprites=function(){this.nameSprite&&(this.nameSprite.dispose(),this.nameSprite=null),this.auraSprite&&(this.auraSprite.dispose(),this.auraSprite=null)},Jo.prototype.hit=function(){this.hitSoundDelay<=0&&(this.player.activeShellStreaks&tt.HardBoiled?Ti.play("shield_hit",this.bodyMesh.absolutePosition,!0):Ti.play("hit",this.bodyMesh.absolutePosition,!0),this.hitSoundDelay=10)},Jo.prototype.beginShellStreak=function(e){switch(e){case tt.HardBoiled:this.auraSpriteFrame=8,this.player.id==u&&(hn("HARD BOILED"),vn());break;case tt.EggBreaker:this.player.id==u&&(hn("EGG BREAKER"),Bi.setPowerful(!0),document.getElementById("eggBreakerContainer").className="on"),this.bodyMesh.overlayColor=Gt.OverlayColor.red,this.hands.overlayColor=Gt.OverlayColor.red,this.bodyMesh.renderOverlay=!0,this.hands.renderOverlay=!0}this.showSprites()},Jo.prototype.endShellStreak=function(e){switch(e){case tt.HardBoiled:this.player.id==u&&vn(),this.auraSprite&&(this.auraSprite.dispose(),this.auraSprite=null);break;case tt.EggBreaker:this.player.id==u&&(Bi.setPowerful(!1),document.getElementById("eggBreakerContainer").className="off"),this.bodyMesh.renderOverlay=!1,this.hands.renderOverlay=!1}},Jo.prototype.removeFromPlay=function(){this.zoomed=!1,this.throwingGrenade=!1,this.gripBone._frozen=!1,this.wieldingMelee=!1,this.mesh.setEnabled(!1),this.hideSprites()},Jo.prototype.restoreToPlay=function(){this.mesh.setEnabled(!0),this.gunContainer.setEnabled(!0),this.player.id!=u&&this.showSprites()},Jo.prototype.remove=function(){this.mesh.dispose(),this.hideSprites()},Jo.prototype.fire=function(){this.zoomed&&this.player.weapon.hasScope?(qo=.15,this.eye.rotation.x=-.05):L.shakeEnabled&&(qo=.08*a.fov),this.wieldingMelee&&this.wieldGun()},Jo.prototype.inspect=function(){this.player.weapon&&!this.player.scope&&this.player.canSwapOrReload()&&this.player.weapon.actor.inspect()},Jo.prototype.melee=function(){this.player.id===u&&(qo=.05),this.wieldingMelee||this.wieldMelee(),this.player.meleeWeapon.actor.attack()},Jo.prototype.wieldMelee=function(){this.wieldingMelee=!0,this.player.weapon.actor.restPose(),this.setWeaponSkeleton(this.player.meleeWeapon.actor.skeleton),this.player.meleeWeapon.actor.weaponMesh.setEnabled(!0),this.player.weapon.actor.gunMesh.setEnabled(!1)},Jo.prototype.wieldGun=function(){this.wieldingMelee=!1,this.setWeaponSkeleton(this.player.weapon.actor.skeleton),this.player.meleeWeapon.actor.weaponMesh.setEnabled(!1),this.player.weapon.actor.gunMesh.setEnabled(!0)},Jo.prototype.reachForGrenade=function(){this.player.weapon.actor.restPose(),this.throwingGrenade=!0,this.gripBone._frozen=!0,this.hands.skeleton.enableBlending(.2),this.hands.skeleton.beginAnimation("grenade_grab",!1,1,()=>{this.hands.skeleton&&this.hands.skeleton.disableBlending()})},Jo.prototype.throwGrenade=function(){var e=this;this.player.id==u&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),this.hands.skeleton.beginAnimation("grenade_throw",!1,1,(function(){e.hands.skeleton&&(e.throwingGrenade=!1,e.gripBone._frozen=!1)}))},Jo.prototype.setShellColor=function(e){(e<0||e>=shellColors.length)&&(console.log("Shell color out of bounds: "+e),e=0);var i=t.Color3.FromHexString(shellColors[__uv.$wrap((e))]);this.bodyMesh.colorMult=i,this.hands.colorMult=i},Jo.prototype.setWeaponSkeleton=function(e){this.skeleton=e,this.weaponGripBone=this.skeleton.bones[__uv.$wrap((this.skeleton.getBoneIndexByName("gripHand")))],this.weaponForeBone=this.skeleton.bones[__uv.$wrap((this.skeleton.getBoneIndexByName("foreHand")))]},Jo.prototype.handsToWeaponSkeleton=function(){this.gripBone.position=this.weaponGripBone.position,this.gripBone.setRotationQuaternion(this.weaponGripBone.rotationQuaternion),1!=this.throwingGrenade&&(this.foreBone.position=this.weaponForeBone.position,this.foreBone.setRotationQuaternion(this.weaponForeBone.rotationQuaternion))},Jo.prototype.setupStowAnims=function(e,i){e=void 0===e?-.14:e,i=i?-1:1;var r=new t.Animation("","rotation",60,t.Animation.ANIMATIONTYPE_VECTOR3,t.Animation.ANIMATIONLOOPMODE_CONSTANT),n=new t.Animation("","scaling",60,t.Animation.ANIMATIONTYPE_VECTOR3,t.Animation.ANIMATIONLOOPMODE_CONSTANT),a=new t.Animation("","position",60,t.Animation.ANIMATIONTYPE_VECTOR3,t.Animation.ANIMATIONLOOPMODE_CONSTANT),o=new t.CubicEase;o.setEasingMode(t.EasingFunction.EASINGMODE_EASEINOUT),r.setEasingFunction(o);var s=new t.CubicEase;s.setEasingMode(t.EasingFunction.EASINGMODE_EASEINOUT),n.setEasingFunction(s);var l=new t.CubicEase;l.setEasingMode(t.EasingFunction.EASINGMODE_EASEINOUT),a.setEasingFunction(l);var c=[{frame:0,value:new t.Vector3(-.035,e*i,0)},{frame:25,value:new t.Vector3(1,-1.5*i,0)},{frame:30,value:new t.Vector3(-1,-1.5*i,0)},{frame:55,value:new t.Vector3(-.035,e*i,0)}],u=[{frame:0,value:new t.Vector3(1,1,1)},{frame:25,value:new t.Vector3(.25*i,.25,.25)},{frame:30,value:new t.Vector3(.25*i,.25,.25)},{frame:55,value:new t.Vector3(1*i,1,1)}],h=[{frame:0,value:new t.Vector3(0,0,0)},{frame:25,value:new t.Vector3(.1*i,.1,-.2)},{frame:30,value:new t.Vector3(.1*i,0,-.2)},{frame:55,value:new t.Vector3(0,0,0)}];r.setKeys(c),n.setKeys(u),a.setKeys(h),this.gunContainer.animations.push(r),this.gunContainer.animations.push(n),this.gunContainer.animations.push(a)},Gt.OverlayColor={green:t.Color3.Green(),red:new t.Color3(255,0,0)};const $o=()=>{pokiActive&&(thirdPartyAdblocker||"undefined"!=typeof googletag&&window.googletag&&googletag.apiReady&&googletag.pubads().addEventListener("impressionViewable",e=>{const t=e.slot.getSlotElementId(),i=document.getElementById(t).parentNode.id;i&&ga("send","event","Poki","Display ad",i)}))},es=()=>{pokiActive&&PokiSDK.gameLoadingStart()},ts=()=>{pokiActive&&PokiSDK.gameLoadingFinished()},is=()=>{pokiActive&&PokiSDK.gameplayStart()},rs=()=>{pokiActive&&PokiSDK.gameplayStop()},ns=e=>{pokiActive&&PokiSDK.happyTime(e)},as=()=>{},os=()=>{pokiActive&&(vueData.isPokiGameLoad=!0)},ss=()=>{pokiActive&&(console.log("clearPokiRewardTimer"),vueData.isPokiGameLoad=!1,vueData.isPokiNewRewardTimer=!1,vueData.pokiRewardReady=!1)};class ls{constructor(){this.currencies=[],this.items=[],this.subscriptions=[],this.initalized=!1}init(){null!=Ue?(this.currencies=Ue.filter(e=>"currency"===e.type),this.items=Ue.filter(e=>"item"===e.type),this.subscriptions=Ue.filter(e=>"subscription"===e.type),this.initalized=!0):console.log("No products")}getBySku(e){if(this.initalized)return Ue.filter(t=>t.sku===e)}getShopItems(){if(this.initalized)return Ue.filter(e=>e.isActive&&"item"===e.type)}getStoreItems(){if(this.initalized)return Ue.filter(e=>e.inStore&&e.isActive)}getSubscriptions(){if(this.initalized)return Ue.filter(e=>"subscription"===e.type&&e.isActive)}getBundles(){if(this.initalized)return Ue.filter(e=>"bundle"===e.type&&e.isActive)}getBundlesByItemId(e){return this.getBundles().filter(t=>{if(t.length!=e.length)return[];{let e=[];for(let i=0;i<t.length;i++){if(t[__uv.$wrap((i))]!==b[__uv.$wrap((i))])return[];e=t}return t}})}getProductType(e){const t=Ue.filter(t=>t.sku===e);if(t.hasOwnProperty("length")&&t.length>0&&t[__uv.$wrap((0))].hasOwnProperty("type"))return t[__uv.$wrap((0))].type}getActiveByType(e){if(this.initalized)return this[__uv.$wrap((e))].filter(e=>e.isActive)}getProductTitleByEggVaule(e){if(!this.initalized)return;let t=this.currencies.filter(t=>t.currency==e);return t.length>0?t[__uv.$wrap((0))].sku:void 0}}class cs{constructor(e){this.url=e,this.ws=null,this.queue=[],this.reconnectTimeout=null,this.reconnectTimeoutTime=0,this.pingInterval=null,this.connect(e)}connect(){if(!this.ws||this.ws.readyState!==WebSocket.CONNECTING&&this.ws.readyState!==WebSocket.OPEN){console.log("ReliableWebSocket: Connecting to "+this.url);try{this.ws=new WebSocket(this.url)}catch(e){return void this._onerror(e)}this.ws.onopen=()=>{console.log("ReliableWebSocket: Connected to "+this.url),this.reconnectTimeoutTime=0,this.queue.forEach(e=>{this.ws.send(e)}),this.queue=[],this.pingInterval=setInterval(()=>{this.ws.send("ping")},3e4),this.onopen()},this.ws.onclose=e=>{console.log(`ReliableWebSocket: Disconnected from ${this.url} with code ${e.code} - Attempting to reconnect in ${this.reconnectTimeoutTime} seconds...`),clearInterval(this.pingInterval),e.code===We.NORMAL_CLOSURE||this.reconnectTimeout||(this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=null,this.connect()},1e3*this.reconnectTimeoutTime),this.reconnectTimeoutTime=Math.min(this.reconnectTimeoutTime+1,10)),this.onclose(e)},this.ws.onerror=e=>this._onerror(e),this.ws.onmessage=e=>this.onmessage(e)}}send(e){this.ws.readyState===WebSocket.OPEN?this.ws.send(e):(this.queue.push(e),this.ws.readyState!==WebSocket.CONNECTING&&this.connect())}_onerror(e){this.reconnectTimeoutTime>4&&(this.queue=[],this.onerror(e))}onopen(){}onclose(e){}onmessage(e){}onerror(e){}}function us(e){this.rocket=e,this.scene=e.scene,this.armed=!1,this.delayFrames=0,this.mesh=this.scene.getMeshByName("rocket").createInstance(""),this.mesh.setEnabled(!1)}us.v3_1=new t.Vector3,us.prototype.fire=function(){this.armed=!1,this.delayFrames=2,this.mesh.position.x=this.rocket.x,this.mesh.position.y=this.rocket.y,this.mesh.position.z=this.rocket.z;var e=us.v3_1;e.set(this.rocket.x+this.rocket.dx,this.rocket.y+this.rocket.dy,this.rocket.z+this.rocket.dz),this.mesh.lookAt(e)},us.prototype.update=function(){if(--this.delayFrames<=0&&this.mesh.setEnabled(!0),!this.armed&&this.rocket.minRange<=0&&(this.armed=!0,Ti.play("gun_rpegg_rocket_fly",this.mesh.position,!0)),this.delayFrames%2==0){var e=.04*Math.random()-.02,t=.04*Math.random()-.02,i=.04*Math.random()-.02;this.armed&&(Nr(Ei,30,this.rocket.x,this.rocket.y,this.rocket.z,e,t,i,.4,0,null),Nr(Pi,10,this.rocket.x,this.rocket.y,this.rocket.z,e,t,i,.4,0,null))}this.mesh.position.x+=.5*(this.rocket.x-this.mesh.position.x),this.mesh.position.y+=.5*(this.rocket.y-this.mesh.position.y),this.mesh.position.z+=.5*(this.rocket.z-this.mesh.position.z)},us.prototype.remove=function(){this.mesh.setEnabled(!1)};var hs=!1;const ds=__uv.$get(location).hostname.startsWith("localshelldev"),ps=__uv.$get(location).hostname.startsWith("localhost");var ms=`${isHttps()?"wss":"ws"}://${__uv.$get(location).hostname}/services/`;let _s=new URLSearchParams(__uv.$get(location).search).get("portalTest");_s&&(dynamicContentRoot=_s+".shellshock.io",dynamicContentPrefix=`https://${_s}.shellshock.io/`),dynamicContentRoot?ms=(isHttps()?"wss":"ws")+"://"+dynamicContentRoot+"/services/":(ps||ds||__uv.$get(location).hostname.startsWith("staging"))&&(hs=!0);var fs=new Blob(["\nvar sessionId;\nvar servicesServer;\nvar timeout;\n\nonmessage = function (e) {\n\tservicesServer = e.data.servicesServer;\n\tsessionId = e.data.sessionId;\n\tclearTimeout(timeout);\n\n\tif (sessionId !== null) {\n\t\ttimeout = setTimeout(() => renewSession(), 600000);\n\t}\n}\n\nfunction renewSession () {\n\tcallRenew(res => {\n\t\tif (res.data === 'renewed') {\n\t\t\tconsole.log('Session renewed');\n\t\t\ttimeout = setTimeout(() => renewSession(), 600000);\n\t\t}\n\t\telse {\n\t\t\tconsole.log('Session expired');\n\t\t\tpostMessage('expired');\n\t\t}\n\t},\n\t\t() => {\n\t\t\tconsole.log('Failed to renew session - Trying again in 30 seconds');\n\t\t\ttimeout = setTimeout(() => renewSession(), 30000);\n\t\t}\n\t);\n}\n\nfunction callRenew (successCallback, errorCallback) {\n\tconsole.log('callRewew');\n\n\ttry {\n        var servicesWs = new WebSocket(servicesServer);\n\t} catch (e) {\n\t\terrorCallback();\n\t}\n\n\tservicesWs.onopen = function (e) {\n\t\tservicesWs.send(JSON.stringify({\n\t\t\tcmd: 'renewSession',\n\t\t\tsessionId: sessionId\n\t\t}));\n\t};\n\n\tservicesWs.onmessage = function (e) {\n\t\tvar response = null;\n\t\ttry {\n\t\t\tresponse = JSON.parse(e.data);\n\t\t\tsuccessCallback(response);\n\t\t} catch (e) {\n\t\t\terrorCallback();\n\t\t}\n\n\t\tservicesWs.close();\n\t};\n\n\tservicesWs.onerror = function (e) {\n\t\terrorCallback();\n\t};\n}\n"]),gs=window.URL.createObjectURL(fs);const ys=new Worker(gs);function vs(){(L={volume:getStoredNumber("volume",1),mouseSensitivity:getStoredNumber("mouseSensitivity",null),mouseSpeed:getStoredNumber("mouseSpeed",50),mouseInvert:getStoredNumber("mouseInvert",1),fastPollMouse:getStoredBool("fastPollMouse",!1),holdToAim:getStoredBool("holdToAim",!0),enableChat:getStoredBool("enableChat",!0),safeNames:getStoredBool("safeNames",!1),autoDetail:getStoredBool("autoDetail",!0),shadowsEnabled:getStoredBool("shadowsEnabled",!0),highRes:getStoredBool("highRes",!0),controllerSpeed:getStoredNumber("controllerSpeed",20),deadzone:getStoredNumber("deadzone",.3),controllerInvert:getStoredNumber("controllerInvert",1),controls:getStoredObject("controls",{keyboard:{game:{up:"W",down:"S",left:"A",right:"D",jump:"SPACE",melee:"F",inspect:"G",fire:"MOUSE 0",scope:"SHIFT",reload:"R",swap_weapon:"E",grenade:"Q"},spectate:{ascend:"SPACE",descend:"SHIFT",toggle_freecam:"V"}},gamepad:{game:{jump:0,fire:7,scope:6,reload:2,swap_weapon:3,grenade:5,melee:1,inspect:4},spectate:{ascend:6,descend:7}}}),musicVolume:getStoredNumber("musicVolume",.5),musicStatus:getStoredBool("musicStatus",!0),hideBadge:getStoredBool("hideBadge",!1),closeWindowAlert:getStoredBool("closeWindowAlert",!1),shakeEnabled:getStoredBool("shakeEnabled",!0),centerDot:getStoredBool("centerDot",!0)}).mouseSpeed||null===L.mouseSensitivity||(L.mouseSpeed=Math.floor(Math.sqrt(350*L.mouseSensitivity)+19),localStore.removeItem("mouseSensitivity")),function e(t,i){Object.keys(t).forEach(r=>{"object"==typeof t[__uv.$wrap((r))]?(i[__uv.$wrap((r))]||(i[__uv.$wrap((r))]={}),e(t[__uv.$wrap((r))],i[__uv.$wrap((r))])):i[__uv.$wrap((r))]||(i[__uv.$wrap((r))]=t[__uv.$wrap((r))])})}({keyboard:{game:{up:"W",down:"S",left:"A",right:"D",jump:"SPACE",melee:"F",inspect:"G",fire:"MOUSE 0",scope:"SHIFT",reload:"R",swap_weapon:"E",grenade:"Q"},spectate:{ascend:"SPACE",descend:"SHIFT",toggle_freecam:"V"}},gamepad:{game:{jump:0,fire:7,scope:6,reload:2,swap_weapon:3,grenade:5,melee:1,inspect:4},spectate:{ascend:6,descend:7}}},L.controls),xs(L.controls),vueApp.setUiSettings(L)}function bs(){localStore.setItem("volume",L.volume),localStore.setItem("mouseSpeed",L.mouseSpeed),localStore.setItem("mouseInvert",L.mouseInvert),localStore.setItem("fastPollMouse",L.fastPollMouse),localStore.setItem("holdToAim",L.holdToAim),localStore.setItem("enableChat",L.enableChat),localStore.setItem("safeNames",L.safeNames),localStore.setItem("autoDetail",L.autoDetail),localStore.setItem("shadowsEnabled",L.shadowsEnabled),localStore.setItem("highRes",L.highRes),localStore.setItem("controllerSpeed",L.controllerSpeed),localStore.setItem("deadzone",L.deadzone),localStore.setItem("controllerInvert",L.controllerInvert),localStore.setItem("controls",JSON.stringify(L.controls)),localStore.setItem("musicVolume",L.musicVolume),localStore.setItem("musicStatus",L.musicStatus),localStore.setItem("hideBadge",L.hideBadge),localStore.setItem("closeWindowAlert",L.closeWindowAlert),localStore.setItem("shakeEnabled",L.shakeEndabled),localStore.setItem("centerDot",L.centerDot)}function xs(e){W={keyboard:{game:{},spectate:{}},gamepad:{game:{},spectate:{}}},Object.keys(e.keyboard).forEach(t=>{Object.keys(e.keyboard[__uv.$wrap((t))]).forEach(i=>{W.keyboard[__uv.$wrap((t))][__uv.$wrap((e.keyboard[__uv.$wrap((t))][__uv.$wrap((i))]))]=i})}),Object.keys(e.gamepad).forEach(t=>{Object.keys(e.gamepad[__uv.$wrap((t))]).forEach(i=>{W.gamepad[__uv.$wrap((t))][__uv.$wrap((e.gamepad[__uv.$wrap((t))][__uv.$wrap((i))]))]=i})})}function Ss(e,t){if(0===e)return console.log("game volume suspended"),vueApp.volume=0,fi.setVolume(0),fi.suspend();e=e||L.volume,console.log("volume set to: "+e),fi.resume(),fi.setVolume(e),vueApp.volume=e}function Ts(e){L.mouseSpeed=e}function Es(e){L.controllerSpeed=e}function Ps(e){L.deadzone=e}function As(e,i){this.spatula=e,this.scene=e.scene,this.mesh=this.scene.cloneMesh("spatula"),this.mesh.emissiveColor=new t.Color3(.8,.6,.2),this.mesh.setRenderingGroupId(1)}function Ms(){this.dx=0,this.dy=0,this.dz=0,this.playerIdx=0}ys.onmessage=e=>{"expired"===e.data&&vueApp.showGenericPopup("session_expired","session_expired_msg","ok")},t.Effect.ShadersStore.standardVertexShader="\n#include<instancesDeclaration>\n#include<bonesDeclaration>\n\nprecision lowp float;\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec2 uv;\n\n// Uniforms\nuniform mat4 view;\nuniform mat4 viewProjection;\nuniform mat4 shadowLightMat;\nuniform vec3 cameraPosition;\nuniform vec3 colorMult;\n\n// Varying\nvarying vec4 vPositionFromLight;\nvarying vec3 vPositionFromCamera;\nvarying vec3 vNormal;\nvarying vec4 vColor;\nvarying vec4 vEmissiveColor;\nvarying float fFogDistance;\n\n#ifdef EGGSHELL\n\tvarying vec2 vUV;\n#endif\n\n/*\nvec4 distort(vec4 p)\n{\n    vec2 v = p.xy / p.w;\n\n    // Convert to polar coords:\n    float theta  = atan(v.y,v.x);\n    float radius = length(v);\n\n    // Distort:\n    radius = pow(radius, 0.9);\n\n    // Convert back to Cartesian:\n    v.x = radius * cos(theta);\n    v.y = radius * sin(theta);\n    p.xy = v.xy * p.w;\n    return p;\n}\n*/\n\n// MAIN\nvoid main(void) {\n\t#include<instancesVertex>\n\t#include<bonesVertex>\n\tvec4 worldPosition = finalWorld * vec4(position, 1.);\n\n\t#ifdef RECEIVESHADOWS\n\t\tvPositionFromLight = shadowLightMat * worldPosition;\n\t#endif\n\n\tvNormal = normalize(vec3(finalWorld * vec4(normal, 0.0)));\n\tvColor = color;\n\t\n\t#ifdef COLORMULT\n\t\tvColor.rgb *= colorMult;\n\t#endif\n\n\t#ifdef COLORIZE\n\t\tvColor.rgb = colorMult;\n\t#endif\n\n\tfFogDistance = (view * worldPosition).z;\n\tgl_Position = viewProjection * worldPosition;\n\n\t#ifdef EGGSHELL\n\t\tvUV = uv;\n\t\tvPositionFromCamera = normalize(cameraPosition - worldPosition.xyz);\n\t#endif\n}\n",t.Effect.ShadersStore.standardPixelShader="\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\n\nprecision lowp float;\n\n// Uniforms\nuniform sampler2D shadowSampler;\nuniform vec3 shadowParams;\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nuniform vec3 emissiveColor;\nuniform mat4 worldView;\nuniform float hp;\nuniform vec3 colorMult;\nuniform vec4 outlineColor;\nuniform sampler2D textureSampler;\nuniform vec2 stampOffset;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\n\n// Varying\nvarying vec4 vPositionFromLight;\nvarying vec3 vPositionFromCamera;\nvarying vec4 vColor;\nvarying vec2 vUV;\nvarying vec3 vNormal;\nvarying float fFogDistance;\n\nconst float sOff = .001;\n\n// FUNCTIONS\nfloat unpack(vec4 color)\n{\n\tconst vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\n\treturn dot(color, bit_shift);\n}\n\nfloat random(vec2 p)\n{\n    vec2 K1 = vec2(23.14069263277926, 2.665144142690225);\n    return fract(cos(dot(p, K1)) * 12345.6789);\n}\n\nfloat calcFogFactor()\n{\n\tfloat fogCoeff = 1.0;\n\tfloat fogStart = vFogInfos.y;\n\tfloat fogEnd = vFogInfos.z;\n\tfloat fogDensity = vFogInfos.w;\n\n\tfogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity); // Exp2\n\n\treturn clamp(fogCoeff, 0.0, 1.0);\n}\n\nfloat computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness)\n{\n\tvec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;\n\tdepth = 0.5 * depth + vec3(0.5);\n\tvec2 uv = depth.xy;\n\n\tif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n\t{\n\t\treturn 1.0;\n\t}\n\n\t#ifndef SHADOWFULLFLOAT\n\t\tfloat shadow = unpack(texture2D(shadowSampler, uv));\n\t#else\n\t\tfloat shadow = texture2D(shadowSampler, uv).x;\n\t#endif\n\n\tif (depth.z < shadow) return 1.;\n\tfloat s = clamp((depth.z - shadow) * 12. + 0.5, 0.5, 1.0);\n\treturn min(1.0, max(s, length(vPositionFromLight.xy)));\n}\n\nvec3 desaturate(vec3 color, float amount)\n{\n    vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n    return vec3(mix(color, gray, amount));\n}\n\n// MAIN\nvoid main(void)\n{\n\tvec4 color = vColor;\n\n\t#ifdef EGGSHELL // Show cracks and stamp texture!\n\t\tcolor.rgb = min((color.rgb - 0.5) * 4. + hp + 2., 1.);\n\t\tcolor.rgb *= colorMult;\n\t\tvec2 uv = clamp(vUV, vec2(0., 0.96875), vec2(.03125, 1.));\n\t\t//vec2 uv = clamp(vUV, vec2(0., 0.9375), vec2(.0625, 1.));\n\t\tuv += stampOffset;\n\t\tcolor.rgb = mix(color.rgb, texture2D(textureSampler, uv).rgb, texture2D(textureSampler, uv).a);\n\t#endif\n\n\t#ifdef RECEIVESHADOWS\n\t\tfloat s = computeShadow(vPositionFromLight, shadowSampler, shadowParams.x);\n\t\tcolor *= vec4(s, s, s, 1.);\n\t#endif\n\n\t#ifndef MAP // Not the map; use dynamic light\n\t\tcolor.rgb *= max(max(0.3, -vNormal.y * 0.4), dot(vNormal, sunDirection * 1.) + 0.4);\n\t\tcolor.rgb *= sunColor;\n\t#endif\n\n\t#ifdef FLASH\n\t\tcolor.rgb += emissiveColor;\n\t#endif\n\n\tfloat fog = calcFogFactor();\n\tcolor.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;\n\n\t#ifdef EGGSHELL\n\t\tfloat f = step(dot(vNormal, vPositionFromCamera), 0.4);\n\t\tcolor.rgb = mix(color.rgb, outlineColor.rgb, f * outlineColor.a);\n\t#endif\n\n\tgl_FragColor = color;\n}\n",As.prototype.drop=function(){this.mesh.__uv$setSource(__uv).__uv$parent=null,fi.play("drop_spatula")},As.prototype.update=function(e){if(this.mesh.position.x+=.5*(this.spatula.x-this.mesh.position.x),this.mesh.position.y+=.5*(this.spatula.y+.1-this.mesh.position.y),this.mesh.position.z+=.5*(this.spatula.z-this.mesh.position.z),255==this.spatula.controlledBy)this.mesh.rotation.y+=.1*e;else{var t=ar[__uv.$wrap((this.spatula.controlledBy))];t&&(this.mesh.rotation.y=t.yaw)}};const Cs={freeCamera:0,firstPerson:1};function Rs(){getRequest("data/twitchStreams.json?"+Date.now(),(e,t)=>{if(!e){let e=JSON.parse(t);console.log(e),e.sort((e,t)=>t.viewers-e.viewers);let i=e.map(e=>({name:e.name,viewers:e.viewers,link:"https://twitch.tv/"+e.name,image:dynamicContentPrefix+"data/img/twitchAvatars/"+e.avatar}));vueApp.twitchStreams=i}},(function(e){console.log("Failed to load Twitch streamers"),vueApp.twitchStreams=[]}))}function ws(e,t){const i=function(){let e="Shell Shockers";return pokiActive?e="Poki":crazyGamesActive&&(e="Crazy Games"),e}();if(console.log("getXsollaToken called (firebase ID: {0})".format(H.firebaseId),t),me=e,!H.isAnonymous&&H.isEmailVerified){!function(e,t,i,r,n){r=r||!1,hi({cmd:"xsollaToken",firebaseId:H.firebaseId,productSku:e,subscription:r,playerSource:n},t,i)}(e,(function(e){e.error?(console.log("xsollaTokenResponse Error: "+JSON.stringify(e)),disableProductPurchasing()):(console.log("response: "+JSON.stringify(e)),"SUCCESS"==e.result?(console.log("Got Xsolla token: "+e.token),function(e){var t={access_token:e,sandbox:__uv.$get(location).hostname.startsWith("localshelldev")||__uv.$get(location).hostname.startsWith("staging"),lightbox:{spinner:"round",overlayOpacity:.8}},i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="//static.xsolla.com/embed/paystation/1.0.7/widget.min.js",i.addEventListener("load",(function(e){XPayStationWidget.on("init",(function(e){console.log("Xsolla PayStation initialized"),XPayStationWidget.open()})),XPayStationWidget.on("close",(function(e){console.log("Xsolla PayStation closed"),V&&(vueApp.showGameMenu(),vueApp.setDarkOverlay(!1)),setTimeout((function(){di(),li()}),3e3)})),XPayStationWidget.on("open",(function(e){V&&vueApp.hideGameMenu(),console.log("Xsolla PayStation open"),console.log(me)})),XPayStationWidget.on("status",(function(e){console.log("Xsolla PayStation status"),console.log("status",e),console.log(me)})),XPayStationWidget.on("status-invoice",(function(e){console.log("Xsolla PayStation status-invoice"),console.log("status-invoice",e),console.log(me)})),XPayStationWidget.on("status-delivering",(function(e){console.log("Xsolla PayStation status-delivering"),console.log("status-delivering",e),console.log(me)})),XPayStationWidget.on("status-done",(function(e){console.log("Xsolla PayStation status-done"),console.log("status-done",e),console.log(me),localStore.setItem("xsollaPurchase",!0),"golden_chicken_pass"===me&&ns(1),(()=>{if(!hasValue(me))return;let e=vueData.eggStoreItems.filter(e=>e.sku===me)[__uv.$wrap((0))],t=e.sku,i=e.salePrice?Math.round(e.salePrice):"",r=Math.round(e.price),n=i||r;if(!hasValue(t)&&!hasValue(n))return console.log("No Price no sku"),void(me=null);let a=vueApp.eggStoreReferral?t+" "+vueApp.eggStoreReferral:t;me=null,ga("send","event",vueApp.googleAnalytics.cat.purchases,vueApp.googleAnalytics.action.purchaseComplete,a,n)})()})),XPayStationWidget.init(t)}),!1),document.getElementsByTagName("head")[__uv.$wrap((0))].appendChild(i),xsollaSetup=!0}(e.token),console.log(e)):(console.log("Failed to get Xsolla token"),Is()))}),(function(e){console.log("Error getting Xsolla token: "+JSON.stringify(e)),Is()}),t,i)}else vueApp.denyAnonUser()}Gt.v1=new t.Vector3,Gt.v2=new t.Vector3,Gt.ray=new t.Ray,Gt.matrix=new t.Matrix,Ms.prototype.firstPerson=function(){let e=ar[__uv.$wrap((this.playerIdx))];e&&e.playing&&this.playerIdx!==u||(e=this.findNextPlayer()),e&&this.spectatePlayer(e)},Ms.prototype.freeCamera=function(){R!==u&&(ir.pitch=a.rotation.x,ir.yaw=a.rotation.y),a.__uv$setSource(__uv).__uv$parent=null,a.lockedTarget=null,R=u,rr=ir,Wi=0,vueData.ui.game.spectatingPlayerName=null,this.restorePreviousPlayerActor()},Ms.prototype.restorePreviousPlayerActor=function(){let e=ar[__uv.$wrap((this.playerIdx))];e&&e.actor.hat&&e.actor.hat.setVisible(!0)},Ms.prototype.spectatePlayer=function(e){this.restorePreviousPlayerActor(),this.playerIdx=e.id,R=e.id,rr=e,e.actor.mesh.setVisible(!0),e.actor.hat&&e.actor.hat.setVisible(!1),a.lockedTarget=null,Di=!1,An(),vueData.ui.game.spectatingPlayerName=e.name,Ji.autoClear=!0,Ji.autoClearDepthAndStencil=!0},Ms.prototype.spectateNextPlayer=function(e=1){let t=this.findNextPlayer(e);t&&this.spectatePlayer(t)},Ms.prototype.findNextPlayer=function(e=1){let t=null;for(var i=[],r=0;r<playerLimit;r++){let e=ar[__uv.$wrap((r))];e&&i.push(e.id)}if(0===i.length)return this.unlock(),null;xa.sortPlayerList(i);for(let e=0;e<i.length;e++)if(ar[__uv.$wrap((i[__uv.$wrap((e))]))].id===this.playerIdx){t=e;break}null===t&&(t=0);let n=t;for(;n=Math.mod(n+e,i.length),n!==t;){let e=ar[__uv.$wrap((i[__uv.$wrap((n))]))];if(e&&e.playing&&e.id!==u)return e}return this.unlock(),null},Ms.prototype.unlock=function(){R=null,rr=null,this.playerIdx=null},Ms.prototype.update=function(e){if(Gi===Cs.firstPerson)rr&&rr.playing&&(a.position.copyFrom(rr.actor.eye.getAbsolutePosition()),a.rotation.y=rr.actor.mesh.rotation.y,a.rotation.x=rr.actor.head.rotation.x);else{var i=0,r=0,n=0;Wi&Lt.left&&(i-=Math.cos(ir.yaw),n+=Math.sin(ir.yaw)),Wi&Lt.right&&(i+=Math.cos(ir.yaw),n-=Math.sin(ir.yaw)),Wi&Lt.up&&(i+=Math.sin(ir.yaw),n+=Math.cos(ir.yaw)),Wi&Lt.down&&(i-=Math.sin(ir.yaw),n-=Math.cos(ir.yaw)),Wi&Lt.ascend&&(r=1),Wi&Lt.descend&&(r=-1);var o=new t.Vector3(i,r,n).normalize(),s=this.dx,l=this.dy,c=this.dz;this.dx+=.016*o.x,this.dy+=.008*o.y,this.dz+=.016*o.z;var u=.5*(this.dx+s),h=.5*(this.dy+l),d=.5*(this.dz+c);a.position.x+=u*e,a.position.y+=h*e,a.position.z+=d*e,a.position.y=Math.max(1.5,a.position.y),ir.x=a.position.x,ir.y=a.position.y,ir.z=a.position.z,this.dx*=Math.pow(.85,e),this.dy*=Math.pow(.85,e),this.dz*=Math.pow(.85,e),a.rotation.x=ir.pitch,a.rotation.y=ir.yaw}},window.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),window.onresize=function(){La()},window.mobileAndTabletcheck=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),/Googlebot/i.test(navigator.userAgent)&&(t=!1),t},window.onloadingcomplete=function(){if("undefined"==typeof startVue||"undefined"==typeof firebase)return void setTimeout(window.onloadingcomplete,100);if((()=>{if(po())return console.log("Not playing in iframe"),!0;console.log("Playing in iframe");const e=mo();e.domain,e.index;return!0})())return console.log("startShellShockers"),Ta(),void(window.onload=null);const e=__uv.$get(location).protocol+"//"+__uv.$get(location).host;window.__uv$setSource(__uv).__uv$location.href=e+"/portals"},window.onbeforeunload=()=>{if(V&&L.closeWindowAlert)return e.preventDefault(),e.returnValue="Are you sure you want to exit?",e.returnValue;V&&hasValue(Ce.sessionStart)&&(Po(o,Ct[__uv.$wrap((p))].name),to(Ce.end()),io())};function Is(){vueApp.showGenericPopup("uh_oh","purchase_disabled","ok")}ea.state={start:0,score:1,win:2,capturing:3,contested:4,takeover:5,abandoned:6,unclaimed:7},ea.captureSpeeds=[1.2,1.5,2.04,3,4.8],ea.goalScore=5,ea.takeOverTime=90,ea.takeOverSpeed=1;class Os{static normalizeManhattan(e){var t=Math.abs(e.x),i=Math.abs(e.y),r=Math.abs(e.z),n=Math.max(t,Math.max(i,r));return 0==n?(e.x=0,e.y=0,e.z=0):(e.x=.5*Math.trunc(e.x/n),e.y=.5*Math.trunc(e.y/n),e.z=.5*Math.trunc(e.z/n)),e.x*e.y!=0||e.x*e.z!=0||e.y*e.z!=0}static stripTris(e,i,r,n){for(var a=r.getIndices(),o=r.getVerticesData(t.VertexBuffer.PositionKind),s=r.getVerticesData(t.VertexBuffer.NormalKind),l=new t.Vector3,c=new t.Vector3,u=[],h={x:0,y:0,z:0},d=0;d<a.length;d+=3){for(var p=!1,m=0,_=0,f=0,g=0,y=0,v=0,b=0;b<3;b++){var x=a[__uv.$wrap((d+b))],S=n[__uv.$wrap((x))];if(x*=3,!S){p=!0;break}m=o[__uv.$wrap((x+0))],_=o[__uv.$wrap((x+1))],f=o[__uv.$wrap((x+2))],h.x=m-S.x,h.y=_-S.y,h.z=f-S.z;var T=this.normalizeManhattan(h);g=.75*s[__uv.$wrap((x+0))],y=.75*s[__uv.$wrap((x+1))],v=.75*s[__uv.$wrap((x+2))];if(T){if(l.set(g,y,v).normalize(),c.set(h.x,h.y,h.z).normalize(),t.Vector3.Dot(l,c)<.5){p=!0;break}var E=Math.floor(S.x+g+.5),P=Math.floor(S.y+y+.5),A=Math.floor(S.z+v+.5)}else E=Math.floor(m+h.x+.5),P=Math.floor(_+h.y+.5),A=Math.floor(f+h.z+.5);if(!p)try{var M=e[__uv.$wrap((E))][__uv.$wrap((P))][__uv.$wrap((A))];if(!M||!M.idx){p=!0;break}if(!i[__uv.$wrap((M.idx))].name.endsWith(".full")){p=!0;break}}catch(e){p=!0;break}}p&&(u.push(a[__uv.$wrap((d+0))]),u.push(a[__uv.$wrap((d+1))]),u.push(a[__uv.$wrap((d+2))]))}return r.setIndices(u),r}static createMapCells(e,i,r,n,a,o){var s;if(n){if(!r.data[__uv.$wrap((n))])return void o();s=[n]}else s=Object.keys(r.data);var l=[],c=new t.SolidParticleSystem("SPS",e,{updatable:!0});c.computeParticleColor=!1,c.computeParticleTexture=!1,c.computeParticleRotation=!1,c.recomputeNormals=!1;var u=function e(t){if(t!=s.length){var u=s[__uv.$wrap((t))],h=r.data[__uv.$wrap((u))],d=i[__uv.$wrap((u))];void 0===(y=Ft[__uv.$wrap((d))])&&console.log("mesh not found: "+u);var p=u.split(".");if(y.theme=p[__uv.$wrap((0))],y.colliderType=p[__uv.$wrap((2))],y.softness=p[__uv.$wrap((3))],"SPECIAL"!=y.theme&&("DYNAMIC"!=y.theme||n)){var m,_=0,f=Object.values(h).filter(e=>!a||e.zone==a);c.addShape(y,f.length,{positionFunction:function(e,t,i){var n=f[__uv.$wrap((_))].rx||0,a=f[__uv.$wrap((_))].ry||0,o=f[__uv.$wrap((_))].rz||0;e.position.x=f[__uv.$wrap((_))].x+r.extents.x.min,e.position.y=f[__uv.$wrap((_))].y+r.extents.y.min,e.position.z=f[__uv.$wrap((_))].z+r.extents.z.min,e.rotation.x=n*pn,e.rotation.y=a*pn,e.rotation.z=o*pn,e.alive=!1,m=u.endsWith(".full")||u.includes("capture-zone")?{x:e.position.x,y:e.position.y,z:e.position.z}:0,_++},vertexFunction:function(e,t,i){l.push(m)}})}var g=e.bind(this,t+1);window.requestAnimationFrame(g)}else{var y=c.buildMesh();o(y,l)}}.bind(this,0);window.requestAnimationFrame(u)}}return{catalog:G,play:Xa,getLanguageData:Da,continueStartup:function(){if(vueApp.chwRewardIds=[...vueApp.chwRewardIds,...He],window.addEventListener("beforeinstallprompt",e=>{console.log("pwa Ready"),fe=e,!0}),window.addEventListener("appinstalled",e=>{ga("send","event","pwa","install","success")}),window.mobileAndTabletcheck()){__uv.$get(location).protocol,__uv.$get(location).host;return void(window.__uv$setSource(__uv).__uv$location.href="http://onelink.to/c95n2x")}if(function(){if(navigator.userAgent.indexOf("Edge")>=0)return vueApp.showUnsupportedPlatformPopup("unsupported_oldmsedge"),!0;return!1}())return;if(function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var e=[];t.Engine.isSupported()||e.push('{0} (<a href="https://shellshock.io/faq.html#webgl" target="_window">{1}</a>)'.format(vueApp.loc.missing_webgl,vueApp.loc.missing_moreinfo));(!document.exitPointerLock||navigator.userAgent.indexOf("10.1.2 Safari")>=0)&&e.push('{0} (<a href="https://shellshock.io/faq.html#pointerlock" target="_window">{1}</a>)'.format(vueApp.loc.missing_pointerlock,vueApp.loc.missing_moreinfo));localStore||e.push(vueApp.loc.missing_localstorage);void 0===new KeyboardEvent("").key&&e.push(vueApp.loc.missing_keyboardevent);if(vueApp.missingFeatures=e,e.length>0)return vueApp.showMissingFeaturesPopup(),!0;return!1}())return;!function(){isChrome84=-1!==navigator.userAgent.indexOf("Chrome/84"),isChrome84&&(t.chrome84BugWorkaround=!0);if(localStore.getItem("ssChrome84Bug"))return!1;if(isChrome84)localStore.setItem("ssChrome84Bug",!0)}(),({canvasWrapper:Re,canvas:canvas}=vueApp.getGameElements()),i=new t.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0},!1),r=i.getCaps(),i.disableManifestCheck=crazyGamesActive,i.enableOfflineSupport=!crazyGamesActive,Pe=1;let e=navigator.userAgent+navigator.language+i.getGlInfo().renderer;for(let t in e)Pe=Pe*e.charCodeAt(t)%Number.MAX_SAFE_INTEGER;Pe+=(navigator.hardwareConcurrency+navigator.maxTouchPoints)%Number.MAX_SAFE_INTEGER,itemRenderer=new Ho,function(e){Sa=new t.Scene(i);let r=new t.TargetCamera("camera",t.Vector3.Zero(),Sa);Sa.activeCameras.push(r),console.log("loadResources()"),Xt(Sa),function(e){fi.load("sound/sounds.json?"+Ge).then(()=>e())}(()=>{var i;console.log("sounds loaded"),i=()=>{console.log("object meshes loaded"),itemRenderer.calculateItemAlignments(),Sa.clearCachedVertexData(),function(e,i){Ft=[null];var r=t.MeshBuilder.CreateBox("SPECIAL.barrier.full.verysoft",{size:1},e);(c=new t.StandardMaterial).diffuseColor=t.Color3.Red(),c.emissiveColor=t.Color3.Red(),c.specularColor=t.Color3.Black(),c.wireframe=!0,r.material=c,r.setEnabled(!1),Ft.push(r);for(var n=[],a=0;a<=1;a+=.125){var o=-Math.PI/2+Math.PI*a,s=Math.cos(o),l=.5*Math.sin(o+.05)+.5;s=.25*Math.pow(s,1.3),l=.6*Math.pow(l,1.3)-.48,n.push(new t.Vector3(s,l,0))}var c,u=t.MeshBuilder.CreateLathe("SPECIAL.spawn-blue.none",{shape:n,tessellation:12},e);(c=new t.StandardMaterial).diffuseColor=new t.Color3(0,.5,1),c.specularColor=new t.Color3(.1,.2,.4),c.specularPower=8,u.material=c,u.setEnabled(!1),Ft.push(u),u=t.MeshBuilder.CreateLathe("SPECIAL.spawn-red.none",{shape:n,tessellation:12},e),(c=new t.StandardMaterial).diffuseColor=new t.Color3(1,.25,.25),c.specularColor=new t.Color3(.4,.3,.3),c.specularPower=8,u.material=c,u.setEnabled(!1),Ft.push(u),Yt(e,["map"],(function(e){e.__uv$setSource(__uv).__uv$parent?e.freezeWorldMatrix():Ft.push(e)}),(function(){for(var e=1;e<Ft.length;e++){var t=Ft[__uv.$wrap((e))].getChildMeshes()[__uv.$wrap((0))];t&&(Ft[__uv.$wrap((e))].colliderMesh=t)}i()}))}(Sa,()=>{console.log("map meshes loaded"),Ft.push({name:"SPECIAL.spatula.none"}),Sa.cleanCachedTextureBuffer(),e()})},Yt(Sa,["egg","gun_eggk47","gun_csg1","gun_cluck9mm","gun_dozenGauge","gun_rpegg","gun_smg","gun_m24","gun_aug","munitions","muzzleFlash","items","reticle","melee"],null,i)})}(()=>{if(navigator.onLine&&!z?la():(H=new Zo,k=!0),bo.init(),vs(),Rs(),getRequest("data/housePromo.json?"+Date.now(),(function(e,t){if(e)le={big:[],small:[],bigBanner:[],houseAdPercentChance:100,smHouseAds:[]};else{const e={socialMedia:"",premFeat:""};le=JSON.parse(t),function(){for(var e=[],t=0;t<le.small.length;t++)le.small[__uv.$wrap((t))].active&&e.push(t);e.length>0&&(v=e[__uv.$wrap((Date.now()%e.length))],vueApp.useHouseAdSmall(le.small[__uv.$wrap((v))]))}(),console.log("special items tag: "+le.specialItemsTag),hasValue(le.specialItemsTag)&&G.getTaggedItems(le.specialItemsTag).length>0?vueApp.useSpecialItemsTag(le.specialItemsTag):vueApp.disableSpecialItems(),hasValue(le.featuredSocialMedia)&&(e.socialMedia=le.featuredSocialMedia),hasValue(le.premFeatured)&&(e.premFeat=le.premFeatured,Fe[__uv.$wrap((e.premFeat))]=!0),le.smHouseAds.length>0&&vueApp.ui.houseAds.homeScreen.push(...le.smHouseAds),vueApp.useTags(e)}!0})),Lo("data/shellNews.json",(function(e){vueApp.newsfeedItems=e})),Lo("data/shellYouTube.json",(function(e){vueApp.youtubeStreams=e})),console.log("From EU: "+isFromEU),Ss(),L.autoDetail||Ga(L.highRes),z)return Y.x=parsedUrl.query.x,Y.y=parsedUrl.query.y,Y.z=parsedUrl.query.z,Y.pitch=parsedUrl.query.pitch,Y.yaw=parsedUrl.query.yaw,playerLimit=1,va={send:function(){}},V=!0,vueApp.setInGame(V),i.stopRenderLoop(),void Pr();U=new Xo,B=!0,Ae=new Yo,$o(),parsedUrl.query.openSettings&&vueApp.showSettingsPopup(),parsedUrl.query.test&&(Z=!0),parsedUrl.query.noSkybox&&(Q=!0),ts(),vueApp.eggStoreItems=ye.getStoreItems(),vueApp.premiumShopItems=ye.getShopItems(),vueApp.subStoreItems=ye.getSubscriptions(),pokiActive&&vueApp.isPlayingPoki(),D=!0})},showSignInDialog:_a,signOut:function(){firebase.auth().signOut().then((function(){(H=new Zo).loggingOut(),void 0!==x||pokiActive||crazyGamesActive||(Pa(),vueApp.showTitleScreenAd()),setTimeout(()=>vueApp.setDarkOverlay(!1),1500)}),(function(e){console.log(e)})),ga("set","dimension4","noVip"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.signIn,vueData.googleAnalytics.label.signInOut),vueApp.photoUrl=null,Oa(),ai(),be=!1},sendFirebaseVerificationEmail:ha,selectRegion:function(e){let t=Wo.regionList.find((function(t){return t.id===e}));hasValue(t)||(t=Wo.regionList[__uv.$wrap((0))]),vueApp.currentRegionId=t.id,localStore.setItem("selectedRegionId",t.id)},generateRandomName:Ba,changeClass:function(e){H.setClass(e)},toggleFullscreen:function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement){(e=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen)&&e.call(document)}else{var e,t=document.documentElement;(e=t.requestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen)&&e.call(t)}},applyUiSettings:function(e,t){var i;Object.values(e.adjusters).forEach(e=>{e.forEach(e=>{L[__uv.$wrap((e.id))]=e.value})}),Object.values(e.togglers).forEach(e=>{e.forEach(e=>{"mouseInvert"===e.id||"controllerInvert"==e.id?L[__uv.$wrap((e.id))]=e.value?-1:1:L[__uv.$wrap((e.id))]=e.value})}),e.controls.keyboard.game.forEach(e=>{L.controls.keyboard.game[__uv.$wrap((e.id))]=e.value}),e.controls.keyboard.spectate.forEach(e=>{L.controls.keyboard.spectate[__uv.$wrap((e.id))]=e.value}),e.controls.gamepad.game.forEach(e=>{L.controls.gamepad.game[__uv.$wrap((e.id))]=e.value}),e.controls.gamepad.spectate.forEach(e=>{L.controls.gamepad.spectate[__uv.$wrap((e.id))]=e.value}),xs(L.controls),Ss(),Ts(L.mouseSpeed),Es(L.controllerSpeed),Ps(L.deadzone),i=L.enableChat,console.log("setting chat: "+i),i?(L.enableChat=!0,localStore.setItem("enableChat",!0),V&&(S.value=ka("ingame_press_enter_to_chat"),T.style.display="block",S.style.display="block")):(L.enableChat=!1,localStore.setItem("enableChat",!1),V&&(T.style.display="none",S.style.display="none")),Ji&&(L.autoDetail?t.autoDetail||(Ga(!0),Ua(!0),Na()):(Ga(L.highRes),Ua(L.shadowsEnabled),Va()),L.centerDot?Bi.showDot():Bi.hideDot()),bs()},resetSettings:function(){localStore.removeItem("volume"),localStore.removeItem("mouseSensitivity"),localStore.removeItem("mouseSpeed"),localStore.removeItem("mouseInvert"),localStore.removeItem("fastPollMouse"),localStore.removeItem("holdToAim"),localStore.removeItem("enableChat"),localStore.removeItem("safeNames"),localStore.removeItem("autoDetail"),localStore.removeItem("shadowsEnabled"),localStore.removeItem("highRes"),localStore.removeItem("controlConfig"),localStore.removeItem("controllerSpeed"),localStore.removeItem("deadzone"),localStore.removeItem("controllerInvert"),localStore.removeItem("controls"),localStore.removeItem("hideBadge"),localStore.removeItem("closeWindowAlert"),localStore.removeItem("shakeEnabled"),localStore.removeItem("centerDot"),vs()},setVolume:Ss,setSafeNames:function(e){if(V){for(var t=0;t<playerLimit;t++){var i=ar[__uv.$wrap((t))];i&&(i.name=e?i.safeName:i.normalName,i.actor.setupNameSprite())}An()}},setMouseSpeed:Ts,setControllerSpeed:Es,setDeadzone:Ps,setShadows:Ua,renderItemToCanvas:function(e,t,i){e.item_type_id===st.Stamp?itemRenderer.renderStampToCanvas(e,t,i):itemRenderer.renderToCanvas(e,t,i)},getEquippedItems:function(){return H.getEquippedItems()},getTaggedItems:function(e,t){return G.getTaggedItems(e,t)},getPremiumItems:function(){return G.getPremiumItems()},getItemsOfType:function(e){switch(e){case st.Hat:return G.hats;case st.Stamp:return G.stamps;case st.Primary:return G.forClass[__uv.$wrap((H.classIdx))].forWeaponSlot[__uv.$wrap((at))];case st.Secondary:return G.forClass[__uv.$wrap((H.classIdx))].forWeaponSlot[__uv.$wrap((ot))];case st.Grenade:return G.grenades;case st.Melee:return G.melee;default:return[]}},isItemOwned:oa,tryEquipItem:function(e,t){if(t=t||e.item_type_id,null===e||oa(e)||"default"===e.unlock)switch(t){case st.Hat:H.hatItem=e;break;case st.Stamp:H.stampItem=e;break;case st.Primary:H.pickWeapon(at,e);break;case st.Secondary:H.pickWeapon(ot,e);break;case st.Grenade:H.grenadeItem=e;break;case st.Melee:H.meleeItem=e}},poseWithItems:e=>U.poseWithItems(e),setShellColor:function(e){H.colorIdx=e,U.poseWithColor(e)},api_checkBalance:di,checkUpgrade:li,api_buy:function(e,t,i){hi({cmd:"buy",firebaseId:H.firebaseId,itemId:e.id,save:"undefined"==typeof checkStatus||checkStatus()},(function(e){switch(console.log("purchase response: "+e.result),e.result){case"SUCCESS":if(hasValue(e.itemId)){var r=G.findItemById(e.itemId);H.addToInventory(r,!0)}H.currentBalance=e.currentBalance,vueApp.statsLoading(),_o(),ns(.5),t();break;case"INSUFFICIENT_FUNDS":vueApp.needMoreEggsPopupCall();break;case"ALREADY_OWNED":vueApp.showGenericPopup("p_buy_owned_title","p_buy_owned_content","ok");break;case"ERROR_CODE_4225":vueApp.showGenericPopup("p_error_4225_title","p_buy_error_content","ok");break;case"PLAYER_NOT_FOUND":case"ITEM_NOT_FOUND":case"ERROR":default:i()}}),(function(){i()}))},api_redeem:function(e,t,i){if(5831==e)return vueApp.giveStuffPopup.eggOrg=!0,void vueApp.showGiveStuffPopup("p_give_stuff_title");hi({cmd:"redeem",firebaseId:H.firebaseId,id:H.id,code:e},(function(e){switch(console.log("Redeem Code response: "+e.result),e.result){case"SUCCESS":e.eggs_given||(e.eggs_given=0),e.item_ids||(e.item_ids=[]),e.eggs_given&&e.eggs_given>0&&di();var r=[];if(e.item_ids)for(var n=0;n<e.item_ids.length;n++){var a=G.findItemById(e.item_ids[__uv.$wrap((n))]);H.addToInventory(a),r.push(a)}ns(.5),t(e.eggs_given,r);break;case"PLAYER_NOT_FOUND":vueApp.showGenericPopup("p_redeem_error_no_player_title","p_redeem_error_no_player_content","ok");break;case"CODE_DOUBLE_DOUBLE":vueApp.showGenericPopup("p_redeem_code_redeem_in_progress_title","p_redeem_code_redeem_in_progress_content","ok");break;case"CODE_PREV_REDEEMED":vueApp.showGenericPopup("p_redeem_prev_title","p_redeem_prev_content","ok");break;case"CODE_NOT_FOUND":vueApp.showGenericPopup("p_redeem_badcode_title","p_redeem_badcode_content","ok");break;case"RATE_LIMIT_REACHED":vueApp.showGenericPopup("p_redeem_ratelimited_title","p_redeem_ratelimited_content","ok");break;case"ERROR":default:i()}}),(function(){console.log("there be an error"),i()}))},saveEquipment:Wa,buyGoldenChicken:function(){ws("golden_chicken_pass")},checkStartChicknWinner:ai,api_feedback:function(e,t,r){const n=()=>vueApp.showGenericPopup("uh_oh","feedback_error_msg","ok");for(var o=i.getGlInfo(),s=i.getCaps(),l=[],c=0;c<lt.length;c++)l.push([H.pickedWeapons[__uv.$wrap((c))][__uv.$wrap((0))].id,H.pickedWeapons[__uv.$wrap((c))][__uv.$wrap((1))].id]);var u="";if(e!==et||hasValue(H.firebaseId)){try{u=JSON.stringify({debugObject:re,debugArray:ie})}catch(e){console.log(e)}hi({cmd:"feedback",feedbackType:e,gameVersion:Ge,userAgent:window.navigator.userAgent,username:vueApp.playerName,comments:r,email:t,firebaseId:H.firebaseId||null,fromEU:isFromEU,gameServer:vueApp.loc[__uv.$wrap((vueApp.currentRegionLocKey))]||null,session:H.session||null,ping:f>0?Math.floor(_/f):null,highestPing:ne||null,fps:y>0?Math.ceil(g/y):null,gameType:h||null,privateGame:null,localKills:ji||0,localDeaths:Xi||0,localStreak:Yi||0,url:parsedUrl.root,referrer:document.referrer,gameCode:d||null,screenSize:screen.width+"x"+screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth,innerSize:window.innerWidth+"x"+window.innerHeight,glVendor:o.vendor,renderer:o.renderer,glVersion:o.version,maxTextureSize:s.maxTextureSize,fov:a?a.fov:null,controls:localStorage.getItem("controls"),ofAge:O?O.ofAge:null,targetedAds:O?O.targetedAds:null,volume:L.volume,mouseSpeed:L.mouseSpeed,mouseInvert:L.mouseInvert,holdToAim:L.holdToAim,enableChat:L.enableChat,safeNames:L.safeNames,autoDetail:L.autoDetail,shadowsEnabled:L.shadowsEnabled,highRes:L.highRes,selectedClass:H.classIdx,selectedColor:H.colorIdx,hat:H.hatItem?H.hatItem.id:null,stamp:H.stampItem?H.stampItem.id:null,grenade:H.grenadeItem?H.grenadeItem.id:null,weapons:"[[0,0],[0,0],[0,0]]",timesPlayed:null,xsollaToken:null,current_balance:H.currentBalance,log:console.logArray(),debug:u},(function(e){const t={title:"",desc:""};e.status?e.type===et?(t.title="feedback_delete_title",t.desc="feedback_delete_msg"):(t.title="feedback_sent_title",t.desc="feedback_sent_msg"):(t.title="uh_oh",t.desc="feedback_error_msg");setTimeout((function(){vueApp.showGenericPopup(t.title,t.desc,"ok")}),1e3)}),(function(e){n()}))}else n()},releaseKeys:In,captureKeys:wn,respawn:function(){return z?(ir.playing=!0,void canvas.requestPointerLock()):(console.log("Respawn pressed - respawnTime: "+Ri),Ri<0?(Ja.clearAll(),$a.clearAll(),Ja.set(()=>{"IFRAME"==document.activeElement.tagName&&(console.log("iframe attempted to steal focus:",document.activeElement),document.activeElement.blur())},100),L.autoDetail&&Na(),function(){if(ge)return!1;if(Ki)return!1;let e=se?3e4:24e4;pokiActive&&(e=0);const t=getStoredNumber("lastPreRoll",Date.now())+e,i=m>1&&Xi>1&&Date.now()>t;let r=xa.timeToPlayVideoAd();return!0===r||!1!==r&&!!i}()?(Ki=!0,void Oe.play("shellshock.io_preroll",Ar)):function(){if(console.log("requestRespawnBlocked "+Ir),Ir)return;if(Ir=!0,setTimeout(()=>Ir=!1,1e3),xr){ir.changeCharacter(H.classIdx,H.getPrimaryWeapon(),H.getSecondaryWeapon(),H.colorIdx,H.hatItem,H.stampItem,H.grenadeItem,H.meleeItem,0,0),(e=bi.getBuffer()).packInt8(Xe.changeCharacter),e.packInt8(H.classIdx),e.send(va),xr=!1}var e;(e=bi.getBuffer()).packInt8(Xe.requestRespawn),e.send(va),is(),vueApp.setPause(!1),crazyGamesActive&&crazysdk.gameplayStart()}()):void 0)},leaveGame:function(e){i&&i.stopRenderLoop(),u=0,R=0,V?(ir&&(H.kills+=ji,H.deaths+=Xi,H.streak=Math.max(Yi,H.streak),Ce.streak=Yi),Ja.clearAll(),$a.clearAll(),clearInterval(Zi),va.close(We.mainMenu),va=null,In(),document.exitPointerLock(),o>0&&(Po(o,Ct[__uv.$wrap((p))].name),Ce.end(),to(),io(),function(){if(eo)return;eo=!0;const e=go();if(0===Object.keys(e).length)return;e.kills&&ga("send","event","player stats","game_stats","total_kills",e.kills);e.deaths&&ga("send","event","player stats","game_stats","total_deaths",e.deaths);if(!e.hasOwnProperty("charClass"))return;const t=Object.keys(e.charClass);if(0===t.length)return;t.forEach(t=>{const i="Ranger"===t?"Free Ranger":t;(e.charClass[__uv.$wrap((t))].kills||e.charClass[__uv.$wrap((t))].deaths)&&(ga("send","event","player stats","kills",i,e.charClass[__uv.$wrap((t))].kills),ga("send","event","player stats","deaths",i,e.charClass[__uv.$wrap((t))].deaths),ga("send","event","player stats","kill ratio",i,Math.floor(e.charClass[__uv.$wrap((t))].kills/Math.max(e.charClass[__uv.$wrap((t))].kills+e.charClass[__uv.$wrap((t))].deaths,1)*100)))})}()),Ji.dispose(),V=!1,vueApp.setInGame(V),Rs(),Ko(),U=new Xo,e(),ss()):vueApp.switchToHomeUi(),vueApp.showChickenPopup(),_o()},openEquipInGame:function(){i.stopRenderLoop(),U.startRendering()},closeEquipInGame:function(e){i.stopRenderLoop(),rn(e),xr=!0,Oi&&S.focus()},buyProductForMoney:function(e){parsedUrl.dom+parsedUrl.__uv$setSource(__uv).__uv$top!=="devshellshock"||localStore.getItem("xsollaPopupConfrim")?(me=e,ws(e,"subscription"===ye.getProductType(e)),localStore.removeItem("xsollaPopupConfrim")):vueApp.openDevXsollaPopup(e)},clickedHouseAdSmall:function(e){ga("send","event",{eventCategory:"House banner ad",eventAction:"click",eventLabel:e.label}),No(e)},clickedHouseAdBig:function(e){ga("send","event",{eventCategory:"Big ad",eventAction:"click",eventLabel:e.label}),No(e)},clickedHouseLink:No,doConsent:function(){ga("send","event","privacy","age gate","agree"),O={ofAge:!0,targetedAds:!0},googletag.consented=!0,vueApp.setPrivacySettings(!0,!0),localStore.setItem("consent",JSON.stringify(O))},doNotConsent:function(){ga("send","event","privacy","age gate","disagree"),googletag.consented=!1,vueApp.setPrivacySettings(!1,!1),localStore.setItem("consent",JSON.stringify(O))},setOfAge:function(e){O.ofAge=e,ga("send","event","privacy","of age",e?"yes":"no"),e||(O.targetedAds=!1,googletag.consented=!1),localStore.setItem("consent",JSON.stringify(O))},setTargetedAds:function(e){O.targetedAds=e,googletag.consented=e,ga("send","event","privacy","targetedAds",e?"yes":"no"),localStore.setItem("consent",JSON.stringify(O))},settingsMenuOpened:function(){V&&1==L.enableChat&&Nn()},copyFriendCode:function(e){e.select(),function(){const e=vueData.gameTypes.find(({value:e})=>e===h),t=vueData.googleAnalytics;Eo([[t.cat.play,t.action.shareGameCopy,"Map - "+er.name,""],[t.cat.play,t.action.shareGameCopy,e.locKey?"Game type - "+e.locKey:"n/a",""],[t.cat.play,t.action.shareGameCopy,"Play type - "+A,""]])}();try{navigator.clipboard?navigator.clipboard.writeText(e.value):document.execCommand("copy")}catch(e){console.log("Unable to copy to clipboard")}},switchTeam:function(){if(he){console.log("Team switch requested");var e=bi.getBuffer();e.packInt8(Xe.switchTeam),e.send(va)}},onChatKeyDown:function(e){var t=(e=e||window.event).key;switch(S.value=ro(S.value,280),t){case"Enter":var i=S.value.trim();if(""!=i&&i.indexOf("<")<0){var r=bi.getBuffer();r.packInt8(Xe.chat),r.packString(i),r.send(va),j||Vn(i,ir),ir.chatLineCap--,1===++zi&&ga("send","event","game","stats","chat",zi)}case"Tab":e.preventDefault(),e.stopPropagation(),Un()}},startChat:Gn,stopChat:Un,selectGameType:function(e){h=e,localStore.setItem("gameType",e)},inviteFriends:Yn,hasHouseLink:function(e){return e.link||e.linksToTaggedItems||e.linksToItemId||e.linksToNugget||e.linksToPhotoBooth},enterSpectatorMode:function(){tn||(tn=!0,setTimeout(()=>tn=!1,1e3),Ri<0&&(Di=!1,Li=!0,Gi=Cs.freeCamera,vueApp.setPause(!1),vueApp.setInGame(Li),Ni.freeCamera(),Cr(),canvas.requestPointerLock(),ir.yaw=Math.radRange(a.rotation.y),ir.pitch=Math.radRange(a.rotation.x),Vi=Ja.set((function(){var e=bi.getBuffer();e.packInt8(Xe.keepAlive),e.send(ir.ws)}),15e3),dn()))},fixStringWidth:ro,filterUnicode:ao,clickedWebFeedItem:function(e){function t(e){ga("send","event","newsItem","clicked",e)}if("linksToItemId"in e){let i=G.findItemById(parseInt(e.linksToItemId,10));return vueApp.showItemOnEquipScreen(i),void t("item="+i.name)}return"linksToTaggedItems"in e?(ae=1==e.linksToTaggedItems?le.specialItemsTag:e.linksToTaggedItems,Ee=!0,wa(),void t("tagged="+e.linksToTaggedItems)):"linksToChangeLog"in e?(vueApp.showChangelogPopup(),void t("sschangelog")):"link"in e?(window.open(e.link,"_window"),void t(e.link)):"linksToPhotoBooth"in e?(yo(),void t("openPhotoBooth")):("linksToNugget"in e&&(oe=!0,Ia(),t("nugget")),"linksToEggStoreItem"in e?(vueApp.showPopupEggStoreSingle(e.linksToEggStoreItem),void t("skuItem="+e.linksToEggStoreItem)):("linksToVipStore"in e&&(vueApp.showSubStorePopup(),t("skuItem="+e.linksToVipStore)),void("linksToKotc"in e&&vueApp.showKotcInstrucPopup())))},pokiRewardedBreak:(e,t)=>{pokiActive&&(Ss(0),PokiSDK.rewardedBreak().then(()=>{as(),e&&e($e.video),Ss(),console.log("POKI Reward given")}).catch(e=>{console.log("Reward failed. ",e),t&&t(),Ss()}))},api_inGameReward:function(e,t,i){const r={cmd:"inGameReward",firebaseId:H.firebaseId};vueApp.showSpinner(),hi(r,r=>{switch(console.log("In Game reward response: "+r.result),vueApp.hideSpinner(),r.result){case"SUCCESS":case"SUCCESS_FIRST":e();break;case"REACHED_DAILY_LIMIT":i();break;case"ERROR":t()}},t)},socialReward:function(e){const t=e+"Rewarded";if(De[__uv.$wrap((t))]>=1)return void localStore.setItem(t,!0);De[__uv.$wrap((t))]++,vueApp.showSpinner();const i={};i.tag=$e[__uv.$wrap((e))],pi(i,(function(e){vueApp.hideSpinner();uo(e,{name:"Social media reward",success(){localStore.setItem(t,!0)},prevGiven(){this.success()},expired(){this.succces()},notFound(){localStore.setItem(t,!1)},playerNotFound(){localStore.getItem(t)&&localStore.removeItem(t)},error(){this.playerNotFound()},default(){this.playerNotFound()}})}),(function(e){console.log("servicesWs Error: "+JSON.stringify(e,["message","arguments","type","name"])),vueApp.showGenericPopup("uh_oh","generic_conn_failed","ok"),vueApp.hideSpinner()}))},getHouseAd:e=>{if(!le.length)return;const t=le[__uv.$wrap((e))].filter(e=>e.active);if(!t.length)return;const i=[],r=t.filter(e=>e.label.includes("VIP")).length;let n=Math.round(.5*t.length/r);isFinite(n)||(n=1);const a=t.map(e=>{const t=e.label.toUpperCase();return e.priority=1,t.includes("VIP")&&(e.priority=n),e});for(let e=0;e<a.length;++e)for(let t=0;t<a[__uv.$wrap((e))].priority;++t)i.push(a[__uv.$wrap((e))]);return i[__uv.$wrap((Math.floor(Math.random()*i.length)))]},getLocText:ka,GameType:Qe,resize:La,giveBasketBrosReward:function(){fo(16039,"giveBasketBrosReward")},resetPaperDoll:sa,getSessionStats:go,getProductTitle:function(e){return ye.getBundlesByItemId(e)},chwTryPlay:function(){xe.count<=it&&xe.ready?(Oe.isChwRequest=!0,vueApp.chicknWinnerError(!1),0===xe.count?(ni("chwTryPlay() First play!"),oi()):li(()=>{H.isUpgraded()?(ni("chwTryPlay() VIP. No ads for you! Thank you!"),oi()):(ni("chwTryPlay() No vip. Subscribe today for no video ads!"),Oe.play("shellshock.io_rpreroll_30s"))},e=>{Oe.isChwRequest=!1,si("chwTryPlay()",e)})):(ni("checkStartChicknWinner not ready"),ai())},api_incentivizedVideoRewardRequest:_i,getProductTitleByEggVaule:function(e){return ye.getProductTitleByEggVaule(e)},accountCreationNotification:Ra,get observingGame(){return j},get isGameOwner(){return C},get adminRoles(){return M},get photoBooth(){return Ae},get isGameReady(){return Aa()},get inGame(){return V},get gameType(){return h},get specialItemsTag(){return le.specialItemsTag},get getPwaEvent(){return fe},get account(){return H},get productBlockAds(){return ge},get adBlocker(){return N},get version(){return Ge},get changelogData(){return Ve},get onJoinGameClick(){return Te},get openShopOnly(){return Ee},set openShopOnly(e){Ee=e},set onJoinGameClick(e){Te=e},get fuseOptions(){return Ne},testGameUI:function(){vueApp.hideGameMenu(),document.getElementById("deathBox").style.display="none",document.getElementById("weaponBox").style.display="block",document.getElementById("healthContainer").style.display="block",document.getElementById("hardBoiledContainer").style.display="block",document.getElementById("killTicker").style.display="block",Oi&&S.focus(),$r(),Bi.show(),document.getElementById("gameAdContainer").style.display="none"}}}();</script></body><style id="stylus-4" type="text/css" class="stylus">/* i really want this to be global */
.ytp-play-progress {
animation:7s background linear infinite !important;
-webkit-animation:7s background linear infinite !important;
-moz-animation:7s background linear infinite !important;
-ms-animation:7s background linear infinite !important;
}
@keyframes background{
0%{
    background:red;
    -webkit-background:red;
    -moz-background:red;
    -ms-background:red;
}
20%{
    background:yellow;
    -webkit-background:yellow;
    -moz-background:yellow;
    -ms-background:yellow;
}
40%{
    background:green;
    -webkit-background:green;
    -moz-background:green;
    -ms-background:green;
}
60%{
    background:blue;
    -webkit-background:blue;
    -moz-background:blue;
    -ms-background:blue;
}
80%{
    background:purple;
    -webkit-background:purple;
    -moz-background:purple;
    -ms-background:purple;
}
100%{
    background:red;
    -webkit-background:red;
    -moz-background:red;
    -ms-background:red;
}
}
.ytp-progress-bar-container {
height: 13px !important;
}
.ytp-progress-list,.video-ads .ytp-progress-list.ytp-ad-progress-list {
height: 13px !important;
}
.ytp-load-progress {
background:url("data:image/gif;base64,R0lGODlhHAAgAPcAAP//AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJBgAAACwAAAAAHAAgAAAIPwABCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDihQZoGSAiyZNWkxZciVLlylRqhxJs6bDgAAh+QQJBgAAACwAAAAAHAAgAIf//wD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIPwABCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDivQYoGSAiyZNWkxZciVLlylRqhxJs6bEgAAh+QQJBgAAACwAAAAAHAAgAIf//wD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIPwABCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDitQYoGSAiyZNWkxZciVLlylRqhxJs6bFgAAh+QQJBgAAACwAAAAAHAAgAIf//wD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIQQABCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDirQYoGSAiyZNkkx5siLLlhRfolQ5sqZNjQEBACH5BAkGAAAALAAAAAAcACAAh///AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAg+AAEIHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo8ePIEOKHLkwgEmMJk9eTBkAZUqXKlfGJEmTZEAAIfkECQYAAAAsAAAAABwAIACH//8A////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACEEAAQgcSLCgwYMIEypcyLChw4cQI0qcSLGixYsYM2rcyLGjx48gQ4oceTCAyQAXT560qNIky5YvVaZcSbKmzYEBAQAh+QQJBgAAACwAAAAAHAAgAIf//wD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIQQABCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDihw5MIDJABdPnrSo0iTLli9VplxJsqbNgwEBADsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")!important;
height:32px !important;
}
.ytp-chapter-hover-container:hover {
height: 7px;
}
.ytp-scrubber-button {
background:url("data:image/gif;base64,R0lGODlhIAAgAPcAAP//APv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJBgAAACwAAAAAIAAgAAAIZwABCBxIUGCAgwgPFlzIcGDChw8bNoRIMaJEhxUzKryosWMAiR49MgwZsiBJkgRPljSocmVLly87AohJs6bNmzhz6tzJs+bMnix5Bt2JUWdKokdxjrwJ0ifHmBeLnoxqciXVpRCpBgQAIfkECQYAAAAsAAAAACAAIACH//8A+/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACGcAAQgcSFBggIMIDxZcyHBgwocPGzaESDGiRIcVMyq8qLFjAIkePTIMGbIgSZIET5Y0qHJlS5cvOwKISbOmzZs4c+rcybPmzJ4seQbdiVFnSqJHcY68CdInx5gXi56ManIl1aUQqQYEACH5BAkGAAAALAAAAAAgACAAh///APv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAh3AAEIHEhQYICDCA8WXMhwYMKHDxs2hEgxokSHFTMqvKixYwCJHj0yDBmyIEmSBE+WNKhyZUuXLymajJlwIs2LAF7ixHhyJ0+UPnO2DErzI8eiG0ciRbhwqUyhTmuyjGp0atSZTpUiBVkU582dOoNC7Si26dOLAQEAIfkECQYAAAAsAAAAACAAIACH//8A+/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACHgAAQgcSFBggIMIDxZcyHBgwocPGzaESDGiRIcVMyq8qLFjAIkePTIMGbIgSZIET5Y0qFKjyZYUR8JMOHHmxpowL7JUqRPjyZ4+UQIFkBOozZ42b+I8ujSpzKQ0X0KNunOqUqJWPy60CtIpx5lGWw6t6nKsVIsXAwIAIfkECQYAAAAsAAAAACAAIACH//8A+/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACHMAAQgcSFBggIMIDxZcyHBgwocPGzaESDGiRIcVMyq8qLFjAIkeO04MmXEkSYogT0JMqTIhx5YILwKAuZFlS5kzYeLMqXInT5I+f4YMqnMnTaNHcdL8KHMpU5tFod6UOtXk0pdOsSalOlRpVaQegy6siDMgACH5BAkGAAAALAAAAAAgACAAh///APv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAh4AAEIHEhQYICDCA8WXMhwYMKHDxs2hEgxokSHFTMqvKixYwCJHj0yDBmyIEmSBE+WNKhSo8mWFEfCTDhx5saaMC+yVKkT48mePlECBZATqM2eNm/iPLo0qcykNF9CjbpzqlKiVj8utArSKceZRlsOrepyrFSLFwMCACH5BAkGAAAALAAAAAAgACAAh///APv/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAh3AAEIHEhQYICDCA8WXMhwYMKHDxs2hEgxokSHFTMqvKixYwCJHj0yDBmyIEmSBE+WNKhyZUuXLymajJlwIs2LAF7ixHhyJ0+UPnO2DErzI8eiG0ciRbhwqUyhTmuyjGp0atSZTpUiBVkU582dOoNC7Si26dOLAQEAOwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA") !important;
width: 32px !important;
height: 32px !important;
margin-left: -7px !important;
margin-top: -7px !important;
transform: scale(0.8);
-webkit-transform: scale(0.8);
-moz-transform: scale(0.8);
-ms-transform: scale(0.8);
}</style></html>